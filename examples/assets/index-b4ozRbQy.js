import{r as At,p as st,T as pe,z as Ti,E as go,a as X,V as O,f as Ft,P as fe,y as Os,M as D,C as qt,n as mi,a_ as Oo,a$ as _o,ah as As,o as fi,at as So,au as No,v as wo,Q as Rt,av as yo,h as Ln,u as Lo,c as ze,m as Ri,q as Po,Z as ke,d as Te,ai as rt,O as Fs,I as Ge,_ as jt,B as it,J as Mo,$ as Pn,am as Uo,af as ti,a4 as _s,a0 as Ai,a1 as Fi,a2 as gi,a3 as Oi,a5 as _i,a6 as Mn,a7 as Ss,a8 as zt,k as Hi,a9 as Un,aa as Dn,ab as $t,N as Do,e as Ve,ac as ft,ad as xo,ae as Ze,X as bo,L as xn,Y as ki,aw as Qe,g as Ut,ax as vo,ay as ge,W as Bo,j as Ms,l as Yo,aj as Si,ak as Ni,al as wi,i as yi,an as zo,ao as Go,ap as Vo,aq as Ho,ar as Wi,as as ko,az as Wo,aO as Xo}from"./web-ifc-api-BC8YMRiS.js";var Zo=Object.defineProperty,Qo=(h,t,e)=>t in h?Zo(h,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[t]=e,I=(h,t,e)=>(Qo(h,typeof t!="symbol"?t+"":t,e),e);const bn=0,jo=1,qo=2,Xi=2,Us=1.25,Zi=1,ms=6*4+4+4,Ns=65535,Ko=Math.pow(2,-24),Ds=Symbol("SKIP_GENERATION");function $o(h){return h.index?h.index.count:h.attributes.position.count}function Re(h){return $o(h)/3}function Jo(h,t=ArrayBuffer){return h>65535?new Uint32Array(new t(4*h)):new Uint16Array(new t(2*h))}function tr(h,t){if(!h.index){const e=h.attributes.position.count,s=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,i=Jo(e,s);h.setIndex(new Ve(i,1));for(let n=0;n<e;n++)i[n]=n}}function vn(h){const t=Re(h),e=h.drawRange,s=e.start/3,i=(e.start+e.count)/3,n=Math.max(0,s),o=Math.min(t,i)-n;return[{offset:Math.floor(n),count:Math.floor(o)}]}function Bn(h){if(!h.groups||!h.groups.length)return vn(h);const t=[],e=new Set,s=h.drawRange,i=s.start/3,n=(s.start+s.count)/3;for(const r of h.groups){const a=r.start/3,c=(r.start+r.count)/3;e.add(Math.max(i,a)),e.add(Math.min(n,c))}const o=Array.from(e.values()).sort((r,a)=>r-a);for(let r=0;r<o.length-1;r++){const a=o[r],c=o[r+1];t.push({offset:Math.floor(a),count:Math.floor(c-a)})}return t}function er(h){if(h.groups.length===0)return!1;const t=Re(h),e=Bn(h).sort((n,o)=>n.offset-o.offset),s=e[e.length-1];s.count=Math.min(t-s.offset,s.count);let i=0;return e.forEach(({count:n})=>i+=n),t!==i}function j(h,t,e){return e.min.x=t[h],e.min.y=t[h+1],e.min.z=t[h+2],e.max.x=t[h+3],e.max.y=t[h+4],e.max.z=t[h+5],e}function sr(h){h[0]=h[1]=h[2]=1/0,h[3]=h[4]=h[5]=-1/0}function Qi(h){let t=-1,e=-1/0;for(let s=0;s<3;s++){const i=h[s+3]-h[s];i>e&&(e=i,t=s)}return t}function ji(h,t){t.set(h)}function qi(h,t,e){let s,i;for(let n=0;n<3;n++){const o=n+3;s=h[n],i=t[n],e[n]=s<i?s:i,s=h[o],i=t[o],e[o]=s>i?s:i}}function je(h,t,e){for(let s=0;s<3;s++){const i=t[h+2*s],n=t[h+2*s+1],o=i-n,r=i+n;o<e[s]&&(e[s]=o),r>e[s+3]&&(e[s+3]=r)}}function Oe(h){const t=h[3]-h[0],e=h[4]-h[1],s=h[5]-h[2];return 2*(t*e+e*s+s*t)}function xs(h,t,e,s,i=null){let n=1/0,o=1/0,r=1/0,a=-1/0,c=-1/0,d=-1/0,E=1/0,l=1/0,u=1/0,T=-1/0,C=-1/0,f=-1/0;const m=i!==null;for(let R=t*6,F=(t+e)*6;R<F;R+=6){const p=h[R+0],A=h[R+1],g=p-A,_=p+A;g<n&&(n=g),_>a&&(a=_),m&&p<E&&(E=p),m&&p>T&&(T=p);const S=h[R+2],w=h[R+3],y=S-w,L=S+w;y<o&&(o=y),L>c&&(c=L),m&&S<l&&(l=S),m&&S>C&&(C=S);const P=h[R+4],U=h[R+5],x=P-U,Y=P+U;x<r&&(r=x),Y>d&&(d=Y),m&&P<u&&(u=P),m&&P>f&&(f=P)}s[0]=n,s[1]=o,s[2]=r,s[3]=a,s[4]=c,s[5]=d,m&&(i[0]=E,i[1]=l,i[2]=u,i[3]=T,i[4]=C,i[5]=f)}function ir(h,t,e,s){let i=1/0,n=1/0,o=1/0,r=-1/0,a=-1/0,c=-1/0;for(let d=t*6,E=(t+e)*6;d<E;d+=6){const l=h[d+0];l<i&&(i=l),l>r&&(r=l);const u=h[d+2];u<n&&(n=u),u>a&&(a=u);const T=h[d+4];T<o&&(o=T),T>c&&(c=T)}s[0]=i,s[1]=n,s[2]=o,s[3]=r,s[4]=a,s[5]=c}function nr(h,t){sr(t);const e=h.attributes.position,s=h.index?h.index.array:null,i=Re(h),n=new Float32Array(i*6),o=e.normalized,r=e.array,a=e.offset||0;let c=3;e.isInterleavedBufferAttribute&&(c=e.data.stride);const d=["getX","getY","getZ"];for(let E=0;E<i;E++){const l=E*3,u=E*6;let T=l+0,C=l+1,f=l+2;s&&(T=s[T],C=s[C],f=s[f]),o||(T=T*c+a,C=C*c+a,f=f*c+a);for(let m=0;m<3;m++){let R,F,p;o?(R=e[d[m]](T),F=e[d[m]](C),p=e[d[m]](f)):(R=r[T+m],F=r[C+m],p=r[f+m]);let A=R;F<A&&(A=F),p<A&&(A=p);let g=R;F>g&&(g=F),p>g&&(g=p);const _=(g-A)/2,S=m*2;n[u+S+0]=A+_,n[u+S+1]=_+(Math.abs(A)+_)*Ko,A<t[m]&&(t[m]=A),g>t[m+3]&&(t[m+3]=g)}}return n}const yt=32,or=(h,t)=>h.candidate-t.candidate,Dt=new Array(yt).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),qe=new Float32Array(6);function rr(h,t,e,s,i,n){let o=-1,r=0;if(n===bn)o=Qi(t),o!==-1&&(r=(t[o]+t[o+3])/2);else if(n===jo)o=Qi(h),o!==-1&&(r=ar(e,s,i,o));else if(n===qo){const a=Oe(h);let c=Us*i;const d=s*6,E=(s+i)*6;for(let l=0;l<3;l++){const u=t[l],T=(t[l+3]-u)/yt;if(i<yt/4){const C=[...Dt];C.length=i;let f=0;for(let R=d;R<E;R+=6,f++){const F=C[f];F.candidate=e[R+2*l],F.count=0;const{bounds:p,leftCacheBounds:A,rightCacheBounds:g}=F;for(let _=0;_<3;_++)g[_]=1/0,g[_+3]=-1/0,A[_]=1/0,A[_+3]=-1/0,p[_]=1/0,p[_+3]=-1/0;je(R,e,p)}C.sort(or);let m=i;for(let R=0;R<m;R++){const F=C[R];for(;R+1<m&&C[R+1].candidate===F.candidate;)C.splice(R+1,1),m--}for(let R=d;R<E;R+=6){const F=e[R+2*l];for(let p=0;p<m;p++){const A=C[p];F>=A.candidate?je(R,e,A.rightCacheBounds):(je(R,e,A.leftCacheBounds),A.count++)}}for(let R=0;R<m;R++){const F=C[R],p=F.count,A=i-F.count,g=F.leftCacheBounds,_=F.rightCacheBounds;let S=0;p!==0&&(S=Oe(g)/a);let w=0;A!==0&&(w=Oe(_)/a);const y=Zi+Us*(S*p+w*A);y<c&&(o=l,c=y,r=F.candidate)}}else{for(let m=0;m<yt;m++){const R=Dt[m];R.count=0,R.candidate=u+T+m*T;const F=R.bounds;for(let p=0;p<3;p++)F[p]=1/0,F[p+3]=-1/0}for(let m=d;m<E;m+=6){let R=~~((e[m+2*l]-u)/T);R>=yt&&(R=yt-1);const F=Dt[R];F.count++,je(m,e,F.bounds)}const C=Dt[yt-1];ji(C.bounds,C.rightCacheBounds);for(let m=yt-2;m>=0;m--){const R=Dt[m],F=Dt[m+1];qi(R.bounds,F.rightCacheBounds,R.rightCacheBounds)}let f=0;for(let m=0;m<yt-1;m++){const R=Dt[m],F=R.count,p=R.bounds,A=Dt[m+1].rightCacheBounds;F!==0&&(f===0?ji(p,qe):qi(p,qe,qe)),f+=F;let g=0,_=0;f!==0&&(g=Oe(qe)/a);const S=i-f;S!==0&&(_=Oe(A)/a);const w=Zi+Us*(g*f+_*S);w<c&&(o=l,c=w,r=R.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${n} used.`);return{axis:o,pos:r}}function ar(h,t,e,s){let i=0;for(let n=t,o=t+e;n<o;n++)i+=h[n*6+s*2];return i/e}class Ke{constructor(){}}function hr(h,t,e,s,i,n){let o=s,r=s+i-1;const a=n.pos,c=n.axis*2;for(;;){for(;o<=r&&e[o*6+c]<a;)o++;for(;o<=r&&e[r*6+c]>=a;)r--;if(o<r){for(let d=0;d<3;d++){let E=t[o*3+d];t[o*3+d]=t[r*3+d],t[r*3+d]=E}for(let d=0;d<6;d++){let E=e[o*6+d];e[o*6+d]=e[r*6+d],e[r*6+d]=E}o++,r--}else return o}}function cr(h,t,e,s,i,n){let o=s,r=s+i-1;const a=n.pos,c=n.axis*2;for(;;){for(;o<=r&&e[o*6+c]<a;)o++;for(;o<=r&&e[r*6+c]>=a;)r--;if(o<r){let d=h[o];h[o]=h[r],h[r]=d;for(let E=0;E<6;E++){let l=e[o*6+E];e[o*6+E]=e[r*6+E],e[r*6+E]=l}o++,r--}else return o}}function lr(h,t){const e=(h.index?h.index.count:h.attributes.position.count)/3,s=e>2**16,i=s?4:2,n=t?new SharedArrayBuffer(e*i):new ArrayBuffer(e*i),o=s?new Uint32Array(n):new Uint16Array(n);for(let r=0,a=o.length;r<a;r++)o[r]=r;return o}function dr(h,t){const e=h.geometry,s=e.index?e.index.array:null,i=t.maxDepth,n=t.verbose,o=t.maxLeafTris,r=t.strategy,a=t.onProgress,c=Re(e),d=h._indirectBuffer;let E=!1;const l=new Float32Array(6),u=new Float32Array(6),T=nr(e,l),C=t.indirect?cr:hr,f=[],m=t.indirect?vn(e):Bn(e);if(m.length===1){const p=m[0],A=new Ke;A.boundingData=l,ir(T,p.offset,p.count,u),F(A,p.offset,p.count,u),f.push(A)}else for(let p of m){const A=new Ke;A.boundingData=new Float32Array(6),xs(T,p.offset,p.count,A.boundingData,u),F(A,p.offset,p.count,u),f.push(A)}return f;function R(p){a&&a(p/c)}function F(p,A,g,_=null,S=0){if(!E&&S>=i&&(E=!0,n&&(console.warn(`MeshBVH: Max depth of ${i} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),g<=o||S>=i)return R(A+g),p.offset=A,p.count=g,p;const w=rr(p.boundingData,_,T,A,g,r);if(w.axis===-1)return R(A+g),p.offset=A,p.count=g,p;const y=C(d,s,T,A,g,w);if(y===A||y===A+g)R(A+g),p.offset=A,p.count=g;else{p.splitAxis=w.axis;const L=new Ke,P=A,U=y-A;p.left=L,L.boundingData=new Float32Array(6),xs(T,P,U,L.boundingData,u),F(L,P,U,u,S+1);const x=new Ke,Y=y,z=g-U;p.right=x,x.boundingData=new Float32Array(6),xs(T,Y,z,x.boundingData,u),F(x,Y,z,u,S+1)}return p}}function Er(h,t){const e=h.geometry;t.indirect&&(h._indirectBuffer=lr(e,t.useSharedArrayBuffer),er(e)&&!t.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),h._indirectBuffer||tr(e,t);const s=dr(h,t);let i,n,o;const r=[],a=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let E=0;E<s.length;E++){const l=s[E];let u=c(l);const T=new a(ms*u);i=new Float32Array(T),n=new Uint32Array(T),o=new Uint16Array(T),d(0,l),r.push(T)}h._roots=r;return;function c(E){return E.count?1:1+c(E.left)+c(E.right)}function d(E,l){const u=E/4,T=E/2,C=!!l.count,f=l.boundingData;for(let m=0;m<6;m++)i[u+m]=f[m];if(C){const m=l.offset,R=l.count;return n[u+6]=m,o[T+14]=R,o[T+15]=Ns,E+ms}else{const m=l.left,R=l.right,F=l.splitAxis;let p;if(p=d(E+ms,m),p/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[u+6]=p/4,p=d(p,R),n[u+7]=F,p}}}class Pt{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let s=1/0,i=-1/0;for(let n=0,o=t.length;n<o;n++){const r=t[n][e];s=r<s?r:s,i=r>i?r:i}this.min=s,this.max=i}setFromPoints(t,e){let s=1/0,i=-1/0;for(let n=0,o=e.length;n<o;n++){const r=e[n],a=t.dot(r);s=a<s?a:s,i=a>i?a:i}this.min=s,this.max=i}isSeparated(t){return this.min>t.max||t.min>this.max}}Pt.prototype.setFromBox=function(){const h=new O;return function(t,e){const s=e.min,i=e.max;let n=1/0,o=-1/0;for(let r=0;r<=1;r++)for(let a=0;a<=1;a++)for(let c=0;c<=1;c++){h.x=s.x*r+i.x*(1-r),h.y=s.y*a+i.y*(1-a),h.z=s.z*c+i.z*(1-c);const d=t.dot(h);n=Math.min(d,n),o=Math.max(d,o)}this.min=n,this.max=o}}();const Ir=function(){const h=new O,t=new O,e=new O;return function(s,i,n){const o=s.start,r=h,a=i.start,c=t;e.subVectors(o,a),h.subVectors(s.end,s.start),t.subVectors(i.end,i.start);const d=e.dot(c),E=c.dot(r),l=c.dot(c),u=e.dot(r),T=r.dot(r)*l-E*E;let C,f;T!==0?C=(d*E-u*l)/T:C=0,f=(d+C*E)/l,n.x=C,n.y=f}}(),Li=function(){const h=new Ft,t=new O,e=new O;return function(s,i,n,o){Ir(s,i,h);let r=h.x,a=h.y;if(r>=0&&r<=1&&a>=0&&a<=1){s.at(r,n),i.at(a,o);return}else if(r>=0&&r<=1){a<0?i.at(0,o):i.at(1,o),s.closestPointToPoint(o,!0,n);return}else if(a>=0&&a<=1){r<0?s.at(0,n):s.at(1,n),i.closestPointToPoint(n,!0,o);return}else{let c;r<0?c=s.start:c=s.end;let d;a<0?d=i.start:d=i.end;const E=t,l=e;if(s.closestPointToPoint(d,!0,t),i.closestPointToPoint(c,!0,e),E.distanceToSquared(d)<=l.distanceToSquared(c)){n.copy(E),o.copy(d);return}else{n.copy(c),o.copy(l);return}}}}(),ur=function(){const h=new O,t=new O,e=new fe,s=new At;return function(i,n){const{radius:o,center:r}=i,{a,b:c,c:d}=n;if(s.start=a,s.end=c,s.closestPointToPoint(r,!0,h).distanceTo(r)<=o||(s.start=a,s.end=d,s.closestPointToPoint(r,!0,h).distanceTo(r)<=o)||(s.start=c,s.end=d,s.closestPointToPoint(r,!0,h).distanceTo(r)<=o))return!0;const E=n.getPlane(e);if(Math.abs(E.distanceToPoint(r))<=o){const l=E.projectPoint(r,t);if(n.containsPoint(l))return!0}return!1}}(),pr=1e-15;function bs(h){return Math.abs(h)<pr}class gt extends pe{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new O),this.satBounds=new Array(4).fill().map(()=>new Pt),this.points=[this.a,this.b,this.c],this.sphere=new Os,this.plane=new fe,this.needsUpdate=!0}intersectsSphere(t){return ur(t,this)}update(){const t=this.a,e=this.b,s=this.c,i=this.points,n=this.satAxes,o=this.satBounds,r=n[0],a=o[0];this.getNormal(r),a.setFromPoints(r,i);const c=n[1],d=o[1];c.subVectors(t,e),d.setFromPoints(c,i);const E=n[2],l=o[2];E.subVectors(e,s),l.setFromPoints(E,i);const u=n[3],T=o[3];u.subVectors(s,t),T.setFromPoints(u,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(r,t),this.needsUpdate=!1}}gt.prototype.closestPointToSegment=function(){const h=new O,t=new O,e=new At;return function(s,i=null,n=null){const{start:o,end:r}=s,a=this.points;let c,d=1/0;for(let E=0;E<3;E++){const l=(E+1)%3;e.start.copy(a[E]),e.end.copy(a[l]),Li(e,s,h,t),c=h.distanceToSquared(t),c<d&&(d=c,i&&i.copy(h),n&&n.copy(t))}return this.closestPointToPoint(o,h),c=o.distanceToSquared(h),c<d&&(d=c,i&&i.copy(h),n&&n.copy(o)),this.closestPointToPoint(r,h),c=r.distanceToSquared(h),c<d&&(d=c,i&&i.copy(h),n&&n.copy(r)),Math.sqrt(d)}}();gt.prototype.intersectsTriangle=function(){const h=new gt,t=new Array(3),e=new Array(3),s=new Pt,i=new Pt,n=new O,o=new O,r=new O,a=new O,c=new O,d=new At,E=new At,l=new At,u=new O;function T(C,f,m){const R=C.points;let F=0,p=-1;for(let A=0;A<3;A++){const{start:g,end:_}=d;g.copy(R[A]),_.copy(R[(A+1)%3]),d.delta(o);const S=bs(f.distanceToPoint(g));if(bs(f.normal.dot(o))&&S){m.copy(d),F=2;break}const w=f.intersectLine(d,u);if(!w&&S&&u.copy(g),(w||S)&&!bs(u.distanceTo(_))){if(F<=1)(F===1?m.start:m.end).copy(u),S&&(p=F);else if(F>=2){(p===1?m.start:m.end).copy(u),F=2;break}if(F++,F===2&&p===-1)break}}return F}return function(C,f=null,m=!1){this.needsUpdate&&this.update(),C.isExtendedTriangle?C.needsUpdate&&C.update():(h.copy(C),h.update(),C=h);const R=this.plane,F=C.plane;if(Math.abs(R.normal.dot(F.normal))>1-1e-10){const p=this.satBounds,A=this.satAxes;e[0]=C.a,e[1]=C.b,e[2]=C.c;for(let S=0;S<4;S++){const w=p[S],y=A[S];if(s.setFromPoints(y,e),w.isSeparated(s))return!1}const g=C.satBounds,_=C.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let S=0;S<4;S++){const w=g[S],y=_[S];if(s.setFromPoints(y,t),w.isSeparated(s))return!1}for(let S=0;S<4;S++){const w=A[S];for(let y=0;y<4;y++){const L=_[y];if(n.crossVectors(w,L),s.setFromPoints(n,t),i.setFromPoints(n,e),s.isSeparated(i))return!1}}return f&&(m||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),f.start.set(0,0,0),f.end.set(0,0,0)),!0}else{const p=T(this,F,E);if(p===1&&C.containsPoint(E.end))return f&&(f.start.copy(E.end),f.end.copy(E.end)),!0;if(p!==2)return!1;const A=T(C,R,l);if(A===1&&this.containsPoint(l.end))return f&&(f.start.copy(l.end),f.end.copy(l.end)),!0;if(A!==2)return!1;if(E.delta(r),l.delta(a),r.dot(a)<0){let P=l.start;l.start=l.end,l.end=P}const g=E.start.dot(r),_=E.end.dot(r),S=l.start.dot(r),w=l.end.dot(r),y=_<S,L=g<w;return g!==w&&S!==_&&y===L?!1:(f&&(c.subVectors(E.start,l.start),c.dot(r)>0?f.start.copy(E.start):f.start.copy(l.start),c.subVectors(E.end,l.end),c.dot(r)<0?f.end.copy(E.end):f.end.copy(l.end)),!0)}}}();gt.prototype.distanceToPoint=function(){const h=new O;return function(t){return this.closestPointToPoint(t,h),t.distanceTo(h)}}();gt.prototype.distanceToTriangle=function(){const h=new O,t=new O,e=["a","b","c"],s=new At,i=new At;return function(n,o=null,r=null){const a=o||r?s:null;if(this.intersectsTriangle(n,a))return(o||r)&&(o&&a.getCenter(o),r&&a.getCenter(r)),0;let c=1/0;for(let d=0;d<3;d++){let E;const l=e[d],u=n[l];this.closestPointToPoint(u,h),E=u.distanceToSquared(h),E<c&&(c=E,o&&o.copy(h),r&&r.copy(u));const T=this[l];n.closestPointToPoint(T,h),E=T.distanceToSquared(h),E<c&&(c=E,o&&o.copy(T),r&&r.copy(h))}for(let d=0;d<3;d++){const E=e[d],l=e[(d+1)%3];s.set(this[E],this[l]);for(let u=0;u<3;u++){const T=e[u],C=e[(u+1)%3];i.set(n[T],n[C]),Li(s,i,h,t);const f=h.distanceToSquared(t);f<c&&(c=f,o&&o.copy(h),r&&r.copy(t))}}return Math.sqrt(c)}}();class at{constructor(t,e,s){this.isOrientedBox=!0,this.min=new O,this.max=new O,this.matrix=new X,this.invMatrix=new X,this.points=new Array(8).fill().map(()=>new O),this.satAxes=new Array(3).fill().map(()=>new O),this.satBounds=new Array(3).fill().map(()=>new Pt),this.alignedSatBounds=new Array(3).fill().map(()=>new Pt),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),s&&this.matrix.copy(s)}set(t,e,s){this.min.copy(t),this.max.copy(e),this.matrix.copy(s),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}}at.prototype.update=function(){return function(){const h=this.matrix,t=this.min,e=this.max,s=this.points;for(let a=0;a<=1;a++)for(let c=0;c<=1;c++)for(let d=0;d<=1;d++){const E=1*a|2*c|4*d,l=s[E];l.x=a?e.x:t.x,l.y=c?e.y:t.y,l.z=d?e.z:t.z,l.applyMatrix4(h)}const i=this.satBounds,n=this.satAxes,o=s[0];for(let a=0;a<3;a++){const c=n[a],d=i[a],E=1<<a,l=s[E];c.subVectors(o,l),d.setFromPoints(c,s)}const r=this.alignedSatBounds;r[0].setFromPointsField(s,"x"),r[1].setFromPointsField(s,"y"),r[2].setFromPointsField(s,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();at.prototype.intersectsBox=function(){const h=new Pt;return function(t){this.needsUpdate&&this.update();const e=t.min,s=t.max,i=this.satBounds,n=this.satAxes,o=this.alignedSatBounds;if(h.min=e.x,h.max=s.x,o[0].isSeparated(h)||(h.min=e.y,h.max=s.y,o[1].isSeparated(h))||(h.min=e.z,h.max=s.z,o[2].isSeparated(h)))return!1;for(let r=0;r<3;r++){const a=n[r],c=i[r];if(h.setFromBox(a,t),c.isSeparated(h))return!1}return!0}}();at.prototype.intersectsTriangle=function(){const h=new gt,t=new Array(3),e=new Pt,s=new Pt,i=new O;return function(n){this.needsUpdate&&this.update(),n.isExtendedTriangle?n.needsUpdate&&n.update():(h.copy(n),h.update(),n=h);const o=this.satBounds,r=this.satAxes;t[0]=n.a,t[1]=n.b,t[2]=n.c;for(let E=0;E<3;E++){const l=o[E],u=r[E];if(e.setFromPoints(u,t),l.isSeparated(e))return!1}const a=n.satBounds,c=n.satAxes,d=this.points;for(let E=0;E<3;E++){const l=a[E],u=c[E];if(e.setFromPoints(u,d),l.isSeparated(e))return!1}for(let E=0;E<3;E++){const l=r[E];for(let u=0;u<4;u++){const T=c[u];if(i.crossVectors(l,T),e.setFromPoints(i,t),s.setFromPoints(i,d),e.isSeparated(s))return!1}}return!0}}();at.prototype.closestPointToPoint=function(){return function(h,t){return this.needsUpdate&&this.update(),t.copy(h).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}();at.prototype.distanceToPoint=function(){const h=new O;return function(t){return this.closestPointToPoint(t,h),t.distanceTo(h)}}();at.prototype.distanceToBox=function(){const h=["x","y","z"],t=new Array(12).fill().map(()=>new At),e=new Array(12).fill().map(()=>new At),s=new O,i=new O;return function(n,o=0,r=null,a=null){if(this.needsUpdate&&this.update(),this.intersectsBox(n))return(r||a)&&(n.getCenter(i),this.closestPointToPoint(i,s),n.closestPointToPoint(s,i),r&&r.copy(s),a&&a.copy(i)),0;const c=o*o,d=n.min,E=n.max,l=this.points;let u=1/0;for(let C=0;C<8;C++){const f=l[C];i.copy(f).clamp(d,E);const m=f.distanceToSquared(i);if(m<u&&(u=m,r&&r.copy(f),a&&a.copy(i),m<c))return Math.sqrt(m)}let T=0;for(let C=0;C<3;C++)for(let f=0;f<=1;f++)for(let m=0;m<=1;m++){const R=(C+1)%3,F=(C+2)%3,p=f<<R|m<<F,A=1<<C|f<<R|m<<F,g=l[p],_=l[A];t[T].set(g,_);const S=h[C],w=h[R],y=h[F],L=e[T],P=L.start,U=L.end;P[S]=d[S],P[w]=f?d[w]:E[w],P[y]=m?d[y]:E[w],U[S]=E[S],U[w]=f?d[w]:E[w],U[y]=m?d[y]:E[w],T++}for(let C=0;C<=1;C++)for(let f=0;f<=1;f++)for(let m=0;m<=1;m++){i.x=C?E.x:d.x,i.y=f?E.y:d.y,i.z=m?E.z:d.z,this.closestPointToPoint(i,s);const R=i.distanceToSquared(s);if(R<u&&(u=R,r&&r.copy(s),a&&a.copy(i),R<c))return Math.sqrt(R)}for(let C=0;C<12;C++){const f=t[C];for(let m=0;m<12;m++){const R=e[m];Li(f,R,s,i);const F=s.distanceToSquared(i);if(F<u&&(u=F,r&&r.copy(s),a&&a.copy(i),F<c))return Math.sqrt(F)}}return Math.sqrt(u)}}();class Pi{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){const t=this._primitives;return t.length===0?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}}class Cr extends Pi{constructor(){super(()=>new gt)}}const Et=new Cr;function ct(h,t){return t[h+15]===65535}function lt(h,t){return t[h+6]}function It(h,t){return t[h+14]}function ut(h){return h+8}function pt(h,t){return t[h+6]}function Yn(h,t){return t[h+7]}class Tr{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const t=[];let e=null;this.setBuffer=s=>{e&&t.push(e),e=s,this.float32Array=new Float32Array(s),this.uint16Array=new Uint16Array(s),this.uint32Array=new Uint32Array(s)},this.clearBuffer=()=>{e=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,t.length!==0&&this.setBuffer(t.pop())}}}const Z=new Tr;let Bt,Ce;const te=[],$e=new Pi(()=>new st);function mr(h,t,e,s,i,n){Bt=$e.getPrimitive(),Ce=$e.getPrimitive(),te.push(Bt,Ce),Z.setBuffer(h._roots[t]);const o=ei(0,h.geometry,e,s,i,n);Z.clearBuffer(),$e.releasePrimitive(Bt),$e.releasePrimitive(Ce),te.pop(),te.pop();const r=te.length;return r>0&&(Ce=te[r-1],Bt=te[r-2]),o}function ei(h,t,e,s,i=null,n=0,o=0){const{float32Array:r,uint16Array:a,uint32Array:c}=Z;let d=h*2;if(ct(d,a)){const E=lt(h,c),l=It(d,a);return j(h,r,Bt),s(E,l,!1,o,n+h,Bt)}else{let E=function(L){const{uint16Array:P,uint32Array:U}=Z;let x=L*2;for(;!ct(x,P);)L=ut(L),x=L*2;return lt(L,U)},l=function(L){const{uint16Array:P,uint32Array:U}=Z;let x=L*2;for(;!ct(x,P);)L=pt(L,U),x=L*2;return lt(L,U)+It(x,P)};const u=ut(h),T=pt(h,c);let C=u,f=T,m,R,F,p;if(i&&(F=Bt,p=Ce,j(C,r,F),j(f,r,p),m=i(F),R=i(p),R<m)){C=T,f=u;const L=m;m=R,R=L,F=p}F||(F=Bt,j(C,r,F));const A=ct(C*2,a),g=e(F,A,m,o+1,n+C);let _;if(g===Xi){const L=E(C),P=l(C)-L;_=s(L,P,!0,o+1,n+C,F)}else _=g&&ei(C,t,e,s,i,n,o+1);if(_)return!0;p=Ce,j(f,r,p);const S=ct(f*2,a),w=e(p,S,R,o+1,n+f);let y;if(w===Xi){const L=E(f),P=l(f)-L;y=s(L,P,!0,o+1,n+f,p)}else y=w&&ei(f,t,e,s,i,n,o+1);return!!y}}const _e=new O,vs=new O;function fr(h,t,e={},s=0,i=1/0){const n=s*s,o=i*i;let r=1/0,a=null;if(h.shapecast({boundsTraverseOrder:d=>(_e.copy(t).clamp(d.min,d.max),_e.distanceToSquared(t)),intersectsBounds:(d,E,l)=>l<r&&l<o,intersectsTriangle:(d,E)=>{d.closestPointToPoint(t,_e);const l=t.distanceToSquared(_e);return l<r&&(vs.copy(_e),r=l,a=E),l<n}}),r===1/0)return null;const c=Math.sqrt(r);return e.point?e.point.copy(vs):e.point=vs.clone(),e.distance=c,e.faceIndex=a,e}const ee=new O,se=new O,ie=new O,Je=new Ft,ts=new Ft,es=new Ft,Ki=new O,$i=new O,Ji=new O,ss=new O;function Rr(h,t,e,s,i,n){let o;return n===Xo?o=h.intersectTriangle(s,e,t,!0,i):o=h.intersectTriangle(t,e,s,n!==ke,i),o===null?null:{distance:h.origin.distanceTo(i),point:i.clone()}}function Ar(h,t,e,s,i,n,o,r,a){ee.fromBufferAttribute(t,n),se.fromBufferAttribute(t,o),ie.fromBufferAttribute(t,r);const c=Rr(h,ee,se,ie,ss,a);if(c){s&&(Je.fromBufferAttribute(s,n),ts.fromBufferAttribute(s,o),es.fromBufferAttribute(s,r),c.uv=pe.getInterpolation(ss,ee,se,ie,Je,ts,es,new Ft)),i&&(Je.fromBufferAttribute(i,n),ts.fromBufferAttribute(i,o),es.fromBufferAttribute(i,r),c.uv1=pe.getInterpolation(ss,ee,se,ie,Je,ts,es,new Ft)),e&&(Ki.fromBufferAttribute(e,n),$i.fromBufferAttribute(e,o),Ji.fromBufferAttribute(e,r),c.normal=pe.getInterpolation(ss,ee,se,ie,Ki,$i,Ji,new O),c.normal.dot(h.direction)>0&&c.normal.multiplyScalar(-1));const d={a:n,b:o,c:r,normal:new O,materialIndex:0};pe.getNormal(ee,se,ie,d.normal),c.face=d,c.faceIndex=n}return c}function ws(h,t,e,s,i){const n=s*3;let o=n+0,r=n+1,a=n+2;const c=h.index;h.index&&(o=c.getX(o),r=c.getX(r),a=c.getX(a));const{position:d,normal:E,uv:l,uv1:u}=h.attributes,T=Ar(e,d,E,l,u,o,r,a,t);return T?(T.faceIndex=s,i&&i.push(T),T):null}function $(h,t,e,s){const i=h.a,n=h.b,o=h.c;let r=t,a=t+1,c=t+2;e&&(r=e.getX(r),a=e.getX(a),c=e.getX(c)),i.x=s.getX(r),i.y=s.getY(r),i.z=s.getZ(r),n.x=s.getX(a),n.y=s.getY(a),n.z=s.getZ(a),o.x=s.getX(c),o.y=s.getY(c),o.z=s.getZ(c)}function Fr(h,t,e,s,i,n){const{geometry:o,_indirectBuffer:r}=h;for(let a=s,c=s+i;a<c;a++)ws(o,t,e,a,n)}function gr(h,t,e,s,i){const{geometry:n,_indirectBuffer:o}=h;let r=1/0,a=null;for(let c=s,d=s+i;c<d;c++){let E;E=ws(n,t,e,c),E&&E.distance<r&&(a=E,r=E.distance)}return a}function Or(h,t,e,s,i,n,o){const{geometry:r}=e,{index:a}=r,c=r.attributes.position;for(let d=h,E=t+h;d<E;d++){let l;if(l=d,$(o,l*3,a,c),o.needsUpdate=!0,s(o,l,i,n))return!0}return!1}function _r(h,t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=h.geometry,s=e.index?e.index.array:null,i=e.attributes.position;let n,o,r,a,c=0;const d=h._roots;for(let l=0,u=d.length;l<u;l++)n=d[l],o=new Uint32Array(n),r=new Uint16Array(n),a=new Float32Array(n),E(0,c),c+=n.byteLength;function E(l,u,T=!1){const C=l*2;if(r[C+15]===Ns){const f=o[l+6],m=r[C+14];let R=1/0,F=1/0,p=1/0,A=-1/0,g=-1/0,_=-1/0;for(let S=3*f,w=3*(f+m);S<w;S++){let y=s[S];const L=i.getX(y),P=i.getY(y),U=i.getZ(y);L<R&&(R=L),L>A&&(A=L),P<F&&(F=P),P>g&&(g=P),U<p&&(p=U),U>_&&(_=U)}return a[l+0]!==R||a[l+1]!==F||a[l+2]!==p||a[l+3]!==A||a[l+4]!==g||a[l+5]!==_?(a[l+0]=R,a[l+1]=F,a[l+2]=p,a[l+3]=A,a[l+4]=g,a[l+5]=_,!0):!1}else{const f=l+8,m=o[l+6],R=f+u,F=m+u;let p=T,A=!1,g=!1;t?p||(A=t.has(R),g=t.has(F),p=!A&&!g):(A=!0,g=!0);const _=p||A,S=p||g;let w=!1;_&&(w=E(f,u,p));let y=!1;S&&(y=E(m,u,p));const L=w||y;if(L)for(let P=0;P<3;P++){const U=f+P,x=m+P,Y=a[U],z=a[U+3],tt=a[x],H=a[x+3];a[l+P]=Y<tt?Y:tt,a[l+P+3]=z>H?z:H}return L}}}const tn=new st;function Gt(h,t,e,s){return j(h,t,tn),e.intersectBox(tn,s)}function Sr(h,t,e,s,i,n){const{geometry:o,_indirectBuffer:r}=h;for(let a=s,c=s+i;a<c;a++){let d=r?r[a]:a;ws(o,t,e,d,n)}}function Nr(h,t,e,s,i){const{geometry:n,_indirectBuffer:o}=h;let r=1/0,a=null;for(let c=s,d=s+i;c<d;c++){let E;E=ws(n,t,e,o?o[c]:c),E&&E.distance<r&&(a=E,r=E.distance)}return a}function wr(h,t,e,s,i,n,o){const{geometry:r}=e,{index:a}=r,c=r.attributes.position;for(let d=h,E=t+h;d<E;d++){let l;if(l=e.resolveTriangleIndex(d),$(o,l*3,a,c),o.needsUpdate=!0,s(o,l,i,n))return!0}return!1}const en=new O;function yr(h,t,e,s,i){Z.setBuffer(h._roots[t]),si(0,h,e,s,i),Z.clearBuffer()}function si(h,t,e,s,i){const{float32Array:n,uint16Array:o,uint32Array:r}=Z,a=h*2;if(ct(a,o)){const c=lt(h,r),d=It(a,o);Fr(t,e,s,c,d,i)}else{const c=ut(h);Gt(c,n,s,en)&&si(c,t,e,s,i);const d=pt(h,r);Gt(d,n,s,en)&&si(d,t,e,s,i)}}const sn=new O,Lr=["x","y","z"];function Pr(h,t,e,s){Z.setBuffer(h._roots[t]);const i=ii(0,h,e,s);return Z.clearBuffer(),i}function ii(h,t,e,s){const{float32Array:i,uint16Array:n,uint32Array:o}=Z;let r=h*2;if(ct(r,n)){const a=lt(h,o),c=It(r,n);return gr(t,e,s,a,c)}else{const a=Yn(h,o),c=Lr[a],d=s.direction[c]>=0;let E,l;d?(E=ut(h),l=pt(h,o)):(E=pt(h,o),l=ut(h));const u=Gt(E,i,s,sn)?ii(E,t,e,s):null;if(u){const C=u.point[c];if(d?C<=i[l+a]:C>=i[l+a+3])return u}const T=Gt(l,i,s,sn)?ii(l,t,e,s):null;return u&&T?u.distance<=T.distance?u:T:u||T||null}}const is=new st,ne=new gt,oe=new gt,Se=new X,nn=new at,ns=new at;function Mr(h,t,e,s){Z.setBuffer(h._roots[t]);const i=ni(0,h,e,s);return Z.clearBuffer(),i}function ni(h,t,e,s,i=null){const{float32Array:n,uint16Array:o,uint32Array:r}=Z;let a=h*2;if(i===null&&(e.boundingBox||e.computeBoundingBox(),nn.set(e.boundingBox.min,e.boundingBox.max,s),i=nn),ct(a,o)){const c=t.geometry,d=c.index,E=c.attributes.position,l=e.index,u=e.attributes.position,T=lt(h,r),C=It(a,o);if(Se.copy(s).invert(),e.boundsTree)return j(h,n,ns),ns.matrix.copy(Se),ns.needsUpdate=!0,e.boundsTree.shapecast({intersectsBounds:f=>ns.intersectsBox(f),intersectsTriangle:f=>{f.a.applyMatrix4(s),f.b.applyMatrix4(s),f.c.applyMatrix4(s),f.needsUpdate=!0;for(let m=T*3,R=(C+T)*3;m<R;m+=3)if($(oe,m,d,E),oe.needsUpdate=!0,f.intersectsTriangle(oe))return!0;return!1}});for(let f=T*3,m=(C+T)*3;f<m;f+=3){$(ne,f,d,E),ne.a.applyMatrix4(Se),ne.b.applyMatrix4(Se),ne.c.applyMatrix4(Se),ne.needsUpdate=!0;for(let R=0,F=l.count;R<F;R+=3)if($(oe,R,l,u),oe.needsUpdate=!0,ne.intersectsTriangle(oe))return!0}}else{const c=h+8,d=r[h+6];return j(c,n,is),!!(i.intersectsBox(is)&&ni(c,t,e,s,i)||(j(d,n,is),i.intersectsBox(is)&&ni(d,t,e,s,i)))}}const os=new X,Bs=new at,Ne=new at,Ur=new O,Dr=new O,xr=new O,br=new O;function vr(h,t,e,s={},i={},n=0,o=1/0){t.boundingBox||t.computeBoundingBox(),Bs.set(t.boundingBox.min,t.boundingBox.max,e),Bs.needsUpdate=!0;const r=h.geometry,a=r.attributes.position,c=r.index,d=t.attributes.position,E=t.index,l=Et.getPrimitive(),u=Et.getPrimitive();let T=Ur,C=Dr,f=null,m=null;i&&(f=xr,m=br);let R=1/0,F=null,p=null;return os.copy(e).invert(),Ne.matrix.copy(os),h.shapecast({boundsTraverseOrder:A=>Bs.distanceToBox(A),intersectsBounds:(A,g,_)=>_<R&&_<o?(g&&(Ne.min.copy(A.min),Ne.max.copy(A.max),Ne.needsUpdate=!0),!0):!1,intersectsRange:(A,g)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:_=>Ne.distanceToBox(_),intersectsBounds:(_,S,w)=>w<R&&w<o,intersectsRange:(_,S)=>{for(let w=_,y=_+S;w<y;w++){$(u,3*w,E,d),u.a.applyMatrix4(e),u.b.applyMatrix4(e),u.c.applyMatrix4(e),u.needsUpdate=!0;for(let L=A,P=A+g;L<P;L++){$(l,3*L,c,a),l.needsUpdate=!0;const U=l.distanceToTriangle(u,T,f);if(U<R&&(C.copy(T),m&&m.copy(f),R=U,F=L,p=w),U<n)return!0}}}});{const _=Re(t);for(let S=0,w=_;S<w;S++){$(u,3*S,E,d),u.a.applyMatrix4(e),u.b.applyMatrix4(e),u.c.applyMatrix4(e),u.needsUpdate=!0;for(let y=A,L=A+g;y<L;y++){$(l,3*y,c,a),l.needsUpdate=!0;const P=l.distanceToTriangle(u,T,f);if(P<R&&(C.copy(T),m&&m.copy(f),R=P,F=y,p=S),P<n)return!0}}}}}),Et.releasePrimitive(l),Et.releasePrimitive(u),R===1/0?null:(s.point?s.point.copy(C):s.point=C.clone(),s.distance=R,s.faceIndex=F,i&&(i.point?i.point.copy(m):i.point=m.clone(),i.point.applyMatrix4(os),C.applyMatrix4(os),i.distance=C.sub(i.point).length(),i.faceIndex=p),s)}function Br(h,t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=h.geometry,s=e.index?e.index.array:null,i=e.attributes.position;let n,o,r,a,c=0;const d=h._roots;for(let l=0,u=d.length;l<u;l++)n=d[l],o=new Uint32Array(n),r=new Uint16Array(n),a=new Float32Array(n),E(0,c),c+=n.byteLength;function E(l,u,T=!1){const C=l*2;if(r[C+15]===Ns){const f=o[l+6],m=r[C+14];let R=1/0,F=1/0,p=1/0,A=-1/0,g=-1/0,_=-1/0;for(let S=f,w=f+m;S<w;S++){const y=3*h.resolveTriangleIndex(S);for(let L=0;L<3;L++){let P=y+L;P=s?s[P]:P;const U=i.getX(P),x=i.getY(P),Y=i.getZ(P);U<R&&(R=U),U>A&&(A=U),x<F&&(F=x),x>g&&(g=x),Y<p&&(p=Y),Y>_&&(_=Y)}}return a[l+0]!==R||a[l+1]!==F||a[l+2]!==p||a[l+3]!==A||a[l+4]!==g||a[l+5]!==_?(a[l+0]=R,a[l+1]=F,a[l+2]=p,a[l+3]=A,a[l+4]=g,a[l+5]=_,!0):!1}else{const f=l+8,m=o[l+6],R=f+u,F=m+u;let p=T,A=!1,g=!1;t?p||(A=t.has(R),g=t.has(F),p=!A&&!g):(A=!0,g=!0);const _=p||A,S=p||g;let w=!1;_&&(w=E(f,u,p));let y=!1;S&&(y=E(m,u,p));const L=w||y;if(L)for(let P=0;P<3;P++){const U=f+P,x=m+P,Y=a[U],z=a[U+3],tt=a[x],H=a[x+3];a[l+P]=Y<tt?Y:tt,a[l+P+3]=z>H?z:H}return L}}}const on=new O;function Yr(h,t,e,s,i){Z.setBuffer(h._roots[t]),oi(0,h,e,s,i),Z.clearBuffer()}function oi(h,t,e,s,i){const{float32Array:n,uint16Array:o,uint32Array:r}=Z,a=h*2;if(ct(a,o)){const c=lt(h,r),d=It(a,o);Sr(t,e,s,c,d,i)}else{const c=ut(h);Gt(c,n,s,on)&&oi(c,t,e,s,i);const d=pt(h,r);Gt(d,n,s,on)&&oi(d,t,e,s,i)}}const rn=new O,zr=["x","y","z"];function Gr(h,t,e,s){Z.setBuffer(h._roots[t]);const i=ri(0,h,e,s);return Z.clearBuffer(),i}function ri(h,t,e,s){const{float32Array:i,uint16Array:n,uint32Array:o}=Z;let r=h*2;if(ct(r,n)){const a=lt(h,o),c=It(r,n);return Nr(t,e,s,a,c)}else{const a=Yn(h,o),c=zr[a],d=s.direction[c]>=0;let E,l;d?(E=ut(h),l=pt(h,o)):(E=pt(h,o),l=ut(h));const u=Gt(E,i,s,rn)?ri(E,t,e,s):null;if(u){const C=u.point[c];if(d?C<=i[l+a]:C>=i[l+a+3])return u}const T=Gt(l,i,s,rn)?ri(l,t,e,s):null;return u&&T?u.distance<=T.distance?u:T:u||T||null}}const rs=new st,re=new gt,ae=new gt,we=new X,an=new at,as=new at;function Vr(h,t,e,s){Z.setBuffer(h._roots[t]);const i=ai(0,h,e,s);return Z.clearBuffer(),i}function ai(h,t,e,s,i=null){const{float32Array:n,uint16Array:o,uint32Array:r}=Z;let a=h*2;if(i===null&&(e.boundingBox||e.computeBoundingBox(),an.set(e.boundingBox.min,e.boundingBox.max,s),i=an),ct(a,o)){const c=t.geometry,d=c.index,E=c.attributes.position,l=e.index,u=e.attributes.position,T=lt(h,r),C=It(a,o);if(we.copy(s).invert(),e.boundsTree)return j(h,n,as),as.matrix.copy(we),as.needsUpdate=!0,e.boundsTree.shapecast({intersectsBounds:f=>as.intersectsBox(f),intersectsTriangle:f=>{f.a.applyMatrix4(s),f.b.applyMatrix4(s),f.c.applyMatrix4(s),f.needsUpdate=!0;for(let m=T,R=C+T;m<R;m++)if($(ae,3*t.resolveTriangleIndex(m),d,E),ae.needsUpdate=!0,f.intersectsTriangle(ae))return!0;return!1}});for(let f=T,m=C+T;f<m;f++){const R=t.resolveTriangleIndex(f);$(re,3*R,d,E),re.a.applyMatrix4(we),re.b.applyMatrix4(we),re.c.applyMatrix4(we),re.needsUpdate=!0;for(let F=0,p=l.count;F<p;F+=3)if($(ae,F,l,u),ae.needsUpdate=!0,re.intersectsTriangle(ae))return!0}}else{const c=h+8,d=r[h+6];return j(c,n,rs),!!(i.intersectsBox(rs)&&ai(c,t,e,s,i)||(j(d,n,rs),i.intersectsBox(rs)&&ai(d,t,e,s,i)))}}const hs=new X,Ys=new at,ye=new at,Hr=new O,kr=new O,Wr=new O,Xr=new O;function Zr(h,t,e,s={},i={},n=0,o=1/0){t.boundingBox||t.computeBoundingBox(),Ys.set(t.boundingBox.min,t.boundingBox.max,e),Ys.needsUpdate=!0;const r=h.geometry,a=r.attributes.position,c=r.index,d=t.attributes.position,E=t.index,l=Et.getPrimitive(),u=Et.getPrimitive();let T=Hr,C=kr,f=null,m=null;i&&(f=Wr,m=Xr);let R=1/0,F=null,p=null;return hs.copy(e).invert(),ye.matrix.copy(hs),h.shapecast({boundsTraverseOrder:A=>Ys.distanceToBox(A),intersectsBounds:(A,g,_)=>_<R&&_<o?(g&&(ye.min.copy(A.min),ye.max.copy(A.max),ye.needsUpdate=!0),!0):!1,intersectsRange:(A,g)=>{if(t.boundsTree){const _=t.boundsTree;return _.shapecast({boundsTraverseOrder:S=>ye.distanceToBox(S),intersectsBounds:(S,w,y)=>y<R&&y<o,intersectsRange:(S,w)=>{for(let y=S,L=S+w;y<L;y++){const P=_.resolveTriangleIndex(y);$(u,3*P,E,d),u.a.applyMatrix4(e),u.b.applyMatrix4(e),u.c.applyMatrix4(e),u.needsUpdate=!0;for(let U=A,x=A+g;U<x;U++){const Y=h.resolveTriangleIndex(U);$(l,3*Y,c,a),l.needsUpdate=!0;const z=l.distanceToTriangle(u,T,f);if(z<R&&(C.copy(T),m&&m.copy(f),R=z,F=U,p=y),z<n)return!0}}}})}else{const _=Re(t);for(let S=0,w=_;S<w;S++){$(u,3*S,E,d),u.a.applyMatrix4(e),u.b.applyMatrix4(e),u.c.applyMatrix4(e),u.needsUpdate=!0;for(let y=A,L=A+g;y<L;y++){const P=h.resolveTriangleIndex(y);$(l,3*P,c,a),l.needsUpdate=!0;const U=l.distanceToTriangle(u,T,f);if(U<R&&(C.copy(T),m&&m.copy(f),R=U,F=y,p=S),U<n)return!0}}}}}),Et.releasePrimitive(l),Et.releasePrimitive(u),R===1/0?null:(s.point?s.point.copy(C):s.point=C.clone(),s.distance=R,s.faceIndex=F,i&&(i.point?i.point.copy(m):i.point=m.clone(),i.point.applyMatrix4(hs),C.applyMatrix4(hs),i.distance=C.sub(i.point).length(),i.faceIndex=p),s)}function Qr(){return typeof SharedArrayBuffer<"u"}const Ye=new Z.constructor,gs=new Z.constructor,vt=new Pi(()=>new st),he=new st,ce=new st,zs=new st,Gs=new st;let Vs=!1;function jr(h,t,e,s){if(Vs)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");Vs=!0;const i=h._roots,n=t._roots;let o,r=0,a=0;const c=new X().copy(e).invert();for(let d=0,E=i.length;d<E;d++){Ye.setBuffer(i[d]),a=0;const l=vt.getPrimitive();j(0,Ye.float32Array,l),l.applyMatrix4(c);for(let u=0,T=n.length;u<T&&(gs.setBuffer(n[d]),o=Ct(0,0,e,c,s,r,a,0,0,l),gs.clearBuffer(),a+=n[u].length,!o);u++);if(vt.releasePrimitive(l),Ye.clearBuffer(),r+=i[d].length,o)break}return Vs=!1,o}function Ct(h,t,e,s,i,n=0,o=0,r=0,a=0,c=null,d=!1){let E,l;d?(E=gs,l=Ye):(E=Ye,l=gs);const u=E.float32Array,T=E.uint32Array,C=E.uint16Array,f=l.float32Array,m=l.uint32Array,R=l.uint16Array,F=h*2,p=t*2,A=ct(F,C),g=ct(p,R);let _=!1;if(g&&A)d?_=i(lt(t,m),It(t*2,R),lt(h,T),It(h*2,C),a,o+t,r,n+h):_=i(lt(h,T),It(h*2,C),lt(t,m),It(t*2,R),r,n+h,a,o+t);else if(g){const S=vt.getPrimitive();j(t,f,S),S.applyMatrix4(e);const w=ut(h),y=pt(h,T);j(w,u,he),j(y,u,ce);const L=S.intersectsBox(he),P=S.intersectsBox(ce);_=L&&Ct(t,w,s,e,i,o,n,a,r+1,S,!d)||P&&Ct(t,y,s,e,i,o,n,a,r+1,S,!d),vt.releasePrimitive(S)}else{const S=ut(t),w=pt(t,m);j(S,f,zs),j(w,f,Gs);const y=c.intersectsBox(zs),L=c.intersectsBox(Gs);if(y&&L)_=Ct(h,S,e,s,i,n,o,r,a+1,c,d)||Ct(h,w,e,s,i,n,o,r,a+1,c,d);else if(y)if(A)_=Ct(h,S,e,s,i,n,o,r,a+1,c,d);else{const P=vt.getPrimitive();P.copy(zs).applyMatrix4(e);const U=ut(h),x=pt(h,T);j(U,u,he),j(x,u,ce);const Y=P.intersectsBox(he),z=P.intersectsBox(ce);_=Y&&Ct(S,U,s,e,i,o,n,a,r+1,P,!d)||z&&Ct(S,x,s,e,i,o,n,a,r+1,P,!d),vt.releasePrimitive(P)}else if(L)if(A)_=Ct(h,w,e,s,i,n,o,r,a+1,c,d);else{const P=vt.getPrimitive();P.copy(Gs).applyMatrix4(e);const U=ut(h),x=pt(h,T);j(U,u,he),j(x,u,ce);const Y=P.intersectsBox(he),z=P.intersectsBox(ce);_=Y&&Ct(w,U,s,e,i,o,n,a,r+1,P,!d)||z&&Ct(w,x,s,e,i,o,n,a,r+1,P,!d),vt.releasePrimitive(P)}}return _}const cs=new at,hn=new st;class Mi{static serialize(t,e={}){e={cloneBuffers:!0,...e};const s=t.geometry,i=t._roots,n=t._indirectBuffer,o=s.getIndex();let r;return e.cloneBuffers?r={roots:i.map(a=>a.slice()),index:o.array.slice(),indirectBuffer:n?n.slice():null}:r={roots:i,index:o.array,indirectBuffer:n},r}static deserialize(t,e,s={}){s={setIndex:!0,indirect:!!t.indirectBuffer,...s};const{index:i,roots:n,indirectBuffer:o}=t,r=new Mi(e,{...s,[Ds]:!0});if(r._roots=n,r._indirectBuffer=o||null,s.setIndex){const a=e.getIndex();if(a===null){const c=new Ve(t.index,1,!1);e.setIndex(c)}else a.array!==i&&(a.array.set(i),a.needsUpdate=!0)}return r}get indirect(){return!!this._indirectBuffer}constructor(t,e={}){if(t.isBufferGeometry){if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e=Object.assign({strategy:bn,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[Ds]:!1},e),e.useSharedArrayBuffer&&!Qr())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=t,this._roots=null,this._indirectBuffer=null,e[Ds]||(Er(this,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new st)));const{_indirectBuffer:s}=this;this.resolveTriangleIndex=e.indirect?i=>s[i]:i=>i}refit(t=null){return(this.indirect?Br:_r)(this,t)}traverse(t,e=0){const s=this._roots[e],i=new Uint32Array(s),n=new Uint16Array(s);o(0);function o(r,a=0){const c=r*2,d=n[c+15]===Ns;if(d){const E=i[r+6],l=n[c+14];t(a,d,new Float32Array(s,r*4,6),E,l)}else{const E=r+ms/4,l=i[r+6],u=i[r+7];t(a,d,new Float32Array(s,r*4,6),u)||(o(E,a+1),o(l,a+1))}}}raycast(t,e=Wi){const s=this._roots,i=this.geometry,n=[],o=e.isMaterial,r=Array.isArray(e),a=i.groups,c=o?e.side:e,d=this.indirect?Yr:yr;for(let E=0,l=s.length;E<l;E++){const u=r?e[a[E].materialIndex].side:c,T=n.length;if(d(this,E,u,t,n),r){const C=a[E].materialIndex;for(let f=T,m=n.length;f<m;f++)n[f].face.materialIndex=C}}return n}raycastFirst(t,e=Wi){const s=this._roots,i=this.geometry,n=e.isMaterial,o=Array.isArray(e);let r=null;const a=i.groups,c=n?e.side:e,d=this.indirect?Gr:Pr;for(let E=0,l=s.length;E<l;E++){const u=o?e[a[E].materialIndex].side:c,T=d(this,E,u,t);T!=null&&(r==null||T.distance<r.distance)&&(r=T,o&&(T.face.materialIndex=a[E].materialIndex))}return r}intersectsGeometry(t,e){let s=!1;const i=this._roots,n=this.indirect?Vr:Mr;for(let o=0,r=i.length;o<r&&(s=n(this,o,t,e),!s);o++);return s}shapecast(t){const e=Et.getPrimitive(),s=this.indirect?wr:Or;let{boundsTraverseOrder:i,intersectsBounds:n,intersectsRange:o,intersectsTriangle:r}=t;if(o&&r){const E=o;o=(l,u,T,C,f)=>E(l,u,T,C,f)?!0:s(l,u,this,r,T,C,e)}else o||(r?o=(E,l,u,T)=>s(E,l,this,r,u,T,e):o=(E,l,u)=>u);let a=!1,c=0;const d=this._roots;for(let E=0,l=d.length;E<l;E++){const u=d[E];if(a=mr(this,E,n,o,i,c),a)break;c+=u.byteLength}return Et.releasePrimitive(e),a}bvhcast(t,e,s){let{intersectsRanges:i,intersectsTriangles:n}=s;const o=Et.getPrimitive(),r=this.geometry.index,a=this.geometry.attributes.position,c=this.indirect?T=>{const C=this.resolveTriangleIndex(T);$(o,C*3,r,a)}:T=>{$(o,T*3,r,a)},d=Et.getPrimitive(),E=t.geometry.index,l=t.geometry.attributes.position,u=t.indirect?T=>{const C=t.resolveTriangleIndex(T);$(d,C*3,E,l)}:T=>{$(d,T*3,E,l)};if(n){const T=(C,f,m,R,F,p,A,g)=>{for(let _=m,S=m+R;_<S;_++){u(_),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let w=C,y=C+f;w<y;w++)if(c(w),o.needsUpdate=!0,n(o,d,w,_,F,p,A,g))return!0}return!1};if(i){const C=i;i=function(f,m,R,F,p,A,g,_){return C(f,m,R,F,p,A,g,_)?!0:T(f,m,R,F,p,A,g,_)}}else i=T}return jr(this,t,e,i)}intersectsBox(t,e){return cs.set(t.min,t.max,e),cs.needsUpdate=!0,this.shapecast({intersectsBounds:s=>cs.intersectsBox(s),intersectsTriangle:s=>cs.intersectsTriangle(s)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e,s={},i={},n=0,o=1/0){return(this.indirect?Zr:vr)(this,t,e,s,i,n,o)}closestPointToPoint(t,e={},s=0,i=1/0){return fr(this,t,e,s,i)}getBoundingBox(t){return t.makeEmpty(),this._roots.forEach(e=>{j(0,new Float32Array(e),hn),t.union(hn)}),t}}function cn(h,t,e){return h===null||(h.point.applyMatrix4(t.matrixWorld),h.distance=h.point.distanceTo(e.ray.origin),h.object=t,h.distance<e.near||h.distance>e.far)?null:h}const Hs=new ko,ln=new X,qr=D.prototype.raycast;function Kr(h,t){if(this.geometry.boundsTree){if(this.material===void 0)return;ln.copy(this.matrixWorld).invert(),Hs.copy(h.ray).applyMatrix4(ln);const e=this.geometry.boundsTree;if(h.firstHitOnly===!0){const s=cn(e.raycastFirst(Hs,this.material),this,h);s&&t.push(s)}else{const s=e.raycast(Hs,this.material);for(let i=0,n=s.length;i<n;i++){const o=cn(s[i],this,h);o&&t.push(o)}}}else qr.call(this,h,t)}function $r(h){return this.boundsTree=new Mi(this,h),this.boundsTree}function Jr(){this.boundsTree=null}class M{constructor(){I(this,"trigger",t=>{const e=this.handlers.slice(0);for(const s of e)s(t)}),I(this,"handlers",[])}add(t){this.handlers.push(t)}remove(t){this.handlers=this.handlers.filter(e=>e!==t)}reset(){this.handlers.length=0}}class Kt{constructor(){I(this,"trigger",async t=>{const e=this.handlers.slice(0);for(const s of e)await s(t)}),I(this,"handlers",[])}add(t){this.handlers.push(t)}remove(t){this.handlers=this.handlers.filter(e=>e!==t)}reset(){this.handlers.length=0}}class Ui{constructor(t){I(this,"isDisposeable",()=>"dispose"in this&&"onDisposed"in this),I(this,"isResizeable",()=>"resize"in this&&"getSize"in this),I(this,"isUpdateable",()=>"onAfterUpdate"in this&&"onBeforeUpdate"in this&&"update"in this),I(this,"isHideable",()=>"visible"in this),I(this,"isConfigurable",()=>"setup"in this&&"config"in this&&"onSetup"in this),this.components=t}}class q extends Ui{}class Di extends Ui{constructor(t){super(t),I(this,"worlds",new Map),I(this,"onWorldChanged",new M),I(this,"currentWorld",null),this.onWorldChanged.add(({world:e,action:s})=>{s==="removed"&&this.worlds.delete(e.uuid)})}}class ta extends Di{constructor(){super(...arguments),I(this,"hasCameraControls",()=>"controls"in this)}}class ea extends Di{constructor(){super(...arguments),I(this,"onAfterUpdate",new M),I(this,"onBeforeUpdate",new M),I(this,"onDisposed",new M),I(this,"onResize",new M),I(this,"onClippingPlanesUpdated",new M),I(this,"clippingPlanes",[])}updateClippingPlanes(){this.onClippingPlanesUpdated.trigger()}setPlane(t,e,s){e.isLocal=s;const i=this.clippingPlanes.indexOf(e);t&&i===-1?this.clippingPlanes.push(e):!t&&i>-1&&this.clippingPlanes.splice(i,1),this.three.clippingPlanes=this.clippingPlanes.filter(n=>!n.isLocal)}}const zn=class hi extends q{constructor(t){super(t),I(this,"_disposedComponents",new Set),I(this,"enabled",!0),t.add(hi.uuid,this)}get(){return this._disposedComponents}destroy(t,e=!0,s=!0){t.removeFromParent();const i=t;i.dispose&&i.dispose(),this.disposeGeometryAndMaterials(t,e),s&&i.children&&i.children.length&&this.disposeChildren(i),t.children.length=0}disposeGeometry(t){const e=t;e.boundsTree&&e.disposeBoundsTree(),t.dispose()}disposeGeometryAndMaterials(t,e){const s=t;s.geometry&&this.disposeGeometry(s.geometry),e&&s.material&&hi.disposeMaterial(s),s.material=[],s.geometry=null}disposeChildren(t){for(const e of t.children)this.destroy(e)}static disposeMaterial(t){if(t.material)if(Array.isArray(t.material))for(const e of t.material)e.dispose();else t.material.dispose()}};I(zn,"uuid","76e9cd8e-ad8f-4753-9ef6-cbc60f7247fe");let me=zn;class sa extends Di{constructor(t){super(t),I(this,"onDisposed",new M)}dispose(){const t=this.components.get(me);for(const e of this.three.children){const s=e;s.geometry&&t.destroy(s)}this.three.children=[],this.onDisposed.trigger(),this.onDisposed.reset()}}const fs=0,ia=1,na=new O,dn=new At,ks=new fe,En=new O,ls=new pe;class oa{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new In,this.unassigned=new In,this.vertices=[]}setFromPoints(t){if(t.length>=4){this.makeEmpty();for(let e=0,s=t.length;e<s;e++)this.vertices.push(new ra(t[e]));this.compute()}return this}setFromObject(t){const e=[];return t.updateMatrixWorld(!0),t.traverse(function(s){const i=s.geometry;if(i!==void 0){const n=i.attributes.position;if(n!==void 0)for(let o=0,r=n.count;o<r;o++){const a=new O;a.fromBufferAttribute(n,o).applyMatrix4(s.matrixWorld),e.push(a)}}}),this.setFromPoints(e)}containsPoint(t){const e=this.faces;for(let s=0,i=e.length;s<i;s++)if(e[s].distanceToPoint(t)>this.tolerance)return!1;return!0}intersectRay(t,e){const s=this.faces;let i=-1/0,n=1/0;for(let o=0,r=s.length;o<r;o++){const a=s[o],c=a.distanceToPoint(t.origin),d=a.normal.dot(t.direction);if(c>0&&d>=0)return null;const E=d!==0?-c/d:0;if(!(E<=0)&&(d>0?n=Math.min(E,n):i=Math.max(E,i),i>n))return null}return i!==-1/0?t.at(i,e):t.at(n,e),e}intersectsRay(t){return this.intersectRay(t,na)!==null}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(t,e){return t.face=e,e.outside===null?this.assigned.append(t):this.assigned.insertBefore(e.outside,t),e.outside=t,this}removeVertexFromFace(t,e){return t===e.outside&&(t.next!==null&&t.next.face===e?e.outside=t.next:e.outside=null),this.assigned.remove(t),this}removeAllVerticesFromFace(t){if(t.outside!==null){const e=t.outside;let s=t.outside;for(;s.next!==null&&s.next.face===t;)s=s.next;return this.assigned.removeSubList(e,s),e.prev=s.next=null,t.outside=null,e}}deleteFaceVertices(t,e){const s=this.removeAllVerticesFromFace(t);if(s!==void 0)if(e===void 0)this.unassigned.appendChain(s);else{let i=s;do{const n=i.next;e.distanceToPoint(i.point)>this.tolerance?this.addVertexToFace(i,e):this.unassigned.append(i),i=n}while(i!==null)}return this}resolveUnassignedPoints(t){if(this.unassigned.isEmpty()===!1){let e=this.unassigned.first();do{const s=e.next;let i=this.tolerance,n=null;for(let o=0;o<t.length;o++){const r=t[o];if(r.mark===fs){const a=r.distanceToPoint(e.point);if(a>i&&(i=a,n=r),i>1e3*this.tolerance)break}}n!==null&&this.addVertexToFace(e,n),e=s}while(e!==null)}return this}computeExtremes(){const t=new O,e=new O,s=[],i=[];for(let n=0;n<3;n++)s[n]=i[n]=this.vertices[0];t.copy(this.vertices[0].point),e.copy(this.vertices[0].point);for(let n=0,o=this.vertices.length;n<o;n++){const r=this.vertices[n],a=r.point;for(let c=0;c<3;c++)a.getComponent(c)<t.getComponent(c)&&(t.setComponent(c,a.getComponent(c)),s[c]=r);for(let c=0;c<3;c++)a.getComponent(c)>e.getComponent(c)&&(e.setComponent(c,a.getComponent(c)),i[c]=r)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(t.x),Math.abs(e.x))+Math.max(Math.abs(t.y),Math.abs(e.y))+Math.max(Math.abs(t.z),Math.abs(e.z))),{min:s,max:i}}computeInitialHull(){const t=this.vertices,e=this.computeExtremes(),s=e.min,i=e.max;let n=0,o=0;for(let l=0;l<3;l++){const u=i[l].point.getComponent(l)-s[l].point.getComponent(l);u>n&&(n=u,o=l)}const r=s[o],a=i[o];let c,d;n=0,dn.set(r.point,a.point);for(let l=0,u=this.vertices.length;l<u;l++){const T=t[l];if(T!==r&&T!==a){dn.closestPointToPoint(T.point,!0,En);const C=En.distanceToSquared(T.point);C>n&&(n=C,c=T)}}n=-1,ks.setFromCoplanarPoints(r.point,a.point,c.point);for(let l=0,u=this.vertices.length;l<u;l++){const T=t[l];if(T!==r&&T!==a&&T!==c){const C=Math.abs(ks.distanceToPoint(T.point));C>n&&(n=C,d=T)}}const E=[];if(ks.distanceToPoint(d.point)<0){E.push(mt.create(r,a,c),mt.create(d,a,r),mt.create(d,c,a),mt.create(d,r,c));for(let l=0;l<3;l++){const u=(l+1)%3;E[l+1].getEdge(2).setTwin(E[0].getEdge(u)),E[l+1].getEdge(1).setTwin(E[u+1].getEdge(0))}}else{E.push(mt.create(r,c,a),mt.create(d,r,a),mt.create(d,a,c),mt.create(d,c,r));for(let l=0;l<3;l++){const u=(l+1)%3;E[l+1].getEdge(2).setTwin(E[0].getEdge((3-l)%3)),E[l+1].getEdge(0).setTwin(E[u+1].getEdge(1))}}for(let l=0;l<4;l++)this.faces.push(E[l]);for(let l=0,u=t.length;l<u;l++){const T=t[l];if(T!==r&&T!==a&&T!==c&&T!==d){n=this.tolerance;let C=null;for(let f=0;f<4;f++){const m=this.faces[f].distanceToPoint(T.point);m>n&&(n=m,C=this.faces[f])}C!==null&&this.addVertexToFace(T,C)}}return this}reindexFaces(){const t=[];for(let e=0;e<this.faces.length;e++){const s=this.faces[e];s.mark===fs&&t.push(s)}return this.faces=t,this}nextVertexToAdd(){if(this.assigned.isEmpty()===!1){let t,e=0;const s=this.assigned.first().face;let i=s.outside;do{const n=s.distanceToPoint(i.point);n>e&&(e=n,t=i),i=i.next}while(i!==null&&i.face===s);return t}}computeHorizon(t,e,s,i){this.deleteFaceVertices(s),s.mark=ia;let n;e===null?n=e=s.getEdge(0):n=e.next;do{const o=n.twin,r=o.face;r.mark===fs&&(r.distanceToPoint(t)>this.tolerance?this.computeHorizon(t,o,r,i):i.push(n)),n=n.next}while(n!==e);return this}addAdjoiningFace(t,e){const s=mt.create(t,e.tail(),e.head());return this.faces.push(s),s.getEdge(-1).setTwin(e.twin),s.getEdge(0)}addNewFaces(t,e){this.newFaces=[];let s=null,i=null;for(let n=0;n<e.length;n++){const o=e[n],r=this.addAdjoiningFace(t,o);s===null?s=r:r.next.setTwin(i),this.newFaces.push(r.face),i=r}return s.next.setTwin(i),this}addVertexToHull(t){const e=[];return this.unassigned.clear(),this.removeVertexFromFace(t,t.face),this.computeHorizon(t.point,null,t.face,e),this.addNewFaces(t,e),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let t;for(this.computeInitialHull();(t=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(t);return this.reindexFaces(),this.cleanup(),this}}class mt{constructor(){this.normal=new O,this.midpoint=new O,this.area=0,this.constant=0,this.outside=null,this.mark=fs,this.edge=null}static create(t,e,s){const i=new mt,n=new Ws(t,i),o=new Ws(e,i),r=new Ws(s,i);return n.next=r.prev=o,o.next=n.prev=r,r.next=o.prev=n,i.edge=n,i.compute()}getEdge(t){let e=this.edge;for(;t>0;)e=e.next,t--;for(;t<0;)e=e.prev,t++;return e}compute(){const t=this.edge.tail(),e=this.edge.head(),s=this.edge.next.head();return ls.set(t.point,e.point,s.point),ls.getNormal(this.normal),ls.getMidpoint(this.midpoint),this.area=ls.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(t){return this.normal.dot(t)-this.constant}}class Ws{constructor(t,e){this.vertex=t,this.prev=null,this.next=null,this.twin=null,this.face=e}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const t=this.head(),e=this.tail();return e!==null?e.point.distanceTo(t.point):-1}lengthSquared(){const t=this.head(),e=this.tail();return e!==null?e.point.distanceToSquared(t.point):-1}setTwin(t){return this.twin=t,t.twin=this,this}}class ra{constructor(t){this.point=t,this.prev=null,this.next=null,this.face=null}}class In{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(t,e){return e.prev=t.prev,e.next=t,e.prev===null?this.head=e:e.prev.next=e,t.prev=e,this}insertAfter(t,e){return e.prev=t,e.next=t.next,e.next===null?this.tail=e:e.next.prev=e,t.next=e,this}append(t){return this.head===null?this.head=t:this.tail.next=t,t.prev=this.tail,t.next=null,this.tail=t,this}appendChain(t){for(this.head===null?this.head=t:this.tail.next=t,t.prev=this.tail;t.next!==null;)t=t.next;return this.tail=t,this}remove(t){return t.prev===null?this.head=t.next:t.prev.next=t.next,t.next===null?this.tail=t.prev:t.next.prev=t.prev,this}removeSubList(t,e){return t.prev===null?this.head=e.next:t.prev.next=e.next,e.next===null?this.tail=t.prev:e.next.prev=t.prev,this}isEmpty(){return this.head===null}}const ci=[2,2,1],li=[1,0,0];function Nt(h,t){return h*3+t}function aa(h){const t=h.elements;let e=0;for(let s=0;s<9;s++)e+=t[s]*t[s];return Math.sqrt(e)}function ha(h){const t=h.elements;let e=0;for(let s=0;s<3;s++){const i=t[Nt(ci[s],li[s])];e+=2*i*i}return Math.sqrt(e)}function ca(h,t){let e=0,s=1;const i=h.elements;for(let c=0;c<3;c++){const d=Math.abs(i[Nt(ci[c],li[c])]);d>e&&(e=d,s=c)}let n=1,o=0;const r=li[s],a=ci[s];if(Math.abs(i[Nt(a,r)])>Number.EPSILON){const c=i[Nt(a,a)],d=i[Nt(r,r)],E=i[Nt(a,r)],l=(c-d)/2/E;let u;l<0?u=-1/(-l+Math.sqrt(1+l*l)):u=1/(l+Math.sqrt(1+l*l)),n=1/Math.sqrt(1+u*u),o=u*n}return t.identity(),t.elements[Nt(r,r)]=n,t.elements[Nt(a,a)]=n,t.elements[Nt(a,r)]=o,t.elements[Nt(r,a)]=-o,t}function la(h,t){let e=0,s=0;const i=10;t.unitary.identity(),t.diagonal.copy(h);const n=t.unitary,o=t.diagonal,r=new jt,a=new jt,c=Number.EPSILON*aa(o);for(;s<i&&ha(o)>c;)ca(o,r),a.copy(r).transpose(),o.multiply(r),o.premultiply(a),n.multiply(r),++e>2&&(s++,e=0);return t}function da(h){const t=[];for(let J=0;J<h.length-2;J+=3){const kt=h[J],K=h[J+1],Jt=h[J+2];t.push(new O(kt,K,Jt))}const e=new oa;e.setFromPoints(t);const s={unitary:new jt,diagonal:new jt},i=e.faces,n=[],o=[];for(let J=0,kt=i.length;J<kt;J++){const K=i[J];let Jt=K.edge;n.length=0;do n.push(Jt),Jt=Jt.next;while(Jt!==K.edge);const Ao=n.length-2;for(let Xe=1,Fo=Ao;Xe<=Fo;Xe++){const ys=n[0].vertex,Ls=n[Xe+0].vertex,Ps=n[Xe+1].vertex;o.push(ys.point.x,ys.point.y,ys.point.z),o.push(Ls.point.x,Ls.point.y,Ls.point.z),o.push(Ps.point.x,Ps.point.y,Ps.point.z)}}const r=new O,a=new O,c=new O,d=new O,E=new O,l=new O,u=new O,T=new O;let C=0,f=0,m=0,R=0,F=0,p=0,A=0;for(let J=0,kt=o.length;J<kt;J+=9){r.fromArray(o,J),a.fromArray(o,J+3),c.fromArray(o,J+6),u.set(0,0,0),u.add(r).add(a).add(c).divideScalar(3),d.subVectors(a,r),E.subVectors(c,r);const K=l.crossVectors(d,E).length()/2;T.add(l.copy(u).multiplyScalar(K)),C+=K,f+=(9*u.x*u.x+r.x*r.x+a.x*a.x+c.x*c.x)*(K/12),m+=(9*u.x*u.y+r.x*r.y+a.x*a.y+c.x*c.y)*(K/12),R+=(9*u.x*u.z+r.x*r.z+a.x*a.z+c.x*c.z)*(K/12),F+=(9*u.y*u.y+r.y*r.y+a.y*a.y+c.y*c.y)*(K/12),p+=(9*u.y*u.z+r.y*r.z+a.y*a.z+c.y*c.z)*(K/12),A+=(9*u.z*u.z+r.z*r.z+a.z*a.z+c.z*c.z)*(K/12)}T.divideScalar(C),f/=C,m/=C,R/=C,F/=C,p/=C,A/=C,f-=T.x*T.x,m-=T.x*T.y,R-=T.x*T.z,F-=T.y*T.y,p-=T.y*T.z,A-=T.z*T.z;const g=new jt;g.elements[0]=f,g.elements[1]=m,g.elements[2]=R,g.elements[3]=m,g.elements[4]=F,g.elements[5]=p,g.elements[6]=R,g.elements[7]=p,g.elements[8]=A,la(g,s);const _=s.unitary,S=new O,w=new O,y=new O;_.extractBasis(S,w,y);let L=-1/0,P=-1/0,U=-1/0,x=1/0,Y=1/0,z=1/0;for(let J=0,kt=t.length;J<kt;J++){const K=t[J];L=Math.max(S.dot(K),L),P=Math.max(w.dot(K),P),U=Math.max(y.dot(K),U),x=Math.min(S.dot(K),x),Y=Math.min(w.dot(K),Y),z=Math.min(y.dot(K),z)}S.multiplyScalar(.5*(x+L)),w.multiplyScalar(.5*(Y+P)),y.multiplyScalar(.5*(z+U));const tt=new O,H=new O,Mt=new jt;tt.add(S).add(w).add(y),H.x=L-x,H.y=P-Y,H.z=U-z,H.multiplyScalar(.5),Mt.copy(_);const{x:Vt,y:Ht,z:We}=H,Ae=new X;Ae.makeScale(Vt*2,Ht*2,We*2);const zi=new X;zi.makeTranslation(-Vt,-Ht,-We);const Gi=new X;Gi.makeTranslation(tt.x,tt.y,tt.z);const Vi=new X;Vi.setFromMatrix3(Mt);const Fe=new X;return Fe.multiply(Gi),Fe.multiply(Vi),Fe.multiply(zi),Fe.multiply(Ae),{center:tt,halfSizes:H,rotation:Mt,transformation:Fe}}function Ea(h,t,e){const s=[h[0]-t[0],h[1]-t[1],h[2]-t[2]];return e[0]*s[0]+e[1]*s[1]+e[2]*s[2]>0}class un{static isTransparent(t){return t.transparent&&t.opacity<1}}const di=class et{static create(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,s=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return`${et._lut[t&255]+et._lut[t>>8&255]+et._lut[t>>16&255]+et._lut[t>>24&255]}-${et._lut[e&255]}${et._lut[e>>8&255]}-${et._lut[e>>16&15|64]}${et._lut[e>>24&255]}-${et._lut[s&63|128]}${et._lut[s>>8&255]}-${et._lut[s>>16&255]}${et._lut[s>>24&255]}${et._lut[i&255]}${et._lut[i>>8&255]}${et._lut[i>>16&255]}${et._lut[i>>24&255]}`.toLowerCase()}static validate(t){if(!et._pattern.test(t))throw new Error(`${t} is not a valid UUID v4.

- If you're the tool creator, you can take one from https://www.uuidgenerator.net/.

- If you're using a platform tool, verify the uuid isn't misspelled or contact the tool creator.`)}};I(di,"_pattern",/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/),I(di,"_lut",["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"]);let xi=di;class th extends q{constructor(t,e){super(t),I(this,"onVertexFound",new M),I(this,"onVertexLost",new M),I(this,"components"),I(this,"_pickedPoint",null),I(this,"_config"),I(this,"_enabled",!1),I(this,"_workingPlane",null),this.components=t,this.config={snapDistance:.25,showOnlyVertex:!1,...e},this.enabled=!1}set enabled(t){this._enabled=t,t||(this._pickedPoint=null)}get enabled(){return this._enabled}set workingPlane(t){this._workingPlane=t}get workingPlane(){return this._workingPlane}set config(t){this._config={...this._config,...t}}get config(){return this._config}dispose(){this.onVertexFound.reset(),this.onVertexLost.reset(),this.components=null}get(t){if(!this.enabled)return this._pickedPoint;const e=this.components.get(Ei).get(t).castRay();if(!e)return this._pickedPoint!==null&&(this.onVertexLost.trigger(),this._pickedPoint=null),this._pickedPoint;const s=this.getClosestVertex(e);return s?!this.workingPlane||Math.abs(this.workingPlane.distanceToPoint(s))<.001?((this._pickedPoint===null||!this._pickedPoint.equals(s))&&(this._pickedPoint=s.clone(),this.onVertexFound.trigger(this._pickedPoint)),this._pickedPoint):(this._pickedPoint=null,this._pickedPoint):(this._pickedPoint!==null&&(this.onVertexLost.trigger(),this._pickedPoint=null),this._pickedPoint)}getClosestVertex(t){let e=new O,s=!1,i=Number.MAX_SAFE_INTEGER;const n=this.getVertices(t);return n==null||n.forEach(o=>{if(!o)return;const r=t.point.distanceTo(o);r>i||r>this._config.snapDistance||(s=!0,e=o,i=t.point.distanceTo(o))}),s?e:this.config.showOnlyVertex?null:t.point}getVertices(t){const e=t.object;if(!t.face||!e)return null;const s=e.geometry;return[this.getVertex(t.face.a,s),this.getVertex(t.face.b,s),this.getVertex(t.face.c,s)].map(i=>i==null?void 0:i.applyMatrix4(e.matrixWorld))}getVertex(t,e){if(t===void 0)return null;const s=e.attributes.position;return new O(s.getX(t),s.getY(t),s.getZ(t))}}const Gn=class Vn{constructor(){I(this,"onDisposed",new M),I(this,"list",new Map),I(this,"enabled",!1),I(this,"_clock"),I(this,"update",()=>{if(!this.enabled)return;const t=this._clock.getDelta();for(const[e,s]of this.list)s.enabled&&s.isUpdateable()&&s.update(t);requestAnimationFrame(this.update)}),this._clock=new Lo,Vn.setupBVH()}add(t,e){if(this.list.has(t))throw new Error("You're trying to add a component that already exists in the components intance. Use Components.get() instead.");xi.validate(t),this.list.set(t,e)}get(t){const e=t.uuid;if(!this.list.has(e)){const s=new t(this);return this.list.has(e)||this.add(e,s),s}return this.list.get(e)}init(){this.enabled=!0,this._clock.start(),this.update()}dispose(){this.enabled=!1;for(const[t,e]of this.list)e.enabled=!1,e.isDisposeable()&&e.dispose();this._clock.stop(),this.onDisposed.trigger(),this.onDisposed.reset()}static setupBVH(){ze.prototype.computeBoundsTree=$r,ze.prototype.disposeBoundsTree=Jr,D.prototype.raycast=Kr}};I(Gn,"release","1.4.21");let Ia=Gn;class ua{constructor(t){I(this,"_event"),I(this,"_position",new Ft),I(this,"onDisposed",new M),I(this,"updateMouseInfo",e=>{this._event=e}),this.dom=t,this.setupEvents(!0)}get position(){if(this._event){const t=this.dom.getBoundingClientRect();this._position.x=this.getPositionX(t,this._event),this._position.y=this.getPositionY(t,this._event)}return this._position}dispose(){this.setupEvents(!1),this.onDisposed.trigger(),this.onDisposed.reset()}getPositionY(t,e){return-((e.clientY-t.top)/(t.bottom-t.top))*2+1}getPositionX(t,e){return(e.clientX-t.left)/(t.right-t.left)*2-1}setupEvents(t){t?this.dom.addEventListener("mousemove",this.updateMouseInfo):this.dom.removeEventListener("mousemove",this.updateMouseInfo)}}class pa{constructor(t,e){I(this,"enabled",!0),I(this,"components"),I(this,"onDisposed",new M),I(this,"mouse"),I(this,"three",new Ti),I(this,"world");const s=e.renderer;if(!s)throw new Error("A renderer is needed for the raycaster to work!");this.world=e,this.mouse=new ua(s.three.domElement),this.components=t}dispose(){this.mouse.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}castRay(t=Array.from(this.world.meshes)){if(!this.world)throw new Error("A world is needed to cast rays!");const e=this.world.camera.three;return this.three.setFromCamera(this.mouse.position,e),this.intersect(t)}castRayFromVector(t,e,s=Array.from(this.world.meshes)){return this.three.set(t,e),this.intersect(s)}intersect(t=Array.from(this.world.meshes)){const e=this.three.intersectObjects(t),s=this.filterClippingPlanes(e);return s.length>0?s[0]:null}filterClippingPlanes(t){if(!this.world.renderer)throw new Error("Renderer not found!");const e=this.world.renderer.three;if(!e.clippingPlanes)return t;const s=e.clippingPlanes;return t.length<=0||!s||(s==null?void 0:s.length)<=0?t:t.filter(i=>s.every(n=>n.distanceToPoint(i.point)>0))}}const Hn=class kn extends q{constructor(t){super(t),I(this,"enabled",!0),I(this,"list",new Map),I(this,"onDisposed",new M),t.add(kn.uuid,this)}get(t){if(this.list.has(t.uuid))return this.list.get(t.uuid);const e=new pa(this.components,t);return this.list.set(t.uuid,e),t.onDisposed.add(()=>{this.delete(t)}),e}delete(t){const e=this.list.get(t.uuid);e&&e.dispose(),this.list.delete(t.uuid)}dispose(){for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger()}};I(Hn,"uuid","d5d8bdf0-db25-4952-b951-b643af207ace");let Ei=Hn;class Ca extends Ui{constructor(t){super(t),I(this,"meshes",new Set),I(this,"onAfterUpdate",new M),I(this,"onBeforeUpdate",new M),I(this,"enabled",!0),I(this,"uuid",xi.create()),I(this,"onDisposed",new M),I(this,"_scene"),I(this,"_camera"),I(this,"_renderer",null)}get scene(){if(!this._scene)throw new Error("No scene initialized!");return this._scene}set scene(t){this._scene=t,t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"})}get camera(){if(!this._camera)throw new Error("No camera initialized!");return this._camera}set camera(t){this._camera=t,t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"})}get renderer(){return this._renderer}set renderer(t){this._renderer=t,t&&(t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"}))}update(t){this.enabled&&(!this._scene||!this._camera||(this.scene.currentWorld=this,this.camera.currentWorld=this,this.renderer&&(this.renderer.currentWorld=this),this.onBeforeUpdate.trigger(),this.scene.isUpdateable()&&this.scene.update(t),this.camera.isUpdateable()&&this.camera.update(t),this.renderer&&this.renderer.update(t),this.onAfterUpdate.trigger()))}dispose(t=!0){if(this.enabled=!1,this.scene.onWorldChanged.trigger({world:this,action:"removed"}),this.camera.onWorldChanged.trigger({world:this,action:"removed"}),this.renderer&&this.renderer.onWorldChanged.trigger({world:this,action:"removed"}),t){const e=this.components.get(me);this.scene.dispose(),this.camera.isDisposeable()&&this.camera.dispose(),this.renderer&&this.renderer.dispose();for(const s of this.meshes)e.destroy(s);this.meshes.clear()}this._scene=null,this._camera=null,this._renderer=null,this.onDisposed.trigger()}}class eh extends sa{constructor(t){super(t),I(this,"isSetup",!1),I(this,"three"),I(this,"onSetup",new M),I(this,"config",{directionalLight:{color:new qt("white"),intensity:1.5,position:new O(5,10,3)},ambientLight:{color:new qt("white"),intensity:1}}),this.three=new mi,this.three.background=new qt(2107698)}setup(t){this.config={...this.config,...t};const e=new Oo(this.config.directionalLight.color,this.config.directionalLight.intensity);e.position.copy(this.config.directionalLight.position);const s=new _o(this.config.ambientLight.color,this.config.ambientLight.intensity);this.three.add(e,s),this.isSetup=!0,this.onSetup.trigger(this)}}class sh extends ea{constructor(t,e,s){super(t),I(this,"enabled",!0),I(this,"container"),I(this,"three"),I(this,"_canvas"),I(this,"_parameters"),I(this,"_resizeObserver",null),I(this,"onContainerUpdated",new M),I(this,"_resizing",!1),I(this,"resize",o=>{if(this._resizing)return;this._resizing=!0,this.onContainerUpdated.trigger();const r=o?o.x:this.container.clientWidth,a=o?o.y:this.container.clientHeight;this.three.setSize(r,a),this.onResize.trigger(new Ft(r,a)),this._resizing=!1}),I(this,"resizeEvent",()=>{this.resize()}),I(this,"onContextLost",o=>{o.preventDefault(),this.enabled=!1}),I(this,"onContextBack",()=>{this.three.setRenderTarget(null),this.three.dispose(),this.three=new As({canvas:this._canvas,antialias:!0,alpha:!0,...this._parameters}),this.enabled=!0}),this.container=e,this._parameters=s,this.three=new As({antialias:!0,alpha:!0,...s}),this.three.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.setupRenderer(),this.setupEvents(!0),this.resize(),this._canvas=this.three.domElement;const i=this.three.getContext(),{canvas:n}=i;n.addEventListener("webglcontextlost",this.onContextLost,!1),n.addEventListener("webglcontextrestored",this.onContextBack,!1)}update(){if(!this.enabled||!this.currentWorld)return;this.onBeforeUpdate.trigger(this);const t=this.currentWorld.scene.three,e=this.currentWorld.camera.three;this.three.render(t,e),this.onAfterUpdate.trigger(this)}dispose(){this.enabled=!1,this.setupEvents(!1),this.three.domElement.remove(),this.three.dispose(),this.onResize.reset(),this.onAfterUpdate.reset(),this.onBeforeUpdate.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}getSize(){return new Ft(this.three.domElement.clientWidth,this.three.domElement.clientHeight)}setupEvents(t){const e=this.three.domElement.parentElement;if(!e)throw new Error("This renderer needs to have an HTML container!");this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null),window.removeEventListener("resize",this.resizeEvent),t&&(this._resizeObserver=new ResizeObserver(this.resizeEvent),this._resizeObserver.observe(e),window.addEventListener("resize",this.resizeEvent))}setupRenderer(){this.three.localClippingEnabled=!0,this.container&&this.container.appendChild(this.three.domElement),this.onContainerUpdated.trigger()}}/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const v={LEFT:1,RIGHT:2,MIDDLE:4},N=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),le={NONE:0,IN:1,OUT:-1};function Wt(h){return h.isPerspectiveCamera}function bt(h){return h.isOrthographicCamera}const de=Math.PI*2,pn=Math.PI/2,Wn=1e-5,Le=Math.PI/180;function Tt(h,t,e){return Math.max(t,Math.min(e,h))}function W(h,t=Wn){return Math.abs(h)<t}function V(h,t,e=Wn){return W(h-t,e)}function Cn(h,t){return Math.round(h/t)*t}function Pe(h){return isFinite(h)?h:h<0?-Number.MAX_VALUE:Number.MAX_VALUE}function Me(h){return Math.abs(h)<Number.MAX_VALUE?h:h*(1/0)}function ds(h,t,e,s,i=1/0,n){s=Math.max(1e-4,s);const o=2/s,r=o*n,a=1/(1+r+.48*r*r+.235*r*r*r);let c=h-t;const d=t,E=i*s;c=Tt(c,-E,E),t=h-c;const l=(e.value+o*c)*n;e.value=(e.value-o*l)*a;let u=t+(c+l)*a;return d-h>0==u>d&&(u=d,e.value=(u-d)/n),u}function Tn(h,t,e,s,i=1/0,n,o){s=Math.max(1e-4,s);const r=2/s,a=r*n,c=1/(1+a+.48*a*a+.235*a*a*a);let d=t.x,E=t.y,l=t.z,u=h.x-d,T=h.y-E,C=h.z-l;const f=d,m=E,R=l,F=i*s,p=F*F,A=u*u+T*T+C*C;if(A>p){const Y=Math.sqrt(A);u=u/Y*F,T=T/Y*F,C=C/Y*F}d=h.x-u,E=h.y-T,l=h.z-C;const g=(e.x+r*u)*n,_=(e.y+r*T)*n,S=(e.z+r*C)*n;e.x=(e.x-r*g)*c,e.y=(e.y-r*_)*c,e.z=(e.z-r*S)*c,o.x=d+(u+g)*c,o.y=E+(T+_)*c,o.z=l+(C+S)*c;const w=f-h.x,y=m-h.y,L=R-h.z,P=o.x-f,U=o.y-m,x=o.z-R;return w*P+y*U+L*x>0&&(o.x=f,o.y=m,o.z=R,e.x=(o.x-f)/n,e.y=(o.y-m)/n,e.z=(o.z-R)/n),o}function Xs(h,t){t.set(0,0),h.forEach(e=>{t.x+=e.clientX,t.y+=e.clientY}),t.x/=h.length,t.y/=h.length}function Zs(h,t){return bt(h)?(console.warn(`${t} is not supported in OrthographicCamera`),!0):!1}class Ta{constructor(){this._listeners={}}addEventListener(t,e){const s=this._listeners;s[t]===void 0&&(s[t]=[]),s[t].indexOf(e)===-1&&s[t].push(e)}hasEventListener(t,e){const s=this._listeners;return s[t]!==void 0&&s[t].indexOf(e)!==-1}removeEventListener(t,e){const s=this._listeners[t];if(s!==void 0){const i=s.indexOf(e);i!==-1&&s.splice(i,1)}}removeAllEventListeners(t){if(!t){this._listeners={};return}Array.isArray(this._listeners[t])&&(this._listeners[t].length=0)}dispatchEvent(t){const e=this._listeners[t.type];if(e!==void 0){t.target=this;const s=e.slice(0);for(let i=0,n=s.length;i<n;i++)s[i].call(this,t)}}}const ma="2.7.3",Es=1/8,Xn=typeof window<"u",fa=Xn&&/Mac/.test(navigator.platform),Ra=!(Xn&&"PointerEvent"in window);let b,mn,Is,Qs,ht,B,G,Ee,Ue,Ot,_t,Xt,fn,Rn,dt,De,Ie,An,js,Fn,qs,Ks,us;class ot extends Ta{static install(t){b=t.THREE,mn=Object.freeze(new b.Vector3(0,0,0)),Is=Object.freeze(new b.Vector3(0,1,0)),Qs=Object.freeze(new b.Vector3(0,0,1)),ht=new b.Vector2,B=new b.Vector3,G=new b.Vector3,Ee=new b.Vector3,Ue=new b.Vector3,Ot=new b.Vector3,_t=new b.Vector3,Xt=new b.Vector3,fn=new b.Vector3,Rn=new b.Vector3,dt=new b.Spherical,De=new b.Spherical,Ie=new b.Box3,An=new b.Box3,js=new b.Sphere,Fn=new b.Quaternion,qs=new b.Quaternion,Ks=new b.Matrix4,us=new b.Raycaster}static get ACTION(){return N}constructor(t,e){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=N.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=le.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new b.Vector3,this._focalOffsetVelocity=new b.Vector3,this._zoomVelocity={value:0},this._truckInternal=(p,A,g)=>{let _,S;if(Wt(this._camera)){const w=B.copy(this._camera.position).sub(this._target),y=this._camera.getEffectiveFOV()*Le,L=w.length()*Math.tan(y*.5);_=this.truckSpeed*p*L/this._elementRect.height,S=this.truckSpeed*A*L/this._elementRect.height}else if(bt(this._camera)){const w=this._camera;_=p*(w.right-w.left)/w.zoom/this._elementRect.width,S=A*(w.top-w.bottom)/w.zoom/this._elementRect.height}else return;this.verticalDragToForward?(g?this.setFocalOffset(this._focalOffsetEnd.x+_,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(_,0,!0),this.forward(-S,!0)):g?this.setFocalOffset(this._focalOffsetEnd.x+_,this._focalOffsetEnd.y+S,this._focalOffsetEnd.z,!0):this.truck(_,S,!0)},this._rotateInternal=(p,A)=>{const g=de*this.azimuthRotateSpeed*p/this._elementRect.height,_=de*this.polarRotateSpeed*A/this._elementRect.height;this.rotate(g,_,!0)},this._dollyInternal=(p,A,g)=>{const _=Math.pow(.95,-p*this.dollySpeed),S=this._sphericalEnd.radius,w=this._sphericalEnd.radius*_,y=Tt(w,this.minDistance,this.maxDistance),L=y-w;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(w,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(L,!0),this._dollyToNoClamp(y,!0)):this._dollyToNoClamp(y,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?w:y)-S,this._dollyControlCoord.set(A,g)),this._lastDollyDirection=Math.sign(-p)},this._zoomInternal=(p,A,g)=>{const _=Math.pow(.95,p*this.dollySpeed),S=this._zoom,w=this._zoom*_;this.zoomTo(w,!0),this.dollyToCursor&&(this._changedZoom+=w-S,this._dollyControlCoord.set(A,g))},typeof b>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=t,this._yAxisUpSpace=new b.Quaternion().setFromUnitVectors(this._camera.up,Is),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=N.NONE,this._target=new b.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new b.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new b.Spherical().setFromVector3(B.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new b.Vector3,new b.Vector3,new b.Vector3,new b.Vector3],this._updateNearPlaneCorners(),this._boundary=new b.Box3(new b.Vector3(-1/0,-1/0,-1/0),new b.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new b.Vector2,this.mouseButtons={left:N.ROTATE,middle:N.DOLLY,right:N.TRUCK,wheel:Wt(this._camera)?N.DOLLY:bt(this._camera)?N.ZOOM:N.NONE},this.touches={one:N.TOUCH_ROTATE,two:Wt(this._camera)?N.TOUCH_DOLLY_TRUCK:bt(this._camera)?N.TOUCH_ZOOM_TRUCK:N.NONE,three:N.TOUCH_TRUCK};const s=new b.Vector2,i=new b.Vector2,n=new b.Vector2,o=p=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const _=this._domElement.getBoundingClientRect(),S=p.clientX/_.width,w=p.clientY/_.height;if(S<this._interactiveArea.left||S>this._interactiveArea.right||w<this._interactiveArea.top||w>this._interactiveArea.bottom)return}const A=p.pointerType!=="mouse"?null:(p.buttons&v.LEFT)===v.LEFT?v.LEFT:(p.buttons&v.MIDDLE)===v.MIDDLE?v.MIDDLE:(p.buttons&v.RIGHT)===v.RIGHT?v.RIGHT:null;if(A!==null){const _=this._findPointerByMouseButton(A);_&&this._disposePointer(_)}if((p.buttons&v.LEFT)===v.LEFT&&this._lockedPointer)return;const g={pointerId:p.pointerId,clientX:p.clientX,clientY:p.clientY,deltaX:0,deltaY:0,mouseButton:A};this._activePointers.push(g),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",d),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",d),this._isDragging=!0,C(p)},r=p=>{if(!this._enabled||!this._domElement||this._lockedPointer)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const _=this._domElement.getBoundingClientRect(),S=p.clientX/_.width,w=p.clientY/_.height;if(S<this._interactiveArea.left||S>this._interactiveArea.right||w<this._interactiveArea.top||w>this._interactiveArea.bottom)return}const A=(p.buttons&v.LEFT)===v.LEFT?v.LEFT:(p.buttons&v.MIDDLE)===v.MIDDLE?v.MIDDLE:(p.buttons&v.RIGHT)===v.RIGHT?v.RIGHT:null;if(A!==null){const _=this._findPointerByMouseButton(A);_&&this._disposePointer(_)}const g={pointerId:1,clientX:p.clientX,clientY:p.clientY,deltaX:0,deltaY:0,mouseButton:(p.buttons&v.LEFT)===v.LEFT?v.LEFT:(p.buttons&v.MIDDLE)===v.LEFT?v.MIDDLE:(p.buttons&v.RIGHT)===v.LEFT?v.RIGHT:null};this._activePointers.push(g),this._domElement.ownerDocument.removeEventListener("mousemove",c),this._domElement.ownerDocument.removeEventListener("mouseup",E),this._domElement.ownerDocument.addEventListener("mousemove",c),this._domElement.ownerDocument.addEventListener("mouseup",E),this._isDragging=!0,C(p)},a=p=>{p.cancelable&&p.preventDefault();const A=p.pointerId,g=this._lockedPointer||this._findPointerById(A);if(g){if(g.clientX=p.clientX,g.clientY=p.clientY,g.deltaX=p.movementX,g.deltaY=p.movementY,this._state=0,p.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(p.buttons&v.LEFT)===v.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(p.buttons&v.MIDDLE)===v.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(p.buttons&v.RIGHT)===v.RIGHT&&(this._state=this._state|this.mouseButtons.right);f()}},c=p=>{const A=this._lockedPointer||this._findPointerById(1);A&&(A.clientX=p.clientX,A.clientY=p.clientY,A.deltaX=p.movementX,A.deltaY=p.movementY,this._state=0,(this._lockedPointer||(p.buttons&v.LEFT)===v.LEFT)&&(this._state=this._state|this.mouseButtons.left),(p.buttons&v.MIDDLE)===v.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(p.buttons&v.RIGHT)===v.RIGHT&&(this._state=this._state|this.mouseButtons.right),f())},d=p=>{const A=this._findPointerById(p.pointerId);if(!(A&&A===this._lockedPointer)){if(A&&this._disposePointer(A),p.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=N.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=N.NONE;m()}},E=()=>{const p=this._findPointerById(1);p&&p===this._lockedPointer||(p&&this._disposePointer(p),this._state=N.NONE,m())};let l=-1;const u=p=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===N.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const w=this._domElement.getBoundingClientRect(),y=p.clientX/w.width,L=p.clientY/w.height;if(y<this._interactiveArea.left||y>this._interactiveArea.right||L<this._interactiveArea.top||L>this._interactiveArea.bottom)return}if(p.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===N.ROTATE||this.mouseButtons.wheel===N.TRUCK){const w=performance.now();l-w<1e3&&this._getClientRect(this._elementRect),l=w}const A=fa?-1:-3,g=p.deltaMode===1?p.deltaY/A:p.deltaY/(A*10),_=this.dollyToCursor?(p.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,S=this.dollyToCursor?(p.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case N.ROTATE:{this._rotateInternal(p.deltaX,p.deltaY),this._isUserControllingRotate=!0;break}case N.TRUCK:{this._truckInternal(p.deltaX,p.deltaY,!1),this._isUserControllingTruck=!0;break}case N.OFFSET:{this._truckInternal(p.deltaX,p.deltaY,!0),this._isUserControllingOffset=!0;break}case N.DOLLY:{this._dollyInternal(-g,_,S),this._isUserControllingDolly=!0;break}case N.ZOOM:{this._zoomInternal(-g,_,S),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},T=p=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===ot.ACTION.NONE){const A=p instanceof PointerEvent?p.pointerId:0,g=this._findPointerById(A);g&&this._disposePointer(g),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",d),this._domElement.ownerDocument.removeEventListener("mousemove",c),this._domElement.ownerDocument.removeEventListener("mouseup",E);return}p.preventDefault()}},C=p=>{if(this._enabled){if(Xs(this._activePointers,ht),this._getClientRect(this._elementRect),s.copy(ht),i.copy(ht),this._activePointers.length>=2){const A=ht.x-this._activePointers[1].clientX,g=ht.y-this._activePointers[1].clientY,_=Math.sqrt(A*A+g*g);n.set(0,_);const S=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,w=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;i.set(S,w)}if(this._state=0,!p)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in p&&p.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(p.buttons&v.LEFT)===v.LEFT&&(this._state=this._state|this.mouseButtons.left),(p.buttons&v.MIDDLE)===v.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(p.buttons&v.RIGHT)===v.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&N.ROTATE)===N.ROTATE||(this._state&N.TOUCH_ROTATE)===N.TOUCH_ROTATE||(this._state&N.TOUCH_DOLLY_ROTATE)===N.TOUCH_DOLLY_ROTATE||(this._state&N.TOUCH_ZOOM_ROTATE)===N.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&N.TRUCK)===N.TRUCK||(this._state&N.TOUCH_TRUCK)===N.TOUCH_TRUCK||(this._state&N.TOUCH_DOLLY_TRUCK)===N.TOUCH_DOLLY_TRUCK||(this._state&N.TOUCH_ZOOM_TRUCK)===N.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&N.DOLLY)===N.DOLLY||(this._state&N.TOUCH_DOLLY)===N.TOUCH_DOLLY||(this._state&N.TOUCH_DOLLY_TRUCK)===N.TOUCH_DOLLY_TRUCK||(this._state&N.TOUCH_DOLLY_OFFSET)===N.TOUCH_DOLLY_OFFSET||(this._state&N.TOUCH_DOLLY_ROTATE)===N.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&N.ZOOM)===N.ZOOM||(this._state&N.TOUCH_ZOOM)===N.TOUCH_ZOOM||(this._state&N.TOUCH_ZOOM_TRUCK)===N.TOUCH_ZOOM_TRUCK||(this._state&N.TOUCH_ZOOM_OFFSET)===N.TOUCH_ZOOM_OFFSET||(this._state&N.TOUCH_ZOOM_ROTATE)===N.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&N.OFFSET)===N.OFFSET||(this._state&N.TOUCH_OFFSET)===N.TOUCH_OFFSET||(this._state&N.TOUCH_DOLLY_OFFSET)===N.TOUCH_DOLLY_OFFSET||(this._state&N.TOUCH_ZOOM_OFFSET)===N.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})}},f=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,Xs(this._activePointers,ht);const p=this._domElement&&document.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,A=p?-p.deltaX:i.x-ht.x,g=p?-p.deltaY:i.y-ht.y;if(i.copy(ht),((this._state&N.ROTATE)===N.ROTATE||(this._state&N.TOUCH_ROTATE)===N.TOUCH_ROTATE||(this._state&N.TOUCH_DOLLY_ROTATE)===N.TOUCH_DOLLY_ROTATE||(this._state&N.TOUCH_ZOOM_ROTATE)===N.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(A,g),this._isUserControllingRotate=!0),(this._state&N.DOLLY)===N.DOLLY||(this._state&N.ZOOM)===N.ZOOM){const _=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,S=this.dollyToCursor?(s.y-this._elementRect.y)/this._elementRect.height*-2+1:0,w=this.dollyDragInverted?-1:1;(this._state&N.DOLLY)===N.DOLLY?(this._dollyInternal(w*g*Es,_,S),this._isUserControllingDolly=!0):(this._zoomInternal(w*g*Es,_,S),this._isUserControllingZoom=!0)}if((this._state&N.TOUCH_DOLLY)===N.TOUCH_DOLLY||(this._state&N.TOUCH_ZOOM)===N.TOUCH_ZOOM||(this._state&N.TOUCH_DOLLY_TRUCK)===N.TOUCH_DOLLY_TRUCK||(this._state&N.TOUCH_ZOOM_TRUCK)===N.TOUCH_ZOOM_TRUCK||(this._state&N.TOUCH_DOLLY_OFFSET)===N.TOUCH_DOLLY_OFFSET||(this._state&N.TOUCH_ZOOM_OFFSET)===N.TOUCH_ZOOM_OFFSET||(this._state&N.TOUCH_DOLLY_ROTATE)===N.TOUCH_DOLLY_ROTATE||(this._state&N.TOUCH_ZOOM_ROTATE)===N.TOUCH_ZOOM_ROTATE){const _=ht.x-this._activePointers[1].clientX,S=ht.y-this._activePointers[1].clientY,w=Math.sqrt(_*_+S*S),y=n.y-w;n.set(0,w);const L=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,P=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&N.TOUCH_DOLLY)===N.TOUCH_DOLLY||(this._state&N.TOUCH_DOLLY_ROTATE)===N.TOUCH_DOLLY_ROTATE||(this._state&N.TOUCH_DOLLY_TRUCK)===N.TOUCH_DOLLY_TRUCK||(this._state&N.TOUCH_DOLLY_OFFSET)===N.TOUCH_DOLLY_OFFSET?(this._dollyInternal(y*Es,L,P),this._isUserControllingDolly=!0):(this._zoomInternal(y*Es,L,P),this._isUserControllingZoom=!0)}((this._state&N.TRUCK)===N.TRUCK||(this._state&N.TOUCH_TRUCK)===N.TOUCH_TRUCK||(this._state&N.TOUCH_DOLLY_TRUCK)===N.TOUCH_DOLLY_TRUCK||(this._state&N.TOUCH_ZOOM_TRUCK)===N.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(A,g,!1),this._isUserControllingTruck=!0),((this._state&N.OFFSET)===N.OFFSET||(this._state&N.TOUCH_OFFSET)===N.TOUCH_OFFSET||(this._state&N.TOUCH_DOLLY_OFFSET)===N.TOUCH_DOLLY_OFFSET||(this._state&N.TOUCH_ZOOM_OFFSET)===N.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(A,g,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},m=()=>{Xs(this._activePointers,ht),i.copy(ht),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",c),this._domElement.ownerDocument.removeEventListener("pointerup",d),this._domElement.ownerDocument.removeEventListener("mouseup",E),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",d),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",R),this._domElement.ownerDocument.addEventListener("pointerlockerror",F),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",d),C())},this.unlockPointer=()=>{this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),document.exitPointerLock(),this.cancel(),this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointerlockchange",R),this._domElement.ownerDocument.removeEventListener("pointerlockerror",F))};const R=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},F=()=>{this.unlockPointer()};this._addAllEventListeners=p=>{this._domElement=p,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",o),Ra&&this._domElement.addEventListener("mousedown",r),this._domElement.addEventListener("pointercancel",d),this._domElement.addEventListener("wheel",u,{passive:!1}),this._domElement.addEventListener("contextmenu",T)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",o),this._domElement.removeEventListener("mousedown",r),this._domElement.removeEventListener("pointercancel",d),this._domElement.removeEventListener("wheel",u,{passive:!1}),this._domElement.removeEventListener("contextmenu",T),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",c),this._domElement.ownerDocument.removeEventListener("pointerup",d),this._domElement.ownerDocument.removeEventListener("mouseup",E),this._domElement.ownerDocument.removeEventListener("pointerlockchange",R),this._domElement.ownerDocument.removeEventListener("pointerlockerror",F))},this.cancel=()=>{this._state!==N.NONE&&(this._state=N.NONE,this._activePointers.length=0,m())},e&&this.connect(e),this.update(0)}get camera(){return this._camera}set camera(t){this._camera=t,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._domElement&&(t?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(t){this._spherical.radius===t&&this._sphericalEnd.radius===t||(this._spherical.radius=t,this._sphericalEnd.radius=t,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(t){this._spherical.theta===t&&this._sphericalEnd.theta===t||(this._spherical.theta=t,this._sphericalEnd.theta=t,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(t){this._spherical.phi===t&&this._sphericalEnd.phi===t||(this._spherical.phi=t,this._sphericalEnd.phi=t,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(t){this._boundaryEnclosesCamera=t,this._needsUpdate=!0}set interactiveArea(t){this._interactiveArea.width=Tt(t.width,0,1),this._interactiveArea.height=Tt(t.height,0,1),this._interactiveArea.x=Tt(t.x,0,1-this._interactiveArea.width),this._interactiveArea.y=Tt(t.y,0,1-this._interactiveArea.height)}addEventListener(t,e){super.addEventListener(t,e)}removeEventListener(t,e){super.removeEventListener(t,e)}rotate(t,e,s=!1){return this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+e,s)}rotateAzimuthTo(t,e=!1){return this.rotateTo(t,this._sphericalEnd.phi,e)}rotatePolarTo(t,e=!1){return this.rotateTo(this._sphericalEnd.theta,t,e)}rotateTo(t,e,s=!1){this._isUserControllingRotate=!1;const i=Tt(t,this.minAzimuthAngle,this.maxAzimuthAngle),n=Tt(e,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=i,this._sphericalEnd.phi=n,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,s||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const o=!s||V(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&V(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(o)}dolly(t,e=!1){return this.dollyTo(this._sphericalEnd.radius-t,e)}dollyTo(t,e=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=le.NONE,this._changedDolly=0,this._dollyToNoClamp(Tt(t,this.minDistance,this.maxDistance),e)}_dollyToNoClamp(t,e=!1){const s=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const n=this._collisionTest(),o=V(n,this._spherical.radius);if(!(s>t)&&o)return Promise.resolve();this._sphericalEnd.radius=Math.min(t,n)}else this._sphericalEnd.radius=t;this._needsUpdate=!0,e||(this._spherical.radius=this._sphericalEnd.radius);const i=!e||V(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(i)}dollyInFixed(t,e=!1){this._targetEnd.add(this._getCameraDirection(Ue).multiplyScalar(t)),e||this._target.copy(this._targetEnd);const s=!e||V(this._target.x,this._targetEnd.x,this.restThreshold)&&V(this._target.y,this._targetEnd.y,this.restThreshold)&&V(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}zoom(t,e=!1){return this.zoomTo(this._zoomEnd+t,e)}zoomTo(t,e=!1){this._isUserControllingZoom=!1,this._zoomEnd=Tt(t,this.minZoom,this.maxZoom),this._needsUpdate=!0,e||(this._zoom=this._zoomEnd);const s=!e||V(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(s)}pan(t,e,s=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(t,e,s)}truck(t,e,s=!1){this._camera.updateMatrix(),Ot.setFromMatrixColumn(this._camera.matrix,0),_t.setFromMatrixColumn(this._camera.matrix,1),Ot.multiplyScalar(t),_t.multiplyScalar(-e);const i=B.copy(Ot).add(_t),n=G.copy(this._targetEnd).add(i);return this.moveTo(n.x,n.y,n.z,s)}forward(t,e=!1){B.setFromMatrixColumn(this._camera.matrix,0),B.crossVectors(this._camera.up,B),B.multiplyScalar(t);const s=G.copy(this._targetEnd).add(B);return this.moveTo(s.x,s.y,s.z,e)}elevate(t,e=!1){return B.copy(this._camera.up).multiplyScalar(t),this.moveTo(this._targetEnd.x+B.x,this._targetEnd.y+B.y,this._targetEnd.z+B.z,e)}moveTo(t,e,s,i=!1){this._isUserControllingTruck=!1;const n=B.set(t,e,s).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,n,this.boundaryFriction),this._needsUpdate=!0,i||this._target.copy(this._targetEnd);const o=!i||V(this._target.x,this._targetEnd.x,this.restThreshold)&&V(this._target.y,this._targetEnd.y,this.restThreshold)&&V(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(o)}lookInDirectionOf(t,e,s,i=!1){const n=B.set(t,e,s).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius);return this.setPosition(n.x,n.y,n.z,i)}fitToBox(t,e,{cover:s=!1,paddingLeft:i=0,paddingRight:n=0,paddingBottom:o=0,paddingTop:r=0}={}){const a=[],c=t.isBox3?Ie.copy(t):Ie.setFromObject(t);c.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const d=Cn(this._sphericalEnd.theta,pn),E=Cn(this._sphericalEnd.phi,pn);a.push(this.rotateTo(d,E,e));const l=B.setFromSpherical(this._sphericalEnd).normalize(),u=Fn.setFromUnitVectors(l,Qs),T=V(Math.abs(l.y),1);T&&u.multiply(qs.setFromAxisAngle(Is,d)),u.multiply(this._yAxisUpSpaceInverse);const C=An.makeEmpty();G.copy(c.min).applyQuaternion(u),C.expandByPoint(G),G.copy(c.min).setX(c.max.x).applyQuaternion(u),C.expandByPoint(G),G.copy(c.min).setY(c.max.y).applyQuaternion(u),C.expandByPoint(G),G.copy(c.max).setZ(c.min.z).applyQuaternion(u),C.expandByPoint(G),G.copy(c.min).setZ(c.max.z).applyQuaternion(u),C.expandByPoint(G),G.copy(c.max).setY(c.min.y).applyQuaternion(u),C.expandByPoint(G),G.copy(c.max).setX(c.min.x).applyQuaternion(u),C.expandByPoint(G),G.copy(c.max).applyQuaternion(u),C.expandByPoint(G),C.min.x-=i,C.min.y-=o,C.max.x+=n,C.max.y+=r,u.setFromUnitVectors(Qs,l),T&&u.premultiply(qs.invert()),u.premultiply(this._yAxisUpSpace);const f=C.getSize(B),m=C.getCenter(G).applyQuaternion(u);if(Wt(this._camera)){const R=this.getDistanceToFitBox(f.x,f.y,f.z,s);a.push(this.moveTo(m.x,m.y,m.z,e)),a.push(this.dollyTo(R,e)),a.push(this.setFocalOffset(0,0,0,e))}else if(bt(this._camera)){const R=this._camera,F=R.right-R.left,p=R.top-R.bottom,A=s?Math.max(F/f.x,p/f.y):Math.min(F/f.x,p/f.y);a.push(this.moveTo(m.x,m.y,m.z,e)),a.push(this.zoomTo(A,e)),a.push(this.setFocalOffset(0,0,0,e))}return Promise.all(a)}fitToSphere(t,e){const s=[],i=t instanceof b.Sphere?js.copy(t):ot.createBoundingSphere(t,js);if(s.push(this.moveTo(i.center.x,i.center.y,i.center.z,e)),Wt(this._camera)){const n=this.getDistanceToFitSphere(i.radius);s.push(this.dollyTo(n,e))}else if(bt(this._camera)){const n=this._camera.right-this._camera.left,o=this._camera.top-this._camera.bottom,r=2*i.radius,a=Math.min(n/r,o/r);s.push(this.zoomTo(a,e))}return s.push(this.setFocalOffset(0,0,0,e)),Promise.all(s)}setLookAt(t,e,s,i,n,o,r=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=le.NONE,this._changedDolly=0;const a=G.set(i,n,o),c=B.set(t,e,s);this._targetEnd.copy(a),this._sphericalEnd.setFromVector3(c.sub(a).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,r||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const d=!r||V(this._target.x,this._targetEnd.x,this.restThreshold)&&V(this._target.y,this._targetEnd.y,this.restThreshold)&&V(this._target.z,this._targetEnd.z,this.restThreshold)&&V(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&V(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&V(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(d)}lerpLookAt(t,e,s,i,n,o,r,a,c,d,E,l,u,T=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=le.NONE,this._changedDolly=0;const C=B.set(i,n,o),f=G.set(t,e,s);dt.setFromVector3(f.sub(C).applyQuaternion(this._yAxisUpSpace));const m=Ee.set(d,E,l),R=G.set(r,a,c);De.setFromVector3(R.sub(m).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(C.lerp(m,u));const F=De.theta-dt.theta,p=De.phi-dt.phi,A=De.radius-dt.radius;this._sphericalEnd.set(dt.radius+A*u,dt.phi+p*u,dt.theta+F*u),this.normalizeRotations(),this._needsUpdate=!0,T||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const g=!T||V(this._target.x,this._targetEnd.x,this.restThreshold)&&V(this._target.y,this._targetEnd.y,this.restThreshold)&&V(this._target.z,this._targetEnd.z,this.restThreshold)&&V(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&V(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&V(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(g)}setPosition(t,e,s,i=!1){return this.setLookAt(t,e,s,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,i)}setTarget(t,e,s,i=!1){const n=this.getPosition(B),o=this.setLookAt(n.x,n.y,n.z,t,e,s,i);return this._sphericalEnd.phi=Tt(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),o}setFocalOffset(t,e,s,i=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(t,e,s),this._needsUpdate=!0,i||this._focalOffset.copy(this._focalOffsetEnd);const n=!i||V(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&V(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&V(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}setOrbitPoint(t,e,s){this._camera.updateMatrixWorld(),Ot.setFromMatrixColumn(this._camera.matrixWorldInverse,0),_t.setFromMatrixColumn(this._camera.matrixWorldInverse,1),Xt.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const i=B.set(t,e,s),n=i.distanceTo(this._camera.position),o=i.sub(this._camera.position);Ot.multiplyScalar(o.x),_t.multiplyScalar(o.y),Xt.multiplyScalar(o.z),B.copy(Ot).add(_t).add(Xt),B.z=B.z+n,this.dollyTo(n,!1),this.setFocalOffset(-B.x,B.y,-B.z,!1),this.moveTo(t,e,s,!1)}setBoundary(t){if(!t){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(t),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(t,e,s,i){if(t===null){this._viewport=null;return}this._viewport=this._viewport||new b.Vector4,typeof t=="number"?this._viewport.set(t,e,s,i):this._viewport.copy(t)}getDistanceToFitBox(t,e,s,i=!1){if(Zs(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const n=t/e,o=this._camera.getEffectiveFOV()*Le,r=this._camera.aspect;return((i?n>r:n<r)?e:t/r)*.5/Math.tan(o*.5)+s*.5}getDistanceToFitSphere(t){if(Zs(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const e=this._camera.getEffectiveFOV()*Le,s=Math.atan(Math.tan(e*.5)*this._camera.aspect)*2,i=1<this._camera.aspect?e:s;return t/Math.sin(i*.5)}getTarget(t,e=!0){return(t&&t.isVector3?t:new b.Vector3).copy(e?this._targetEnd:this._target)}getPosition(t,e=!0){return(t&&t.isVector3?t:new b.Vector3).setFromSpherical(e?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(e?this._targetEnd:this._target)}getSpherical(t,e=!0){return(t&&t instanceof b.Spherical?t:new b.Spherical).copy(e?this._sphericalEnd:this._spherical)}getFocalOffset(t,e=!0){return(t&&t.isVector3?t:new b.Vector3).copy(e?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%de,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=de),this._spherical.theta+=de*Math.round((this._sphericalEnd.theta-this._spherical.theta)/de)}reset(t=!1){if(!V(this._camera.up.x,this._cameraUp0.x)||!V(this._camera.up.y,this._cameraUp0.y)||!V(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const s=this.getPosition(B);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}const e=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,t),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,t),this.zoomTo(this._zoom0,t)];return Promise.all(e)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,Is),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const t=B.subVectors(this._target,this._camera.position).normalize(),e=G.crossVectors(t,this._camera.up);this._camera.up.crossVectors(e,t).normalize(),this._camera.updateMatrixWorld();const s=this.getPosition(B);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}update(t){const e=this._sphericalEnd.theta-this._spherical.theta,s=this._sphericalEnd.phi-this._spherical.phi,i=this._sphericalEnd.radius-this._spherical.radius,n=fn.subVectors(this._targetEnd,this._target),o=Rn.subVectors(this._focalOffsetEnd,this._focalOffset),r=this._zoomEnd-this._zoom;if(W(e))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const d=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=ds(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,d,1/0,t),this._needsUpdate=!0}if(W(s))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const d=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=ds(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,d,1/0,t),this._needsUpdate=!0}if(W(i))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const d=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=ds(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,d,this.maxSpeed,t),this._needsUpdate=!0}if(W(n.x)&&W(n.y)&&W(n.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const d=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;Tn(this._target,this._targetEnd,this._targetVelocity,d,this.maxSpeed,t,this._target),this._needsUpdate=!0}if(W(o.x)&&W(o.y)&&W(o.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const d=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;Tn(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,d,this.maxSpeed,t,this._focalOffset),this._needsUpdate=!0}if(W(r))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const d=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=ds(this._zoom,this._zoomEnd,this._zoomVelocity,d,1/0,t)}if(this.dollyToCursor){if(Wt(this._camera)&&this._changedDolly!==0){const d=this._spherical.radius-this._lastDistance,E=this._camera,l=this._getCameraDirection(Ue),u=B.copy(l).cross(E.up).normalize();u.lengthSq()===0&&(u.x=1);const T=G.crossVectors(u,l),C=this._sphericalEnd.radius*Math.tan(E.getEffectiveFOV()*Le*.5),f=(this._sphericalEnd.radius-d-this._sphericalEnd.radius)/this._sphericalEnd.radius,m=Ee.copy(this._targetEnd).add(u.multiplyScalar(this._dollyControlCoord.x*C*E.aspect)).add(T.multiplyScalar(this._dollyControlCoord.y*C)),R=B.copy(this._targetEnd).lerp(m,f),F=this._lastDollyDirection===le.IN&&this._spherical.radius<=this.minDistance,p=this._lastDollyDirection===le.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(F||p)){this._sphericalEnd.radius-=d,this._spherical.radius-=d;const g=G.copy(l).multiplyScalar(-d);R.add(g)}this._boundary.clampPoint(R,R);const A=G.subVectors(R,this._targetEnd);this._targetEnd.copy(R),this._target.add(A),this._changedDolly-=d,W(this._changedDolly)&&(this._changedDolly=0)}else if(bt(this._camera)&&this._changedZoom!==0){const d=this._zoom-this._lastZoom,E=this._camera,l=B.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(E.near+E.far)/(E.near-E.far)).unproject(E),u=G.set(0,0,-1).applyQuaternion(E.quaternion),T=Ee.copy(l).add(u.multiplyScalar(-l.dot(E.up))),C=-(this._zoom-d-this._zoom)/this._zoom,f=this._getCameraDirection(Ue),m=this._targetEnd.dot(f),R=B.copy(this._targetEnd).lerp(T,C),F=R.dot(f),p=f.multiplyScalar(F-m);R.sub(p),this._boundary.clampPoint(R,R);const A=G.subVectors(R,this._targetEnd);this._targetEnd.copy(R),this._target.add(A),this._changedZoom-=d,W(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const a=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,a),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!W(this._focalOffset.x)||!W(this._focalOffset.y)||!W(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),Ot.setFromMatrixColumn(this._camera.matrix,0),_t.setFromMatrixColumn(this._camera.matrix,1),Xt.setFromMatrixColumn(this._camera.matrix,2),Ot.multiplyScalar(this._focalOffset.x),_t.multiplyScalar(-this._focalOffset.y),Xt.multiplyScalar(this._focalOffset.z),B.copy(Ot).add(_t).add(Xt),this._camera.position.add(B)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),B.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const c=this._needsUpdate;return c&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):c?(this.dispatchEvent({type:"update"}),W(e,this.restThreshold)&&W(s,this.restThreshold)&&W(i,this.restThreshold)&&W(n.x,this.restThreshold)&&W(n.y,this.restThreshold)&&W(n.z,this.restThreshold)&&W(o.x,this.restThreshold)&&W(o.y,this.restThreshold)&&W(o.z,this.restThreshold)&&W(r,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!c&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=c,this._needsUpdate=!1,c}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:Pe(this.maxDistance),minZoom:this.minZoom,maxZoom:Pe(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:Pe(this.maxPolarAngle),minAzimuthAngle:Pe(this.minAzimuthAngle),maxAzimuthAngle:Pe(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:B.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(t,e=!1){const s=JSON.parse(t);this.enabled=s.enabled,this.minDistance=s.minDistance,this.maxDistance=Me(s.maxDistance),this.minZoom=s.minZoom,this.maxZoom=Me(s.maxZoom),this.minPolarAngle=s.minPolarAngle,this.maxPolarAngle=Me(s.maxPolarAngle),this.minAzimuthAngle=Me(s.minAzimuthAngle),this.maxAzimuthAngle=Me(s.maxAzimuthAngle),this.smoothTime=s.smoothTime,this.draggingSmoothTime=s.draggingSmoothTime,this.dollySpeed=s.dollySpeed,this.truckSpeed=s.truckSpeed,this.dollyToCursor=s.dollyToCursor,this.verticalDragToForward=s.verticalDragToForward,this._target0.fromArray(s.target0),this._position0.fromArray(s.position0),this._zoom0=s.zoom0,this._focalOffset0.fromArray(s.focalOffset0),this.moveTo(s.target[0],s.target[1],s.target[2],e),dt.setFromVector3(B.fromArray(s.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(dt.theta,dt.phi,e),this.dollyTo(dt.radius,e),this.zoomTo(s.zoom,e),this.setFocalOffset(s.focalOffset[0],s.focalOffset[1],s.focalOffset[2],e),this._needsUpdate=!0}connect(t){if(this._domElement){console.warn("camera-controls is already connected.");return}t.setAttribute("data-camera-controls-version",ma),this._addAllEventListeners(t),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(t){return t.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(t){return this._getTargetDirection(t).negate()}_findPointerById(t){return this._activePointers.find(e=>e.pointerId===t)}_findPointerByMouseButton(t){return this._activePointers.find(e=>e.mouseButton===t)}_disposePointer(t){this._activePointers.splice(this._activePointers.indexOf(t),1)}_encloseToBoundary(t,e,s){const i=e.lengthSq();if(i===0)return t;const n=G.copy(e).add(t),o=this._boundary.clampPoint(n,Ee).sub(n),r=o.lengthSq();if(r===0)return t.add(e);if(r===i)return t;if(s===0)return t.add(e).add(o);{const a=1+s*r/e.dot(o);return t.add(G.copy(e).multiplyScalar(a)).add(o.multiplyScalar(1-s))}}_updateNearPlaneCorners(){if(Wt(this._camera)){const t=this._camera,e=t.near,s=t.getEffectiveFOV()*Le,i=Math.tan(s*.5)*e,n=i*t.aspect;this._nearPlaneCorners[0].set(-n,-i,0),this._nearPlaneCorners[1].set(n,-i,0),this._nearPlaneCorners[2].set(n,i,0),this._nearPlaneCorners[3].set(-n,i,0)}else if(bt(this._camera)){const t=this._camera,e=1/t.zoom,s=t.left*e,i=t.right*e,n=t.top*e,o=t.bottom*e;this._nearPlaneCorners[0].set(s,n,0),this._nearPlaneCorners[1].set(i,n,0),this._nearPlaneCorners[2].set(i,o,0),this._nearPlaneCorners[3].set(s,o,0)}}_collisionTest(){let t=1/0;if(!(this.colliderMeshes.length>=1)||Zs(this._camera,"_collisionTest"))return t;const e=this._getTargetDirection(Ue);Ks.lookAt(mn,e,this._camera.up);for(let s=0;s<4;s++){const i=G.copy(this._nearPlaneCorners[s]);i.applyMatrix4(Ks);const n=Ee.addVectors(this._target,i);us.set(n,e),us.far=this._spherical.radius+1;const o=us.intersectObjects(this.colliderMeshes);o.length!==0&&o[0].distance<t&&(t=o[0].distance)}return t}_getClientRect(t){if(!this._domElement)return;const e=this._domElement.getBoundingClientRect();return t.x=e.left,t.y=e.top,this._viewport?(t.x+=this._viewport.x,t.y+=e.height-this._viewport.w-this._viewport.y,t.width=this._viewport.z,t.height=this._viewport.w):(t.width=e.width,t.height=e.height),t}_createOnRestPromise(t){return t?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(e=>{const s=()=>{this.removeEventListener("rest",s),e()};this.addEventListener("rest",s)}))}_addAllEventListeners(t){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(t){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(t){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(t,e=new b.Sphere){const s=e,i=s.center;Ie.makeEmpty(),t.traverseVisible(o=>{o.isMesh&&Ie.expandByObject(o)}),Ie.getCenter(i);let n=0;return t.traverseVisible(o=>{if(!o.isMesh)return;const r=o,a=r.geometry.clone();a.applyMatrix4(r.matrixWorld);const c=a.attributes.position;for(let d=0,E=c.count;d<E;d++)B.fromBufferAttribute(c,d),n=Math.max(n,i.distanceToSquared(B))}),s.radius=Math.sqrt(n),s}}class He extends ta{constructor(t){super(t),I(this,"onBeforeUpdate",new M),I(this,"onAfterUpdate",new M),I(this,"onAspectUpdated",new M),I(this,"onDisposed",new M),I(this,"three"),I(this,"_allControls",new Map),I(this,"updateAspect",()=>{var e;if(!(!this.currentWorld||!this.currentWorld.renderer)){if(this.three instanceof fi){this.onAspectUpdated.trigger();return}if((e=this.currentWorld.renderer)!=null&&e.isResizeable()){const s=this.currentWorld.renderer.getSize();this.three.aspect=s.width/s.height,this.three.updateProjectionMatrix(),this.onAspectUpdated.trigger()}}}),this.three=this.setupCamera(),this.setupEvents(!0),this.onWorldChanged.add(({action:e,world:s})=>{if(e==="added"){const i=this.newCameraControls();this._allControls.set(s.uuid,i)}if(e==="removed"){const i=this._allControls.get(s.uuid);i&&(i.dispose(),this._allControls.delete(s.uuid))}})}get controls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");const t=this._allControls.get(this.currentWorld.uuid);if(!t)throw new Error("Controls not found!");return t}get enabled(){return this.currentWorld===null?!1:this.controls.enabled}set enabled(t){this.controls.enabled=t}dispose(){this.setupEvents(!1),this.enabled=!1,this.onAspectUpdated.reset(),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.three.removeFromParent(),this.onDisposed.trigger(),this.onDisposed.reset();for(const[t,e]of this._allControls)e.dispose()}update(t){this.enabled&&(this.onBeforeUpdate.trigger(this),this.controls.update(t),this.onAfterUpdate.trigger(this))}setupCamera(){const t=window.innerWidth/window.innerHeight,e=new So(60,t,1,1e3);return e.position.set(50,50,50),e.lookAt(new O(0,0,0)),e}newCameraControls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");if(!this.currentWorld.renderer)throw new Error("This camera needs a renderer to work!");ot.install({THREE:He.getSubsetOfThree()});const{domElement:t}=this.currentWorld.renderer.three,e=new ot(this.three,t);return e.smoothTime=.2,e.dollyToCursor=!0,e.infinityDolly=!0,e}setupEvents(t){t?window.addEventListener("resize",this.updateAspect):window.removeEventListener("resize",this.updateAspect)}static getSubsetOfThree(){return{MOUSE:No,Vector2:Ft,Vector3:O,Vector4:wo,Quaternion:Rt,Matrix4:X,Spherical:yo,Box3:st,Sphere:Os,Raycaster:Ti,MathUtils:Ln}}}const Zn=class Qn extends q{constructor(t){super(t),I(this,"onAfterUpdate",new M),I(this,"onBeforeUpdate",new M),I(this,"onDisposed",new M),I(this,"list",new Map),I(this,"enabled",!0),t.add(Qn.uuid,this)}create(){const t=new Ca(this.components),e=t.uuid;if(this.list.has(e))throw new Error("There is already a world with this name!");return this.list.set(e,t),t}delete(t){this.list.delete(t.uuid),t.dispose()}dispose(){this.enabled=!1;for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger()}update(t){if(this.enabled)for(const[e,s]of this.list)s.update(t)}};I(Zn,"uuid","fdb61dc4-2ec1-4966-b83d-54ea795fad4a");let Aa=Zn;class Fa{constructor(t,e,s){I(this,"onDisposed",new M),I(this,"world"),I(this,"components"),I(this,"three"),I(this,"_fade",3),I(this,"updateZoom",()=>{this.world.camera instanceof He&&(this.material.uniforms.uZoom.value=this.world.camera.three.zoom)}),this.world=e;const{color:i,size1:n,size2:o,distance:r}=s;this.components=t;const a=new Ri(2,2,1,1),c=new Po({side:ke,uniforms:{uSize1:{value:n},uSize2:{value:o},uColor:{value:i},uDistance:{value:r},uFade:{value:this._fade},uZoom:{value:1}},transparent:!0,vertexShader:`
            
            varying vec3 worldPosition;
            
            uniform float uDistance;
            
            void main() {
            
                    vec3 pos = position.xzy * uDistance;
                    pos.xz += cameraPosition.xz;
                    
                    worldPosition = pos;
                    
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
            
            }
            `,fragmentShader:`
            
            varying vec3 worldPosition;
            
            uniform float uZoom;
            uniform float uFade;
            uniform float uSize1;
            uniform float uSize2;
            uniform vec3 uColor;
            uniform float uDistance;
                
                
                
                float getGrid(float size) {
                
                    vec2 r = worldPosition.xz / size;
                    
                    
                    vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
                    float line = min(grid.x, grid.y);
                    
                
                    return 1.0 - min(line, 1.0);
                }
                
            void main() {
            
                    
                    float d = 1.0 - min(distance(cameraPosition.xz, worldPosition.xz) / uDistance, 1.0);
                    
                    float g1 = getGrid(uSize1);
                    float g2 = getGrid(uSize2);
                    
                    // Ortho camera fades the grid away when zooming out
                    float minZoom = step(0.2, uZoom);
                    float zoomFactor = pow(min(uZoom, 1.), 2.) * minZoom;
                    
                    gl_FragColor = vec4(uColor.rgb, mix(g2, g1, g1) * pow(d, uFade));
                    gl_FragColor.a = mix(0.5 * gl_FragColor.a, gl_FragColor.a, g2) * zoomFactor;
                    
                    if ( gl_FragColor.a <= 0.0 ) discard;
                    
            
            }
            
            `,extensions:{derivatives:!0}});this.three=new D(a,c),this.three.frustumCulled=!1,e.scene.three.add(this.three),this.setupEvents(!0)}get visible(){return this.three.visible}set visible(t){t?this.world.scene.three.add(this.three):this.three.removeFromParent()}get material(){return this.three.material}get fade(){return this._fade===3}set fade(t){this._fade=t?3:0,this.material.uniforms.uFade.value=this._fade}[Symbol.dispose](){throw new Error("Method not implemented.")}dispose(){this.setupEvents(!1),this.components.get(me).destroy(this.three),this.onDisposed.trigger(),this.onDisposed.reset(),this.world=null,this.components=null}setupEvents(t){if(!(this.world.camera instanceof He))return;const e=this.world.camera.controls;t?e.addEventListener("update",this.updateZoom):e.removeEventListener("update",this.updateZoom)}}class ga extends q{constructor(){super(...arguments),I(this,"list",new Map),I(this,"onDisposed",new M),I(this,"config",{color:new qt(12303291),size1:1,size2:10,distance:500}),I(this,"enabled",!0)}create(t){if(this.list.has(t.uuid))throw new Error("This world already has a grid!");const e=new Fa(this.components,t,this.config);return this.list.set(t.uuid,e),t.onDisposed.add(()=>{this.delete(t)}),e}delete(t){const e=this.list.get(t.uuid);e&&e.dispose(),this.list.delete(t.uuid)}dispose(){for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger()}}I(ga,"uuid","d1e814d5-b81c-4452-87a2-f039375e0489");const Zt=new Ti,nt=new O,xt=new O,Q=new Rt,gn={X:new O(1,0,0),Y:new O(0,1,0),Z:new O(0,0,1)},$s={type:"change"},On={type:"mouseDown"},_n={type:"mouseUp",mode:null},Sn={type:"objectChange"};class Oa extends Fs{constructor(t,e){super(),e===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),e=document),this.isTransformControls=!0,this.visible=!1,this.domElement=e,this.domElement.style.touchAction="none";const s=new La;this._gizmo=s,this.add(s);const i=new Pa;this._plane=i,this.add(i);const n=this;function o(R,F){let p=F;Object.defineProperty(n,R,{get:function(){return p!==void 0?p:F},set:function(A){p!==A&&(p=A,i[R]=A,s[R]=A,n.dispatchEvent({type:R+"-changed",value:A}),n.dispatchEvent($s))}}),n[R]=F,i[R]=F,s[R]=F}o("camera",t),o("object",void 0),o("enabled",!0),o("axis",null),o("mode","translate"),o("translationSnap",null),o("rotationSnap",null),o("scaleSnap",null),o("space","world"),o("size",1),o("dragging",!1),o("showX",!0),o("showY",!0),o("showZ",!0);const r=new O,a=new O,c=new Rt,d=new Rt,E=new O,l=new Rt,u=new O,T=new O,C=new O,f=0,m=new O;o("worldPosition",r),o("worldPositionStart",a),o("worldQuaternion",c),o("worldQuaternionStart",d),o("cameraPosition",E),o("cameraQuaternion",l),o("pointStart",u),o("pointEnd",T),o("rotationAxis",C),o("rotationAngle",f),o("eye",m),this._offset=new O,this._startNorm=new O,this._endNorm=new O,this._cameraScale=new O,this._parentPosition=new O,this._parentQuaternion=new Rt,this._parentQuaternionInv=new Rt,this._parentScale=new O,this._worldScaleStart=new O,this._worldQuaternionInv=new Rt,this._worldScale=new O,this._positionStart=new O,this._quaternionStart=new Rt,this._scaleStart=new O,this._getPointer=_a.bind(this),this._onPointerDown=Na.bind(this),this._onPointerHover=Sa.bind(this),this._onPointerMove=wa.bind(this),this._onPointerUp=ya.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(t){if(this.object===void 0||this.dragging===!0)return;Zt.setFromCamera(t,this.camera);const e=Js(this._gizmo.picker[this.mode],Zt);e?this.axis=e.object.name:this.axis=null}pointerDown(t){if(!(this.object===void 0||this.dragging===!0||t.button!==0)&&this.axis!==null){Zt.setFromCamera(t,this.camera);const e=Js(this._plane,Zt,!0);e&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(e.point).sub(this.worldPositionStart)),this.dragging=!0,On.mode=this.mode,this.dispatchEvent(On)}}pointerMove(t){const e=this.axis,s=this.mode,i=this.object;let n=this.space;if(s==="scale"?n="local":(e==="E"||e==="XYZE"||e==="XYZ")&&(n="world"),i===void 0||e===null||this.dragging===!1||t.button!==-1)return;Zt.setFromCamera(t,this.camera);const o=Js(this._plane,Zt,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),s==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),n==="local"&&e!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),e.indexOf("X")===-1&&(this._offset.x=0),e.indexOf("Y")===-1&&(this._offset.y=0),e.indexOf("Z")===-1&&(this._offset.z=0),n==="local"&&e!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(n==="local"&&(i.position.applyQuaternion(Q.copy(this._quaternionStart).invert()),e.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),n==="world"&&(i.parent&&i.position.add(nt.setFromMatrixPosition(i.parent.matrixWorld)),e.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(nt.setFromMatrixPosition(i.parent.matrixWorld))));else if(s==="scale"){if(e.search("XYZ")!==-1){let r=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(r*=-1),xt.set(r,r,r)}else nt.copy(this.pointStart),xt.copy(this.pointEnd),nt.applyQuaternion(this._worldQuaternionInv),xt.applyQuaternion(this._worldQuaternionInv),xt.divide(nt),e.search("X")===-1&&(xt.x=1),e.search("Y")===-1&&(xt.y=1),e.search("Z")===-1&&(xt.z=1);i.scale.copy(this._scaleStart).multiply(xt),this.scaleSnap&&(e.search("X")!==-1&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Y")!==-1&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Z")!==-1&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(s==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const r=20/this.worldPosition.distanceTo(nt.setFromMatrixPosition(this.camera.matrixWorld));let a=!1;e==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(nt.copy(this.rotationAxis).cross(this.eye))*r):(e==="X"||e==="Y"||e==="Z")&&(this.rotationAxis.copy(gn[e]),nt.copy(gn[e]),n==="local"&&nt.applyQuaternion(this.worldQuaternion),nt.cross(this.eye),nt.length()===0?a=!0:this.rotationAngle=this._offset.dot(nt.normalize())*r),(e==="E"||a)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),n==="local"&&e!=="E"&&e!=="XYZE"?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(Q.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(Q.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent($s),this.dispatchEvent(Sn)}}pointerUp(t){t.button===0&&(this.dragging&&this.axis!==null&&(_n.mode=this.mode,this.dispatchEvent(_n)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(t){t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()})}attach(t){return this.object=t,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent($s),this.dispatchEvent(Sn),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Zt}getMode(){return this.mode}setMode(t){this.mode=t}setTranslationSnap(t){this.translationSnap=t}setRotationSnap(t){this.rotationSnap=t}setScaleSnap(t){this.scaleSnap=t}setSize(t){this.size=t}setSpace(t){this.space=t}}function _a(h){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:h.button};{const t=this.domElement.getBoundingClientRect();return{x:(h.clientX-t.left)/t.width*2-1,y:-(h.clientY-t.top)/t.height*2+1,button:h.button}}}function Sa(h){if(this.enabled)switch(h.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(h));break}}function Na(h){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(h.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(h)),this.pointerDown(this._getPointer(h)))}function wa(h){this.enabled&&this.pointerMove(this._getPointer(h))}function ya(h){this.enabled&&(this.domElement.releasePointerCapture(h.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(h)))}function Js(h,t,e){const s=t.intersectObject(h,!0);for(let i=0;i<s.length;i++)if(s[i].object.visible||e)return s[i];return!1}const ps=new go,k=new O(0,1,0),Nn=new O(0,0,0),wn=new X,Cs=new Rt,Rs=new Rt,St=new O,yn=new X,ve=new O(1,0,0),Qt=new O(0,1,0),Be=new O(0,0,1),Ts=new O,xe=new O,be=new O;class La extends Fs{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const t=new Te({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),e=new xn({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=t.clone();s.opacity=.15;const i=e.clone();i.opacity=.5;const n=t.clone();n.color.setHex(16711680);const o=t.clone();o.color.setHex(65280);const r=t.clone();r.color.setHex(255);const a=t.clone();a.color.setHex(16711680),a.opacity=.5;const c=t.clone();c.color.setHex(65280),c.opacity=.5;const d=t.clone();d.color.setHex(255),d.opacity=.5;const E=t.clone();E.opacity=.25;const l=t.clone();l.color.setHex(16776960),l.opacity=.25,t.clone().color.setHex(16776960);const u=t.clone();u.color.setHex(7895160);const T=new rt(0,.04,.1,12);T.translate(0,.05,0);const C=new it(.08,.08,.08);C.translate(0,.04,0);const f=new ze;f.setAttribute("position",new ki([0,0,0,1,0,0],3));const m=new rt(.0075,.0075,.5,3);m.translate(0,.25,0);function R(x,Y){const z=new ge(x,.0075,3,64,Y*Math.PI*2);return z.rotateY(Math.PI/2),z.rotateX(Math.PI/2),z}function F(){const x=new ze;return x.setAttribute("position",new ki([0,0,0,1,1,1],3)),x}const p={X:[[new D(T,n),[.5,0,0],[0,0,-Math.PI/2]],[new D(T,n),[-.5,0,0],[0,0,Math.PI/2]],[new D(m,n),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new D(T,o),[0,.5,0]],[new D(T,o),[0,-.5,0],[Math.PI,0,0]],[new D(m,o)]],Z:[[new D(T,r),[0,0,.5],[Math.PI/2,0,0]],[new D(T,r),[0,0,-.5],[-Math.PI/2,0,0]],[new D(m,r),null,[Math.PI/2,0,0]]],XYZ:[[new D(new Qe(.1,0),E.clone()),[0,0,0]]],XY:[[new D(new it(.15,.15,.01),d.clone()),[.15,.15,0]]],YZ:[[new D(new it(.15,.15,.01),a.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new D(new it(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},A={X:[[new D(new rt(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new D(new rt(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new D(new rt(.2,0,.6,4),s),[0,.3,0]],[new D(new rt(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new D(new rt(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new D(new rt(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new D(new Qe(.2,0),s)]],XY:[[new D(new it(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new D(new it(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new D(new it(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},g={START:[[new D(new Qe(.01,2),i),null,null,null,"helper"]],END:[[new D(new Qe(.01,2),i),null,null,null,"helper"]],DELTA:[[new Ut(F(),i),null,null,null,"helper"]],X:[[new Ut(f,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ut(f,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ut(f,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},_={XYZE:[[new D(R(.5,1),u),null,[0,Math.PI/2,0]]],X:[[new D(R(.5,.5),n)]],Y:[[new D(R(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new D(R(.5,.5),r),null,[0,Math.PI/2,0]]],E:[[new D(R(.75,1),l),null,[0,Math.PI/2,0]]]},S={AXIS:[[new Ut(f,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},w={XYZE:[[new D(new vo(.25,10,8),s)]],X:[[new D(new ge(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new D(new ge(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new D(new ge(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new D(new ge(.75,.1,2,24),s)]]},y={X:[[new D(C,n),[.5,0,0],[0,0,-Math.PI/2]],[new D(m,n),[0,0,0],[0,0,-Math.PI/2]],[new D(C,n),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new D(C,o),[0,.5,0]],[new D(m,o)],[new D(C,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new D(C,r),[0,0,.5],[Math.PI/2,0,0]],[new D(m,r),[0,0,0],[Math.PI/2,0,0]],[new D(C,r),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new D(new it(.15,.15,.01),d),[.15,.15,0]]],YZ:[[new D(new it(.15,.15,.01),a),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new D(new it(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new D(new it(.1,.1,.1),E.clone())]]},L={X:[[new D(new rt(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new D(new rt(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new D(new rt(.2,0,.6,4),s),[0,.3,0]],[new D(new rt(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new D(new rt(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new D(new rt(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new D(new it(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new D(new it(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new D(new it(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new D(new it(.2,.2,.2),s),[0,0,0]]]},P={X:[[new Ut(f,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ut(f,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ut(f,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function U(x){const Y=new Fs;for(const z in x)for(let tt=x[z].length;tt--;){const H=x[z][tt][0].clone(),Mt=x[z][tt][1],Vt=x[z][tt][2],Ht=x[z][tt][3],We=x[z][tt][4];H.name=z,H.tag=We,Mt&&H.position.set(Mt[0],Mt[1],Mt[2]),Vt&&H.rotation.set(Vt[0],Vt[1],Vt[2]),Ht&&H.scale.set(Ht[0],Ht[1],Ht[2]),H.updateMatrix();const Ae=H.geometry.clone();Ae.applyMatrix4(H.matrix),H.geometry=Ae,H.renderOrder=1/0,H.position.set(0,0,0),H.rotation.set(0,0,0),H.scale.set(1,1,1),Y.add(H)}return Y}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=U(p)),this.add(this.gizmo.rotate=U(_)),this.add(this.gizmo.scale=U(y)),this.add(this.picker.translate=U(A)),this.add(this.picker.rotate=U(w)),this.add(this.picker.scale=U(L)),this.add(this.helper.translate=U(g)),this.add(this.helper.rotate=U(S)),this.add(this.helper.scale=U(P)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(t){const e=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:Rs;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let i=0;i<s.length;i++){const n=s[i];n.visible=!0,n.rotation.set(0,0,0),n.position.copy(this.worldPosition);let o;if(this.camera.isOrthographicCamera?o=(this.camera.top-this.camera.bottom)/this.camera.zoom:o=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),n.scale.set(1,1,1).multiplyScalar(o*this.size/4),n.tag==="helper"){n.visible=!1,n.name==="AXIS"?(n.visible=!!this.axis,this.axis==="X"&&(Q.setFromEuler(ps.set(0,0,0)),n.quaternion.copy(e).multiply(Q),Math.abs(k.copy(ve).applyQuaternion(e).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="Y"&&(Q.setFromEuler(ps.set(0,0,Math.PI/2)),n.quaternion.copy(e).multiply(Q),Math.abs(k.copy(Qt).applyQuaternion(e).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="Z"&&(Q.setFromEuler(ps.set(0,Math.PI/2,0)),n.quaternion.copy(e).multiply(Q),Math.abs(k.copy(Be).applyQuaternion(e).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="XYZE"&&(Q.setFromEuler(ps.set(0,Math.PI/2,0)),k.copy(this.rotationAxis),n.quaternion.setFromRotationMatrix(wn.lookAt(Nn,k,Qt)),n.quaternion.multiply(Q),n.visible=this.dragging),this.axis==="E"&&(n.visible=!1)):n.name==="START"?(n.position.copy(this.worldPositionStart),n.visible=this.dragging):n.name==="END"?(n.position.copy(this.worldPosition),n.visible=this.dragging):n.name==="DELTA"?(n.position.copy(this.worldPositionStart),n.quaternion.copy(this.worldQuaternionStart),nt.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),nt.applyQuaternion(this.worldQuaternionStart.clone().invert()),n.scale.copy(nt),n.visible=this.dragging):(n.quaternion.copy(e),this.dragging?n.position.copy(this.worldPositionStart):n.position.copy(this.worldPosition),this.axis&&(n.visible=this.axis.search(n.name)!==-1));continue}n.quaternion.copy(e),this.mode==="translate"||this.mode==="scale"?(n.name==="X"&&Math.abs(k.copy(ve).applyQuaternion(e).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="Y"&&Math.abs(k.copy(Qt).applyQuaternion(e).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="Z"&&Math.abs(k.copy(Be).applyQuaternion(e).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="XY"&&Math.abs(k.copy(Be).applyQuaternion(e).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="YZ"&&Math.abs(k.copy(ve).applyQuaternion(e).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="XZ"&&Math.abs(k.copy(Qt).applyQuaternion(e).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1)):this.mode==="rotate"&&(Cs.copy(e),k.copy(this.eye).applyQuaternion(Q.copy(e).invert()),n.name.search("E")!==-1&&n.quaternion.setFromRotationMatrix(wn.lookAt(this.eye,Nn,Qt)),n.name==="X"&&(Q.setFromAxisAngle(ve,Math.atan2(-k.y,k.z)),Q.multiplyQuaternions(Cs,Q),n.quaternion.copy(Q)),n.name==="Y"&&(Q.setFromAxisAngle(Qt,Math.atan2(k.x,k.z)),Q.multiplyQuaternions(Cs,Q),n.quaternion.copy(Q)),n.name==="Z"&&(Q.setFromAxisAngle(Be,Math.atan2(k.y,k.x)),Q.multiplyQuaternions(Cs,Q),n.quaternion.copy(Q))),n.visible=n.visible&&(n.name.indexOf("X")===-1||this.showX),n.visible=n.visible&&(n.name.indexOf("Y")===-1||this.showY),n.visible=n.visible&&(n.name.indexOf("Z")===-1||this.showZ),n.visible=n.visible&&(n.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),n.material._color=n.material._color||n.material.color.clone(),n.material._opacity=n.material._opacity||n.material.opacity,n.material.color.copy(n.material._color),n.material.opacity=n.material._opacity,this.enabled&&this.axis&&(n.name===this.axis||this.axis.split("").some(function(r){return n.name===r}))&&(n.material.color.setHex(16776960),n.material.opacity=1)}super.updateMatrixWorld(t)}}class Pa extends D{constructor(){super(new Ri(1e5,1e5,2,2),new Te({visible:!1,wireframe:!0,side:ke,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(t){let e=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(e="local"),Ts.copy(ve).applyQuaternion(e==="local"?this.worldQuaternion:Rs),xe.copy(Qt).applyQuaternion(e==="local"?this.worldQuaternion:Rs),be.copy(Be).applyQuaternion(e==="local"?this.worldQuaternion:Rs),k.copy(xe),this.mode){case"translate":case"scale":switch(this.axis){case"X":k.copy(this.eye).cross(Ts),St.copy(Ts).cross(k);break;case"Y":k.copy(this.eye).cross(xe),St.copy(xe).cross(k);break;case"Z":k.copy(this.eye).cross(be),St.copy(be).cross(k);break;case"XY":St.copy(be);break;case"YZ":St.copy(Ts);break;case"XZ":k.copy(be),St.copy(xe);break;case"XYZ":case"E":St.set(0,0,0);break}break;case"rotate":default:St.set(0,0,0)}St.length()===0?this.quaternion.copy(this.cameraQuaternion):(yn.lookAt(nt.set(0,0,0),St,k),this.quaternion.setFromRotationMatrix(yn)),super.updateMatrixWorld(t)}}class bi{constructor(t,e,s,i,n,o=5,r=!0){if(I(this,"onDraggingStarted",new M),I(this,"onDraggingEnded",new M),I(this,"onDisposed",new M),I(this,"normal"),I(this,"origin"),I(this,"three",new fe),I(this,"_helper"),I(this,"_visible",!0),I(this,"_enabled",!0),I(this,"components"),I(this,"world"),I(this,"_controlsActive",!1),I(this,"_arrowBoundBox",new D),I(this,"_planeMesh"),I(this,"_controls"),I(this,"_hiddenMaterial",new Te({visible:!1})),I(this,"update",()=>{this._enabled&&this.three.setFromNormalAndCoplanarPoint(this.normal,this._helper.position)}),I(this,"changeDrag",a=>{this._visible=!a.value,this.preventCameraMovement(),this.notifyDraggingChanged(a)}),this.components=t,this.world=e,!e.renderer)throw new Error("The given world must have a renderer!");this.normal=i,this.origin=s,e.renderer.setPlane(!0,this.three),this._planeMesh=bi.newPlaneMesh(o,n),this._helper=this.newHelper(),this._controls=this.newTransformControls(),this.three.setFromNormalAndCoplanarPoint(i,s),r&&this.toggleControls(!0)}get enabled(){return this._enabled}set enabled(t){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");this._enabled=t,this.world.renderer.setPlane(t,this.three)}get visible(){return this._visible}set visible(t){this._visible=t,this._controls.visible=t,this._helper.visible=t,this.toggleControls(t)}get meshes(){return[this._planeMesh,this._arrowBoundBox]}get planeMaterial(){return this._planeMesh.material}set planeMaterial(t){this._planeMesh.material=t}get size(){return this._planeMesh.scale.x}set size(t){this._planeMesh.scale.set(t,t,t)}get helper(){return this._helper}setFromNormalAndCoplanarPoint(t,e){this.reset(),this.normal.equals(t)||(this.normal.copy(t),this._helper.lookAt(t)),this.origin.copy(e),this._helper.position.copy(e),this._helper.updateMatrix(),this.update()}dispose(){this._enabled=!1,this.onDraggingStarted.reset(),this.onDraggingEnded.reset(),this._helper.removeFromParent(),this.world.renderer&&this.world.renderer.setPlane(!1,this.three),this._arrowBoundBox.removeFromParent(),this._arrowBoundBox.geometry.dispose(),this._planeMesh.geometry.dispose(),this._controls.removeFromParent(),this._controls.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}reset(){const t=new O(1,0,0),e=new O;this.normal.equals(t)||(this.normal.copy(t),this._helper.lookAt(t)),this.origin.copy(e),this._helper.position.copy(e),this._helper.updateMatrix()}toggleControls(t){if(t){if(this._controlsActive)return;this._controls.addEventListener("change",this.update),this._controls.addEventListener("dragging-changed",this.changeDrag)}else this._controls.removeEventListener("change",this.update),this._controls.removeEventListener("dragging-changed",this.changeDrag);this._controlsActive=t}newTransformControls(){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");const t=this.world.camera.three,e=this.world.renderer.three.domElement,s=new Oa(t,e);return this.initializeControls(s),this.world.scene.three.add(s),s}initializeControls(t){t.attach(this._helper),t.showX=!1,t.showY=!1,t.setSpace("local"),this.createArrowBoundingBox(),t.children[0].children[0].add(this._arrowBoundBox)}createArrowBoundingBox(){this._arrowBoundBox.geometry=new rt(.18,.18,1.2),this._arrowBoundBox.material=this._hiddenMaterial,this._arrowBoundBox.rotateX(Math.PI/2),this._arrowBoundBox.updateMatrix(),this._arrowBoundBox.geometry.applyMatrix4(this._arrowBoundBox.matrix)}notifyDraggingChanged(t){t.value?this.onDraggingStarted.trigger():this.onDraggingEnded.trigger()}preventCameraMovement(){this.world.camera.enabled=this._visible}newHelper(){const t=new Fs;return t.lookAt(this.normal),t.position.copy(this.origin),this._planeMesh.position.z+=.01,t.add(this._planeMesh),this.world.scene.three.add(t),t}static newPlaneMesh(t,e){const s=new Ri(1),i=new D(s,e);return i.scale.set(t,t,t),i}}const jn=class Ii extends q{constructor(t){super(t),I(this,"onAfterCreate",new M),I(this,"onAfterDelete",new M),I(this,"onBeforeDrag",new M),I(this,"onAfterDrag",new M),I(this,"onBeforeCreate",new M),I(this,"onBeforeCancel",new M),I(this,"onAfterCancel",new M),I(this,"onBeforeDelete",new M),I(this,"onDisposed",new M),I(this,"orthogonalY",!1),I(this,"toleranceOrthogonalY",.7),I(this,"Type",bi),I(this,"list",[]),I(this,"_material",new Te({color:12255487,side:ke,transparent:!0,opacity:.2})),I(this,"_size",5),I(this,"_enabled",!1),I(this,"_visible",!0),I(this,"_onStartDragging",()=>{this.onBeforeDrag.trigger()}),I(this,"_onEndDragging",()=>{this.onAfterDrag.trigger()}),this.components.add(Ii.uuid,this)}get enabled(){return this._enabled}set enabled(t){this._enabled=t;for(const e of this.list)e.enabled=t;this.updateMaterialsAndPlanes()}get visible(){return this._visible}set visible(t){this._visible=t;for(const e of this.list)e.visible=t}get material(){return this._material}set material(t){this._material=t;for(const e of this.list)e.planeMaterial=t}get size(){return this._size}set size(t){this._size=t;for(const e of this.list)e.size=t}dispose(){this._enabled=!1;for(const t of this.list)t.dispose();this.list.length=0,this._material.dispose(),this.onBeforeCreate.reset(),this.onBeforeCancel.reset(),this.onBeforeDelete.reset(),this.onBeforeDrag.reset(),this.onAfterCreate.reset(),this.onAfterCancel.reset(),this.onAfterDelete.reset(),this.onAfterDrag.reset(),this.onDisposed.trigger(Ii.uuid),this.onDisposed.reset()}create(t){if(!this.enabled)return;const e=this.components.get(Ei).get(t).castRay();e&&this.createPlaneFromIntersection(t,e)}createFromNormalAndCoplanarPoint(t,e,s){const i=this.newPlane(t,s,e);return this.updateMaterialsAndPlanes(),i}delete(t,e){this.enabled&&(e||(e=this.pickPlane(t)),e&&this.deletePlane(e))}deleteAll(){for(;this.list.length>0;){const t=this.list[0];this.delete(t.world,t)}}deletePlane(t){const e=this.list.indexOf(t);if(e!==-1){if(this.list.splice(e,1),!t.world.renderer)throw new Error("Renderer not found for this plane's world!");t.world.renderer.setPlane(!1,t.three),t.dispose(),this.updateMaterialsAndPlanes(),this.onAfterDelete.trigger(t)}}pickPlane(t){const e=this.components.get(Ei).get(t),s=this.getAllPlaneMeshes(),i=e.castRay(s);if(i){const n=i.object;return this.list.find(o=>o.meshes.includes(n))}}getAllPlaneMeshes(){const t=[];for(const e of this.list)t.push(...e.meshes);return t}createPlaneFromIntersection(t,e){var s;if(!t.renderer)throw new Error("The given world must have a renderer!");const i=e.point.distanceTo(new O(0,0,0)),n=(s=e.face)==null?void 0:s.normal;if(!i||!n)return;const o=this.getWorldNormal(e,n),r=this.newPlane(t,e.point,o.negate());r.visible=this._visible,r.size=this._size,t.renderer.setPlane(!0,r.three),this.updateMaterialsAndPlanes()}getWorldNormal(t,e){const s=t.object;let i=t.object.matrixWorld.clone();if(s instanceof Ge&&t.instanceId!==void 0){const r=new X;s.getMatrixAt(t.instanceId,r),i=r.multiply(i)}const n=new jt().getNormalMatrix(i),o=e.clone().applyMatrix3(n).normalize();return this.normalizePlaneDirectionY(o),o}normalizePlaneDirectionY(t){this.orthogonalY&&(t.y>this.toleranceOrthogonalY&&(t.x=0,t.y=1,t.z=0),t.y<-this.toleranceOrthogonalY&&(t.x=0,t.y=-1,t.z=0))}newPlane(t,e,s){const i=new this.Type(this.components,t,e,s,this._material);return i.onDraggingStarted.add(this._onStartDragging),i.onDraggingEnded.add(this._onEndDragging),this.list.push(i),this.onAfterCreate.trigger(i),i}updateMaterialsAndPlanes(){const t=this.components.get(Aa);for(const[e,s]of t.list){if(!s.renderer)continue;s.renderer.updateClippingPlanes();const{clippingPlanes:i}=s.renderer;for(const n of s.meshes)if(Array.isArray(n.material))for(const o of n.material)o.clippingPlanes=i;else n.material.clippingPlanes=i}}};I(jn,"uuid","66290bc5-18c4-4cd1-9379-2e17a0617611");let ih=jn;function Ma(h,t,e,s){return new Promise((i,n)=>{function o(){const r=h.clientWaitSync(t,e,0);if(r===h.WAIT_FAILED){n();return}if(r===h.TIMEOUT_EXPIRED){setTimeout(o,s);return}i()}o()})}async function Ua(h,t,e,s,i,n,o){const r=h.fenceSync(h.SYNC_GPU_COMMANDS_COMPLETE,0);h.flush(),await Ma(h,r,0,10),h.deleteSync(r),h.bindBuffer(t,e),h.getBufferSubData(t,s,i,n,o),h.bindBuffer(t,null)}async function Da(h,t,e,s,i,n,o,r){const a=h.createBuffer();return h.bindBuffer(h.PIXEL_PACK_BUFFER,a),h.bufferData(h.PIXEL_PACK_BUFFER,r.byteLength,h.STREAM_READ),h.readPixels(t,e,s,i,n,o,0),h.bindBuffer(h.PIXEL_PACK_BUFFER,null),await Ua(h,h.PIXEL_PACK_BUFFER,a,0,r),h.deleteBuffer(a),r}class xa{constructor(t,e,s){if(I(this,"onDisposed",new M),I(this,"onViewUpdated",new Kt),I(this,"enabled",!0),I(this,"needsUpdate",!1),I(this,"renderDebugFrame",!1),I(this,"components"),I(this,"world"),I(this,"renderer"),I(this,"autoUpdate",!0),I(this,"updateInterval",1e3),I(this,"worker"),I(this,"scene",new mi),I(this,"_width",512),I(this,"_height",512),I(this,"_availableColor",1),I(this,"renderTarget"),I(this,"bufferSize"),I(this,"_buffer"),I(this,"_isWorkerBusy",!1),I(this,"updateVisibility",async o=>{if(!this.enabled||!this.needsUpdate&&!o||this._isWorkerBusy)return;this._isWorkerBusy=!0;const r=this.world.camera.three;r.updateMatrix(),this.renderer.setSize(this._width,this._height),this.renderer.setRenderTarget(this.renderTarget),this.renderer.render(this.scene,r);const a=this.renderer.getContext();await Da(a,0,0,this._width,this._height,a.RGBA,a.UNSIGNED_BYTE,this._buffer),this.renderer.setRenderTarget(null),this.renderDebugFrame&&this.renderer.render(this.scene,r),this.worker.postMessage({buffer:this._buffer}),this.needsUpdate=!1}),!e.renderer)throw new Error("The given world must have a renderer!");this.components=t,this.applySettings(s),this.world=e,this.renderer=new As,this.renderTarget=new Bo(this._width,this._height),this.bufferSize=this._width*this._height*4,this._buffer=new Uint8Array(this.bufferSize),this.renderer.clippingPlanes=e.renderer.clippingPlanes;const i=`
      addEventListener("message", (event) => {
        const { buffer } = event.data;
        const colors = new Map();
        for (let i = 0; i < buffer.length; i += 4) {
          const r = buffer[i];
          const g = buffer[i + 1];
          const b = buffer[i + 2];
          const code = "" + r + "-" + g + "-" + b;
          if(colors.has(code)) {
            colors.set(code, colors.get(code) + 1);
          } else {
            colors.set(code, 1);
          }
        }
        postMessage({ colors });
      });
    `,n=new Blob([i],{type:"application/javascript"});this.worker=new Worker(URL.createObjectURL(n))}dispose(){this.enabled=!1;for(const t of this.scene.children)t.removeFromParent();this.onViewUpdated.reset(),this.worker.terminate(),this.renderer.dispose(),this.renderTarget.dispose(),this._buffer=null,this.onDisposed.reset()}getAvailableColor(){let t=BigInt(this._availableColor.toString());const e=[];do e.unshift(Number(t%256n)),t/=256n;while(t);for(;e.length!==3;)e.unshift(0);const[s,i,n]=e,o=`${s}-${i}-${n}`;return{r:s,g:i,b:n,code:o}}increaseColor(){if(this._availableColor===256*256*256){console.warn("Color can't be increased over 256 x 256 x 256!");return}this._availableColor++}decreaseColor(){if(this._availableColor===1){console.warn("Color can't be decreased under 0!");return}this._availableColor--}applySettings(t){t&&(t.updateInterval!==void 0&&(this.updateInterval=t.updateInterval),t.height!==void 0&&(this._height=t.height),t.width!==void 0&&(this._width=t.width),t.autoUpdate!==void 0&&(this.autoUpdate=t.autoUpdate))}}class ba extends xa{constructor(t,e,s){super(t,e,s),I(this,"threshold",100),I(this,"onViewUpdated",new M),I(this,"colorMeshes",new Map),I(this,"isProcessing",!1),I(this,"_colorCodeMeshMap",new Map),I(this,"_meshIDColorCodeMap",new Map),I(this,"_currentVisibleMeshes",new Set),I(this,"_recentlyHiddenMeshes",new Set),I(this,"_intervalID",null),I(this,"_transparentMat",new Te({transparent:!0,opacity:0})),I(this,"handleWorkerMessage",async i=>{if(this.isProcessing)return;const n=i.data.colors;this._recentlyHiddenMeshes=new Set(this._currentVisibleMeshes),this._currentVisibleMeshes.clear();for(const[o,r]of n){if(r<this.threshold)continue;const a=this._colorCodeMeshMap.get(o);a&&(this._currentVisibleMeshes.add(a),this._recentlyHiddenMeshes.delete(a))}this.onViewUpdated.trigger({seen:this._currentVisibleMeshes,unseen:this._recentlyHiddenMeshes}),this._isWorkerBusy=!1}),this.worker.addEventListener("message",this.handleWorkerMessage),this.autoUpdate&&window.setInterval(async()=>{this.isProcessing||await this.updateVisibility()},this.updateInterval),this.onViewUpdated.add(({seen:i,unseen:n})=>{for(const o of i)o.visible=!0;for(const o of n)o.visible=!1})}dispose(){super.dispose(),this._intervalID!==null&&(window.clearInterval(this._intervalID),this._intervalID=null),this._currentVisibleMeshes.clear(),this._recentlyHiddenMeshes.clear(),this._meshIDColorCodeMap.clear(),this._transparentMat.dispose(),this._colorCodeMeshMap.clear();const t=this.components.get(me);for(const e in this.colorMeshes){const s=this.colorMeshes.get(e);s&&t.destroy(s,!0)}this.colorMeshes.clear()}add(t){if(!this.enabled)return;if(this.isProcessing){console.log("Culler processing not finished yet.");return}this.isProcessing=!0;const e=t instanceof Ge,{geometry:s,material:i}=t,{colorMaterial:n,code:o}=this.getAvailableMaterial();let r;if(Array.isArray(i)){let d=!0;const E=[];for(const l of i)un.isTransparent(l)?E.push(this._transparentMat):(d=!1,E.push(n));if(d){n.dispose(),this.isProcessing=!1;return}r=E}else if(un.isTransparent(i)){n.dispose(),this.isProcessing=!1;return}else r=n;this._colorCodeMeshMap.set(o,t),this._meshIDColorCodeMap.set(t.uuid,o);const a=e?t.count:1,c=new Ge(s,r,a);e?c.instanceMatrix=t.instanceMatrix:c.setMatrixAt(0,new X),t.visible=!1,c.applyMatrix4(t.matrix),c.updateMatrix(),this.scene.add(c),this.colorMeshes.set(t.uuid,c),this.increaseColor(),this.isProcessing=!1}remove(t){if(this.isProcessing){console.log("Culler processing not finished yet.");return}this.isProcessing=!0;const e=this.components.get(me);this._currentVisibleMeshes.delete(t),this._recentlyHiddenMeshes.delete(t);const s=this.colorMeshes.get(t.uuid),i=this._meshIDColorCodeMap.get(t.uuid);if(!s||!i){this.isProcessing=!1,console.log(t.visible);return}this._colorCodeMeshMap.delete(i),this._meshIDColorCodeMap.delete(t.uuid),this.colorMeshes.delete(t.uuid),s.geometry=void 0,s.material=[],e.destroy(s,!0),this._recentlyHiddenMeshes.delete(t),this._currentVisibleMeshes.delete(t),this.isProcessing=!1}getAvailableMaterial(){const{r:t,g:e,b:s,code:i}=this.getAvailableColor(),n=Ms.enabled;Ms.enabled=!1;const o=new qt(`rgb(${t}, ${e}, ${s})`);if(!this.world.renderer)throw new Error("Renderer not found in the world!");const r=this.world.renderer.clippingPlanes,a=new Te({color:o,clippingPlanes:r,side:ke});return Ms.enabled=n,{colorMaterial:a,code:i}}}const qn=class ui extends q{constructor(t){super(t),I(this,"_enabled",!0),I(this,"list",new Map),I(this,"onDisposed",new M),t.add(ui.uuid,this)}get enabled(){return this._enabled}set enabled(t){this._enabled=t;for(const[e,s]of this.list)s.enabled=t}create(t,e){if(this.list.has(t.uuid))return this.list.get(t.uuid);const s=new ba(this.components,t,e);return this.list.set(t.uuid,s),s}delete(t){const e=this.list.get(t.uuid);e&&e.dispose(),this.list.delete(t.uuid)}dispose(){this.enabled=!1,this.onDisposed.trigger(ui.uuid),this.onDisposed.reset();for(const[t,e]of this.list)e.dispose();this.list.clear()}};I(qn,"uuid","69f2a50d-c266-44fc-b1bd-fa4d34be89e6");let va=qn;class Ba{constructor(t){if(I(this,"onDisposed",new M),I(this,"onAfterUpdate",new M),I(this,"onBeforeUpdate",new M),I(this,"onResize",new M),I(this,"frontOffset",0),I(this,"overrideMaterial",new Yo),I(this,"backgroundColor",new qt(395274)),I(this,"renderer"),I(this,"enabled",!0),I(this,"world"),I(this,"_lockRotation",!0),I(this,"_camera"),I(this,"_plane"),I(this,"_size",new Ft(320,160)),I(this,"_tempVector1",new O),I(this,"_tempVector2",new O),I(this,"_tempTarget",new O),I(this,"down",new O(0,-1,0)),I(this,"updatePlanes",()=>{if(!this.world.renderer)throw new Error("The given world must have a renderer!");const i=[],n=this.world.renderer.three;for(const o of n.clippingPlanes)i.push(o);i.push(this._plane),this.renderer.clippingPlanes=i}),this.world=t,!this.world.renderer)throw new Error("The given world must have a renderer!");this.renderer=new As,this.renderer.setSize(this._size.x,this._size.y);const e=1,s=this._size.x/this._size.y;this._camera=new fi(e*s/-2,e*s/2,e/2,e/-2),this.world.renderer.onClippingPlanesUpdated.add(this.updatePlanes),this._camera.position.set(0,200,0),this._camera.zoom=.1,this._camera.rotation.x=-Math.PI/2,this._plane=new fe(this.down,200),this.updatePlanes()}get lockRotation(){return this._lockRotation}set lockRotation(t){this._lockRotation=t,t&&(this._camera.rotation.z=0)}get zoom(){return this._camera.zoom}set zoom(t){this._camera.zoom=t,this._camera.updateProjectionMatrix()}dispose(){this.enabled=!1,this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.onResize.reset(),this.overrideMaterial.dispose(),this.renderer.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get(){return this._camera}update(){if(!this.enabled)return;this.onBeforeUpdate.trigger();const t=this.world.scene.three,e=this.world.camera;if(!e.hasCameraControls())throw new Error("The given world must use camera controls!");if(!(t instanceof mi))throw new Error("The given world must have a THREE.Scene as a root!");const s=e.controls;if(s.getPosition(this._tempVector1),this._camera.position.x=this._tempVector1.x,this._camera.position.z=this._tempVector1.z,this.frontOffset!==0&&(s.getTarget(this._tempVector2),this._tempVector2.sub(this._tempVector1),this._tempVector2.normalize().multiplyScalar(this.frontOffset),this._camera.position.x+=this._tempVector2.x,this._camera.position.z+=this._tempVector2.z),!this._lockRotation){s.getTarget(this._tempTarget);const n=Math.atan2(this._tempTarget.x-this._tempVector1.x,this._tempTarget.z-this._tempVector1.z);this._camera.rotation.z=n+Math.PI}this._plane.set(this.down,this._tempVector1.y);const i=t.background;t.background=this.backgroundColor,this.renderer.render(t,this._camera),t.background=i,this.onAfterUpdate.trigger()}getSize(){return this._size}resize(t=this._size){this._size.copy(t),this.renderer.setSize(t.x,t.y);const e=t.x/t.y,s=1;this._camera.left=s*e/-2,this._camera.right=s*e/2,this._camera.top=s/2,this._camera.bottom=-s/2,this._camera.updateProjectionMatrix(),this.onResize.trigger(t)}}const Kn=class $n extends q{constructor(t){super(t),I(this,"onAfterUpdate",new M),I(this,"onBeforeUpdate",new M),I(this,"onDisposed",new M),I(this,"enabled",!0),I(this,"list",new Map),this.components.add($n.uuid,this)}create(t){if(this.list.has(t.uuid))throw new Error("This world already has a minimap!");const e=new Ba(t);return this.list.set(t.uuid,e),e}delete(t){const e=this.list.get(t);e&&e.dispose(),this.list.delete(t)}dispose(){for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger()}update(){for(const[t,e]of this.list)e.update()}};I(Kn,"uuid","39ad6aad-84c8-4adf-a1e0-7f25313a9e7f");let nh=Kn;class Ya{constructor(t){I(this,"enabled",!1),I(this,"id","FirstPerson"),this.camera=t}set(t){if(this.enabled=t,t){if(this.camera.projection.current!=="Perspective"){this.camera.set("Orbit");return}this.setupFirstPersonCamera()}}setupFirstPersonCamera(){const t=this.camera.controls,e=new O;t.distance--,t.getPosition(e),t.minDistance=1,t.maxDistance=1,t.distance=1,t.moveTo(e.x,e.y,e.z),t.truckSpeed=50,t.mouseButtons.wheel=ot.ACTION.DOLLY,t.touches.two=ot.ACTION.TOUCH_ZOOM_TRUCK}}class za{constructor(t){I(this,"enabled",!0),I(this,"id","Orbit"),this.camera=t,this.activateOrbitControls()}set(t){this.enabled=t,t&&this.activateOrbitControls()}activateOrbitControls(){const t=this.camera.controls;t.minDistance=1,t.maxDistance=300;const e=new O;t.getPosition(e);const s=e.length();t.distance=s,t.truckSpeed=2;const{rotation:i}=this.camera.three,n=new O(0,0,-1).applyEuler(i),o=e.addScaledVector(n,s);t.moveTo(o.x,o.y,o.z)}}class Ga{constructor(t){I(this,"enabled",!1),I(this,"id","Plan"),I(this,"mouseAction1"),I(this,"mouseAction2"),I(this,"mouseInitialized",!1),I(this,"defaultAzimuthSpeed"),I(this,"defaultPolarSpeed"),this.camera=t,this.defaultAzimuthSpeed=t.controls.azimuthRotateSpeed,this.defaultPolarSpeed=t.controls.polarRotateSpeed}set(t){this.enabled=t;const e=this.camera.controls;e.azimuthRotateSpeed=t?0:this.defaultAzimuthSpeed,e.polarRotateSpeed=t?0:this.defaultPolarSpeed,this.mouseInitialized||(this.mouseAction1=e.touches.one,this.mouseAction2=e.touches.two,this.mouseInitialized=!0),t?(e.mouseButtons.left=ot.ACTION.TRUCK,e.touches.one=ot.ACTION.TOUCH_TRUCK,e.touches.two=ot.ACTION.TOUCH_ZOOM):(e.mouseButtons.left=ot.ACTION.ROTATE,e.touches.one=this.mouseAction1,e.touches.two=this.mouseAction2)}}class Va{constructor(t){I(this,"onChanged",new M),I(this,"current","Perspective"),I(this,"camera"),I(this,"_component"),I(this,"_previousDistance",-1),I(this,"matchOrthoDistanceEnabled",!1),this._component=t,this.camera=t.three}async set(t){this.current!==t&&(t==="Orthographic"?this.setOrthoCamera():await this.setPerspectiveCamera(),this.onChanged.trigger(this.camera))}async toggle(){const t=this.current==="Perspective"?"Orthographic":"Perspective";await this.set(t)}setOrthoCamera(){if(this._component.mode===null||this._component.mode.id==="FirstPerson")return;this._previousDistance=this._component.controls.distance,this._component.controls.distance=200;const t=this.getPerspectiveDims();if(!t)return;const{width:e,height:s}=t;this.setupOrthoCamera(s,e),this.camera=this._component.threeOrtho,this.current="Orthographic"}getPerspectiveDims(){const t=this._component.currentWorld;if(!t||!t.renderer)return null;const e=new O;this._component.threePersp.getWorldDirection(e);const s=new O;this._component.controls.getTarget(s);const i=s.clone().sub(this._component.threePersp.position).dot(e),n=t.renderer.getSize(),o=n.x/n.y,r=this._component.threePersp,a=i*2*Math.atan(r.fov*(Math.PI/180)/2);return{width:a*o,height:a}}setupOrthoCamera(t,e){this._component.controls.mouseButtons.wheel=ot.ACTION.ZOOM,this._component.controls.mouseButtons.middle=ot.ACTION.ZOOM;const s=this._component.threePersp,i=this._component.threeOrtho;i.zoom=1,i.left=e/-2,i.right=e/2,i.top=t/2,i.bottom=t/-2,i.updateProjectionMatrix(),i.position.copy(s.position),i.quaternion.copy(s.quaternion),this._component.controls.camera=i}getDistance(){const t=this._component.threePersp,e=this._component.threeOrtho;return(e.top-e.bottom)/e.zoom/(2*Math.atan(t.fov*(Math.PI/180)/2))}async setPerspectiveCamera(){this._component.controls.mouseButtons.wheel=ot.ACTION.DOLLY,this._component.controls.mouseButtons.middle=ot.ACTION.DOLLY;const t=this._component.threePersp,e=this._component.threeOrtho;t.position.copy(e.position),t.quaternion.copy(e.quaternion),this._component.controls.mouseButtons.wheel=ot.ACTION.DOLLY,this.matchOrthoDistanceEnabled?this._component.controls.distance=this.getDistance():this._component.controls.distance=this._previousDistance,await this._component.controls.zoomTo(1),t.updateProjectionMatrix(),this._component.controls.camera=t,this.camera=t,this.current="Perspective"}}class oh extends He{constructor(t){super(t),I(this,"_mode",null),I(this,"projection"),I(this,"threeOrtho"),I(this,"threePersp"),I(this,"_userInputButtons",{}),I(this,"_frustumSize",50),I(this,"_navigationModes",new Map),I(this,"previousSize",null),this.threePersp=this.three,this.threeOrtho=this.newOrthoCamera(),this.projection=new Va(this),this.onAspectUpdated.add(()=>{this.setOrthoPerspCameraAspect()}),this.projection.onChanged.add(e=>{this.three=e,this.updateAspect()}),this.onWorldChanged.add(()=>{this._navigationModes.clear(),this._navigationModes.set("Orbit",new za(this)),this._navigationModes.set("FirstPerson",new Ya(this)),this._navigationModes.set("Plan",new Ga(this)),this._mode=this._navigationModes.get("Orbit"),this.mode.set(!0,{preventTargetAdjustment:!0}),this.currentWorld&&this.currentWorld.renderer&&(this.previousSize=this.currentWorld.renderer.getSize().clone())})}get mode(){if(!this._mode)throw new Error("Mode not found, camera not initialized");return this._mode}dispose(){super.dispose(),this.threeOrtho.removeFromParent()}set(t){if(this.mode!==null&&this.mode.id!==t){if(this.mode.set(!1),!this._navigationModes.has(t))throw new Error("The specified mode does not exist!");this._mode=this._navigationModes.get(t),this.mode.set(!0)}}async fit(t,e=1.5){if(!this.enabled)return;const s=Number.MAX_VALUE,i=Number.MIN_VALUE,n=new O(s,s,s),o=new O(i,i,i);for(const l of t){const u=new st().setFromObject(l);u.min.x<n.x&&(n.x=u.min.x),u.min.y<n.y&&(n.y=u.min.y),u.min.z<n.z&&(n.z=u.min.z),u.max.x>o.x&&(o.x=u.max.x),u.max.y>o.y&&(o.y=u.max.y),u.max.z>o.z&&(o.z=u.max.z)}const r=new st(n,o),a=new O;r.getSize(a);const c=new O;r.getCenter(c);const d=Math.max(a.x,a.y,a.z)*e,E=new Os(c,d);await this.controls.fitToSphere(E,!0)}setUserInput(t){t?this.enableUserInput():this.disableUserInput()}disableUserInput(){this._userInputButtons.left=this.controls.mouseButtons.left,this._userInputButtons.right=this.controls.mouseButtons.right,this._userInputButtons.middle=this.controls.mouseButtons.middle,this._userInputButtons.wheel=this.controls.mouseButtons.wheel,this.controls.mouseButtons.left=0,this.controls.mouseButtons.right=0,this.controls.mouseButtons.middle=0,this.controls.mouseButtons.wheel=0}enableUserInput(){Object.keys(this._userInputButtons).length!==0&&(this.controls.mouseButtons.left=this._userInputButtons.left,this.controls.mouseButtons.right=this._userInputButtons.right,this.controls.mouseButtons.middle=this._userInputButtons.middle,this.controls.mouseButtons.wheel=this._userInputButtons.wheel)}newOrthoCamera(){const t=window.innerWidth/window.innerHeight;return new fi(this._frustumSize*t/-2,this._frustumSize*t/2,this._frustumSize/2,this._frustumSize/-2,.1,1e3)}setOrthoPerspCameraAspect(){if(!this.currentWorld||!this.currentWorld.renderer||!this.previousSize)return;const t=this.currentWorld.renderer.getSize(),e=this.threeOrtho.top,s=this.threeOrtho.right,i=t.y/this.previousSize.y,n=t.x/this.previousSize.x,o=e*i,r=s*n;this.threeOrtho.left=-r,this.threeOrtho.right=r,this.threeOrtho.top=o,this.threeOrtho.bottom=-o,this.threeOrtho.updateProjectionMatrix(),this.previousSize.copy(t)}}const Jn=class Lt extends q{constructor(t){super(t),I(this,"enabled",!0),I(this,"onDisposed",new M),I(this,"_absoluteMin"),I(this,"_absoluteMax"),I(this,"_meshes",[]),this.components.add(Lt.uuid,this),this._absoluteMin=Lt.newBound(!0),this._absoluteMax=Lt.newBound(!1)}static getDimensions(t){const{min:e,max:s}=t,i=Math.abs(s.x-e.x),n=Math.abs(s.y-e.y),o=Math.abs(s.z-e.z),r=new O;return r.subVectors(s,e).divideScalar(2).add(e),{width:i,height:n,depth:o,center:r}}static newBound(t){const e=t?1:-1;return new O(e*Number.MAX_VALUE,e*Number.MAX_VALUE,e*Number.MAX_VALUE)}static getBounds(t,e,s){const i=s||this.newBound(!1),n=e||this.newBound(!0);for(const o of t)o.x<n.x&&(n.x=o.x),o.y<n.y&&(n.y=o.y),o.z<n.z&&(n.z=o.z),o.x>i.x&&(i.x=o.x),o.y>i.y&&(i.y=o.y),o.z>i.z&&(i.z=o.z);return new st(e,s)}dispose(){const t=this.components.get(me);for(const e of this._meshes)t.destroy(e);this._meshes=[],this.onDisposed.trigger(Lt.uuid),this.onDisposed.reset()}get(){const t=this._absoluteMin.clone(),e=this._absoluteMax.clone();return new st(t,e)}getSphere(){const t=this._absoluteMin.clone(),e=this._absoluteMax.clone(),s=Math.abs((e.x-t.x)/2),i=Math.abs((e.y-t.y)/2),n=Math.abs((e.z-t.z)/2),o=new O(t.x+s,t.y+i,t.z+n),r=o.distanceTo(t);return new Os(o,r)}getMesh(){const t=new st(this._absoluteMin,this._absoluteMax),e=Lt.getDimensions(t),{width:s,height:i,depth:n,center:o}=e,r=new it(s,i,n),a=new D(r);return this._meshes.push(a),a.position.copy(o),a}reset(){this._absoluteMin=Lt.newBound(!0),this._absoluteMax=Lt.newBound(!1)}add(t){for(const e of t.items)this.addMesh(e.mesh)}addMesh(t,e){if(!t.geometry.index)return;const s=Lt.getFragmentBounds(t);t.updateMatrixWorld();const i=t.matrixWorld,n=new X,o=t instanceof Ge,r=new Set;if(e&&t instanceof Mo)for(const a of e){const c=t.fragment.getInstancesIDs(a);if(c)for(const d of c)r.add(d)}else r.add(0);for(const a of r){const c=s.min.clone(),d=s.max.clone();o&&(t.getMatrixAt(a,n),c.applyMatrix4(n),d.applyMatrix4(n)),c.applyMatrix4(i),d.applyMatrix4(i),c.x<this._absoluteMin.x&&(this._absoluteMin.x=c.x),c.y<this._absoluteMin.y&&(this._absoluteMin.y=c.y),c.z<this._absoluteMin.z&&(this._absoluteMin.z=c.z),c.x>this._absoluteMax.x&&(this._absoluteMax.x=c.x),c.y>this._absoluteMax.y&&(this._absoluteMax.y=c.y),c.z>this._absoluteMax.z&&(this._absoluteMax.z=c.z),d.x>this._absoluteMax.x&&(this._absoluteMax.x=d.x),d.y>this._absoluteMax.y&&(this._absoluteMax.y=d.y),d.z>this._absoluteMax.z&&(this._absoluteMax.z=d.z),d.x<this._absoluteMin.x&&(this._absoluteMin.x=d.x),d.y<this._absoluteMin.y&&(this._absoluteMin.y=d.y),d.z<this._absoluteMin.z&&(this._absoluteMin.z=d.z)}}static getFragmentBounds(t){const e=t.geometry.attributes.position,s=Number.MAX_VALUE,i=-s,n=new O(s,s,s),o=new O(i,i,i);if(!t.geometry.index)throw new Error("Geometry must be indexed!");const r=Array.from(t.geometry.index.array);for(let a=0;a<r.length;a++){if(a%3===0&&r[a]===0&&r[a+1]===0&&r[a+2]===0){a+=2;continue}const c=r[a],d=e.getX(c),E=e.getY(c),l=e.getZ(c);d<n.x&&(n.x=d),E<n.y&&(n.y=E),l<n.z&&(n.z=l),d>o.x&&(o.x=d),E>o.y&&(o.y=E),l>o.z&&(o.z=l)}return new st(n,o)}};I(Jn,"uuid","d1444724-dba6-4cdd-a0c7-68ee1450d166");let rh=Jn;const vi=new Set([1123145078,574549367,1675464909,2059837836,3798115385,32440307,3125803723,3207858831,2740243338,2624227202,4240577450,3615266464,3724593414,220341763,477187591,1878645084,1300840506,3303107099,1607154358,1878645084,846575682,1351298697,2417041796,3049322572,3331915920,1416205885,776857604,3285139300,3958052878,2827736869,2732653382,673634403,3448662350,4142052618,2924175390,803316827,2556980723,1809719519,2205249479,807026263,3737207727,1660063152,2347385850,3940055652,2705031697,3732776249,2485617015,2611217952,1704287377,2937912522,2770003689,1281925730,1484403080,3448662350,4142052618,3800577675,4006246654,3590301190,1383045692,2775532180,2047409740,370225590,3593883385,2665983363,4124623270,812098782,3649129432,987898635,1105321065,3510044353,1635779807,2603310189,3406155212,1310608509,4261334040,2736907675,3649129432,1136057603,1260505505,4182860854,2713105998,2898889636,59481748,3749851601,3486308946,3150382593,1062206242,3264961684,15328376,1485152156,370225590,1981873012,2859738748,45288368,2614616156,2732653382,775493141,2147822146,2601014836,2629017746,1186437898,2367409068,1213902940,3632507154,3900360178,476780140,1472233963,2804161546,3008276851,738692330,374418227,315944413,3905492369,3570813810,2571569899,178912537,2294589976,1437953363,2133299955,572779678,3092502836,388784114,2624227202,1425443689,3057273783,2347385850,1682466193,2519244187,2839578677,3958567839,2513912981,2830218821,427810014]),to=class eo extends q{constructor(t){super(t),I(this,"enabled",!0),t.add(eo.uuid,this)}async export(t,e,s=!1,i=!0){const n={},o=new Set(t.GetIfcEntityList(e)),r=new Set([Si,Ni,wi,yi,$t]);for(const a of r)o.add(a);for(const a of o){if(vi.has(a))continue;const c=r.has(a)&&i,d=t.GetLineIDsWithType(e,a);for(const E of d){const l=t.GetLine(0,E,c,s);n[l.expressID]=l}}return n}};I(to,"uuid","b32c4332-cd67-436e-ba7f-196646c7a635");let Ha=to;const so=class io extends q{constructor(t){super(t),I(this,"onDisposed",new M),I(this,"onFragmentsLoaded",new M),I(this,"onFragmentsDisposed",new M),I(this,"list",new Map),I(this,"groups",new Map),I(this,"enabled",!0),I(this,"baseCoordinationModel",""),I(this,"_loader",new Pn),this.components.add(io.uuid,this)}get meshes(){const t=[];for(const[e,s]of this.list)t.push(s.mesh);return t}dispose(){for(const[t,e]of this.groups)e.dispose(!0);this.baseCoordinationModel="",this.groups.clear(),this.list.clear(),this.onFragmentsLoaded.reset(),this.onFragmentsDisposed.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}disposeGroup(t){const{uuid:e}=t,s=[];for(const i of t.items)s.push(i.id),this.list.delete(i.id);t.dispose(!0),this.groups.delete(t.uuid),this.onFragmentsDisposed.trigger({groupID:e,fragmentIDs:s})}load(t,e){const s={coordinate:!0,...e},{coordinate:i,properties:n,relationsMap:o}=s,r=this._loader.import(t);for(const a of r.items)a.group=r,this.list.set(a.id,a);return i&&this.coordinate([r]),this.groups.set(r.uuid,r),n&&r.setLocalProperties(n),o&&this.components.get(Bi).setRelationMap(r,o),this.onFragmentsLoaded.trigger(r),r}export(t){return this._loader.export(t)}coordinate(t=Array.from(this.groups.values())){if(this.baseCoordinationModel.length===0){const s=t.pop();if(!s)return;this.baseCoordinationModel=s.uuid}if(!t.length)return;const e=this.groups.get(this.baseCoordinationModel);if(!e){console.log("No base model found for coordination!");return}for(const s of t)s!==e&&(s.position.set(0,0,0),s.rotation.set(0,0,0),s.scale.set(1,1,1),s.updateMatrix(),s.applyMatrix4(s.coordinationMatrix.clone().invert()),s.applyMatrix4(e.coordinationMatrix))}};I(so,"uuid","fef46874-46a3-461b-8c44-2922ab77c806");let wt=so;const no={950732822:"IFCURIREFERENCE",4075327185:"IFCTIME",1209108979:"IFCTEMPERATURERATEOFCHANGEMEASURE",3457685358:"IFCSOUNDPRESSURELEVELMEASURE",4157543285:"IFCSOUNDPOWERLEVELMEASURE",2798247006:"IFCPROPERTYSETDEFINITIONSET",1790229001:"IFCPOSITIVEINTEGER",525895558:"IFCNONNEGATIVELENGTHMEASURE",1774176899:"IFCLINEINDEX",1275358634:"IFCLANGUAGEID",2541165894:"IFCDURATION",3701338814:"IFCDAYINWEEKNUMBER",2195413836:"IFCDATETIME",937566702:"IFCDATE",1683019596:"IFCCARDINALPOINTREFERENCE",2314439260:"IFCBINARY",1500781891:"IFCAREADENSITYMEASURE",3683503648:"IFCARCINDEX",4065007721:"IFCYEARNUMBER",1718600412:"IFCWARPINGMOMENTMEASURE",51269191:"IFCWARPINGCONSTANTMEASURE",2593997549:"IFCVOLUMETRICFLOWRATEMEASURE",3458127941:"IFCVOLUMEMEASURE",3345633955:"IFCVAPORPERMEABILITYMEASURE",1278329552:"IFCTORQUEMEASURE",2591213694:"IFCTIMESTAMP",2726807636:"IFCTIMEMEASURE",743184107:"IFCTHERMODYNAMICTEMPERATUREMEASURE",2016195849:"IFCTHERMALTRANSMITTANCEMEASURE",857959152:"IFCTHERMALRESISTANCEMEASURE",2281867870:"IFCTHERMALEXPANSIONCOEFFICIENTMEASURE",2645777649:"IFCTHERMALCONDUCTIVITYMEASURE",232962298:"IFCTHERMALADMITTANCEMEASURE",296282323:"IFCTEXTTRANSFORMATION",603696268:"IFCTEXTFONTNAME",3490877962:"IFCTEXTDECORATION",1460886941:"IFCTEXTALIGNMENT",2801250643:"IFCTEXT",58845555:"IFCTEMPERATUREGRADIENTMEASURE",361837227:"IFCSPECULARROUGHNESS",2757832317:"IFCSPECULAREXPONENT",3477203348:"IFCSPECIFICHEATCAPACITYMEASURE",993287707:"IFCSOUNDPRESSUREMEASURE",846465480:"IFCSOUNDPOWERMEASURE",3471399674:"IFCSOLIDANGLEMEASURE",408310005:"IFCSHEARMODULUSMEASURE",2190458107:"IFCSECTIONALAREAINTEGRALMEASURE",3467162246:"IFCSECTIONMODULUSMEASURE",2766185779:"IFCSECONDINMINUTE",3211557302:"IFCROTATIONALSTIFFNESSMEASURE",1755127002:"IFCROTATIONALMASSMEASURE",2133746277:"IFCROTATIONALFREQUENCYMEASURE",200335297:"IFCREAL",96294661:"IFCRATIOMEASURE",3972513137:"IFCRADIOACTIVITYMEASURE",3665567075:"IFCPRESSUREMEASURE",2169031380:"IFCPRESENTABLETEXT",1364037233:"IFCPOWERMEASURE",1245737093:"IFCPOSITIVERATIOMEASURE",3054510233:"IFCPOSITIVEPLANEANGLEMEASURE",2815919920:"IFCPOSITIVELENGTHMEASURE",4042175685:"IFCPLANEANGLEMEASURE",2642773653:"IFCPLANARFORCEMEASURE",2260317790:"IFCPARAMETERVALUE",929793134:"IFCPHMEASURE",2395907400:"IFCNUMERICMEASURE",2095195183:"IFCNORMALISEDRATIOMEASURE",765770214:"IFCMONTHINYEARNUMBER",2615040989:"IFCMONETARYMEASURE",3114022597:"IFCMOMENTOFINERTIAMEASURE",1648970520:"IFCMOLECULARWEIGHTMEASURE",3177669450:"IFCMOISTUREDIFFUSIVITYMEASURE",1753493141:"IFCMODULUSOFSUBGRADEREACTIONMEASURE",1052454078:"IFCMODULUSOFROTATIONALSUBGRADEREACTIONMEASURE",2173214787:"IFCMODULUSOFLINEARSUBGRADEREACTIONMEASURE",3341486342:"IFCMODULUSOFELASTICITYMEASURE",102610177:"IFCMINUTEINHOUR",3531705166:"IFCMASSPERLENGTHMEASURE",3124614049:"IFCMASSMEASURE",4017473158:"IFCMASSFLOWRATEMEASURE",1477762836:"IFCMASSDENSITYMEASURE",2486716878:"IFCMAGNETICFLUXMEASURE",286949696:"IFCMAGNETICFLUXDENSITYMEASURE",151039812:"IFCLUMINOUSINTENSITYMEASURE",2755797622:"IFCLUMINOUSINTENSITYDISTRIBUTIONMEASURE",2095003142:"IFCLUMINOUSFLUXMEASURE",503418787:"IFCLOGICAL",3086160713:"IFCLINEARVELOCITYMEASURE",1307019551:"IFCLINEARSTIFFNESSMEASURE",2128979029:"IFCLINEARMOMENTMEASURE",191860431:"IFCLINEARFORCEMEASURE",1243674935:"IFCLENGTHMEASURE",3258342251:"IFCLABEL",2054016361:"IFCKINEMATICVISCOSITYMEASURE",3192672207:"IFCISOTHERMALMOISTURECAPACITYMEASURE",3686016028:"IFCIONCONCENTRATIONMEASURE",3809634241:"IFCINTEGERCOUNTRATEMEASURE",1939436016:"IFCINTEGER",2679005408:"IFCINDUCTANCEMEASURE",3358199106:"IFCILLUMINANCEMEASURE",983778844:"IFCIDENTIFIER",2589826445:"IFCHOURINDAY",1158859006:"IFCHEATINGVALUEMEASURE",3113092358:"IFCHEATFLUXDENSITYMEASURE",3064340077:"IFCGLOBALLYUNIQUEID",3044325142:"IFCFREQUENCYMEASURE",1361398929:"IFCFORCEMEASURE",2590844177:"IFCFONTWEIGHT",2715512545:"IFCFONTVARIANT",1102727119:"IFCFONTSTYLE",2078135608:"IFCENERGYMEASURE",2506197118:"IFCELECTRICVOLTAGEMEASURE",2951915441:"IFCELECTRICRESISTANCEMEASURE",3790457270:"IFCELECTRICCURRENTMEASURE",2093906313:"IFCELECTRICCONDUCTANCEMEASURE",3818826038:"IFCELECTRICCHARGEMEASURE",1827137117:"IFCELECTRICCAPACITANCEMEASURE",69416015:"IFCDYNAMICVISCOSITYMEASURE",524656162:"IFCDOSEEQUIVALENTMEASURE",4134073009:"IFCDIMENSIONCOUNT",1514641115:"IFCDESCRIPTIVEMEASURE",300323983:"IFCDAYLIGHTSAVINGHOUR",86635668:"IFCDAYINMONTHNUMBER",94842927:"IFCCURVATUREMEASURE",1778710042:"IFCCOUNTMEASURE",3238673880:"IFCCONTEXTDEPENDENTMEASURE",3812528620:"IFCCOMPOUNDPLANEANGLEMEASURE",2991860651:"IFCCOMPLEXNUMBER",1867003952:"IFCBOXALIGNMENT",2735952531:"IFCBOOLEAN",2650437152:"IFCAREAMEASURE",632304761:"IFCANGULARVELOCITYMEASURE",360377573:"IFCAMOUNTOFSUBSTANCEMEASURE",4182062534:"IFCACCELERATIONMEASURE",3699917729:"IFCABSORBEDDOSEMEASURE",1971632696:"IFCGEOSLICE",2680139844:"IFCGEOMODEL",24726584:"IFCELECTRICFLOWTREATMENTDEVICE",3693000487:"IFCDISTRIBUTIONBOARD",3460952963:"IFCCONVEYORSEGMENT",3999819293:"IFCCAISSONFOUNDATION",3314249567:"IFCBOREHOLE",4196446775:"IFCBEARING",325726236:"IFCALIGNMENT",3425753595:"IFCTRACKELEMENT",991950508:"IFCSIGNAL",3798194928:"IFCREINFORCEDSOIL",3290496277:"IFCRAIL",1383356374:"IFCPAVEMENT",2182337498:"IFCNAVIGATIONELEMENT",234836483:"IFCMOORINGDEVICE",2078563270:"IFCMOBILETELECOMMUNICATIONSAPPLIANCE",1638804497:"IFCLIQUIDTERMINAL",1154579445:"IFCLINEARPOSITIONINGELEMENT",2696325953:"IFCKERB",2713699986:"IFCGEOTECHNICALASSEMBLY",2142170206:"IFCELECTRICFLOWTREATMENTDEVICETYPE",3376911765:"IFCEARTHWORKSFILL",1077100507:"IFCEARTHWORKSELEMENT",3071239417:"IFCEARTHWORKSCUT",479945903:"IFCDISTRIBUTIONBOARDTYPE",3426335179:"IFCDEEPFOUNDATION",1502416096:"IFCCOURSE",2940368186:"IFCCONVEYORSEGMENTTYPE",3203706013:"IFCCAISSONFOUNDATIONTYPE",3862327254:"IFCBUILTSYSTEM",1876633798:"IFCBUILTELEMENT",963979645:"IFCBRIDGEPART",644574406:"IFCBRIDGE",3649138523:"IFCBEARINGTYPE",1662888072:"IFCALIGNMENTVERTICAL",317615605:"IFCALIGNMENTSEGMENT",1545765605:"IFCALIGNMENTHORIZONTAL",4266260250:"IFCALIGNMENTCANT",3956297820:"IFCVIBRATIONDAMPERTYPE",1530820697:"IFCVIBRATIONDAMPER",840318589:"IFCVEHICLE",1953115116:"IFCTRANSPORTATIONDEVICE",618700268:"IFCTRACKELEMENTTYPE",2281632017:"IFCTENDONCONDUITTYPE",3663046924:"IFCTENDONCONDUIT",42703149:"IFCSINESPIRAL",1894708472:"IFCSIGNALTYPE",3599934289:"IFCSIGNTYPE",33720170:"IFCSIGN",1027922057:"IFCSEVENTHORDERPOLYNOMIALSPIRAL",544395925:"IFCSEGMENTEDREFERENCECURVE",3649235739:"IFCSECONDORDERPOLYNOMIALSPIRAL",550521510:"IFCROADPART",146592293:"IFCROAD",3818125796:"IFCRELADHERESTOELEMENT",4021432810:"IFCREFERENT",1891881377:"IFCRAILWAYPART",3992365140:"IFCRAILWAY",1763565496:"IFCRAILTYPE",1946335990:"IFCPOSITIONINGELEMENT",514975943:"IFCPAVEMENTTYPE",506776471:"IFCNAVIGATIONELEMENTTYPE",710110818:"IFCMOORINGDEVICETYPE",1950438474:"IFCMOBILETELECOMMUNICATIONSAPPLIANCETYPE",976884017:"IFCMARINEPART",525669439:"IFCMARINEFACILITY",1770583370:"IFCLIQUIDTERMINALTYPE",2176059722:"IFCLINEARELEMENT",679976338:"IFCKERBTYPE",3948183225:"IFCIMPACTPROTECTIONDEVICETYPE",2568555532:"IFCIMPACTPROTECTIONDEVICE",2898700619:"IFCGRADIENTCURVE",1594536857:"IFCGEOTECHNICALSTRATUM",4230923436:"IFCGEOTECHNICALELEMENT",4228831410:"IFCFACILITYPARTCOMMON",1310830890:"IFCFACILITYPART",24185140:"IFCFACILITY",4234616927:"IFCDIRECTRIXDERIVEDREFERENCESWEPTAREASOLID",1306400036:"IFCDEEPFOUNDATIONTYPE",4189326743:"IFCCOURSETYPE",2000195564:"IFCCOSINESPIRAL",3497074424:"IFCCLOTHOID",1626504194:"IFCBUILTELEMENTTYPE",3651464721:"IFCVEHICLETYPE",1229763772:"IFCTRIANGULATEDIRREGULARNETWORK",3665877780:"IFCTRANSPORTATIONDEVICETYPE",782932809:"IFCTHIRDORDERPOLYNOMIALSPIRAL",2735484536:"IFCSPIRAL",1356537516:"IFCSECTIONEDSURFACE",1290935644:"IFCSECTIONEDSOLIDHORIZONTAL",1862484736:"IFCSECTIONEDSOLID",1441486842:"IFCRELPOSITIONS",1033248425:"IFCRELASSOCIATESPROFILEDEF",3381221214:"IFCPOLYNOMIALCURVE",2485787929:"IFCOFFSETCURVEBYDISTANCES",590820931:"IFCOFFSETCURVE",3465909080:"IFCINDEXEDPOLYGONALTEXTUREMAP",593015953:"IFCDIRECTRIXCURVESWEPTAREASOLID",4212018352:"IFCCURVESEGMENT",3425423356:"IFCAXIS2PLACEMENTLINEAR",823603102:"IFCSEGMENT",2165702409:"IFCPOINTBYDISTANCEEXPRESSION",182550632:"IFCOPENCROSSPROFILEDEF",388784114:"IFCLINEARPLACEMENT",536804194:"IFCALIGNMENTHORIZONTALSEGMENT",3752311538:"IFCALIGNMENTCANTSEGMENT",1010789467:"IFCTEXTURECOORDINATEINDICESWITHVOIDS",222769930:"IFCTEXTURECOORDINATEINDICES",2691318326:"IFCQUANTITYNUMBER",3633395639:"IFCALIGNMENTVERTICALSEGMENT",2879124712:"IFCALIGNMENTPARAMETERSEGMENT",25142252:"IFCCONTROLLER",3087945054:"IFCALARM",4288193352:"IFCACTUATOR",630975310:"IFCUNITARYCONTROLELEMENT",4086658281:"IFCSENSOR",2295281155:"IFCPROTECTIVEDEVICETRIPPINGUNIT",182646315:"IFCFLOWINSTRUMENT",1426591983:"IFCFIRESUPPRESSIONTERMINAL",819412036:"IFCFILTER",3415622556:"IFCFAN",1003880860:"IFCELECTRICTIMECONTROL",402227799:"IFCELECTRICMOTOR",264262732:"IFCELECTRICGENERATOR",3310460725:"IFCELECTRICFLOWSTORAGEDEVICE",862014818:"IFCELECTRICDISTRIBUTIONBOARD",1904799276:"IFCELECTRICAPPLIANCE",1360408905:"IFCDUCTSILENCER",3518393246:"IFCDUCTSEGMENT",342316401:"IFCDUCTFITTING",562808652:"IFCDISTRIBUTIONCIRCUIT",4074379575:"IFCDAMPER",3640358203:"IFCCOOLINGTOWER",4136498852:"IFCCOOLEDBEAM",2272882330:"IFCCONDENSER",3571504051:"IFCCOMPRESSOR",3221913625:"IFCCOMMUNICATIONSAPPLIANCE",639361253:"IFCCOIL",3902619387:"IFCCHILLER",4217484030:"IFCCABLESEGMENT",1051757585:"IFCCABLEFITTING",3758799889:"IFCCABLECARRIERSEGMENT",635142910:"IFCCABLECARRIERFITTING",2938176219:"IFCBURNER",32344328:"IFCBOILER",2906023776:"IFCBEAMSTANDARDCASE",277319702:"IFCAUDIOVISUALAPPLIANCE",2056796094:"IFCAIRTOAIRHEATRECOVERY",177149247:"IFCAIRTERMINALBOX",1634111441:"IFCAIRTERMINAL",486154966:"IFCWINDOWSTANDARDCASE",4237592921:"IFCWASTETERMINAL",4156078855:"IFCWALLELEMENTEDCASE",4207607924:"IFCVALVE",4292641817:"IFCUNITARYEQUIPMENT",3179687236:"IFCUNITARYCONTROLELEMENTTYPE",3026737570:"IFCTUBEBUNDLE",3825984169:"IFCTRANSFORMER",812556717:"IFCTANK",1162798199:"IFCSWITCHINGDEVICE",385403989:"IFCSTRUCTURALLOADCASE",1404847402:"IFCSTACKTERMINAL",1999602285:"IFCSPACEHEATER",3420628829:"IFCSOLARDEVICE",3027962421:"IFCSLABSTANDARDCASE",3127900445:"IFCSLABELEMENTEDCASE",1329646415:"IFCSHADINGDEVICE",3053780830:"IFCSANITARYTERMINAL",2572171363:"IFCREINFORCINGBARTYPE",1232101972:"IFCRATIONALBSPLINECURVEWITHKNOTS",90941305:"IFCPUMP",655969474:"IFCPROTECTIVEDEVICETRIPPINGUNITTYPE",738039164:"IFCPROTECTIVEDEVICE",1156407060:"IFCPLATESTANDARDCASE",3612865200:"IFCPIPESEGMENT",310824031:"IFCPIPEFITTING",3694346114:"IFCOUTLET",144952367:"IFCOUTERBOUNDARYCURVE",2474470126:"IFCMOTORCONNECTION",1911478936:"IFCMEMBERSTANDARDCASE",1437502449:"IFCMEDICALDEVICE",629592764:"IFCLIGHTFIXTURE",76236018:"IFCLAMP",2176052936:"IFCJUNCTIONBOX",4175244083:"IFCINTERCEPTOR",2068733104:"IFCHUMIDIFIER",3319311131:"IFCHEATEXCHANGER",2188021234:"IFCFLOWMETER",1209101575:"IFCEXTERNALSPATIALELEMENT",484807127:"IFCEVAPORATOR",3747195512:"IFCEVAPORATIVECOOLER",2814081492:"IFCENGINE",2417008758:"IFCELECTRICDISTRIBUTIONBOARDTYPE",3242481149:"IFCDOORSTANDARDCASE",3205830791:"IFCDISTRIBUTIONSYSTEM",400855858:"IFCCOMMUNICATIONSAPPLIANCETYPE",905975707:"IFCCOLUMNSTANDARDCASE",1677625105:"IFCCIVILELEMENT",3296154744:"IFCCHIMNEY",2674252688:"IFCCABLEFITTINGTYPE",2188180465:"IFCBURNERTYPE",1177604601:"IFCBUILDINGSYSTEM",39481116:"IFCBUILDINGELEMENTPARTTYPE",1136057603:"IFCBOUNDARYCURVE",2461110595:"IFCBSPLINECURVEWITHKNOTS",1532957894:"IFCAUDIOVISUALAPPLIANCETYPE",4088093105:"IFCWORKCALENDAR",4009809668:"IFCWINDOWTYPE",926996030:"IFCVOIDINGFEATURE",2391383451:"IFCVIBRATIONISOLATOR",2415094496:"IFCTENDONTYPE",3081323446:"IFCTENDONANCHORTYPE",413509423:"IFCSYSTEMFURNITUREELEMENT",3101698114:"IFCSURFACEFEATURE",3657597509:"IFCSTRUCTURALSURFACEACTION",2757150158:"IFCSTRUCTURALCURVEREACTION",1004757350:"IFCSTRUCTURALCURVEACTION",338393293:"IFCSTAIRTYPE",1072016465:"IFCSOLARDEVICETYPE",4074543187:"IFCSHADINGDEVICETYPE",2157484638:"IFCSEAMCURVE",2781568857:"IFCROOFTYPE",2310774935:"IFCREINFORCINGMESHTYPE",964333572:"IFCREINFORCINGELEMENTTYPE",683857671:"IFCRATIONALBSPLINESURFACEWITHKNOTS",1469900589:"IFCRAMPTYPE",2839578677:"IFCPOLYGONALFACESET",1158309216:"IFCPILETYPE",3079942009:"IFCOPENINGSTANDARDCASE",1114901282:"IFCMEDICALDEVICETYPE",3113134337:"IFCINTERSECTIONCURVE",3946677679:"IFCINTERCEPTORTYPE",2571569899:"IFCINDEXEDPOLYCURVE",3493046030:"IFCGEOGRAPHICELEMENT",1509553395:"IFCFURNITURE",1893162501:"IFCFOOTINGTYPE",2853485674:"IFCEXTERNALSPATIALSTRUCTUREELEMENT",4148101412:"IFCEVENT",132023988:"IFCENGINETYPE",2397081782:"IFCELEMENTASSEMBLYTYPE",2323601079:"IFCDOORTYPE",1213902940:"IFCCYLINDRICALSURFACE",1525564444:"IFCCONSTRUCTIONPRODUCTRESOURCETYPE",4105962743:"IFCCONSTRUCTIONMATERIALRESOURCETYPE",2185764099:"IFCCONSTRUCTIONEQUIPMENTRESOURCETYPE",15328376:"IFCCOMPOSITECURVEONSURFACE",3875453745:"IFCCOMPLEXPROPERTYTEMPLATE",3893394355:"IFCCIVILELEMENTTYPE",2197970202:"IFCCHIMNEYTYPE",167062518:"IFCBSPLINESURFACEWITHKNOTS",2887950389:"IFCBSPLINESURFACE",2603310189:"IFCADVANCEDBREPWITHVOIDS",1635779807:"IFCADVANCEDBREP",2916149573:"IFCTRIANGULATEDFACESET",1935646853:"IFCTOROIDALSURFACE",2387106220:"IFCTESSELLATEDFACESET",3206491090:"IFCTASKTYPE",699246055:"IFCSURFACECURVE",4095615324:"IFCSUBCONTRACTRESOURCETYPE",603775116:"IFCSTRUCTURALSURFACEREACTION",4015995234:"IFCSPHERICALSURFACE",2481509218:"IFCSPATIALZONETYPE",463610769:"IFCSPATIALZONE",710998568:"IFCSPATIALELEMENTTYPE",1412071761:"IFCSPATIALELEMENT",3663146110:"IFCSIMPLEPROPERTYTEMPLATE",3243963512:"IFCREVOLVEDAREASOLIDTAPERED",816062949:"IFCREPARAMETRISEDCOMPOSITECURVESEGMENT",1521410863:"IFCRELSPACEBOUNDARY2NDLEVEL",3523091289:"IFCRELSPACEBOUNDARY1STLEVEL",427948657:"IFCRELINTERFERESELEMENTS",307848117:"IFCRELDEFINESBYTEMPLATE",1462361463:"IFCRELDEFINESBYOBJECT",2565941209:"IFCRELDECLARES",1027710054:"IFCRELASSIGNSTOGROUPBYFACTOR",3521284610:"IFCPROPERTYTEMPLATE",492091185:"IFCPROPERTYSETTEMPLATE",653396225:"IFCPROJECTLIBRARY",569719735:"IFCPROCEDURETYPE",3967405729:"IFCPREDEFINEDPROPERTYSET",1682466193:"IFCPCURVE",428585644:"IFCLABORRESOURCETYPE",2294589976:"IFCINDEXEDPOLYGONALFACEWITHVOIDS",178912537:"IFCINDEXEDPOLYGONALFACE",4095422895:"IFCGEOGRAPHICELEMENTTYPE",2652556860:"IFCFIXEDREFERENCESWEPTAREASOLID",2804161546:"IFCEXTRUDEDAREASOLIDTAPERED",4024345920:"IFCEVENTTYPE",2629017746:"IFCCURVEBOUNDEDSURFACE",1815067380:"IFCCREWRESOURCETYPE",3419103109:"IFCCONTEXT",2574617495:"IFCCONSTRUCTIONRESOURCETYPE",2059837836:"IFCCARTESIANPOINTLIST3D",1675464909:"IFCCARTESIANPOINTLIST2D",574549367:"IFCCARTESIANPOINTLIST",3406155212:"IFCADVANCEDFACE",3698973494:"IFCTYPERESOURCE",3736923433:"IFCTYPEPROCESS",901063453:"IFCTESSELLATEDITEM",1096409881:"IFCSWEPTDISKSOLIDPOLYGONAL",1042787934:"IFCRESOURCETIME",1608871552:"IFCRESOURCECONSTRAINTRELATIONSHIP",2943643501:"IFCRESOURCEAPPROVALRELATIONSHIP",2090586900:"IFCQUANTITYSET",1482703590:"IFCPROPERTYTEMPLATEDEFINITION",3778827333:"IFCPREDEFINEDPROPERTIES",2998442950:"IFCMIRROREDPROFILEDEF",853536259:"IFCMATERIALRELATIONSHIP",3404854881:"IFCMATERIALPROFILESETUSAGETAPERING",3079605661:"IFCMATERIALPROFILESETUSAGE",2852063980:"IFCMATERIALCONSTITUENTSET",3708119e3:"IFCMATERIALCONSTITUENT",1585845231:"IFCLAGTIME",2133299955:"IFCINDEXEDTRIANGLETEXTUREMAP",1437953363:"IFCINDEXEDTEXTUREMAP",3570813810:"IFCINDEXEDCOLOURMAP",1437805879:"IFCEXTERNALREFERENCERELATIONSHIP",297599258:"IFCEXTENDEDPROPERTIES",211053100:"IFCEVENTTIME",2713554722:"IFCCONVERSIONBASEDUNITWITHOFFSET",3285139300:"IFCCOLOURRGBLIST",1236880293:"IFCWORKTIME",1199560280:"IFCTIMEPERIOD",3611470254:"IFCTEXTUREVERTEXLIST",2771591690:"IFCTASKTIMERECURRING",1549132990:"IFCTASKTIME",2043862942:"IFCTABLECOLUMN",2934153892:"IFCSURFACEREINFORCEMENTAREA",609421318:"IFCSTRUCTURALLOADORRESULT",3478079324:"IFCSTRUCTURALLOADCONFIGURATION",1054537805:"IFCSCHEDULINGTIME",2439245199:"IFCRESOURCELEVELRELATIONSHIP",2433181523:"IFCREFERENCE",3915482550:"IFCRECURRENCEPATTERN",986844984:"IFCPROPERTYABSTRACTION",3843373140:"IFCPROJECTEDCRS",677532197:"IFCPRESENTATIONITEM",1507914824:"IFCMATERIALUSAGEDEFINITION",552965576:"IFCMATERIALPROFILEWITHOFFSETS",164193824:"IFCMATERIALPROFILESET",2235152071:"IFCMATERIALPROFILE",1847252529:"IFCMATERIALLAYERWITHOFFSETS",760658860:"IFCMATERIALDEFINITION",3057273783:"IFCMAPCONVERSION",4294318154:"IFCEXTERNALINFORMATION",1466758467:"IFCCOORDINATEREFERENCESYSTEM",1785450214:"IFCCOORDINATEOPERATION",775493141:"IFCCONNECTIONVOLUMEGEOMETRY",979691226:"IFCREINFORCINGBAR",3700593921:"IFCELECTRICDISTRIBUTIONPOINT",1062813311:"IFCDISTRIBUTIONCONTROLELEMENT",1052013943:"IFCDISTRIBUTIONCHAMBERELEMENT",578613899:"IFCCONTROLLERTYPE",2454782716:"IFCCHAMFEREDGEFEATURE",753842376:"IFCBEAM",3001207471:"IFCALARMTYPE",2874132201:"IFCACTUATORTYPE",3304561284:"IFCWINDOW",3512223829:"IFCWALLSTANDARDCASE",2391406946:"IFCWALL",3313531582:"IFCVIBRATIONISOLATORTYPE",2347447852:"IFCTENDONANCHOR",3824725483:"IFCTENDON",2515109513:"IFCSTRUCTURALANALYSISMODEL",4252922144:"IFCSTAIRFLIGHT",331165859:"IFCSTAIR",1529196076:"IFCSLAB",1783015770:"IFCSENSORTYPE",1376911519:"IFCROUNDEDEDGEFEATURE",2016517767:"IFCROOF",2320036040:"IFCREINFORCINGMESH",3027567501:"IFCREINFORCINGELEMENT",3055160366:"IFCRATIONALBEZIERCURVE",3283111854:"IFCRAMPFLIGHT",3024970846:"IFCRAMP",2262370178:"IFCRAILING",3171933400:"IFCPLATE",1687234759:"IFCPILE",1073191201:"IFCMEMBER",900683007:"IFCFOOTING",3508470533:"IFCFLOWTREATMENTDEVICE",2223149337:"IFCFLOWTERMINAL",707683696:"IFCFLOWSTORAGEDEVICE",987401354:"IFCFLOWSEGMENT",3132237377:"IFCFLOWMOVINGDEVICE",4037862832:"IFCFLOWINSTRUMENTTYPE",4278956645:"IFCFLOWFITTING",2058353004:"IFCFLOWCONTROLLER",4222183408:"IFCFIRESUPPRESSIONTERMINALTYPE",1810631287:"IFCFILTERTYPE",346874300:"IFCFANTYPE",1658829314:"IFCENERGYCONVERSIONDEVICE",857184966:"IFCELECTRICALELEMENT",1634875225:"IFCELECTRICALCIRCUIT",712377611:"IFCELECTRICTIMECONTROLTYPE",1217240411:"IFCELECTRICMOTORTYPE",1365060375:"IFCELECTRICHEATERTYPE",1534661035:"IFCELECTRICGENERATORTYPE",3277789161:"IFCELECTRICFLOWSTORAGEDEVICETYPE",663422040:"IFCELECTRICAPPLIANCETYPE",855621170:"IFCEDGEFEATURE",2030761528:"IFCDUCTSILENCERTYPE",3760055223:"IFCDUCTSEGMENTTYPE",869906466:"IFCDUCTFITTINGTYPE",395920057:"IFCDOOR",3041715199:"IFCDISTRIBUTIONPORT",3040386961:"IFCDISTRIBUTIONFLOWELEMENT",1945004755:"IFCDISTRIBUTIONELEMENT",2063403501:"IFCDISTRIBUTIONCONTROLELEMENTTYPE",1599208980:"IFCDISTRIBUTIONCHAMBERELEMENTTYPE",2635815018:"IFCDISCRETEACCESSORYTYPE",1335981549:"IFCDISCRETEACCESSORY",4147604152:"IFCDIAMETERDIMENSION",3961806047:"IFCDAMPERTYPE",3495092785:"IFCCURTAINWALL",1973544240:"IFCCOVERING",2954562838:"IFCCOOLINGTOWERTYPE",335055490:"IFCCOOLEDBEAMTYPE",488727124:"IFCCONSTRUCTIONPRODUCTRESOURCE",1060000209:"IFCCONSTRUCTIONMATERIALRESOURCE",3898045240:"IFCCONSTRUCTIONEQUIPMENTRESOURCE",1163958913:"IFCCONDITIONCRITERION",2188551683:"IFCCONDITION",2816379211:"IFCCONDENSERTYPE",3850581409:"IFCCOMPRESSORTYPE",843113511:"IFCCOLUMN",2301859152:"IFCCOILTYPE",2611217952:"IFCCIRCLE",2951183804:"IFCCHILLERTYPE",1285652485:"IFCCABLESEGMENTTYPE",3293546465:"IFCCABLECARRIERSEGMENTTYPE",395041908:"IFCCABLECARRIERFITTINGTYPE",1909888760:"IFCBUILDINGELEMENTPROXYTYPE",1095909175:"IFCBUILDINGELEMENTPROXY",2979338954:"IFCBUILDINGELEMENTPART",52481810:"IFCBUILDINGELEMENTCOMPONENT",3299480353:"IFCBUILDINGELEMENT",231477066:"IFCBOILERTYPE",1916977116:"IFCBEZIERCURVE",819618141:"IFCBEAMTYPE",1967976161:"IFCBSPLINECURVE",3460190687:"IFCASSET",2470393545:"IFCANGULARDIMENSION",1871374353:"IFCAIRTOAIRHEATRECOVERYTYPE",3352864051:"IFCAIRTERMINALTYPE",1411407467:"IFCAIRTERMINALBOXTYPE",3821786052:"IFCACTIONREQUEST",1213861670:"IFC2DCOMPOSITECURVE",1033361043:"IFCZONE",3342526732:"IFCWORKSCHEDULE",4218914973:"IFCWORKPLAN",1028945134:"IFCWORKCONTROL",1133259667:"IFCWASTETERMINALTYPE",1898987631:"IFCWALLTYPE",2769231204:"IFCVIRTUALELEMENT",728799441:"IFCVALVETYPE",1911125066:"IFCUNITARYEQUIPMENTTYPE",1600972822:"IFCTUBEBUNDLETYPE",3593883385:"IFCTRIMMEDCURVE",1620046519:"IFCTRANSPORTELEMENT",1692211062:"IFCTRANSFORMERTYPE",1637806684:"IFCTIMESERIESSCHEDULE",5716631:"IFCTANKTYPE",2254336722:"IFCSYSTEM",2315554128:"IFCSWITCHINGDEVICETYPE",148013059:"IFCSUBCONTRACTRESOURCE",1975003073:"IFCSTRUCTURALSURFACECONNECTION",2986769608:"IFCSTRUCTURALRESULTGROUP",1235345126:"IFCSTRUCTURALPOINTREACTION",734778138:"IFCSTRUCTURALPOINTCONNECTION",2082059205:"IFCSTRUCTURALPOINTACTION",3987759626:"IFCSTRUCTURALPLANARACTIONVARYING",1621171031:"IFCSTRUCTURALPLANARACTION",1252848954:"IFCSTRUCTURALLOADGROUP",1721250024:"IFCSTRUCTURALLINEARACTIONVARYING",1807405624:"IFCSTRUCTURALLINEARACTION",2445595289:"IFCSTRUCTURALCURVEMEMBERVARYING",214636428:"IFCSTRUCTURALCURVEMEMBER",4243806635:"IFCSTRUCTURALCURVECONNECTION",1179482911:"IFCSTRUCTURALCONNECTION",682877961:"IFCSTRUCTURALACTION",1039846685:"IFCSTAIRFLIGHTTYPE",3112655638:"IFCSTACKTERMINALTYPE",3812236995:"IFCSPACETYPE",652456506:"IFCSPACEPROGRAM",1305183839:"IFCSPACEHEATERTYPE",3856911033:"IFCSPACE",2533589738:"IFCSLABTYPE",4097777520:"IFCSITE",4105383287:"IFCSERVICELIFE",3517283431:"IFCSCHEDULETIMECONTROL",1768891740:"IFCSANITARYTERMINALTYPE",2863920197:"IFCRELASSIGNSTASKS",160246688:"IFCRELAGGREGATES",2324767716:"IFCRAMPFLIGHTTYPE",2893384427:"IFCRAILINGTYPE",3248260540:"IFCRADIUSDIMENSION",2250791053:"IFCPUMPTYPE",1842657554:"IFCPROTECTIVEDEVICETYPE",3651124850:"IFCPROJECTIONELEMENT",3642467123:"IFCPROJECTORDERRECORD",2904328755:"IFCPROJECTORDER",2744685151:"IFCPROCEDURE",3740093272:"IFCPORT",3724593414:"IFCPOLYLINE",4017108033:"IFCPLATETYPE",4231323485:"IFCPIPESEGMENTTYPE",804291784:"IFCPIPEFITTINGTYPE",3327091369:"IFCPERMIT",2382730787:"IFCPERFORMANCEHISTORY",2837617999:"IFCOUTLETTYPE",3425660407:"IFCORDERACTION",3588315303:"IFCOPENINGELEMENT",4143007308:"IFCOCCUPANT",1916936684:"IFCMOVE",977012517:"IFCMOTORCONNECTIONTYPE",3181161470:"IFCMEMBERTYPE",2108223431:"IFCMECHANICALFASTENERTYPE",377706215:"IFCMECHANICALFASTENER",2506943328:"IFCLINEARDIMENSION",1161773419:"IFCLIGHTFIXTURETYPE",1051575348:"IFCLAMPTYPE",3827777499:"IFCLABORRESOURCE",4288270099:"IFCJUNCTIONBOXTYPE",2391368822:"IFCINVENTORY",1806887404:"IFCHUMIDIFIERTYPE",1251058090:"IFCHEATEXCHANGERTYPE",2706460486:"IFCGROUP",3009204131:"IFCGRID",200128114:"IFCGASTERMINALTYPE",814719939:"IFCFURNITURESTANDARD",263784265:"IFCFURNISHINGELEMENT",3009222698:"IFCFLOWTREATMENTDEVICETYPE",2297155007:"IFCFLOWTERMINALTYPE",1339347760:"IFCFLOWSTORAGEDEVICETYPE",1834744321:"IFCFLOWSEGMENTTYPE",1482959167:"IFCFLOWMOVINGDEVICETYPE",3815607619:"IFCFLOWMETERTYPE",3198132628:"IFCFLOWFITTINGTYPE",3907093117:"IFCFLOWCONTROLLERTYPE",1287392070:"IFCFEATUREELEMENTSUBTRACTION",2143335405:"IFCFEATUREELEMENTADDITION",2827207264:"IFCFEATUREELEMENT",2489546625:"IFCFASTENERTYPE",647756555:"IFCFASTENER",3737207727:"IFCFACETEDBREPWITHVOIDS",807026263:"IFCFACETEDBREP",3390157468:"IFCEVAPORATORTYPE",3174744832:"IFCEVAPORATIVECOOLERTYPE",3272907226:"IFCEQUIPMENTSTANDARD",1962604670:"IFCEQUIPMENTELEMENT",2107101300:"IFCENERGYCONVERSIONDEVICETYPE",1704287377:"IFCELLIPSE",2590856083:"IFCELEMENTCOMPONENTTYPE",1623761950:"IFCELEMENTCOMPONENT",4123344466:"IFCELEMENTASSEMBLY",1758889154:"IFCELEMENT",360485395:"IFCELECTRICALBASEPROPERTIES",3849074793:"IFCDISTRIBUTIONFLOWELEMENTTYPE",3256556792:"IFCDISTRIBUTIONELEMENTTYPE",681481545:"IFCDIMENSIONCURVEDIRECTEDCALLOUT",1457835157:"IFCCURTAINWALLTYPE",3295246426:"IFCCREWRESOURCE",1916426348:"IFCCOVERINGTYPE",1419761937:"IFCCOSTSCHEDULE",3895139033:"IFCCOSTITEM",3293443760:"IFCCONTROL",2559216714:"IFCCONSTRUCTIONRESOURCE",2510884976:"IFCCONIC",3732776249:"IFCCOMPOSITECURVE",300633059:"IFCCOLUMNTYPE",2937912522:"IFCCIRCLEHOLLOWPROFILEDEF",3124254112:"IFCBUILDINGSTOREY",1950629157:"IFCBUILDINGELEMENTTYPE",4031249490:"IFCBUILDING",1260505505:"IFCBOUNDEDCURVE",3649129432:"IFCBOOLEANCLIPPINGRESULT",1334484129:"IFCBLOCK",3207858831:"IFCASYMMETRICISHAPEPROFILEDEF",1674181508:"IFCANNOTATION",2296667514:"IFCACTOR",2097647324:"IFCTRANSPORTELEMENTTYPE",3473067441:"IFCTASK",1580310250:"IFCSYSTEMFURNITUREELEMENTTYPE",4124788165:"IFCSURFACEOFREVOLUTION",2809605785:"IFCSURFACEOFLINEAREXTRUSION",2028607225:"IFCSURFACECURVESWEPTAREASOLID",4070609034:"IFCSTRUCTUREDDIMENSIONCALLOUT",2218152070:"IFCSTRUCTURALSURFACEMEMBERVARYING",3979015343:"IFCSTRUCTURALSURFACEMEMBER",3689010777:"IFCSTRUCTURALREACTION",530289379:"IFCSTRUCTURALMEMBER",3136571912:"IFCSTRUCTURALITEM",3544373492:"IFCSTRUCTURALACTIVITY",451544542:"IFCSPHERE",3893378262:"IFCSPATIALSTRUCTUREELEMENTTYPE",2706606064:"IFCSPATIALSTRUCTUREELEMENT",3626867408:"IFCRIGHTCIRCULARCYLINDER",4158566097:"IFCRIGHTCIRCULARCONE",1856042241:"IFCREVOLVEDAREASOLID",2914609552:"IFCRESOURCE",1401173127:"IFCRELVOIDSELEMENT",3451746338:"IFCRELSPACEBOUNDARY",366585022:"IFCRELSERVICESBUILDINGS",4122056220:"IFCRELSEQUENCE",1058617721:"IFCRELSCHEDULESCOSTITEMS",1245217292:"IFCRELREFERENCEDINSPATIALSTRUCTURE",750771296:"IFCRELPROJECTSELEMENT",202636808:"IFCRELOVERRIDESPROPERTIES",2051452291:"IFCRELOCCUPIESSPACES",3268803585:"IFCRELNESTS",4189434867:"IFCRELINTERACTIONREQUIREMENTS",279856033:"IFCRELFLOWCONTROLELEMENTS",3940055652:"IFCRELFILLSELEMENT",781010003:"IFCRELDEFINESBYTYPE",4186316022:"IFCRELDEFINESBYPROPERTIES",693640335:"IFCRELDEFINES",2551354335:"IFCRELDECOMPOSES",2802773753:"IFCRELCOVERSSPACES",886880790:"IFCRELCOVERSBLDGELEMENTS",3242617779:"IFCRELCONTAINEDINSPATIALSTRUCTURE",3678494232:"IFCRELCONNECTSWITHREALIZINGELEMENTS",504942748:"IFCRELCONNECTSWITHECCENTRICITY",1638771189:"IFCRELCONNECTSSTRUCTURALMEMBER",3912681535:"IFCRELCONNECTSSTRUCTURALELEMENT",2127690289:"IFCRELCONNECTSSTRUCTURALACTIVITY",3190031847:"IFCRELCONNECTSPORTS",4201705270:"IFCRELCONNECTSPORTTOELEMENT",3945020480:"IFCRELCONNECTSPATHELEMENTS",1204542856:"IFCRELCONNECTSELEMENTS",826625072:"IFCRELCONNECTS",2851387026:"IFCRELASSOCIATESPROFILEPROPERTIES",2655215786:"IFCRELASSOCIATESMATERIAL",3840914261:"IFCRELASSOCIATESLIBRARY",982818633:"IFCRELASSOCIATESDOCUMENT",2728634034:"IFCRELASSOCIATESCONSTRAINT",919958153:"IFCRELASSOCIATESCLASSIFICATION",4095574036:"IFCRELASSOCIATESAPPROVAL",1327628568:"IFCRELASSOCIATESAPPLIEDVALUE",1865459582:"IFCRELASSOCIATES",205026976:"IFCRELASSIGNSTORESOURCE",3372526763:"IFCRELASSIGNSTOPROJECTORDER",2857406711:"IFCRELASSIGNSTOPRODUCT",4278684876:"IFCRELASSIGNSTOPROCESS",1307041759:"IFCRELASSIGNSTOGROUP",2495723537:"IFCRELASSIGNSTOCONTROL",1683148259:"IFCRELASSIGNSTOACTOR",3939117080:"IFCRELASSIGNS",3454111270:"IFCRECTANGULARTRIMMEDSURFACE",2798486643:"IFCRECTANGULARPYRAMID",2770003689:"IFCRECTANGLEHOLLOWPROFILEDEF",3219374653:"IFCPROXY",1451395588:"IFCPROPERTYSET",4194566429:"IFCPROJECTIONCURVE",103090709:"IFCPROJECT",4208778838:"IFCPRODUCT",2945172077:"IFCPROCESS",220341763:"IFCPLANE",603570806:"IFCPLANARBOX",3566463478:"IFCPERMEABLECOVERINGPROPERTIES",3505215534:"IFCOFFSETCURVE3D",3388369263:"IFCOFFSETCURVE2D",3888040117:"IFCOBJECT",1425443689:"IFCMANIFOLDSOLIDBREP",1281925730:"IFCLINE",572779678:"IFCLSHAPEPROFILEDEF",1484403080:"IFCISHAPEPROFILEDEF",987898635:"IFCGEOMETRICCURVESET",1268542332:"IFCFURNITURETYPE",4238390223:"IFCFURNISHINGELEMENTTYPE",3455213021:"IFCFLUIDFLOWPROPERTIES",315944413:"IFCFILLAREASTYLETILES",4203026998:"IFCFILLAREASTYLETILESYMBOLWITHSTYLE",374418227:"IFCFILLAREASTYLEHATCHING",2047409740:"IFCFACEBASEDSURFACEMODEL",477187591:"IFCEXTRUDEDAREASOLID",80994333:"IFCENERGYPROPERTIES",2835456948:"IFCELLIPSEPROFILEDEF",2777663545:"IFCELEMENTARYSURFACE",339256511:"IFCELEMENTTYPE",1883228015:"IFCELEMENTQUANTITY",1472233963:"IFCEDGELOOP",4006246654:"IFCDRAUGHTINGPREDEFINEDCURVEFONT",445594917:"IFCDRAUGHTINGPREDEFINEDCOLOUR",3073041342:"IFCDRAUGHTINGCALLOUT",526551008:"IFCDOORSTYLE",1714330368:"IFCDOORPANELPROPERTIES",2963535650:"IFCDOORLININGPROPERTIES",32440307:"IFCDIRECTION",4054601972:"IFCDIMENSIONCURVETERMINATOR",606661476:"IFCDIMENSIONCURVE",693772133:"IFCDEFINEDSYMBOL",2827736869:"IFCCURVEBOUNDEDPLANE",2601014836:"IFCCURVE",2147822146:"IFCCSGSOLID",2506170314:"IFCCSGPRIMITIVE3D",194851669:"IFCCRANERAILFSHAPEPROFILEDEF",4133800736:"IFCCRANERAILASHAPEPROFILEDEF",2485617015:"IFCCOMPOSITECURVESEGMENT",2205249479:"IFCCLOSEDSHELL",1383045692:"IFCCIRCLEPROFILEDEF",1416205885:"IFCCARTESIANTRANSFORMATIONOPERATOR3DNONUNIFORM",3331915920:"IFCCARTESIANTRANSFORMATIONOPERATOR3D",3486308946:"IFCCARTESIANTRANSFORMATIONOPERATOR2DNONUNIFORM",3749851601:"IFCCARTESIANTRANSFORMATIONOPERATOR2D",59481748:"IFCCARTESIANTRANSFORMATIONOPERATOR",1123145078:"IFCCARTESIANPOINT",2898889636:"IFCCSHAPEPROFILEDEF",2713105998:"IFCBOXEDHALFSPACE",2581212453:"IFCBOUNDINGBOX",4182860854:"IFCBOUNDEDSURFACE",2736907675:"IFCBOOLEANRESULT",2740243338:"IFCAXIS2PLACEMENT3D",3125803723:"IFCAXIS2PLACEMENT2D",4261334040:"IFCAXIS1PLACEMENT",1302238472:"IFCANNOTATIONSURFACE",2265737646:"IFCANNOTATIONFILLAREAOCCURRENCE",669184980:"IFCANNOTATIONFILLAREA",3288037868:"IFCANNOTATIONCURVEOCCURRENCE",2543172580:"IFCZSHAPEPROFILEDEF",1299126871:"IFCWINDOWSTYLE",512836454:"IFCWINDOWPANELPROPERTIES",336235671:"IFCWINDOWLININGPROPERTIES",2759199220:"IFCVERTEXLOOP",1417489154:"IFCVECTOR",427810014:"IFCUSHAPEPROFILEDEF",2347495698:"IFCTYPEPRODUCT",1628702193:"IFCTYPEOBJECT",1345879162:"IFCTWODIRECTIONREPEATFACTOR",2715220739:"IFCTRAPEZIUMPROFILEDEF",3124975700:"IFCTEXTLITERALWITHEXTENT",4282788508:"IFCTEXTLITERAL",3028897424:"IFCTERMINATORSYMBOL",3071757647:"IFCTSHAPEPROFILEDEF",230924584:"IFCSWEPTSURFACE",1260650574:"IFCSWEPTDISKSOLID",2247615214:"IFCSWEPTAREASOLID",1878645084:"IFCSURFACESTYLERENDERING",2513912981:"IFCSURFACE",2233826070:"IFCSUBEDGE",3653947884:"IFCSTRUCTURALSTEELPROFILEPROPERTIES",3843319758:"IFCSTRUCTURALPROFILEPROPERTIES",1190533807:"IFCSTRUCTURALLOADSINGLEFORCEWARPING",1597423693:"IFCSTRUCTURALLOADSINGLEFORCE",1973038258:"IFCSTRUCTURALLOADSINGLEDISPLACEMENTDISTORTION",2473145415:"IFCSTRUCTURALLOADSINGLEDISPLACEMENT",2668620305:"IFCSTRUCTURALLOADPLANARFORCE",1595516126:"IFCSTRUCTURALLOADLINEARFORCE",390701378:"IFCSPACETHERMALLOADPROPERTIES",1202362311:"IFCSOUNDVALUE",2485662743:"IFCSOUNDPROPERTIES",723233188:"IFCSOLIDMODEL",2609359061:"IFCSLIPPAGECONNECTIONCONDITION",4124623270:"IFCSHELLBASEDSURFACEMODEL",2411513650:"IFCSERVICELIFEFACTOR",1509187699:"IFCSECTIONEDSPINE",2778083089:"IFCROUNDEDRECTANGLEPROFILEDEF",478536968:"IFCRELATIONSHIP",3765753017:"IFCREINFORCEMENTDEFINITIONPROPERTIES",3413951693:"IFCREGULARTIMESERIES",3615266464:"IFCRECTANGLEPROFILEDEF",110355661:"IFCPROPERTYTABLEVALUE",3650150729:"IFCPROPERTYSINGLEVALUE",3357820518:"IFCPROPERTYSETDEFINITION",941946838:"IFCPROPERTYREFERENCEVALUE",2752243245:"IFCPROPERTYLISTVALUE",4166981789:"IFCPROPERTYENUMERATEDVALUE",1680319473:"IFCPROPERTYDEFINITION",871118103:"IFCPROPERTYBOUNDEDVALUE",673634403:"IFCPRODUCTDEFINITIONSHAPE",179317114:"IFCPREDEFINEDPOINTMARKERSYMBOL",433424934:"IFCPREDEFINEDDIMENSIONSYMBOL",2559016684:"IFCPREDEFINEDCURVEFONT",759155922:"IFCPREDEFINEDCOLOUR",2775532180:"IFCPOLYGONALBOUNDEDHALFSPACE",2924175390:"IFCPOLYLOOP",1423911732:"IFCPOINTONSURFACE",4022376103:"IFCPOINTONCURVE",2067069095:"IFCPOINT",1663979128:"IFCPLANAREXTENT",2004835150:"IFCPLACEMENT",597895409:"IFCPIXELTEXTURE",3021840470:"IFCPHYSICALCOMPLEXQUANTITY",2519244187:"IFCPATH",2529465313:"IFCPARAMETERIZEDPROFILEDEF",1029017970:"IFCORIENTEDEDGE",2665983363:"IFCOPENSHELL",2833995503:"IFCONEDIRECTIONREPEATFACTOR",219451334:"IFCOBJECTDEFINITION",1430189142:"IFCMECHANICALCONCRETEMATERIALPROPERTIES",2022407955:"IFCMATERIALDEFINITIONREPRESENTATION",2347385850:"IFCMAPPEDITEM",1008929658:"IFCLOOP",2624227202:"IFCLOCALPLACEMENT",3422422726:"IFCLIGHTSOURCESPOT",1520743889:"IFCLIGHTSOURCEPOSITIONAL",4266656042:"IFCLIGHTSOURCEGONIOMETRIC",2604431987:"IFCLIGHTSOURCEDIRECTIONAL",125510826:"IFCLIGHTSOURCEAMBIENT",1402838566:"IFCLIGHTSOURCE",3741457305:"IFCIRREGULARTIMESERIES",3905492369:"IFCIMAGETEXTURE",2445078500:"IFCHYGROSCOPICMATERIALPROPERTIES",812098782:"IFCHALFSPACESOLID",178086475:"IFCGRIDPLACEMENT",3590301190:"IFCGEOMETRICSET",4142052618:"IFCGEOMETRICREPRESENTATIONSUBCONTEXT",2453401579:"IFCGEOMETRICREPRESENTATIONITEM",3448662350:"IFCGEOMETRICREPRESENTATIONCONTEXT",1446786286:"IFCGENERALPROFILEPROPERTIES",803998398:"IFCGENERALMATERIALPROPERTIES",3857492461:"IFCFUELPROPERTIES",738692330:"IFCFILLAREASTYLE",4219587988:"IFCFAILURECONNECTIONCONDITION",3008276851:"IFCFACESURFACE",803316827:"IFCFACEOUTERBOUND",1809719519:"IFCFACEBOUND",2556980723:"IFCFACE",1860660968:"IFCEXTENDEDMATERIALPROPERTIES",476780140:"IFCEDGECURVE",3900360178:"IFCEDGE",4170525392:"IFCDRAUGHTINGPREDEFINEDTEXTFONT",3732053477:"IFCDOCUMENTREFERENCE",1694125774:"IFCDIMENSIONPAIR",2273265877:"IFCDIMENSIONCALLOUTRELATIONSHIP",3632507154:"IFCDERIVEDPROFILEDEF",3800577675:"IFCCURVESTYLE",2889183280:"IFCCONVERSIONBASEDUNIT",3050246964:"IFCCONTEXTDEPENDENTUNIT",45288368:"IFCCONNECTIONPOINTECCENTRICITY",1981873012:"IFCCONNECTIONCURVEGEOMETRY",370225590:"IFCCONNECTEDFACESET",1485152156:"IFCCOMPOSITEPROFILEDEF",2542286263:"IFCCOMPLEXPROPERTY",776857604:"IFCCOLOURRGB",647927063:"IFCCLASSIFICATIONREFERENCE",3150382593:"IFCCENTERLINEPROFILEDEF",616511568:"IFCBLOBTEXTURE",2705031697:"IFCARBITRARYPROFILEDEFWITHVOIDS",1310608509:"IFCARBITRARYOPENPROFILEDEF",3798115385:"IFCARBITRARYCLOSEDPROFILEDEF",2297822566:"IFCANNOTATIONTEXTOCCURRENCE",3612888222:"IFCANNOTATIONSYMBOLOCCURRENCE",962685235:"IFCANNOTATIONSURFACEOCCURRENCE",2442683028:"IFCANNOTATIONOCCURRENCE",1065908215:"IFCWATERPROPERTIES",891718957:"IFCVIRTUALGRIDINTERSECTION",1907098498:"IFCVERTEXPOINT",3304826586:"IFCVERTEXBASEDTEXTUREMAP",2799835756:"IFCVERTEX",180925521:"IFCUNITASSIGNMENT",1735638870:"IFCTOPOLOGYREPRESENTATION",1377556343:"IFCTOPOLOGICALREPRESENTATIONITEM",581633288:"IFCTIMESERIESVALUE",1718945513:"IFCTIMESERIESREFERENCERELATIONSHIP",3101149627:"IFCTIMESERIES",3317419933:"IFCTHERMALMATERIALPROPERTIES",1210645708:"IFCTEXTUREVERTEX",2552916305:"IFCTEXTUREMAP",1742049831:"IFCTEXTURECOORDINATEGENERATOR",280115917:"IFCTEXTURECOORDINATE",1484833681:"IFCTEXTSTYLEWITHBOXCHARACTERISTICS",1640371178:"IFCTEXTSTYLETEXTMODEL",2636378356:"IFCTEXTSTYLEFORDEFINEDFONT",1983826977:"IFCTEXTSTYLEFONTMODEL",1447204868:"IFCTEXTSTYLE",912023232:"IFCTELECOMADDRESS",531007025:"IFCTABLEROW",985171141:"IFCTABLE",1290481447:"IFCSYMBOLSTYLE",626085974:"IFCSURFACETEXTURE",1351298697:"IFCSURFACESTYLEWITHTEXTURES",846575682:"IFCSURFACESTYLESHADING",1607154358:"IFCSURFACESTYLEREFRACTION",3303107099:"IFCSURFACESTYLELIGHTING",1300840506:"IFCSURFACESTYLE",3049322572:"IFCSTYLEDREPRESENTATION",3958052878:"IFCSTYLEDITEM",2830218821:"IFCSTYLEMODEL",3408363356:"IFCSTRUCTURALLOADTEMPERATURE",2525727697:"IFCSTRUCTURALLOADSTATIC",2162789131:"IFCSTRUCTURALLOAD",2273995522:"IFCSTRUCTURALCONNECTIONCONDITION",3692461612:"IFCSIMPLEPROPERTY",4240577450:"IFCSHAPEREPRESENTATION",3982875396:"IFCSHAPEMODEL",867548509:"IFCSHAPEASPECT",4165799628:"IFCSECTIONREINFORCEMENTPROPERTIES",2042790032:"IFCSECTIONPROPERTIES",448429030:"IFCSIUNIT",2341007311:"IFCROOT",3679540991:"IFCRIBPLATEPROFILEPROPERTIES",1660063152:"IFCREPRESENTATIONMAP",3008791417:"IFCREPRESENTATIONITEM",3377609919:"IFCREPRESENTATIONCONTEXT",1076942058:"IFCREPRESENTATION",1222501353:"IFCRELAXATION",1580146022:"IFCREINFORCEMENTBARPROPERTIES",2692823254:"IFCREFERENCESVALUEDOCUMENT",825690147:"IFCQUANTITYWEIGHT",2405470396:"IFCQUANTITYVOLUME",3252649465:"IFCQUANTITYTIME",931644368:"IFCQUANTITYLENGTH",2093928680:"IFCQUANTITYCOUNT",2044713172:"IFCQUANTITYAREA",3710013099:"IFCPROPERTYENUMERATION",148025276:"IFCPROPERTYDEPENDENCYRELATIONSHIP",3896028662:"IFCPROPERTYCONSTRAINTRELATIONSHIP",2598011224:"IFCPROPERTY",2802850158:"IFCPROFILEPROPERTIES",3958567839:"IFCPROFILEDEF",2267347899:"IFCPRODUCTSOFCOMBUSTIONPROPERTIES",2095639259:"IFCPRODUCTREPRESENTATION",2417041796:"IFCPRESENTATIONSTYLEASSIGNMENT",3119450353:"IFCPRESENTATIONSTYLE",1304840413:"IFCPRESENTATIONLAYERWITHSTYLE",2022622350:"IFCPRESENTATIONLAYERASSIGNMENT",1775413392:"IFCPREDEFINEDTEXTFONT",3213052703:"IFCPREDEFINEDTERMINATORSYMBOL",990879717:"IFCPREDEFINEDSYMBOL",3727388367:"IFCPREDEFINEDITEM",3355820592:"IFCPOSTALADDRESS",2226359599:"IFCPHYSICALSIMPLEQUANTITY",2483315170:"IFCPHYSICALQUANTITY",101040310:"IFCPERSONANDORGANIZATION",2077209135:"IFCPERSON",1207048766:"IFCOWNERHISTORY",1411181986:"IFCORGANIZATIONRELATIONSHIP",4251960020:"IFCORGANIZATION",1227763645:"IFCOPTICALMATERIALPROPERTIES",2251480897:"IFCOBJECTIVE",3701648758:"IFCOBJECTPLACEMENT",1918398963:"IFCNAMEDUNIT",2706619895:"IFCMONETARYUNIT",3368373690:"IFCMETRIC",677618848:"IFCMECHANICALSTEELMATERIALPROPERTIES",4256014907:"IFCMECHANICALMATERIALPROPERTIES",2597039031:"IFCMEASUREWITHUNIT",3265635763:"IFCMATERIALPROPERTIES",2199411900:"IFCMATERIALLIST",1303795690:"IFCMATERIALLAYERSETUSAGE",3303938423:"IFCMATERIALLAYERSET",248100487:"IFCMATERIALLAYER",1847130766:"IFCMATERIALCLASSIFICATIONRELATIONSHIP",1838606355:"IFCMATERIAL",30780891:"IFCLOCALTIME",1566485204:"IFCLIGHTINTENSITYDISTRIBUTION",4162380809:"IFCLIGHTDISTRIBUTIONDATA",3452421091:"IFCLIBRARYREFERENCE",2655187982:"IFCLIBRARYINFORMATION",3020489413:"IFCIRREGULARTIMESERIESVALUE",852622518:"IFCGRIDAXIS",3548104201:"IFCEXTERNALLYDEFINEDTEXTFONT",3207319532:"IFCEXTERNALLYDEFINEDSYMBOL",1040185647:"IFCEXTERNALLYDEFINEDSURFACESTYLE",2242383968:"IFCEXTERNALLYDEFINEDHATCHSTYLE",3200245327:"IFCEXTERNALREFERENCE",1648886627:"IFCENVIRONMENTALIMPACTVALUE",3796139169:"IFCDRAUGHTINGCALLOUTRELATIONSHIP",770865208:"IFCDOCUMENTINFORMATIONRELATIONSHIP",1154170062:"IFCDOCUMENTINFORMATION",1376555844:"IFCDOCUMENTELECTRONICFORMAT",2949456006:"IFCDIMENSIONALEXPONENTS",1045800335:"IFCDERIVEDUNITELEMENT",1765591967:"IFCDERIVEDUNIT",1072939445:"IFCDATEANDTIME",3510044353:"IFCCURVESTYLEFONTPATTERN",2367409068:"IFCCURVESTYLEFONTANDSCALING",1105321065:"IFCCURVESTYLEFONT",539742890:"IFCCURRENCYRELATIONSHIP",602808272:"IFCCOSTVALUE",1065062679:"IFCCOORDINATEDUNIVERSALTIMEOFFSET",347226245:"IFCCONSTRAINTRELATIONSHIP",613356794:"IFCCONSTRAINTCLASSIFICATIONRELATIONSHIP",1658513725:"IFCCONSTRAINTAGGREGATIONRELATIONSHIP",1959218052:"IFCCONSTRAINT",2732653382:"IFCCONNECTIONSURFACEGEOMETRY",4257277454:"IFCCONNECTIONPORTGEOMETRY",2614616156:"IFCCONNECTIONPOINTGEOMETRY",2859738748:"IFCCONNECTIONGEOMETRY",3264961684:"IFCCOLOURSPECIFICATION",3639012971:"IFCCLASSIFICATIONNOTATIONFACET",938368621:"IFCCLASSIFICATIONNOTATION",1098599126:"IFCCLASSIFICATIONITEMRELATIONSHIP",1767535486:"IFCCLASSIFICATIONITEM",747523909:"IFCCLASSIFICATION",622194075:"IFCCALENDARDATE",2069777674:"IFCBOUNDARYNODECONDITIONWARPING",1387855156:"IFCBOUNDARYNODECONDITION",3367102660:"IFCBOUNDARYFACECONDITION",1560379544:"IFCBOUNDARYEDGECONDITION",4037036970:"IFCBOUNDARYCONDITION",3869604511:"IFCAPPROVALRELATIONSHIP",390851274:"IFCAPPROVALPROPERTYRELATIONSHIP",2080292479:"IFCAPPROVALACTORRELATIONSHIP",130549933:"IFCAPPROVAL",1110488051:"IFCAPPLIEDVALUERELATIONSHIP",411424972:"IFCAPPLIEDVALUE",639542469:"IFCAPPLICATION",618182010:"IFCADDRESS",3630933823:"IFCACTORROLE",599546466:"FILE_DESCRIPTION",1390159747:"FILE_NAME",1109904537:"FILE_SCHEMA"};class Yt{static async getUnits(t){var e;const{IFCUNITASSIGNMENT:s}=ft,i=await t.getAllPropertiesOfType(s);if(!i)return 1;const n=Object.keys(i),o=i[parseInt(n[0],10)];for(const r of o.Units){if(r.value===void 0||r.value===null)continue;const a=await t.getProperties(r.value);if(!a||!a.UnitType||!a.UnitType.value||a.UnitType.value!=="LENGTHUNIT")continue;let c=1,d=1;return a.Name.value==="METRE"&&(d=1),a.Name.value==="FOOT"&&(d=.3048),((e=a.Prefix)==null?void 0:e.value)==="MILLI"&&(c=.001),d*c}return 1}static async findItemByGuid(t,e){var s;const i=t.getAllPropertiesIDs();for(const n of i){const o=await t.getProperties(n);if(o&&((s=o.GlobalId)==null?void 0:s.value)===e)return o}return null}static async getRelationMap(t,e,s){var i;const n=s??(async()=>{}),o={},r=t.getAllPropertiesIDs();for(const a of r){const c=await t.getProperties(a);if(!c)continue;const d=c.type===e,E=Object.keys(c).find(f=>f.startsWith("Relating")),l=Object.keys(c).find(f=>f.startsWith("Related"));if(!(d&&E&&l))continue;const u=await t.getProperties((i=c[E])==null?void 0:i.value),T=c[l];if(!u||!T||!(T&&Array.isArray(T)))continue;const C=T.map(f=>f.value);await n(u.expressID,C),o[u.expressID]=C}return o}static async getQsetQuantities(t,e,s){const i=s??(()=>{}),n=await t.getProperties(e);return!n||n.type!==Uo?null:(n.Quantities??[{}]).map(o=>(o.value&&i(o.value),o.value)).filter(o=>o!==null)}static async getPsetProps(t,e,s){const i=s??(()=>{}),n=await t.getProperties(e);return!n||n.type!==ti?null:(n.HasProperties??[{}]).map(o=>(o.value&&i(o.value),o.value)).filter(o=>o!==null)}static async getPsetRel(t,e){var s;if(!await t.getProperties(e))return null;const i=await t.getAllPropertiesOfType(_s);if(!i)return null;const n=Object.values(i);let o=null;for(const r of n)((s=r.RelatingPropertyDefinition)==null?void 0:s.value)===e&&(o=r.expressID);return o}static async getQsetRel(t,e){return Yt.getPsetRel(t,e)}static async getEntityName(t,e){var s;const i=await t.getProperties(e);if(!i)return{key:null,name:null};const n=Object.keys(i).find(r=>r.endsWith("Name"))??null,o=n?(s=i[n])==null?void 0:s.value:null;return{key:n,name:o}}static async getQuantityValue(t,e){const s=await t.getProperties(e);if(!s)return{key:null,value:null};const i=Object.keys(s).find(o=>o.endsWith("Value"))??null;let n;return i===null||s[i]===void 0||s[i]===null?n=null:n=s[i].value,{key:i,value:n}}static isRel(t){return no[t].startsWith("IFCREL")}static async attributeExists(t,e,s){const i=await t.getProperties(e);return i?Object.keys(i).includes(s):!1}static async groupEntitiesByType(t,e){var s;const i=new Map;for(const n of e){const o=await t.getProperties(n);if(!o)continue;const r=o.type;i.get(r)||i.set(r,new Set),(s=i.get(r))==null||s.add(n)}return i}}const ka=new Map([[Ai,{forRelating:"IsDecomposedBy",forRelated:"Decomposes"}],[Fi,{forRelating:"AssociatedTo",forRelated:"HasAssociations"}],[gi,{forRelating:"ClassificationForObjects",forRelated:"HasAssociations"}],[Oi,{forRelating:"IsGroupedBy",forRelated:"HasAssignments"}],[_s,{forRelated:"IsDefinedBy",forRelating:"DefinesOcurrence"}],[_i,{forRelated:"IsTypedBy",forRelating:"Types"}],[Mn,{forRelated:"IsDefinedBy",forRelating:"Defines"}],[Ss,{forRelated:"ContainedInStructure",forRelating:"ContainsElements"}]]),oo=class pi extends q{constructor(t){super(t),I(this,"onDisposed",new M),I(this,"enabled",!0),I(this,"onRelationsIndexed",new M),I(this,"_relToAttributesMap",ka),I(this,"_inverseAttributes",["IsDecomposedBy","Decomposes","AssociatedTo","HasAssociations","ClassificationForObjects","IsGroupedBy","HasAssignments","IsDefinedBy","DefinesOcurrence","IsTypedBy","Types","Defines","ContainedInStructure","ContainsElements"]),I(this,"_ifcRels",[Ai,Fi,gi,Oi,_s,_i,Mn,Ss]),I(this,"relationMaps",{}),I(this,"onFragmentsDisposed",e=>{delete this.relationMaps[e.groupID]}),this.components.add(pi.uuid,this),t.get(wt).onFragmentsDisposed.add(this.onFragmentsDisposed)}setRelationMap(t,e){this.relationMaps[t.uuid]=e,this.onRelationsIndexed.trigger({modelID:t.uuid,relationsMap:e})}async process(t){if(!t.hasProperties)throw new Error("FragmentsGroup properties not found");let e=this.relationMaps[t.uuid];if(e)return e;e=new Map;for(const s of this._ifcRels)await Yt.getRelationMap(t,s,async(i,n)=>{const o=this._relToAttributesMap.get(s);if(!o)return;const{forRelated:r,forRelating:a}=o,c=e.get(i)??new Map,d=this._inverseAttributes.indexOf(a);c.set(d,n),e.set(i,c);for(const E of n){const l=e.get(E)??new Map,u=this._inverseAttributes.indexOf(r),T=l.get(u)??[];T.push(i),l.set(u,T),e.set(E,l)}});return this.setRelationMap(t,e),e}async processFromWebIfc(t,e){const s=new Map;for(const i of this._ifcRels){const n=this._relToAttributesMap.get(i);if(!n)continue;const{forRelated:o,forRelating:r}=n,a=t.GetLineIDsWithType(e,i);for(let c=0;c<a.size();c++){const d=await t.properties.getItemProperties(e,a.get(c)),E=Object.keys(d).find(m=>m.startsWith("Relating")),l=Object.keys(d).find(m=>m.startsWith("Related"));if(!(E&&l))continue;const u=d[E].value,T=d[l].map(m=>m.value),C=s.get(u)??new Map,f=this._inverseAttributes.indexOf(r);C.set(f,T),s.set(u,C);for(const m of T){const R=s.get(m)??new Map,F=this._inverseAttributes.indexOf(o),p=R.get(F)??[];p.push(u),R.set(F,p),s.set(m,R)}}}return this.onRelationsIndexed.trigger({modelID:e.toString(),relationsMap:s}),s}getEntityRelations(t,e,s){const i=this.relationMaps[t.uuid];if(!i)return null;const n=i.get(e),o=this._inverseAttributes.indexOf(s);return!n||o===-1?null:n.get(o)||null}serializeRelations(t){const e={};for(const[s,i]of t.entries()){e[s]||(e[s]={});for(const[n,o]of i.entries())e[s][n]=o}return JSON.stringify(e)}serializeModelRelations(t){const e=this.relationMaps[t.uuid];return e?this.serializeRelations(e):null}serializeAllRelations(){const t={};for(const e in this.relationMaps){const s=this.relationMaps[e],i={};for(const[n,o]of s.entries()){i[n]||(i[n]={});for(const[r,a]of o.entries())i[n][r]=a}t[e]=i}return JSON.stringify(t)}getRelationsMapFromJSON(t){const e=JSON.parse(t),s=new Map;for(const i in e){const n=e[i],o=new Map;for(const r in n)o.set(Number(r),n[r]);s.set(Number(i),o)}return s}dispose(){this.relationMaps={},this.components.get(wt).onFragmentsDisposed.remove(this.onFragmentsDisposed),this.onDisposed.trigger(pi.uuid),this.onDisposed.reset()}};I(oo,"uuid","23a889ab-83b3-44a4-8bee-ead83438370b");let Bi=oo;class Wa{constructor(){I(this,"factor",1),I(this,"complement",1)}apply(t){const e=this.getScaleMatrix().multiply(t);t.copy(e)}setUp(t){var e;this.factor=1;const s=this.getLengthUnits(t);if(!s)return;const i=s==null,n=s.Name===void 0||s.Name===null;i||n||(s.Name.value==="FOOT"?this.factor=.3048:((e=s.Prefix)==null?void 0:e.value)==="MILLI"&&(this.complement=.001))}getLengthUnits(t){try{const e=t.GetLineIDsWithType(0,Wo).get(0),s=t.GetLine(0,e);for(const i of s.Units){if(!i||i.value===null||i.value===void 0)continue;const n=t.GetLine(0,i.value);if(n.UnitType&&n.UnitType.value==="LENGTHUNIT")return n}return null}catch{return console.log("Could not get units"),null}}getScaleMatrix(){const t=this.factor;return new X().fromArray([t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1])}}class ro{constructor(){I(this,"itemsByFloor",{}),I(this,"_units",new Wa)}setUp(t){this._units.setUp(t),this.cleanUp();try{const e=t.GetLineIDsWithType(0,Ss),s=new Set,i=t.GetLineIDsWithType(0,$t);for(let c=0;c<i.size();c++)s.add(i.get(c));const n=t.GetLineIDsWithType(0,Ai),o=n.size();for(let c=0;c<o;c++){const d=n.get(c),E=t.GetLine(0,d);if(!E||!E.RelatingObject||!E.RelatedObjects)continue;const l=E.RelatingObject.value,u=E.RelatedObjects;for(const T of u){const C=T.value;s.has(C)&&(this.itemsByFloor[C]=l)}}const r={},a=e.size();for(let c=0;c<a;c++){const d=e.get(c),E=t.GetLine(0,d);if(!E||!E.RelatingStructure||!E.RelatedElements)continue;const l=E.RelatingStructure.value,u=E.RelatedElements;if(s.has(l))for(const T of u){r[l]||(r[l]=[]);const C=T.value;r[l].push(C)}else for(const T of u){const C=T.value;this.itemsByFloor[C]=l}}for(const c in r){const d=this.itemsByFloor[c];if(d!==void 0){const E=r[c];for(const l of E)this.itemsByFloor[l]=d}}for(let c=0;c<o;c++){const d=n.get(c),E=t.GetLine(0,d);if(!E||!E.RelatingObject||!E.RelatedObjects)continue;const l=E.RelatingObject.value,u=E.RelatedObjects;for(const T of u){const C=T.value,f=this.itemsByFloor[l];f!==void 0&&(this.itemsByFloor[C]=f)}}}catch{console.log("Could not get floors.")}}cleanUp(){this.itemsByFloor={}}}class Yi{constructor(){I(this,"includeProperties",!0),I(this,"optionalCategories",[$t]),I(this,"coordinate",!0),I(this,"wasm",{path:"",absolute:!1,logLevel:zo.LOG_LEVEL_OFF}),I(this,"excludedCategories",new Set),I(this,"saveLocations",!1),I(this,"webIfc",{COORDINATE_TO_ORIGIN:!0,OPTIMIZE_PROFILES:!0}),I(this,"autoSetWasm",!0),I(this,"customLocateFileHandler",null)}}class ao{constructor(){I(this,"defLineMat",new xn({color:16777215}))}read(t){const e=t.GetAllAlignments(0),s=t.GetAllCrossSections2D(0),i=t.GetAllCrossSections3D(0),n={IfcAlignment:e,IfcCrossSection2D:s,IfcCrossSection3D:i};return this.get(n)}get(t){if(t.IfcAlignment){const e=new Map;for(const s of t.IfcAlignment){const i=new Go;i.absolute=this.getCurves(s.curve3D,i),i.horizontal=this.getCurves(s.horizontal,i),i.vertical=this.getCurves(s.vertical,i),e.set(e.size,i)}return{alignments:e,coordinationMatrix:new X}}}getCurves(t,e){const s=[];let i=0;for(const n of t){const o={};if(n.data)for(const l of n.data){const[u,T]=l.split(": "),C=parseFloat(T);o[u]=C||T}const{points:r}=n,a=new Float32Array(r.length*3);for(let l=0;l<r.length;l++){const{x:u,y:T,z:C}=r[l];a[l*3]=u,a[l*3+1]=T,a[l*3+2]=C||0}const c=new Ve(a,3),d=new Vo;d.setAttribute("position",c);const E=new Ho(i,o,e,d,this.defLineMat);s.push(E.curve),i++}return s}}class ho{get(t,e){let s="";const i=t.GetHeaderLine(0,e)||"";if(!i)return s;for(const n of i.arguments)if(n!=null)if(Array.isArray(n))for(const o of n)s+=`${o.value}|`;else s+=`${n.value}|`;return s}}const co=class Ci extends q{constructor(t){super(t),I(this,"onIfcStartedLoading",new M),I(this,"onSetup",new M),I(this,"onDisposed",new M),I(this,"settings",new Yi),I(this,"enabled",!0),I(this,"webIfc",new zt),I(this,"_material",new Hi),I(this,"_spatialTree",new ro),I(this,"_metaData",new ho),I(this,"_fragmentInstances",new Map),I(this,"_civil",new ao),I(this,"_visitedFragments",new Map),I(this,"_materialT",new Hi({transparent:!0,opacity:.5})),this.components.add(Ci.uuid,this),this.settings.excludedCategories.add(Un)}dispose(){this.webIfc=null,this.onDisposed.trigger(Ci.uuid),this.onDisposed.reset()}async setup(t){this.settings={...this.settings,...t},this.settings.autoSetWasm&&await this.autoSetWasm(),this.onSetup.trigger()}async load(t,e=!0){const s=performance.now();this.onIfcStartedLoading.trigger(),await this.readIfcFile(t);const i=await this.getAllGeometries(),n=await this.components.get(Ha).export(this.webIfc,0);i.setLocalProperties(n),this.cleanUp();const o=this.components.get(wt);o.groups.set(i.uuid,i);for(const r of i.items)o.list.set(r.id,r),r.mesh.uuid=r.id,r.group=i;return o.onFragmentsLoaded.trigger(i),e&&o.coordinate([i]),console.log(`Streaming the IFC took ${performance.now()-s} ms!`),i}async readIfcFile(t){const{path:e,absolute:s,logLevel:i}=this.settings.wasm;return this.webIfc.SetWasmPath(e,s),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModel(t,this.settings.webIfc)}async getAllGeometries(){this._spatialTree.setUp(this.webIfc);const t=this.webIfc.GetIfcEntityList(0),e=new Dn,{FILE_NAME:s,FILE_DESCRIPTION:i}=ft;e.ifcMetadata={name:this._metaData.get(this.webIfc,s),description:this._metaData.get(this.webIfc,i),schema:this.webIfc.GetModelSchema(0)||"IFC2X3",maxExpressID:this.webIfc.GetMaxExpressID(0)};const n=[];for(const r of t){if(!this.webIfc.IsIfcElement(r)&&r!==$t||this.settings.excludedCategories.has(r))continue;const a=this.webIfc.GetLineIDsWithType(0,r),c=a.size();for(let d=0;d<c;d++){const E=a.get(d);n.push(E);const l=this._spatialTree.itemsByFloor[E]||0;e.data.set(E,[[],[l,r]])}}this._spatialTree.cleanUp(),this.webIfc.StreamMeshes(0,n,r=>{this.getMesh(r,e)});for(const r of this._visitedFragments){const{index:a,fragment:c}=r[1];e.keyFragments.set(a,c.id)}for(const r of e.items){const a=this._fragmentInstances.get(r.id);if(!a)throw new Error("Fragment not found!");const c=[];for(const[d,E]of a)c.push(E);r.add(c)}const o=this.webIfc.GetCoordinationMatrix(0);return e.coordinationMatrix.fromArray(o),e.civilData=this._civil.read(this.webIfc),e}cleanUp(){this.webIfc=null,this.webIfc=new zt,this._visitedFragments.clear(),this._fragmentInstances.clear()}getMesh(t,e){const s=t.geometries.size(),i=t.expressID;for(let n=0;n<s;n++){const o=t.geometries.get(n),{x:r,y:a,z:c,w:d}=o.color,E=d!==1,{geometryExpressID:l}=o,u=`${l}-${E}`;if(!this._visitedFragments.has(u)){const p=this.getGeometry(this.webIfc,l),A=E?this._materialT:this._material,g=new Do(p,A,1);e.add(g.mesh),e.items.push(g);const _=this._visitedFragments.size;this._visitedFragments.set(u,{index:_,fragment:g})}const T=new qt().setRGB(r,a,c,"srgb"),C=new X;C.fromArray(o.flatTransformation);const f=this._visitedFragments.get(u);if(f===void 0)throw new Error("Error getting geometry data for streaming!");const m=e.data.get(i);if(!m)throw new Error("Data not found!");m[0].push(f.index);const{fragment:R}=f;this._fragmentInstances.has(R.id)||this._fragmentInstances.set(R.id,new Map);const F=this._fragmentInstances.get(R.id);if(!F)throw new Error("Instances not found!");if(F.has(i)){const p=F.get(i);if(!p)throw new Error("Instance not found!");p.transforms.push(C),p.colors&&p.colors.push(T)}else F.set(i,{id:i,transforms:[C],colors:[T]})}}getGeometry(t,e){const s=t.GetGeometry(0,e),i=t.GetIndexArray(s.GetIndexData(),s.GetIndexDataSize()),n=t.GetVertexArray(s.GetVertexData(),s.GetVertexDataSize()),o=new Float32Array(n.length/2),r=new Float32Array(n.length/2);for(let E=0;E<n.length;E+=6)o[E/2]=n[E],o[E/2+1]=n[E+1],o[E/2+2]=n[E+2],r[E/2]=n[E+3],r[E/2+1]=n[E+4],r[E/2+2]=n[E+5];const a=new ze,c=new Ve(o,3),d=new Ve(r,3);return a.setAttribute("position",c),a.setAttribute("normal",d),a.setIndex(Array.from(i)),s.delete(),a}async autoSetWasm(){const t=await fetch(`https://unpkg.com/openbim-components@${Ia.release}/package.json`);if(!t.ok){console.warn("Couldn't get openbim-components package.json. Set wasm settings manually.");return}const e=await t.json();if(!("web-ifc"in e.peerDependencies))console.warn("Couldn't get web-ifc from peer dependencies in openbim-components. Set wasm settings manually.");else{const s=e.peerDependencies["web-ifc"];this.settings.wasm.path=`https://unpkg.com/web-ifc@${s}/`,this.settings.wasm.absolute=!0}}};I(co,"uuid","a659add7-1418-4771-a0d6-7d4d438e4624");let Xa=co;const Za=class ue extends q{constructor(t){super(t),I(this,"onDisposed",new M),I(this,"onRequestFile",new M),I(this,"ifcToExport",null),I(this,"onElementToPset",new M),I(this,"onPropToPset",new M),I(this,"onPsetRemoved",new M),I(this,"onDataChanged",new M),I(this,"wasm",{path:"/",absolute:!1}),I(this,"enabled",!0),I(this,"attributeListeners",{}),I(this,"selectedModel"),I(this,"changeMap",{}),this.components.add(ue.uuid,this)}dispose(){this.selectedModel=void 0,this.attributeListeners={},this.changeMap={},this.onElementToPset.reset(),this.onPropToPset.reset(),this.onPsetRemoved.reset(),this.onDataChanged.reset(),this.onDisposed.trigger(ue.uuid),this.onDisposed.reset()}increaseMaxID(t){return t.ifcMetadata.maxExpressID++,t.ifcMetadata.maxExpressID}static getIFCSchema(t){const e=t.ifcMetadata.schema;if(!e)throw new Error("IFC Schema not found");return e}newGUID(t){const e=ue.getIFCSchema(t);return new ft[e].IfcGloballyUniqueId(xi.create())}async getOwnerHistory(t){const e=await t.getAllPropertiesOfType(xo);if(!e)throw new Error("No OwnerHistory was found.");const s=Object.keys(e).map(o=>parseInt(o,10)),i=e[s[0]],n=new Ze(i.expressID);return{ownerHistory:i,ownerHistoryHandle:n}}registerChange(t,...e){this.changeMap[t.uuid]||(this.changeMap[t.uuid]=new Set);for(const s of e)this.changeMap[t.uuid].add(s),this.onDataChanged.trigger({model:t,expressID:s})}async setData(t,...e){for(const s of e){const i=s.expressID;i&&(await t.setProperties(i,s),this.registerChange(t,i))}}async newPset(t,e,s){const i=ue.getIFCSchema(t),{ownerHistoryHandle:n}=await this.getOwnerHistory(t),o=this.newGUID(t),r=new ft[i].IfcLabel(e),a=s?new ft[i].IfcText(s):null,c=new ft[i].IfcPropertySet(o,n,r,a,[]);c.expressID=this.increaseMaxID(t);const d=this.newGUID(t),E=new ft[i].IfcRelDefinesByProperties(d,n,null,null,[],new Ze(c.expressID));return E.expressID=this.increaseMaxID(t),await this.setData(t,c,E),{pset:c,rel:E}}async removePset(t,...e){for(const s of e){const i=await t.getProperties(s);if((i==null?void 0:i.type)!==ti)continue;const n=await Yt.getPsetRel(t,s);if(n&&(await t.setProperties(n,null),this.registerChange(t,n)),i){for(const o of i.HasProperties)await t.setProperties(o.value,null);await t.setProperties(s,null),this.onPsetRemoved.trigger({model:t,psetID:s}),this.registerChange(t,s)}}}async newSingleProperty(t,e,s,i){const n=ue.getIFCSchema(t),o=new ft[n].IfcIdentifier(s),r=new ft[n][e](i),a=new ft[n].IfcPropertySingleValue(o,null,r,null);return a.expressID=this.increaseMaxID(t),await this.setData(t,a),a}newSingleStringProperty(t,e,s,i){return this.newSingleProperty(t,e,s,i)}newSingleNumericProperty(t,e,s,i){return this.newSingleProperty(t,e,s,i)}newSingleBooleanProperty(t,e,s,i){return this.newSingleProperty(t,e,s,i)}async removePsetProp(t,e,s){const i=await t.getProperties(e),n=await t.getProperties(s);!i||!n||i.type===ti&&n&&(i.HasProperties=i.HasProperties.filter(o=>o.value!==s),await t.setProperties(s,null),this.registerChange(t,e,s))}async addElementToPset(t,e,...s){const i=await Yt.getPsetRel(t,e);if(!i)return;const n=await t.getProperties(i);if(n){for(const o of s){const r=new Ze(o);n.RelatedObjects.push(r),this.onElementToPset.trigger({model:t,psetID:e,elementID:o})}this.registerChange(t,e)}}async addPropToPset(t,e,...s){const i=await t.getProperties(e);if(i){for(const n of s){if(i.HasProperties.includes(n))continue;const o=new Ze(n);i.HasProperties.push(o),this.onPropToPset.trigger({model:t,psetID:e,propID:n})}this.registerChange(t,e)}}async saveToIfc(t,e){const s=this.components.get(Xa),i=s.webIfc,n=await s.readIfcFile(e),o=this.changeMap[t.uuid]??[];for(const a of o){const c=await t.getProperties(a);if(c)try{i.WriteLine(n,c)}catch{}else try{i.DeleteLine(n,a)}catch{}}const r=i.SaveModel(n);return s.webIfc.CloseModel(n),s.cleanUp(),r}async setAttributeListener(t,e,s){this.attributeListeners[t.uuid]||(this.attributeListeners[t.uuid]={});const i=this.attributeListeners[t.uuid][e]?this.attributeListeners[t.uuid][e][s]:null;if(i)return i;const n=await t.getProperties(e);if(!n)throw new Error(`Entity with expressID ${e} doesn't exists.`);const o=n[s];if(Array.isArray(o)||!o)throw new Error(`Attribute ${s} is array or null, and it can't have a listener.`);const r=o.value;if(r===void 0||r==null)throw new Error(`Attribute ${s} has a badly defined handle.`);const a=new M;return Object.defineProperty(n[s],"value",{get(){return this._value},async set(c){this._value=c,a.trigger(c)}}),n[s].value=r,this.attributeListeners[t.uuid][e]||(this.attributeListeners[t.uuid][e]={}),this.attributeListeners[t.uuid][e][s]=a,a}};I(Za,"uuid","58c2d9f0-183c-48d6-a402-dfcf5b9a34df");const lo=class Eo extends q{constructor(t){super(t),I(this,"enabled",!0),I(this,"list",{}),I(this,"onDisposed",new M),I(this,"onFragmentsDisposed",e=>{const{groupID:s,fragmentIDs:i}=e;for(const n in this.list){const o=this.list[n],r=Object.keys(o);if(r.includes(s))delete o[s],Object.values(o).length===0&&delete this.list[n];else for(const a of r){const c=o[a];for(const d of i)delete c[d];Object.values(c).length===0&&delete o[a]}}}),t.add(Eo.uuid,this),t.get(wt).onFragmentsDisposed.add(this.onFragmentsDisposed)}dispose(){this.list={},this.components.get(wt).onFragmentsDisposed.remove(this.onFragmentsDisposed),this.onDisposed.trigger(),this.onDisposed.reset()}remove(t){for(const e in this.list){const s=this.list[e];for(const i in s){const n=s[i];delete n[t]}}}find(t){const e=this.components.get(wt);if(!t){const o={};for(const[r,a]of e.list)o[r]=new Set(a.ids);return o}const s=Object.keys(t).length,i={};for(const o in t){const r=t[o];if(!this.list[o]){console.warn(`Classification ${o} does not exist.`);continue}for(const a of r){const c=this.list[o][a];if(c)for(const d in c){i[d]||(i[d]=new Map);for(const E of c[d]){const l=i[d].get(E);l===void 0?i[d].set(E,1):i[d].set(E,l+1)}}}}const n={};for(const o in i){const r=i[o];for(const[a,c]of r){if(c===void 0)throw new Error("Malformed fragments map!");c===s&&(n[o]||(n[o]=new Set),n[o].add(a))}}return n}byModel(t,e){this.list.models||(this.list.models={});const s=this.list.models;s[t]||(s[t]={});const i=s[t];for(const[n,o]of e.data){const r=o[0];for(const a of r){const c=e.keyFragments.get(a);c&&(i[c]||(i[c]=new Set),i[c].add(n))}}}async byPredefinedType(t){var e;this.list.predefinedTypes||(this.list.predefinedTypes={});const s=this.list.predefinedTypes,i=t.getAllPropertiesIDs();for(const n of i){const o=await t.getProperties(n);if(!o)continue;const r=String((e=o.PredefinedType)==null?void 0:e.value).toUpperCase();s[r]||(s[r]={});const a=s[r];for(const[c,d]of t.data){const E=d[0];for(const l of E){const u=t.keyFragments.get(l);if(!u)throw new Error("Fragment ID not found!");a[u]||(a[u]=new Set),a[u].add(o.expressID)}}}}byEntity(t){this.list.entities||(this.list.entities={});for(const[e,s]of t.data){const i=s[1][1],n=no[i];this.saveItem(t,"entities",n,e)}}async byIfcRel(t,e,s){Yt.isRel(e)&&await Yt.getRelationMap(t,e,async(i,n)=>{const{name:o}=await Yt.getEntityName(t,i);for(const r of n)this.saveItem(t,s,o??"NO REL NAME",r)})}async bySpatialStructure(t){var e;const s=this.components.get(Bi),i=s.relationMaps[t.uuid];if(!i)throw new Error(`Classifier: model relations of ${t.name||t.uuid} have to exists to group by spatial structure.`);const n="spatialStructures";for(const[o]of i){const r=s.getEntityRelations(t,o,"ContainsElements"),a=await t.getProperties(o);if(!(r&&a))continue;const c=(e=a.Name)==null?void 0:e.value;for(const d of r){this.saveItem(t,n,c,d);const E=s.getEntityRelations(t,Number(d),"IsDecomposedBy");if(E)for(const l of E)this.saveItem(t,n,c,l)}}}setColor(t,e,s=!1){const i=this.components.get(wt);for(const n in t){const o=i.list.get(n);if(!o)continue;const r=t[n];o.setColor(e,r,s)}}resetColor(t){const e=this.components.get(wt);for(const s in t){const i=e.list.get(s);if(!i)continue;const n=t[s];i.resetColor(n)}}saveItem(t,e,s,i){this.list[e]||(this.list[e]={});const n=t.data.get(i);if(n)for(const o of n[0]){const r=t.keyFragments.get(o);if(r){const a=this.list[e];a[s]||(a[s]={}),a[s][r]||(a[s][r]=new Set),a[s][r].add(i)}}}};I(lo,"uuid","e25a7f3c-46c4-4a14-9d3d-5115f24ebeb7");let Qa=lo;const Io=class uo extends q{constructor(t){super(t),I(this,"enabled",!0),I(this,"height",10),I(this,"groupName","storeys"),I(this,"onDisposed",new M),I(this,"list",new Set),t.add(uo.uuid,this)}dispose(){this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}set(t){if(!this.enabled)return;const e=this.components.get(Qa),s=this.components.get(wt),i=t?1:-1;let n=0;const o=e.list[this.groupName],r=new X;for(const a in o){r.elements[13]=n*i*this.height;for(const c in o[a]){const d=s.list.get(c),E=a+c,l=this.list.has(E);if(!d||t&&l||!t&&!l)continue;t?this.list.add(E):this.list.delete(E);const u=o[a][c];d.applyTransform(u,r)}n++}}};I(Io,"uuid","d260618b-ce88-4c7d-826c-6debb91de3e2");let ah=Io;const po=class Co extends q{constructor(t){super(t),I(this,"enabled",!0),this.components.add(Co.uuid,this)}set(t,e){const s=this.components.get(wt);if(!e){for(const i in s.list){const n=s.list.get(i);n&&(n.setVisibility(t),this.updateCulledVisibility(n))}return}for(const i in e){const n=e[i],o=s.list.get(i);o&&(o.setVisibility(t,n),this.updateCulledVisibility(o))}}isolate(t){this.set(!1),this.set(!0,t)}updateCulledVisibility(t){const e=this.components.get(va);for(const[s,i]of e.list){const n=i.colorMeshes.get(t.id);n&&(n.count=t.mesh.count)}}};I(po,"uuid","dd9ccf2d-8a21-4821-b7f6-2949add16a29");let hh=po;class ja extends Yi{constructor(){super(...arguments),I(this,"minGeometrySize",10),I(this,"minAssetsSize",1e3)}}class To extends Yi{constructor(){super(...arguments),I(this,"propertiesSize",100)}}class qa extends q{constructor(){super(...arguments),I(this,"onPropertiesStreamed",new Kt),I(this,"onProgress",new Kt),I(this,"onIndicesStreamed",new Kt),I(this,"onDisposed",new M),I(this,"enabled",!0),I(this,"settings",new To),I(this,"webIfc",new zt)}async dispose(){this.onIndicesStreamed.reset(),this.onPropertiesStreamed.reset(),this.webIfc=null,this.onDisposed.reset()}async streamFromBuffer(t){const e=performance.now();await this.readIfcFile(t),await this.streamAllProperties(),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-e} ms!`)}async streamFromCallBack(t){const e=performance.now();await this.streamIfcFile(t),await this.streamAllProperties(),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-e} ms!`)}async readIfcFile(t){const{path:e,absolute:s,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(e,s),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModel(t,this.settings.webIfc)}async streamIfcFile(t){const{path:e,absolute:s,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(e,s),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModelFromCallback(t,this.settings.webIfc)}async streamAllProperties(){const{propertiesSize:t}=this.settings,e=new Set(this.webIfc.GetIfcEntityList(0)),s=[_s,_i,Fi,Ss,gi,Oi],i=new Map,n=new Set([Si,Ni,wi,yi,$t]);for(const c of n)e.add(c);let o=.01,r=0;for(const c of e){if(r++,vi.has(c))continue;const d=n.has(c),E=this.webIfc.GetLineIDsWithType(0,c),l=E.size();let u=0;for(let C=0;C<l-t;C+=t){const f={};for(let m=0;m<t;m++){u++;const R=E.get(C+m);try{const F=this.webIfc.GetLine(0,R,d);s.includes(c)&&this.getIndices(F,R,i),f[F.expressID]=F}catch{console.log(`Could not get property: ${R}`)}}await this.onPropertiesStreamed.trigger({type:c,data:f})}if(u!==l){const C={};for(let f=u;f<l;f++){const m=E.get(f);try{const R=this.webIfc.GetLine(0,m,d);s.includes(c)&&this.getIndices(R,m,i),C[R.expressID]=R}catch{console.log(`Could not get property: ${m}`)}}await this.onPropertiesStreamed.trigger({type:c,data:C})}const T=r/e.size;T>o&&(o+=.01,o=Math.max(o,T),await this.onProgress.trigger(Math.round(o*100)/100))}const a=[];for(const[c,d]of i)a.push([c,...d]);await this.onIndicesStreamed.trigger(a)}getIndices(t,e,s){const i=t.RelatedObjects||t.RelatedElements;if(!i){console.log(`Related objects not found: ${e}`);return}const n=t.RelatingType||t.RelatingMaterial||t.RelatingStructure||t.RelatingPropertyDefinition||t.RelatingGroup||t.RelatingClassification;if(!n){console.log(`Relating object not found: ${e}`);return}if(!Array.isArray(i)||n.value===void 0)return;const o=n.value;for(const r of i){if(r.value===void 0||r.value===null)continue;const a=r.value;s.has(a)||s.set(a,new Set),s.get(a).add(o)}}cleanUp(){this.webIfc=null,this.webIfc=new zt}}I(qa,"uuid","88d2c89c-ce32-47d7-8cb6-d51e4b311a0b");const Ka=class mo extends q{constructor(t){super(t),I(this,"onGeometryStreamed",new M),I(this,"onAssetStreamed",new M),I(this,"onProgress",new M),I(this,"onIfcLoaded",new M),I(this,"onDisposed",new M),I(this,"settings",new ja),I(this,"enabled",!0),I(this,"webIfc",new zt),I(this,"_spatialTree",new ro),I(this,"_metaData",new ho),I(this,"_visitedGeometries",new Map),I(this,"_streamSerializer",new bo),I(this,"_geometries",new Map),I(this,"_geometryCount",0),I(this,"_civil",new ao),I(this,"_groupSerializer",new Pn),I(this,"_assets",[]),I(this,"_meshesWithHoles",new Set),this.components.add(mo.uuid,this),this.settings.excludedCategories.add(Un)}dispose(){this.onIfcLoaded.reset(),this.onGeometryStreamed.reset(),this.onAssetStreamed.reset(),this.webIfc=null,this.onDisposed.trigger(),this.onDisposed.reset()}async streamFromBuffer(t){const e=performance.now();await this.readIfcFile(t),await this.streamAllGeometries(),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-e} ms!`)}async streamFromCallBack(t){const e=performance.now();await this.streamIfcFile(t),await this.streamAllGeometries(),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-e} ms!`)}async readIfcFile(t){const{path:e,absolute:s,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(e,s),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModel(t,this.settings.webIfc)}async streamIfcFile(t){const{path:e,absolute:s,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(e,s),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModelFromCallback(t,this.settings.webIfc)}async streamAllGeometries(){const{minGeometrySize:t,minAssetsSize:e}=this.settings;this._spatialTree.setUp(this.webIfc);const s=this.webIfc.GetIfcEntityList(0),i=[[]],n=new Dn,{FILE_NAME:o,FILE_DESCRIPTION:r}=ft;n.ifcMetadata={name:this._metaData.get(this.webIfc,o),description:this._metaData.get(this.webIfc,r),schema:this.webIfc.GetModelSchema(0)||"IFC2X3",maxExpressID:this.webIfc.GetMaxExpressID(0)};let a=0,c=0;for(const m of s){if(!this.webIfc.IsIfcElement(m)&&m!==$t||this.settings.excludedCategories.has(m))continue;const R=this.webIfc.GetLineIDsWithType(0,m),F=R.size();console.log(F);for(let p=0;p<F;p++){a>t&&(a=0,c++,i.push([]));const A=R.get(p);i[c].push(A);const g=this._spatialTree.itemsByFloor[A]||0;n.data.set(A,[[],[g,m]]),a++}}this._spatialTree.cleanUp();let d=.01,E=0;for(const m of i){E++,this.webIfc.StreamMeshes(0,m,F=>{this.getMesh(this.webIfc,F,n)}),this._geometryCount>t&&await this.streamGeometries(),this._assets.length>e&&await this.streamAssets();const R=E/i.length;R>d&&(d+=.01,d=Math.max(d,R),this.onProgress.trigger(Math.round(d*100)/100))}this._geometryCount&&await this.streamGeometries(),this._assets.length&&await this.streamAssets();const{opaque:l,transparent:u}=n.geometryIDs;for(const[m,{index:R,uuid:F}]of this._visitedGeometries)n.keyFragments.set(R,F),(m>1?l:u).set(m,R);const T=n.data.keys();for(const m of T){const[R]=n.data.get(m);R.length||n.data.delete(m)}const C=this.webIfc.GetCoordinationMatrix(0);n.coordinationMatrix.fromArray(C),n.civilData=this._civil.read(this.webIfc);const f=this._groupSerializer.export(n);this.onIfcLoaded.trigger(f),n.dispose(!0)}cleanUp(){this.webIfc=null,this.webIfc=new zt,this._visitedGeometries.clear(),this._geometries.clear(),this._assets=[],this._meshesWithHoles.clear()}getMesh(t,e,s){const i=e.geometries.size(),n=e.expressID,o={id:n,geometries:[]};for(let r=0;r<i;r++){const a=e.geometries.get(r),c=a.geometryExpressID,d=a.color.w===1?1:-1,E=c*d;if(!this._visitedGeometries.has(E)){this._visitedGeometries.has(c)||this.getGeometry(t,c);const p=this._visitedGeometries.size,A=Ln.generateUUID();this._visitedGeometries.set(E,{uuid:A,index:p})}const l=this._visitedGeometries.get(E);if(l===void 0)throw new Error("Error getting geometry data for streaming!");const u=s.data.get(n);if(!u)throw new Error("Data not found!");u[0].push(l.index);const{x:T,y:C,z:f,w:m}=a.color,R=[T,C,f,m],F=a.flatTransformation;o.geometries.push({color:R,geometryID:c,transformation:F})}this._assets.push(o)}getGeometry(t,e){const s=t.GetGeometry(0,e),i=t.GetIndexArray(s.GetIndexData(),s.GetIndexDataSize()),n=t.GetVertexArray(s.GetVertexData(),s.GetVertexDataSize()),o=new Float32Array(n.length/2),r=new Float32Array(n.length/2);for(let l=0;l<n.length;l+=6)o[l/2]=n[l],o[l/2+1]=n[l+1],o[l/2+2]=n[l+2],r[l/2]=n[l+3],r[l/2+1]=n[l+4],r[l/2+2]=n[l+5];const a=da(o),c=new Float32Array(a.transformation.elements),d=[a.center.x,a.center.y,a.center.z];let E=!1;for(let l=0;l<o.length-2;l+=3){const u=o[l],T=o[l+1],C=o[l+2],f=r[l],m=r[l+1],R=r[l+2];if(Ea(d,[u,T,C],[f,m,R])){E=!0;break}}this._geometries.set(e,{position:o,normal:r,index:i,boundingBox:c,hasHoles:E}),s.delete(),this._geometryCount++}async streamAssets(){await this.onAssetStreamed.trigger(this._assets),this._assets=null,this._assets=[]}async streamGeometries(){let t=this._streamSerializer.export(this._geometries),e={};for(const[s,{boundingBox:i,hasHoles:n}]of this._geometries)e[s]={boundingBox:i,hasHoles:n};this.onGeometryStreamed.trigger({data:e,buffer:t}),e=null,t=null,this._geometries.clear(),this._geometryCount=0}};I(Ka,"uuid","d9999a00-e1f5-4d3f-8cfe-c56e08609764");class $a extends q{constructor(){super(...arguments),I(this,"onPropertiesStreamed",new Kt),I(this,"onProgress",new Kt),I(this,"onIndicesStreamed",new Kt),I(this,"onDisposed",new M),I(this,"enabled",!0),I(this,"settings",new To),I(this,"webIfc",new zt)}async dispose(){this.onIndicesStreamed.reset(),this.onPropertiesStreamed.reset(),this.webIfc=null,this.onDisposed.reset()}async streamFromBuffer(t){const e=performance.now();await this.readIfcFile(t),await this.streamAllProperties(),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-e} ms!`)}async streamFromCallBack(t){const e=performance.now();await this.streamIfcFile(t),await this.streamAllProperties(),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-e} ms!`)}async readIfcFile(t){const{path:e,absolute:s,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(e,s),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModel(t,this.settings.webIfc)}async streamIfcFile(t){const{path:e,absolute:s,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(e,s),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModelFromCallback(t,this.settings.webIfc)}async streamAllProperties(){const{propertiesSize:t}=this.settings,e=new Set(this.webIfc.GetIfcEntityList(0)),s=new Set([Si,Ni,wi,yi,$t]);for(const r of s)e.add(r);let i=.01,n=0;for(const r of e){if(n++,vi.has(r))continue;const a=s.has(r),c=this.webIfc.GetLineIDsWithType(0,r),d=c.size();let E=0;for(let u=0;u<d-t;u+=t){const T={};for(let C=0;C<t;C++){E++;const f=c.get(u+C);try{const m=this.webIfc.GetLine(0,f,a);T[m.expressID]=m}catch{console.log(`Could not get property: ${f}`)}}await this.onPropertiesStreamed.trigger({type:r,data:T})}if(E!==d){const u={};for(let T=E;T<d;T++){const C=c.get(T);try{const f=this.webIfc.GetLine(0,C,a);u[f.expressID]=f}catch{console.log(`Could not get property: ${C}`)}}await this.onPropertiesStreamed.trigger({type:r,data:u})}const l=n/e.size;l>i&&(i+=.01,i=Math.max(i,l),await this.onProgress.trigger(Math.round(i*100)/100))}const o=await this.components.get(Bi).processFromWebIfc(this.webIfc,0);await this.onIndicesStreamed.trigger(o)}cleanUp(){this.webIfc=null,this.webIfc=new zt}}I($a,"uuid","88d2c89c-ce32-47d7-8cb6-d51e4b311a0b");const fo=class Ro extends q{constructor(t){super(t),I(this,"enabled",!0),t.add(Ro.uuid,this)}getFace(t,e,s){if(!t.geometry.index)throw new Error("Geometry must be indexed!");const i=new Map,n=t.geometry.index.array,{plane:o}=this.getFaceData(e,s,t),r=[];for(let E=0;E<n.length/3;E++){const{plane:l,edges:u}=this.getFaceData(E,s,t);if(l.equals(o)){r.push({index:E,edges:u});for(const{id:T,points:C,distance:f}of u)i.set(T,{points:C,distance:f})}}let a=0;const c=new Map,d=new Map;for(const{index:E,edges:l}of r){const u=new Map;for(const{id:p}of l)if(c.has(p)){const A=c.get(p);u.set(p,A)}const T=l.map(p=>p.id);if(!u.size){const p=a++;for(const{id:A}of l)c.set(A,p);d.set(p,{edges:new Set(T),indices:new Set([E])});continue}let C=null;const f=new Set,m=new Set(T);for(const[p,A]of u){C===null?C=A:A!==C&&f.add(A),c.delete(p);const{edges:g}=d.get(A);g.delete(p),m.delete(p)}if(C===null)throw new Error("Error computing face!");const R=d.get(C),{indices:F}=R;F.add(E);for(const p of m){c.set(p,C);const{edges:A}=R;A.add(p)}for(const p of f){const A=d.get(p),{edges:g,indices:_}=A,S=d.get(C),{edges:w,indices:y}=S;for(const L of g)w.add(L),c.set(L,C);for(const L of _)y.add(L);d.delete(p)}}for(const[E,{indices:l,edges:u}]of d)if(l.has(e)){const T=[];for(const C of u){const f=i.get(C);T.push(f)}return{edges:T,indices:l}}return null}static distanceFromPointToLine(t,e,s,i=!1){const n=new At,o=new O;return n.set(e,s),n.closestPointToPoint(t,i,o),o.distanceTo(t)}getFaceData(t,e,s){const i=this.getVerticesAndNormal(s,t,e),{p1:n,p2:o,p3:r,faceNormal:a}=i;this.round(n),this.round(o),this.round(r),this.round(a);const c=[{id:`${n.x}|${n.y}|${n.z}`,value:n},{id:`${o.x}|${o.y}|${o.z}`,value:o},{id:`${r.x}|${r.y}|${r.z}`,value:r}];c.sort((R,F)=>R.id<F.id?-1:R.id>F.id?1:0);const[{id:d,value:E},{id:l,value:u},{id:T,value:C}]=c,f=[{id:`${d}|${l}`,distance:E.distanceTo(u),points:[E,u]},{id:`${l}|${T}`,distance:u.distanceTo(C),points:[u,C]},{id:`${d}|${T}`,distance:E.distanceTo(C),points:[E,C]}],m=new fe;return m.setFromNormalAndCoplanarPoint(a,n),m.constant=Math.round(m.constant*10)/10,{plane:m,edges:f}}getVerticesAndNormal(t,e,s){if(!t.geometry.index)throw new Error("Geometry must be indexed!");const i=t.geometry.index.array,n=t.geometry.attributes.position.array,o=t.geometry.attributes.normal.array,r=i[e*3]*3,a=i[e*3+1]*3,c=i[e*3+2]*3,d=new O(n[r],n[r+1],n[r+2]),E=new O(n[a],n[a+1],n[a+2]),l=new O(n[c],n[c+1],n[c+2]),u=new O(o[r],o[r+1],o[r+2]),T=new O(o[a],o[a+1],o[a+2]),C=new O(o[c],o[c+1],o[c+2]),f=(u.x+T.x+C.x)/3,m=(u.y+T.y+C.y)/3,R=(u.z+T.z+C.z)/3,F=new O(f,m,R);if(s!==void 0&&t instanceof Ge){const p=new X;t.getMatrixAt(s,p);const A=new X;A.extractRotation(p),F.applyMatrix4(A),d.applyMatrix4(p),E.applyMatrix4(p),l.applyMatrix4(p)}return{p1:d,p2:E,p3:l,faceNormal:F}}round(t){t.x=Math.trunc(t.x*1e3)/1e3,t.y=Math.trunc(t.y*1e3)/1e3,t.z=Math.trunc(t.z*1e3)/1e3}};I(fo,"uuid","267ca032-672f-4cb0-afa9-d24e904f39d6");let ch=fo;export{rh as A,va as C,Yt as G,Ei as H,q as J,Kt as K,ga as N,ah as O,Qa as R,M as U,Bi as W,xa as Y,ch as _,me as a,bi as b,Xa as c,no as d,th as e,Ia as f,hh as g,nh as h,sh as i,He as k,ih as m,oh as n,Aa as p,eh as s,wt as u};
