var D=Object.defineProperty;var F=(e,o,t)=>o in e?D(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t;var p=(e,o,t)=>(F(e,typeof o!="symbol"?o+"":o,t),t);import{V as y,C as I,L as R}from"./web-ifc-api-CmZKgq4q.js";import{S as W}from"./stats.min-GTpOrGrX.js";import{J as _,m as U}from"./import-wrapper-prod-Cl9qVCJR.js";import{E as V,C as j}from"./index-Du92Rlr0.js";import{P as z}from"./index-CINZ6ccg.js";import{C as G}from"./index-BPEN57nQ.js";import{C as H}from"./index-BXR8NGF5.js";import{C as Y}from"./index-BY9UMWyK.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./renderer-with-2d-RJhD6QVJ.js";import"./index-DFEziHJ_.js";import"./mark-B0joXqB1.js";import"./Line2-BbfgnzhJ.js";const h=class h extends _{constructor(t){super(t);p(this,"_world",null);p(this,"enabled",!0);p(this,"plane");this.components.add(h.uuid,this)}get world(){return this._world}set world(t){var i;if(this._world=t,(i=this.plane)==null||i.dispose(),!t)return;const s=this.components.get(U),r=s.Type;s.Type=V,this.plane=s.createFromNormalAndCoplanarPoint(t,new y(1,0,0),new y),s.Type=r,this.plane.visible=!1,this.plane.enabled=!1}async set(t,s){if(!this.world||!this.plane)throw new Error("You must set a world before using this component");this.plane.enabled=!0;const r=t.curve.getPercentageAt(s);if(r===null)return;const{startPoint:i,endPoint:O}=t.curve.getSegmentAt(r);if(t.geometry.index===null)throw new Error("Geometry must be indexed!");const b=new y;b.subVectors(O,i),b.normalize(),await this.plane.setFromNormalAndCoplanarPoint(b,s);const C=this.plane.helper.matrix.clone();C.invert();const M=this.world.scene.three,x=this.plane.edges.get();for(const B in x){const{mesh:c}=x[B];c.position.set(0,0,0),c.rotation.set(0,0,0),c.updateMatrix(),c.applyMatrix4(C),c.parent!==M&&M.add(c)}this.plane.enabled=!1}};p(h,"uuid","96b2c87e-d90b-4639-8257-8f01136fe324");let v=h;const J=document.getElementById("container"),n=new(void 0),T=new(void 0)(n);T.setup();n.scene=T;const d=new z(n,J);n.renderer=d;const E=new(void 0)(n);n.camera=E;n.raycaster=new(void 0)(n);n.init();d.postproduction.enabled=!0;d.postproduction.customEffects.outlineEnabled=!0;E.controls.setLookAt(12,6,8,0,0,-10);const Z=new(void 0)(n,new I(6710886)),q=d.postproduction.customEffects;q.excludedMeshes.push(Z.get());const k=new(void 0)(n),w=new(void 0)(n);w.settings.wasm={path:"https://unpkg.com/web-ifc@0.0.50/",absolute:!0};w.settings.webIfc.COORDINATE_TO_ORIGIN=!0;w.settings.webIfc.OPTIMIZE_PROFILES=!0;const K=await fetch("../../../resources/asdf.frag"),Q=await K.arrayBuffer(),X=new Uint8Array(Q),l=await k.load(X),$=await fetch("../../../resources/asdf.json");l.setLocalProperties(await $.json());const N=new(void 0)(n,{name:"Main Toolbar",position:"bottom"});n.ui.addToolbar(N);N.addChild(w.uiElement.get("main"));console.log(l);const m=new G(n),ee=m.uiElement.get("floatingWindow");ee.visible=!0;m.draw(l);const a=new H(n),te=a.uiElement.get("drawer");te.visible=!0;const u=new Y(n);u.draw(l);u.setup();u.highlighter.hoverCurve.material.color.set(1,1,1);const{material:g}=m.highlighter.hoverPoints;if(Array.isArray(g)){const e=g[0];"color"in e&&e.color.set(1,1,1)}else"color"in g&&g.color.set(1,1,1);m.onHighlight.add(({mesh:e})=>{a.clear(),a.draw(l,[e.curve.alignment]),a.highlighter.select(e),u.highlighter.select(e);const o=e.curve.index,t=e.curve.alignment.absolute[o];t.mesh.geometry.computeBoundingSphere(),E.controls.fitToSphere(t.mesh.geometry.boundingSphere,!0)});const L=new v(n),ne=L.uiElement.get("floatingWindow");ne.visible=!0;m.onMarkerChange.add(({alignment:e,percentage:o,type:t,curve:s})=>{if(a.setMarker(e,o,t),u.setMarker(e,o,t),t==="select"){const r=s.alignment.absolute[s.index].mesh,i=e.getPointAt(o,"absolute");L.set(r,i)}});m.onMarkerHidden.add(({type:e})=>{a.hideMarker(e),u.hideMarker(e)});window.addEventListener("keydown",()=>{a.scene.scaleY+=.1});const P=new(void 0)(n);P.byEntity(l);const oe=P.get(),S=n.tools.get(j),A=S.styles.get();for(const e in oe.entities){const o=P.find({entities:[e]}),t=new I(Math.random(),Math.random(),Math.random()),s=new R({color:t});S.styles.create(e,new Set,s);for(const r in o){const i=k.list[r];i&&(A[e].fragments[r]=new Set(o[r]),A[e].meshes.add(i.mesh))}}const f=new W;f.showPanel(2);document.body.append(f.dom);f.dom.style.left="0px";d.onBeforeUpdate.add(()=>f.begin());d.onAfterUpdate.add(()=>f.end());
