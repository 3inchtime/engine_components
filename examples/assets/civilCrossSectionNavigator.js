var F=Object.defineProperty;var R=(e,o,t)=>o in e?F(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t;var f=(e,o,t)=>(R(e,typeof o!="symbol"?o+"":o,t),t);import{V as v,C as I,L as W}from"./web-ifc-api-BFxa4VQ4.js";import{S as _}from"./stats.min-GTpOrGrX.js";import{i as U}from"./import-wrapper-prod-BtIvq9o4.js";import{E as k}from"./index-DDeTVJ4t.js";import{P as V}from"./index-BneKMXsD.js";import{C as j}from"./index-l4fssrkN.js";import{C as z}from"./index-h4lH_Bdw.js";import{C as G}from"./index-CkhaoZEp.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./index-Czb5ZY1a.js";import"./index-7Q6oBdFR.js";import"./mark-Fi_tU5tP.js";import"./Line2-COOhHMVl.js";const h=class h extends U{constructor(t){super(t);f(this,"_world",null);f(this,"enabled",!0);f(this,"plane");this.components.add(h.uuid,this)}get world(){return this._world}set world(t){var s;if(this._world=t,(s=this.plane)==null||s.dispose(),!t)return;const r=this.components.get(k);this.plane=r.createFromNormalAndCoplanarPoint(t,new v(1,0,0),new v),this.plane.visible=!1,this.plane.enabled=!1}async set(t,r){if(!this.world||!this.plane)throw new Error("You must set a world before using this component");this.plane.enabled=!0;const s=t.curve.getPercentageAt(r);if(s===null)return;const{startPoint:a,endPoint:B}=t.curve.getSegmentAt(s);if(t.geometry.index===null)throw new Error("Geometry must be indexed!");const b=new v;b.subVectors(B,a),b.normalize(),await this.plane.setFromNormalAndCoplanarPoint(b,r);const P=this.plane.helper.matrix.clone();P.invert();const C=this.world.scene.three,x=this.plane.edges.get();for(const D in x){const{mesh:c}=x[D];c.position.set(0,0,0),c.rotation.set(0,0,0),c.updateMatrix(),c.applyMatrix4(P),c.parent!==C&&C.add(c)}this.plane.enabled=!1}};f(h,"uuid","96b2c87e-d90b-4639-8257-8f01136fe324");let y=h;const H=document.getElementById("container"),n=new(void 0),N=new(void 0)(n);N.setup();n.scene=N;const d=new V(n,H);n.renderer=d;const E=new(void 0)(n);n.camera=E;n.raycaster=new(void 0)(n);n.init();d.postproduction.enabled=!0;d.postproduction.customEffects.outlineEnabled=!0;E.controls.setLookAt(12,6,8,0,0,-10);const Y=new(void 0)(n,new I(6710886)),Z=d.postproduction.customEffects;Z.excludedMeshes.push(Y.get());const L=new(void 0)(n),w=new(void 0)(n);w.settings.wasm={path:"https://unpkg.com/web-ifc@0.0.50/",absolute:!0};w.settings.webIfc.COORDINATE_TO_ORIGIN=!0;w.settings.webIfc.OPTIMIZE_PROFILES=!0;const q=await fetch("../../../resources/asdf.frag"),J=await q.arrayBuffer(),K=new Uint8Array(J),l=await L.load(K),Q=await fetch("../../../resources/asdf.json");l.setLocalProperties(await Q.json());const S=new(void 0)(n,{name:"Main Toolbar",position:"bottom"});n.ui.addToolbar(S);S.addChild(w.uiElement.get("main"));console.log(l);const m=new j(n),X=m.uiElement.get("floatingWindow");X.visible=!0;m.draw(l);const i=new z(n),$=i.uiElement.get("drawer");$.visible=!0;const u=new G(n);u.draw(l);u.setup();u.highlighter.hoverCurve.material.color.set(1,1,1);const{material:g}=m.highlighter.hoverPoints;if(Array.isArray(g)){const e=g[0];"color"in e&&e.color.set(1,1,1)}else"color"in g&&g.color.set(1,1,1);m.onHighlight.add(({mesh:e})=>{i.clear(),i.draw(l,[e.curve.alignment]),i.highlighter.select(e),u.highlighter.select(e);const o=e.curve.index,t=e.curve.alignment.absolute[o];t.mesh.geometry.computeBoundingSphere(),E.controls.fitToSphere(t.mesh.geometry.boundingSphere,!0)});const T=new y(n),ee=T.uiElement.get("floatingWindow");ee.visible=!0;m.onMarkerChange.add(({alignment:e,percentage:o,type:t,curve:r})=>{if(i.setMarker(e,o,t),u.setMarker(e,o,t),t==="select"){const s=r.alignment.absolute[r.index].mesh,a=e.getPointAt(o,"absolute");T.set(s,a)}});m.onMarkerHidden.add(({type:e})=>{i.hideMarker(e),u.hideMarker(e)});window.addEventListener("keydown",()=>{i.scene.scaleY+=.1});const M=new(void 0)(n);M.byEntity(l);const te=M.get(),O=n.tools.get(k),A=O.styles.get();for(const e in te.entities){const o=M.find({entities:[e]}),t=new I(Math.random(),Math.random(),Math.random()),r=new W({color:t});O.styles.create(e,new Set,r);for(const s in o){const a=L.list[s];a&&(A[e].fragments[s]=new Set(o[s]),A[e].meshes.add(a.mesh))}}const p=new _;p.showPanel(2);document.body.append(p.dom);p.dom.style.left="0px";d.onBeforeUpdate.add(()=>p.begin());d.onAfterUpdate.add(()=>p.end());
