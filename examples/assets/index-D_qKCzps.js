var Vt=Object.defineProperty;var Zt=(l,e,t)=>e in l?Vt(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var h=(l,e,t)=>(Zt(l,typeof e!="symbol"?e+"":e,t),t);import{i as Nt,j as Ut,ar as Wt,as as Xt,b as Kt,at as Gt,C as pt,V as Ot,c as Qt,D as qt,A as $t,W as Dt,a as Ct,d as jt,e as Jt,f as te,Q as ee,M as se,g as ie,B as oe,S as re,R as ne,h as ae}from"./unzipit.module-iWfmgAo3.js";class z{constructor(){h(this,"trigger",e=>{const t=this.handlers.slice(0);for(const s of t)s(e)});h(this,"handlers",[])}add(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}reset(){this.handlers.length=0}}class vt{constructor(e){h(this,"isDisposeable",()=>"dispose"in this&&"onDisposed"in this);h(this,"isResizeable",()=>"resize"in this&&"getSize"in this);h(this,"isUpdateable",()=>"onAfterUpdate"in this&&"onBeforeUpdate"in this&&"update"in this);h(this,"isHideable",()=>"visible"in this);h(this,"isConfigurable",()=>"setup"in this&&"config"in this&&"onSetup"in this);this.components=e}}class It extends vt{}class wt extends vt{constructor(t){super(t);h(this,"worlds",new Map);h(this,"onWorldChanged",new z);h(this,"currentWorld",null);this.onWorldChanged.add(({world:s,action:r})=>{r==="removed"&&this.worlds.delete(s.uuid)})}}class he extends wt{constructor(){super(...arguments);h(this,"hasCameraControls",()=>"controls"in this)}}class le extends wt{constructor(){super(...arguments);h(this,"onAfterUpdate",new z);h(this,"onBeforeUpdate",new z);h(this,"onDisposed",new z);h(this,"onResize",new z);h(this,"onClippingPlanesUpdated",new z);h(this,"clippingPlanes",[])}updateClippingPlanes(){this.onClippingPlanesUpdated.trigger()}setPlane(t,s,r){s.isLocal=r;const n=this.clippingPlanes.indexOf(s);t&&n===-1?this.clippingPlanes.push(s):!t&&n>-1&&this.clippingPlanes.splice(n,1),this.three.clippingPlanes=this.clippingPlanes.filter(a=>!a.isLocal)}}const et=class et extends It{constructor(t){super(t);h(this,"_disposedComponents",new Set);h(this,"enabled",!0);t.add(et.uuid,this)}get(){return this._disposedComponents}destroy(t,s=!0,r=!0){t.removeFromParent();const n=t;n.dispose&&n.dispose(),this.disposeGeometryAndMaterials(t,s),r&&n.children&&n.children.length&&this.disposeChildren(n),t.children.length=0}disposeGeometry(t){const s=t;s.boundsTree&&s.disposeBoundsTree(),t.dispose()}disposeGeometryAndMaterials(t,s){const r=t;r.geometry&&this.disposeGeometry(r.geometry),s&&r.material&&et.disposeMaterial(r),r.material=[],r.geometry=null}disposeChildren(t){for(const s of t.children)this.destroy(s)}static disposeMaterial(t){if(t.material)if(Array.isArray(t.material))for(const s of t.material)s.dispose();else t.material.dispose()}};h(et,"uuid","76e9cd8e-ad8f-4753-9ef6-cbc60f7247fe");let lt=et;class ce extends wt{constructor(t){super(t);h(this,"onDisposed",new z)}dispose(){const t=this.components.get(lt);for(const s of this.three.children){const r=s;r.geometry&&t.destroy(r)}this.three.children=[],this.onDisposed.trigger(),this.onDisposed.reset()}}const R=class R{static create(){const e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,s=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return`${R._lut[e&255]+R._lut[e>>8&255]+R._lut[e>>16&255]+R._lut[e>>24&255]}-${R._lut[t&255]}${R._lut[t>>8&255]}-${R._lut[t>>16&15|64]}${R._lut[t>>24&255]}-${R._lut[s&63|128]}${R._lut[s>>8&255]}-${R._lut[s>>16&255]}${R._lut[s>>24&255]}${R._lut[r&255]}${R._lut[r>>8&255]}${R._lut[r>>16&255]}${R._lut[r>>24&255]}`.toLowerCase()}static validate(e){if(!R._pattern.test(e))throw new Error(`${e} is not a valid UUID v4.

- If you're the tool creator, you can take one from https://www.uuidgenerator.net/.

- If you're using a platform tool, verify the uuid isn't misspelled or contact the tool creator.`)}};h(R,"_pattern",/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/),h(R,"_lut",["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"]);let ct=R;const dt=class dt{constructor(){h(this,"onDisposed",new z);h(this,"list",new Map);h(this,"enabled",!1);h(this,"_clock");h(this,"update",()=>{if(!this.enabled)return;const e=this._clock.getDelta();for(const[t,s]of this.list)s.enabled&&s.isUpdateable()&&s.update(e);requestAnimationFrame(this.update)});this._clock=new Nt,dt.setupBVH()}add(e,t){if(this.list.has(e))throw new Error("You're trying to add a component that already exists in the components intance. Use Components.get() instead.");ct.validate(e),this.list.set(e,t)}get(e){const t=e.uuid;if(!this.list.has(t)){const s=new e(this);return this.list.has(t)||this.add(t,s),s}return this.list.get(t)}init(){this.enabled=!0,this._clock.start(),this.update()}dispose(){this.enabled=!1;for(const[e,t]of this.list)t.enabled=!1,t.isDisposeable()&&t.dispose();this._clock.stop(),this.onDisposed.trigger(),this.onDisposed.reset()}static setupBVH(){Ut.prototype.computeBoundsTree=Wt,Ut.prototype.disposeBoundsTree=Xt,Kt.prototype.raycast=Gt}};h(dt,"release","1.4.21");let xt=dt;class de extends vt{constructor(t){super(t);h(this,"meshes",new Set);h(this,"onAfterUpdate",new z);h(this,"onBeforeUpdate",new z);h(this,"enabled",!0);h(this,"uuid",ct.create());h(this,"onDisposed",new z);h(this,"_scene");h(this,"_camera");h(this,"_renderer",null)}get scene(){if(!this._scene)throw new Error("No scene initialized!");return this._scene}set scene(t){this._scene=t,t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"})}get camera(){if(!this._camera)throw new Error("No camera initialized!");return this._camera}set camera(t){this._camera=t,t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"})}get renderer(){return this._renderer}set renderer(t){this._renderer=t,t&&(t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"}))}update(t){this.enabled&&(!this._scene||!this._camera||(this.scene.currentWorld=this,this.camera.currentWorld=this,this.renderer&&(this.renderer.currentWorld=this),this.onBeforeUpdate.trigger(),this.scene.isUpdateable()&&this.scene.update(t),this.camera.isUpdateable()&&this.camera.update(t),this.renderer&&this.renderer.update(t),this.onAfterUpdate.trigger()))}dispose(t=!0){if(this.enabled=!1,this.scene.onWorldChanged.trigger({world:this,action:"removed"}),this.camera.onWorldChanged.trigger({world:this,action:"removed"}),this.renderer&&this.renderer.onWorldChanged.trigger({world:this,action:"removed"}),t){const s=this.components.get(lt);this.scene.dispose(),this.camera.isDisposeable()&&this.camera.dispose(),this.renderer&&this.renderer.dispose();for(const r of this.meshes)s.destroy(r);this.meshes.clear()}this._scene=null,this._camera=null,this._renderer=null,this.onDisposed.trigger()}}class Ee extends ce{constructor(t){super(t);h(this,"isSetup",!1);h(this,"three");h(this,"onSetup",new z);h(this,"config",{directionalLight:{color:new pt("white"),intensity:1.5,position:new Ot(5,10,3)},ambientLight:{color:new pt("white"),intensity:1}});this.three=new Qt,this.three.background=new pt(2107698)}setup(t){this.config={...this.config,...t};const s=new qt(this.config.directionalLight.color,this.config.directionalLight.intensity);s.position.copy(this.config.directionalLight.position);const r=new $t(this.config.ambientLight.color,this.config.ambientLight.intensity);this.three.add(s,r),this.isSetup=!0,this.onSetup.trigger(this)}}class ye extends le{constructor(t,s,r){super(t);h(this,"enabled",!0);h(this,"container");h(this,"three");h(this,"_canvas");h(this,"_parameters");h(this,"onContainerUpdated",new z);h(this,"resize",t=>{if(this.updateContainer(),!this.container)return;const s=t?t.x:this.container.clientWidth,r=t?t.y:this.container.clientHeight;this.three.setSize(s,r),this.onResize.trigger(new Ct(s,r))});h(this,"resizeEvent",()=>{this.resize()});h(this,"onContextLost",t=>{t.preventDefault(),this.components.enabled=!1});h(this,"onContextBack",()=>{this.three.setRenderTarget(null),this.three.dispose(),this.three=new Dt({canvas:this._canvas,antialias:!0,alpha:!0,...this._parameters}),this.components.enabled=!0});this.container=s||null,this._parameters=r,this.three=new Dt({antialias:!0,alpha:!0,...r}),this.three.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.setupRenderer(),this.setupEvents(!0),this.resize(),this._canvas=this.three.domElement;const n=this.three.getContext(),{canvas:a}=n;a.addEventListener("webglcontextlost",this.onContextLost,!1),a.addEventListener("webglcontextrestored",this.onContextBack,!1)}update(){if(!this.enabled||!this.currentWorld)return;this.onBeforeUpdate.trigger(this);const t=this.currentWorld.scene.three,s=this.currentWorld.camera.three;this.three.render(t,s),this.onAfterUpdate.trigger(this)}dispose(){this.enabled=!1,this.setupEvents(!1),this.three.domElement.remove(),this.three.dispose(),this.onResize.reset(),this.onAfterUpdate.reset(),this.onBeforeUpdate.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}getSize(){return new Ct(this.three.domElement.clientWidth,this.three.domElement.clientHeight)}setupEvents(t){const s=this.three.domElement;t?s.addEventListener("resize",this.resizeEvent):s.removeEventListener("resize",this.resizeEvent)}setupRenderer(){this.three.localClippingEnabled=!0,this.container&&this.container.appendChild(this.three.domElement),this.updateContainer()}updateContainer(){if(!this.container){const t=this.three.domElement.parentElement;t&&(this.container=t,this.onContainerUpdated.trigger(t))}}}/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const m={LEFT:1,RIGHT:2,MIDDLE:4},i=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),X={NONE:0,IN:1,OUT:-1};function N(l){return l.isPerspectiveCamera}function Z(l){return l.isOrthographicCamera}const K=Math.PI*2,Lt=Math.PI/2,Ht=1e-5,q=Math.PI/180;function B(l,e,t){return Math.max(e,Math.min(t,l))}function L(l,e=Ht){return Math.abs(l)<e}function x(l,e,t=Ht){return L(l-e,t)}function At(l,e){return Math.round(l/e)*e}function $(l){return isFinite(l)?l:l<0?-Number.MAX_VALUE:Number.MAX_VALUE}function j(l){return Math.abs(l)<Number.MAX_VALUE?l:l*(1/0)}function rt(l,e,t,s,r=1/0,n){s=Math.max(1e-4,s);const a=2/s,c=a*n,p=1/(1+c+.48*c*c+.235*c*c*c);let u=l-e;const C=e,g=r*s;u=B(u,-g,g),e=l-u;const D=(t.value+a*u)*n;t.value=(t.value-a*D)*p;let E=e+(u+D)*p;return C-l>0==E>C&&(E=C,t.value=(E-C)/n),E}function bt(l,e,t,s,r=1/0,n,a){s=Math.max(1e-4,s);const c=2/s,p=c*n,u=1/(1+p+.48*p*p+.235*p*p*p);let C=e.x,g=e.y,D=e.z,E=l.x-C,A=l.y-g,v=l.z-D;const S=C,P=g,b=D,M=r*s,o=M*M,d=E*E+A*A+v*v;if(d>o){const mt=Math.sqrt(d);E=E/mt*M,A=A/mt*M,v=v/mt*M}C=l.x-E,g=l.y-A,D=l.z-v;const T=(t.x+c*E)*n,f=(t.y+c*A)*n,U=(t.z+c*v)*n;t.x=(t.x-c*T)*u,t.y=(t.y-c*f)*u,t.z=(t.z-c*U)*u,a.x=C+(E+T)*u,a.y=g+(A+f)*u,a.z=D+(v+U)*u;const O=S-l.x,F=P-l.y,H=b-l.z,it=a.x-S,ot=a.y-P,Yt=a.z-b;return O*it+F*ot+H*Yt>0&&(a.x=S,a.y=P,a.z=b,t.x=(a.x-S)/n,t.y=(a.y-P)/n,t.z=(a.z-b)/n),a}function ut(l,e){e.set(0,0),l.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=l.length,e.y/=l.length}function ft(l,e){return Z(l)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}class _e{constructor(){this._listeners={}}addEventListener(e,t){const s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(t)===-1&&s[e].push(t)}hasEventListener(e,t){const s=this._listeners;return s[e]!==void 0&&s[e].indexOf(t)!==-1}removeEventListener(e,t){const r=this._listeners[e];if(r!==void 0){const n=r.indexOf(t);n!==-1&&r.splice(n,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const s=this._listeners[e.type];if(s!==void 0){e.target=this;const r=s.slice(0);for(let n=0,a=r.length;n<a;n++)r[n].call(this,e)}}}const me="2.7.3",nt=1/8,kt=typeof window<"u",pe=kt&&/Mac/.test(navigator.platform),ue=!(kt&&"PointerEvent"in window);let _,St,at,gt,I,y,w,G,J,Y,V,W,Pt,Rt,k,tt,Q,zt,Et,Ft,yt,Tt,ht;class st extends _e{static install(e){_=e.THREE,St=Object.freeze(new _.Vector3(0,0,0)),at=Object.freeze(new _.Vector3(0,1,0)),gt=Object.freeze(new _.Vector3(0,0,1)),I=new _.Vector2,y=new _.Vector3,w=new _.Vector3,G=new _.Vector3,J=new _.Vector3,Y=new _.Vector3,V=new _.Vector3,W=new _.Vector3,Pt=new _.Vector3,Rt=new _.Vector3,k=new _.Spherical,tt=new _.Spherical,Q=new _.Box3,zt=new _.Box3,Et=new _.Sphere,Ft=new _.Quaternion,yt=new _.Quaternion,Tt=new _.Matrix4,ht=new _.Raycaster}static get ACTION(){return i}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=i.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=X.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new _.Vector3,this._focalOffsetVelocity=new _.Vector3,this._zoomVelocity={value:0},this._truckInternal=(o,d,T)=>{let f,U;if(N(this._camera)){const O=y.copy(this._camera.position).sub(this._target),F=this._camera.getEffectiveFOV()*q,H=O.length()*Math.tan(F*.5);f=this.truckSpeed*o*H/this._elementRect.height,U=this.truckSpeed*d*H/this._elementRect.height}else if(Z(this._camera)){const O=this._camera;f=o*(O.right-O.left)/O.zoom/this._elementRect.width,U=d*(O.top-O.bottom)/O.zoom/this._elementRect.height}else return;this.verticalDragToForward?(T?this.setFocalOffset(this._focalOffsetEnd.x+f,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(f,0,!0),this.forward(-U,!0)):T?this.setFocalOffset(this._focalOffsetEnd.x+f,this._focalOffsetEnd.y+U,this._focalOffsetEnd.z,!0):this.truck(f,U,!0)},this._rotateInternal=(o,d)=>{const T=K*this.azimuthRotateSpeed*o/this._elementRect.height,f=K*this.polarRotateSpeed*d/this._elementRect.height;this.rotate(T,f,!0)},this._dollyInternal=(o,d,T)=>{const f=Math.pow(.95,-o*this.dollySpeed),U=this._sphericalEnd.radius,O=this._sphericalEnd.radius*f,F=B(O,this.minDistance,this.maxDistance),H=F-O;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(O,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(H,!0),this._dollyToNoClamp(F,!0)):this._dollyToNoClamp(F,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?O:F)-U,this._dollyControlCoord.set(d,T)),this._lastDollyDirection=Math.sign(-o)},this._zoomInternal=(o,d,T)=>{const f=Math.pow(.95,o*this.dollySpeed),U=this._zoom,O=this._zoom*f;this.zoomTo(O,!0),this.dollyToCursor&&(this._changedZoom+=O-U,this._dollyControlCoord.set(d,T))},typeof _>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new _.Quaternion().setFromUnitVectors(this._camera.up,at),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=i.NONE,this._target=new _.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new _.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new _.Spherical().setFromVector3(y.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new _.Vector3,new _.Vector3,new _.Vector3,new _.Vector3],this._updateNearPlaneCorners(),this._boundary=new _.Box3(new _.Vector3(-1/0,-1/0,-1/0),new _.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new _.Vector2,this.mouseButtons={left:i.ROTATE,middle:i.DOLLY,right:i.TRUCK,wheel:N(this._camera)?i.DOLLY:Z(this._camera)?i.ZOOM:i.NONE},this.touches={one:i.TOUCH_ROTATE,two:N(this._camera)?i.TOUCH_DOLLY_TRUCK:Z(this._camera)?i.TOUCH_ZOOM_TRUCK:i.NONE,three:i.TOUCH_TRUCK};const s=new _.Vector2,r=new _.Vector2,n=new _.Vector2,a=o=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const f=this._domElement.getBoundingClientRect(),U=o.clientX/f.width,O=o.clientY/f.height;if(U<this._interactiveArea.left||U>this._interactiveArea.right||O<this._interactiveArea.top||O>this._interactiveArea.bottom)return}const d=o.pointerType!=="mouse"?null:(o.buttons&m.LEFT)===m.LEFT?m.LEFT:(o.buttons&m.MIDDLE)===m.MIDDLE?m.MIDDLE:(o.buttons&m.RIGHT)===m.RIGHT?m.RIGHT:null;if(d!==null){const f=this._findPointerByMouseButton(d);f&&this._disposePointer(f)}if((o.buttons&m.LEFT)===m.LEFT&&this._lockedPointer)return;const T={pointerId:o.pointerId,clientX:o.clientX,clientY:o.clientY,deltaX:0,deltaY:0,mouseButton:d};this._activePointers.push(T),this._domElement.ownerDocument.removeEventListener("pointermove",p,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",C),this._domElement.ownerDocument.addEventListener("pointermove",p,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",C),this._isDragging=!0,v(o)},c=o=>{if(!this._enabled||!this._domElement||this._lockedPointer)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const f=this._domElement.getBoundingClientRect(),U=o.clientX/f.width,O=o.clientY/f.height;if(U<this._interactiveArea.left||U>this._interactiveArea.right||O<this._interactiveArea.top||O>this._interactiveArea.bottom)return}const d=(o.buttons&m.LEFT)===m.LEFT?m.LEFT:(o.buttons&m.MIDDLE)===m.MIDDLE?m.MIDDLE:(o.buttons&m.RIGHT)===m.RIGHT?m.RIGHT:null;if(d!==null){const f=this._findPointerByMouseButton(d);f&&this._disposePointer(f)}const T={pointerId:1,clientX:o.clientX,clientY:o.clientY,deltaX:0,deltaY:0,mouseButton:(o.buttons&m.LEFT)===m.LEFT?m.LEFT:(o.buttons&m.MIDDLE)===m.LEFT?m.MIDDLE:(o.buttons&m.RIGHT)===m.LEFT?m.RIGHT:null};this._activePointers.push(T),this._domElement.ownerDocument.removeEventListener("mousemove",u),this._domElement.ownerDocument.removeEventListener("mouseup",g),this._domElement.ownerDocument.addEventListener("mousemove",u),this._domElement.ownerDocument.addEventListener("mouseup",g),this._isDragging=!0,v(o)},p=o=>{o.cancelable&&o.preventDefault();const d=o.pointerId,T=this._lockedPointer||this._findPointerById(d);if(T){if(T.clientX=o.clientX,T.clientY=o.clientY,T.deltaX=o.movementX,T.deltaY=o.movementY,this._state=0,o.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(o.buttons&m.LEFT)===m.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(o.buttons&m.MIDDLE)===m.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(o.buttons&m.RIGHT)===m.RIGHT&&(this._state=this._state|this.mouseButtons.right);S()}},u=o=>{const d=this._lockedPointer||this._findPointerById(1);d&&(d.clientX=o.clientX,d.clientY=o.clientY,d.deltaX=o.movementX,d.deltaY=o.movementY,this._state=0,(this._lockedPointer||(o.buttons&m.LEFT)===m.LEFT)&&(this._state=this._state|this.mouseButtons.left),(o.buttons&m.MIDDLE)===m.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(o.buttons&m.RIGHT)===m.RIGHT&&(this._state=this._state|this.mouseButtons.right),S())},C=o=>{const d=this._findPointerById(o.pointerId);if(!(d&&d===this._lockedPointer)){if(d&&this._disposePointer(d),o.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=i.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=i.NONE;P()}},g=()=>{const o=this._findPointerById(1);o&&o===this._lockedPointer||(o&&this._disposePointer(o),this._state=i.NONE,P())};let D=-1;const E=o=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===i.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const O=this._domElement.getBoundingClientRect(),F=o.clientX/O.width,H=o.clientY/O.height;if(F<this._interactiveArea.left||F>this._interactiveArea.right||H<this._interactiveArea.top||H>this._interactiveArea.bottom)return}if(o.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===i.ROTATE||this.mouseButtons.wheel===i.TRUCK){const O=performance.now();D-O<1e3&&this._getClientRect(this._elementRect),D=O}const d=pe?-1:-3,T=o.deltaMode===1?o.deltaY/d:o.deltaY/(d*10),f=this.dollyToCursor?(o.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,U=this.dollyToCursor?(o.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case i.ROTATE:{this._rotateInternal(o.deltaX,o.deltaY),this._isUserControllingRotate=!0;break}case i.TRUCK:{this._truckInternal(o.deltaX,o.deltaY,!1),this._isUserControllingTruck=!0;break}case i.OFFSET:{this._truckInternal(o.deltaX,o.deltaY,!0),this._isUserControllingOffset=!0;break}case i.DOLLY:{this._dollyInternal(-T,f,U),this._isUserControllingDolly=!0;break}case i.ZOOM:{this._zoomInternal(-T,f,U),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},A=o=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===st.ACTION.NONE){const d=o instanceof PointerEvent?o.pointerId:(o instanceof MouseEvent,0),T=this._findPointerById(d);T&&this._disposePointer(T),this._domElement.ownerDocument.removeEventListener("pointermove",p,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",C),this._domElement.ownerDocument.removeEventListener("mousemove",u),this._domElement.ownerDocument.removeEventListener("mouseup",g);return}o.preventDefault()}},v=o=>{if(!this._enabled)return;if(ut(this._activePointers,I),this._getClientRect(this._elementRect),s.copy(I),r.copy(I),this._activePointers.length>=2){const T=I.x-this._activePointers[1].clientX,f=I.y-this._activePointers[1].clientY,U=Math.sqrt(T*T+f*f);n.set(0,U);const O=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,F=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;r.set(O,F)}if(this._state=0,!o)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in o&&o.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(o.buttons&m.LEFT)===m.LEFT&&(this._state=this._state|this.mouseButtons.left),(o.buttons&m.MIDDLE)===m.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(o.buttons&m.RIGHT)===m.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&i.ROTATE)===i.ROTATE||(this._state&i.TOUCH_ROTATE)===i.TOUCH_ROTATE||(this._state&i.TOUCH_DOLLY_ROTATE)===i.TOUCH_DOLLY_ROTATE||(this._state&i.TOUCH_ZOOM_ROTATE)===i.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&i.TRUCK)===i.TRUCK||(this._state&i.TOUCH_TRUCK)===i.TOUCH_TRUCK||(this._state&i.TOUCH_DOLLY_TRUCK)===i.TOUCH_DOLLY_TRUCK||(this._state&i.TOUCH_ZOOM_TRUCK)===i.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&i.DOLLY)===i.DOLLY||(this._state&i.TOUCH_DOLLY)===i.TOUCH_DOLLY||(this._state&i.TOUCH_DOLLY_TRUCK)===i.TOUCH_DOLLY_TRUCK||(this._state&i.TOUCH_DOLLY_OFFSET)===i.TOUCH_DOLLY_OFFSET||(this._state&i.TOUCH_DOLLY_ROTATE)===i.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&i.ZOOM)===i.ZOOM||(this._state&i.TOUCH_ZOOM)===i.TOUCH_ZOOM||(this._state&i.TOUCH_ZOOM_TRUCK)===i.TOUCH_ZOOM_TRUCK||(this._state&i.TOUCH_ZOOM_OFFSET)===i.TOUCH_ZOOM_OFFSET||(this._state&i.TOUCH_ZOOM_ROTATE)===i.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&i.OFFSET)===i.OFFSET||(this._state&i.TOUCH_OFFSET)===i.TOUCH_OFFSET||(this._state&i.TOUCH_DOLLY_OFFSET)===i.TOUCH_DOLLY_OFFSET||(this._state&i.TOUCH_ZOOM_OFFSET)===i.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},S=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,ut(this._activePointers,I);const d=this._domElement&&document.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,T=d?-d.deltaX:r.x-I.x,f=d?-d.deltaY:r.y-I.y;if(r.copy(I),((this._state&i.ROTATE)===i.ROTATE||(this._state&i.TOUCH_ROTATE)===i.TOUCH_ROTATE||(this._state&i.TOUCH_DOLLY_ROTATE)===i.TOUCH_DOLLY_ROTATE||(this._state&i.TOUCH_ZOOM_ROTATE)===i.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(T,f),this._isUserControllingRotate=!0),(this._state&i.DOLLY)===i.DOLLY||(this._state&i.ZOOM)===i.ZOOM){const U=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,O=this.dollyToCursor?(s.y-this._elementRect.y)/this._elementRect.height*-2+1:0,F=this.dollyDragInverted?-1:1;(this._state&i.DOLLY)===i.DOLLY?(this._dollyInternal(F*f*nt,U,O),this._isUserControllingDolly=!0):(this._zoomInternal(F*f*nt,U,O),this._isUserControllingZoom=!0)}if((this._state&i.TOUCH_DOLLY)===i.TOUCH_DOLLY||(this._state&i.TOUCH_ZOOM)===i.TOUCH_ZOOM||(this._state&i.TOUCH_DOLLY_TRUCK)===i.TOUCH_DOLLY_TRUCK||(this._state&i.TOUCH_ZOOM_TRUCK)===i.TOUCH_ZOOM_TRUCK||(this._state&i.TOUCH_DOLLY_OFFSET)===i.TOUCH_DOLLY_OFFSET||(this._state&i.TOUCH_ZOOM_OFFSET)===i.TOUCH_ZOOM_OFFSET||(this._state&i.TOUCH_DOLLY_ROTATE)===i.TOUCH_DOLLY_ROTATE||(this._state&i.TOUCH_ZOOM_ROTATE)===i.TOUCH_ZOOM_ROTATE){const U=I.x-this._activePointers[1].clientX,O=I.y-this._activePointers[1].clientY,F=Math.sqrt(U*U+O*O),H=n.y-F;n.set(0,F);const it=this.dollyToCursor?(r.x-this._elementRect.x)/this._elementRect.width*2-1:0,ot=this.dollyToCursor?(r.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&i.TOUCH_DOLLY)===i.TOUCH_DOLLY||(this._state&i.TOUCH_DOLLY_ROTATE)===i.TOUCH_DOLLY_ROTATE||(this._state&i.TOUCH_DOLLY_TRUCK)===i.TOUCH_DOLLY_TRUCK||(this._state&i.TOUCH_DOLLY_OFFSET)===i.TOUCH_DOLLY_OFFSET?(this._dollyInternal(H*nt,it,ot),this._isUserControllingDolly=!0):(this._zoomInternal(H*nt,it,ot),this._isUserControllingZoom=!0)}((this._state&i.TRUCK)===i.TRUCK||(this._state&i.TOUCH_TRUCK)===i.TOUCH_TRUCK||(this._state&i.TOUCH_DOLLY_TRUCK)===i.TOUCH_DOLLY_TRUCK||(this._state&i.TOUCH_ZOOM_TRUCK)===i.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(T,f,!1),this._isUserControllingTruck=!0),((this._state&i.OFFSET)===i.OFFSET||(this._state&i.TOUCH_OFFSET)===i.TOUCH_OFFSET||(this._state&i.TOUCH_DOLLY_OFFSET)===i.TOUCH_DOLLY_OFFSET||(this._state&i.TOUCH_ZOOM_OFFSET)===i.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(T,f,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},P=()=>{ut(this._activePointers,I),r.copy(I),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",p,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",u),this._domElement.ownerDocument.removeEventListener("pointerup",C),this._domElement.ownerDocument.removeEventListener("mouseup",g),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",p,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",C),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",b),this._domElement.ownerDocument.addEventListener("pointerlockerror",M),this._domElement.ownerDocument.addEventListener("pointermove",p,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",C),v())},this.unlockPointer=()=>{this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),document.exitPointerLock(),this.cancel(),this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointerlockchange",b),this._domElement.ownerDocument.removeEventListener("pointerlockerror",M))};const b=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},M=()=>{this.unlockPointer()};this._addAllEventListeners=o=>{this._domElement=o,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",a),ue&&this._domElement.addEventListener("mousedown",c),this._domElement.addEventListener("pointercancel",C),this._domElement.addEventListener("wheel",E,{passive:!1}),this._domElement.addEventListener("contextmenu",A)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",a),this._domElement.removeEventListener("mousedown",c),this._domElement.removeEventListener("pointercancel",C),this._domElement.removeEventListener("wheel",E,{passive:!1}),this._domElement.removeEventListener("contextmenu",A),this._domElement.ownerDocument.removeEventListener("pointermove",p,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",u),this._domElement.ownerDocument.removeEventListener("pointerup",C),this._domElement.ownerDocument.removeEventListener("mouseup",g),this._domElement.ownerDocument.removeEventListener("pointerlockchange",b),this._domElement.ownerDocument.removeEventListener("pointerlockerror",M))},this.cancel=()=>{this._state!==i.NONE&&(this._state=i.NONE,this._activePointers.length=0,P())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=B(e.width,0,1),this._interactiveArea.height=B(e.height,0,1),this._interactiveArea.x=B(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=B(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,s=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,s)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,s=!1){this._isUserControllingRotate=!1;const r=B(e,this.minAzimuthAngle,this.maxAzimuthAngle),n=B(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=r,this._sphericalEnd.phi=n,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,s||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const a=!s||x(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&x(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(a)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=X.NONE,this._changedDolly=0,this._dollyToNoClamp(B(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const s=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const a=this._collisionTest(),c=x(a,this._spherical.radius);if(!(s>e)&&c)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,a)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const n=!t||x(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(n)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(J).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const s=!t||x(this._target.x,this._targetEnd.x,this.restThreshold)&&x(this._target.y,this._targetEnd.y,this.restThreshold)&&x(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=B(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const s=!t||x(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(s)}pan(e,t,s=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,s)}truck(e,t,s=!1){this._camera.updateMatrix(),Y.setFromMatrixColumn(this._camera.matrix,0),V.setFromMatrixColumn(this._camera.matrix,1),Y.multiplyScalar(e),V.multiplyScalar(-t);const r=y.copy(Y).add(V),n=w.copy(this._targetEnd).add(r);return this.moveTo(n.x,n.y,n.z,s)}forward(e,t=!1){y.setFromMatrixColumn(this._camera.matrix,0),y.crossVectors(this._camera.up,y),y.multiplyScalar(e);const s=w.copy(this._targetEnd).add(y);return this.moveTo(s.x,s.y,s.z,t)}elevate(e,t=!1){return y.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+y.x,this._targetEnd.y+y.y,this._targetEnd.z+y.z,t)}moveTo(e,t,s,r=!1){this._isUserControllingTruck=!1;const n=y.set(e,t,s).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,n,this.boundaryFriction),this._needsUpdate=!0,r||this._target.copy(this._targetEnd);const a=!r||x(this._target.x,this._targetEnd.x,this.restThreshold)&&x(this._target.y,this._targetEnd.y,this.restThreshold)&&x(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(a)}lookInDirectionOf(e,t,s,r=!1){const c=y.set(e,t,s).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius);return this.setPosition(c.x,c.y,c.z,r)}fitToBox(e,t,{cover:s=!1,paddingLeft:r=0,paddingRight:n=0,paddingBottom:a=0,paddingTop:c=0}={}){const p=[],u=e.isBox3?Q.copy(e):Q.setFromObject(e);u.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const C=At(this._sphericalEnd.theta,Lt),g=At(this._sphericalEnd.phi,Lt);p.push(this.rotateTo(C,g,t));const D=y.setFromSpherical(this._sphericalEnd).normalize(),E=Ft.setFromUnitVectors(D,gt),A=x(Math.abs(D.y),1);A&&E.multiply(yt.setFromAxisAngle(at,C)),E.multiply(this._yAxisUpSpaceInverse);const v=zt.makeEmpty();w.copy(u.min).applyQuaternion(E),v.expandByPoint(w),w.copy(u.min).setX(u.max.x).applyQuaternion(E),v.expandByPoint(w),w.copy(u.min).setY(u.max.y).applyQuaternion(E),v.expandByPoint(w),w.copy(u.max).setZ(u.min.z).applyQuaternion(E),v.expandByPoint(w),w.copy(u.min).setZ(u.max.z).applyQuaternion(E),v.expandByPoint(w),w.copy(u.max).setY(u.min.y).applyQuaternion(E),v.expandByPoint(w),w.copy(u.max).setX(u.min.x).applyQuaternion(E),v.expandByPoint(w),w.copy(u.max).applyQuaternion(E),v.expandByPoint(w),v.min.x-=r,v.min.y-=a,v.max.x+=n,v.max.y+=c,E.setFromUnitVectors(gt,D),A&&E.premultiply(yt.invert()),E.premultiply(this._yAxisUpSpace);const S=v.getSize(y),P=v.getCenter(w).applyQuaternion(E);if(N(this._camera)){const b=this.getDistanceToFitBox(S.x,S.y,S.z,s);p.push(this.moveTo(P.x,P.y,P.z,t)),p.push(this.dollyTo(b,t)),p.push(this.setFocalOffset(0,0,0,t))}else if(Z(this._camera)){const b=this._camera,M=b.right-b.left,o=b.top-b.bottom,d=s?Math.max(M/S.x,o/S.y):Math.min(M/S.x,o/S.y);p.push(this.moveTo(P.x,P.y,P.z,t)),p.push(this.zoomTo(d,t)),p.push(this.setFocalOffset(0,0,0,t))}return Promise.all(p)}fitToSphere(e,t){const s=[],n=e instanceof _.Sphere?Et.copy(e):st.createBoundingSphere(e,Et);if(s.push(this.moveTo(n.center.x,n.center.y,n.center.z,t)),N(this._camera)){const a=this.getDistanceToFitSphere(n.radius);s.push(this.dollyTo(a,t))}else if(Z(this._camera)){const a=this._camera.right-this._camera.left,c=this._camera.top-this._camera.bottom,p=2*n.radius,u=Math.min(a/p,c/p);s.push(this.zoomTo(u,t))}return s.push(this.setFocalOffset(0,0,0,t)),Promise.all(s)}setLookAt(e,t,s,r,n,a,c=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=X.NONE,this._changedDolly=0;const p=w.set(r,n,a),u=y.set(e,t,s);this._targetEnd.copy(p),this._sphericalEnd.setFromVector3(u.sub(p).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,c||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const C=!c||x(this._target.x,this._targetEnd.x,this.restThreshold)&&x(this._target.y,this._targetEnd.y,this.restThreshold)&&x(this._target.z,this._targetEnd.z,this.restThreshold)&&x(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&x(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&x(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(C)}lerpLookAt(e,t,s,r,n,a,c,p,u,C,g,D,E,A=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=X.NONE,this._changedDolly=0;const v=y.set(r,n,a),S=w.set(e,t,s);k.setFromVector3(S.sub(v).applyQuaternion(this._yAxisUpSpace));const P=G.set(C,g,D),b=w.set(c,p,u);tt.setFromVector3(b.sub(P).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(v.lerp(P,E));const M=tt.theta-k.theta,o=tt.phi-k.phi,d=tt.radius-k.radius;this._sphericalEnd.set(k.radius+d*E,k.phi+o*E,k.theta+M*E),this.normalizeRotations(),this._needsUpdate=!0,A||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const T=!A||x(this._target.x,this._targetEnd.x,this.restThreshold)&&x(this._target.y,this._targetEnd.y,this.restThreshold)&&x(this._target.z,this._targetEnd.z,this.restThreshold)&&x(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&x(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&x(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(T)}setPosition(e,t,s,r=!1){return this.setLookAt(e,t,s,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,r)}setTarget(e,t,s,r=!1){const n=this.getPosition(y),a=this.setLookAt(n.x,n.y,n.z,e,t,s,r);return this._sphericalEnd.phi=B(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),a}setFocalOffset(e,t,s,r=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,s),this._needsUpdate=!0,r||this._focalOffset.copy(this._focalOffsetEnd);const n=!r||x(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&x(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&x(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}setOrbitPoint(e,t,s){this._camera.updateMatrixWorld(),Y.setFromMatrixColumn(this._camera.matrixWorldInverse,0),V.setFromMatrixColumn(this._camera.matrixWorldInverse,1),W.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const r=y.set(e,t,s),n=r.distanceTo(this._camera.position),a=r.sub(this._camera.position);Y.multiplyScalar(a.x),V.multiplyScalar(a.y),W.multiplyScalar(a.z),y.copy(Y).add(V).add(W),y.z=y.z+n,this.dollyTo(n,!1),this.setFocalOffset(-y.x,y.y,-y.z,!1),this.moveTo(e,t,s,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,s,r){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new _.Vector4,typeof e=="number"?this._viewport.set(e,t,s,r):this._viewport.copy(e)}getDistanceToFitBox(e,t,s,r=!1){if(ft(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const n=e/t,a=this._camera.getEffectiveFOV()*q,c=this._camera.aspect;return((r?n>c:n<c)?t:e/c)*.5/Math.tan(a*.5)+s*.5}getDistanceToFitSphere(e){if(ft(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*q,s=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,r=1<this._camera.aspect?t:s;return e/Math.sin(r*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new _.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new _.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e&&e instanceof _.Spherical?e:new _.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new _.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%K,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=K),this._spherical.theta+=K*Math.round((this._sphericalEnd.theta-this._spherical.theta)/K)}reset(e=!1){if(!x(this._camera.up.x,this._cameraUp0.x)||!x(this._camera.up.y,this._cameraUp0.y)||!x(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const s=this.getPosition(y);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,at),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=y.subVectors(this._target,this._camera.position).normalize(),t=w.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const s=this.getPosition(y);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,s=this._sphericalEnd.phi-this._spherical.phi,r=this._sphericalEnd.radius-this._spherical.radius,n=Pt.subVectors(this._targetEnd,this._target),a=Rt.subVectors(this._focalOffsetEnd,this._focalOffset),c=this._zoomEnd-this._zoom;if(L(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const g=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=rt(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,g,1/0,e),this._needsUpdate=!0}if(L(s))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const g=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=rt(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,g,1/0,e),this._needsUpdate=!0}if(L(r))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const g=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=rt(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,g,this.maxSpeed,e),this._needsUpdate=!0}if(L(n.x)&&L(n.y)&&L(n.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const g=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;bt(this._target,this._targetEnd,this._targetVelocity,g,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(L(a.x)&&L(a.y)&&L(a.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const g=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;bt(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,g,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(L(c))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const g=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=rt(this._zoom,this._zoomEnd,this._zoomVelocity,g,1/0,e)}if(this.dollyToCursor){if(N(this._camera)&&this._changedDolly!==0){const g=this._spherical.radius-this._lastDistance,D=this._camera,E=this._getCameraDirection(J),A=y.copy(E).cross(D.up).normalize();A.lengthSq()===0&&(A.x=1);const v=w.crossVectors(A,E),S=this._sphericalEnd.radius*Math.tan(D.getEffectiveFOV()*q*.5),b=(this._sphericalEnd.radius-g-this._sphericalEnd.radius)/this._sphericalEnd.radius,M=G.copy(this._targetEnd).add(A.multiplyScalar(this._dollyControlCoord.x*S*D.aspect)).add(v.multiplyScalar(this._dollyControlCoord.y*S)),o=y.copy(this._targetEnd).lerp(M,b),d=this._lastDollyDirection===X.IN&&this._spherical.radius<=this.minDistance,T=this._lastDollyDirection===X.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(d||T)){this._sphericalEnd.radius-=g,this._spherical.radius-=g;const U=w.copy(E).multiplyScalar(-g);o.add(U)}this._boundary.clampPoint(o,o);const f=w.subVectors(o,this._targetEnd);this._targetEnd.copy(o),this._target.add(f),this._changedDolly-=g,L(this._changedDolly)&&(this._changedDolly=0)}else if(Z(this._camera)&&this._changedZoom!==0){const g=this._zoom-this._lastZoom,D=this._camera,E=y.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(D.near+D.far)/(D.near-D.far)).unproject(D),A=w.set(0,0,-1).applyQuaternion(D.quaternion),v=G.copy(E).add(A.multiplyScalar(-E.dot(D.up))),P=-(this._zoom-g-this._zoom)/this._zoom,b=this._getCameraDirection(J),M=this._targetEnd.dot(b),o=y.copy(this._targetEnd).lerp(v,P),d=o.dot(b),T=b.multiplyScalar(d-M);o.sub(T),this._boundary.clampPoint(o,o);const f=w.subVectors(o,this._targetEnd);this._targetEnd.copy(o),this._target.add(f),this._changedZoom-=g,L(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const p=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,p),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!L(this._focalOffset.x)||!L(this._focalOffset.y)||!L(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),Y.setFromMatrixColumn(this._camera.matrix,0),V.setFromMatrixColumn(this._camera.matrix,1),W.setFromMatrixColumn(this._camera.matrix,2),Y.multiplyScalar(this._focalOffset.x),V.multiplyScalar(-this._focalOffset.y),W.multiplyScalar(this._focalOffset.z),y.copy(Y).add(V).add(W),this._camera.position.add(y)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),y.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const C=this._needsUpdate;return C&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):C?(this.dispatchEvent({type:"update"}),L(t,this.restThreshold)&&L(s,this.restThreshold)&&L(r,this.restThreshold)&&L(n.x,this.restThreshold)&&L(n.y,this.restThreshold)&&L(n.z,this.restThreshold)&&L(a.x,this.restThreshold)&&L(a.y,this.restThreshold)&&L(a.z,this.restThreshold)&&L(c,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!C&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=C,this._needsUpdate=!1,C}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:$(this.maxDistance),minZoom:this.minZoom,maxZoom:$(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:$(this.maxPolarAngle),minAzimuthAngle:$(this.minAzimuthAngle),maxAzimuthAngle:$(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:y.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const s=JSON.parse(e);this.enabled=s.enabled,this.minDistance=s.minDistance,this.maxDistance=j(s.maxDistance),this.minZoom=s.minZoom,this.maxZoom=j(s.maxZoom),this.minPolarAngle=s.minPolarAngle,this.maxPolarAngle=j(s.maxPolarAngle),this.minAzimuthAngle=j(s.minAzimuthAngle),this.maxAzimuthAngle=j(s.maxAzimuthAngle),this.smoothTime=s.smoothTime,this.draggingSmoothTime=s.draggingSmoothTime,this.dollySpeed=s.dollySpeed,this.truckSpeed=s.truckSpeed,this.dollyToCursor=s.dollyToCursor,this.verticalDragToForward=s.verticalDragToForward,this._target0.fromArray(s.target0),this._position0.fromArray(s.position0),this._zoom0=s.zoom0,this._focalOffset0.fromArray(s.focalOffset0),this.moveTo(s.target[0],s.target[1],s.target[2],t),k.setFromVector3(y.fromArray(s.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(k.theta,k.phi,t),this.dollyTo(k.radius,t),this.zoomTo(s.zoom,t),this.setFocalOffset(s.focalOffset[0],s.focalOffset[1],s.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",me),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,s){const r=t.lengthSq();if(r===0)return e;const n=w.copy(t).add(e),c=this._boundary.clampPoint(n,G).sub(n),p=c.lengthSq();if(p===0)return e.add(t);if(p===r)return e;if(s===0)return e.add(t).add(c);{const u=1+s*p/t.dot(c);return e.add(w.copy(t).multiplyScalar(u)).add(c.multiplyScalar(1-s))}}_updateNearPlaneCorners(){if(N(this._camera)){const e=this._camera,t=e.near,s=e.getEffectiveFOV()*q,r=Math.tan(s*.5)*t,n=r*e.aspect;this._nearPlaneCorners[0].set(-n,-r,0),this._nearPlaneCorners[1].set(n,-r,0),this._nearPlaneCorners[2].set(n,r,0),this._nearPlaneCorners[3].set(-n,r,0)}else if(Z(this._camera)){const e=this._camera,t=1/e.zoom,s=e.left*t,r=e.right*t,n=e.top*t,a=e.bottom*t;this._nearPlaneCorners[0].set(s,n,0),this._nearPlaneCorners[1].set(r,n,0),this._nearPlaneCorners[2].set(r,a,0),this._nearPlaneCorners[3].set(s,a,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||ft(this._camera,"_collisionTest"))return e;const s=this._getTargetDirection(J);Tt.lookAt(St,s,this._camera.up);for(let r=0;r<4;r++){const n=w.copy(this._nearPlaneCorners[r]);n.applyMatrix4(Tt);const a=G.addVectors(this._target,n);ht.set(a,s),ht.far=this._spherical.radius+1;const c=ht.intersectObjects(this.colliderMeshes);c.length!==0&&c[0].distance<e&&(e=c[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{const s=()=>{this.removeEventListener("rest",s),t()};this.addEventListener("rest",s)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new _.Sphere){const s=t,r=s.center;Q.makeEmpty(),e.traverseVisible(a=>{a.isMesh&&Q.expandByObject(a)}),Q.getCenter(r);let n=0;return e.traverseVisible(a=>{if(!a.isMesh)return;const c=a,p=c.geometry.clone();p.applyMatrix4(c.matrixWorld);const C=p.attributes.position;for(let g=0,D=C.count;g<D;g++)y.fromBufferAttribute(C,g),n=Math.max(n,r.distanceToSquared(y))}),s.radius=Math.sqrt(n),s}}class Bt extends he{constructor(t){super(t);h(this,"onBeforeUpdate",new z);h(this,"onAfterUpdate",new z);h(this,"onAspectUpdated",new z);h(this,"onDisposed",new z);h(this,"three");h(this,"_allControls",new Map);h(this,"updateAspect",()=>{var t;if(!(!this.currentWorld||!this.currentWorld.renderer)&&(t=this.currentWorld.renderer)!=null&&t.isResizeable()){const s=this.currentWorld.renderer.getSize();this.three.aspect=s.width/s.height,this.three.updateProjectionMatrix(),this.onAspectUpdated.trigger()}});this.three=this.setupCamera(),this.setupEvents(!0),this.onWorldChanged.add(({action:s,world:r})=>{if(s==="added"){const n=this.newCameraControls();this._allControls.set(r.uuid,n)}if(s==="removed"){const n=this._allControls.get(r.uuid);n&&(n.dispose(),this._allControls.delete(r.uuid))}})}get controls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");const t=this._allControls.get(this.currentWorld.uuid);if(!t)throw new Error("Controls not found!");return t}get enabled(){return this.currentWorld===null?!1:this.controls.enabled}set enabled(t){this.controls.enabled=t}dispose(){this.setupEvents(!1),this.enabled=!1,this.onAspectUpdated.reset(),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.three.removeFromParent(),this.onDisposed.trigger(),this.onDisposed.reset();for(const[t,s]of this._allControls)s.dispose()}update(t){this.enabled&&(this.onBeforeUpdate.trigger(this),this.controls.update(t),this.onAfterUpdate.trigger(this))}setupCamera(){const t=window.innerWidth/window.innerHeight,s=new jt(60,t,1,1e3);return s.position.set(50,50,50),s.lookAt(new Ot(0,0,0)),s}newCameraControls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");if(!this.currentWorld.renderer)throw new Error("This camera needs a renderer to work!");st.install({THREE:Bt.getSubsetOfThree()});const{domElement:t}=this.currentWorld.renderer.three,s=new st(this.three,t);return s.smoothTime=.2,s.dollyToCursor=!0,s.infinityDolly=!0,s}setupEvents(t){t?window.addEventListener("resize",this.updateAspect):window.removeEventListener("resize",this.updateAspect)}static getSubsetOfThree(){return{MOUSE:Jt,Vector2:Ct,Vector3:Ot,Vector4:te,Quaternion:ee,Matrix4:se,Spherical:ie,Box3:oe,Sphere:re,Raycaster:ne,MathUtils:ae}}}const _t=class _t extends It{constructor(t){super(t);h(this,"onAfterUpdate",new z);h(this,"onBeforeUpdate",new z);h(this,"onDisposed",new z);h(this,"list",new Map);h(this,"enabled",!0);t.add(_t.uuid,this)}create(){const t=new de(this.components),s=t.uuid;if(this.list.has(s))throw new Error("There is already a world with this name!");return this.list.set(s,t),t}delete(t){this.list.delete(t.uuid),t.dispose()}dispose(){this.enabled=!1;for(const[t,s]of this.list)s.dispose();this.list.clear(),this.onDisposed.trigger()}update(t){if(this.enabled)for(const[s,r]of this.list)r.update(t)}};h(_t,"uuid","fdb61dc4-2ec1-4966-b83d-54ea795fad4a");let Mt=_t;export{xt as C,lt as D,z as E,Ee as S,Mt as W,ye as a,Bt as b,It as c};
