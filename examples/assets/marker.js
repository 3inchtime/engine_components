var Tc=Object.defineProperty;var gc=(u,t,e)=>t in u?Tc(u,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[t]=e;var Wt=(u,t,e)=>(gc(u,typeof t!="symbol"?t+"":t,e),e);import{L as Me,B as $t,T as zn,R as go,E as yc,a as Mt,V as q,p as Fe,P as zi,S as yo,q as lt,C as Kn,r as Mr,D as Rc,A as Ac,s as Fc,t as _c,u as Oc,Q as Ae,v as wc,n as ol,w as vc,x as Wn,W as Js,y as Ro,z as Sc,F as Yr,G as Xn,H as jn,M as mn,J as Zt,I as qn,K as ua,m as al,l as $n,N as Zn,b as Ao,c as ll,d as cl,e as Fo,f as hl,g as ul,o as Re,O as Pc,U as di,X as ki,Y as ee,Z as xr,_ as bs,$ as bc,a0 as Nc,a1 as dl,a2 as Lc,h as pl,i as El,j as fl,k as Il,a3 as ml,a4 as da,a5 as Mc,a6 as pa,a7 as pi,a8 as Ze,a9 as xc,aa as mr,ab as Dc,ac as Uc,ad as Bc}from"./web-ifc-api-B6u741mi.js";import{S as Cl,F as Tl,a as Yc,C as kc,A as Gc}from"./serializer-CA2LRkbC.js";import{S as Vc}from"./stream-serializer-Xso4bzYw.js";import{c as Ea,g as zc}from"./_commonjsHelpers-Cpj98o6Y.js";var Hc=Object.defineProperty,Kc=(u,t,e)=>t in u?Hc(u,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[t]=e,R=(u,t,e)=>(Kc(u,typeof t!="symbol"?t+"":t,e),e);const gl=0,Wc=1,Xc=2,fa=2,Ns=1.25,Ia=1,Ui=6*4+4+4,Hi=65535,jc=Math.pow(2,-24),Ls=Symbol("SKIP_GENERATION");function qc(u){return u.index?u.index.count:u.attributes.position.count}function Jn(u){return qc(u)/3}function Zc(u,t=ArrayBuffer){return u>65535?new Uint32Array(new t(4*u)):new Uint16Array(new t(2*u))}function Qc(u,t){if(!u.index){const e=u.attributes.position.count,n=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,s=Zc(e,n);u.setIndex(new Zn(s,1));for(let o=0;o<e;o++)s[o]=o}}function yl(u){const t=Jn(u),e=u.drawRange,n=e.start/3,s=(e.start+e.count)/3,o=Math.max(0,n),a=Math.min(t,s)-o;return[{offset:Math.floor(o),count:Math.floor(a)}]}function Rl(u){if(!u.groups||!u.groups.length)return yl(u);const t=[],e=new Set,n=u.drawRange,s=n.start/3,o=(n.start+n.count)/3;for(const c of u.groups){const h=c.start/3,p=(c.start+c.count)/3;e.add(Math.max(s,h)),e.add(Math.min(o,p))}const a=Array.from(e.values()).sort((c,h)=>c-h);for(let c=0;c<a.length-1;c++){const h=a[c],p=a[c+1];t.push({offset:Math.floor(h),count:Math.floor(p-h)})}return t}function $c(u){if(u.groups.length===0)return!1;const t=Jn(u),e=Rl(u).sort((o,a)=>o.offset-a.offset),n=e[e.length-1];n.count=Math.min(t-n.offset,n.count);let s=0;return e.forEach(({count:o})=>s+=o),t!==s}function Dt(u,t,e){return e.min.x=t[u],e.min.y=t[u+1],e.min.z=t[u+2],e.max.x=t[u+3],e.max.y=t[u+4],e.max.z=t[u+5],e}function Jc(u){u[0]=u[1]=u[2]=1/0,u[3]=u[4]=u[5]=-1/0}function ma(u){let t=-1,e=-1/0;for(let n=0;n<3;n++){const s=u[n+3]-u[n];s>e&&(e=s,t=n)}return t}function Ca(u,t){t.set(u)}function Ta(u,t,e){let n,s;for(let o=0;o<3;o++){const a=o+3;n=u[o],s=t[o],e[o]=n<s?n:s,n=u[a],s=t[a],e[a]=n>s?n:s}}function Ei(u,t,e){for(let n=0;n<3;n++){const s=t[u+2*n],o=t[u+2*n+1],a=s-o,c=s+o;a<e[n]&&(e[n]=a),c>e[n+3]&&(e[n+3]=c)}}function Cr(u){const t=u[3]-u[0],e=u[4]-u[1],n=u[5]-u[2];return 2*(t*e+e*n+n*t)}function Ms(u,t,e,n,s=null){let o=1/0,a=1/0,c=1/0,h=-1/0,p=-1/0,C=-1/0,I=1/0,f=1/0,T=1/0,A=-1/0,F=-1/0,_=-1/0;const w=s!==null;for(let v=t*6,Y=(t+e)*6;v<Y;v+=6){const y=u[v+0],L=u[v+1],k=y-L,V=y+L;k<o&&(o=k),V>h&&(h=V),w&&y<I&&(I=y),w&&y>A&&(A=y);const H=u[v+2],j=u[v+3],Q=H-j,J=H+j;Q<a&&(a=Q),J>p&&(p=J),w&&H<f&&(f=H),w&&H>F&&(F=H);const $=u[v+4],nt=u[v+5],ut=$-nt,It=$+nt;ut<c&&(c=ut),It>C&&(C=It),w&&$<T&&(T=$),w&&$>_&&(_=$)}n[0]=o,n[1]=a,n[2]=c,n[3]=h,n[4]=p,n[5]=C,w&&(s[0]=I,s[1]=f,s[2]=T,s[3]=A,s[4]=F,s[5]=_)}function th(u,t,e,n){let s=1/0,o=1/0,a=1/0,c=-1/0,h=-1/0,p=-1/0;for(let C=t*6,I=(t+e)*6;C<I;C+=6){const f=u[C+0];f<s&&(s=f),f>c&&(c=f);const T=u[C+2];T<o&&(o=T),T>h&&(h=T);const A=u[C+4];A<a&&(a=A),A>p&&(p=A)}n[0]=s,n[1]=o,n[2]=a,n[3]=c,n[4]=h,n[5]=p}function eh(u,t){Jc(t);const e=u.attributes.position,n=u.index?u.index.array:null,s=Jn(u),o=new Float32Array(s*6),a=e.normalized,c=e.array,h=e.offset||0;let p=3;e.isInterleavedBufferAttribute&&(p=e.data.stride);const C=["getX","getY","getZ"];for(let I=0;I<s;I++){const f=I*3,T=I*6;let A=f+0,F=f+1,_=f+2;n&&(A=n[A],F=n[F],_=n[_]),a||(A=A*p+h,F=F*p+h,_=_*p+h);for(let w=0;w<3;w++){let v,Y,y;a?(v=e[C[w]](A),Y=e[C[w]](F),y=e[C[w]](_)):(v=c[A+w],Y=c[F+w],y=c[_+w]);let L=v;Y<L&&(L=Y),y<L&&(L=y);let k=v;Y>k&&(k=Y),y>k&&(k=y);const V=(k-L)/2,H=w*2;o[T+H+0]=L+V,o[T+H+1]=V+(Math.abs(L)+V)*jc,L<t[w]&&(t[w]=L),k>t[w+3]&&(t[w+3]=k)}}return o}const ke=32,nh=(u,t)=>u.candidate-t.candidate,Qe=new Array(ke).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),fi=new Float32Array(6);function rh(u,t,e,n,s,o){let a=-1,c=0;if(o===gl)a=ma(t),a!==-1&&(c=(t[a]+t[a+3])/2);else if(o===Wc)a=ma(u),a!==-1&&(c=ih(e,n,s,a));else if(o===Xc){const h=Cr(u);let p=Ns*s;const C=n*6,I=(n+s)*6;for(let f=0;f<3;f++){const T=t[f],A=(t[f+3]-T)/ke;if(s<ke/4){const F=[...Qe];F.length=s;let _=0;for(let v=C;v<I;v+=6,_++){const Y=F[_];Y.candidate=e[v+2*f],Y.count=0;const{bounds:y,leftCacheBounds:L,rightCacheBounds:k}=Y;for(let V=0;V<3;V++)k[V]=1/0,k[V+3]=-1/0,L[V]=1/0,L[V+3]=-1/0,y[V]=1/0,y[V+3]=-1/0;Ei(v,e,y)}F.sort(nh);let w=s;for(let v=0;v<w;v++){const Y=F[v];for(;v+1<w&&F[v+1].candidate===Y.candidate;)F.splice(v+1,1),w--}for(let v=C;v<I;v+=6){const Y=e[v+2*f];for(let y=0;y<w;y++){const L=F[y];Y>=L.candidate?Ei(v,e,L.rightCacheBounds):(Ei(v,e,L.leftCacheBounds),L.count++)}}for(let v=0;v<w;v++){const Y=F[v],y=Y.count,L=s-Y.count,k=Y.leftCacheBounds,V=Y.rightCacheBounds;let H=0;y!==0&&(H=Cr(k)/h);let j=0;L!==0&&(j=Cr(V)/h);const Q=Ia+Ns*(H*y+j*L);Q<p&&(a=f,p=Q,c=Y.candidate)}}else{for(let w=0;w<ke;w++){const v=Qe[w];v.count=0,v.candidate=T+A+w*A;const Y=v.bounds;for(let y=0;y<3;y++)Y[y]=1/0,Y[y+3]=-1/0}for(let w=C;w<I;w+=6){let v=~~((e[w+2*f]-T)/A);v>=ke&&(v=ke-1);const Y=Qe[v];Y.count++,Ei(w,e,Y.bounds)}const F=Qe[ke-1];Ca(F.bounds,F.rightCacheBounds);for(let w=ke-2;w>=0;w--){const v=Qe[w],Y=Qe[w+1];Ta(v.bounds,Y.rightCacheBounds,v.rightCacheBounds)}let _=0;for(let w=0;w<ke-1;w++){const v=Qe[w],Y=v.count,y=v.bounds,L=Qe[w+1].rightCacheBounds;Y!==0&&(_===0?Ca(y,fi):Ta(y,fi,fi)),_+=Y;let k=0,V=0;_!==0&&(k=Cr(fi)/h);const H=s-_;H!==0&&(V=Cr(L)/h);const j=Ia+Ns*(k*_+V*H);j<p&&(a=f,p=j,c=v.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${o} used.`);return{axis:a,pos:c}}function ih(u,t,e,n){let s=0;for(let o=t,a=t+e;o<a;o++)s+=u[o*6+n*2];return s/e}class Ii{constructor(){}}function sh(u,t,e,n,s,o){let a=n,c=n+s-1;const h=o.pos,p=o.axis*2;for(;;){for(;a<=c&&e[a*6+p]<h;)a++;for(;a<=c&&e[c*6+p]>=h;)c--;if(a<c){for(let C=0;C<3;C++){let I=t[a*3+C];t[a*3+C]=t[c*3+C],t[c*3+C]=I}for(let C=0;C<6;C++){let I=e[a*6+C];e[a*6+C]=e[c*6+C],e[c*6+C]=I}a++,c--}else return a}}function oh(u,t,e,n,s,o){let a=n,c=n+s-1;const h=o.pos,p=o.axis*2;for(;;){for(;a<=c&&e[a*6+p]<h;)a++;for(;a<=c&&e[c*6+p]>=h;)c--;if(a<c){let C=u[a];u[a]=u[c],u[c]=C;for(let I=0;I<6;I++){let f=e[a*6+I];e[a*6+I]=e[c*6+I],e[c*6+I]=f}a++,c--}else return a}}function ah(u,t){const e=(u.index?u.index.count:u.attributes.position.count)/3,n=e>2**16,s=n?4:2,o=t?new SharedArrayBuffer(e*s):new ArrayBuffer(e*s),a=n?new Uint32Array(o):new Uint16Array(o);for(let c=0,h=a.length;c<h;c++)a[c]=c;return a}function lh(u,t){const e=u.geometry,n=e.index?e.index.array:null,s=t.maxDepth,o=t.verbose,a=t.maxLeafTris,c=t.strategy,h=t.onProgress,p=Jn(e),C=u._indirectBuffer;let I=!1;const f=new Float32Array(6),T=new Float32Array(6),A=eh(e,f),F=t.indirect?oh:sh,_=[],w=t.indirect?yl(e):Rl(e);if(w.length===1){const y=w[0],L=new Ii;L.boundingData=f,th(A,y.offset,y.count,T),Y(L,y.offset,y.count,T),_.push(L)}else for(let y of w){const L=new Ii;L.boundingData=new Float32Array(6),Ms(A,y.offset,y.count,L.boundingData,T),Y(L,y.offset,y.count,T),_.push(L)}return _;function v(y){h&&h(y/p)}function Y(y,L,k,V=null,H=0){if(!I&&H>=s&&(I=!0,o&&(console.warn(`MeshBVH: Max depth of ${s} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),k<=a||H>=s)return v(L+k),y.offset=L,y.count=k,y;const j=rh(y.boundingData,V,A,L,k,c);if(j.axis===-1)return v(L+k),y.offset=L,y.count=k,y;const Q=F(C,n,A,L,k,j);if(Q===L||Q===L+k)v(L+k),y.offset=L,y.count=k;else{y.splitAxis=j.axis;const J=new Ii,$=L,nt=Q-L;y.left=J,J.boundingData=new Float32Array(6),Ms(A,$,nt,J.boundingData,T),Y(J,$,nt,T,H+1);const ut=new Ii,It=Q,yt=k-nt;y.right=ut,ut.boundingData=new Float32Array(6),Ms(A,It,yt,ut.boundingData,T),Y(ut,It,yt,T,H+1)}return y}}function ch(u,t){const e=u.geometry;t.indirect&&(u._indirectBuffer=ah(e,t.useSharedArrayBuffer),$c(e)&&!t.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),u._indirectBuffer||Qc(e,t);const n=lh(u,t);let s,o,a;const c=[],h=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let I=0;I<n.length;I++){const f=n[I];let T=p(f);const A=new h(Ui*T);s=new Float32Array(A),o=new Uint32Array(A),a=new Uint16Array(A),C(0,f),c.push(A)}u._roots=c;return;function p(I){return I.count?1:1+p(I.left)+p(I.right)}function C(I,f){const T=I/4,A=I/2,F=!!f.count,_=f.boundingData;for(let w=0;w<6;w++)s[T+w]=_[w];if(F){const w=f.offset,v=f.count;return o[T+6]=w,a[A+14]=v,a[A+15]=Hi,I+Ui}else{const w=f.left,v=f.right,Y=f.splitAxis;let y;if(y=C(I+Ui,w),y/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return o[T+6]=y/4,y=C(y,v),o[T+7]=Y,y}}}class Ve{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let n=1/0,s=-1/0;for(let o=0,a=t.length;o<a;o++){const c=t[o][e];n=c<n?c:n,s=c>s?c:s}this.min=n,this.max=s}setFromPoints(t,e){let n=1/0,s=-1/0;for(let o=0,a=e.length;o<a;o++){const c=e[o],h=t.dot(c);n=h<n?h:n,s=h>s?h:s}this.min=n,this.max=s}isSeparated(t){return this.min>t.max||t.min>this.max}}Ve.prototype.setFromBox=function(){const u=new q;return function(t,e){const n=e.min,s=e.max;let o=1/0,a=-1/0;for(let c=0;c<=1;c++)for(let h=0;h<=1;h++)for(let p=0;p<=1;p++){u.x=n.x*c+s.x*(1-c),u.y=n.y*h+s.y*(1-h),u.z=n.z*p+s.z*(1-p);const C=t.dot(u);o=Math.min(C,o),a=Math.max(C,a)}this.min=o,this.max=a}}();const hh=function(){const u=new q,t=new q,e=new q;return function(n,s,o){const a=n.start,c=u,h=s.start,p=t;e.subVectors(a,h),u.subVectors(n.end,n.start),t.subVectors(s.end,s.start);const C=e.dot(p),I=p.dot(c),f=p.dot(p),T=e.dot(c),A=c.dot(c)*f-I*I;let F,_;A!==0?F=(C*I-T*f)/A:F=0,_=(C+F*I)/f,o.x=F,o.y=_}}(),_o=function(){const u=new Fe,t=new q,e=new q;return function(n,s,o,a){hh(n,s,u);let c=u.x,h=u.y;if(c>=0&&c<=1&&h>=0&&h<=1){n.at(c,o),s.at(h,a);return}else if(c>=0&&c<=1){h<0?s.at(0,a):s.at(1,a),n.closestPointToPoint(a,!0,o);return}else if(h>=0&&h<=1){c<0?n.at(0,o):n.at(1,o),s.closestPointToPoint(o,!0,a);return}else{let p;c<0?p=n.start:p=n.end;let C;h<0?C=s.start:C=s.end;const I=t,f=e;if(n.closestPointToPoint(C,!0,t),s.closestPointToPoint(p,!0,e),I.distanceToSquared(C)<=f.distanceToSquared(p)){o.copy(I),a.copy(C);return}else{o.copy(p),a.copy(f);return}}}}(),uh=function(){const u=new q,t=new q,e=new zi,n=new Me;return function(s,o){const{radius:a,center:c}=s,{a:h,b:p,c:C}=o;if(n.start=h,n.end=p,n.closestPointToPoint(c,!0,u).distanceTo(c)<=a||(n.start=h,n.end=C,n.closestPointToPoint(c,!0,u).distanceTo(c)<=a)||(n.start=p,n.end=C,n.closestPointToPoint(c,!0,u).distanceTo(c)<=a))return!0;const I=o.getPlane(e);if(Math.abs(I.distanceToPoint(c))<=a){const f=I.projectPoint(c,t);if(o.containsPoint(f))return!0}return!1}}(),dh=1e-15;function xs(u){return Math.abs(u)<dh}class _e extends zn{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new q),this.satBounds=new Array(4).fill().map(()=>new Ve),this.points=[this.a,this.b,this.c],this.sphere=new yo,this.plane=new zi,this.needsUpdate=!0}intersectsSphere(t){return uh(t,this)}update(){const t=this.a,e=this.b,n=this.c,s=this.points,o=this.satAxes,a=this.satBounds,c=o[0],h=a[0];this.getNormal(c),h.setFromPoints(c,s);const p=o[1],C=a[1];p.subVectors(t,e),C.setFromPoints(p,s);const I=o[2],f=a[2];I.subVectors(e,n),f.setFromPoints(I,s);const T=o[3],A=a[3];T.subVectors(n,t),A.setFromPoints(T,s),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(c,t),this.needsUpdate=!1}}_e.prototype.closestPointToSegment=function(){const u=new q,t=new q,e=new Me;return function(n,s=null,o=null){const{start:a,end:c}=n,h=this.points;let p,C=1/0;for(let I=0;I<3;I++){const f=(I+1)%3;e.start.copy(h[I]),e.end.copy(h[f]),_o(e,n,u,t),p=u.distanceToSquared(t),p<C&&(C=p,s&&s.copy(u),o&&o.copy(t))}return this.closestPointToPoint(a,u),p=a.distanceToSquared(u),p<C&&(C=p,s&&s.copy(u),o&&o.copy(a)),this.closestPointToPoint(c,u),p=c.distanceToSquared(u),p<C&&(C=p,s&&s.copy(u),o&&o.copy(c)),Math.sqrt(C)}}();_e.prototype.intersectsTriangle=function(){const u=new _e,t=new Array(3),e=new Array(3),n=new Ve,s=new Ve,o=new q,a=new q,c=new q,h=new q,p=new q,C=new Me,I=new Me,f=new Me,T=new q;function A(F,_,w){const v=F.points;let Y=0,y=-1;for(let L=0;L<3;L++){const{start:k,end:V}=C;k.copy(v[L]),V.copy(v[(L+1)%3]),C.delta(a);const H=xs(_.distanceToPoint(k));if(xs(_.normal.dot(a))&&H){w.copy(C),Y=2;break}const j=_.intersectLine(C,T);if(!j&&H&&T.copy(k),(j||H)&&!xs(T.distanceTo(V))){if(Y<=1)(Y===1?w.start:w.end).copy(T),H&&(y=Y);else if(Y>=2){(y===1?w.start:w.end).copy(T),Y=2;break}if(Y++,Y===2&&y===-1)break}}return Y}return function(F,_=null,w=!1){this.needsUpdate&&this.update(),F.isExtendedTriangle?F.needsUpdate&&F.update():(u.copy(F),u.update(),F=u);const v=this.plane,Y=F.plane;if(Math.abs(v.normal.dot(Y.normal))>1-1e-10){const y=this.satBounds,L=this.satAxes;e[0]=F.a,e[1]=F.b,e[2]=F.c;for(let H=0;H<4;H++){const j=y[H],Q=L[H];if(n.setFromPoints(Q,e),j.isSeparated(n))return!1}const k=F.satBounds,V=F.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let H=0;H<4;H++){const j=k[H],Q=V[H];if(n.setFromPoints(Q,t),j.isSeparated(n))return!1}for(let H=0;H<4;H++){const j=L[H];for(let Q=0;Q<4;Q++){const J=V[Q];if(o.crossVectors(j,J),n.setFromPoints(o,t),s.setFromPoints(o,e),n.isSeparated(s))return!1}}return _&&(w||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),_.start.set(0,0,0),_.end.set(0,0,0)),!0}else{const y=A(this,Y,I);if(y===1&&F.containsPoint(I.end))return _&&(_.start.copy(I.end),_.end.copy(I.end)),!0;if(y!==2)return!1;const L=A(F,v,f);if(L===1&&this.containsPoint(f.end))return _&&(_.start.copy(f.end),_.end.copy(f.end)),!0;if(L!==2)return!1;if(I.delta(c),f.delta(h),c.dot(h)<0){let $=f.start;f.start=f.end,f.end=$}const k=I.start.dot(c),V=I.end.dot(c),H=f.start.dot(c),j=f.end.dot(c),Q=V<H,J=k<j;return k!==j&&H!==V&&Q===J?!1:(_&&(p.subVectors(I.start,f.start),p.dot(c)>0?_.start.copy(I.start):_.start.copy(f.start),p.subVectors(I.end,f.end),p.dot(c)<0?_.end.copy(I.end):_.end.copy(f.end)),!0)}}}();_e.prototype.distanceToPoint=function(){const u=new q;return function(t){return this.closestPointToPoint(t,u),t.distanceTo(u)}}();_e.prototype.distanceToTriangle=function(){const u=new q,t=new q,e=["a","b","c"],n=new Me,s=new Me;return function(o,a=null,c=null){const h=a||c?n:null;if(this.intersectsTriangle(o,h))return(a||c)&&(a&&h.getCenter(a),c&&h.getCenter(c)),0;let p=1/0;for(let C=0;C<3;C++){let I;const f=e[C],T=o[f];this.closestPointToPoint(T,u),I=T.distanceToSquared(u),I<p&&(p=I,a&&a.copy(u),c&&c.copy(T));const A=this[f];o.closestPointToPoint(A,u),I=A.distanceToSquared(u),I<p&&(p=I,a&&a.copy(A),c&&c.copy(u))}for(let C=0;C<3;C++){const I=e[C],f=e[(C+1)%3];n.set(this[I],this[f]);for(let T=0;T<3;T++){const A=e[T],F=e[(T+1)%3];s.set(o[A],o[F]),_o(n,s,u,t);const _=u.distanceToSquared(t);_<p&&(p=_,a&&a.copy(u),c&&c.copy(t))}}return Math.sqrt(p)}}();class ne{constructor(t,e,n){this.isOrientedBox=!0,this.min=new q,this.max=new q,this.matrix=new Mt,this.invMatrix=new Mt,this.points=new Array(8).fill().map(()=>new q),this.satAxes=new Array(3).fill().map(()=>new q),this.satBounds=new Array(3).fill().map(()=>new Ve),this.alignedSatBounds=new Array(3).fill().map(()=>new Ve),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),n&&this.matrix.copy(n)}set(t,e,n){this.min.copy(t),this.max.copy(e),this.matrix.copy(n),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}}ne.prototype.update=function(){return function(){const u=this.matrix,t=this.min,e=this.max,n=this.points;for(let h=0;h<=1;h++)for(let p=0;p<=1;p++)for(let C=0;C<=1;C++){const I=1*h|2*p|4*C,f=n[I];f.x=h?e.x:t.x,f.y=p?e.y:t.y,f.z=C?e.z:t.z,f.applyMatrix4(u)}const s=this.satBounds,o=this.satAxes,a=n[0];for(let h=0;h<3;h++){const p=o[h],C=s[h],I=1<<h,f=n[I];p.subVectors(a,f),C.setFromPoints(p,n)}const c=this.alignedSatBounds;c[0].setFromPointsField(n,"x"),c[1].setFromPointsField(n,"y"),c[2].setFromPointsField(n,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();ne.prototype.intersectsBox=function(){const u=new Ve;return function(t){this.needsUpdate&&this.update();const e=t.min,n=t.max,s=this.satBounds,o=this.satAxes,a=this.alignedSatBounds;if(u.min=e.x,u.max=n.x,a[0].isSeparated(u)||(u.min=e.y,u.max=n.y,a[1].isSeparated(u))||(u.min=e.z,u.max=n.z,a[2].isSeparated(u)))return!1;for(let c=0;c<3;c++){const h=o[c],p=s[c];if(u.setFromBox(h,t),p.isSeparated(u))return!1}return!0}}();ne.prototype.intersectsTriangle=function(){const u=new _e,t=new Array(3),e=new Ve,n=new Ve,s=new q;return function(o){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(u.copy(o),u.update(),o=u);const a=this.satBounds,c=this.satAxes;t[0]=o.a,t[1]=o.b,t[2]=o.c;for(let I=0;I<3;I++){const f=a[I],T=c[I];if(e.setFromPoints(T,t),f.isSeparated(e))return!1}const h=o.satBounds,p=o.satAxes,C=this.points;for(let I=0;I<3;I++){const f=h[I],T=p[I];if(e.setFromPoints(T,C),f.isSeparated(e))return!1}for(let I=0;I<3;I++){const f=c[I];for(let T=0;T<4;T++){const A=p[T];if(s.crossVectors(f,A),e.setFromPoints(s,t),n.setFromPoints(s,C),e.isSeparated(n))return!1}}return!0}}();ne.prototype.closestPointToPoint=function(){return function(u,t){return this.needsUpdate&&this.update(),t.copy(u).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}();ne.prototype.distanceToPoint=function(){const u=new q;return function(t){return this.closestPointToPoint(t,u),t.distanceTo(u)}}();ne.prototype.distanceToBox=function(){const u=["x","y","z"],t=new Array(12).fill().map(()=>new Me),e=new Array(12).fill().map(()=>new Me),n=new q,s=new q;return function(o,a=0,c=null,h=null){if(this.needsUpdate&&this.update(),this.intersectsBox(o))return(c||h)&&(o.getCenter(s),this.closestPointToPoint(s,n),o.closestPointToPoint(n,s),c&&c.copy(n),h&&h.copy(s)),0;const p=a*a,C=o.min,I=o.max,f=this.points;let T=1/0;for(let F=0;F<8;F++){const _=f[F];s.copy(_).clamp(C,I);const w=_.distanceToSquared(s);if(w<T&&(T=w,c&&c.copy(_),h&&h.copy(s),w<p))return Math.sqrt(w)}let A=0;for(let F=0;F<3;F++)for(let _=0;_<=1;_++)for(let w=0;w<=1;w++){const v=(F+1)%3,Y=(F+2)%3,y=_<<v|w<<Y,L=1<<F|_<<v|w<<Y,k=f[y],V=f[L];t[A].set(k,V);const H=u[F],j=u[v],Q=u[Y],J=e[A],$=J.start,nt=J.end;$[H]=C[H],$[j]=_?C[j]:I[j],$[Q]=w?C[Q]:I[j],nt[H]=I[H],nt[j]=_?C[j]:I[j],nt[Q]=w?C[Q]:I[j],A++}for(let F=0;F<=1;F++)for(let _=0;_<=1;_++)for(let w=0;w<=1;w++){s.x=F?I.x:C.x,s.y=_?I.y:C.y,s.z=w?I.z:C.z,this.closestPointToPoint(s,n);const v=s.distanceToSquared(n);if(v<T&&(T=v,c&&c.copy(n),h&&h.copy(s),v<p))return Math.sqrt(v)}for(let F=0;F<12;F++){const _=t[F];for(let w=0;w<12;w++){const v=e[w];_o(_,v,n,s);const Y=n.distanceToSquared(s);if(Y<T&&(T=Y,c&&c.copy(n),h&&h.copy(s),Y<p))return Math.sqrt(Y)}}return Math.sqrt(T)}}();class Oo{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){const t=this._primitives;return t.length===0?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}}class ph extends Oo{constructor(){super(()=>new _e)}}const ue=new ph;function oe(u,t){return t[u+15]===65535}function ae(u,t){return t[u+6]}function de(u,t){return t[u+14]}function pe(u){return u+8}function Ee(u,t){return t[u+6]}function Al(u,t){return t[u+7]}class Eh{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const t=[];let e=null;this.setBuffer=n=>{e&&t.push(e),e=n,this.float32Array=new Float32Array(n),this.uint16Array=new Uint16Array(n),this.uint32Array=new Uint32Array(n)},this.clearBuffer=()=>{e=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,t.length!==0&&this.setBuffer(t.pop())}}}const bt=new Eh;let en,Hn;const wn=[],mi=new Oo(()=>new $t);function fh(u,t,e,n,s,o){en=mi.getPrimitive(),Hn=mi.getPrimitive(),wn.push(en,Hn),bt.setBuffer(u._roots[t]);const a=to(0,u.geometry,e,n,s,o);bt.clearBuffer(),mi.releasePrimitive(en),mi.releasePrimitive(Hn),wn.pop(),wn.pop();const c=wn.length;return c>0&&(Hn=wn[c-1],en=wn[c-2]),a}function to(u,t,e,n,s=null,o=0,a=0){const{float32Array:c,uint16Array:h,uint32Array:p}=bt;let C=u*2;if(oe(C,h)){const I=ae(u,p),f=de(C,h);return Dt(u,c,en),n(I,f,!1,a,o+u,en)}else{let I=function(J){const{uint16Array:$,uint32Array:nt}=bt;let ut=J*2;for(;!oe(ut,$);)J=pe(J),ut=J*2;return ae(J,nt)},f=function(J){const{uint16Array:$,uint32Array:nt}=bt;let ut=J*2;for(;!oe(ut,$);)J=Ee(J,nt),ut=J*2;return ae(J,nt)+de(ut,$)};const T=pe(u),A=Ee(u,p);let F=T,_=A,w,v,Y,y;if(s&&(Y=en,y=Hn,Dt(F,c,Y),Dt(_,c,y),w=s(Y),v=s(y),v<w)){F=A,_=T;const J=w;w=v,v=J,Y=y}Y||(Y=en,Dt(F,c,Y));const L=oe(F*2,h),k=e(Y,L,w,a+1,o+F);let V;if(k===fa){const J=I(F),$=f(F)-J;V=n(J,$,!0,a+1,o+F,Y)}else V=k&&to(F,t,e,n,s,o,a+1);if(V)return!0;y=Hn,Dt(_,c,y);const H=oe(_*2,h),j=e(y,H,v,a+1,o+_);let Q;if(j===fa){const J=I(_),$=f(_)-J;Q=n(J,$,!0,a+1,o+_,y)}else Q=j&&to(_,t,e,n,s,o,a+1);return!!Q}}const Tr=new q,Ds=new q;function Ih(u,t,e={},n=0,s=1/0){const o=n*n,a=s*s;let c=1/0,h=null;if(u.shapecast({boundsTraverseOrder:C=>(Tr.copy(t).clamp(C.min,C.max),Tr.distanceToSquared(t)),intersectsBounds:(C,I,f)=>f<c&&f<a,intersectsTriangle:(C,I)=>{C.closestPointToPoint(t,Tr);const f=t.distanceToSquared(Tr);return f<c&&(Ds.copy(Tr),c=f,h=I),f<o}}),c===1/0)return null;const p=Math.sqrt(c);return e.point?e.point.copy(Ds):e.point=Ds.clone(),e.distance=p,e.faceIndex=h,e}const vn=new q,Sn=new q,Pn=new q,Ci=new Fe,Ti=new Fe,gi=new Fe,ga=new q,ya=new q,Ra=new q,yi=new q;function mh(u,t,e,n,s,o){let a;return o===Bc?a=u.intersectTriangle(n,e,t,!0,s):a=u.intersectTriangle(t,e,n,o!==Yr,s),a===null?null:{distance:u.origin.distanceTo(s),point:s.clone()}}function Ch(u,t,e,n,s,o,a,c,h){vn.fromBufferAttribute(t,o),Sn.fromBufferAttribute(t,a),Pn.fromBufferAttribute(t,c);const p=mh(u,vn,Sn,Pn,yi,h);if(p){n&&(Ci.fromBufferAttribute(n,o),Ti.fromBufferAttribute(n,a),gi.fromBufferAttribute(n,c),p.uv=zn.getInterpolation(yi,vn,Sn,Pn,Ci,Ti,gi,new Fe)),s&&(Ci.fromBufferAttribute(s,o),Ti.fromBufferAttribute(s,a),gi.fromBufferAttribute(s,c),p.uv1=zn.getInterpolation(yi,vn,Sn,Pn,Ci,Ti,gi,new Fe)),e&&(ga.fromBufferAttribute(e,o),ya.fromBufferAttribute(e,a),Ra.fromBufferAttribute(e,c),p.normal=zn.getInterpolation(yi,vn,Sn,Pn,ga,ya,Ra,new q),p.normal.dot(u.direction)>0&&p.normal.multiplyScalar(-1));const C={a:o,b:a,c,normal:new q,materialIndex:0};zn.getNormal(vn,Sn,Pn,C.normal),p.face=C,p.faceIndex=o}return p}function Ki(u,t,e,n,s){const o=n*3;let a=o+0,c=o+1,h=o+2;const p=u.index;u.index&&(a=p.getX(a),c=p.getX(c),h=p.getX(h));const{position:C,normal:I,uv:f,uv1:T}=u.attributes,A=Ch(e,C,I,f,T,a,c,h,t);return A?(A.faceIndex=n,s&&s.push(A),A):null}function Gt(u,t,e,n){const s=u.a,o=u.b,a=u.c;let c=t,h=t+1,p=t+2;e&&(c=e.getX(c),h=e.getX(h),p=e.getX(p)),s.x=n.getX(c),s.y=n.getY(c),s.z=n.getZ(c),o.x=n.getX(h),o.y=n.getY(h),o.z=n.getZ(h),a.x=n.getX(p),a.y=n.getY(p),a.z=n.getZ(p)}function Th(u,t,e,n,s,o){const{geometry:a,_indirectBuffer:c}=u;for(let h=n,p=n+s;h<p;h++)Ki(a,t,e,h,o)}function gh(u,t,e,n,s){const{geometry:o,_indirectBuffer:a}=u;let c=1/0,h=null;for(let p=n,C=n+s;p<C;p++){let I;I=Ki(o,t,e,p),I&&I.distance<c&&(h=I,c=I.distance)}return h}function yh(u,t,e,n,s,o,a){const{geometry:c}=e,{index:h}=c,p=c.attributes.position;for(let C=u,I=t+u;C<I;C++){let f;if(f=C,Gt(a,f*3,h,p),a.needsUpdate=!0,n(a,f,s,o))return!0}return!1}function Rh(u,t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=u.geometry,n=e.index?e.index.array:null,s=e.attributes.position;let o,a,c,h,p=0;const C=u._roots;for(let f=0,T=C.length;f<T;f++)o=C[f],a=new Uint32Array(o),c=new Uint16Array(o),h=new Float32Array(o),I(0,p),p+=o.byteLength;function I(f,T,A=!1){const F=f*2;if(c[F+15]===Hi){const _=a[f+6],w=c[F+14];let v=1/0,Y=1/0,y=1/0,L=-1/0,k=-1/0,V=-1/0;for(let H=3*_,j=3*(_+w);H<j;H++){let Q=n[H];const J=s.getX(Q),$=s.getY(Q),nt=s.getZ(Q);J<v&&(v=J),J>L&&(L=J),$<Y&&(Y=$),$>k&&(k=$),nt<y&&(y=nt),nt>V&&(V=nt)}return h[f+0]!==v||h[f+1]!==Y||h[f+2]!==y||h[f+3]!==L||h[f+4]!==k||h[f+5]!==V?(h[f+0]=v,h[f+1]=Y,h[f+2]=y,h[f+3]=L,h[f+4]=k,h[f+5]=V,!0):!1}else{const _=f+8,w=a[f+6],v=_+T,Y=w+T;let y=A,L=!1,k=!1;t?y||(L=t.has(v),k=t.has(Y),y=!L&&!k):(L=!0,k=!0);const V=y||L,H=y||k;let j=!1;V&&(j=I(_,T,y));let Q=!1;H&&(Q=I(w,T,y));const J=j||Q;if(J)for(let $=0;$<3;$++){const nt=_+$,ut=w+$,It=h[nt],yt=h[nt+3],kt=h[ut],Rt=h[ut+3];h[f+$]=It<kt?It:kt,h[f+$+3]=yt>Rt?yt:Rt}return J}}}const Aa=new $t;function nn(u,t,e,n){return Dt(u,t,Aa),e.intersectBox(Aa,n)}function Ah(u,t,e,n,s,o){const{geometry:a,_indirectBuffer:c}=u;for(let h=n,p=n+s;h<p;h++){let C=c?c[h]:h;Ki(a,t,e,C,o)}}function Fh(u,t,e,n,s){const{geometry:o,_indirectBuffer:a}=u;let c=1/0,h=null;for(let p=n,C=n+s;p<C;p++){let I;I=Ki(o,t,e,a?a[p]:p),I&&I.distance<c&&(h=I,c=I.distance)}return h}function _h(u,t,e,n,s,o,a){const{geometry:c}=e,{index:h}=c,p=c.attributes.position;for(let C=u,I=t+u;C<I;C++){let f;if(f=e.resolveTriangleIndex(C),Gt(a,f*3,h,p),a.needsUpdate=!0,n(a,f,s,o))return!0}return!1}const Fa=new q;function Oh(u,t,e,n,s){bt.setBuffer(u._roots[t]),eo(0,u,e,n,s),bt.clearBuffer()}function eo(u,t,e,n,s){const{float32Array:o,uint16Array:a,uint32Array:c}=bt,h=u*2;if(oe(h,a)){const p=ae(u,c),C=de(h,a);Th(t,e,n,p,C,s)}else{const p=pe(u);nn(p,o,n,Fa)&&eo(p,t,e,n,s);const C=Ee(u,c);nn(C,o,n,Fa)&&eo(C,t,e,n,s)}}const _a=new q,wh=["x","y","z"];function vh(u,t,e,n){bt.setBuffer(u._roots[t]);const s=no(0,u,e,n);return bt.clearBuffer(),s}function no(u,t,e,n){const{float32Array:s,uint16Array:o,uint32Array:a}=bt;let c=u*2;if(oe(c,o)){const h=ae(u,a),p=de(c,o);return gh(t,e,n,h,p)}else{const h=Al(u,a),p=wh[h],C=n.direction[p]>=0;let I,f;C?(I=pe(u),f=Ee(u,a)):(I=Ee(u,a),f=pe(u));const T=nn(I,s,n,_a)?no(I,t,e,n):null;if(T){const F=T.point[p];if(C?F<=s[f+h]:F>=s[f+h+3])return T}const A=nn(f,s,n,_a)?no(f,t,e,n):null;return T&&A?T.distance<=A.distance?T:A:T||A||null}}const Ri=new $t,bn=new _e,Nn=new _e,gr=new Mt,Oa=new ne,Ai=new ne;function Sh(u,t,e,n){bt.setBuffer(u._roots[t]);const s=ro(0,u,e,n);return bt.clearBuffer(),s}function ro(u,t,e,n,s=null){const{float32Array:o,uint16Array:a,uint32Array:c}=bt;let h=u*2;if(s===null&&(e.boundingBox||e.computeBoundingBox(),Oa.set(e.boundingBox.min,e.boundingBox.max,n),s=Oa),oe(h,a)){const p=t.geometry,C=p.index,I=p.attributes.position,f=e.index,T=e.attributes.position,A=ae(u,c),F=de(h,a);if(gr.copy(n).invert(),e.boundsTree)return Dt(u,o,Ai),Ai.matrix.copy(gr),Ai.needsUpdate=!0,e.boundsTree.shapecast({intersectsBounds:_=>Ai.intersectsBox(_),intersectsTriangle:_=>{_.a.applyMatrix4(n),_.b.applyMatrix4(n),_.c.applyMatrix4(n),_.needsUpdate=!0;for(let w=A*3,v=(F+A)*3;w<v;w+=3)if(Gt(Nn,w,C,I),Nn.needsUpdate=!0,_.intersectsTriangle(Nn))return!0;return!1}});for(let _=A*3,w=(F+A)*3;_<w;_+=3){Gt(bn,_,C,I),bn.a.applyMatrix4(gr),bn.b.applyMatrix4(gr),bn.c.applyMatrix4(gr),bn.needsUpdate=!0;for(let v=0,Y=f.count;v<Y;v+=3)if(Gt(Nn,v,f,T),Nn.needsUpdate=!0,bn.intersectsTriangle(Nn))return!0}}else{const p=u+8,C=c[u+6];return Dt(p,o,Ri),!!(s.intersectsBox(Ri)&&ro(p,t,e,n,s)||(Dt(C,o,Ri),s.intersectsBox(Ri)&&ro(C,t,e,n,s)))}}const Fi=new Mt,Us=new ne,yr=new ne,Ph=new q,bh=new q,Nh=new q,Lh=new q;function Mh(u,t,e,n={},s={},o=0,a=1/0){t.boundingBox||t.computeBoundingBox(),Us.set(t.boundingBox.min,t.boundingBox.max,e),Us.needsUpdate=!0;const c=u.geometry,h=c.attributes.position,p=c.index,C=t.attributes.position,I=t.index,f=ue.getPrimitive(),T=ue.getPrimitive();let A=Ph,F=bh,_=null,w=null;s&&(_=Nh,w=Lh);let v=1/0,Y=null,y=null;return Fi.copy(e).invert(),yr.matrix.copy(Fi),u.shapecast({boundsTraverseOrder:L=>Us.distanceToBox(L),intersectsBounds:(L,k,V)=>V<v&&V<a?(k&&(yr.min.copy(L.min),yr.max.copy(L.max),yr.needsUpdate=!0),!0):!1,intersectsRange:(L,k)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:V=>yr.distanceToBox(V),intersectsBounds:(V,H,j)=>j<v&&j<a,intersectsRange:(V,H)=>{for(let j=V,Q=V+H;j<Q;j++){Gt(T,3*j,I,C),T.a.applyMatrix4(e),T.b.applyMatrix4(e),T.c.applyMatrix4(e),T.needsUpdate=!0;for(let J=L,$=L+k;J<$;J++){Gt(f,3*J,p,h),f.needsUpdate=!0;const nt=f.distanceToTriangle(T,A,_);if(nt<v&&(F.copy(A),w&&w.copy(_),v=nt,Y=J,y=j),nt<o)return!0}}}});{const V=Jn(t);for(let H=0,j=V;H<j;H++){Gt(T,3*H,I,C),T.a.applyMatrix4(e),T.b.applyMatrix4(e),T.c.applyMatrix4(e),T.needsUpdate=!0;for(let Q=L,J=L+k;Q<J;Q++){Gt(f,3*Q,p,h),f.needsUpdate=!0;const $=f.distanceToTriangle(T,A,_);if($<v&&(F.copy(A),w&&w.copy(_),v=$,Y=Q,y=H),$<o)return!0}}}}}),ue.releasePrimitive(f),ue.releasePrimitive(T),v===1/0?null:(n.point?n.point.copy(F):n.point=F.clone(),n.distance=v,n.faceIndex=Y,s&&(s.point?s.point.copy(w):s.point=w.clone(),s.point.applyMatrix4(Fi),F.applyMatrix4(Fi),s.distance=F.sub(s.point).length(),s.faceIndex=y),n)}function xh(u,t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=u.geometry,n=e.index?e.index.array:null,s=e.attributes.position;let o,a,c,h,p=0;const C=u._roots;for(let f=0,T=C.length;f<T;f++)o=C[f],a=new Uint32Array(o),c=new Uint16Array(o),h=new Float32Array(o),I(0,p),p+=o.byteLength;function I(f,T,A=!1){const F=f*2;if(c[F+15]===Hi){const _=a[f+6],w=c[F+14];let v=1/0,Y=1/0,y=1/0,L=-1/0,k=-1/0,V=-1/0;for(let H=_,j=_+w;H<j;H++){const Q=3*u.resolveTriangleIndex(H);for(let J=0;J<3;J++){let $=Q+J;$=n?n[$]:$;const nt=s.getX($),ut=s.getY($),It=s.getZ($);nt<v&&(v=nt),nt>L&&(L=nt),ut<Y&&(Y=ut),ut>k&&(k=ut),It<y&&(y=It),It>V&&(V=It)}}return h[f+0]!==v||h[f+1]!==Y||h[f+2]!==y||h[f+3]!==L||h[f+4]!==k||h[f+5]!==V?(h[f+0]=v,h[f+1]=Y,h[f+2]=y,h[f+3]=L,h[f+4]=k,h[f+5]=V,!0):!1}else{const _=f+8,w=a[f+6],v=_+T,Y=w+T;let y=A,L=!1,k=!1;t?y||(L=t.has(v),k=t.has(Y),y=!L&&!k):(L=!0,k=!0);const V=y||L,H=y||k;let j=!1;V&&(j=I(_,T,y));let Q=!1;H&&(Q=I(w,T,y));const J=j||Q;if(J)for(let $=0;$<3;$++){const nt=_+$,ut=w+$,It=h[nt],yt=h[nt+3],kt=h[ut],Rt=h[ut+3];h[f+$]=It<kt?It:kt,h[f+$+3]=yt>Rt?yt:Rt}return J}}}const wa=new q;function Dh(u,t,e,n,s){bt.setBuffer(u._roots[t]),io(0,u,e,n,s),bt.clearBuffer()}function io(u,t,e,n,s){const{float32Array:o,uint16Array:a,uint32Array:c}=bt,h=u*2;if(oe(h,a)){const p=ae(u,c),C=de(h,a);Ah(t,e,n,p,C,s)}else{const p=pe(u);nn(p,o,n,wa)&&io(p,t,e,n,s);const C=Ee(u,c);nn(C,o,n,wa)&&io(C,t,e,n,s)}}const va=new q,Uh=["x","y","z"];function Bh(u,t,e,n){bt.setBuffer(u._roots[t]);const s=so(0,u,e,n);return bt.clearBuffer(),s}function so(u,t,e,n){const{float32Array:s,uint16Array:o,uint32Array:a}=bt;let c=u*2;if(oe(c,o)){const h=ae(u,a),p=de(c,o);return Fh(t,e,n,h,p)}else{const h=Al(u,a),p=Uh[h],C=n.direction[p]>=0;let I,f;C?(I=pe(u),f=Ee(u,a)):(I=Ee(u,a),f=pe(u));const T=nn(I,s,n,va)?so(I,t,e,n):null;if(T){const F=T.point[p];if(C?F<=s[f+h]:F>=s[f+h+3])return T}const A=nn(f,s,n,va)?so(f,t,e,n):null;return T&&A?T.distance<=A.distance?T:A:T||A||null}}const _i=new $t,Ln=new _e,Mn=new _e,Rr=new Mt,Sa=new ne,Oi=new ne;function Yh(u,t,e,n){bt.setBuffer(u._roots[t]);const s=oo(0,u,e,n);return bt.clearBuffer(),s}function oo(u,t,e,n,s=null){const{float32Array:o,uint16Array:a,uint32Array:c}=bt;let h=u*2;if(s===null&&(e.boundingBox||e.computeBoundingBox(),Sa.set(e.boundingBox.min,e.boundingBox.max,n),s=Sa),oe(h,a)){const p=t.geometry,C=p.index,I=p.attributes.position,f=e.index,T=e.attributes.position,A=ae(u,c),F=de(h,a);if(Rr.copy(n).invert(),e.boundsTree)return Dt(u,o,Oi),Oi.matrix.copy(Rr),Oi.needsUpdate=!0,e.boundsTree.shapecast({intersectsBounds:_=>Oi.intersectsBox(_),intersectsTriangle:_=>{_.a.applyMatrix4(n),_.b.applyMatrix4(n),_.c.applyMatrix4(n),_.needsUpdate=!0;for(let w=A,v=F+A;w<v;w++)if(Gt(Mn,3*t.resolveTriangleIndex(w),C,I),Mn.needsUpdate=!0,_.intersectsTriangle(Mn))return!0;return!1}});for(let _=A,w=F+A;_<w;_++){const v=t.resolveTriangleIndex(_);Gt(Ln,3*v,C,I),Ln.a.applyMatrix4(Rr),Ln.b.applyMatrix4(Rr),Ln.c.applyMatrix4(Rr),Ln.needsUpdate=!0;for(let Y=0,y=f.count;Y<y;Y+=3)if(Gt(Mn,Y,f,T),Mn.needsUpdate=!0,Ln.intersectsTriangle(Mn))return!0}}else{const p=u+8,C=c[u+6];return Dt(p,o,_i),!!(s.intersectsBox(_i)&&oo(p,t,e,n,s)||(Dt(C,o,_i),s.intersectsBox(_i)&&oo(C,t,e,n,s)))}}const wi=new Mt,Bs=new ne,Ar=new ne,kh=new q,Gh=new q,Vh=new q,zh=new q;function Hh(u,t,e,n={},s={},o=0,a=1/0){t.boundingBox||t.computeBoundingBox(),Bs.set(t.boundingBox.min,t.boundingBox.max,e),Bs.needsUpdate=!0;const c=u.geometry,h=c.attributes.position,p=c.index,C=t.attributes.position,I=t.index,f=ue.getPrimitive(),T=ue.getPrimitive();let A=kh,F=Gh,_=null,w=null;s&&(_=Vh,w=zh);let v=1/0,Y=null,y=null;return wi.copy(e).invert(),Ar.matrix.copy(wi),u.shapecast({boundsTraverseOrder:L=>Bs.distanceToBox(L),intersectsBounds:(L,k,V)=>V<v&&V<a?(k&&(Ar.min.copy(L.min),Ar.max.copy(L.max),Ar.needsUpdate=!0),!0):!1,intersectsRange:(L,k)=>{if(t.boundsTree){const V=t.boundsTree;return V.shapecast({boundsTraverseOrder:H=>Ar.distanceToBox(H),intersectsBounds:(H,j,Q)=>Q<v&&Q<a,intersectsRange:(H,j)=>{for(let Q=H,J=H+j;Q<J;Q++){const $=V.resolveTriangleIndex(Q);Gt(T,3*$,I,C),T.a.applyMatrix4(e),T.b.applyMatrix4(e),T.c.applyMatrix4(e),T.needsUpdate=!0;for(let nt=L,ut=L+k;nt<ut;nt++){const It=u.resolveTriangleIndex(nt);Gt(f,3*It,p,h),f.needsUpdate=!0;const yt=f.distanceToTriangle(T,A,_);if(yt<v&&(F.copy(A),w&&w.copy(_),v=yt,Y=nt,y=Q),yt<o)return!0}}}})}else{const V=Jn(t);for(let H=0,j=V;H<j;H++){Gt(T,3*H,I,C),T.a.applyMatrix4(e),T.b.applyMatrix4(e),T.c.applyMatrix4(e),T.needsUpdate=!0;for(let Q=L,J=L+k;Q<J;Q++){const $=u.resolveTriangleIndex(Q);Gt(f,3*$,p,h),f.needsUpdate=!0;const nt=f.distanceToTriangle(T,A,_);if(nt<v&&(F.copy(A),w&&w.copy(_),v=nt,Y=Q,y=H),nt<o)return!0}}}}}),ue.releasePrimitive(f),ue.releasePrimitive(T),v===1/0?null:(n.point?n.point.copy(F):n.point=F.clone(),n.distance=v,n.faceIndex=Y,s&&(s.point?s.point.copy(w):s.point=w.clone(),s.point.applyMatrix4(wi),F.applyMatrix4(wi),s.distance=F.sub(s.point).length(),s.faceIndex=y),n)}function Kh(){return typeof SharedArrayBuffer<"u"}const Lr=new bt.constructor,Gi=new bt.constructor,tn=new Oo(()=>new $t),xn=new $t,Dn=new $t,Ys=new $t,ks=new $t;let Gs=!1;function Wh(u,t,e,n){if(Gs)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");Gs=!0;const s=u._roots,o=t._roots;let a,c=0,h=0;const p=new Mt().copy(e).invert();for(let C=0,I=s.length;C<I;C++){Lr.setBuffer(s[C]),h=0;const f=tn.getPrimitive();Dt(0,Lr.float32Array,f),f.applyMatrix4(p);for(let T=0,A=o.length;T<A&&(Gi.setBuffer(o[C]),a=Te(0,0,e,p,n,c,h,0,0,f),Gi.clearBuffer(),h+=o[T].length,!a);T++);if(tn.releasePrimitive(f),Lr.clearBuffer(),c+=s[C].length,a)break}return Gs=!1,a}function Te(u,t,e,n,s,o=0,a=0,c=0,h=0,p=null,C=!1){let I,f;C?(I=Gi,f=Lr):(I=Lr,f=Gi);const T=I.float32Array,A=I.uint32Array,F=I.uint16Array,_=f.float32Array,w=f.uint32Array,v=f.uint16Array,Y=u*2,y=t*2,L=oe(Y,F),k=oe(y,v);let V=!1;if(k&&L)C?V=s(ae(t,w),de(t*2,v),ae(u,A),de(u*2,F),h,a+t,c,o+u):V=s(ae(u,A),de(u*2,F),ae(t,w),de(t*2,v),c,o+u,h,a+t);else if(k){const H=tn.getPrimitive();Dt(t,_,H),H.applyMatrix4(e);const j=pe(u),Q=Ee(u,A);Dt(j,T,xn),Dt(Q,T,Dn);const J=H.intersectsBox(xn),$=H.intersectsBox(Dn);V=J&&Te(t,j,n,e,s,a,o,h,c+1,H,!C)||$&&Te(t,Q,n,e,s,a,o,h,c+1,H,!C),tn.releasePrimitive(H)}else{const H=pe(t),j=Ee(t,w);Dt(H,_,Ys),Dt(j,_,ks);const Q=p.intersectsBox(Ys),J=p.intersectsBox(ks);if(Q&&J)V=Te(u,H,e,n,s,o,a,c,h+1,p,C)||Te(u,j,e,n,s,o,a,c,h+1,p,C);else if(Q)if(L)V=Te(u,H,e,n,s,o,a,c,h+1,p,C);else{const $=tn.getPrimitive();$.copy(Ys).applyMatrix4(e);const nt=pe(u),ut=Ee(u,A);Dt(nt,T,xn),Dt(ut,T,Dn);const It=$.intersectsBox(xn),yt=$.intersectsBox(Dn);V=It&&Te(H,nt,n,e,s,a,o,h,c+1,$,!C)||yt&&Te(H,ut,n,e,s,a,o,h,c+1,$,!C),tn.releasePrimitive($)}else if(J)if(L)V=Te(u,j,e,n,s,o,a,c,h+1,p,C);else{const $=tn.getPrimitive();$.copy(ks).applyMatrix4(e);const nt=pe(u),ut=Ee(u,A);Dt(nt,T,xn),Dt(ut,T,Dn);const It=$.intersectsBox(xn),yt=$.intersectsBox(Dn);V=It&&Te(j,nt,n,e,s,a,o,h,c+1,$,!C)||yt&&Te(j,ut,n,e,s,a,o,h,c+1,$,!C),tn.releasePrimitive($)}}return V}const vi=new ne,Pa=new $t;class wo{static serialize(t,e={}){e={cloneBuffers:!0,...e};const n=t.geometry,s=t._roots,o=t._indirectBuffer,a=n.getIndex();let c;return e.cloneBuffers?c={roots:s.map(h=>h.slice()),index:a.array.slice(),indirectBuffer:o?o.slice():null}:c={roots:s,index:a.array,indirectBuffer:o},c}static deserialize(t,e,n={}){n={setIndex:!0,indirect:!!t.indirectBuffer,...n};const{index:s,roots:o,indirectBuffer:a}=t,c=new wo(e,{...n,[Ls]:!0});if(c._roots=o,c._indirectBuffer=a||null,n.setIndex){const h=e.getIndex();if(h===null){const p=new Zn(t.index,1,!1);e.setIndex(p)}else h.array!==s&&(h.array.set(s),h.needsUpdate=!0)}return c}get indirect(){return!!this._indirectBuffer}constructor(t,e={}){if(t.isBufferGeometry){if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e=Object.assign({strategy:gl,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[Ls]:!1},e),e.useSharedArrayBuffer&&!Kh())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=t,this._roots=null,this._indirectBuffer=null,e[Ls]||(ch(this,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new $t)));const{_indirectBuffer:n}=this;this.resolveTriangleIndex=e.indirect?s=>n[s]:s=>s}refit(t=null){return(this.indirect?xh:Rh)(this,t)}traverse(t,e=0){const n=this._roots[e],s=new Uint32Array(n),o=new Uint16Array(n);a(0);function a(c,h=0){const p=c*2,C=o[p+15]===Hi;if(C){const I=s[c+6],f=o[p+14];t(h,C,new Float32Array(n,c*4,6),I,f)}else{const I=c+Ui/4,f=s[c+6],T=s[c+7];t(h,C,new Float32Array(n,c*4,6),T)||(a(I,h+1),a(f,h+1))}}}raycast(t,e=da){const n=this._roots,s=this.geometry,o=[],a=e.isMaterial,c=Array.isArray(e),h=s.groups,p=a?e.side:e,C=this.indirect?Dh:Oh;for(let I=0,f=n.length;I<f;I++){const T=c?e[h[I].materialIndex].side:p,A=o.length;if(C(this,I,T,t,o),c){const F=h[I].materialIndex;for(let _=A,w=o.length;_<w;_++)o[_].face.materialIndex=F}}return o}raycastFirst(t,e=da){const n=this._roots,s=this.geometry,o=e.isMaterial,a=Array.isArray(e);let c=null;const h=s.groups,p=o?e.side:e,C=this.indirect?Bh:vh;for(let I=0,f=n.length;I<f;I++){const T=a?e[h[I].materialIndex].side:p,A=C(this,I,T,t);A!=null&&(c==null||A.distance<c.distance)&&(c=A,a&&(A.face.materialIndex=h[I].materialIndex))}return c}intersectsGeometry(t,e){let n=!1;const s=this._roots,o=this.indirect?Yh:Sh;for(let a=0,c=s.length;a<c&&(n=o(this,a,t,e),!n);a++);return n}shapecast(t){const e=ue.getPrimitive(),n=this.indirect?_h:yh;let{boundsTraverseOrder:s,intersectsBounds:o,intersectsRange:a,intersectsTriangle:c}=t;if(a&&c){const I=a;a=(f,T,A,F,_)=>I(f,T,A,F,_)?!0:n(f,T,this,c,A,F,e)}else a||(c?a=(I,f,T,A)=>n(I,f,this,c,T,A,e):a=(I,f,T)=>T);let h=!1,p=0;const C=this._roots;for(let I=0,f=C.length;I<f;I++){const T=C[I];if(h=fh(this,I,o,a,s,p),h)break;p+=T.byteLength}return ue.releasePrimitive(e),h}bvhcast(t,e,n){let{intersectsRanges:s,intersectsTriangles:o}=n;const a=ue.getPrimitive(),c=this.geometry.index,h=this.geometry.attributes.position,p=this.indirect?A=>{const F=this.resolveTriangleIndex(A);Gt(a,F*3,c,h)}:A=>{Gt(a,A*3,c,h)},C=ue.getPrimitive(),I=t.geometry.index,f=t.geometry.attributes.position,T=t.indirect?A=>{const F=t.resolveTriangleIndex(A);Gt(C,F*3,I,f)}:A=>{Gt(C,A*3,I,f)};if(o){const A=(F,_,w,v,Y,y,L,k)=>{for(let V=w,H=w+v;V<H;V++){T(V),C.a.applyMatrix4(e),C.b.applyMatrix4(e),C.c.applyMatrix4(e),C.needsUpdate=!0;for(let j=F,Q=F+_;j<Q;j++)if(p(j),a.needsUpdate=!0,o(a,C,j,V,Y,y,L,k))return!0}return!1};if(s){const F=s;s=function(_,w,v,Y,y,L,k,V){return F(_,w,v,Y,y,L,k,V)?!0:A(_,w,v,Y,y,L,k,V)}}else s=A}return Wh(this,t,e,s)}intersectsBox(t,e){return vi.set(t.min,t.max,e),vi.needsUpdate=!0,this.shapecast({intersectsBounds:n=>vi.intersectsBox(n),intersectsTriangle:n=>vi.intersectsTriangle(n)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e,n={},s={},o=0,a=1/0){return(this.indirect?Hh:Mh)(this,t,e,n,s,o,a)}closestPointToPoint(t,e={},n=0,s=1/0){return Ih(this,t,e,n,s)}getBoundingBox(t){return t.makeEmpty(),this._roots.forEach(e=>{Dt(0,new Float32Array(e),Pa),t.union(Pa)}),t}}function ba(u,t,e){return u===null||(u.point.applyMatrix4(t.matrixWorld),u.distance=u.point.distanceTo(e.ray.origin),u.object=t,u.distance<e.near||u.distance>e.far)?null:u}const Vs=new Mc,Na=new Mt,Xh=lt.prototype.raycast;function jh(u,t){if(this.geometry.boundsTree){if(this.material===void 0)return;Na.copy(this.matrixWorld).invert(),Vs.copy(u.ray).applyMatrix4(Na);const e=this.geometry.boundsTree;if(u.firstHitOnly===!0){const n=ba(e.raycastFirst(Vs,this.material),this,u);n&&t.push(n)}else{const n=e.raycast(Vs,this.material);for(let s=0,o=n.length;s<o;s++){const a=ba(n[s],this,u);a&&t.push(a)}}}else Xh.call(this,u,t)}function qh(u){return this.boundsTree=new wo(this,u),this.boundsTree}function Zh(){this.boundsTree=null}class at{constructor(){R(this,"trigger",t=>{const e=this.handlers.slice(0);for(const n of e)n(t)}),R(this,"handlers",[])}add(t){this.handlers.push(t)}remove(t){this.handlers=this.handlers.filter(e=>e!==t)}reset(){this.handlers.length=0}}class vo{constructor(t){R(this,"isDisposeable",()=>"dispose"in this&&"onDisposed"in this),R(this,"isResizeable",()=>"resize"in this&&"getSize"in this),R(this,"isUpdateable",()=>"onAfterUpdate"in this&&"onBeforeUpdate"in this&&"update"in this),R(this,"isHideable",()=>"visible"in this),R(this,"isConfigurable",()=>"setup"in this&&"config"in this&&"onSetup"in this),this.components=t}}class re extends vo{}class So extends vo{constructor(t){super(t),R(this,"worlds",new Map),R(this,"onWorldChanged",new at),R(this,"currentWorld",null),this.onWorldChanged.add(({world:e,action:n})=>{n==="removed"&&this.worlds.delete(e.uuid)})}}class Qh extends So{constructor(){super(...arguments),R(this,"hasCameraControls",()=>"controls"in this)}}class $h extends So{constructor(){super(...arguments),R(this,"onAfterUpdate",new at),R(this,"onBeforeUpdate",new at),R(this,"onDisposed",new at),R(this,"onResize",new at),R(this,"onClippingPlanesUpdated",new at),R(this,"clippingPlanes",[])}updateClippingPlanes(){this.onClippingPlanesUpdated.trigger()}setPlane(t,e,n){e.isLocal=n;const s=this.clippingPlanes.indexOf(e);t&&s===-1?this.clippingPlanes.push(e):!t&&s>-1&&this.clippingPlanes.splice(s,1),this.three.clippingPlanes=this.clippingPlanes.filter(o=>!o.isLocal)}}const Fl=class ao extends re{constructor(t){super(t),R(this,"_disposedComponents",new Set),R(this,"enabled",!0),t.add(ao.uuid,this)}get(){return this._disposedComponents}destroy(t,e=!0,n=!0){t.removeFromParent();const s=t;s.dispose&&s.dispose(),this.disposeGeometryAndMaterials(t,e),n&&s.children&&s.children.length&&this.disposeChildren(s),t.children.length=0}disposeGeometry(t){const e=t;e.boundsTree&&e.disposeBoundsTree(),t.dispose()}disposeGeometryAndMaterials(t,e){const n=t;n.geometry&&this.disposeGeometry(n.geometry),e&&n.material&&ao.disposeMaterial(n),n.material=[],n.geometry=null}disposeChildren(t){for(const e of t.children)this.destroy(e)}static disposeMaterial(t){if(t.material)if(Array.isArray(t.material))for(const e of t.material)e.dispose();else t.material.dispose()}};R(Fl,"uuid","76e9cd8e-ad8f-4753-9ef6-cbc60f7247fe");let Qn=Fl;class Jh extends So{constructor(t){super(t),R(this,"onDisposed",new at)}dispose(){const t=this.components.get(Qn);for(const e of this.three.children){const n=e;n.geometry&&t.destroy(n)}this.three.children=[],this.onDisposed.trigger(),this.onDisposed.reset()}}const Bi=0,tu=1,eu=new q,La=new Me,zs=new zi,Ma=new q,Si=new zn;class nu{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new xa,this.unassigned=new xa,this.vertices=[]}setFromPoints(t){if(t.length>=4){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.vertices.push(new ru(t[e]));this.compute()}return this}setFromObject(t){const e=[];return t.updateMatrixWorld(!0),t.traverse(function(n){const s=n.geometry;if(s!==void 0){const o=s.attributes.position;if(o!==void 0)for(let a=0,c=o.count;a<c;a++){const h=new q;h.fromBufferAttribute(o,a).applyMatrix4(n.matrixWorld),e.push(h)}}}),this.setFromPoints(e)}containsPoint(t){const e=this.faces;for(let n=0,s=e.length;n<s;n++)if(e[n].distanceToPoint(t)>this.tolerance)return!1;return!0}intersectRay(t,e){const n=this.faces;let s=-1/0,o=1/0;for(let a=0,c=n.length;a<c;a++){const h=n[a],p=h.distanceToPoint(t.origin),C=h.normal.dot(t.direction);if(p>0&&C>=0)return null;const I=C!==0?-p/C:0;if(!(I<=0)&&(C>0?o=Math.min(I,o):s=Math.max(I,s),s>o))return null}return s!==-1/0?t.at(s,e):t.at(o,e),e}intersectsRay(t){return this.intersectRay(t,eu)!==null}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(t,e){return t.face=e,e.outside===null?this.assigned.append(t):this.assigned.insertBefore(e.outside,t),e.outside=t,this}removeVertexFromFace(t,e){return t===e.outside&&(t.next!==null&&t.next.face===e?e.outside=t.next:e.outside=null),this.assigned.remove(t),this}removeAllVerticesFromFace(t){if(t.outside!==null){const e=t.outside;let n=t.outside;for(;n.next!==null&&n.next.face===t;)n=n.next;return this.assigned.removeSubList(e,n),e.prev=n.next=null,t.outside=null,e}}deleteFaceVertices(t,e){const n=this.removeAllVerticesFromFace(t);if(n!==void 0)if(e===void 0)this.unassigned.appendChain(n);else{let s=n;do{const o=s.next;e.distanceToPoint(s.point)>this.tolerance?this.addVertexToFace(s,e):this.unassigned.append(s),s=o}while(s!==null)}return this}resolveUnassignedPoints(t){if(this.unassigned.isEmpty()===!1){let e=this.unassigned.first();do{const n=e.next;let s=this.tolerance,o=null;for(let a=0;a<t.length;a++){const c=t[a];if(c.mark===Bi){const h=c.distanceToPoint(e.point);if(h>s&&(s=h,o=c),s>1e3*this.tolerance)break}}o!==null&&this.addVertexToFace(e,o),e=n}while(e!==null)}return this}computeExtremes(){const t=new q,e=new q,n=[],s=[];for(let o=0;o<3;o++)n[o]=s[o]=this.vertices[0];t.copy(this.vertices[0].point),e.copy(this.vertices[0].point);for(let o=0,a=this.vertices.length;o<a;o++){const c=this.vertices[o],h=c.point;for(let p=0;p<3;p++)h.getComponent(p)<t.getComponent(p)&&(t.setComponent(p,h.getComponent(p)),n[p]=c);for(let p=0;p<3;p++)h.getComponent(p)>e.getComponent(p)&&(e.setComponent(p,h.getComponent(p)),s[p]=c)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(t.x),Math.abs(e.x))+Math.max(Math.abs(t.y),Math.abs(e.y))+Math.max(Math.abs(t.z),Math.abs(e.z))),{min:n,max:s}}computeInitialHull(){const t=this.vertices,e=this.computeExtremes(),n=e.min,s=e.max;let o=0,a=0;for(let f=0;f<3;f++){const T=s[f].point.getComponent(f)-n[f].point.getComponent(f);T>o&&(o=T,a=f)}const c=n[a],h=s[a];let p,C;o=0,La.set(c.point,h.point);for(let f=0,T=this.vertices.length;f<T;f++){const A=t[f];if(A!==c&&A!==h){La.closestPointToPoint(A.point,!0,Ma);const F=Ma.distanceToSquared(A.point);F>o&&(o=F,p=A)}}o=-1,zs.setFromCoplanarPoints(c.point,h.point,p.point);for(let f=0,T=this.vertices.length;f<T;f++){const A=t[f];if(A!==c&&A!==h&&A!==p){const F=Math.abs(zs.distanceToPoint(A.point));F>o&&(o=F,C=A)}}const I=[];if(zs.distanceToPoint(C.point)<0){I.push(ye.create(c,h,p),ye.create(C,h,c),ye.create(C,p,h),ye.create(C,c,p));for(let f=0;f<3;f++){const T=(f+1)%3;I[f+1].getEdge(2).setTwin(I[0].getEdge(T)),I[f+1].getEdge(1).setTwin(I[T+1].getEdge(0))}}else{I.push(ye.create(c,p,h),ye.create(C,c,h),ye.create(C,h,p),ye.create(C,p,c));for(let f=0;f<3;f++){const T=(f+1)%3;I[f+1].getEdge(2).setTwin(I[0].getEdge((3-f)%3)),I[f+1].getEdge(0).setTwin(I[T+1].getEdge(1))}}for(let f=0;f<4;f++)this.faces.push(I[f]);for(let f=0,T=t.length;f<T;f++){const A=t[f];if(A!==c&&A!==h&&A!==p&&A!==C){o=this.tolerance;let F=null;for(let _=0;_<4;_++){const w=this.faces[_].distanceToPoint(A.point);w>o&&(o=w,F=this.faces[_])}F!==null&&this.addVertexToFace(A,F)}}return this}reindexFaces(){const t=[];for(let e=0;e<this.faces.length;e++){const n=this.faces[e];n.mark===Bi&&t.push(n)}return this.faces=t,this}nextVertexToAdd(){if(this.assigned.isEmpty()===!1){let t,e=0;const n=this.assigned.first().face;let s=n.outside;do{const o=n.distanceToPoint(s.point);o>e&&(e=o,t=s),s=s.next}while(s!==null&&s.face===n);return t}}computeHorizon(t,e,n,s){this.deleteFaceVertices(n),n.mark=tu;let o;e===null?o=e=n.getEdge(0):o=e.next;do{const a=o.twin,c=a.face;c.mark===Bi&&(c.distanceToPoint(t)>this.tolerance?this.computeHorizon(t,a,c,s):s.push(o)),o=o.next}while(o!==e);return this}addAdjoiningFace(t,e){const n=ye.create(t,e.tail(),e.head());return this.faces.push(n),n.getEdge(-1).setTwin(e.twin),n.getEdge(0)}addNewFaces(t,e){this.newFaces=[];let n=null,s=null;for(let o=0;o<e.length;o++){const a=e[o],c=this.addAdjoiningFace(t,a);n===null?n=c:c.next.setTwin(s),this.newFaces.push(c.face),s=c}return n.next.setTwin(s),this}addVertexToHull(t){const e=[];return this.unassigned.clear(),this.removeVertexFromFace(t,t.face),this.computeHorizon(t.point,null,t.face,e),this.addNewFaces(t,e),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let t;for(this.computeInitialHull();(t=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(t);return this.reindexFaces(),this.cleanup(),this}}class ye{constructor(){this.normal=new q,this.midpoint=new q,this.area=0,this.constant=0,this.outside=null,this.mark=Bi,this.edge=null}static create(t,e,n){const s=new ye,o=new Hs(t,s),a=new Hs(e,s),c=new Hs(n,s);return o.next=c.prev=a,a.next=o.prev=c,c.next=a.prev=o,s.edge=o,s.compute()}getEdge(t){let e=this.edge;for(;t>0;)e=e.next,t--;for(;t<0;)e=e.prev,t++;return e}compute(){const t=this.edge.tail(),e=this.edge.head(),n=this.edge.next.head();return Si.set(t.point,e.point,n.point),Si.getNormal(this.normal),Si.getMidpoint(this.midpoint),this.area=Si.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(t){return this.normal.dot(t)-this.constant}}class Hs{constructor(t,e){this.vertex=t,this.prev=null,this.next=null,this.twin=null,this.face=e}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const t=this.head(),e=this.tail();return e!==null?e.point.distanceTo(t.point):-1}lengthSquared(){const t=this.head(),e=this.tail();return e!==null?e.point.distanceToSquared(t.point):-1}setTwin(t){return this.twin=t,t.twin=this,this}}class ru{constructor(t){this.point=t,this.prev=null,this.next=null,this.face=null}}class xa{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(t,e){return e.prev=t.prev,e.next=t,e.prev===null?this.head=e:e.prev.next=e,t.prev=e,this}insertAfter(t,e){return e.prev=t,e.next=t.next,e.next===null?this.tail=e:e.next.prev=e,t.next=e,this}append(t){return this.head===null?this.head=t:this.tail.next=t,t.prev=this.tail,t.next=null,this.tail=t,this}appendChain(t){for(this.head===null?this.head=t:this.tail.next=t,t.prev=this.tail;t.next!==null;)t=t.next;return this.tail=t,this}remove(t){return t.prev===null?this.head=t.next:t.prev.next=t.next,t.next===null?this.tail=t.prev:t.next.prev=t.prev,this}removeSubList(t,e){return t.prev===null?this.head=e.next:t.prev.next=e.next,e.next===null?this.tail=t.prev:e.next.prev=t.prev,this}isEmpty(){return this.head===null}}const lo=[2,2,1],co=[1,0,0];function Le(u,t){return u*3+t}function iu(u){const t=u.elements;let e=0;for(let n=0;n<9;n++)e+=t[n]*t[n];return Math.sqrt(e)}function su(u){const t=u.elements;let e=0;for(let n=0;n<3;n++){const s=t[Le(lo[n],co[n])];e+=2*s*s}return Math.sqrt(e)}function ou(u,t){let e=0,n=1;const s=u.elements;for(let p=0;p<3;p++){const C=Math.abs(s[Le(lo[p],co[p])]);C>e&&(e=C,n=p)}let o=1,a=0;const c=co[n],h=lo[n];if(Math.abs(s[Le(h,c)])>Number.EPSILON){const p=s[Le(h,h)],C=s[Le(c,c)],I=s[Le(h,c)],f=(p-C)/2/I;let T;f<0?T=-1/(-f+Math.sqrt(1+f*f)):T=1/(f+Math.sqrt(1+f*f)),o=1/Math.sqrt(1+T*T),a=T*o}return t.identity(),t.elements[Le(c,c)]=o,t.elements[Le(h,h)]=o,t.elements[Le(h,c)]=a,t.elements[Le(c,h)]=-a,t}function au(u,t){let e=0,n=0;const s=10;t.unitary.identity(),t.diagonal.copy(u);const o=t.unitary,a=t.diagonal,c=new mn,h=new mn,p=Number.EPSILON*iu(a);for(;n<s&&su(a)>p;)ou(a,c),h.copy(c).transpose(),a.multiply(c),a.premultiply(h),o.multiply(c),++e>2&&(n++,e=0);return t}function lu(u){const t=[];for(let Ut=0;Ut<u.length-2;Ut+=3){const ct=u[Ut],xt=u[Ut+1],Ie=u[Ut+2];t.push(new q(ct,xt,Ie))}const e=new nu;e.setFromPoints(t);const n={unitary:new mn,diagonal:new mn},s=e.faces,o=[],a=[];for(let Ut=0,ct=s.length;Ut<ct;Ut++){const xt=s[Ut];let Ie=xt.edge;o.length=0;do o.push(Ie),Ie=Ie.next;while(Ie!==xt.edge);const Ot=o.length-2;for(let Oe=1,Wi=Ot;Oe<=Wi;Oe++){const me=o[0].vertex,nr=o[Oe+0].vertex,rr=o[Oe+1].vertex;a.push(me.point.x,me.point.y,me.point.z),a.push(nr.point.x,nr.point.y,nr.point.z),a.push(rr.point.x,rr.point.y,rr.point.z)}}const c=new q,h=new q,p=new q,C=new q,I=new q,f=new q,T=new q,A=new q;let F=0,_=0,w=0,v=0,Y=0,y=0,L=0;for(let Ut=0,ct=a.length;Ut<ct;Ut+=9){c.fromArray(a,Ut),h.fromArray(a,Ut+3),p.fromArray(a,Ut+6),T.set(0,0,0),T.add(c).add(h).add(p).divideScalar(3),C.subVectors(h,c),I.subVectors(p,c);const xt=f.crossVectors(C,I).length()/2;A.add(f.copy(T).multiplyScalar(xt)),F+=xt,_+=(9*T.x*T.x+c.x*c.x+h.x*h.x+p.x*p.x)*(xt/12),w+=(9*T.x*T.y+c.x*c.y+h.x*h.y+p.x*p.y)*(xt/12),v+=(9*T.x*T.z+c.x*c.z+h.x*h.z+p.x*p.z)*(xt/12),Y+=(9*T.y*T.y+c.y*c.y+h.y*h.y+p.y*p.y)*(xt/12),y+=(9*T.y*T.z+c.y*c.z+h.y*h.z+p.y*p.z)*(xt/12),L+=(9*T.z*T.z+c.z*c.z+h.z*h.z+p.z*p.z)*(xt/12)}A.divideScalar(F),_/=F,w/=F,v/=F,Y/=F,y/=F,L/=F,_-=A.x*A.x,w-=A.x*A.y,v-=A.x*A.z,Y-=A.y*A.y,y-=A.y*A.z,L-=A.z*A.z;const k=new mn;k.elements[0]=_,k.elements[1]=w,k.elements[2]=v,k.elements[3]=w,k.elements[4]=Y,k.elements[5]=y,k.elements[6]=v,k.elements[7]=y,k.elements[8]=L,au(k,n);const V=n.unitary,H=new q,j=new q,Q=new q;V.extractBasis(H,j,Q);let J=-1/0,$=-1/0,nt=-1/0,ut=1/0,It=1/0,yt=1/0;for(let Ut=0,ct=t.length;Ut<ct;Ut++){const xt=t[Ut];J=Math.max(H.dot(xt),J),$=Math.max(j.dot(xt),$),nt=Math.max(Q.dot(xt),nt),ut=Math.min(H.dot(xt),ut),It=Math.min(j.dot(xt),It),yt=Math.min(Q.dot(xt),yt)}H.multiplyScalar(.5*(ut+J)),j.multiplyScalar(.5*(It+$)),Q.multiplyScalar(.5*(yt+nt));const kt=new q,Rt=new q,Jt=new mn;kt.add(H).add(j).add(Q),Rt.x=J-ut,Rt.y=$-It,Rt.z=nt-yt,Rt.multiplyScalar(.5),Jt.copy(V);const{x:Kt,y:fe,z:Tn}=Rt,le=new Mt;le.makeScale(Kt*2,fe*2,Tn*2);const er=new Mt;er.makeTranslation(-Kt,-fe,-Tn);const rn=new Mt;rn.makeTranslation(kt.x,kt.y,kt.z);const xe=new Mt;xe.setFromMatrix3(Jt);const De=new Mt;return De.multiply(rn),De.multiply(xe),De.multiply(er),De.multiply(le),{center:kt,halfSizes:Rt,rotation:Jt,transformation:De}}function cu(u,t,e){const n=[u[0]-t[0],u[1]-t[1],u[2]-t[2]];return e[0]*n[0]+e[1]*n[1]+e[2]*n[2]>0}class Da{static isTransparent(t){return t.transparent&&t.opacity<1}}const ho=class Ht{static create(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return`${Ht._lut[t&255]+Ht._lut[t>>8&255]+Ht._lut[t>>16&255]+Ht._lut[t>>24&255]}-${Ht._lut[e&255]}${Ht._lut[e>>8&255]}-${Ht._lut[e>>16&15|64]}${Ht._lut[e>>24&255]}-${Ht._lut[n&63|128]}${Ht._lut[n>>8&255]}-${Ht._lut[n>>16&255]}${Ht._lut[n>>24&255]}${Ht._lut[s&255]}${Ht._lut[s>>8&255]}${Ht._lut[s>>16&255]}${Ht._lut[s>>24&255]}`.toLowerCase()}static validate(t){if(!Ht._pattern.test(t))throw new Error(`${t} is not a valid UUID v4.

- If you're the tool creator, you can take one from https://www.uuidgenerator.net/.

- If you're using a platform tool, verify the uuid isn't misspelled or contact the tool creator.`)}};R(ho,"_pattern",/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/),R(ho,"_lut",["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"]);let Po=ho;const _l=class Ol{constructor(){R(this,"onDisposed",new at),R(this,"list",new Map),R(this,"enabled",!1),R(this,"_clock"),R(this,"update",()=>{if(!this.enabled)return;const t=this._clock.getDelta();for(const[e,n]of this.list)n.enabled&&n.isUpdateable()&&n.update(t);requestAnimationFrame(this.update)}),this._clock=new vc,Ol.setupBVH()}add(t,e){if(this.list.has(t))throw new Error("You're trying to add a component that already exists in the components intance. Use Components.get() instead.");Po.validate(t),this.list.set(t,e)}get(t){const e=t.uuid;if(!this.list.has(e)){const n=new t(this);return this.list.has(e)||this.add(e,n),n}return this.list.get(e)}init(){this.enabled=!0,this._clock.start(),this.update()}dispose(){this.enabled=!1;for(const[t,e]of this.list)e.enabled=!1,e.isDisposeable()&&e.dispose();this._clock.stop(),this.onDisposed.trigger(),this.onDisposed.reset()}static setupBVH(){Wn.prototype.computeBoundsTree=qh,Wn.prototype.disposeBoundsTree=Zh,lt.prototype.raycast=jh}};R(_l,"release","1.4.21");let wl=_l;class hu{constructor(t){R(this,"_event"),R(this,"_position",new Fe),R(this,"onDisposed",new at),R(this,"updateMouseInfo",e=>{this._event=e}),this.dom=t,this.setupEvents(!0)}get position(){if(this._event){const t=this.dom.getBoundingClientRect();this._position.x=this.getPositionX(t,this._event),this._position.y=this.getPositionY(t,this._event)}return this._position}dispose(){this.setupEvents(!1),this.onDisposed.trigger(),this.onDisposed.reset()}getPositionY(t,e){return-((e.clientY-t.top)/(t.bottom-t.top))*2+1}getPositionX(t,e){return(e.clientX-t.left)/(t.right-t.left)*2-1}setupEvents(t){t?this.dom.addEventListener("mousemove",this.updateMouseInfo):this.dom.removeEventListener("mousemove",this.updateMouseInfo)}}class uu{constructor(t,e){R(this,"enabled",!0),R(this,"components"),R(this,"onDisposed",new at),R(this,"mouse"),R(this,"three",new go),R(this,"world");const n=e.renderer;if(!n)throw new Error("A renderer is needed for the raycaster to work!");this.world=e,this.mouse=new hu(n.three.domElement),this.components=t}dispose(){this.mouse.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}castRay(t=Array.from(this.world.meshes)){if(!this.world)throw new Error("A world is needed to cast rays!");const e=this.world.camera.three;return this.three.setFromCamera(this.mouse.position,e),this.intersect(t)}castRayFromVector(t,e,n=Array.from(this.world.meshes)){return this.three.set(t,e),this.intersect(n)}intersect(t=Array.from(this.world.meshes)){const e=this.three.intersectObjects(t),n=this.filterClippingPlanes(e);return n.length>0?n[0]:null}filterClippingPlanes(t){if(!this.world.renderer)throw new Error("Renderer not found!");const e=this.world.renderer.three;if(!e.clippingPlanes)return t;const n=e.clippingPlanes;return t.length<=0||!n||(n==null?void 0:n.length)<=0?t:t.filter(s=>n.every(o=>o.distanceToPoint(s.point)>0))}}const vl=class Sl extends re{constructor(t){super(t),R(this,"enabled",!0),R(this,"list",new Map),R(this,"onDisposed",new at),t.add(Sl.uuid,this)}get(t){if(this.list.has(t.uuid))return this.list.get(t.uuid);const e=new uu(this.components,t);return this.list.set(t.uuid,e),t.onDisposed.add(()=>{this.delete(t)}),e}delete(t){const e=this.list.get(t.uuid);e&&e.dispose(),this.list.delete(t.uuid)}dispose(){for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger()}};R(vl,"uuid","d5d8bdf0-db25-4952-b951-b643af207ace");let Ua=vl;class du extends vo{constructor(t){super(t),R(this,"meshes",new Set),R(this,"onAfterUpdate",new at),R(this,"onBeforeUpdate",new at),R(this,"enabled",!0),R(this,"uuid",Po.create()),R(this,"onDisposed",new at),R(this,"_scene"),R(this,"_camera"),R(this,"_renderer",null)}get scene(){if(!this._scene)throw new Error("No scene initialized!");return this._scene}set scene(t){this._scene=t,t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"})}get camera(){if(!this._camera)throw new Error("No camera initialized!");return this._camera}set camera(t){this._camera=t,t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"})}get renderer(){return this._renderer}set renderer(t){this._renderer=t,t&&(t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"}))}update(t){this.enabled&&(!this._scene||!this._camera||(this.scene.currentWorld=this,this.camera.currentWorld=this,this.renderer&&(this.renderer.currentWorld=this),this.onBeforeUpdate.trigger(),this.scene.isUpdateable()&&this.scene.update(t),this.camera.isUpdateable()&&this.camera.update(t),this.renderer&&this.renderer.update(t),this.onAfterUpdate.trigger()))}dispose(t=!0){if(this.enabled=!1,this.scene.onWorldChanged.trigger({world:this,action:"removed"}),this.camera.onWorldChanged.trigger({world:this,action:"removed"}),this.renderer&&this.renderer.onWorldChanged.trigger({world:this,action:"removed"}),t){const e=this.components.get(Qn);this.scene.dispose(),this.camera.isDisposeable()&&this.camera.dispose(),this.renderer&&this.renderer.dispose();for(const n of this.meshes)e.destroy(n);this.meshes.clear()}this._scene=null,this._camera=null,this._renderer=null,this.onDisposed.trigger()}}class pu extends Jh{constructor(t){super(t),R(this,"isSetup",!1),R(this,"three"),R(this,"onSetup",new at),R(this,"config",{directionalLight:{color:new Kn("white"),intensity:1.5,position:new q(5,10,3)},ambientLight:{color:new Kn("white"),intensity:1}}),this.three=new Mr,this.three.background=new Kn(2107698)}setup(t){this.config={...this.config,...t};const e=new Rc(this.config.directionalLight.color,this.config.directionalLight.intensity);e.position.copy(this.config.directionalLight.position);const n=new Ac(this.config.ambientLight.color,this.config.ambientLight.intensity);this.three.add(e,n),this.isSetup=!0,this.onSetup.trigger(this)}}class Eu extends $h{constructor(t,e,n){super(t),R(this,"enabled",!0),R(this,"container"),R(this,"three"),R(this,"_canvas"),R(this,"_parameters"),R(this,"onContainerUpdated",new at),R(this,"resize",a=>{if(this.updateContainer(),!this.container)return;const c=a?a.x:this.container.clientWidth,h=a?a.y:this.container.clientHeight;this.three.setSize(c,h),this.onResize.trigger(new Fe(c,h))}),R(this,"resizeEvent",()=>{this.resize()}),R(this,"onContextLost",a=>{a.preventDefault(),this.components.enabled=!1}),R(this,"onContextBack",()=>{this.three.setRenderTarget(null),this.three.dispose(),this.three=new Js({canvas:this._canvas,antialias:!0,alpha:!0,...this._parameters}),this.components.enabled=!0}),this.container=e||null,this._parameters=n,this.three=new Js({antialias:!0,alpha:!0,...n}),this.three.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.setupRenderer(),this.setupEvents(!0),this.resize(),this._canvas=this.three.domElement;const s=this.three.getContext(),{canvas:o}=s;o.addEventListener("webglcontextlost",this.onContextLost,!1),o.addEventListener("webglcontextrestored",this.onContextBack,!1)}update(){if(!this.enabled||!this.currentWorld)return;this.onBeforeUpdate.trigger(this);const t=this.currentWorld.scene.three,e=this.currentWorld.camera.three;this.three.render(t,e),this.onAfterUpdate.trigger(this)}dispose(){this.enabled=!1,this.setupEvents(!1),this.three.domElement.remove(),this.three.dispose(),this.onResize.reset(),this.onAfterUpdate.reset(),this.onBeforeUpdate.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}getSize(){return new Fe(this.three.domElement.clientWidth,this.three.domElement.clientHeight)}setupEvents(t){const e=this.three.domElement;t?e.addEventListener("resize",this.resizeEvent):e.removeEventListener("resize",this.resizeEvent)}setupRenderer(){this.three.localClippingEnabled=!0,this.container&&this.container.appendChild(this.three.domElement),this.updateContainer()}updateContainer(){if(!this.container){const t=this.three.domElement.parentElement;t&&(this.container=t,this.onContainerUpdated.trigger(t))}}}/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const Et={LEFT:1,RIGHT:2,MIDDLE:4},X=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),Un={NONE:0,IN:1,OUT:-1};function pn(u){return u.isPerspectiveCamera}function Je(u){return u.isOrthographicCamera}const Bn=Math.PI*2,Ba=Math.PI/2,Pl=1e-5,Fr=Math.PI/180;function ge(u,t,e){return Math.max(t,Math.min(e,u))}function St(u,t=Pl){return Math.abs(u)<t}function wt(u,t,e=Pl){return St(u-t,e)}function Ya(u,t){return Math.round(u/t)*t}function _r(u){return isFinite(u)?u:u<0?-Number.MAX_VALUE:Number.MAX_VALUE}function Or(u){return Math.abs(u)<Number.MAX_VALUE?u:u*(1/0)}function Pi(u,t,e,n,s=1/0,o){n=Math.max(1e-4,n);const a=2/n,c=a*o,h=1/(1+c+.48*c*c+.235*c*c*c);let p=u-t;const C=t,I=s*n;p=ge(p,-I,I),t=u-p;const f=(e.value+a*p)*o;e.value=(e.value-a*f)*h;let T=t+(p+f)*h;return C-u>0==T>C&&(T=C,e.value=(T-C)/o),T}function ka(u,t,e,n,s=1/0,o,a){n=Math.max(1e-4,n);const c=2/n,h=c*o,p=1/(1+h+.48*h*h+.235*h*h*h);let C=t.x,I=t.y,f=t.z,T=u.x-C,A=u.y-I,F=u.z-f;const _=C,w=I,v=f,Y=s*n,y=Y*Y,L=T*T+A*A+F*F;if(L>y){const It=Math.sqrt(L);T=T/It*Y,A=A/It*Y,F=F/It*Y}C=u.x-T,I=u.y-A,f=u.z-F;const k=(e.x+c*T)*o,V=(e.y+c*A)*o,H=(e.z+c*F)*o;e.x=(e.x-c*k)*p,e.y=(e.y-c*V)*p,e.z=(e.z-c*H)*p,a.x=C+(T+k)*p,a.y=I+(A+V)*p,a.z=f+(F+H)*p;const j=_-u.x,Q=w-u.y,J=v-u.z,$=a.x-_,nt=a.y-w,ut=a.z-v;return j*$+Q*nt+J*ut>0&&(a.x=_,a.y=w,a.z=v,e.x=(a.x-_)/o,e.y=(a.y-w)/o,e.z=(a.z-v)/o),a}function Ks(u,t){t.set(0,0),u.forEach(e=>{t.x+=e.clientX,t.y+=e.clientY}),t.x/=u.length,t.y/=u.length}function Ws(u,t){return Je(u)?(console.warn(`${t} is not supported in OrthographicCamera`),!0):!1}class fu{constructor(){this._listeners={}}addEventListener(t,e){const n=this._listeners;n[t]===void 0&&(n[t]=[]),n[t].indexOf(e)===-1&&n[t].push(e)}hasEventListener(t,e){const n=this._listeners;return n[t]!==void 0&&n[t].indexOf(e)!==-1}removeEventListener(t,e){const n=this._listeners[t];if(n!==void 0){const s=n.indexOf(e);s!==-1&&n.splice(s,1)}}removeAllEventListeners(t){if(!t){this._listeners={};return}Array.isArray(this._listeners[t])&&(this._listeners[t].length=0)}dispatchEvent(t){const e=this._listeners[t.type];if(e!==void 0){t.target=this;const n=e.slice(0);for(let s=0,o=n.length;s<o;s++)n[s].call(this,t)}}}const Iu="2.7.3",bi=1/8,bl=typeof window<"u",mu=bl&&/Mac/.test(navigator.platform),Cu=!(bl&&"PointerEvent"in window);let dt,Ga,Ni,Xs,ie,ft,Ft,Yn,wr,Pe,be,En,Va,za,he,vr,kn,Ha,js,Ka,qs,Zs,Li;class Dr extends fu{static install(t){dt=t.THREE,Ga=Object.freeze(new dt.Vector3(0,0,0)),Ni=Object.freeze(new dt.Vector3(0,1,0)),Xs=Object.freeze(new dt.Vector3(0,0,1)),ie=new dt.Vector2,ft=new dt.Vector3,Ft=new dt.Vector3,Yn=new dt.Vector3,wr=new dt.Vector3,Pe=new dt.Vector3,be=new dt.Vector3,En=new dt.Vector3,Va=new dt.Vector3,za=new dt.Vector3,he=new dt.Spherical,vr=new dt.Spherical,kn=new dt.Box3,Ha=new dt.Box3,js=new dt.Sphere,Ka=new dt.Quaternion,qs=new dt.Quaternion,Zs=new dt.Matrix4,Li=new dt.Raycaster}static get ACTION(){return X}constructor(t,e){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=X.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=Un.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new dt.Vector3,this._focalOffsetVelocity=new dt.Vector3,this._zoomVelocity={value:0},this._truckInternal=(y,L,k)=>{let V,H;if(pn(this._camera)){const j=ft.copy(this._camera.position).sub(this._target),Q=this._camera.getEffectiveFOV()*Fr,J=j.length()*Math.tan(Q*.5);V=this.truckSpeed*y*J/this._elementRect.height,H=this.truckSpeed*L*J/this._elementRect.height}else if(Je(this._camera)){const j=this._camera;V=y*(j.right-j.left)/j.zoom/this._elementRect.width,H=L*(j.top-j.bottom)/j.zoom/this._elementRect.height}else return;this.verticalDragToForward?(k?this.setFocalOffset(this._focalOffsetEnd.x+V,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(V,0,!0),this.forward(-H,!0)):k?this.setFocalOffset(this._focalOffsetEnd.x+V,this._focalOffsetEnd.y+H,this._focalOffsetEnd.z,!0):this.truck(V,H,!0)},this._rotateInternal=(y,L)=>{const k=Bn*this.azimuthRotateSpeed*y/this._elementRect.height,V=Bn*this.polarRotateSpeed*L/this._elementRect.height;this.rotate(k,V,!0)},this._dollyInternal=(y,L,k)=>{const V=Math.pow(.95,-y*this.dollySpeed),H=this._sphericalEnd.radius,j=this._sphericalEnd.radius*V,Q=ge(j,this.minDistance,this.maxDistance),J=Q-j;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(j,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(J,!0),this._dollyToNoClamp(Q,!0)):this._dollyToNoClamp(Q,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?j:Q)-H,this._dollyControlCoord.set(L,k)),this._lastDollyDirection=Math.sign(-y)},this._zoomInternal=(y,L,k)=>{const V=Math.pow(.95,y*this.dollySpeed),H=this._zoom,j=this._zoom*V;this.zoomTo(j,!0),this.dollyToCursor&&(this._changedZoom+=j-H,this._dollyControlCoord.set(L,k))},typeof dt>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=t,this._yAxisUpSpace=new dt.Quaternion().setFromUnitVectors(this._camera.up,Ni),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=X.NONE,this._target=new dt.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new dt.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new dt.Spherical().setFromVector3(ft.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new dt.Vector3,new dt.Vector3,new dt.Vector3,new dt.Vector3],this._updateNearPlaneCorners(),this._boundary=new dt.Box3(new dt.Vector3(-1/0,-1/0,-1/0),new dt.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new dt.Vector2,this.mouseButtons={left:X.ROTATE,middle:X.DOLLY,right:X.TRUCK,wheel:pn(this._camera)?X.DOLLY:Je(this._camera)?X.ZOOM:X.NONE},this.touches={one:X.TOUCH_ROTATE,two:pn(this._camera)?X.TOUCH_DOLLY_TRUCK:Je(this._camera)?X.TOUCH_ZOOM_TRUCK:X.NONE,three:X.TOUCH_TRUCK};const n=new dt.Vector2,s=new dt.Vector2,o=new dt.Vector2,a=y=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const V=this._domElement.getBoundingClientRect(),H=y.clientX/V.width,j=y.clientY/V.height;if(H<this._interactiveArea.left||H>this._interactiveArea.right||j<this._interactiveArea.top||j>this._interactiveArea.bottom)return}const L=y.pointerType!=="mouse"?null:(y.buttons&Et.LEFT)===Et.LEFT?Et.LEFT:(y.buttons&Et.MIDDLE)===Et.MIDDLE?Et.MIDDLE:(y.buttons&Et.RIGHT)===Et.RIGHT?Et.RIGHT:null;if(L!==null){const V=this._findPointerByMouseButton(L);V&&this._disposePointer(V)}if((y.buttons&Et.LEFT)===Et.LEFT&&this._lockedPointer)return;const k={pointerId:y.pointerId,clientX:y.clientX,clientY:y.clientY,deltaX:0,deltaY:0,mouseButton:L};this._activePointers.push(k),this._domElement.ownerDocument.removeEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",C),this._domElement.ownerDocument.addEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",C),this._isDragging=!0,F(y)},c=y=>{if(!this._enabled||!this._domElement||this._lockedPointer)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const V=this._domElement.getBoundingClientRect(),H=y.clientX/V.width,j=y.clientY/V.height;if(H<this._interactiveArea.left||H>this._interactiveArea.right||j<this._interactiveArea.top||j>this._interactiveArea.bottom)return}const L=(y.buttons&Et.LEFT)===Et.LEFT?Et.LEFT:(y.buttons&Et.MIDDLE)===Et.MIDDLE?Et.MIDDLE:(y.buttons&Et.RIGHT)===Et.RIGHT?Et.RIGHT:null;if(L!==null){const V=this._findPointerByMouseButton(L);V&&this._disposePointer(V)}const k={pointerId:1,clientX:y.clientX,clientY:y.clientY,deltaX:0,deltaY:0,mouseButton:(y.buttons&Et.LEFT)===Et.LEFT?Et.LEFT:(y.buttons&Et.MIDDLE)===Et.LEFT?Et.MIDDLE:(y.buttons&Et.RIGHT)===Et.LEFT?Et.RIGHT:null};this._activePointers.push(k),this._domElement.ownerDocument.removeEventListener("mousemove",p),this._domElement.ownerDocument.removeEventListener("mouseup",I),this._domElement.ownerDocument.addEventListener("mousemove",p),this._domElement.ownerDocument.addEventListener("mouseup",I),this._isDragging=!0,F(y)},h=y=>{y.cancelable&&y.preventDefault();const L=y.pointerId,k=this._lockedPointer||this._findPointerById(L);if(k){if(k.clientX=y.clientX,k.clientY=y.clientY,k.deltaX=y.movementX,k.deltaY=y.movementY,this._state=0,y.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(y.buttons&Et.LEFT)===Et.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(y.buttons&Et.MIDDLE)===Et.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(y.buttons&Et.RIGHT)===Et.RIGHT&&(this._state=this._state|this.mouseButtons.right);_()}},p=y=>{const L=this._lockedPointer||this._findPointerById(1);L&&(L.clientX=y.clientX,L.clientY=y.clientY,L.deltaX=y.movementX,L.deltaY=y.movementY,this._state=0,(this._lockedPointer||(y.buttons&Et.LEFT)===Et.LEFT)&&(this._state=this._state|this.mouseButtons.left),(y.buttons&Et.MIDDLE)===Et.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(y.buttons&Et.RIGHT)===Et.RIGHT&&(this._state=this._state|this.mouseButtons.right),_())},C=y=>{const L=this._findPointerById(y.pointerId);if(!(L&&L===this._lockedPointer)){if(L&&this._disposePointer(L),y.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=X.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=X.NONE;w()}},I=()=>{const y=this._findPointerById(1);y&&y===this._lockedPointer||(y&&this._disposePointer(y),this._state=X.NONE,w())};let f=-1;const T=y=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===X.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const j=this._domElement.getBoundingClientRect(),Q=y.clientX/j.width,J=y.clientY/j.height;if(Q<this._interactiveArea.left||Q>this._interactiveArea.right||J<this._interactiveArea.top||J>this._interactiveArea.bottom)return}if(y.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===X.ROTATE||this.mouseButtons.wheel===X.TRUCK){const j=performance.now();f-j<1e3&&this._getClientRect(this._elementRect),f=j}const L=mu?-1:-3,k=y.deltaMode===1?y.deltaY/L:y.deltaY/(L*10),V=this.dollyToCursor?(y.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,H=this.dollyToCursor?(y.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case X.ROTATE:{this._rotateInternal(y.deltaX,y.deltaY),this._isUserControllingRotate=!0;break}case X.TRUCK:{this._truckInternal(y.deltaX,y.deltaY,!1),this._isUserControllingTruck=!0;break}case X.OFFSET:{this._truckInternal(y.deltaX,y.deltaY,!0),this._isUserControllingOffset=!0;break}case X.DOLLY:{this._dollyInternal(-k,V,H),this._isUserControllingDolly=!0;break}case X.ZOOM:{this._zoomInternal(-k,V,H),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},A=y=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===Dr.ACTION.NONE){const L=y instanceof PointerEvent?y.pointerId:0,k=this._findPointerById(L);k&&this._disposePointer(k),this._domElement.ownerDocument.removeEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",C),this._domElement.ownerDocument.removeEventListener("mousemove",p),this._domElement.ownerDocument.removeEventListener("mouseup",I);return}y.preventDefault()}},F=y=>{if(this._enabled){if(Ks(this._activePointers,ie),this._getClientRect(this._elementRect),n.copy(ie),s.copy(ie),this._activePointers.length>=2){const L=ie.x-this._activePointers[1].clientX,k=ie.y-this._activePointers[1].clientY,V=Math.sqrt(L*L+k*k);o.set(0,V);const H=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,j=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;s.set(H,j)}if(this._state=0,!y)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in y&&y.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(y.buttons&Et.LEFT)===Et.LEFT&&(this._state=this._state|this.mouseButtons.left),(y.buttons&Et.MIDDLE)===Et.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(y.buttons&Et.RIGHT)===Et.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&X.ROTATE)===X.ROTATE||(this._state&X.TOUCH_ROTATE)===X.TOUCH_ROTATE||(this._state&X.TOUCH_DOLLY_ROTATE)===X.TOUCH_DOLLY_ROTATE||(this._state&X.TOUCH_ZOOM_ROTATE)===X.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&X.TRUCK)===X.TRUCK||(this._state&X.TOUCH_TRUCK)===X.TOUCH_TRUCK||(this._state&X.TOUCH_DOLLY_TRUCK)===X.TOUCH_DOLLY_TRUCK||(this._state&X.TOUCH_ZOOM_TRUCK)===X.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&X.DOLLY)===X.DOLLY||(this._state&X.TOUCH_DOLLY)===X.TOUCH_DOLLY||(this._state&X.TOUCH_DOLLY_TRUCK)===X.TOUCH_DOLLY_TRUCK||(this._state&X.TOUCH_DOLLY_OFFSET)===X.TOUCH_DOLLY_OFFSET||(this._state&X.TOUCH_DOLLY_ROTATE)===X.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&X.ZOOM)===X.ZOOM||(this._state&X.TOUCH_ZOOM)===X.TOUCH_ZOOM||(this._state&X.TOUCH_ZOOM_TRUCK)===X.TOUCH_ZOOM_TRUCK||(this._state&X.TOUCH_ZOOM_OFFSET)===X.TOUCH_ZOOM_OFFSET||(this._state&X.TOUCH_ZOOM_ROTATE)===X.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&X.OFFSET)===X.OFFSET||(this._state&X.TOUCH_OFFSET)===X.TOUCH_OFFSET||(this._state&X.TOUCH_DOLLY_OFFSET)===X.TOUCH_DOLLY_OFFSET||(this._state&X.TOUCH_ZOOM_OFFSET)===X.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})}},_=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,Ks(this._activePointers,ie);const y=this._domElement&&document.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,L=y?-y.deltaX:s.x-ie.x,k=y?-y.deltaY:s.y-ie.y;if(s.copy(ie),((this._state&X.ROTATE)===X.ROTATE||(this._state&X.TOUCH_ROTATE)===X.TOUCH_ROTATE||(this._state&X.TOUCH_DOLLY_ROTATE)===X.TOUCH_DOLLY_ROTATE||(this._state&X.TOUCH_ZOOM_ROTATE)===X.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(L,k),this._isUserControllingRotate=!0),(this._state&X.DOLLY)===X.DOLLY||(this._state&X.ZOOM)===X.ZOOM){const V=this.dollyToCursor?(n.x-this._elementRect.x)/this._elementRect.width*2-1:0,H=this.dollyToCursor?(n.y-this._elementRect.y)/this._elementRect.height*-2+1:0,j=this.dollyDragInverted?-1:1;(this._state&X.DOLLY)===X.DOLLY?(this._dollyInternal(j*k*bi,V,H),this._isUserControllingDolly=!0):(this._zoomInternal(j*k*bi,V,H),this._isUserControllingZoom=!0)}if((this._state&X.TOUCH_DOLLY)===X.TOUCH_DOLLY||(this._state&X.TOUCH_ZOOM)===X.TOUCH_ZOOM||(this._state&X.TOUCH_DOLLY_TRUCK)===X.TOUCH_DOLLY_TRUCK||(this._state&X.TOUCH_ZOOM_TRUCK)===X.TOUCH_ZOOM_TRUCK||(this._state&X.TOUCH_DOLLY_OFFSET)===X.TOUCH_DOLLY_OFFSET||(this._state&X.TOUCH_ZOOM_OFFSET)===X.TOUCH_ZOOM_OFFSET||(this._state&X.TOUCH_DOLLY_ROTATE)===X.TOUCH_DOLLY_ROTATE||(this._state&X.TOUCH_ZOOM_ROTATE)===X.TOUCH_ZOOM_ROTATE){const V=ie.x-this._activePointers[1].clientX,H=ie.y-this._activePointers[1].clientY,j=Math.sqrt(V*V+H*H),Q=o.y-j;o.set(0,j);const J=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,$=this.dollyToCursor?(s.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&X.TOUCH_DOLLY)===X.TOUCH_DOLLY||(this._state&X.TOUCH_DOLLY_ROTATE)===X.TOUCH_DOLLY_ROTATE||(this._state&X.TOUCH_DOLLY_TRUCK)===X.TOUCH_DOLLY_TRUCK||(this._state&X.TOUCH_DOLLY_OFFSET)===X.TOUCH_DOLLY_OFFSET?(this._dollyInternal(Q*bi,J,$),this._isUserControllingDolly=!0):(this._zoomInternal(Q*bi,J,$),this._isUserControllingZoom=!0)}((this._state&X.TRUCK)===X.TRUCK||(this._state&X.TOUCH_TRUCK)===X.TOUCH_TRUCK||(this._state&X.TOUCH_DOLLY_TRUCK)===X.TOUCH_DOLLY_TRUCK||(this._state&X.TOUCH_ZOOM_TRUCK)===X.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(L,k,!1),this._isUserControllingTruck=!0),((this._state&X.OFFSET)===X.OFFSET||(this._state&X.TOUCH_OFFSET)===X.TOUCH_OFFSET||(this._state&X.TOUCH_DOLLY_OFFSET)===X.TOUCH_DOLLY_OFFSET||(this._state&X.TOUCH_ZOOM_OFFSET)===X.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(L,k,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},w=()=>{Ks(this._activePointers,ie),s.copy(ie),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",p),this._domElement.ownerDocument.removeEventListener("pointerup",C),this._domElement.ownerDocument.removeEventListener("mouseup",I),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",C),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",v),this._domElement.ownerDocument.addEventListener("pointerlockerror",Y),this._domElement.ownerDocument.addEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",C),F())},this.unlockPointer=()=>{this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),document.exitPointerLock(),this.cancel(),this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointerlockchange",v),this._domElement.ownerDocument.removeEventListener("pointerlockerror",Y))};const v=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},Y=()=>{this.unlockPointer()};this._addAllEventListeners=y=>{this._domElement=y,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",a),Cu&&this._domElement.addEventListener("mousedown",c),this._domElement.addEventListener("pointercancel",C),this._domElement.addEventListener("wheel",T,{passive:!1}),this._domElement.addEventListener("contextmenu",A)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",a),this._domElement.removeEventListener("mousedown",c),this._domElement.removeEventListener("pointercancel",C),this._domElement.removeEventListener("wheel",T,{passive:!1}),this._domElement.removeEventListener("contextmenu",A),this._domElement.ownerDocument.removeEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",p),this._domElement.ownerDocument.removeEventListener("pointerup",C),this._domElement.ownerDocument.removeEventListener("mouseup",I),this._domElement.ownerDocument.removeEventListener("pointerlockchange",v),this._domElement.ownerDocument.removeEventListener("pointerlockerror",Y))},this.cancel=()=>{this._state!==X.NONE&&(this._state=X.NONE,this._activePointers.length=0,w())},e&&this.connect(e),this.update(0)}get camera(){return this._camera}set camera(t){this._camera=t,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._domElement&&(t?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(t){this._spherical.radius===t&&this._sphericalEnd.radius===t||(this._spherical.radius=t,this._sphericalEnd.radius=t,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(t){this._spherical.theta===t&&this._sphericalEnd.theta===t||(this._spherical.theta=t,this._sphericalEnd.theta=t,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(t){this._spherical.phi===t&&this._sphericalEnd.phi===t||(this._spherical.phi=t,this._sphericalEnd.phi=t,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(t){this._boundaryEnclosesCamera=t,this._needsUpdate=!0}set interactiveArea(t){this._interactiveArea.width=ge(t.width,0,1),this._interactiveArea.height=ge(t.height,0,1),this._interactiveArea.x=ge(t.x,0,1-this._interactiveArea.width),this._interactiveArea.y=ge(t.y,0,1-this._interactiveArea.height)}addEventListener(t,e){super.addEventListener(t,e)}removeEventListener(t,e){super.removeEventListener(t,e)}rotate(t,e,n=!1){return this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+e,n)}rotateAzimuthTo(t,e=!1){return this.rotateTo(t,this._sphericalEnd.phi,e)}rotatePolarTo(t,e=!1){return this.rotateTo(this._sphericalEnd.theta,t,e)}rotateTo(t,e,n=!1){this._isUserControllingRotate=!1;const s=ge(t,this.minAzimuthAngle,this.maxAzimuthAngle),o=ge(e,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=s,this._sphericalEnd.phi=o,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,n||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const a=!n||wt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&wt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(a)}dolly(t,e=!1){return this.dollyTo(this._sphericalEnd.radius-t,e)}dollyTo(t,e=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=Un.NONE,this._changedDolly=0,this._dollyToNoClamp(ge(t,this.minDistance,this.maxDistance),e)}_dollyToNoClamp(t,e=!1){const n=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const o=this._collisionTest(),a=wt(o,this._spherical.radius);if(!(n>t)&&a)return Promise.resolve();this._sphericalEnd.radius=Math.min(t,o)}else this._sphericalEnd.radius=t;this._needsUpdate=!0,e||(this._spherical.radius=this._sphericalEnd.radius);const s=!e||wt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(s)}dollyInFixed(t,e=!1){this._targetEnd.add(this._getCameraDirection(wr).multiplyScalar(t)),e||this._target.copy(this._targetEnd);const n=!e||wt(this._target.x,this._targetEnd.x,this.restThreshold)&&wt(this._target.y,this._targetEnd.y,this.restThreshold)&&wt(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}zoom(t,e=!1){return this.zoomTo(this._zoomEnd+t,e)}zoomTo(t,e=!1){this._isUserControllingZoom=!1,this._zoomEnd=ge(t,this.minZoom,this.maxZoom),this._needsUpdate=!0,e||(this._zoom=this._zoomEnd);const n=!e||wt(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(n)}pan(t,e,n=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(t,e,n)}truck(t,e,n=!1){this._camera.updateMatrix(),Pe.setFromMatrixColumn(this._camera.matrix,0),be.setFromMatrixColumn(this._camera.matrix,1),Pe.multiplyScalar(t),be.multiplyScalar(-e);const s=ft.copy(Pe).add(be),o=Ft.copy(this._targetEnd).add(s);return this.moveTo(o.x,o.y,o.z,n)}forward(t,e=!1){ft.setFromMatrixColumn(this._camera.matrix,0),ft.crossVectors(this._camera.up,ft),ft.multiplyScalar(t);const n=Ft.copy(this._targetEnd).add(ft);return this.moveTo(n.x,n.y,n.z,e)}elevate(t,e=!1){return ft.copy(this._camera.up).multiplyScalar(t),this.moveTo(this._targetEnd.x+ft.x,this._targetEnd.y+ft.y,this._targetEnd.z+ft.z,e)}moveTo(t,e,n,s=!1){this._isUserControllingTruck=!1;const o=ft.set(t,e,n).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,o,this.boundaryFriction),this._needsUpdate=!0,s||this._target.copy(this._targetEnd);const a=!s||wt(this._target.x,this._targetEnd.x,this.restThreshold)&&wt(this._target.y,this._targetEnd.y,this.restThreshold)&&wt(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(a)}lookInDirectionOf(t,e,n,s=!1){const o=ft.set(t,e,n).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius);return this.setPosition(o.x,o.y,o.z,s)}fitToBox(t,e,{cover:n=!1,paddingLeft:s=0,paddingRight:o=0,paddingBottom:a=0,paddingTop:c=0}={}){const h=[],p=t.isBox3?kn.copy(t):kn.setFromObject(t);p.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const C=Ya(this._sphericalEnd.theta,Ba),I=Ya(this._sphericalEnd.phi,Ba);h.push(this.rotateTo(C,I,e));const f=ft.setFromSpherical(this._sphericalEnd).normalize(),T=Ka.setFromUnitVectors(f,Xs),A=wt(Math.abs(f.y),1);A&&T.multiply(qs.setFromAxisAngle(Ni,C)),T.multiply(this._yAxisUpSpaceInverse);const F=Ha.makeEmpty();Ft.copy(p.min).applyQuaternion(T),F.expandByPoint(Ft),Ft.copy(p.min).setX(p.max.x).applyQuaternion(T),F.expandByPoint(Ft),Ft.copy(p.min).setY(p.max.y).applyQuaternion(T),F.expandByPoint(Ft),Ft.copy(p.max).setZ(p.min.z).applyQuaternion(T),F.expandByPoint(Ft),Ft.copy(p.min).setZ(p.max.z).applyQuaternion(T),F.expandByPoint(Ft),Ft.copy(p.max).setY(p.min.y).applyQuaternion(T),F.expandByPoint(Ft),Ft.copy(p.max).setX(p.min.x).applyQuaternion(T),F.expandByPoint(Ft),Ft.copy(p.max).applyQuaternion(T),F.expandByPoint(Ft),F.min.x-=s,F.min.y-=a,F.max.x+=o,F.max.y+=c,T.setFromUnitVectors(Xs,f),A&&T.premultiply(qs.invert()),T.premultiply(this._yAxisUpSpace);const _=F.getSize(ft),w=F.getCenter(Ft).applyQuaternion(T);if(pn(this._camera)){const v=this.getDistanceToFitBox(_.x,_.y,_.z,n);h.push(this.moveTo(w.x,w.y,w.z,e)),h.push(this.dollyTo(v,e)),h.push(this.setFocalOffset(0,0,0,e))}else if(Je(this._camera)){const v=this._camera,Y=v.right-v.left,y=v.top-v.bottom,L=n?Math.max(Y/_.x,y/_.y):Math.min(Y/_.x,y/_.y);h.push(this.moveTo(w.x,w.y,w.z,e)),h.push(this.zoomTo(L,e)),h.push(this.setFocalOffset(0,0,0,e))}return Promise.all(h)}fitToSphere(t,e){const n=[],s=t instanceof dt.Sphere?js.copy(t):Dr.createBoundingSphere(t,js);if(n.push(this.moveTo(s.center.x,s.center.y,s.center.z,e)),pn(this._camera)){const o=this.getDistanceToFitSphere(s.radius);n.push(this.dollyTo(o,e))}else if(Je(this._camera)){const o=this._camera.right-this._camera.left,a=this._camera.top-this._camera.bottom,c=2*s.radius,h=Math.min(o/c,a/c);n.push(this.zoomTo(h,e))}return n.push(this.setFocalOffset(0,0,0,e)),Promise.all(n)}setLookAt(t,e,n,s,o,a,c=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Un.NONE,this._changedDolly=0;const h=Ft.set(s,o,a),p=ft.set(t,e,n);this._targetEnd.copy(h),this._sphericalEnd.setFromVector3(p.sub(h).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,c||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const C=!c||wt(this._target.x,this._targetEnd.x,this.restThreshold)&&wt(this._target.y,this._targetEnd.y,this.restThreshold)&&wt(this._target.z,this._targetEnd.z,this.restThreshold)&&wt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&wt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&wt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(C)}lerpLookAt(t,e,n,s,o,a,c,h,p,C,I,f,T,A=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Un.NONE,this._changedDolly=0;const F=ft.set(s,o,a),_=Ft.set(t,e,n);he.setFromVector3(_.sub(F).applyQuaternion(this._yAxisUpSpace));const w=Yn.set(C,I,f),v=Ft.set(c,h,p);vr.setFromVector3(v.sub(w).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(F.lerp(w,T));const Y=vr.theta-he.theta,y=vr.phi-he.phi,L=vr.radius-he.radius;this._sphericalEnd.set(he.radius+L*T,he.phi+y*T,he.theta+Y*T),this.normalizeRotations(),this._needsUpdate=!0,A||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const k=!A||wt(this._target.x,this._targetEnd.x,this.restThreshold)&&wt(this._target.y,this._targetEnd.y,this.restThreshold)&&wt(this._target.z,this._targetEnd.z,this.restThreshold)&&wt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&wt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&wt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(k)}setPosition(t,e,n,s=!1){return this.setLookAt(t,e,n,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,s)}setTarget(t,e,n,s=!1){const o=this.getPosition(ft),a=this.setLookAt(o.x,o.y,o.z,t,e,n,s);return this._sphericalEnd.phi=ge(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),a}setFocalOffset(t,e,n,s=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(t,e,n),this._needsUpdate=!0,s||this._focalOffset.copy(this._focalOffsetEnd);const o=!s||wt(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&wt(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&wt(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(o)}setOrbitPoint(t,e,n){this._camera.updateMatrixWorld(),Pe.setFromMatrixColumn(this._camera.matrixWorldInverse,0),be.setFromMatrixColumn(this._camera.matrixWorldInverse,1),En.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const s=ft.set(t,e,n),o=s.distanceTo(this._camera.position),a=s.sub(this._camera.position);Pe.multiplyScalar(a.x),be.multiplyScalar(a.y),En.multiplyScalar(a.z),ft.copy(Pe).add(be).add(En),ft.z=ft.z+o,this.dollyTo(o,!1),this.setFocalOffset(-ft.x,ft.y,-ft.z,!1),this.moveTo(t,e,n,!1)}setBoundary(t){if(!t){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(t),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(t,e,n,s){if(t===null){this._viewport=null;return}this._viewport=this._viewport||new dt.Vector4,typeof t=="number"?this._viewport.set(t,e,n,s):this._viewport.copy(t)}getDistanceToFitBox(t,e,n,s=!1){if(Ws(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const o=t/e,a=this._camera.getEffectiveFOV()*Fr,c=this._camera.aspect;return((s?o>c:o<c)?e:t/c)*.5/Math.tan(a*.5)+n*.5}getDistanceToFitSphere(t){if(Ws(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const e=this._camera.getEffectiveFOV()*Fr,n=Math.atan(Math.tan(e*.5)*this._camera.aspect)*2,s=1<this._camera.aspect?e:n;return t/Math.sin(s*.5)}getTarget(t,e=!0){return(t&&t.isVector3?t:new dt.Vector3).copy(e?this._targetEnd:this._target)}getPosition(t,e=!0){return(t&&t.isVector3?t:new dt.Vector3).setFromSpherical(e?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(e?this._targetEnd:this._target)}getSpherical(t,e=!0){return(t&&t instanceof dt.Spherical?t:new dt.Spherical).copy(e?this._sphericalEnd:this._spherical)}getFocalOffset(t,e=!0){return(t&&t.isVector3?t:new dt.Vector3).copy(e?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%Bn,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=Bn),this._spherical.theta+=Bn*Math.round((this._sphericalEnd.theta-this._spherical.theta)/Bn)}reset(t=!1){if(!wt(this._camera.up.x,this._cameraUp0.x)||!wt(this._camera.up.y,this._cameraUp0.y)||!wt(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const n=this.getPosition(ft);this.updateCameraUp(),this.setPosition(n.x,n.y,n.z)}const e=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,t),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,t),this.zoomTo(this._zoom0,t)];return Promise.all(e)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,Ni),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const t=ft.subVectors(this._target,this._camera.position).normalize(),e=Ft.crossVectors(t,this._camera.up);this._camera.up.crossVectors(e,t).normalize(),this._camera.updateMatrixWorld();const n=this.getPosition(ft);this.updateCameraUp(),this.setPosition(n.x,n.y,n.z)}update(t){const e=this._sphericalEnd.theta-this._spherical.theta,n=this._sphericalEnd.phi-this._spherical.phi,s=this._sphericalEnd.radius-this._spherical.radius,o=Va.subVectors(this._targetEnd,this._target),a=za.subVectors(this._focalOffsetEnd,this._focalOffset),c=this._zoomEnd-this._zoom;if(St(e))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const C=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=Pi(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,C,1/0,t),this._needsUpdate=!0}if(St(n))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const C=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=Pi(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,C,1/0,t),this._needsUpdate=!0}if(St(s))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const C=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=Pi(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,C,this.maxSpeed,t),this._needsUpdate=!0}if(St(o.x)&&St(o.y)&&St(o.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const C=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;ka(this._target,this._targetEnd,this._targetVelocity,C,this.maxSpeed,t,this._target),this._needsUpdate=!0}if(St(a.x)&&St(a.y)&&St(a.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const C=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;ka(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,C,this.maxSpeed,t,this._focalOffset),this._needsUpdate=!0}if(St(c))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const C=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=Pi(this._zoom,this._zoomEnd,this._zoomVelocity,C,1/0,t)}if(this.dollyToCursor){if(pn(this._camera)&&this._changedDolly!==0){const C=this._spherical.radius-this._lastDistance,I=this._camera,f=this._getCameraDirection(wr),T=ft.copy(f).cross(I.up).normalize();T.lengthSq()===0&&(T.x=1);const A=Ft.crossVectors(T,f),F=this._sphericalEnd.radius*Math.tan(I.getEffectiveFOV()*Fr*.5),_=(this._sphericalEnd.radius-C-this._sphericalEnd.radius)/this._sphericalEnd.radius,w=Yn.copy(this._targetEnd).add(T.multiplyScalar(this._dollyControlCoord.x*F*I.aspect)).add(A.multiplyScalar(this._dollyControlCoord.y*F)),v=ft.copy(this._targetEnd).lerp(w,_),Y=this._lastDollyDirection===Un.IN&&this._spherical.radius<=this.minDistance,y=this._lastDollyDirection===Un.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(Y||y)){this._sphericalEnd.radius-=C,this._spherical.radius-=C;const k=Ft.copy(f).multiplyScalar(-C);v.add(k)}this._boundary.clampPoint(v,v);const L=Ft.subVectors(v,this._targetEnd);this._targetEnd.copy(v),this._target.add(L),this._changedDolly-=C,St(this._changedDolly)&&(this._changedDolly=0)}else if(Je(this._camera)&&this._changedZoom!==0){const C=this._zoom-this._lastZoom,I=this._camera,f=ft.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(I.near+I.far)/(I.near-I.far)).unproject(I),T=Ft.set(0,0,-1).applyQuaternion(I.quaternion),A=Yn.copy(f).add(T.multiplyScalar(-f.dot(I.up))),F=-(this._zoom-C-this._zoom)/this._zoom,_=this._getCameraDirection(wr),w=this._targetEnd.dot(_),v=ft.copy(this._targetEnd).lerp(A,F),Y=v.dot(_),y=_.multiplyScalar(Y-w);v.sub(y),this._boundary.clampPoint(v,v);const L=Ft.subVectors(v,this._targetEnd);this._targetEnd.copy(v),this._target.add(L),this._changedZoom-=C,St(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const h=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,h),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!St(this._focalOffset.x)||!St(this._focalOffset.y)||!St(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),Pe.setFromMatrixColumn(this._camera.matrix,0),be.setFromMatrixColumn(this._camera.matrix,1),En.setFromMatrixColumn(this._camera.matrix,2),Pe.multiplyScalar(this._focalOffset.x),be.multiplyScalar(-this._focalOffset.y),En.multiplyScalar(this._focalOffset.z),ft.copy(Pe).add(be).add(En),this._camera.position.add(ft)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),ft.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const p=this._needsUpdate;return p&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):p?(this.dispatchEvent({type:"update"}),St(e,this.restThreshold)&&St(n,this.restThreshold)&&St(s,this.restThreshold)&&St(o.x,this.restThreshold)&&St(o.y,this.restThreshold)&&St(o.z,this.restThreshold)&&St(a.x,this.restThreshold)&&St(a.y,this.restThreshold)&&St(a.z,this.restThreshold)&&St(c,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!p&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=p,this._needsUpdate=!1,p}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:_r(this.maxDistance),minZoom:this.minZoom,maxZoom:_r(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:_r(this.maxPolarAngle),minAzimuthAngle:_r(this.minAzimuthAngle),maxAzimuthAngle:_r(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:ft.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(t,e=!1){const n=JSON.parse(t);this.enabled=n.enabled,this.minDistance=n.minDistance,this.maxDistance=Or(n.maxDistance),this.minZoom=n.minZoom,this.maxZoom=Or(n.maxZoom),this.minPolarAngle=n.minPolarAngle,this.maxPolarAngle=Or(n.maxPolarAngle),this.minAzimuthAngle=Or(n.minAzimuthAngle),this.maxAzimuthAngle=Or(n.maxAzimuthAngle),this.smoothTime=n.smoothTime,this.draggingSmoothTime=n.draggingSmoothTime,this.dollySpeed=n.dollySpeed,this.truckSpeed=n.truckSpeed,this.dollyToCursor=n.dollyToCursor,this.verticalDragToForward=n.verticalDragToForward,this._target0.fromArray(n.target0),this._position0.fromArray(n.position0),this._zoom0=n.zoom0,this._focalOffset0.fromArray(n.focalOffset0),this.moveTo(n.target[0],n.target[1],n.target[2],e),he.setFromVector3(ft.fromArray(n.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(he.theta,he.phi,e),this.dollyTo(he.radius,e),this.zoomTo(n.zoom,e),this.setFocalOffset(n.focalOffset[0],n.focalOffset[1],n.focalOffset[2],e),this._needsUpdate=!0}connect(t){if(this._domElement){console.warn("camera-controls is already connected.");return}t.setAttribute("data-camera-controls-version",Iu),this._addAllEventListeners(t),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(t){return t.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(t){return this._getTargetDirection(t).negate()}_findPointerById(t){return this._activePointers.find(e=>e.pointerId===t)}_findPointerByMouseButton(t){return this._activePointers.find(e=>e.mouseButton===t)}_disposePointer(t){this._activePointers.splice(this._activePointers.indexOf(t),1)}_encloseToBoundary(t,e,n){const s=e.lengthSq();if(s===0)return t;const o=Ft.copy(e).add(t),a=this._boundary.clampPoint(o,Yn).sub(o),c=a.lengthSq();if(c===0)return t.add(e);if(c===s)return t;if(n===0)return t.add(e).add(a);{const h=1+n*c/e.dot(a);return t.add(Ft.copy(e).multiplyScalar(h)).add(a.multiplyScalar(1-n))}}_updateNearPlaneCorners(){if(pn(this._camera)){const t=this._camera,e=t.near,n=t.getEffectiveFOV()*Fr,s=Math.tan(n*.5)*e,o=s*t.aspect;this._nearPlaneCorners[0].set(-o,-s,0),this._nearPlaneCorners[1].set(o,-s,0),this._nearPlaneCorners[2].set(o,s,0),this._nearPlaneCorners[3].set(-o,s,0)}else if(Je(this._camera)){const t=this._camera,e=1/t.zoom,n=t.left*e,s=t.right*e,o=t.top*e,a=t.bottom*e;this._nearPlaneCorners[0].set(n,o,0),this._nearPlaneCorners[1].set(s,o,0),this._nearPlaneCorners[2].set(s,a,0),this._nearPlaneCorners[3].set(n,a,0)}}_collisionTest(){let t=1/0;if(!(this.colliderMeshes.length>=1)||Ws(this._camera,"_collisionTest"))return t;const e=this._getTargetDirection(wr);Zs.lookAt(Ga,e,this._camera.up);for(let n=0;n<4;n++){const s=Ft.copy(this._nearPlaneCorners[n]);s.applyMatrix4(Zs);const o=Yn.addVectors(this._target,s);Li.set(o,e),Li.far=this._spherical.radius+1;const a=Li.intersectObjects(this.colliderMeshes);a.length!==0&&a[0].distance<t&&(t=a[0].distance)}return t}_getClientRect(t){if(!this._domElement)return;const e=this._domElement.getBoundingClientRect();return t.x=e.left,t.y=e.top,this._viewport?(t.x+=this._viewport.x,t.y+=e.height-this._viewport.w-this._viewport.y,t.width=this._viewport.z,t.height=this._viewport.w):(t.width=e.width,t.height=e.height),t}_createOnRestPromise(t){return t?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(e=>{const n=()=>{this.removeEventListener("rest",n),e()};this.addEventListener("rest",n)}))}_addAllEventListeners(t){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(t){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(t){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(t,e=new dt.Sphere){const n=e,s=n.center;kn.makeEmpty(),t.traverseVisible(a=>{a.isMesh&&kn.expandByObject(a)}),kn.getCenter(s);let o=0;return t.traverseVisible(a=>{if(!a.isMesh)return;const c=a,h=c.geometry.clone();h.applyMatrix4(c.matrixWorld);const p=h.attributes.position;for(let C=0,I=p.count;C<I;C++)ft.fromBufferAttribute(p,C),o=Math.max(o,s.distanceToSquared(ft))}),n.radius=Math.sqrt(o),n}}class Ur extends Qh{constructor(t){super(t),R(this,"onBeforeUpdate",new at),R(this,"onAfterUpdate",new at),R(this,"onAspectUpdated",new at),R(this,"onDisposed",new at),R(this,"three"),R(this,"_allControls",new Map),R(this,"updateAspect",()=>{var e;if(!(!this.currentWorld||!this.currentWorld.renderer)&&(e=this.currentWorld.renderer)!=null&&e.isResizeable()){const n=this.currentWorld.renderer.getSize();this.three.aspect=n.width/n.height,this.three.updateProjectionMatrix(),this.onAspectUpdated.trigger()}}),this.three=this.setupCamera(),this.setupEvents(!0),this.onWorldChanged.add(({action:e,world:n})=>{if(e==="added"){const s=this.newCameraControls();this._allControls.set(n.uuid,s)}if(e==="removed"){const s=this._allControls.get(n.uuid);s&&(s.dispose(),this._allControls.delete(n.uuid))}})}get controls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");const t=this._allControls.get(this.currentWorld.uuid);if(!t)throw new Error("Controls not found!");return t}get enabled(){return this.currentWorld===null?!1:this.controls.enabled}set enabled(t){this.controls.enabled=t}dispose(){this.setupEvents(!1),this.enabled=!1,this.onAspectUpdated.reset(),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.three.removeFromParent(),this.onDisposed.trigger(),this.onDisposed.reset();for(const[t,e]of this._allControls)e.dispose()}update(t){this.enabled&&(this.onBeforeUpdate.trigger(this),this.controls.update(t),this.onAfterUpdate.trigger(this))}setupCamera(){const t=window.innerWidth/window.innerHeight,e=new Fc(60,t,1,1e3);return e.position.set(50,50,50),e.lookAt(new q(0,0,0)),e}newCameraControls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");if(!this.currentWorld.renderer)throw new Error("This camera needs a renderer to work!");Dr.install({THREE:Ur.getSubsetOfThree()});const{domElement:t}=this.currentWorld.renderer.three,e=new Dr(this.three,t);return e.smoothTime=.2,e.dollyToCursor=!0,e.infinityDolly=!0,e}setupEvents(t){t?window.addEventListener("resize",this.updateAspect):window.removeEventListener("resize",this.updateAspect)}static getSubsetOfThree(){return{MOUSE:_c,Vector2:Fe,Vector3:q,Vector4:Oc,Quaternion:Ae,Matrix4:Mt,Spherical:wc,Box3:$t,Sphere:yo,Raycaster:go,MathUtils:ol}}}const Nl=class Ll extends re{constructor(t){super(t),R(this,"onAfterUpdate",new at),R(this,"onBeforeUpdate",new at),R(this,"onDisposed",new at),R(this,"list",new Map),R(this,"enabled",!0),t.add(Ll.uuid,this)}create(){const t=new du(this.components),e=t.uuid;if(this.list.has(e))throw new Error("There is already a world with this name!");return this.list.set(e,t),t}delete(t){this.list.delete(t.uuid),t.dispose()}dispose(){this.enabled=!1;for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger()}update(t){if(this.enabled)for(const[e,n]of this.list)n.update(t)}};R(Nl,"uuid","fdb61dc4-2ec1-4966-b83d-54ea795fad4a");let Ml=Nl;class Tu{constructor(t,e,n){R(this,"onDisposed",new at),R(this,"world"),R(this,"components"),R(this,"_grid"),R(this,"_fade",3),R(this,"updateZoom",()=>{this.world.camera instanceof Ur&&(this.material.uniforms.uZoom.value=this.world.camera.three.zoom)}),this.world=e;const{color:s,size1:o,size2:a,distance:c}=n;this.components=t;const h=new Ro(2,2,1,1),p=new Sc({side:Yr,uniforms:{uSize1:{value:o},uSize2:{value:a},uColor:{value:s},uDistance:{value:c},uFade:{value:this._fade},uZoom:{value:1}},transparent:!0,vertexShader:`
            
            varying vec3 worldPosition;
            
            uniform float uDistance;
            
            void main() {
            
                    vec3 pos = position.xzy * uDistance;
                    pos.xz += cameraPosition.xz;
                    
                    worldPosition = pos;
                    
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
            
            }
            `,fragmentShader:`
            
            varying vec3 worldPosition;
            
            uniform float uZoom;
            uniform float uFade;
            uniform float uSize1;
            uniform float uSize2;
            uniform vec3 uColor;
            uniform float uDistance;
                
                
                
                float getGrid(float size) {
                
                    vec2 r = worldPosition.xz / size;
                    
                    
                    vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
                    float line = min(grid.x, grid.y);
                    
                
                    return 1.0 - min(line, 1.0);
                }
                
            void main() {
            
                    
                    float d = 1.0 - min(distance(cameraPosition.xz, worldPosition.xz) / uDistance, 1.0);
                    
                    float g1 = getGrid(uSize1);
                    float g2 = getGrid(uSize2);
                    
                    // Ortho camera fades the grid away when zooming out
                    float minZoom = step(0.2, uZoom);
                    float zoomFactor = pow(min(uZoom, 1.), 2.) * minZoom;
                    
                    gl_FragColor = vec4(uColor.rgb, mix(g2, g1, g1) * pow(d, uFade));
                    gl_FragColor.a = mix(0.5 * gl_FragColor.a, gl_FragColor.a, g2) * zoomFactor;
                    
                    if ( gl_FragColor.a <= 0.0 ) discard;
                    
            
            }
            
            `,extensions:{derivatives:!0}});this._grid=new lt(h,p),this._grid.frustumCulled=!1,e.scene.three.add(this._grid),this.setupEvents(!0)}get visible(){return this._grid.visible}set visible(t){t?this.world.scene.three.add(this._grid):this._grid.removeFromParent()}get material(){return this._grid.material}get fade(){return this._fade===3}set fade(t){this._fade=t?3:0,this.material.uniforms.uFade.value=this._fade}[Symbol.dispose](){throw new Error("Method not implemented.")}get(){return this._grid}dispose(){this.setupEvents(!1),this.components.get(Qn).destroy(this._grid),this.onDisposed.trigger(),this.onDisposed.reset(),this.world=null,this.components=null}setupEvents(t){if(!(this.world.camera instanceof Ur))return;const e=this.world.camera.controls;t?e.addEventListener("update",this.updateZoom):e.removeEventListener("update",this.updateZoom)}}class xl extends re{constructor(){super(...arguments),R(this,"list",new Map),R(this,"onDisposed",new at),R(this,"config",{color:new Kn(12303291),size1:1,size2:10,distance:500}),R(this,"enabled",!0)}create(t){if(this.list.has(t.uuid))throw new Error("This world already has a grid!");const e=new Tu(this.components,t,this.config);this.list.set(t.uuid,e),t.onDisposed.add(()=>{this.delete(t)})}delete(t){const e=this.list.get(t.uuid);e&&e.dispose(),this.list.delete(t.uuid)}dispose(){for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger()}}R(xl,"uuid","d1e814d5-b81c-4452-87a2-f039375e0489");const fn=new go,Qt=new q,$e=new q,Lt=new Ae,Wa={X:new q(1,0,0),Y:new q(0,1,0),Z:new q(0,0,1)},Qs={type:"change"},Xa={type:"mouseDown"},ja={type:"mouseUp",mode:null},qa={type:"objectChange"};class gu extends xr{constructor(t,e){super(),e===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),e=document),this.isTransformControls=!0,this.visible=!1,this.domElement=e,this.domElement.style.touchAction="none";const n=new Ou;this._gizmo=n,this.add(n);const s=new wu;this._plane=s,this.add(s);const o=this;function a(v,Y){let y=Y;Object.defineProperty(o,v,{get:function(){return y!==void 0?y:Y},set:function(L){y!==L&&(y=L,s[v]=L,n[v]=L,o.dispatchEvent({type:v+"-changed",value:L}),o.dispatchEvent(Qs))}}),o[v]=Y,s[v]=Y,n[v]=Y}a("camera",t),a("object",void 0),a("enabled",!0),a("axis",null),a("mode","translate"),a("translationSnap",null),a("rotationSnap",null),a("scaleSnap",null),a("space","world"),a("size",1),a("dragging",!1),a("showX",!0),a("showY",!0),a("showZ",!0);const c=new q,h=new q,p=new Ae,C=new Ae,I=new q,f=new Ae,T=new q,A=new q,F=new q,_=0,w=new q;a("worldPosition",c),a("worldPositionStart",h),a("worldQuaternion",p),a("worldQuaternionStart",C),a("cameraPosition",I),a("cameraQuaternion",f),a("pointStart",T),a("pointEnd",A),a("rotationAxis",F),a("rotationAngle",_),a("eye",w),this._offset=new q,this._startNorm=new q,this._endNorm=new q,this._cameraScale=new q,this._parentPosition=new q,this._parentQuaternion=new Ae,this._parentQuaternionInv=new Ae,this._parentScale=new q,this._worldScaleStart=new q,this._worldQuaternionInv=new Ae,this._worldScale=new q,this._positionStart=new q,this._quaternionStart=new Ae,this._scaleStart=new q,this._getPointer=yu.bind(this),this._onPointerDown=Au.bind(this),this._onPointerHover=Ru.bind(this),this._onPointerMove=Fu.bind(this),this._onPointerUp=_u.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(t){if(this.object===void 0||this.dragging===!0)return;fn.setFromCamera(t,this.camera);const e=$s(this._gizmo.picker[this.mode],fn);e?this.axis=e.object.name:this.axis=null}pointerDown(t){if(!(this.object===void 0||this.dragging===!0||t.button!==0)&&this.axis!==null){fn.setFromCamera(t,this.camera);const e=$s(this._plane,fn,!0);e&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(e.point).sub(this.worldPositionStart)),this.dragging=!0,Xa.mode=this.mode,this.dispatchEvent(Xa)}}pointerMove(t){const e=this.axis,n=this.mode,s=this.object;let o=this.space;if(n==="scale"?o="local":(e==="E"||e==="XYZE"||e==="XYZ")&&(o="world"),s===void 0||e===null||this.dragging===!1||t.button!==-1)return;fn.setFromCamera(t,this.camera);const a=$s(this._plane,fn,!0);if(a){if(this.pointEnd.copy(a.point).sub(this.worldPositionStart),n==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),o==="local"&&e!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),e.indexOf("X")===-1&&(this._offset.x=0),e.indexOf("Y")===-1&&(this._offset.y=0),e.indexOf("Z")===-1&&(this._offset.z=0),o==="local"&&e!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),s.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(o==="local"&&(s.position.applyQuaternion(Lt.copy(this._quaternionStart).invert()),e.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.position.applyQuaternion(this._quaternionStart)),o==="world"&&(s.parent&&s.position.add(Qt.setFromMatrixPosition(s.parent.matrixWorld)),e.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.parent&&s.position.sub(Qt.setFromMatrixPosition(s.parent.matrixWorld))));else if(n==="scale"){if(e.search("XYZ")!==-1){let c=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(c*=-1),$e.set(c,c,c)}else Qt.copy(this.pointStart),$e.copy(this.pointEnd),Qt.applyQuaternion(this._worldQuaternionInv),$e.applyQuaternion(this._worldQuaternionInv),$e.divide(Qt),e.search("X")===-1&&($e.x=1),e.search("Y")===-1&&($e.y=1),e.search("Z")===-1&&($e.z=1);s.scale.copy(this._scaleStart).multiply($e),this.scaleSnap&&(e.search("X")!==-1&&(s.scale.x=Math.round(s.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Y")!==-1&&(s.scale.y=Math.round(s.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Z")!==-1&&(s.scale.z=Math.round(s.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(n==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const c=20/this.worldPosition.distanceTo(Qt.setFromMatrixPosition(this.camera.matrixWorld));let h=!1;e==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Qt.copy(this.rotationAxis).cross(this.eye))*c):(e==="X"||e==="Y"||e==="Z")&&(this.rotationAxis.copy(Wa[e]),Qt.copy(Wa[e]),o==="local"&&Qt.applyQuaternion(this.worldQuaternion),Qt.cross(this.eye),Qt.length()===0?h=!0:this.rotationAngle=this._offset.dot(Qt.normalize())*c),(e==="E"||h)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),o==="local"&&e!=="E"&&e!=="XYZE"?(s.quaternion.copy(this._quaternionStart),s.quaternion.multiply(Lt.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),s.quaternion.copy(Lt.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),s.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(Qs),this.dispatchEvent(qa)}}pointerUp(t){t.button===0&&(this.dragging&&this.axis!==null&&(ja.mode=this.mode,this.dispatchEvent(ja)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(t){t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()})}attach(t){return this.object=t,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Qs),this.dispatchEvent(qa),this.pointStart.copy(this.pointEnd))}getRaycaster(){return fn}getMode(){return this.mode}setMode(t){this.mode=t}setTranslationSnap(t){this.translationSnap=t}setRotationSnap(t){this.rotationSnap=t}setScaleSnap(t){this.scaleSnap=t}setSize(t){this.size=t}setSpace(t){this.space=t}}function yu(u){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:u.button};{const t=this.domElement.getBoundingClientRect();return{x:(u.clientX-t.left)/t.width*2-1,y:-(u.clientY-t.top)/t.height*2+1,button:u.button}}}function Ru(u){if(this.enabled)switch(u.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(u));break}}function Au(u){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(u.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(u)),this.pointerDown(this._getPointer(u)))}function Fu(u){this.enabled&&this.pointerMove(this._getPointer(u))}function _u(u){this.enabled&&(this.domElement.releasePointerCapture(u.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(u)))}function $s(u,t,e){const n=t.intersectObject(u,!0);for(let s=0;s<n.length;s++)if(n[s].object.visible||e)return n[s];return!1}const Mi=new yc,vt=new q(0,1,0),Za=new q(0,0,0),Qa=new Mt,xi=new Ae,Yi=new Ae,Ne=new q,$a=new Mt,br=new q(1,0,0),In=new q(0,1,0),Nr=new q(0,0,1),Di=new q,Sr=new q,Pr=new q;class Ou extends xr{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const t=new Xn({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),e=new dl({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=t.clone();n.opacity=.15;const s=e.clone();s.opacity=.5;const o=t.clone();o.color.setHex(16711680);const a=t.clone();a.color.setHex(65280);const c=t.clone();c.color.setHex(255);const h=t.clone();h.color.setHex(16711680),h.opacity=.5;const p=t.clone();p.color.setHex(65280),p.opacity=.5;const C=t.clone();C.color.setHex(255),C.opacity=.5;const I=t.clone();I.opacity=.25;const f=t.clone();f.color.setHex(16776960),f.opacity=.25,t.clone().color.setHex(16776960);const T=t.clone();T.color.setHex(7895160);const A=new ee(0,.04,.1,12);A.translate(0,.05,0);const F=new Zt(.08,.08,.08);F.translate(0,.04,0);const _=new Wn;_.setAttribute("position",new pa([0,0,0,1,0,0],3));const w=new ee(.0075,.0075,.5,3);w.translate(0,.25,0);function v(ut,It){const yt=new mr(ut,.0075,3,64,It*Math.PI*2);return yt.rotateY(Math.PI/2),yt.rotateX(Math.PI/2),yt}function Y(){const ut=new Wn;return ut.setAttribute("position",new pa([0,0,0,1,1,1],3)),ut}const y={X:[[new lt(A,o),[.5,0,0],[0,0,-Math.PI/2]],[new lt(A,o),[-.5,0,0],[0,0,Math.PI/2]],[new lt(w,o),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new lt(A,a),[0,.5,0]],[new lt(A,a),[0,-.5,0],[Math.PI,0,0]],[new lt(w,a)]],Z:[[new lt(A,c),[0,0,.5],[Math.PI/2,0,0]],[new lt(A,c),[0,0,-.5],[-Math.PI/2,0,0]],[new lt(w,c),null,[Math.PI/2,0,0]]],XYZ:[[new lt(new pi(.1,0),I.clone()),[0,0,0]]],XY:[[new lt(new Zt(.15,.15,.01),C.clone()),[.15,.15,0]]],YZ:[[new lt(new Zt(.15,.15,.01),h.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new lt(new Zt(.15,.15,.01),p.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},L={X:[[new lt(new ee(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new lt(new ee(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new lt(new ee(.2,0,.6,4),n),[0,.3,0]],[new lt(new ee(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new lt(new ee(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new lt(new ee(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new lt(new pi(.2,0),n)]],XY:[[new lt(new Zt(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new lt(new Zt(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new lt(new Zt(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]]},k={START:[[new lt(new pi(.01,2),s),null,null,null,"helper"]],END:[[new lt(new pi(.01,2),s),null,null,null,"helper"]],DELTA:[[new Ze(Y(),s),null,null,null,"helper"]],X:[[new Ze(_,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ze(_,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ze(_,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},V={XYZE:[[new lt(v(.5,1),T),null,[0,Math.PI/2,0]]],X:[[new lt(v(.5,.5),o)]],Y:[[new lt(v(.5,.5),a),null,[0,0,-Math.PI/2]]],Z:[[new lt(v(.5,.5),c),null,[0,Math.PI/2,0]]],E:[[new lt(v(.75,1),f),null,[0,Math.PI/2,0]]]},H={AXIS:[[new Ze(_,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},j={XYZE:[[new lt(new xc(.25,10,8),n)]],X:[[new lt(new mr(.5,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new lt(new mr(.5,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new lt(new mr(.5,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new lt(new mr(.75,.1,2,24),n)]]},Q={X:[[new lt(F,o),[.5,0,0],[0,0,-Math.PI/2]],[new lt(w,o),[0,0,0],[0,0,-Math.PI/2]],[new lt(F,o),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new lt(F,a),[0,.5,0]],[new lt(w,a)],[new lt(F,a),[0,-.5,0],[0,0,Math.PI]]],Z:[[new lt(F,c),[0,0,.5],[Math.PI/2,0,0]],[new lt(w,c),[0,0,0],[Math.PI/2,0,0]],[new lt(F,c),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new lt(new Zt(.15,.15,.01),C),[.15,.15,0]]],YZ:[[new lt(new Zt(.15,.15,.01),h),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new lt(new Zt(.15,.15,.01),p),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new lt(new Zt(.1,.1,.1),I.clone())]]},J={X:[[new lt(new ee(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new lt(new ee(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new lt(new ee(.2,0,.6,4),n),[0,.3,0]],[new lt(new ee(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new lt(new ee(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new lt(new ee(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new lt(new Zt(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new lt(new Zt(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new lt(new Zt(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new lt(new Zt(.2,.2,.2),n),[0,0,0]]]},$={X:[[new Ze(_,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ze(_,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ze(_,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function nt(ut){const It=new xr;for(const yt in ut)for(let kt=ut[yt].length;kt--;){const Rt=ut[yt][kt][0].clone(),Jt=ut[yt][kt][1],Kt=ut[yt][kt][2],fe=ut[yt][kt][3],Tn=ut[yt][kt][4];Rt.name=yt,Rt.tag=Tn,Jt&&Rt.position.set(Jt[0],Jt[1],Jt[2]),Kt&&Rt.rotation.set(Kt[0],Kt[1],Kt[2]),fe&&Rt.scale.set(fe[0],fe[1],fe[2]),Rt.updateMatrix();const le=Rt.geometry.clone();le.applyMatrix4(Rt.matrix),Rt.geometry=le,Rt.renderOrder=1/0,Rt.position.set(0,0,0),Rt.rotation.set(0,0,0),Rt.scale.set(1,1,1),It.add(Rt)}return It}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=nt(y)),this.add(this.gizmo.rotate=nt(V)),this.add(this.gizmo.scale=nt(Q)),this.add(this.picker.translate=nt(L)),this.add(this.picker.rotate=nt(j)),this.add(this.picker.scale=nt(J)),this.add(this.helper.translate=nt(k)),this.add(this.helper.rotate=nt(H)),this.add(this.helper.scale=nt($)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(t){const e=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:Yi;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(let s=0;s<n.length;s++){const o=n[s];o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition);let a;if(this.camera.isOrthographicCamera?a=(this.camera.top-this.camera.bottom)/this.camera.zoom:a=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(a*this.size/4),o.tag==="helper"){o.visible=!1,o.name==="AXIS"?(o.visible=!!this.axis,this.axis==="X"&&(Lt.setFromEuler(Mi.set(0,0,0)),o.quaternion.copy(e).multiply(Lt),Math.abs(vt.copy(br).applyQuaternion(e).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Y"&&(Lt.setFromEuler(Mi.set(0,0,Math.PI/2)),o.quaternion.copy(e).multiply(Lt),Math.abs(vt.copy(In).applyQuaternion(e).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Z"&&(Lt.setFromEuler(Mi.set(0,Math.PI/2,0)),o.quaternion.copy(e).multiply(Lt),Math.abs(vt.copy(Nr).applyQuaternion(e).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="XYZE"&&(Lt.setFromEuler(Mi.set(0,Math.PI/2,0)),vt.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(Qa.lookAt(Za,vt,In)),o.quaternion.multiply(Lt),o.visible=this.dragging),this.axis==="E"&&(o.visible=!1)):o.name==="START"?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):o.name==="END"?(o.position.copy(this.worldPosition),o.visible=this.dragging):o.name==="DELTA"?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),Qt.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Qt.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(Qt),o.visible=this.dragging):(o.quaternion.copy(e),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=this.axis.search(o.name)!==-1));continue}o.quaternion.copy(e),this.mode==="translate"||this.mode==="scale"?(o.name==="X"&&Math.abs(vt.copy(br).applyQuaternion(e).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Y"&&Math.abs(vt.copy(In).applyQuaternion(e).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Z"&&Math.abs(vt.copy(Nr).applyQuaternion(e).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XY"&&Math.abs(vt.copy(Nr).applyQuaternion(e).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="YZ"&&Math.abs(vt.copy(br).applyQuaternion(e).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XZ"&&Math.abs(vt.copy(In).applyQuaternion(e).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)):this.mode==="rotate"&&(xi.copy(e),vt.copy(this.eye).applyQuaternion(Lt.copy(e).invert()),o.name.search("E")!==-1&&o.quaternion.setFromRotationMatrix(Qa.lookAt(this.eye,Za,In)),o.name==="X"&&(Lt.setFromAxisAngle(br,Math.atan2(-vt.y,vt.z)),Lt.multiplyQuaternions(xi,Lt),o.quaternion.copy(Lt)),o.name==="Y"&&(Lt.setFromAxisAngle(In,Math.atan2(vt.x,vt.z)),Lt.multiplyQuaternions(xi,Lt),o.quaternion.copy(Lt)),o.name==="Z"&&(Lt.setFromAxisAngle(Nr,Math.atan2(vt.y,vt.x)),Lt.multiplyQuaternions(xi,Lt),o.quaternion.copy(Lt))),o.visible=o.visible&&(o.name.indexOf("X")===-1||this.showX),o.visible=o.visible&&(o.name.indexOf("Y")===-1||this.showY),o.visible=o.visible&&(o.name.indexOf("Z")===-1||this.showZ),o.visible=o.visible&&(o.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis||this.axis.split("").some(function(c){return o.name===c}))&&(o.material.color.setHex(16776960),o.material.opacity=1)}super.updateMatrixWorld(t)}}class wu extends lt{constructor(){super(new Ro(1e5,1e5,2,2),new Xn({visible:!1,wireframe:!0,side:Yr,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(t){let e=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(e="local"),Di.copy(br).applyQuaternion(e==="local"?this.worldQuaternion:Yi),Sr.copy(In).applyQuaternion(e==="local"?this.worldQuaternion:Yi),Pr.copy(Nr).applyQuaternion(e==="local"?this.worldQuaternion:Yi),vt.copy(Sr),this.mode){case"translate":case"scale":switch(this.axis){case"X":vt.copy(this.eye).cross(Di),Ne.copy(Di).cross(vt);break;case"Y":vt.copy(this.eye).cross(Sr),Ne.copy(Sr).cross(vt);break;case"Z":vt.copy(this.eye).cross(Pr),Ne.copy(Pr).cross(vt);break;case"XY":Ne.copy(Pr);break;case"YZ":Ne.copy(Di);break;case"XZ":vt.copy(Pr),Ne.copy(Sr);break;case"XYZ":case"E":Ne.set(0,0,0);break}break;case"rotate":default:Ne.set(0,0,0)}Ne.length()===0?this.quaternion.copy(this.cameraQuaternion):($a.lookAt(Qt.set(0,0,0),Ne,vt),this.quaternion.setFromRotationMatrix($a)),super.updateMatrixWorld(t)}}class bo{constructor(t,e,n,s,o,a=5,c=!0){if(R(this,"onDraggingStarted",new at),R(this,"onDraggingEnded",new at),R(this,"onDisposed",new at),R(this,"normal"),R(this,"origin"),R(this,"three",new zi),R(this,"_helper"),R(this,"_visible",!0),R(this,"_enabled",!0),R(this,"components"),R(this,"world"),R(this,"_controlsActive",!1),R(this,"_arrowBoundBox",new lt),R(this,"_planeMesh"),R(this,"_controls"),R(this,"_hiddenMaterial",new Xn({visible:!1})),R(this,"update",async()=>{this._enabled&&this.three.setFromNormalAndCoplanarPoint(this.normal,this._helper.position)}),R(this,"changeDrag",h=>{this._visible=!h.value,this.preventCameraMovement(),this.notifyDraggingChanged(h)}),this.components=t,this.world=e,!e.renderer)throw new Error("The given world must have a renderer!");this.normal=s,this.origin=n,e.renderer.setPlane(!0,this.three),this._planeMesh=bo.newPlaneMesh(a,o),this._helper=this.newHelper(),this._controls=this.newTransformControls(),this.three.setFromNormalAndCoplanarPoint(s,n),c&&this.toggleControls(!0)}get enabled(){return this._enabled}set enabled(t){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");this._enabled=t,this.world.renderer.setPlane(t,this.three)}get visible(){return this._visible}set visible(t){this._visible=t,this._controls.visible=t,this._helper.visible=t,this.toggleControls(t)}get meshes(){return[this._planeMesh,this._arrowBoundBox]}get planeMaterial(){return this._planeMesh.material}set planeMaterial(t){this._planeMesh.material=t}get size(){return this._planeMesh.scale.x}set size(t){this._planeMesh.scale.set(t,t,t)}get helper(){return this._helper}async setFromNormalAndCoplanarPoint(t,e){this.reset(),this.normal.equals(t)||(this.normal.copy(t),this._helper.lookAt(t)),this.origin.copy(e),this._helper.position.copy(e),this._helper.updateMatrix(),await this.update()}dispose(){this._enabled=!1,this.onDraggingStarted.reset(),this.onDraggingEnded.reset(),this._helper.removeFromParent(),this.world.renderer&&this.world.renderer.setPlane(!1,this.three),this._arrowBoundBox.removeFromParent(),this._arrowBoundBox.geometry.dispose(),this._planeMesh.geometry.dispose(),this._controls.removeFromParent(),this._controls.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}reset(){const t=new q(1,0,0),e=new q;this.normal.equals(t)||(this.normal.copy(t),this._helper.lookAt(t)),this.origin.copy(e),this._helper.position.copy(e),this._helper.updateMatrix()}toggleControls(t){if(t){if(this._controlsActive)return;this._controls.addEventListener("change",this.update),this._controls.addEventListener("dragging-changed",this.changeDrag)}else this._controls.removeEventListener("change",this.update),this._controls.removeEventListener("dragging-changed",this.changeDrag);this._controlsActive=t}newTransformControls(){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");const t=this.world.camera.three,e=this.world.renderer.three.domElement,n=new gu(t,e);return this.initializeControls(n),this.world.scene.three.add(n),n}initializeControls(t){t.attach(this._helper),t.showX=!1,t.showY=!1,t.setSpace("local"),this.createArrowBoundingBox(),t.children[0].children[0].add(this._arrowBoundBox)}createArrowBoundingBox(){this._arrowBoundBox.geometry=new ee(.18,.18,1.2),this._arrowBoundBox.material=this._hiddenMaterial,this._arrowBoundBox.rotateX(Math.PI/2),this._arrowBoundBox.updateMatrix(),this._arrowBoundBox.geometry.applyMatrix4(this._arrowBoundBox.matrix)}notifyDraggingChanged(t){t.value?this.onDraggingStarted.trigger():this.onDraggingEnded.trigger()}preventCameraMovement(){this.world.camera.enabled=this._visible}newHelper(){const t=new xr;return t.lookAt(this.normal),t.position.copy(this.origin),this._planeMesh.position.z+=.01,t.add(this._planeMesh),this.world.scene.three.add(t),t}static newPlaneMesh(t,e){const n=new Ro(1),s=new lt(n,e);return s.scale.set(t,t,t),s}}const vu=class uo extends re{constructor(t){super(t),R(this,"onAfterCreate",new at),R(this,"onAfterDelete",new at),R(this,"onBeforeDrag",new at),R(this,"onAfterDrag",new at),R(this,"onBeforeCreate",new at),R(this,"onBeforeCancel",new at),R(this,"onAfterCancel",new at),R(this,"onBeforeDelete",new at),R(this,"onDisposed",new at),R(this,"orthogonalY",!1),R(this,"toleranceOrthogonalY",.7),R(this,"planes",[]),R(this,"PlaneType"),R(this,"_material",new Xn({color:16776960,side:Yr,transparent:!0,opacity:.2})),R(this,"_size",5),R(this,"_enabled",!1),R(this,"_visible",!1),R(this,"_onStartDragging",()=>{this.onBeforeDrag.trigger()}),R(this,"_onEndDragging",()=>{this.onAfterDrag.trigger()}),this.components.add(uo.uuid,this),this.PlaneType=bo}get enabled(){return this._enabled}set enabled(t){this._enabled=t;for(const e of this.planes)e.enabled=t;this.updateMaterialsAndPlanes()}get visible(){return this._visible}set visible(t){this._visible=t;for(const e of this.planes)e.visible=t}get material(){return this._material}set material(t){this._material=t;for(const e of this.planes)e.planeMaterial=t}get size(){return this._size}set size(t){this._size=t;for(const e of this.planes)e.size=t}endCreation(){}cancelCreation(){}dispose(){this._enabled=!1;for(const t of this.planes)t.dispose();this.planes.length=0,this._material.dispose(),this.onBeforeCreate.reset(),this.onBeforeCancel.reset(),this.onBeforeDelete.reset(),this.onBeforeDrag.reset(),this.onAfterCreate.reset(),this.onAfterCancel.reset(),this.onAfterDelete.reset(),this.onAfterDrag.reset(),this.onDisposed.trigger(uo.uuid),this.onDisposed.reset()}create(t){if(!this.enabled)return;const e=this.components.get(Ua).get(t).castRay();e&&this.createPlaneFromIntersection(t,e)}createFromNormalAndCoplanarPoint(t,e,n){const s=this.newPlane(t,n,e);return this.updateMaterialsAndPlanes(),s}delete(t,e){this.enabled&&(e||(e=this.pickPlane(t)),e&&this.deletePlane(e))}deleteAll(){for(;this.planes.length>0;){const t=this.planes[0];this.delete(t.world,t)}}deletePlane(t){const e=this.planes.indexOf(t);if(e!==-1){if(this.planes.splice(e,1),!t.world.renderer)throw new Error("Renderer not found for this plane's world!");t.world.renderer.setPlane(!1,t.three),t.dispose(),this.updateMaterialsAndPlanes(),this.onAfterDelete.trigger(t)}}pickPlane(t){const e=this.components.get(Ua).get(t),n=this.getAllPlaneMeshes(),s=e.castRay(n);if(s){const o=s.object;return this.planes.find(a=>a.meshes.includes(o))}}getAllPlaneMeshes(){const t=[];for(const e of this.planes)t.push(...e.meshes);return t}createPlaneFromIntersection(t,e){var n;if(!t.renderer)throw new Error("The given world must have a renderer!");const s=e.point.distanceTo(new q(0,0,0)),o=(n=e.face)==null?void 0:n.normal;if(!s||!o)return;const a=this.getWorldNormal(e,o),c=this.newPlane(t,e.point,a.negate());t.renderer.setPlane(!0,c.three),this.updateMaterialsAndPlanes()}getWorldNormal(t,e){const n=t.object;let s=t.object.matrixWorld.clone();if(n instanceof jn&&t.instanceId!==void 0){const c=new Mt;n.getMatrixAt(t.instanceId,c),s=c.multiply(s)}const o=new mn().getNormalMatrix(s),a=e.clone().applyMatrix3(o).normalize();return this.normalizePlaneDirectionY(a),a}normalizePlaneDirectionY(t){this.orthogonalY&&(t.y>this.toleranceOrthogonalY&&(t.x=0,t.y=1,t.z=0),t.y<-this.toleranceOrthogonalY&&(t.x=0,t.y=-1,t.z=0))}newPlane(t,e,n){const s=this.newPlaneInstance(t,e,n);return s.onDraggingStarted.add(this._onStartDragging),s.onDraggingEnded.add(this._onEndDragging),this.planes.push(s),this.onAfterCreate.trigger(s),s}newPlaneInstance(t,e,n){return new this.PlaneType(this.components,t,e,n,this._material)}updateMaterialsAndPlanes(){const t=this.components.get(Ml);for(const[e,n]of t.list){if(!n.renderer)continue;n.renderer.updateClippingPlanes();const{clippingPlanes:s}=n.renderer;for(const o of n.meshes)if(Array.isArray(o.material))for(const a of o.material)a.clippingPlanes=s;else o.material.clippingPlanes=s}}};R(vu,"uuid","66290bc5-18c4-4cd1-9379-2e17a0617611");const Su=class po extends re{constructor(t){super(t),R(this,"enabled",!0),R(this,"_originalBackground",new Map),R(this,"onDisposed",new at),R(this,"list",{}),R(this,"_originals",{}),this.components.add(po.uuid,this)}set(t,e=Object.keys(this.list)){for(const n of e){const{material:s,meshes:o}=this.list[n];for(const a of o)if(t)this._originals[a.uuid]||(this._originals[a.uuid]={material:a.material}),a instanceof jn&&a.instanceColor&&(this._originals[a.uuid].instances=a.instanceColor,a.instanceColor=null),a.material=s;else{if(!this._originals[a.uuid])continue;a.material=this._originals[a.uuid].material;const c=this._originals[a.uuid].instances;a instanceof jn&&c&&(a.instanceColor=c)}}}dispose(){for(const t in this.list){const{material:e}=this.list[t];e.dispose()}this.list={},this._originals={},this.onDisposed.trigger(po.uuid),this.onDisposed.reset(),this._originalBackground.clear()}setBackgroundColor(t,e){const n=e.scene.three;n instanceof Mr&&(this._originalBackground.has(e.uuid)||this._originalBackground.set(e.uuid,n.background),this._originalBackground&&(n.background=t))}resetBackgroundColor(t){const e=t.scene.three;if(!(e instanceof Mr))return;const n=this._originalBackground.get(t.uuid);n&&(e.background=n)}addMaterial(t,e){if(this.list[t])throw new Error("This ID already exists!");this.list[t]={material:e,meshes:new Set}}addMeshes(t,e){if(!this.list[t])throw new Error("This ID doesn't exists!");for(const n of e)this.list[t].meshes.add(n)}removeMeshes(t,e){if(!this.list[t])throw new Error("This ID doesn't exists!");for(const n of e)this.list[t].meshes.delete(n)}};R(Su,"uuid","24989d27-fa2f-4797-8b08-35918f74e502");function Pu(u,t,e,n){return new Promise((s,o)=>{function a(){const c=u.clientWaitSync(t,e,0);if(c===u.WAIT_FAILED){o();return}if(c===u.TIMEOUT_EXPIRED){setTimeout(a,n);return}s()}a()})}async function bu(u,t,e,n,s,o,a){const c=u.fenceSync(u.SYNC_GPU_COMMANDS_COMPLETE,0);u.flush(),await Pu(u,c,0,10),u.deleteSync(c),u.bindBuffer(t,e),u.getBufferSubData(t,n,s,o,a),u.bindBuffer(t,null)}async function Nu(u,t,e,n,s,o,a,c){const h=u.createBuffer();return u.bindBuffer(u.PIXEL_PACK_BUFFER,h),u.bufferData(u.PIXEL_PACK_BUFFER,c.byteLength,u.STREAM_READ),u.readPixels(t,e,n,s,o,a,0),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),await bu(u,u.PIXEL_PACK_BUFFER,h,0,c),u.deleteBuffer(h),c}class Lu{constructor(t,e,n){if(R(this,"onDisposed",new at),R(this,"onViewUpdated",new at),R(this,"enabled",!0),R(this,"needsUpdate",!1),R(this,"renderDebugFrame",!1),R(this,"components"),R(this,"world"),R(this,"renderer"),R(this,"autoUpdate",!0),R(this,"updateInterval",1e3),R(this,"worker"),R(this,"scene",new Mr),R(this,"_width",512),R(this,"_height",512),R(this,"_availableColor",1),R(this,"renderTarget"),R(this,"bufferSize"),R(this,"_buffer"),R(this,"updateVisibility",async a=>{if(!this.enabled||!this.needsUpdate&&!a)return;const c=this.world.camera.three;c.updateMatrix(),this.renderer.setSize(this._width,this._height),this.renderer.setRenderTarget(this.renderTarget),this.renderer.render(this.scene,c);const h=this.renderer.getContext();await Nu(h,0,0,this._width,this._height,h.RGBA,h.UNSIGNED_BYTE,this._buffer),this.renderer.setRenderTarget(null),this.renderDebugFrame&&this.renderer.render(this.scene,c),this.worker.postMessage({buffer:this._buffer}),this.needsUpdate=!1}),!e.renderer)throw new Error("The given world must have a renderer!");this.components=t,this.applySettings(n),this.world=e,this.renderer=new Js,this.renderTarget=new Dc(this._width,this._height),this.bufferSize=this._width*this._height*4,this._buffer=new Uint8Array(this.bufferSize),this.renderer.clippingPlanes=e.renderer.clippingPlanes;const s=`
      addEventListener("message", (event) => {
        const { buffer } = event.data;
        const colors = new Map();
        for (let i = 0; i < buffer.length; i += 4) {
          const r = buffer[i];
          const g = buffer[i + 1];
          const b = buffer[i + 2];
          const code = "" + r + "-" + g + "-" + b;
          if(colors.has(code)) {
            colors.set(code, colors.get(code) + 1);
          } else {
            colors.set(code, 1);
          }
        }
        postMessage({ colors });
      });
    `,o=new Blob([s],{type:"application/javascript"});this.worker=new Worker(URL.createObjectURL(o))}dispose(){this.enabled=!1;for(const t of this.scene.children)t.removeFromParent();this.onViewUpdated.reset(),this.worker.terminate(),this.renderer.dispose(),this.renderTarget.dispose(),this._buffer=null,this.onDisposed.reset()}getAvailableColor(){let t=BigInt(this._availableColor.toString());const e=[];do e.unshift(Number(t%256n)),t/=256n;while(t);for(;e.length!==3;)e.unshift(0);const[n,s,o]=e,a=`${n}-${s}-${o}`;return{r:n,g:s,b:o,code:a}}increaseColor(){if(this._availableColor===256*256*256){console.warn("Color can't be increased over 256 x 256 x 256!");return}this._availableColor++}decreaseColor(){if(this._availableColor===1){console.warn("Color can't be decreased under 0!");return}this._availableColor--}applySettings(t){t&&(t.updateInterval!==void 0&&(this.updateInterval=t.updateInterval),t.height!==void 0&&(this._height=t.height),t.width!==void 0&&(this._width=t.width),t.autoUpdate!==void 0&&(this.autoUpdate=t.autoUpdate))}}class Mu extends Lu{constructor(t,e,n){super(t,e,n),R(this,"threshold",100),R(this,"onViewUpdated",new at),R(this,"colorMeshes",new Map),R(this,"isProcessing",!1),R(this,"_colorCodeMeshMap",new Map),R(this,"_meshIDColorCodeMap",new Map),R(this,"_currentVisibleMeshes",new Set),R(this,"_recentlyHiddenMeshes",new Set),R(this,"_transparentMat",new Xn({transparent:!0,opacity:0})),R(this,"handleWorkerMessage",async s=>{if(this.isProcessing)return;const o=s.data.colors;this._recentlyHiddenMeshes=new Set(this._currentVisibleMeshes),this._currentVisibleMeshes.clear();for(const[a,c]of o){if(c<this.threshold)continue;const h=this._colorCodeMeshMap.get(a);h&&(this._currentVisibleMeshes.add(h),this._recentlyHiddenMeshes.delete(h))}this.onViewUpdated.trigger({seen:this._currentVisibleMeshes,unseen:this._recentlyHiddenMeshes})}),this.worker.addEventListener("message",this.handleWorkerMessage),this.autoUpdate&&window.setInterval(async()=>{this.isProcessing||await this.updateVisibility()},this.updateInterval),this.onViewUpdated.add(({seen:s,unseen:o})=>{for(const a of s)a.visible=!0;for(const a of o)a.visible=!1})}dispose(){super.dispose(),this._currentVisibleMeshes.clear(),this._recentlyHiddenMeshes.clear(),this._meshIDColorCodeMap.clear(),this._transparentMat.dispose(),this._colorCodeMeshMap.clear();const t=this.components.get(Qn);for(const e in this.colorMeshes){const n=this.colorMeshes.get(e);n&&t.destroy(n,!0)}this.colorMeshes.clear()}add(t){if(!this.enabled)return;if(this.isProcessing){console.log("Culler processing not finished yet.");return}this.isProcessing=!0;const e=t instanceof jn,{geometry:n,material:s}=t,{colorMaterial:o,code:a}=this.getAvailableMaterial();let c;if(Array.isArray(s)){let C=!0;const I=[];for(const f of s)Da.isTransparent(f)?I.push(this._transparentMat):(C=!1,I.push(o));if(C){o.dispose(),this.isProcessing=!1;return}c=I}else if(Da.isTransparent(s)){o.dispose(),this.isProcessing=!1;return}else c=o;this._colorCodeMeshMap.set(a,t),this._meshIDColorCodeMap.set(t.uuid,a);const h=e?t.count:1,p=new jn(n,c,h);e?p.instanceMatrix=t.instanceMatrix:p.setMatrixAt(0,new Mt),t.visible=!1,p.applyMatrix4(t.matrix),p.updateMatrix(),this.scene.add(p),this.colorMeshes.set(t.uuid,p),this.increaseColor(),this.isProcessing=!1}remove(t){if(this.isProcessing){console.log("Culler processing not finished yet.");return}this.isProcessing=!0;const e=this.components.get(Qn);this._currentVisibleMeshes.delete(t),this._recentlyHiddenMeshes.delete(t);const n=this.colorMeshes.get(t.uuid),s=this._meshIDColorCodeMap.get(t.uuid);if(!n||!s){this.isProcessing=!1,console.log(t.visible);return}this._colorCodeMeshMap.delete(s),this._meshIDColorCodeMap.delete(t.uuid),this.colorMeshes.delete(t.uuid),n.geometry=void 0,n.material=[],e.destroy(n,!0),this._recentlyHiddenMeshes.delete(t),this._currentVisibleMeshes.delete(t),this.isProcessing=!1}getAvailableMaterial(){const{r:t,g:e,b:n,code:s}=this.getAvailableColor(),o=bs.enabled;bs.enabled=!1;const a=new Kn(`rgb(${t}, ${e}, ${n})`);if(!this.world.renderer)throw new Error("Renderer not found in the world!");const c=this.world.renderer.clippingPlanes,h=new Xn({color:a,clippingPlanes:c,side:Yr});return bs.enabled=o,{colorMaterial:h,code:s}}}const xu=class Eo extends re{constructor(t){super(t),R(this,"_enabled",!0),R(this,"list",new Map),R(this,"onDisposed",new at),t.add(Eo.uuid,this)}get enabled(){return this._enabled}set enabled(t){this._enabled=t;for(const[e,n]of this.list)n.enabled=t}create(t,e){if(this.list.has(t.uuid))return this.list.get(t.uuid);const n=new Mu(this.components,t,e);return this.list.set(t.uuid,n),n}delete(t){const e=this.list.get(t.uuid);e&&e.dispose(),this.list.delete(t.uuid)}dispose(){this.enabled=!1,this.onDisposed.trigger(Eo.uuid),this.onDisposed.reset();for(const[t,e]of this.list)e.dispose();this.list.clear()}};R(xu,"uuid","69f2a50d-c266-44fc-b1bd-fa4d34be89e6");const Du=class Ge extends re{constructor(t){super(t),R(this,"enabled",!0),R(this,"onDisposed",new at),R(this,"_absoluteMin"),R(this,"_absoluteMax"),R(this,"_meshes",[]),this.components.add(Ge.uuid,this),this._absoluteMin=Ge.newBound(!0),this._absoluteMax=Ge.newBound(!1)}static getDimensions(t){const{min:e,max:n}=t,s=Math.abs(n.x-e.x),o=Math.abs(n.y-e.y),a=Math.abs(n.z-e.z),c=new q;return c.subVectors(n,e).divideScalar(2).add(e),{width:s,height:o,depth:a,center:c}}static newBound(t){const e=t?1:-1;return new q(e*Number.MAX_VALUE,e*Number.MAX_VALUE,e*Number.MAX_VALUE)}static getBounds(t,e,n){const s=n||this.newBound(!1),o=e||this.newBound(!0);for(const a of t)a.x<o.x&&(o.x=a.x),a.y<o.y&&(o.y=a.y),a.z<o.z&&(o.z=a.z),a.x>s.x&&(s.x=a.x),a.y>s.y&&(s.y=a.y),a.z>s.z&&(s.z=a.z);return new $t(e,n)}dispose(){const t=this.components.get(Qn);for(const e of this._meshes)t.destroy(e);this._meshes=[],this.onDisposed.trigger(Ge.uuid),this.onDisposed.reset()}get(){const t=this._absoluteMin.clone(),e=this._absoluteMax.clone();return new $t(t,e)}getSphere(){const t=this._absoluteMin.clone(),e=this._absoluteMax.clone(),n=Math.abs((e.x-t.x)/2),s=Math.abs((e.y-t.y)/2),o=Math.abs((e.z-t.z)/2),a=new q(t.x+n,t.y+s,t.z+o),c=a.distanceTo(t);return new yo(a,c)}getMesh(){const t=new $t(this._absoluteMin,this._absoluteMax),e=Ge.getDimensions(t),{width:n,height:s,depth:o,center:a}=e,c=new Zt(n,s,o),h=new lt(c);return this._meshes.push(h),h.position.copy(a),h}reset(){this._absoluteMin=Ge.newBound(!0),this._absoluteMax=Ge.newBound(!1)}add(t){for(const e of t.items)this.addMesh(e.mesh)}addMesh(t){if(!t.geometry.index)return;const e=Ge.getFragmentBounds(t);t.updateMatrixWorld();const n=t.matrixWorld,s=new Mt,o=t instanceof jn,a=o?t.count:1;for(let c=0;c<a;c++){const h=e.min.clone(),p=e.max.clone();o&&(t.getMatrixAt(c,s),h.applyMatrix4(s),p.applyMatrix4(s)),h.applyMatrix4(n),p.applyMatrix4(n),h.x<this._absoluteMin.x&&(this._absoluteMin.x=h.x),h.y<this._absoluteMin.y&&(this._absoluteMin.y=h.y),h.z<this._absoluteMin.z&&(this._absoluteMin.z=h.z),h.x>this._absoluteMax.x&&(this._absoluteMax.x=h.x),h.y>this._absoluteMax.y&&(this._absoluteMax.y=h.y),h.z>this._absoluteMax.z&&(this._absoluteMax.z=h.z),p.x>this._absoluteMax.x&&(this._absoluteMax.x=p.x),p.y>this._absoluteMax.y&&(this._absoluteMax.y=p.y),p.z>this._absoluteMax.z&&(this._absoluteMax.z=p.z),p.x<this._absoluteMin.x&&(this._absoluteMin.x=p.x),p.y<this._absoluteMin.y&&(this._absoluteMin.y=p.y),p.z<this._absoluteMin.z&&(this._absoluteMin.z=p.z)}}static getFragmentBounds(t){const e=t.geometry.attributes.position,n=Number.MAX_VALUE,s=-n,o=new q(n,n,n),a=new q(s,s,s);if(!t.geometry.index)throw new Error("Geometry must be indexed!");const c=Array.from(t.geometry.index.array);for(let h=0;h<c.length;h++){if(h%3===0&&c[h]===0&&c[h+1]===0&&c[h+2]===0){h+=2;continue}const p=c[h],C=e.getX(p),I=e.getY(p),f=e.getZ(p);C<o.x&&(o.x=C),I<o.y&&(o.y=I),f<o.z&&(o.z=f),C>a.x&&(a.x=C),I>a.y&&(a.y=I),f>a.z&&(a.z=f)}return new $t(o,a)}};R(Du,"uuid","d1444724-dba6-4cdd-a0c7-68ee1450d166");const Dl=class Ul extends re{constructor(t){super(t),R(this,"onDisposed",new at),R(this,"onFragmentsLoaded",new at),R(this,"onFragmentsDisposed",new at),R(this,"list",new Map),R(this,"groups",new Map),R(this,"enabled",!0),R(this,"baseCoordinationModel",""),R(this,"_loader",new Cl),this.components.add(Ul.uuid,this)}get meshes(){const t=[];for(const[e,n]of this.list)t.push(n.mesh);return t}dispose(){for(const[t,e]of this.groups)e.dispose(!0);this.baseCoordinationModel="",this.groups.clear(),this.list.clear(),this.onFragmentsLoaded.reset(),this.onFragmentsDisposed.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}disposeGroup(t){const{uuid:e}=t,n=[];for(const s of t.items)n.push(s.id),this.list.delete(s.id);t.dispose(!0),this.groups.delete(t.uuid),this.onFragmentsDisposed.trigger({groupID:e,fragmentIDs:n})}load(t,e=!0){const n=this._loader.import(t);for(const s of n.items)s.group=n,this.list.set(s.id,s);return e&&this.coordinate([n]),this.groups.set(n.uuid,n),this.onFragmentsLoaded.trigger(n),n}export(t){return this._loader.export(t)}coordinate(t=Array.from(this.groups.values())){if(this.baseCoordinationModel.length===0){const n=t.pop();if(!n)return;this.baseCoordinationModel=n.uuid}if(!t.length)return;const e=this.groups.get(this.baseCoordinationModel);if(!e){console.log("No base model found for coordination!");return}for(const n of t)n!==e&&(n.position.set(0,0,0),n.rotation.set(0,0,0),n.scale.set(1,1,1),n.updateMatrix(),n.applyMatrix4(n.coordinationMatrix.clone().invert()),n.applyMatrix4(e.coordinationMatrix))}};R(Dl,"uuid","fef46874-46a3-461b-8c44-2922ab77c806");let fo=Dl;class Uu{constructor(){R(this,"factor",1),R(this,"complement",1)}apply(t){const e=this.getScaleMatrix().multiply(t);t.copy(e)}setUp(t){var e;this.factor=1;const n=this.getLengthUnits(t);if(!n)return;const s=n==null,o=n.Name===void 0||n.Name===null;s||o||(n.Name.value==="FOOT"?this.factor=.3048:((e=n.Prefix)==null?void 0:e.value)==="MILLI"&&(this.complement=.001))}getLengthUnits(t){try{const e=t.GetLineIDsWithType(0,Uc).get(0),n=t.GetLine(0,e);for(const s of n.Units){if(!s||s.value===null||s.value===void 0)continue;const o=t.GetLine(0,s.value);if(o.UnitType&&o.UnitType.value==="LENGTHUNIT")return o}return null}catch{return console.log("Could not get units"),null}}getScaleMatrix(){const t=this.factor;return new Mt().fromArray([t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1])}}class Bl{constructor(){R(this,"itemsByFloor",{}),R(this,"_units",new Uu)}setUp(t){this._units.setUp(t),this.cleanUp();try{const e=t.GetLineIDsWithType(0,Fo),n=new Set,s=t.GetLineIDsWithType(0,$n);for(let p=0;p<s.size();p++)n.add(s.get(p));const o=t.GetLineIDsWithType(0,bc),a=o.size();for(let p=0;p<a;p++){const C=o.get(p),I=t.GetLine(0,C);if(!I||!I.RelatingObject||!I.RelatedObjects)continue;const f=I.RelatingObject.value,T=I.RelatedObjects;for(const A of T){const F=A.value;n.has(F)&&(this.itemsByFloor[F]=f)}}const c={},h=e.size();for(let p=0;p<h;p++){const C=e.get(p),I=t.GetLine(0,C);if(!I||!I.RelatingStructure||!I.RelatedElements)continue;const f=I.RelatingStructure.value,T=I.RelatedElements;if(n.has(f))for(const A of T){c[f]||(c[f]=[]);const F=A.value;c[f].push(F)}else for(const A of T){const F=A.value;this.itemsByFloor[F]=f}}for(const p in c){const C=this.itemsByFloor[p];if(C!==void 0){const I=c[p];for(const f of I)this.itemsByFloor[f]=C}}for(let p=0;p<a;p++){const C=o.get(p),I=t.GetLine(0,C);if(!I||!I.RelatingObject||!I.RelatedObjects)continue;const f=I.RelatingObject.value,T=I.RelatedObjects;for(const A of T){const F=A.value,_=this.itemsByFloor[f];_!==void 0&&(this.itemsByFloor[F]=_)}}}catch{console.log("Could not get floors.")}}cleanUp(){this.itemsByFloor={}}}class No{constructor(){R(this,"includeProperties",!0),R(this,"optionalCategories",[$n]),R(this,"coordinate",!0),R(this,"wasm",{path:"",absolute:!1,logLevel:Nc.LOG_LEVEL_OFF}),R(this,"excludedCategories",new Set),R(this,"saveLocations",!1),R(this,"webIfc",{COORDINATE_TO_ORIGIN:!0,OPTIMIZE_PROFILES:!0}),R(this,"autoSetWasm",!0),R(this,"customLocateFileHandler",null)}}class Yl{constructor(){R(this,"defLineMat",new dl({color:16777215}))}read(t){const e=t.GetAllAlignments(0),n=t.GetAllCrossSections2D(0),s=t.GetAllCrossSections3D(0),o={IfcAlignment:e,IfcCrossSection2D:n,IfcCrossSection3D:s};return this.get(o)}get(t){if(t.IfcAlignment){const e=new Map;for(const n of t.IfcAlignment){const s=new Gc;s.absolute=this.getCurves(n.curve3D,s),s.horizontal=this.getCurves(n.horizontal,s),s.vertical=this.getCurves(n.vertical,s),e.set(e.size,s)}return{alignments:e,coordinationMatrix:new Mt}}}getCurves(t,e){const n=[];let s=0;for(const o of t){const a={};if(o.data)for(const f of o.data){const[T,A]=f.split(": "),F=parseFloat(A);a[T]=F||A}const{points:c}=o,h=new Float32Array(c.length*3);for(let f=0;f<c.length;f++){const{x:T,y:A,z:F}=c[f];h[f*3]=T,h[f*3+1]=A,h[f*3+2]=F||0}const p=new Zn(h,3),C=new Lc;C.setAttribute("position",p);const I=new kc(s,a,e,C,this.defLineMat);n.push(I.curve),s++}return n}}class kl{get(t,e){let n="";const s=t.GetHeaderLine(0,e)||"";if(!s)return n;for(const o of s.arguments)if(o!=null)if(Array.isArray(o))for(const a of o)n+=`${a.value}|`;else n+=`${o.value}|`;return n}}const Gl=new Set([1123145078,574549367,1675464909,2059837836,3798115385,32440307,3125803723,3207858831,2740243338,2624227202,4240577450,3615266464,3724593414,220341763,477187591,1878645084,1300840506,3303107099,1607154358,1878645084,846575682,1351298697,2417041796,3049322572,3331915920,1416205885,776857604,3285139300,3958052878,2827736869,2732653382,673634403,3448662350,4142052618,2924175390,803316827,2556980723,1809719519,2205249479,807026263,3737207727,1660063152,2347385850,3940055652,2705031697,3732776249,2485617015,2611217952,1704287377,2937912522,2770003689,1281925730,1484403080,3448662350,4142052618,3800577675,4006246654,3590301190,1383045692,2775532180,2047409740,370225590,3593883385,2665983363,4124623270,812098782,3649129432,987898635,1105321065,3510044353,1635779807,2603310189,3406155212,1310608509,4261334040,2736907675,3649129432,1136057603,1260505505,4182860854,2713105998,2898889636,59481748,3749851601,3486308946,3150382593,1062206242,3264961684,15328376,1485152156,370225590,1981873012,2859738748,45288368,2614616156,2732653382,775493141,2147822146,2601014836,2629017746,1186437898,2367409068,1213902940,3632507154,3900360178,476780140,1472233963,2804161546,3008276851,738692330,374418227,315944413,3905492369,3570813810,2571569899,178912537,2294589976,1437953363,2133299955,572779678,3092502836,388784114,2624227202,1425443689,3057273783,2347385850,1682466193,2519244187,2839578677,3958567839,2513912981,2830218821,427810014]);class Bu{async export(t,e,n=!1,s=!0){const o={},a=new Set(t.GetIfcEntityList(e)),c=new Set([pl,El,fl,Il,$n]);for(const h of c)a.add(h);for(const h of a){if(Gl.has(h))continue;const p=c.has(h)&&s,C=t.GetLineIDsWithType(e,h);for(const I of C){const f=t.GetLine(0,I,p,n);o[f.expressID]=f}}return o}}const Vl=class Io extends re{constructor(t){super(t),R(this,"onIfcLoaded",new at),R(this,"onIfcStartedLoading",new at),R(this,"onSetup",new at),R(this,"onDisposed",new at),R(this,"settings",new No),R(this,"enabled",!0),R(this,"webIfc",new qn),R(this,"_material",new ua),R(this,"_spatialTree",new Bl),R(this,"_metaData",new kl),R(this,"_fragmentInstances",new Map),R(this,"_civil",new Yl),R(this,"_propertyExporter",new Bu),R(this,"_visitedFragments",new Map),R(this,"_materialT",new ua({transparent:!0,opacity:.5})),this.components.add(Io.uuid,this),this.settings.excludedCategories.add(al)}dispose(){this.onIfcLoaded.reset(),this.webIfc=null,this.onDisposed.trigger(Io.uuid),this.onDisposed.reset()}async setup(t){this.settings={...this.settings,...t},this.settings.autoSetWasm&&await this.autoSetWasm(),this.onSetup.trigger()}async load(t,e=!0){const n=performance.now();this.onIfcStartedLoading.trigger(),await this.readIfcFile(t);const s=await this.getAllGeometries(),o=await this._propertyExporter.export(this.webIfc,0);s.setLocalProperties(o),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-n} ms!`);const a=this.components.get(fo);a.groups.set(s.uuid,s);for(const c of s.items)a.list.set(c.id,c),c.mesh.uuid=c.id,c.group=s;return e&&a.coordinate([s]),this.onIfcLoaded.trigger(s),s}async readIfcFile(t){const{path:e,absolute:n,logLevel:s}=this.settings.wasm;return this.webIfc.SetWasmPath(e,n),await this.webIfc.Init(),s&&this.webIfc.SetLogLevel(s),this.webIfc.OpenModel(t,this.settings.webIfc)}async getAllGeometries(){this._spatialTree.setUp(this.webIfc);const t=this.webIfc.GetIfcEntityList(0),e=new Tl,{FILE_NAME:n,FILE_DESCRIPTION:s}=Re;e.ifcMetadata={name:this._metaData.get(this.webIfc,n),description:this._metaData.get(this.webIfc,s),schema:this.webIfc.GetModelSchema(0)||"IFC2X3",maxExpressID:this.webIfc.GetMaxExpressID(0)};const o=[];for(const c of t){if(!this.webIfc.IsIfcElement(c)&&c!==$n||this.settings.excludedCategories.has(c))continue;const h=this.webIfc.GetLineIDsWithType(0,c),p=h.size();for(let C=0;C<p;C++){const I=h.get(C);o.push(I);const f=this._spatialTree.itemsByFloor[I]||0;e.data.set(I,[[],[f,c]])}}this._spatialTree.cleanUp(),this.webIfc.StreamMeshes(0,o,c=>{this.getMesh(c,e)});for(const c of this._visitedFragments){const{index:h,fragment:p}=c[1];e.keyFragments.set(h,p.id)}for(const c of e.items){const h=this._fragmentInstances.get(c.id);if(!h)throw new Error("Fragment not found!");const p=[];for(const[C,I]of h)p.push(I);c.add(p)}const a=this.webIfc.GetCoordinationMatrix(0);return e.coordinationMatrix.fromArray(a),e.civilData=this._civil.read(this.webIfc),e}cleanUp(){this.webIfc=null,this.webIfc=new qn,this._visitedFragments.clear(),this._fragmentInstances.clear()}getMesh(t,e){const n=t.geometries.size(),s=t.expressID;for(let o=0;o<n;o++){const a=t.geometries.get(o),{x:c,y:h,z:p,w:C}=a.color,I=C!==1,{geometryExpressID:f}=a,T=`${f}-${I}`;if(!this._visitedFragments.has(T)){const y=this.getGeometry(this.webIfc,f),L=I?this._materialT:this._material,k=new Yc(y,L,1);e.add(k.mesh),e.items.push(k);const V=this._visitedFragments.size;this._visitedFragments.set(T,{index:V,fragment:k})}const A=new Kn().setRGB(c,h,p,"srgb"),F=new Mt;F.fromArray(a.flatTransformation);const _=this._visitedFragments.get(T);if(_===void 0)throw new Error("Error getting geometry data for streaming!");const w=e.data.get(s);if(!w)throw new Error("Data not found!");w[0].push(_.index);const{fragment:v}=_;this._fragmentInstances.has(v.id)||this._fragmentInstances.set(v.id,new Map);const Y=this._fragmentInstances.get(v.id);if(!Y)throw new Error("Instances not found!");if(Y.has(s)){const y=Y.get(s);if(!y)throw new Error("Instance not found!");y.transforms.push(F),y.colors&&y.colors.push(A)}else Y.set(s,{id:s,transforms:[F],colors:[A]})}}getGeometry(t,e){const n=t.GetGeometry(0,e),s=t.GetIndexArray(n.GetIndexData(),n.GetIndexDataSize()),o=t.GetVertexArray(n.GetVertexData(),n.GetVertexDataSize()),a=new Float32Array(o.length/2),c=new Float32Array(o.length/2);for(let I=0;I<o.length;I+=6)a[I/2]=o[I],a[I/2+1]=o[I+1],a[I/2+2]=o[I+2],c[I/2]=o[I+3],c[I/2+1]=o[I+4],c[I/2+2]=o[I+5];const h=new Wn,p=new Zn(a,3),C=new Zn(c,3);return h.setAttribute("position",p),h.setAttribute("normal",C),h.setIndex(Array.from(s)),n.delete(),h}async autoSetWasm(){const t=await fetch(`https://unpkg.com/openbim-components@${wl.release}/package.json`);if(!t.ok){console.warn("Couldn't get openbim-components package.json. Set wasm settings manually.");return}const e=await t.json();if(!("web-ifc"in e.peerDependencies))console.warn("Couldn't get web-ifc from peer dependencies in openbim-components. Set wasm settings manually.");else{const n=e.peerDependencies["web-ifc"];this.settings.wasm.path=`https://unpkg.com/web-ifc@${n}/`,this.settings.wasm.absolute=!0}}};R(Vl,"uuid","a659add7-1418-4771-a0d6-7d4d438e4624");let Yu=Vl;class ku extends No{constructor(){super(...arguments),R(this,"minGeometrySize",10),R(this,"minAssetsSize",1e3)}}class Gu extends No{constructor(){super(...arguments),R(this,"propertiesSize",100)}}class Vu extends re{constructor(){super(...arguments),R(this,"onPropertiesStreamed",new at),R(this,"onProgress",new at),R(this,"onIndicesStreamed",new at),R(this,"onDisposed",new at),R(this,"enabled",!0),R(this,"settings",new Gu),R(this,"webIfc",new qn)}async dispose(){this.onIndicesStreamed.reset(),this.onPropertiesStreamed.reset(),this.webIfc=null,this.onDisposed.reset()}async streamFromBuffer(t){const e=performance.now();await this.readIfcFile(t),await this.streamAllProperties(),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-e} ms!`)}async streamFromCallBack(t){const e=performance.now();await this.streamIfcFile(t),await this.streamAllProperties(),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-e} ms!`)}async readIfcFile(t){const{path:e,absolute:n,logLevel:s}=this.settings.wasm;this.webIfc.SetWasmPath(e,n),await this.webIfc.Init(),s&&this.webIfc.SetLogLevel(s),this.webIfc.OpenModel(t,this.settings.webIfc)}async streamIfcFile(t){const{path:e,absolute:n,logLevel:s}=this.settings.wasm;this.webIfc.SetWasmPath(e,n),await this.webIfc.Init(),s&&this.webIfc.SetLogLevel(s),this.webIfc.OpenModelFromCallback(t,this.settings.webIfc)}async streamAllProperties(){const{propertiesSize:t}=this.settings,e=new Set(this.webIfc.GetIfcEntityList(0)),n=[Ao,ll,cl,Fo,hl,ul],s=new Map,o=new Set([pl,El,fl,Il,$n]);for(const p of o)e.add(p);let a=.01,c=0;for(const p of e){if(c++,Gl.has(p))continue;const C=o.has(p),I=this.webIfc.GetLineIDsWithType(0,p),f=I.size();let T=0;for(let F=0;F<f-t;F+=t){const _={};for(let w=0;w<t;w++){T++;const v=I.get(F+w);try{const Y=this.webIfc.GetLine(0,v,C);n.includes(p)&&this.getIndices(Y,v,s),_[Y.expressID]=Y}catch{console.log(`Could not get property: ${v}`)}}await this.onPropertiesStreamed.trigger({type:p,data:_})}if(T!==f){const F={};for(let _=T;_<f;_++){const w=I.get(_);try{const v=this.webIfc.GetLine(0,w,C);n.includes(p)&&this.getIndices(v,w,s),F[v.expressID]=v}catch{console.log(`Could not get property: ${w}`)}}await this.onPropertiesStreamed.trigger({type:p,data:F})}const A=c/e.size;A>a&&(a+=.01,a=Math.max(a,A),await this.onProgress.trigger(Math.round(a*100)/100))}const h=[];for(const[p,C]of s)h.push([p,...C]);await this.onIndicesStreamed.trigger(h)}getIndices(t,e,n){const s=t.RelatedObjects||t.RelatedElements;if(!s){console.log(`Related objects not found: ${e}`);return}const o=t.RelatingType||t.RelatingMaterial||t.RelatingStructure||t.RelatingPropertyDefinition||t.RelatingGroup||t.RelatingClassification;if(!o){console.log(`Relating object not found: ${e}`);return}if(!Array.isArray(s)||o.value===void 0)return;const a=o.value;for(const c of s){if(c.value===void 0||c.value===null)continue;const h=c.value;n.has(h)||n.set(h,new Set),n.get(h).add(a)}}cleanUp(){this.webIfc=null,this.webIfc=new qn}}R(Vu,"uuid","88d2c89c-ce32-47d7-8cb6-d51e4b311a0b");const zu=class zl extends re{constructor(t){super(t),R(this,"onGeometryStreamed",new at),R(this,"onAssetStreamed",new at),R(this,"onProgress",new at),R(this,"onIfcLoaded",new at),R(this,"onDisposed",new at),R(this,"settings",new ku),R(this,"enabled",!0),R(this,"webIfc",new qn),R(this,"_spatialTree",new Bl),R(this,"_metaData",new kl),R(this,"_visitedGeometries",new Map),R(this,"_streamSerializer",new Vc),R(this,"_geometries",new Map),R(this,"_geometryCount",0),R(this,"_civil",new Yl),R(this,"_groupSerializer",new Cl),R(this,"_assets",[]),R(this,"_meshesWithHoles",new Set),this.components.add(zl.uuid,this),this.settings.excludedCategories.add(al)}dispose(){this.onIfcLoaded.reset(),this.onGeometryStreamed.reset(),this.onAssetStreamed.reset(),this.webIfc=null,this.onDisposed.trigger(),this.onDisposed.reset()}async streamFromBuffer(t){const e=performance.now();await this.readIfcFile(t),await this.streamAllGeometries(),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-e} ms!`)}async streamFromCallBack(t){const e=performance.now();await this.streamIfcFile(t),await this.streamAllGeometries(),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-e} ms!`)}async readIfcFile(t){const{path:e,absolute:n,logLevel:s}=this.settings.wasm;this.webIfc.SetWasmPath(e,n),await this.webIfc.Init(),s&&this.webIfc.SetLogLevel(s),this.webIfc.OpenModel(t,this.settings.webIfc)}async streamIfcFile(t){const{path:e,absolute:n,logLevel:s}=this.settings.wasm;this.webIfc.SetWasmPath(e,n),await this.webIfc.Init(),s&&this.webIfc.SetLogLevel(s),this.webIfc.OpenModelFromCallback(t,this.settings.webIfc)}async streamAllGeometries(){const{minGeometrySize:t,minAssetsSize:e}=this.settings;this._spatialTree.setUp(this.webIfc);const n=this.webIfc.GetIfcEntityList(0),s=[[]],o=new Tl,{FILE_NAME:a,FILE_DESCRIPTION:c}=Re;o.ifcMetadata={name:this._metaData.get(this.webIfc,a),description:this._metaData.get(this.webIfc,c),schema:this.webIfc.GetModelSchema(0)||"IFC2X3",maxExpressID:this.webIfc.GetMaxExpressID(0)};let h=0,p=0;for(const w of n){if(!this.webIfc.IsIfcElement(w)&&w!==$n||this.settings.excludedCategories.has(w))continue;const v=this.webIfc.GetLineIDsWithType(0,w),Y=v.size();for(let y=0;y<Y;y++){h>t&&(h=0,p++,s.push([]));const L=v.get(y);s[p].push(L);const k=this._spatialTree.itemsByFloor[L]||0;o.data.set(L,[[],[k,w]]),h++}}this._spatialTree.cleanUp();let C=.01,I=0;for(const w of s){I++,this.webIfc.StreamMeshes(0,w,Y=>{this.getMesh(this.webIfc,Y,o)}),this._geometryCount>t&&await this.streamGeometries(),this._assets.length>e&&await this.streamAssets();const v=I/s.length;v>C&&(C+=.01,C=Math.max(C,v),this.onProgress.trigger(Math.round(C*100)/100))}this._geometryCount&&await this.streamGeometries(),this._assets.length&&await this.streamAssets();const{opaque:f,transparent:T}=o.geometryIDs;for(const[w,{index:v,uuid:Y}]of this._visitedGeometries)o.keyFragments.set(v,Y),(w>1?f:T).set(w,v);const A=o.data.keys();for(const w of A){const[v]=o.data.get(w);v.length||o.data.delete(w)}const F=this.webIfc.GetCoordinationMatrix(0);o.coordinationMatrix.fromArray(F),o.civilData=this._civil.read(this.webIfc);const _=this._groupSerializer.export(o);this.onIfcLoaded.trigger(_),o.dispose(!0)}cleanUp(){this.webIfc=null,this.webIfc=new qn,this._visitedGeometries.clear(),this._geometries.clear(),this._assets=[],this._meshesWithHoles.clear()}getMesh(t,e,n){const s=e.geometries.size(),o=e.expressID,a={id:o,geometries:[]};e.expressID===664833&&console.log("Heyyy");for(let c=0;c<s;c++){const h=e.geometries.get(c),p=h.geometryExpressID,C=h.color.w===1?1:-1,I=p*C;if(!this._visitedGeometries.has(I)){this._visitedGeometries.has(p)||this.getGeometry(t,p);const y=this._visitedGeometries.size,L=ol.generateUUID();this._visitedGeometries.set(I,{uuid:L,index:y})}const f=this._visitedGeometries.get(I);if(f===void 0)throw new Error("Error getting geometry data for streaming!");const T=n.data.get(o);if(!T)throw new Error("Data not found!");T[0].push(f.index);const{x:A,y:F,z:_,w}=h.color,v=[A,F,_,w],Y=h.flatTransformation;a.geometries.push({color:v,geometryID:p,transformation:Y})}this._assets.push(a)}getGeometry(t,e){const n=t.GetGeometry(0,e),s=t.GetIndexArray(n.GetIndexData(),n.GetIndexDataSize()),o=t.GetVertexArray(n.GetVertexData(),n.GetVertexDataSize()),a=new Float32Array(o.length/2),c=new Float32Array(o.length/2);for(let f=0;f<o.length;f+=6)a[f/2]=o[f],a[f/2+1]=o[f+1],a[f/2+2]=o[f+2],c[f/2]=o[f+3],c[f/2+1]=o[f+4],c[f/2+2]=o[f+5];const h=lu(a),p=new Float32Array(h.transformation.elements),C=[h.center.x,h.center.y,h.center.z];let I=!1;for(let f=0;f<a.length-2;f+=3){const T=a[f],A=a[f+1],F=a[f+2],_=c[f],w=c[f+1],v=c[f+2];if(cu(C,[T,A,F],[_,w,v])){I=!0;break}}this._geometries.set(e,{position:a,normal:c,index:s,boundingBox:p,hasHoles:I}),n.delete(),this._geometryCount++}async streamAssets(){await this.onAssetStreamed.trigger(this._assets),this._assets=null,this._assets=[]}async streamGeometries(){let t=this._streamSerializer.export(this._geometries),e={};for(const[n,{boundingBox:s,hasHoles:o}]of this._geometries)e[n]={boundingBox:s,hasHoles:o};this.onGeometryStreamed.trigger({data:e,buffer:t}),e=null,t=null,this._geometries.clear(),this._geometryCount=0}};R(zu,"uuid","d9999a00-e1f5-4d3f-8cfe-c56e08609764");const Hu={950732822:"IFCURIREFERENCE",4075327185:"IFCTIME",1209108979:"IFCTEMPERATURERATEOFCHANGEMEASURE",3457685358:"IFCSOUNDPRESSURELEVELMEASURE",4157543285:"IFCSOUNDPOWERLEVELMEASURE",2798247006:"IFCPROPERTYSETDEFINITIONSET",1790229001:"IFCPOSITIVEINTEGER",525895558:"IFCNONNEGATIVELENGTHMEASURE",1774176899:"IFCLINEINDEX",1275358634:"IFCLANGUAGEID",2541165894:"IFCDURATION",3701338814:"IFCDAYINWEEKNUMBER",2195413836:"IFCDATETIME",937566702:"IFCDATE",1683019596:"IFCCARDINALPOINTREFERENCE",2314439260:"IFCBINARY",1500781891:"IFCAREADENSITYMEASURE",3683503648:"IFCARCINDEX",4065007721:"IFCYEARNUMBER",1718600412:"IFCWARPINGMOMENTMEASURE",51269191:"IFCWARPINGCONSTANTMEASURE",2593997549:"IFCVOLUMETRICFLOWRATEMEASURE",3458127941:"IFCVOLUMEMEASURE",3345633955:"IFCVAPORPERMEABILITYMEASURE",1278329552:"IFCTORQUEMEASURE",2591213694:"IFCTIMESTAMP",2726807636:"IFCTIMEMEASURE",743184107:"IFCTHERMODYNAMICTEMPERATUREMEASURE",2016195849:"IFCTHERMALTRANSMITTANCEMEASURE",857959152:"IFCTHERMALRESISTANCEMEASURE",2281867870:"IFCTHERMALEXPANSIONCOEFFICIENTMEASURE",2645777649:"IFCTHERMALCONDUCTIVITYMEASURE",232962298:"IFCTHERMALADMITTANCEMEASURE",296282323:"IFCTEXTTRANSFORMATION",603696268:"IFCTEXTFONTNAME",3490877962:"IFCTEXTDECORATION",1460886941:"IFCTEXTALIGNMENT",2801250643:"IFCTEXT",58845555:"IFCTEMPERATUREGRADIENTMEASURE",361837227:"IFCSPECULARROUGHNESS",2757832317:"IFCSPECULAREXPONENT",3477203348:"IFCSPECIFICHEATCAPACITYMEASURE",993287707:"IFCSOUNDPRESSUREMEASURE",846465480:"IFCSOUNDPOWERMEASURE",3471399674:"IFCSOLIDANGLEMEASURE",408310005:"IFCSHEARMODULUSMEASURE",2190458107:"IFCSECTIONALAREAINTEGRALMEASURE",3467162246:"IFCSECTIONMODULUSMEASURE",2766185779:"IFCSECONDINMINUTE",3211557302:"IFCROTATIONALSTIFFNESSMEASURE",1755127002:"IFCROTATIONALMASSMEASURE",2133746277:"IFCROTATIONALFREQUENCYMEASURE",200335297:"IFCREAL",96294661:"IFCRATIOMEASURE",3972513137:"IFCRADIOACTIVITYMEASURE",3665567075:"IFCPRESSUREMEASURE",2169031380:"IFCPRESENTABLETEXT",1364037233:"IFCPOWERMEASURE",1245737093:"IFCPOSITIVERATIOMEASURE",3054510233:"IFCPOSITIVEPLANEANGLEMEASURE",2815919920:"IFCPOSITIVELENGTHMEASURE",4042175685:"IFCPLANEANGLEMEASURE",2642773653:"IFCPLANARFORCEMEASURE",2260317790:"IFCPARAMETERVALUE",929793134:"IFCPHMEASURE",2395907400:"IFCNUMERICMEASURE",2095195183:"IFCNORMALISEDRATIOMEASURE",765770214:"IFCMONTHINYEARNUMBER",2615040989:"IFCMONETARYMEASURE",3114022597:"IFCMOMENTOFINERTIAMEASURE",1648970520:"IFCMOLECULARWEIGHTMEASURE",3177669450:"IFCMOISTUREDIFFUSIVITYMEASURE",1753493141:"IFCMODULUSOFSUBGRADEREACTIONMEASURE",1052454078:"IFCMODULUSOFROTATIONALSUBGRADEREACTIONMEASURE",2173214787:"IFCMODULUSOFLINEARSUBGRADEREACTIONMEASURE",3341486342:"IFCMODULUSOFELASTICITYMEASURE",102610177:"IFCMINUTEINHOUR",3531705166:"IFCMASSPERLENGTHMEASURE",3124614049:"IFCMASSMEASURE",4017473158:"IFCMASSFLOWRATEMEASURE",1477762836:"IFCMASSDENSITYMEASURE",2486716878:"IFCMAGNETICFLUXMEASURE",286949696:"IFCMAGNETICFLUXDENSITYMEASURE",151039812:"IFCLUMINOUSINTENSITYMEASURE",2755797622:"IFCLUMINOUSINTENSITYDISTRIBUTIONMEASURE",2095003142:"IFCLUMINOUSFLUXMEASURE",503418787:"IFCLOGICAL",3086160713:"IFCLINEARVELOCITYMEASURE",1307019551:"IFCLINEARSTIFFNESSMEASURE",2128979029:"IFCLINEARMOMENTMEASURE",191860431:"IFCLINEARFORCEMEASURE",1243674935:"IFCLENGTHMEASURE",3258342251:"IFCLABEL",2054016361:"IFCKINEMATICVISCOSITYMEASURE",3192672207:"IFCISOTHERMALMOISTURECAPACITYMEASURE",3686016028:"IFCIONCONCENTRATIONMEASURE",3809634241:"IFCINTEGERCOUNTRATEMEASURE",1939436016:"IFCINTEGER",2679005408:"IFCINDUCTANCEMEASURE",3358199106:"IFCILLUMINANCEMEASURE",983778844:"IFCIDENTIFIER",2589826445:"IFCHOURINDAY",1158859006:"IFCHEATINGVALUEMEASURE",3113092358:"IFCHEATFLUXDENSITYMEASURE",3064340077:"IFCGLOBALLYUNIQUEID",3044325142:"IFCFREQUENCYMEASURE",1361398929:"IFCFORCEMEASURE",2590844177:"IFCFONTWEIGHT",2715512545:"IFCFONTVARIANT",1102727119:"IFCFONTSTYLE",2078135608:"IFCENERGYMEASURE",2506197118:"IFCELECTRICVOLTAGEMEASURE",2951915441:"IFCELECTRICRESISTANCEMEASURE",3790457270:"IFCELECTRICCURRENTMEASURE",2093906313:"IFCELECTRICCONDUCTANCEMEASURE",3818826038:"IFCELECTRICCHARGEMEASURE",1827137117:"IFCELECTRICCAPACITANCEMEASURE",69416015:"IFCDYNAMICVISCOSITYMEASURE",524656162:"IFCDOSEEQUIVALENTMEASURE",4134073009:"IFCDIMENSIONCOUNT",1514641115:"IFCDESCRIPTIVEMEASURE",300323983:"IFCDAYLIGHTSAVINGHOUR",86635668:"IFCDAYINMONTHNUMBER",94842927:"IFCCURVATUREMEASURE",1778710042:"IFCCOUNTMEASURE",3238673880:"IFCCONTEXTDEPENDENTMEASURE",3812528620:"IFCCOMPOUNDPLANEANGLEMEASURE",2991860651:"IFCCOMPLEXNUMBER",1867003952:"IFCBOXALIGNMENT",2735952531:"IFCBOOLEAN",2650437152:"IFCAREAMEASURE",632304761:"IFCANGULARVELOCITYMEASURE",360377573:"IFCAMOUNTOFSUBSTANCEMEASURE",4182062534:"IFCACCELERATIONMEASURE",3699917729:"IFCABSORBEDDOSEMEASURE",1971632696:"IFCGEOSLICE",2680139844:"IFCGEOMODEL",24726584:"IFCELECTRICFLOWTREATMENTDEVICE",3693000487:"IFCDISTRIBUTIONBOARD",3460952963:"IFCCONVEYORSEGMENT",3999819293:"IFCCAISSONFOUNDATION",3314249567:"IFCBOREHOLE",4196446775:"IFCBEARING",325726236:"IFCALIGNMENT",3425753595:"IFCTRACKELEMENT",991950508:"IFCSIGNAL",3798194928:"IFCREINFORCEDSOIL",3290496277:"IFCRAIL",1383356374:"IFCPAVEMENT",2182337498:"IFCNAVIGATIONELEMENT",234836483:"IFCMOORINGDEVICE",2078563270:"IFCMOBILETELECOMMUNICATIONSAPPLIANCE",1638804497:"IFCLIQUIDTERMINAL",1154579445:"IFCLINEARPOSITIONINGELEMENT",2696325953:"IFCKERB",2713699986:"IFCGEOTECHNICALASSEMBLY",2142170206:"IFCELECTRICFLOWTREATMENTDEVICETYPE",3376911765:"IFCEARTHWORKSFILL",1077100507:"IFCEARTHWORKSELEMENT",3071239417:"IFCEARTHWORKSCUT",479945903:"IFCDISTRIBUTIONBOARDTYPE",3426335179:"IFCDEEPFOUNDATION",1502416096:"IFCCOURSE",2940368186:"IFCCONVEYORSEGMENTTYPE",3203706013:"IFCCAISSONFOUNDATIONTYPE",3862327254:"IFCBUILTSYSTEM",1876633798:"IFCBUILTELEMENT",963979645:"IFCBRIDGEPART",644574406:"IFCBRIDGE",3649138523:"IFCBEARINGTYPE",1662888072:"IFCALIGNMENTVERTICAL",317615605:"IFCALIGNMENTSEGMENT",1545765605:"IFCALIGNMENTHORIZONTAL",4266260250:"IFCALIGNMENTCANT",3956297820:"IFCVIBRATIONDAMPERTYPE",1530820697:"IFCVIBRATIONDAMPER",840318589:"IFCVEHICLE",1953115116:"IFCTRANSPORTATIONDEVICE",618700268:"IFCTRACKELEMENTTYPE",2281632017:"IFCTENDONCONDUITTYPE",3663046924:"IFCTENDONCONDUIT",42703149:"IFCSINESPIRAL",1894708472:"IFCSIGNALTYPE",3599934289:"IFCSIGNTYPE",33720170:"IFCSIGN",1027922057:"IFCSEVENTHORDERPOLYNOMIALSPIRAL",544395925:"IFCSEGMENTEDREFERENCECURVE",3649235739:"IFCSECONDORDERPOLYNOMIALSPIRAL",550521510:"IFCROADPART",146592293:"IFCROAD",3818125796:"IFCRELADHERESTOELEMENT",4021432810:"IFCREFERENT",1891881377:"IFCRAILWAYPART",3992365140:"IFCRAILWAY",1763565496:"IFCRAILTYPE",1946335990:"IFCPOSITIONINGELEMENT",514975943:"IFCPAVEMENTTYPE",506776471:"IFCNAVIGATIONELEMENTTYPE",710110818:"IFCMOORINGDEVICETYPE",1950438474:"IFCMOBILETELECOMMUNICATIONSAPPLIANCETYPE",976884017:"IFCMARINEPART",525669439:"IFCMARINEFACILITY",1770583370:"IFCLIQUIDTERMINALTYPE",2176059722:"IFCLINEARELEMENT",679976338:"IFCKERBTYPE",3948183225:"IFCIMPACTPROTECTIONDEVICETYPE",2568555532:"IFCIMPACTPROTECTIONDEVICE",2898700619:"IFCGRADIENTCURVE",1594536857:"IFCGEOTECHNICALSTRATUM",4230923436:"IFCGEOTECHNICALELEMENT",4228831410:"IFCFACILITYPARTCOMMON",1310830890:"IFCFACILITYPART",24185140:"IFCFACILITY",4234616927:"IFCDIRECTRIXDERIVEDREFERENCESWEPTAREASOLID",1306400036:"IFCDEEPFOUNDATIONTYPE",4189326743:"IFCCOURSETYPE",2000195564:"IFCCOSINESPIRAL",3497074424:"IFCCLOTHOID",1626504194:"IFCBUILTELEMENTTYPE",3651464721:"IFCVEHICLETYPE",1229763772:"IFCTRIANGULATEDIRREGULARNETWORK",3665877780:"IFCTRANSPORTATIONDEVICETYPE",782932809:"IFCTHIRDORDERPOLYNOMIALSPIRAL",2735484536:"IFCSPIRAL",1356537516:"IFCSECTIONEDSURFACE",1290935644:"IFCSECTIONEDSOLIDHORIZONTAL",1862484736:"IFCSECTIONEDSOLID",1441486842:"IFCRELPOSITIONS",1033248425:"IFCRELASSOCIATESPROFILEDEF",3381221214:"IFCPOLYNOMIALCURVE",2485787929:"IFCOFFSETCURVEBYDISTANCES",590820931:"IFCOFFSETCURVE",3465909080:"IFCINDEXEDPOLYGONALTEXTUREMAP",593015953:"IFCDIRECTRIXCURVESWEPTAREASOLID",4212018352:"IFCCURVESEGMENT",3425423356:"IFCAXIS2PLACEMENTLINEAR",823603102:"IFCSEGMENT",2165702409:"IFCPOINTBYDISTANCEEXPRESSION",182550632:"IFCOPENCROSSPROFILEDEF",388784114:"IFCLINEARPLACEMENT",536804194:"IFCALIGNMENTHORIZONTALSEGMENT",3752311538:"IFCALIGNMENTCANTSEGMENT",1010789467:"IFCTEXTURECOORDINATEINDICESWITHVOIDS",222769930:"IFCTEXTURECOORDINATEINDICES",2691318326:"IFCQUANTITYNUMBER",3633395639:"IFCALIGNMENTVERTICALSEGMENT",2879124712:"IFCALIGNMENTPARAMETERSEGMENT",25142252:"IFCCONTROLLER",3087945054:"IFCALARM",4288193352:"IFCACTUATOR",630975310:"IFCUNITARYCONTROLELEMENT",4086658281:"IFCSENSOR",2295281155:"IFCPROTECTIVEDEVICETRIPPINGUNIT",182646315:"IFCFLOWINSTRUMENT",1426591983:"IFCFIRESUPPRESSIONTERMINAL",819412036:"IFCFILTER",3415622556:"IFCFAN",1003880860:"IFCELECTRICTIMECONTROL",402227799:"IFCELECTRICMOTOR",264262732:"IFCELECTRICGENERATOR",3310460725:"IFCELECTRICFLOWSTORAGEDEVICE",862014818:"IFCELECTRICDISTRIBUTIONBOARD",1904799276:"IFCELECTRICAPPLIANCE",1360408905:"IFCDUCTSILENCER",3518393246:"IFCDUCTSEGMENT",342316401:"IFCDUCTFITTING",562808652:"IFCDISTRIBUTIONCIRCUIT",4074379575:"IFCDAMPER",3640358203:"IFCCOOLINGTOWER",4136498852:"IFCCOOLEDBEAM",2272882330:"IFCCONDENSER",3571504051:"IFCCOMPRESSOR",3221913625:"IFCCOMMUNICATIONSAPPLIANCE",639361253:"IFCCOIL",3902619387:"IFCCHILLER",4217484030:"IFCCABLESEGMENT",1051757585:"IFCCABLEFITTING",3758799889:"IFCCABLECARRIERSEGMENT",635142910:"IFCCABLECARRIERFITTING",2938176219:"IFCBURNER",32344328:"IFCBOILER",2906023776:"IFCBEAMSTANDARDCASE",277319702:"IFCAUDIOVISUALAPPLIANCE",2056796094:"IFCAIRTOAIRHEATRECOVERY",177149247:"IFCAIRTERMINALBOX",1634111441:"IFCAIRTERMINAL",486154966:"IFCWINDOWSTANDARDCASE",4237592921:"IFCWASTETERMINAL",4156078855:"IFCWALLELEMENTEDCASE",4207607924:"IFCVALVE",4292641817:"IFCUNITARYEQUIPMENT",3179687236:"IFCUNITARYCONTROLELEMENTTYPE",3026737570:"IFCTUBEBUNDLE",3825984169:"IFCTRANSFORMER",812556717:"IFCTANK",1162798199:"IFCSWITCHINGDEVICE",385403989:"IFCSTRUCTURALLOADCASE",1404847402:"IFCSTACKTERMINAL",1999602285:"IFCSPACEHEATER",3420628829:"IFCSOLARDEVICE",3027962421:"IFCSLABSTANDARDCASE",3127900445:"IFCSLABELEMENTEDCASE",1329646415:"IFCSHADINGDEVICE",3053780830:"IFCSANITARYTERMINAL",2572171363:"IFCREINFORCINGBARTYPE",1232101972:"IFCRATIONALBSPLINECURVEWITHKNOTS",90941305:"IFCPUMP",655969474:"IFCPROTECTIVEDEVICETRIPPINGUNITTYPE",738039164:"IFCPROTECTIVEDEVICE",1156407060:"IFCPLATESTANDARDCASE",3612865200:"IFCPIPESEGMENT",310824031:"IFCPIPEFITTING",3694346114:"IFCOUTLET",144952367:"IFCOUTERBOUNDARYCURVE",2474470126:"IFCMOTORCONNECTION",1911478936:"IFCMEMBERSTANDARDCASE",1437502449:"IFCMEDICALDEVICE",629592764:"IFCLIGHTFIXTURE",76236018:"IFCLAMP",2176052936:"IFCJUNCTIONBOX",4175244083:"IFCINTERCEPTOR",2068733104:"IFCHUMIDIFIER",3319311131:"IFCHEATEXCHANGER",2188021234:"IFCFLOWMETER",1209101575:"IFCEXTERNALSPATIALELEMENT",484807127:"IFCEVAPORATOR",3747195512:"IFCEVAPORATIVECOOLER",2814081492:"IFCENGINE",2417008758:"IFCELECTRICDISTRIBUTIONBOARDTYPE",3242481149:"IFCDOORSTANDARDCASE",3205830791:"IFCDISTRIBUTIONSYSTEM",400855858:"IFCCOMMUNICATIONSAPPLIANCETYPE",905975707:"IFCCOLUMNSTANDARDCASE",1677625105:"IFCCIVILELEMENT",3296154744:"IFCCHIMNEY",2674252688:"IFCCABLEFITTINGTYPE",2188180465:"IFCBURNERTYPE",1177604601:"IFCBUILDINGSYSTEM",39481116:"IFCBUILDINGELEMENTPARTTYPE",1136057603:"IFCBOUNDARYCURVE",2461110595:"IFCBSPLINECURVEWITHKNOTS",1532957894:"IFCAUDIOVISUALAPPLIANCETYPE",4088093105:"IFCWORKCALENDAR",4009809668:"IFCWINDOWTYPE",926996030:"IFCVOIDINGFEATURE",2391383451:"IFCVIBRATIONISOLATOR",2415094496:"IFCTENDONTYPE",3081323446:"IFCTENDONANCHORTYPE",413509423:"IFCSYSTEMFURNITUREELEMENT",3101698114:"IFCSURFACEFEATURE",3657597509:"IFCSTRUCTURALSURFACEACTION",2757150158:"IFCSTRUCTURALCURVEREACTION",1004757350:"IFCSTRUCTURALCURVEACTION",338393293:"IFCSTAIRTYPE",1072016465:"IFCSOLARDEVICETYPE",4074543187:"IFCSHADINGDEVICETYPE",2157484638:"IFCSEAMCURVE",2781568857:"IFCROOFTYPE",2310774935:"IFCREINFORCINGMESHTYPE",964333572:"IFCREINFORCINGELEMENTTYPE",683857671:"IFCRATIONALBSPLINESURFACEWITHKNOTS",1469900589:"IFCRAMPTYPE",2839578677:"IFCPOLYGONALFACESET",1158309216:"IFCPILETYPE",3079942009:"IFCOPENINGSTANDARDCASE",1114901282:"IFCMEDICALDEVICETYPE",3113134337:"IFCINTERSECTIONCURVE",3946677679:"IFCINTERCEPTORTYPE",2571569899:"IFCINDEXEDPOLYCURVE",3493046030:"IFCGEOGRAPHICELEMENT",1509553395:"IFCFURNITURE",1893162501:"IFCFOOTINGTYPE",2853485674:"IFCEXTERNALSPATIALSTRUCTUREELEMENT",4148101412:"IFCEVENT",132023988:"IFCENGINETYPE",2397081782:"IFCELEMENTASSEMBLYTYPE",2323601079:"IFCDOORTYPE",1213902940:"IFCCYLINDRICALSURFACE",1525564444:"IFCCONSTRUCTIONPRODUCTRESOURCETYPE",4105962743:"IFCCONSTRUCTIONMATERIALRESOURCETYPE",2185764099:"IFCCONSTRUCTIONEQUIPMENTRESOURCETYPE",15328376:"IFCCOMPOSITECURVEONSURFACE",3875453745:"IFCCOMPLEXPROPERTYTEMPLATE",3893394355:"IFCCIVILELEMENTTYPE",2197970202:"IFCCHIMNEYTYPE",167062518:"IFCBSPLINESURFACEWITHKNOTS",2887950389:"IFCBSPLINESURFACE",2603310189:"IFCADVANCEDBREPWITHVOIDS",1635779807:"IFCADVANCEDBREP",2916149573:"IFCTRIANGULATEDFACESET",1935646853:"IFCTOROIDALSURFACE",2387106220:"IFCTESSELLATEDFACESET",3206491090:"IFCTASKTYPE",699246055:"IFCSURFACECURVE",4095615324:"IFCSUBCONTRACTRESOURCETYPE",603775116:"IFCSTRUCTURALSURFACEREACTION",4015995234:"IFCSPHERICALSURFACE",2481509218:"IFCSPATIALZONETYPE",463610769:"IFCSPATIALZONE",710998568:"IFCSPATIALELEMENTTYPE",1412071761:"IFCSPATIALELEMENT",3663146110:"IFCSIMPLEPROPERTYTEMPLATE",3243963512:"IFCREVOLVEDAREASOLIDTAPERED",816062949:"IFCREPARAMETRISEDCOMPOSITECURVESEGMENT",1521410863:"IFCRELSPACEBOUNDARY2NDLEVEL",3523091289:"IFCRELSPACEBOUNDARY1STLEVEL",427948657:"IFCRELINTERFERESELEMENTS",307848117:"IFCRELDEFINESBYTEMPLATE",1462361463:"IFCRELDEFINESBYOBJECT",2565941209:"IFCRELDECLARES",1027710054:"IFCRELASSIGNSTOGROUPBYFACTOR",3521284610:"IFCPROPERTYTEMPLATE",492091185:"IFCPROPERTYSETTEMPLATE",653396225:"IFCPROJECTLIBRARY",569719735:"IFCPROCEDURETYPE",3967405729:"IFCPREDEFINEDPROPERTYSET",1682466193:"IFCPCURVE",428585644:"IFCLABORRESOURCETYPE",2294589976:"IFCINDEXEDPOLYGONALFACEWITHVOIDS",178912537:"IFCINDEXEDPOLYGONALFACE",4095422895:"IFCGEOGRAPHICELEMENTTYPE",2652556860:"IFCFIXEDREFERENCESWEPTAREASOLID",2804161546:"IFCEXTRUDEDAREASOLIDTAPERED",4024345920:"IFCEVENTTYPE",2629017746:"IFCCURVEBOUNDEDSURFACE",1815067380:"IFCCREWRESOURCETYPE",3419103109:"IFCCONTEXT",2574617495:"IFCCONSTRUCTIONRESOURCETYPE",2059837836:"IFCCARTESIANPOINTLIST3D",1675464909:"IFCCARTESIANPOINTLIST2D",574549367:"IFCCARTESIANPOINTLIST",3406155212:"IFCADVANCEDFACE",3698973494:"IFCTYPERESOURCE",3736923433:"IFCTYPEPROCESS",901063453:"IFCTESSELLATEDITEM",1096409881:"IFCSWEPTDISKSOLIDPOLYGONAL",1042787934:"IFCRESOURCETIME",1608871552:"IFCRESOURCECONSTRAINTRELATIONSHIP",2943643501:"IFCRESOURCEAPPROVALRELATIONSHIP",2090586900:"IFCQUANTITYSET",1482703590:"IFCPROPERTYTEMPLATEDEFINITION",3778827333:"IFCPREDEFINEDPROPERTIES",2998442950:"IFCMIRROREDPROFILEDEF",853536259:"IFCMATERIALRELATIONSHIP",3404854881:"IFCMATERIALPROFILESETUSAGETAPERING",3079605661:"IFCMATERIALPROFILESETUSAGE",2852063980:"IFCMATERIALCONSTITUENTSET",3708119e3:"IFCMATERIALCONSTITUENT",1585845231:"IFCLAGTIME",2133299955:"IFCINDEXEDTRIANGLETEXTUREMAP",1437953363:"IFCINDEXEDTEXTUREMAP",3570813810:"IFCINDEXEDCOLOURMAP",1437805879:"IFCEXTERNALREFERENCERELATIONSHIP",297599258:"IFCEXTENDEDPROPERTIES",211053100:"IFCEVENTTIME",2713554722:"IFCCONVERSIONBASEDUNITWITHOFFSET",3285139300:"IFCCOLOURRGBLIST",1236880293:"IFCWORKTIME",1199560280:"IFCTIMEPERIOD",3611470254:"IFCTEXTUREVERTEXLIST",2771591690:"IFCTASKTIMERECURRING",1549132990:"IFCTASKTIME",2043862942:"IFCTABLECOLUMN",2934153892:"IFCSURFACEREINFORCEMENTAREA",609421318:"IFCSTRUCTURALLOADORRESULT",3478079324:"IFCSTRUCTURALLOADCONFIGURATION",1054537805:"IFCSCHEDULINGTIME",2439245199:"IFCRESOURCELEVELRELATIONSHIP",2433181523:"IFCREFERENCE",3915482550:"IFCRECURRENCEPATTERN",986844984:"IFCPROPERTYABSTRACTION",3843373140:"IFCPROJECTEDCRS",677532197:"IFCPRESENTATIONITEM",1507914824:"IFCMATERIALUSAGEDEFINITION",552965576:"IFCMATERIALPROFILEWITHOFFSETS",164193824:"IFCMATERIALPROFILESET",2235152071:"IFCMATERIALPROFILE",1847252529:"IFCMATERIALLAYERWITHOFFSETS",760658860:"IFCMATERIALDEFINITION",3057273783:"IFCMAPCONVERSION",4294318154:"IFCEXTERNALINFORMATION",1466758467:"IFCCOORDINATEREFERENCESYSTEM",1785450214:"IFCCOORDINATEOPERATION",775493141:"IFCCONNECTIONVOLUMEGEOMETRY",979691226:"IFCREINFORCINGBAR",3700593921:"IFCELECTRICDISTRIBUTIONPOINT",1062813311:"IFCDISTRIBUTIONCONTROLELEMENT",1052013943:"IFCDISTRIBUTIONCHAMBERELEMENT",578613899:"IFCCONTROLLERTYPE",2454782716:"IFCCHAMFEREDGEFEATURE",753842376:"IFCBEAM",3001207471:"IFCALARMTYPE",2874132201:"IFCACTUATORTYPE",3304561284:"IFCWINDOW",3512223829:"IFCWALLSTANDARDCASE",2391406946:"IFCWALL",3313531582:"IFCVIBRATIONISOLATORTYPE",2347447852:"IFCTENDONANCHOR",3824725483:"IFCTENDON",2515109513:"IFCSTRUCTURALANALYSISMODEL",4252922144:"IFCSTAIRFLIGHT",331165859:"IFCSTAIR",1529196076:"IFCSLAB",1783015770:"IFCSENSORTYPE",1376911519:"IFCROUNDEDEDGEFEATURE",2016517767:"IFCROOF",2320036040:"IFCREINFORCINGMESH",3027567501:"IFCREINFORCINGELEMENT",3055160366:"IFCRATIONALBEZIERCURVE",3283111854:"IFCRAMPFLIGHT",3024970846:"IFCRAMP",2262370178:"IFCRAILING",3171933400:"IFCPLATE",1687234759:"IFCPILE",1073191201:"IFCMEMBER",900683007:"IFCFOOTING",3508470533:"IFCFLOWTREATMENTDEVICE",2223149337:"IFCFLOWTERMINAL",707683696:"IFCFLOWSTORAGEDEVICE",987401354:"IFCFLOWSEGMENT",3132237377:"IFCFLOWMOVINGDEVICE",4037862832:"IFCFLOWINSTRUMENTTYPE",4278956645:"IFCFLOWFITTING",2058353004:"IFCFLOWCONTROLLER",4222183408:"IFCFIRESUPPRESSIONTERMINALTYPE",1810631287:"IFCFILTERTYPE",346874300:"IFCFANTYPE",1658829314:"IFCENERGYCONVERSIONDEVICE",857184966:"IFCELECTRICALELEMENT",1634875225:"IFCELECTRICALCIRCUIT",712377611:"IFCELECTRICTIMECONTROLTYPE",1217240411:"IFCELECTRICMOTORTYPE",1365060375:"IFCELECTRICHEATERTYPE",1534661035:"IFCELECTRICGENERATORTYPE",3277789161:"IFCELECTRICFLOWSTORAGEDEVICETYPE",663422040:"IFCELECTRICAPPLIANCETYPE",855621170:"IFCEDGEFEATURE",2030761528:"IFCDUCTSILENCERTYPE",3760055223:"IFCDUCTSEGMENTTYPE",869906466:"IFCDUCTFITTINGTYPE",395920057:"IFCDOOR",3041715199:"IFCDISTRIBUTIONPORT",3040386961:"IFCDISTRIBUTIONFLOWELEMENT",1945004755:"IFCDISTRIBUTIONELEMENT",2063403501:"IFCDISTRIBUTIONCONTROLELEMENTTYPE",1599208980:"IFCDISTRIBUTIONCHAMBERELEMENTTYPE",2635815018:"IFCDISCRETEACCESSORYTYPE",1335981549:"IFCDISCRETEACCESSORY",4147604152:"IFCDIAMETERDIMENSION",3961806047:"IFCDAMPERTYPE",3495092785:"IFCCURTAINWALL",1973544240:"IFCCOVERING",2954562838:"IFCCOOLINGTOWERTYPE",335055490:"IFCCOOLEDBEAMTYPE",488727124:"IFCCONSTRUCTIONPRODUCTRESOURCE",1060000209:"IFCCONSTRUCTIONMATERIALRESOURCE",3898045240:"IFCCONSTRUCTIONEQUIPMENTRESOURCE",1163958913:"IFCCONDITIONCRITERION",2188551683:"IFCCONDITION",2816379211:"IFCCONDENSERTYPE",3850581409:"IFCCOMPRESSORTYPE",843113511:"IFCCOLUMN",2301859152:"IFCCOILTYPE",2611217952:"IFCCIRCLE",2951183804:"IFCCHILLERTYPE",1285652485:"IFCCABLESEGMENTTYPE",3293546465:"IFCCABLECARRIERSEGMENTTYPE",395041908:"IFCCABLECARRIERFITTINGTYPE",1909888760:"IFCBUILDINGELEMENTPROXYTYPE",1095909175:"IFCBUILDINGELEMENTPROXY",2979338954:"IFCBUILDINGELEMENTPART",52481810:"IFCBUILDINGELEMENTCOMPONENT",3299480353:"IFCBUILDINGELEMENT",231477066:"IFCBOILERTYPE",1916977116:"IFCBEZIERCURVE",819618141:"IFCBEAMTYPE",1967976161:"IFCBSPLINECURVE",3460190687:"IFCASSET",2470393545:"IFCANGULARDIMENSION",1871374353:"IFCAIRTOAIRHEATRECOVERYTYPE",3352864051:"IFCAIRTERMINALTYPE",1411407467:"IFCAIRTERMINALBOXTYPE",3821786052:"IFCACTIONREQUEST",1213861670:"IFC2DCOMPOSITECURVE",1033361043:"IFCZONE",3342526732:"IFCWORKSCHEDULE",4218914973:"IFCWORKPLAN",1028945134:"IFCWORKCONTROL",1133259667:"IFCWASTETERMINALTYPE",1898987631:"IFCWALLTYPE",2769231204:"IFCVIRTUALELEMENT",728799441:"IFCVALVETYPE",1911125066:"IFCUNITARYEQUIPMENTTYPE",1600972822:"IFCTUBEBUNDLETYPE",3593883385:"IFCTRIMMEDCURVE",1620046519:"IFCTRANSPORTELEMENT",1692211062:"IFCTRANSFORMERTYPE",1637806684:"IFCTIMESERIESSCHEDULE",5716631:"IFCTANKTYPE",2254336722:"IFCSYSTEM",2315554128:"IFCSWITCHINGDEVICETYPE",148013059:"IFCSUBCONTRACTRESOURCE",1975003073:"IFCSTRUCTURALSURFACECONNECTION",2986769608:"IFCSTRUCTURALRESULTGROUP",1235345126:"IFCSTRUCTURALPOINTREACTION",734778138:"IFCSTRUCTURALPOINTCONNECTION",2082059205:"IFCSTRUCTURALPOINTACTION",3987759626:"IFCSTRUCTURALPLANARACTIONVARYING",1621171031:"IFCSTRUCTURALPLANARACTION",1252848954:"IFCSTRUCTURALLOADGROUP",1721250024:"IFCSTRUCTURALLINEARACTIONVARYING",1807405624:"IFCSTRUCTURALLINEARACTION",2445595289:"IFCSTRUCTURALCURVEMEMBERVARYING",214636428:"IFCSTRUCTURALCURVEMEMBER",4243806635:"IFCSTRUCTURALCURVECONNECTION",1179482911:"IFCSTRUCTURALCONNECTION",682877961:"IFCSTRUCTURALACTION",1039846685:"IFCSTAIRFLIGHTTYPE",3112655638:"IFCSTACKTERMINALTYPE",3812236995:"IFCSPACETYPE",652456506:"IFCSPACEPROGRAM",1305183839:"IFCSPACEHEATERTYPE",3856911033:"IFCSPACE",2533589738:"IFCSLABTYPE",4097777520:"IFCSITE",4105383287:"IFCSERVICELIFE",3517283431:"IFCSCHEDULETIMECONTROL",1768891740:"IFCSANITARYTERMINALTYPE",2863920197:"IFCRELASSIGNSTASKS",160246688:"IFCRELAGGREGATES",2324767716:"IFCRAMPFLIGHTTYPE",2893384427:"IFCRAILINGTYPE",3248260540:"IFCRADIUSDIMENSION",2250791053:"IFCPUMPTYPE",1842657554:"IFCPROTECTIVEDEVICETYPE",3651124850:"IFCPROJECTIONELEMENT",3642467123:"IFCPROJECTORDERRECORD",2904328755:"IFCPROJECTORDER",2744685151:"IFCPROCEDURE",3740093272:"IFCPORT",3724593414:"IFCPOLYLINE",4017108033:"IFCPLATETYPE",4231323485:"IFCPIPESEGMENTTYPE",804291784:"IFCPIPEFITTINGTYPE",3327091369:"IFCPERMIT",2382730787:"IFCPERFORMANCEHISTORY",2837617999:"IFCOUTLETTYPE",3425660407:"IFCORDERACTION",3588315303:"IFCOPENINGELEMENT",4143007308:"IFCOCCUPANT",1916936684:"IFCMOVE",977012517:"IFCMOTORCONNECTIONTYPE",3181161470:"IFCMEMBERTYPE",2108223431:"IFCMECHANICALFASTENERTYPE",377706215:"IFCMECHANICALFASTENER",2506943328:"IFCLINEARDIMENSION",1161773419:"IFCLIGHTFIXTURETYPE",1051575348:"IFCLAMPTYPE",3827777499:"IFCLABORRESOURCE",4288270099:"IFCJUNCTIONBOXTYPE",2391368822:"IFCINVENTORY",1806887404:"IFCHUMIDIFIERTYPE",1251058090:"IFCHEATEXCHANGERTYPE",2706460486:"IFCGROUP",3009204131:"IFCGRID",200128114:"IFCGASTERMINALTYPE",814719939:"IFCFURNITURESTANDARD",263784265:"IFCFURNISHINGELEMENT",3009222698:"IFCFLOWTREATMENTDEVICETYPE",2297155007:"IFCFLOWTERMINALTYPE",1339347760:"IFCFLOWSTORAGEDEVICETYPE",1834744321:"IFCFLOWSEGMENTTYPE",1482959167:"IFCFLOWMOVINGDEVICETYPE",3815607619:"IFCFLOWMETERTYPE",3198132628:"IFCFLOWFITTINGTYPE",3907093117:"IFCFLOWCONTROLLERTYPE",1287392070:"IFCFEATUREELEMENTSUBTRACTION",2143335405:"IFCFEATUREELEMENTADDITION",2827207264:"IFCFEATUREELEMENT",2489546625:"IFCFASTENERTYPE",647756555:"IFCFASTENER",3737207727:"IFCFACETEDBREPWITHVOIDS",807026263:"IFCFACETEDBREP",3390157468:"IFCEVAPORATORTYPE",3174744832:"IFCEVAPORATIVECOOLERTYPE",3272907226:"IFCEQUIPMENTSTANDARD",1962604670:"IFCEQUIPMENTELEMENT",2107101300:"IFCENERGYCONVERSIONDEVICETYPE",1704287377:"IFCELLIPSE",2590856083:"IFCELEMENTCOMPONENTTYPE",1623761950:"IFCELEMENTCOMPONENT",4123344466:"IFCELEMENTASSEMBLY",1758889154:"IFCELEMENT",360485395:"IFCELECTRICALBASEPROPERTIES",3849074793:"IFCDISTRIBUTIONFLOWELEMENTTYPE",3256556792:"IFCDISTRIBUTIONELEMENTTYPE",681481545:"IFCDIMENSIONCURVEDIRECTEDCALLOUT",1457835157:"IFCCURTAINWALLTYPE",3295246426:"IFCCREWRESOURCE",1916426348:"IFCCOVERINGTYPE",1419761937:"IFCCOSTSCHEDULE",3895139033:"IFCCOSTITEM",3293443760:"IFCCONTROL",2559216714:"IFCCONSTRUCTIONRESOURCE",2510884976:"IFCCONIC",3732776249:"IFCCOMPOSITECURVE",300633059:"IFCCOLUMNTYPE",2937912522:"IFCCIRCLEHOLLOWPROFILEDEF",3124254112:"IFCBUILDINGSTOREY",1950629157:"IFCBUILDINGELEMENTTYPE",4031249490:"IFCBUILDING",1260505505:"IFCBOUNDEDCURVE",3649129432:"IFCBOOLEANCLIPPINGRESULT",1334484129:"IFCBLOCK",3207858831:"IFCASYMMETRICISHAPEPROFILEDEF",1674181508:"IFCANNOTATION",2296667514:"IFCACTOR",2097647324:"IFCTRANSPORTELEMENTTYPE",3473067441:"IFCTASK",1580310250:"IFCSYSTEMFURNITUREELEMENTTYPE",4124788165:"IFCSURFACEOFREVOLUTION",2809605785:"IFCSURFACEOFLINEAREXTRUSION",2028607225:"IFCSURFACECURVESWEPTAREASOLID",4070609034:"IFCSTRUCTUREDDIMENSIONCALLOUT",2218152070:"IFCSTRUCTURALSURFACEMEMBERVARYING",3979015343:"IFCSTRUCTURALSURFACEMEMBER",3689010777:"IFCSTRUCTURALREACTION",530289379:"IFCSTRUCTURALMEMBER",3136571912:"IFCSTRUCTURALITEM",3544373492:"IFCSTRUCTURALACTIVITY",451544542:"IFCSPHERE",3893378262:"IFCSPATIALSTRUCTUREELEMENTTYPE",2706606064:"IFCSPATIALSTRUCTUREELEMENT",3626867408:"IFCRIGHTCIRCULARCYLINDER",4158566097:"IFCRIGHTCIRCULARCONE",1856042241:"IFCREVOLVEDAREASOLID",2914609552:"IFCRESOURCE",1401173127:"IFCRELVOIDSELEMENT",3451746338:"IFCRELSPACEBOUNDARY",366585022:"IFCRELSERVICESBUILDINGS",4122056220:"IFCRELSEQUENCE",1058617721:"IFCRELSCHEDULESCOSTITEMS",1245217292:"IFCRELREFERENCEDINSPATIALSTRUCTURE",750771296:"IFCRELPROJECTSELEMENT",202636808:"IFCRELOVERRIDESPROPERTIES",2051452291:"IFCRELOCCUPIESSPACES",3268803585:"IFCRELNESTS",4189434867:"IFCRELINTERACTIONREQUIREMENTS",279856033:"IFCRELFLOWCONTROLELEMENTS",3940055652:"IFCRELFILLSELEMENT",781010003:"IFCRELDEFINESBYTYPE",4186316022:"IFCRELDEFINESBYPROPERTIES",693640335:"IFCRELDEFINES",2551354335:"IFCRELDECOMPOSES",2802773753:"IFCRELCOVERSSPACES",886880790:"IFCRELCOVERSBLDGELEMENTS",3242617779:"IFCRELCONTAINEDINSPATIALSTRUCTURE",3678494232:"IFCRELCONNECTSWITHREALIZINGELEMENTS",504942748:"IFCRELCONNECTSWITHECCENTRICITY",1638771189:"IFCRELCONNECTSSTRUCTURALMEMBER",3912681535:"IFCRELCONNECTSSTRUCTURALELEMENT",2127690289:"IFCRELCONNECTSSTRUCTURALACTIVITY",3190031847:"IFCRELCONNECTSPORTS",4201705270:"IFCRELCONNECTSPORTTOELEMENT",3945020480:"IFCRELCONNECTSPATHELEMENTS",1204542856:"IFCRELCONNECTSELEMENTS",826625072:"IFCRELCONNECTS",2851387026:"IFCRELASSOCIATESPROFILEPROPERTIES",2655215786:"IFCRELASSOCIATESMATERIAL",3840914261:"IFCRELASSOCIATESLIBRARY",982818633:"IFCRELASSOCIATESDOCUMENT",2728634034:"IFCRELASSOCIATESCONSTRAINT",919958153:"IFCRELASSOCIATESCLASSIFICATION",4095574036:"IFCRELASSOCIATESAPPROVAL",1327628568:"IFCRELASSOCIATESAPPLIEDVALUE",1865459582:"IFCRELASSOCIATES",205026976:"IFCRELASSIGNSTORESOURCE",3372526763:"IFCRELASSIGNSTOPROJECTORDER",2857406711:"IFCRELASSIGNSTOPRODUCT",4278684876:"IFCRELASSIGNSTOPROCESS",1307041759:"IFCRELASSIGNSTOGROUP",2495723537:"IFCRELASSIGNSTOCONTROL",1683148259:"IFCRELASSIGNSTOACTOR",3939117080:"IFCRELASSIGNS",3454111270:"IFCRECTANGULARTRIMMEDSURFACE",2798486643:"IFCRECTANGULARPYRAMID",2770003689:"IFCRECTANGLEHOLLOWPROFILEDEF",3219374653:"IFCPROXY",1451395588:"IFCPROPERTYSET",4194566429:"IFCPROJECTIONCURVE",103090709:"IFCPROJECT",4208778838:"IFCPRODUCT",2945172077:"IFCPROCESS",220341763:"IFCPLANE",603570806:"IFCPLANARBOX",3566463478:"IFCPERMEABLECOVERINGPROPERTIES",3505215534:"IFCOFFSETCURVE3D",3388369263:"IFCOFFSETCURVE2D",3888040117:"IFCOBJECT",1425443689:"IFCMANIFOLDSOLIDBREP",1281925730:"IFCLINE",572779678:"IFCLSHAPEPROFILEDEF",1484403080:"IFCISHAPEPROFILEDEF",987898635:"IFCGEOMETRICCURVESET",1268542332:"IFCFURNITURETYPE",4238390223:"IFCFURNISHINGELEMENTTYPE",3455213021:"IFCFLUIDFLOWPROPERTIES",315944413:"IFCFILLAREASTYLETILES",4203026998:"IFCFILLAREASTYLETILESYMBOLWITHSTYLE",374418227:"IFCFILLAREASTYLEHATCHING",2047409740:"IFCFACEBASEDSURFACEMODEL",477187591:"IFCEXTRUDEDAREASOLID",80994333:"IFCENERGYPROPERTIES",2835456948:"IFCELLIPSEPROFILEDEF",2777663545:"IFCELEMENTARYSURFACE",339256511:"IFCELEMENTTYPE",1883228015:"IFCELEMENTQUANTITY",1472233963:"IFCEDGELOOP",4006246654:"IFCDRAUGHTINGPREDEFINEDCURVEFONT",445594917:"IFCDRAUGHTINGPREDEFINEDCOLOUR",3073041342:"IFCDRAUGHTINGCALLOUT",526551008:"IFCDOORSTYLE",1714330368:"IFCDOORPANELPROPERTIES",2963535650:"IFCDOORLININGPROPERTIES",32440307:"IFCDIRECTION",4054601972:"IFCDIMENSIONCURVETERMINATOR",606661476:"IFCDIMENSIONCURVE",693772133:"IFCDEFINEDSYMBOL",2827736869:"IFCCURVEBOUNDEDPLANE",2601014836:"IFCCURVE",2147822146:"IFCCSGSOLID",2506170314:"IFCCSGPRIMITIVE3D",194851669:"IFCCRANERAILFSHAPEPROFILEDEF",4133800736:"IFCCRANERAILASHAPEPROFILEDEF",2485617015:"IFCCOMPOSITECURVESEGMENT",2205249479:"IFCCLOSEDSHELL",1383045692:"IFCCIRCLEPROFILEDEF",1416205885:"IFCCARTESIANTRANSFORMATIONOPERATOR3DNONUNIFORM",3331915920:"IFCCARTESIANTRANSFORMATIONOPERATOR3D",3486308946:"IFCCARTESIANTRANSFORMATIONOPERATOR2DNONUNIFORM",3749851601:"IFCCARTESIANTRANSFORMATIONOPERATOR2D",59481748:"IFCCARTESIANTRANSFORMATIONOPERATOR",1123145078:"IFCCARTESIANPOINT",2898889636:"IFCCSHAPEPROFILEDEF",2713105998:"IFCBOXEDHALFSPACE",2581212453:"IFCBOUNDINGBOX",4182860854:"IFCBOUNDEDSURFACE",2736907675:"IFCBOOLEANRESULT",2740243338:"IFCAXIS2PLACEMENT3D",3125803723:"IFCAXIS2PLACEMENT2D",4261334040:"IFCAXIS1PLACEMENT",1302238472:"IFCANNOTATIONSURFACE",2265737646:"IFCANNOTATIONFILLAREAOCCURRENCE",669184980:"IFCANNOTATIONFILLAREA",3288037868:"IFCANNOTATIONCURVEOCCURRENCE",2543172580:"IFCZSHAPEPROFILEDEF",1299126871:"IFCWINDOWSTYLE",512836454:"IFCWINDOWPANELPROPERTIES",336235671:"IFCWINDOWLININGPROPERTIES",2759199220:"IFCVERTEXLOOP",1417489154:"IFCVECTOR",427810014:"IFCUSHAPEPROFILEDEF",2347495698:"IFCTYPEPRODUCT",1628702193:"IFCTYPEOBJECT",1345879162:"IFCTWODIRECTIONREPEATFACTOR",2715220739:"IFCTRAPEZIUMPROFILEDEF",3124975700:"IFCTEXTLITERALWITHEXTENT",4282788508:"IFCTEXTLITERAL",3028897424:"IFCTERMINATORSYMBOL",3071757647:"IFCTSHAPEPROFILEDEF",230924584:"IFCSWEPTSURFACE",1260650574:"IFCSWEPTDISKSOLID",2247615214:"IFCSWEPTAREASOLID",1878645084:"IFCSURFACESTYLERENDERING",2513912981:"IFCSURFACE",2233826070:"IFCSUBEDGE",3653947884:"IFCSTRUCTURALSTEELPROFILEPROPERTIES",3843319758:"IFCSTRUCTURALPROFILEPROPERTIES",1190533807:"IFCSTRUCTURALLOADSINGLEFORCEWARPING",1597423693:"IFCSTRUCTURALLOADSINGLEFORCE",1973038258:"IFCSTRUCTURALLOADSINGLEDISPLACEMENTDISTORTION",2473145415:"IFCSTRUCTURALLOADSINGLEDISPLACEMENT",2668620305:"IFCSTRUCTURALLOADPLANARFORCE",1595516126:"IFCSTRUCTURALLOADLINEARFORCE",390701378:"IFCSPACETHERMALLOADPROPERTIES",1202362311:"IFCSOUNDVALUE",2485662743:"IFCSOUNDPROPERTIES",723233188:"IFCSOLIDMODEL",2609359061:"IFCSLIPPAGECONNECTIONCONDITION",4124623270:"IFCSHELLBASEDSURFACEMODEL",2411513650:"IFCSERVICELIFEFACTOR",1509187699:"IFCSECTIONEDSPINE",2778083089:"IFCROUNDEDRECTANGLEPROFILEDEF",478536968:"IFCRELATIONSHIP",3765753017:"IFCREINFORCEMENTDEFINITIONPROPERTIES",3413951693:"IFCREGULARTIMESERIES",3615266464:"IFCRECTANGLEPROFILEDEF",110355661:"IFCPROPERTYTABLEVALUE",3650150729:"IFCPROPERTYSINGLEVALUE",3357820518:"IFCPROPERTYSETDEFINITION",941946838:"IFCPROPERTYREFERENCEVALUE",2752243245:"IFCPROPERTYLISTVALUE",4166981789:"IFCPROPERTYENUMERATEDVALUE",1680319473:"IFCPROPERTYDEFINITION",871118103:"IFCPROPERTYBOUNDEDVALUE",673634403:"IFCPRODUCTDEFINITIONSHAPE",179317114:"IFCPREDEFINEDPOINTMARKERSYMBOL",433424934:"IFCPREDEFINEDDIMENSIONSYMBOL",2559016684:"IFCPREDEFINEDCURVEFONT",759155922:"IFCPREDEFINEDCOLOUR",2775532180:"IFCPOLYGONALBOUNDEDHALFSPACE",2924175390:"IFCPOLYLOOP",1423911732:"IFCPOINTONSURFACE",4022376103:"IFCPOINTONCURVE",2067069095:"IFCPOINT",1663979128:"IFCPLANAREXTENT",2004835150:"IFCPLACEMENT",597895409:"IFCPIXELTEXTURE",3021840470:"IFCPHYSICALCOMPLEXQUANTITY",2519244187:"IFCPATH",2529465313:"IFCPARAMETERIZEDPROFILEDEF",1029017970:"IFCORIENTEDEDGE",2665983363:"IFCOPENSHELL",2833995503:"IFCONEDIRECTIONREPEATFACTOR",219451334:"IFCOBJECTDEFINITION",1430189142:"IFCMECHANICALCONCRETEMATERIALPROPERTIES",2022407955:"IFCMATERIALDEFINITIONREPRESENTATION",2347385850:"IFCMAPPEDITEM",1008929658:"IFCLOOP",2624227202:"IFCLOCALPLACEMENT",3422422726:"IFCLIGHTSOURCESPOT",1520743889:"IFCLIGHTSOURCEPOSITIONAL",4266656042:"IFCLIGHTSOURCEGONIOMETRIC",2604431987:"IFCLIGHTSOURCEDIRECTIONAL",125510826:"IFCLIGHTSOURCEAMBIENT",1402838566:"IFCLIGHTSOURCE",3741457305:"IFCIRREGULARTIMESERIES",3905492369:"IFCIMAGETEXTURE",2445078500:"IFCHYGROSCOPICMATERIALPROPERTIES",812098782:"IFCHALFSPACESOLID",178086475:"IFCGRIDPLACEMENT",3590301190:"IFCGEOMETRICSET",4142052618:"IFCGEOMETRICREPRESENTATIONSUBCONTEXT",2453401579:"IFCGEOMETRICREPRESENTATIONITEM",3448662350:"IFCGEOMETRICREPRESENTATIONCONTEXT",1446786286:"IFCGENERALPROFILEPROPERTIES",803998398:"IFCGENERALMATERIALPROPERTIES",3857492461:"IFCFUELPROPERTIES",738692330:"IFCFILLAREASTYLE",4219587988:"IFCFAILURECONNECTIONCONDITION",3008276851:"IFCFACESURFACE",803316827:"IFCFACEOUTERBOUND",1809719519:"IFCFACEBOUND",2556980723:"IFCFACE",1860660968:"IFCEXTENDEDMATERIALPROPERTIES",476780140:"IFCEDGECURVE",3900360178:"IFCEDGE",4170525392:"IFCDRAUGHTINGPREDEFINEDTEXTFONT",3732053477:"IFCDOCUMENTREFERENCE",1694125774:"IFCDIMENSIONPAIR",2273265877:"IFCDIMENSIONCALLOUTRELATIONSHIP",3632507154:"IFCDERIVEDPROFILEDEF",3800577675:"IFCCURVESTYLE",2889183280:"IFCCONVERSIONBASEDUNIT",3050246964:"IFCCONTEXTDEPENDENTUNIT",45288368:"IFCCONNECTIONPOINTECCENTRICITY",1981873012:"IFCCONNECTIONCURVEGEOMETRY",370225590:"IFCCONNECTEDFACESET",1485152156:"IFCCOMPOSITEPROFILEDEF",2542286263:"IFCCOMPLEXPROPERTY",776857604:"IFCCOLOURRGB",647927063:"IFCCLASSIFICATIONREFERENCE",3150382593:"IFCCENTERLINEPROFILEDEF",616511568:"IFCBLOBTEXTURE",2705031697:"IFCARBITRARYPROFILEDEFWITHVOIDS",1310608509:"IFCARBITRARYOPENPROFILEDEF",3798115385:"IFCARBITRARYCLOSEDPROFILEDEF",2297822566:"IFCANNOTATIONTEXTOCCURRENCE",3612888222:"IFCANNOTATIONSYMBOLOCCURRENCE",962685235:"IFCANNOTATIONSURFACEOCCURRENCE",2442683028:"IFCANNOTATIONOCCURRENCE",1065908215:"IFCWATERPROPERTIES",891718957:"IFCVIRTUALGRIDINTERSECTION",1907098498:"IFCVERTEXPOINT",3304826586:"IFCVERTEXBASEDTEXTUREMAP",2799835756:"IFCVERTEX",180925521:"IFCUNITASSIGNMENT",1735638870:"IFCTOPOLOGYREPRESENTATION",1377556343:"IFCTOPOLOGICALREPRESENTATIONITEM",581633288:"IFCTIMESERIESVALUE",1718945513:"IFCTIMESERIESREFERENCERELATIONSHIP",3101149627:"IFCTIMESERIES",3317419933:"IFCTHERMALMATERIALPROPERTIES",1210645708:"IFCTEXTUREVERTEX",2552916305:"IFCTEXTUREMAP",1742049831:"IFCTEXTURECOORDINATEGENERATOR",280115917:"IFCTEXTURECOORDINATE",1484833681:"IFCTEXTSTYLEWITHBOXCHARACTERISTICS",1640371178:"IFCTEXTSTYLETEXTMODEL",2636378356:"IFCTEXTSTYLEFORDEFINEDFONT",1983826977:"IFCTEXTSTYLEFONTMODEL",1447204868:"IFCTEXTSTYLE",912023232:"IFCTELECOMADDRESS",531007025:"IFCTABLEROW",985171141:"IFCTABLE",1290481447:"IFCSYMBOLSTYLE",626085974:"IFCSURFACETEXTURE",1351298697:"IFCSURFACESTYLEWITHTEXTURES",846575682:"IFCSURFACESTYLESHADING",1607154358:"IFCSURFACESTYLEREFRACTION",3303107099:"IFCSURFACESTYLELIGHTING",1300840506:"IFCSURFACESTYLE",3049322572:"IFCSTYLEDREPRESENTATION",3958052878:"IFCSTYLEDITEM",2830218821:"IFCSTYLEMODEL",3408363356:"IFCSTRUCTURALLOADTEMPERATURE",2525727697:"IFCSTRUCTURALLOADSTATIC",2162789131:"IFCSTRUCTURALLOAD",2273995522:"IFCSTRUCTURALCONNECTIONCONDITION",3692461612:"IFCSIMPLEPROPERTY",4240577450:"IFCSHAPEREPRESENTATION",3982875396:"IFCSHAPEMODEL",867548509:"IFCSHAPEASPECT",4165799628:"IFCSECTIONREINFORCEMENTPROPERTIES",2042790032:"IFCSECTIONPROPERTIES",448429030:"IFCSIUNIT",2341007311:"IFCROOT",3679540991:"IFCRIBPLATEPROFILEPROPERTIES",1660063152:"IFCREPRESENTATIONMAP",3008791417:"IFCREPRESENTATIONITEM",3377609919:"IFCREPRESENTATIONCONTEXT",1076942058:"IFCREPRESENTATION",1222501353:"IFCRELAXATION",1580146022:"IFCREINFORCEMENTBARPROPERTIES",2692823254:"IFCREFERENCESVALUEDOCUMENT",825690147:"IFCQUANTITYWEIGHT",2405470396:"IFCQUANTITYVOLUME",3252649465:"IFCQUANTITYTIME",931644368:"IFCQUANTITYLENGTH",2093928680:"IFCQUANTITYCOUNT",2044713172:"IFCQUANTITYAREA",3710013099:"IFCPROPERTYENUMERATION",148025276:"IFCPROPERTYDEPENDENCYRELATIONSHIP",3896028662:"IFCPROPERTYCONSTRAINTRELATIONSHIP",2598011224:"IFCPROPERTY",2802850158:"IFCPROFILEPROPERTIES",3958567839:"IFCPROFILEDEF",2267347899:"IFCPRODUCTSOFCOMBUSTIONPROPERTIES",2095639259:"IFCPRODUCTREPRESENTATION",2417041796:"IFCPRESENTATIONSTYLEASSIGNMENT",3119450353:"IFCPRESENTATIONSTYLE",1304840413:"IFCPRESENTATIONLAYERWITHSTYLE",2022622350:"IFCPRESENTATIONLAYERASSIGNMENT",1775413392:"IFCPREDEFINEDTEXTFONT",3213052703:"IFCPREDEFINEDTERMINATORSYMBOL",990879717:"IFCPREDEFINEDSYMBOL",3727388367:"IFCPREDEFINEDITEM",3355820592:"IFCPOSTALADDRESS",2226359599:"IFCPHYSICALSIMPLEQUANTITY",2483315170:"IFCPHYSICALQUANTITY",101040310:"IFCPERSONANDORGANIZATION",2077209135:"IFCPERSON",1207048766:"IFCOWNERHISTORY",1411181986:"IFCORGANIZATIONRELATIONSHIP",4251960020:"IFCORGANIZATION",1227763645:"IFCOPTICALMATERIALPROPERTIES",2251480897:"IFCOBJECTIVE",3701648758:"IFCOBJECTPLACEMENT",1918398963:"IFCNAMEDUNIT",2706619895:"IFCMONETARYUNIT",3368373690:"IFCMETRIC",677618848:"IFCMECHANICALSTEELMATERIALPROPERTIES",4256014907:"IFCMECHANICALMATERIALPROPERTIES",2597039031:"IFCMEASUREWITHUNIT",3265635763:"IFCMATERIALPROPERTIES",2199411900:"IFCMATERIALLIST",1303795690:"IFCMATERIALLAYERSETUSAGE",3303938423:"IFCMATERIALLAYERSET",248100487:"IFCMATERIALLAYER",1847130766:"IFCMATERIALCLASSIFICATIONRELATIONSHIP",1838606355:"IFCMATERIAL",30780891:"IFCLOCALTIME",1566485204:"IFCLIGHTINTENSITYDISTRIBUTION",4162380809:"IFCLIGHTDISTRIBUTIONDATA",3452421091:"IFCLIBRARYREFERENCE",2655187982:"IFCLIBRARYINFORMATION",3020489413:"IFCIRREGULARTIMESERIESVALUE",852622518:"IFCGRIDAXIS",3548104201:"IFCEXTERNALLYDEFINEDTEXTFONT",3207319532:"IFCEXTERNALLYDEFINEDSYMBOL",1040185647:"IFCEXTERNALLYDEFINEDSURFACESTYLE",2242383968:"IFCEXTERNALLYDEFINEDHATCHSTYLE",3200245327:"IFCEXTERNALREFERENCE",1648886627:"IFCENVIRONMENTALIMPACTVALUE",3796139169:"IFCDRAUGHTINGCALLOUTRELATIONSHIP",770865208:"IFCDOCUMENTINFORMATIONRELATIONSHIP",1154170062:"IFCDOCUMENTINFORMATION",1376555844:"IFCDOCUMENTELECTRONICFORMAT",2949456006:"IFCDIMENSIONALEXPONENTS",1045800335:"IFCDERIVEDUNITELEMENT",1765591967:"IFCDERIVEDUNIT",1072939445:"IFCDATEANDTIME",3510044353:"IFCCURVESTYLEFONTPATTERN",2367409068:"IFCCURVESTYLEFONTANDSCALING",1105321065:"IFCCURVESTYLEFONT",539742890:"IFCCURRENCYRELATIONSHIP",602808272:"IFCCOSTVALUE",1065062679:"IFCCOORDINATEDUNIVERSALTIMEOFFSET",347226245:"IFCCONSTRAINTRELATIONSHIP",613356794:"IFCCONSTRAINTCLASSIFICATIONRELATIONSHIP",1658513725:"IFCCONSTRAINTAGGREGATIONRELATIONSHIP",1959218052:"IFCCONSTRAINT",2732653382:"IFCCONNECTIONSURFACEGEOMETRY",4257277454:"IFCCONNECTIONPORTGEOMETRY",2614616156:"IFCCONNECTIONPOINTGEOMETRY",2859738748:"IFCCONNECTIONGEOMETRY",3264961684:"IFCCOLOURSPECIFICATION",3639012971:"IFCCLASSIFICATIONNOTATIONFACET",938368621:"IFCCLASSIFICATIONNOTATION",1098599126:"IFCCLASSIFICATIONITEMRELATIONSHIP",1767535486:"IFCCLASSIFICATIONITEM",747523909:"IFCCLASSIFICATION",622194075:"IFCCALENDARDATE",2069777674:"IFCBOUNDARYNODECONDITIONWARPING",1387855156:"IFCBOUNDARYNODECONDITION",3367102660:"IFCBOUNDARYFACECONDITION",1560379544:"IFCBOUNDARYEDGECONDITION",4037036970:"IFCBOUNDARYCONDITION",3869604511:"IFCAPPROVALRELATIONSHIP",390851274:"IFCAPPROVALPROPERTYRELATIONSHIP",2080292479:"IFCAPPROVALACTORRELATIONSHIP",130549933:"IFCAPPROVAL",1110488051:"IFCAPPLIEDVALUERELATIONSHIP",411424972:"IFCAPPLIEDVALUE",639542469:"IFCAPPLICATION",618182010:"IFCADDRESS",3630933823:"IFCACTORROLE",599546466:"FILE_DESCRIPTION",1390159747:"FILE_NAME",1109904537:"FILE_SCHEMA"};class Br{static async getUnits(t){var e;const{IFCUNITASSIGNMENT:n}=Re,s=await t.getAllPropertiesOfType(n);if(!s)return 1;const o=Object.keys(s),a=s[parseInt(o[0],10)];for(const c of a.Units){if(c.value===void 0||c.value===null)continue;const h=await t.getProperties(c.value);if(!h||!h.UnitType||!h.UnitType.value||h.UnitType.value!=="LENGTHUNIT")continue;let p=1,C=1;return h.Name.value==="METRE"&&(C=1),h.Name.value==="FOOT"&&(C=.3048),((e=h.Prefix)==null?void 0:e.value)==="MILLI"&&(p=.001),C*p}return 1}static async findItemByGuid(t,e){var n;const s=t.getAllPropertiesIDs();for(const o of s){const a=await t.getProperties(o);if(a&&((n=a.GlobalId)==null?void 0:n.value)===e)return a}return null}static async getRelationMap(t,e,n){var s;const o=n??(()=>{}),a={},c=t.getAllPropertiesIDs();for(const h of c){const p=await t.getProperties(h);if(!p)continue;const C=p.type===e,I=Object.keys(p).find(_=>_.startsWith("Relating")),f=Object.keys(p).find(_=>_.startsWith("Related"));if(!(C&&I&&f))continue;const T=await t.getProperties((s=p[I])==null?void 0:s.value),A=p[f];if(!T||!A||!(A&&Array.isArray(A)))continue;const F=A.map(_=>_.value);o(T.expressID,F),a[T.expressID]=F}return a}static async getQsetQuantities(t,e,n){const s=n??(()=>{}),o=await t.getProperties(e);return!o||o.type!==ml?null:(o.Quantities??[{}]).map(a=>(a.value&&s(a.value),a.value)).filter(a=>a!==null)}static async getPsetProps(t,e,n){const s=n??(()=>{}),o=await t.getProperties(e);return!o||o.type!==ki?null:(o.HasProperties??[{}]).map(a=>(a.value&&s(a.value),a.value)).filter(a=>a!==null)}static async getPsetRel(t,e){var n;if(!await t.getProperties(e))return null;const s=await t.getAllPropertiesOfType(Ao);if(!s)return null;const o=Object.values(s);let a=null;for(const c of o)((n=c.RelatingPropertyDefinition)==null?void 0:n.value)===e&&(a=c.expressID);return a}static async getQsetRel(t,e){return Br.getPsetRel(t,e)}static async getEntityName(t,e){var n;const s=await t.getProperties(e);if(!s)return{key:null,name:null};const o=Object.keys(s).find(c=>c.endsWith("Name"))??null,a=o?(n=s[o])==null?void 0:n.value:null;return{key:o,name:a}}static async getQuantityValue(t,e){const n=await t.getProperties(e);if(!n)return{key:null,value:null};const s=Object.keys(n).find(a=>a.endsWith("Value"))??null;let o;return s===null||n[s]===void 0||n[s]===null?o=null:o=n[s].value,{key:s,value:o}}static isRel(t){return Hu[t].startsWith("IFCREL")}static async attributeExists(t,e,n){const s=await t.getProperties(e);return s?Object.keys(s).includes(n):!1}static async groupEntitiesByType(t,e){var n;const s=new Map;for(const o of e){const a=await t.getProperties(o);if(!a)continue;const c=a.type;s.get(c)||s.set(c,new Set),(n=s.get(c))==null||n.add(o)}return s}}const Ku=class mo extends re{constructor(t){super(t),R(this,"onDisposed",new at),R(this,"enabled",!0),R(this,"relationsToProcess",[Ao,ll,cl,Fo,hl,ul]),R(this,"indexMap",{}),R(this,"_propertiesManager",null),R(this,"onPropertiesManagerSet",new at),R(this,"onFragmentsDisposed",e=>{delete this.indexMap[e.groupID]}),this.components.add(mo.uuid,this),t.get(fo).onFragmentsDisposed.add(this.onFragmentsDisposed)}set propertiesManager(t){this._propertiesManager||(this._propertiesManager=t,t&&(t.onElementToPset.add(async({model:e,psetID:n,elementID:s})=>{this.indexMap[e.uuid]&&this.setEntityIndex(e,s).add(n)}),this.onPropertiesManagerSet.trigger(t)))}get propertiesManager(){return this._propertiesManager}async dispose(){this.indexMap={},this.propertiesManager=null,this.onPropertiesManagerSet.reset(),this.components.get(fo).onFragmentsDisposed.remove(this.onFragmentsDisposed),this.onDisposed.trigger(mo.uuid),this.onDisposed.reset()}async getProperties(t,e){if(!t.hasProperties)return null;const n=t.getLocalProperties();if(n===void 0)return null;const s=this.indexMap[t.uuid];if(!s)return null;const o=s[e],a=parseInt(e,10),c=await t.getProperties(a);if(!c)throw new Error("Properties not found!");const h=this.cloneProperty(c);if(!h)throw new Error("Properties not found!");const p=[h];if(o)for(const C of o){const I=await t.getProperties(C);if(!I)continue;const f=this.cloneProperty(I);f&&(this.getPsetProperties(f,n),this.getNestedPsets(f,n),p.push(f))}return p}getNestedPsets(t,e){if(t.HasPropertySets)for(const n of t.HasPropertySets){const s=n.value;n.value=this.cloneProperty(e[s]),this.getPsetProperties(n.value,e)}}getPsetProperties(t,e){if(t.HasProperties)for(const n of t.HasProperties){const s=n.value,o=this.cloneProperty(e[s]);n.value={...o}}}async process(t){if(!t.hasProperties)throw new Error("FragmentsGroup properties not found");this.indexMap[t.uuid]={};const e=[ki,ml];for(const n of this.relationsToProcess)await Br.getRelationMap(t,n,async(s,o)=>{const a=await t.getProperties(s);if(a){e.includes(a.type)||this.setEntityIndex(t,s);for(const c of o)this.setEntityIndex(t,c).add(s)}})}setEntityIndex(t,e){return this.indexMap[t.uuid][e]||(this.indexMap[t.uuid][e]=new Set),this.indexMap[t.uuid][e]}cloneProperty(t,e={}){if(!t)return e;for(const n in t){const s=t[n],o=Array.isArray(s),a=typeof s=="object"&&!o&&s!==null;if(o){e[n]=[];const c=e[n];this.clonePropertyArray(s,c)}else if(a){e[n]={};const c=e[n];this.cloneProperty(s,c)}else e[n]=s}return e}clonePropertyArray(t,e){for(const n of t){const s=Array.isArray(n),o=typeof n=="object"&&!s&&n!==null;if(s){const a=[];e.push(a),this.clonePropertyArray(n,a)}else if(o){const a={};e.push(a),this.cloneProperty(n,a)}else e.push(n)}}};R(Ku,"uuid","23a889ab-83b3-44a4-8bee-ead83438370b");const Wu=class Vn extends re{constructor(t){super(t),R(this,"onDisposed",new at),R(this,"onRequestFile",new at),R(this,"ifcToExport",null),R(this,"onElementToPset",new at),R(this,"onPropToPset",new at),R(this,"onPsetRemoved",new at),R(this,"onDataChanged",new at),R(this,"wasm",{path:"/",absolute:!1}),R(this,"enabled",!0),R(this,"attributeListeners",{}),R(this,"selectedModel"),R(this,"_changeMap",{}),this.components.add(Vn.uuid,this)}get(){return this._changeMap}dispose(){this.selectedModel=void 0,this.attributeListeners={},this._changeMap={},this.onElementToPset.reset(),this.onPropToPset.reset(),this.onPsetRemoved.reset(),this.onDataChanged.reset(),this.onDisposed.trigger(Vn.uuid),this.onDisposed.reset()}increaseMaxID(t){return t.ifcMetadata.maxExpressID++,t.ifcMetadata.maxExpressID}static getIFCSchema(t){const e=t.ifcMetadata.schema;if(!e)throw new Error("IFC Schema not found");return e}newGUID(t){const e=Vn.getIFCSchema(t);return new Re[e].IfcGloballyUniqueId(Po.create())}async getOwnerHistory(t){const e=await t.getAllPropertiesOfType(Pc);if(!e)throw new Error("No OwnerHistory was found.");const n=Object.keys(e).map(a=>parseInt(a,10)),s=e[n[0]],o=new di(s.expressID);return{ownerHistory:s,ownerHistoryHandle:o}}registerChange(t,...e){this._changeMap[t.uuid]||(this._changeMap[t.uuid]=new Set);for(const n of e)this._changeMap[t.uuid].add(n),this.onDataChanged.trigger({model:t,expressID:n})}async setData(t,...e){for(const n of e){const s=n.expressID;s&&(await t.setProperties(s,n),this.registerChange(t,s))}}async newPset(t,e,n){const s=Vn.getIFCSchema(t),{ownerHistoryHandle:o}=await this.getOwnerHistory(t),a=this.newGUID(t),c=new Re[s].IfcLabel(e),h=n?new Re[s].IfcText(n):null,p=new Re[s].IfcPropertySet(a,o,c,h,[]);p.expressID=this.increaseMaxID(t);const C=this.newGUID(t),I=new Re[s].IfcRelDefinesByProperties(C,o,null,null,[],new di(p.expressID));return I.expressID=this.increaseMaxID(t),await this.setData(t,p,I),{pset:p,rel:I}}async removePset(t,...e){for(const n of e){const s=await t.getProperties(n);if((s==null?void 0:s.type)!==ki)continue;const o=await Br.getPsetRel(t,n);if(o&&(await t.setProperties(o,null),this.registerChange(t,o)),s){for(const a of s.HasProperties)await t.setProperties(a.value,null);await t.setProperties(n,null),this.onPsetRemoved.trigger({model:t,psetID:n}),this.registerChange(t,n)}}}async newSingleProperty(t,e,n,s){const o=Vn.getIFCSchema(t),a=new Re[o].IfcIdentifier(n),c=new Re[o][e](s),h=new Re[o].IfcPropertySingleValue(a,null,c,null);return h.expressID=this.increaseMaxID(t),await this.setData(t,h),h}newSingleStringProperty(t,e,n,s){return this.newSingleProperty(t,e,n,s)}newSingleNumericProperty(t,e,n,s){return this.newSingleProperty(t,e,n,s)}newSingleBooleanProperty(t,e,n,s){return this.newSingleProperty(t,e,n,s)}async removePsetProp(t,e,n){const s=await t.getProperties(e),o=await t.getProperties(n);!s||!o||s.type===ki&&o&&(s.HasProperties=s.HasProperties.filter(a=>a.value!==n),await t.setProperties(n,null),this.registerChange(t,e,n))}async addElementToPset(t,e,...n){const s=await Br.getPsetRel(t,e);if(!s)return;const o=await t.getProperties(s);if(o){for(const a of n){const c=new di(a);o.RelatedObjects.push(c),this.onElementToPset.trigger({model:t,psetID:e,elementID:a})}this.registerChange(t,e)}}async addPropToPset(t,e,...n){const s=await t.getProperties(e);if(s){for(const o of n){if(s.HasProperties.includes(o))continue;const a=new di(o);s.HasProperties.push(a),this.onPropToPset.trigger({model:t,psetID:e,propID:o})}this.registerChange(t,e)}}async saveToIfc(t,e){const n=this.components.get(Yu),s=n.webIfc,o=await n.readIfcFile(e),a=this._changeMap[t.uuid]??[];for(const h of a){const p=await t.getProperties(h);if(p)try{s.WriteLine(o,p)}catch{}else try{s.DeleteLine(o,h)}catch{}}const c=s.SaveModel(o);return n.webIfc.CloseModel(o),n.cleanUp(),c}async setAttributeListener(t,e,n){this.attributeListeners[t.uuid]||(this.attributeListeners[t.uuid]={});const s=this.attributeListeners[t.uuid][e]?this.attributeListeners[t.uuid][e][n]:null;if(s)return s;const o=await t.getProperties(e);if(!o)throw new Error(`Entity with expressID ${e} doesn't exists.`);const a=o[n];if(Array.isArray(a)||!a)throw new Error(`Attribute ${n} is array or null, and it can't have a listener.`);const c=a.value;if(c===void 0||c==null)throw new Error(`Attribute ${n} has a badly defined handle.`);const h=new at;return Object.defineProperty(o[n],"value",{get(){return this._value},async set(p){this._value=p,h.trigger(p)}}),o[n].value=c,this.attributeListeners[t.uuid][e]||(this.attributeListeners[t.uuid][e]={}),this.attributeListeners[t.uuid][e][n]=h,h}};R(Wu,"uuid","58c2d9f0-183c-48d6-a402-dfcf5b9a34df");class Xu extends xr{constructor(t=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=t,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new Fe(.5,.5),this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof Element&&e.element.parentNode!==null&&e.element.parentNode.removeChild(e.element)})})}copy(t,e){return super.copy(t,e),this.element=t.element.cloneNode(!0),this.center=t.center,this}}const Gn=new q,Ja=new Mt,tl=new Mt,el=new q,nl=new q;class ju{constructor(t={}){const e=this;let n,s,o,a;const c={objects:new WeakMap},h=t.element!==void 0?t.element:document.createElement("div");h.style.overflow="hidden",this.domElement=h,this.getSize=function(){return{width:n,height:s}},this.render=function(T,A){T.matrixWorldAutoUpdate===!0&&T.updateMatrixWorld(),A.parent===null&&A.matrixWorldAutoUpdate===!0&&A.updateMatrixWorld(),Ja.copy(A.matrixWorldInverse),tl.multiplyMatrices(A.projectionMatrix,Ja),p(T,T,A),f(T)},this.setSize=function(T,A){n=T,s=A,o=n/2,a=s/2,h.style.width=T+"px",h.style.height=A+"px"};function p(T,A,F){if(T.isCSS2DObject){Gn.setFromMatrixPosition(T.matrixWorld),Gn.applyMatrix4(tl);const _=T.visible===!0&&Gn.z>=-1&&Gn.z<=1&&T.layers.test(F.layers)===!0;if(T.element.style.display=_===!0?"":"none",_===!0){T.onBeforeRender(e,A,F);const v=T.element;v.style.transform="translate("+-100*T.center.x+"%,"+-100*T.center.y+"%)translate("+(Gn.x*o+o)+"px,"+(-Gn.y*a+a)+"px)",v.parentNode!==h&&h.appendChild(v),T.onAfterRender(e,A,F)}const w={distanceToCameraSquared:C(F,T)};c.objects.set(T,w)}for(let _=0,w=T.children.length;_<w;_++)p(T.children[_],A,F)}function C(T,A){return el.setFromMatrixPosition(T.matrixWorld),nl.setFromMatrixPosition(A.matrixWorld),el.distanceToSquared(nl)}function I(T){const A=[];return T.traverse(function(F){F.isCSS2DObject&&A.push(F)}),A}function f(T){const A=I(T).sort(function(_,w){if(_.renderOrder!==w.renderOrder)return w.renderOrder-_.renderOrder;const v=c.objects.get(_).distanceToCameraSquared,Y=c.objects.get(w).distanceToCameraSquared;return v-Y}),F=A.length;for(let _=0,w=A.length;_<w;_++)A[_].element.style.zIndex=F-_}}}class qu extends Eu{constructor(e,n,s){super(e,n,s);Wt(this,"three2D",new ju);this.onAfterUpdate.add(()=>{if(this.onBeforeUpdate.trigger(this),!this.enabled||!this.currentWorld)return;const o=this.currentWorld.scene.three,a=this.currentWorld.camera.three;o instanceof Mr&&this.three2D.render(o,a)}),this.onDisposed.add(()=>{this.three2D.domElement.remove()}),this.onResize.add(({x:o,y:a})=>{this.three2D.setSize(o,a)}),this.onContainerUpdated.add(o=>{o.appendChild(this.three2D.domElement)}),this.setupHtmlRenderer(),this.resize()}setupHtmlRenderer(){this.three2D.domElement.style.position="absolute",this.three2D.domElement.style.top="0px",this.three2D.domElement.style.pointerEvents="none",this.container&&this.container.appendChild(this.three2D.domElement)}}class rl{constructor(t,e,n){Wt(this,"three");Wt(this,"world");Wt(this,"onDisposed",new at);this.world=t;let s;e?s=e:(s=document.createElement("div"),s.className="w-[15px] h-[15px] border-3 border-solid border-red-600"),this.three=new Xu(s),(n||t.scene.three).add(this.three),this.visible=!0}set visible(t){this.three.visible=t}get visible(){return this.three.visible}toggleVisibility(){this.visible=!this.visible}dispose(){this.three.removeFromParent(),this.three.element.remove(),this.onDisposed.trigger(),this.onDisposed.reset()}}const Vi=class Vi extends re{constructor(e){super(e);Wt(this,"enabled",!0);Wt(this,"threshold",50);Wt(this,"autoCluster",!0);Wt(this,"list",new Map);Wt(this,"clusterLabels",new Set);Wt(this,"currentKeys",new Set);Wt(this,"_color","white");Wt(this,"_markerKey",0);Wt(this,"_clusterKey",0);Wt(this,"isNavigating",!1);Wt(this,"_setupWorlds",new Set);e.add(Vi.uuid,this)}get color(){return this._color}set color(e){this._color=e;for(const[n,s]of this.list)s.label.three.element.style.color=e}create(e,n,s){this.setupEvents(e,!0);const o=document.createElement("span");o.innerHTML=n,o.style.color=this._color;const a=new rl(e,o);a.three.position.copy(s);const c=this._markerKey.toString();return this.list.set(c,{key:c,label:a,merged:!1,static:!1}),this._markerKey++,c}delete(e){const n=this.list.get(e);n&&n.label.dispose(),this.list.delete(e)}clear(e){const n=[...this.list.keys()];for(const s of n){const o=this.list.get(s);e&&o.type!==e||(o.label.dispose(),this.list.delete(s))}this.list.clear(),this._markerKey=0}dispose(){for(const[e,n]of this.list)n.label.dispose();this.list.clear(),this._markerKey=0;for(const e of this.clusterLabels)e.label.dispose();this.clusterLabels.clear(),this._clusterKey=0,this.currentKeys.clear()}setupEvents(e,n){n&&this._setupWorlds.has(e.uuid)||e.camera.hasCameraControls()&&(n?(e.camera.controls.addEventListener("sleep",()=>{this.manageCluster()}),e.camera.controls.addEventListener("rest",()=>{this.isNavigating&&(this.manageCluster(),this.isNavigating=!1)})):(e.camera.controls.removeEventListener("sleep",()=>{this.manageCluster()}),e.camera.controls.removeEventListener("rest",()=>{this.isNavigating&&(this.manageCluster(),this.isNavigating=!1)})))}resetMarkers(){for(const[e,n]of this.list)n.merged=!1;for(const e of this.clusterLabels)e.label.dispose();this.clusterLabels.clear(),this._clusterKey=0}removeMergeMarkers(){for(const[e,n]of this.list)n.merged?n.label.dispose():n.label.world.scene.three.add(n.label.three);for(const e of this.clusterLabels)if(e.markerKeys.length===1){const n=this.list.get(e.markerKeys[0]);n&&(n.label.world.scene.three.add(n.label.three),n.merged=!1),e.label.dispose(),this.clusterLabels.delete(e)}}manageCluster(){if(this.autoCluster){this.resetMarkers();for(const[e,n]of this.list)if(!n.merged&&!n.static){this.currentKeys.clear();for(const[s,o]of this.list)o.static||n.key!==o.key&&!o.merged&&this.distance(n.label,o.label)<this.threshold&&(this.currentKeys.add(o.key),o.merged=!0);if(this.currentKeys.size>0){this.currentKeys.add(n.key),n.merged=!0;const s=Array.from(this.currentKeys),o=this.getAveragePositionFromLabels(s),a=new rl(n.label.world,this.createClusterElement(this._clusterKey.toString())),{element:c}=a.three;c.textContent=s.length.toString(),a.three.position.copy(o),this.clusterLabels.add({key:this._clusterKey.toString(),markerKeys:s,label:a}),this._clusterKey++}}this.removeMergeMarkers()}}getAveragePositionFromLabels(e){const n=e.map(s=>{const o=this.list.get(s);return o?o.label.three.position:new q});return n.reduce((s,o)=>s.add(o),new q).divideScalar(n.length)}createClusterElement(e){const n=document.createElement("div");return n.textContent=e,n.style.color="#000000",n.style.background="#FFFFFF",n.style.fontSize="1.2rem",n.style.fontWeight="500",n.style.pointerEvents="auto",n.style.borderRadius="50%",n.style.padding="5px 11px",n.style.textAlign="center",n.style.cursor="pointer",n.addEventListener("pointerdown",()=>{this.navigateToCluster(e)}),n.addEventListener("pointerover",()=>{n.style.background="#BCF124"}),n.addEventListener("pointerout",()=>{n.style.background="#FFFFFF"}),n}getScreenPosition(e){const n=new q;if(!e.world.renderer)throw new Error("Renderer not found!");const s=e.three.position.clone();s.project(e.world.camera.three);const o=e.world.renderer.getSize();return n.x=s.x*o.x/2+o.x/2,n.y=-(s.y*o.y/2)+o.y/2,n}distance(e,n){const s=this.getScreenPosition(e),o=this.getScreenPosition(n),a=s.x-o.x,c=s.y-o.y,h=Math.sqrt(a*a+c*c)*.5;return h===0?this.threshold+1:h}navigateToCluster(e){const n=[],s=Array.from(this.clusterLabels).find(I=>I.key===e);if(!s)return;const o=s.label.world.camera;if(!o.hasCameraControls()){console.warn("Zoom to clusters only supported with Camera Controls!");return}for(const I of s.markerKeys){const f=this.list.get(I);if(f){const{x:T,y:A,z:F}=f.label.three.position;n.push(T,A,F)}}s.label.dispose(),this.clusterLabels.delete(s);const a=new Wn,c=new Float32Array(n),h=new Zn(c,3);a.setAttribute("position",h);const p=new lt(a);p.geometry.computeBoundingSphere(),p.geometry.boundingSphere&&o.controls.fitToSphere(p,!0),this.isNavigating=!0,a.dispose(),p.clear(),n.length=0}};Wt(Vi,"uuid","4079eb91-79b0-4ede-bcf2-15b837129236");let Co=Vi;var Hl={exports:{}};(function(u,t){(function(e,n){u.exports=n()})(Ea,function(){var e=function(r,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var E in d)Object.prototype.hasOwnProperty.call(d,E)&&(l[E]=d[E])})(r,i)},n=function(){return(n=Object.assign||function(r){for(var i,l=1,d=arguments.length;l<d;l++)for(var E in i=arguments[l])Object.prototype.hasOwnProperty.call(i,E)&&(r[E]=i[E]);return r}).apply(this,arguments)};function s(r,i,l){if(l||arguments.length===2)for(var d,E=0,m=i.length;E<m;E++)!d&&E in i||((d=d||Array.prototype.slice.call(i,0,E))[E]=i[E]);return r.concat(d||Array.prototype.slice.call(i))}var o=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Ea,a=Object.keys,c=Array.isArray;function h(r,i){return typeof i!="object"||a(i).forEach(function(l){r[l]=i[l]}),r}typeof Promise>"u"||o.Promise||(o.Promise=Promise);var p=Object.getPrototypeOf,C={}.hasOwnProperty;function I(r,i){return C.call(r,i)}function f(r,i){typeof i=="function"&&(i=i(p(r))),(typeof Reflect>"u"?a:Reflect.ownKeys)(i).forEach(function(l){A(r,l,i[l])})}var T=Object.defineProperty;function A(r,i,l,d){T(r,i,h(l&&I(l,"get")&&typeof l.get=="function"?{get:l.get,set:l.set,configurable:!0}:{value:l,configurable:!0,writable:!0},d))}function F(r){return{from:function(i){return r.prototype=Object.create(i.prototype),A(r.prototype,"constructor",r),{extend:f.bind(null,r.prototype)}}}}var _=Object.getOwnPropertyDescriptor,w=[].slice;function v(r,i,l){return w.call(r,i,l)}function Y(r,i){return i(r)}function y(r){if(!r)throw new Error("Assertion Failed")}function L(r){o.setImmediate?setImmediate(r):setTimeout(r,0)}function k(r,i){if(typeof i=="string"&&I(r,i))return r[i];if(!i)return r;if(typeof i!="string"){for(var l=[],d=0,E=i.length;d<E;++d){var m=k(r,i[d]);l.push(m)}return l}var g=i.indexOf(".");if(g!==-1){var O=r[i.substr(0,g)];return O==null?void 0:k(O,i.substr(g+1))}}function V(r,i,l){if(r&&i!==void 0&&!("isFrozen"in Object&&Object.isFrozen(r)))if(typeof i!="string"&&"length"in i){y(typeof l!="string"&&"length"in l);for(var d=0,E=i.length;d<E;++d)V(r,i[d],l[d])}else{var m,g,O=i.indexOf(".");O!==-1?(m=i.substr(0,O),(g=i.substr(O+1))===""?l===void 0?c(r)&&!isNaN(parseInt(m))?r.splice(m,1):delete r[m]:r[m]=l:V(O=!(O=r[m])||!I(r,m)?r[m]={}:O,g,l)):l===void 0?c(r)&&!isNaN(parseInt(i))?r.splice(i,1):delete r[i]:r[i]=l}}function H(r){var i,l={};for(i in r)I(r,i)&&(l[i]=r[i]);return l}var j=[].concat;function Q(r){return j.apply([],r)}var Be="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Q([8,16,32,64].map(function(r){return["Int","Uint","Float"].map(function(i){return i+r+"Array"})}))).filter(function(r){return o[r]}),J=new Set(Be.map(function(r){return o[r]})),$=null;function nt(r){return $=new WeakMap,r=function i(l){if(!l||typeof l!="object")return l;var d=$.get(l);if(d)return d;if(c(l)){d=[],$.set(l,d);for(var E=0,m=l.length;E<m;++E)d.push(i(l[E]))}else if(J.has(l.constructor))d=l;else{var g,O=p(l);for(g in d=O===Object.prototype?{}:Object.create(O),$.set(l,d),l)I(l,g)&&(d[g]=i(l[g]))}return d}(r),$=null,r}var ut={}.toString;function It(r){return ut.call(r).slice(8,-1)}var yt=typeof Symbol<"u"?Symbol.iterator:"@@iterator",kt=typeof yt=="symbol"?function(r){var i;return r!=null&&(i=r[yt])&&i.apply(r)}:function(){return null};function Rt(r,i){return i=r.indexOf(i),0<=i&&r.splice(i,1),0<=i}var Jt={};function Kt(r){var i,l,d,E;if(arguments.length===1){if(c(r))return r.slice();if(this===Jt&&typeof r=="string")return[r];if(E=kt(r)){for(l=[];!(d=E.next()).done;)l.push(d.value);return l}if(r==null)return[r];if(typeof(i=r.length)!="number")return[r];for(l=new Array(i);i--;)l[i]=r[i];return l}for(i=arguments.length,l=new Array(i);i--;)l[i]=arguments[i];return l}var fe=typeof Symbol<"u"?function(r){return r[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},sr=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],ce=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(sr),Tn={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function le(r,i){this.name=r,this.message=i}function er(r,i){return r+". Errors: "+Object.keys(i).map(function(l){return i[l].toString()}).filter(function(l,d,E){return E.indexOf(l)===d}).join(`
`)}function rn(r,i,l,d){this.failures=i,this.failedKeys=d,this.successCount=l,this.message=er(r,i)}function xe(r,i){this.name="BulkError",this.failures=Object.keys(i).map(function(l){return i[l]}),this.failuresByPos=i,this.message=er(r,this.failures)}F(le).from(Error).extend({toString:function(){return this.name+": "+this.message}}),F(rn).from(le),F(xe).from(le);var De=ce.reduce(function(r,i){return r[i]=i+"Error",r},{}),Ut=le,ct=ce.reduce(function(r,i){var l=i+"Error";function d(E,m){this.name=l,E?typeof E=="string"?(this.message="".concat(E).concat(m?`
 `+m:""),this.inner=m||null):typeof E=="object"&&(this.message="".concat(E.name," ").concat(E.message),this.inner=E):(this.message=Tn[i]||l,this.inner=null)}return F(d).from(Ut),r[i]=d,r},{});ct.Syntax=SyntaxError,ct.Type=TypeError,ct.Range=RangeError;var xt=sr.reduce(function(r,i){return r[i+"Error"]=ct[i],r},{}),Ie=ce.reduce(function(r,i){return["Syntax","Type","Range"].indexOf(i)===-1&&(r[i+"Error"]=ct[i]),r},{});function Ot(){}function Oe(r){return r}function Wi(r,i){return r==null||r===Oe?i:function(l){return i(r(l))}}function me(r,i){return function(){r.apply(this,arguments),i.apply(this,arguments)}}function nr(r,i){return r===Ot?i:function(){var l=r.apply(this,arguments);l!==void 0&&(arguments[0]=l);var d=this.onsuccess,E=this.onerror;this.onsuccess=null,this.onerror=null;var m=i.apply(this,arguments);return d&&(this.onsuccess=this.onsuccess?me(d,this.onsuccess):d),E&&(this.onerror=this.onerror?me(E,this.onerror):E),m!==void 0?m:l}}function rr(r,i){return r===Ot?i:function(){r.apply(this,arguments);var l=this.onsuccess,d=this.onerror;this.onsuccess=this.onerror=null,i.apply(this,arguments),l&&(this.onsuccess=this.onsuccess?me(l,this.onsuccess):l),d&&(this.onerror=this.onerror?me(d,this.onerror):d)}}function Wl(r,i){return r===Ot?i:function(l){var d=r.apply(this,arguments);h(l,d);var E=this.onsuccess,m=this.onerror;return this.onsuccess=null,this.onerror=null,l=i.apply(this,arguments),E&&(this.onsuccess=this.onsuccess?me(E,this.onsuccess):E),m&&(this.onerror=this.onerror?me(m,this.onerror):m),d===void 0?l===void 0?void 0:l:h(d,l)}}function Xl(r,i){return r===Ot?i:function(){return i.apply(this,arguments)!==!1&&r.apply(this,arguments)}}function Xi(r,i){return r===Ot?i:function(){var l=r.apply(this,arguments);if(l&&typeof l.then=="function"){for(var d=this,E=arguments.length,m=new Array(E);E--;)m[E]=arguments[E];return l.then(function(){return i.apply(d,m)})}return i.apply(this,arguments)}}Ie.ModifyError=rn,Ie.DexieError=le,Ie.BulkError=xe;var we=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Lo(r){we=r}var ir={},Mo=100,Be=typeof Promise>"u"?[]:function(){var r=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[r,p(r),r];var i=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[i,p(i),r]}(),sr=Be[0],ce=Be[1],Be=Be[2],ce=ce&&ce.then,or=sr&&sr.constructor,ji=!!Be,ar=function(r,i){lr.push([r,i]),kr&&(queueMicrotask(ql),kr=!1)},qi=!0,kr=!0,sn=[],Gr=[],Zi=Oe,ze={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Ot,pgp:!1,env:{},finalize:Ot},ht=ze,lr=[],on=0,Vr=[];function ot(r){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var i=this._PSD=ht;if(typeof r!="function"){if(r!==ir)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&$i(this,this._value))}this._state=null,this._value=null,++i.ref,function l(d,E){try{E(function(m){if(d._state===null){if(m===d)throw new TypeError("A promise cannot be resolved with itself.");var g=d._lib&&gn();m&&typeof m.then=="function"?l(d,function(O,N){m instanceof ot?m._then(O,N):m.then(O,N)}):(d._state=!0,d._value=m,Do(d)),g&&yn()}},$i.bind(null,d))}catch(m){$i(d,m)}}(this,r)}var Qi={get:function(){var r=ht,i=Wr;function l(d,E){var m=this,g=!r.global&&(r!==ht||i!==Wr),O=g&&!Ke(),N=new ot(function(P,D){Ji(m,new xo(Bo(d,r,g,O),Bo(E,r,g,O),P,D,r))});return this._consoleTask&&(N._consoleTask=this._consoleTask),N}return l.prototype=ir,l},set:function(r){A(this,"then",r&&r.prototype===ir?Qi:{get:function(){return r},set:Qi.set})}};function xo(r,i,l,d,E){this.onFulfilled=typeof r=="function"?r:null,this.onRejected=typeof i=="function"?i:null,this.resolve=l,this.reject=d,this.psd=E}function $i(r,i){var l,d;Gr.push(i),r._state===null&&(l=r._lib&&gn(),i=Zi(i),r._state=!1,r._value=i,d=r,sn.some(function(E){return E._value===d._value})||sn.push(d),Do(r),l&&yn())}function Do(r){var i=r._listeners;r._listeners=[];for(var l=0,d=i.length;l<d;++l)Ji(r,i[l]);var E=r._PSD;--E.ref||E.finalize(),on===0&&(++on,ar(function(){--on==0&&ts()},[]))}function Ji(r,i){if(r._state!==null){var l=r._state?i.onFulfilled:i.onRejected;if(l===null)return(r._state?i.resolve:i.reject)(r._value);++i.psd.ref,++on,ar(jl,[l,r,i])}else r._listeners.push(i)}function jl(r,i,l){try{var d,E=i._value;!i._state&&Gr.length&&(Gr=[]),d=we&&i._consoleTask?i._consoleTask.run(function(){return r(E)}):r(E),i._state||Gr.indexOf(E)!==-1||function(m){for(var g=sn.length;g;)if(sn[--g]._value===m._value)return sn.splice(g,1)}(i),l.resolve(d)}catch(m){l.reject(m)}finally{--on==0&&ts(),--l.psd.ref||l.psd.finalize()}}function ql(){an(ze,function(){gn()&&yn()})}function gn(){var r=qi;return kr=qi=!1,r}function yn(){var r,i,l;do for(;0<lr.length;)for(r=lr,lr=[],l=r.length,i=0;i<l;++i){var d=r[i];d[0].apply(null,d[1])}while(0<lr.length);kr=qi=!0}function ts(){var r=sn;sn=[],r.forEach(function(d){d._PSD.onunhandled.call(null,d._value,d)});for(var i=Vr.slice(0),l=i.length;l;)i[--l]()}function zr(r){return new ot(ir,!1,r)}function Nt(r,i){var l=ht;return function(){var d=gn(),E=ht;try{return We(l,!0),r.apply(this,arguments)}catch(m){i&&i(m)}finally{We(E,!1),d&&yn()}}}f(ot.prototype,{then:Qi,_then:function(r,i){Ji(this,new xo(null,null,r,i,ht))},catch:function(r){if(arguments.length===1)return this.then(null,r);var i=r,l=arguments[1];return typeof i=="function"?this.then(null,function(d){return(d instanceof i?l:zr)(d)}):this.then(null,function(d){return(d&&d.name===i?l:zr)(d)})},finally:function(r){return this.then(function(i){return ot.resolve(r()).then(function(){return i})},function(i){return ot.resolve(r()).then(function(){return zr(i)})})},timeout:function(r,i){var l=this;return r<1/0?new ot(function(d,E){var m=setTimeout(function(){return E(new ct.Timeout(i))},r);l.then(d,E).finally(clearTimeout.bind(null,m))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&A(ot.prototype,Symbol.toStringTag,"Dexie.Promise"),ze.env=Uo(),f(ot,{all:function(){var r=Kt.apply(null,arguments).map(Xr);return new ot(function(i,l){r.length===0&&i([]);var d=r.length;r.forEach(function(E,m){return ot.resolve(E).then(function(g){r[m]=g,--d||i(r)},l)})})},resolve:function(r){return r instanceof ot?r:r&&typeof r.then=="function"?new ot(function(i,l){r.then(i,l)}):new ot(ir,!0,r)},reject:zr,race:function(){var r=Kt.apply(null,arguments).map(Xr);return new ot(function(i,l){r.map(function(d){return ot.resolve(d).then(i,l)})})},PSD:{get:function(){return ht},set:function(r){return ht=r}},totalEchoes:{get:function(){return Wr}},newPSD:He,usePSD:an,scheduler:{get:function(){return ar},set:function(r){ar=r}},rejectionMapper:{get:function(){return Zi},set:function(r){Zi=r}},follow:function(r,i){return new ot(function(l,d){return He(function(E,m){var g=ht;g.unhandleds=[],g.onunhandled=m,g.finalize=me(function(){var O,N=this;O=function(){N.unhandleds.length===0?E():m(N.unhandleds[0])},Vr.push(function P(){O(),Vr.splice(Vr.indexOf(P),1)}),++on,ar(function(){--on==0&&ts()},[])},g.finalize),r()},i,l,d)})}}),or&&(or.allSettled&&A(ot,"allSettled",function(){var r=Kt.apply(null,arguments).map(Xr);return new ot(function(i){r.length===0&&i([]);var l=r.length,d=new Array(l);r.forEach(function(E,m){return ot.resolve(E).then(function(g){return d[m]={status:"fulfilled",value:g}},function(g){return d[m]={status:"rejected",reason:g}}).then(function(){return--l||i(d)})})})}),or.any&&typeof AggregateError<"u"&&A(ot,"any",function(){var r=Kt.apply(null,arguments).map(Xr);return new ot(function(i,l){r.length===0&&l(new AggregateError([]));var d=r.length,E=new Array(d);r.forEach(function(m,g){return ot.resolve(m).then(function(O){return i(O)},function(O){E[g]=O,--d||l(new AggregateError(E))})})})}));var Vt={awaits:0,echoes:0,id:0},Zl=0,Hr=[],Kr=0,Wr=0,Ql=0;function He(r,i,l,d){var E=ht,m=Object.create(E);return m.parent=E,m.ref=0,m.global=!1,m.id=++Ql,ze.env,m.env=ji?{Promise:ot,PromiseProp:{value:ot,configurable:!0,writable:!0},all:ot.all,race:ot.race,allSettled:ot.allSettled,any:ot.any,resolve:ot.resolve,reject:ot.reject}:{},i&&h(m,i),++E.ref,m.finalize=function(){--this.parent.ref||this.parent.finalize()},d=an(m,r,l,d),m.ref===0&&m.finalize(),d}function Rn(){return Vt.id||(Vt.id=++Zl),++Vt.awaits,Vt.echoes+=Mo,Vt.id}function Ke(){return!!Vt.awaits&&(--Vt.awaits==0&&(Vt.id=0),Vt.echoes=Vt.awaits*Mo,!0)}function Xr(r){return Vt.echoes&&r&&r.constructor===or?(Rn(),r.then(function(i){return Ke(),i},function(i){return Ke(),Bt(i)})):r}function $l(){var r=Hr[Hr.length-1];Hr.pop(),We(r,!1)}function We(r,i){var l,d=ht;(i?!Vt.echoes||Kr++&&r===ht:!Kr||--Kr&&r===ht)||queueMicrotask(i?(function(E){++Wr,Vt.echoes&&--Vt.echoes!=0||(Vt.echoes=Vt.awaits=Vt.id=0),Hr.push(ht),We(E,!0)}).bind(null,r):$l),r!==ht&&(ht=r,d===ze&&(ze.env=Uo()),ji&&(l=ze.env.Promise,i=r.env,(d.global||r.global)&&(Object.defineProperty(o,"Promise",i.PromiseProp),l.all=i.all,l.race=i.race,l.resolve=i.resolve,l.reject=i.reject,i.allSettled&&(l.allSettled=i.allSettled),i.any&&(l.any=i.any))))}function Uo(){var r=o.Promise;return ji?{Promise:r,PromiseProp:Object.getOwnPropertyDescriptor(o,"Promise"),all:r.all,race:r.race,allSettled:r.allSettled,any:r.any,resolve:r.resolve,reject:r.reject}:{}}function an(r,i,l,d,E){var m=ht;try{return We(r,!0),i(l,d,E)}finally{We(m,!1)}}function Bo(r,i,l,d){return typeof r!="function"?r:function(){var E=ht;l&&Rn(),We(i,!0);try{return r.apply(this,arguments)}finally{We(E,!1),d&&queueMicrotask(Ke)}}}function es(r){Promise===or&&Vt.echoes===0?Kr===0?r():enqueueNativeMicroTask(r):setTimeout(r,0)}(""+ce).indexOf("[native code]")===-1&&(Rn=Ke=Ot);var Bt=ot.reject,ln="￿",Ue="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Yo="String expected.",An=[],jr="__dbnames",ns="readonly",rs="readwrite";function cn(r,i){return r?i?function(){return r.apply(this,arguments)&&i.apply(this,arguments)}:r:i}var ko={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function qr(r){return typeof r!="string"||/\./.test(r)?function(i){return i}:function(i){return i[r]===void 0&&r in i&&delete(i=nt(i))[r],i}}function Go(){throw ct.Type()}function _t(r,i){try{var l=Vo(r),d=Vo(i);if(l!==d)return l==="Array"?1:d==="Array"?-1:l==="binary"?1:d==="binary"?-1:l==="string"?1:d==="string"?-1:l==="Date"?1:d!=="Date"?NaN:-1;switch(l){case"number":case"Date":case"string":return i<r?1:r<i?-1:0;case"binary":return function(E,m){for(var g=E.length,O=m.length,N=g<O?g:O,P=0;P<N;++P)if(E[P]!==m[P])return E[P]<m[P]?-1:1;return g===O?0:g<O?-1:1}(zo(r),zo(i));case"Array":return function(E,m){for(var g=E.length,O=m.length,N=g<O?g:O,P=0;P<N;++P){var D=_t(E[P],m[P]);if(D!==0)return D}return g===O?0:g<O?-1:1}(r,i)}}catch{}return NaN}function Vo(r){var i=typeof r;return i!="object"?i:ArrayBuffer.isView(r)?"binary":(r=It(r),r==="ArrayBuffer"?"binary":r)}function zo(r){return r instanceof Uint8Array?r:ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r)}var Ho=(Pt.prototype._trans=function(r,i,l){var d=this._tx||ht.trans,E=this.name,m=we&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(r==="readonly"?"read":"write"," ").concat(this.name));function g(P,D,S){if(!S.schema[E])throw new ct.NotFound("Table "+E+" not part of transaction");return i(S.idbtrans,S)}var O=gn();try{var N=d&&d.db._novip===this.db._novip?d===ht.trans?d._promise(r,g,l):He(function(){return d._promise(r,g,l)},{trans:d,transless:ht.transless||ht}):function P(D,S,U,b){if(D.idbdb&&(D._state.openComplete||ht.letThrough||D._vip)){var x=D._createTransaction(S,U,D._dbSchema);try{x.create(),D._state.PR1398_maxLoop=3}catch(B){return B.name===De.InvalidState&&D.isOpen()&&0<--D._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),D.close({disableAutoOpen:!1}),D.open().then(function(){return P(D,S,U,b)})):Bt(B)}return x._promise(S,function(B,M){return He(function(){return ht.trans=x,b(B,M,x)})}).then(function(B){if(S==="readwrite")try{x.idbtrans.commit()}catch{}return S==="readonly"?B:x._completion.then(function(){return B})})}if(D._state.openComplete)return Bt(new ct.DatabaseClosed(D._state.dbOpenError));if(!D._state.isBeingOpened){if(!D._state.autoOpen)return Bt(new ct.DatabaseClosed);D.open().catch(Ot)}return D._state.dbReadyPromise.then(function(){return P(D,S,U,b)})}(this.db,r,[this.name],g);return m&&(N._consoleTask=m,N=N.catch(function(P){return console.trace(P),Bt(P)})),N}finally{O&&yn()}},Pt.prototype.get=function(r,i){var l=this;return r&&r.constructor===Object?this.where(r).first(i):r==null?Bt(new ct.Type("Invalid argument to Table.get()")):this._trans("readonly",function(d){return l.core.get({trans:d,key:r}).then(function(E){return l.hook.reading.fire(E)})}).then(i)},Pt.prototype.where=function(r){if(typeof r=="string")return new this.db.WhereClause(this,r);if(c(r))return new this.db.WhereClause(this,"[".concat(r.join("+"),"]"));var i=a(r);if(i.length===1)return this.where(i[0]).equals(r[i[0]]);var l=this.schema.indexes.concat(this.schema.primKey).filter(function(N){if(N.compound&&i.every(function(D){return 0<=N.keyPath.indexOf(D)})){for(var P=0;P<i.length;++P)if(i.indexOf(N.keyPath[P])===-1)return!1;return!0}return!1}).sort(function(N,P){return N.keyPath.length-P.keyPath.length})[0];if(l&&this.db._maxKey!==ln){var g=l.keyPath.slice(0,i.length);return this.where(g).equals(g.map(function(P){return r[P]}))}!l&&we&&console.warn("The query ".concat(JSON.stringify(r)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(i.join("+"),"]"));var d=this.schema.idxByName,E=this.db._deps.indexedDB;function m(N,P){return E.cmp(N,P)===0}var O=i.reduce(function(U,P){var D=U[0],S=U[1],U=d[P],b=r[P];return[D||U,D||!U?cn(S,U&&U.multi?function(x){return x=k(x,P),c(x)&&x.some(function(B){return m(b,B)})}:function(x){return m(b,k(x,P))}):S]},[null,null]),g=O[0],O=O[1];return g?this.where(g.name).equals(r[g.keyPath]).filter(O):l?this.filter(O):this.where(i).equals("")},Pt.prototype.filter=function(r){return this.toCollection().and(r)},Pt.prototype.count=function(r){return this.toCollection().count(r)},Pt.prototype.offset=function(r){return this.toCollection().offset(r)},Pt.prototype.limit=function(r){return this.toCollection().limit(r)},Pt.prototype.each=function(r){return this.toCollection().each(r)},Pt.prototype.toArray=function(r){return this.toCollection().toArray(r)},Pt.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Pt.prototype.orderBy=function(r){return new this.db.Collection(new this.db.WhereClause(this,c(r)?"[".concat(r.join("+"),"]"):r))},Pt.prototype.reverse=function(){return this.toCollection().reverse()},Pt.prototype.mapToClass=function(r){var i,l=this.db,d=this.name;function E(){return i!==null&&i.apply(this,arguments)||this}(this.schema.mappedClass=r).prototype instanceof Go&&(function(N,P){if(typeof P!="function"&&P!==null)throw new TypeError("Class extends value "+String(P)+" is not a constructor or null");function D(){this.constructor=N}e(N,P),N.prototype=P===null?Object.create(P):(D.prototype=P.prototype,new D)}(E,i=r),Object.defineProperty(E.prototype,"db",{get:function(){return l},enumerable:!1,configurable:!0}),E.prototype.table=function(){return d},r=E);for(var m=new Set,g=r.prototype;g;g=p(g))Object.getOwnPropertyNames(g).forEach(function(N){return m.add(N)});function O(N){if(!N)return N;var P,D=Object.create(r.prototype);for(P in N)if(!m.has(P))try{D[P]=N[P]}catch{}return D}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=O,this.hook("reading",O),r},Pt.prototype.defineClass=function(){return this.mapToClass(function(r){h(this,r)})},Pt.prototype.add=function(r,i){var l=this,d=this.schema.primKey,E=d.auto,m=d.keyPath,g=r;return m&&E&&(g=qr(m)(r)),this._trans("readwrite",function(O){return l.core.mutate({trans:O,type:"add",keys:i!=null?[i]:null,values:[g]})}).then(function(O){return O.numFailures?ot.reject(O.failures[0]):O.lastResult}).then(function(O){if(m)try{V(r,m,O)}catch{}return O})},Pt.prototype.update=function(r,i){return typeof r!="object"||c(r)?this.where(":id").equals(r).modify(i):(r=k(r,this.schema.primKey.keyPath),r===void 0?Bt(new ct.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(r).modify(i))},Pt.prototype.put=function(r,i){var l=this,d=this.schema.primKey,E=d.auto,m=d.keyPath,g=r;return m&&E&&(g=qr(m)(r)),this._trans("readwrite",function(O){return l.core.mutate({trans:O,type:"put",values:[g],keys:i!=null?[i]:null})}).then(function(O){return O.numFailures?ot.reject(O.failures[0]):O.lastResult}).then(function(O){if(m)try{V(r,m,O)}catch{}return O})},Pt.prototype.delete=function(r){var i=this;return this._trans("readwrite",function(l){return i.core.mutate({trans:l,type:"delete",keys:[r]})}).then(function(l){return l.numFailures?ot.reject(l.failures[0]):void 0})},Pt.prototype.clear=function(){var r=this;return this._trans("readwrite",function(i){return r.core.mutate({trans:i,type:"deleteRange",range:ko})}).then(function(i){return i.numFailures?ot.reject(i.failures[0]):void 0})},Pt.prototype.bulkGet=function(r){var i=this;return this._trans("readonly",function(l){return i.core.getMany({keys:r,trans:l}).then(function(d){return d.map(function(E){return i.hook.reading.fire(E)})})})},Pt.prototype.bulkAdd=function(r,i,l){var d=this,E=Array.isArray(i)?i:void 0,m=(l=l||(E?void 0:i))?l.allKeys:void 0;return this._trans("readwrite",function(g){var P=d.schema.primKey,O=P.auto,P=P.keyPath;if(P&&E)throw new ct.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(E&&E.length!==r.length)throw new ct.InvalidArgument("Arguments objects and keys must have the same length");var N=r.length,P=P&&O?r.map(qr(P)):r;return d.core.mutate({trans:g,type:"add",keys:E,values:P,wantResults:m}).then(function(x){var S=x.numFailures,U=x.results,b=x.lastResult,x=x.failures;if(S===0)return m?U:b;throw new xe("".concat(d.name,".bulkAdd(): ").concat(S," of ").concat(N," operations failed"),x)})})},Pt.prototype.bulkPut=function(r,i,l){var d=this,E=Array.isArray(i)?i:void 0,m=(l=l||(E?void 0:i))?l.allKeys:void 0;return this._trans("readwrite",function(g){var P=d.schema.primKey,O=P.auto,P=P.keyPath;if(P&&E)throw new ct.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(E&&E.length!==r.length)throw new ct.InvalidArgument("Arguments objects and keys must have the same length");var N=r.length,P=P&&O?r.map(qr(P)):r;return d.core.mutate({trans:g,type:"put",keys:E,values:P,wantResults:m}).then(function(x){var S=x.numFailures,U=x.results,b=x.lastResult,x=x.failures;if(S===0)return m?U:b;throw new xe("".concat(d.name,".bulkPut(): ").concat(S," of ").concat(N," operations failed"),x)})})},Pt.prototype.bulkUpdate=function(r){var i=this,l=this.core,d=r.map(function(g){return g.key}),E=r.map(function(g){return g.changes}),m=[];return this._trans("readwrite",function(g){return l.getMany({trans:g,keys:d,cache:"clone"}).then(function(O){var N=[],P=[];r.forEach(function(S,U){var b=S.key,x=S.changes,B=O[U];if(B){for(var M=0,G=Object.keys(x);M<G.length;M++){var z=G[M],K=x[z];if(z===i.schema.primKey.keyPath){if(_t(K,b)!==0)throw new ct.Constraint("Cannot update primary key in bulkUpdate()")}else V(B,z,K)}m.push(U),N.push(b),P.push(B)}});var D=N.length;return l.mutate({trans:g,type:"put",keys:N,values:P,updates:{keys:d,changeSpecs:E}}).then(function(S){var U=S.numFailures,b=S.failures;if(U===0)return D;for(var x=0,B=Object.keys(b);x<B.length;x++){var M,G=B[x],z=m[Number(G)];z!=null&&(M=b[G],delete b[G],b[z]=M)}throw new xe("".concat(i.name,".bulkUpdate(): ").concat(U," of ").concat(D," operations failed"),b)})})})},Pt.prototype.bulkDelete=function(r){var i=this,l=r.length;return this._trans("readwrite",function(d){return i.core.mutate({trans:d,type:"delete",keys:r})}).then(function(g){var E=g.numFailures,m=g.lastResult,g=g.failures;if(E===0)return m;throw new xe("".concat(i.name,".bulkDelete(): ").concat(E," of ").concat(l," operations failed"),g)})},Pt);function Pt(){}function cr(r){function i(g,O){if(O){for(var N=arguments.length,P=new Array(N-1);--N;)P[N-1]=arguments[N];return l[g].subscribe.apply(null,P),r}if(typeof g=="string")return l[g]}var l={};i.addEventType=m;for(var d=1,E=arguments.length;d<E;++d)m(arguments[d]);return i;function m(g,O,N){if(typeof g!="object"){var P;O=O||Xl;var D={subscribers:[],fire:N=N||Ot,subscribe:function(S){D.subscribers.indexOf(S)===-1&&(D.subscribers.push(S),D.fire=O(D.fire,S))},unsubscribe:function(S){D.subscribers=D.subscribers.filter(function(U){return U!==S}),D.fire=D.subscribers.reduce(O,N)}};return l[g]=i[g]=D}a(P=g).forEach(function(S){var U=P[S];if(c(U))m(S,P[S][0],P[S][1]);else{if(U!=="asap")throw new ct.InvalidArgument("Invalid event config");var b=m(S,Oe,function(){for(var x=arguments.length,B=new Array(x);x--;)B[x]=arguments[x];b.subscribers.forEach(function(M){L(function(){M.apply(null,B)})})})}})}}function hr(r,i){return F(i).from({prototype:r}),i}function Fn(r,i){return!(r.filter||r.algorithm||r.or)&&(i?r.justLimit:!r.replayFilter)}function is(r,i){r.filter=cn(r.filter,i)}function ss(r,i,l){var d=r.replayFilter;r.replayFilter=d?function(){return cn(d(),i())}:i,r.justLimit=l&&!d}function Zr(r,i){if(r.isPrimKey)return i.primaryKey;var l=i.getIndexByKeyPath(r.index);if(!l)throw new ct.Schema("KeyPath "+r.index+" on object store "+i.name+" is not indexed");return l}function Ko(r,i,l){var d=Zr(r,i.schema);return i.openCursor({trans:l,values:!r.keysOnly,reverse:r.dir==="prev",unique:!!r.unique,query:{index:d,range:r.range}})}function Qr(r,i,l,d){var E=r.replayFilter?cn(r.filter,r.replayFilter()):r.filter;if(r.or){var m={},g=function(O,N,P){var D,S;E&&!E(N,P,function(U){return N.stop(U)},function(U){return N.fail(U)})||((S=""+(D=N.primaryKey))=="[object ArrayBuffer]"&&(S=""+new Uint8Array(D)),I(m,S)||(m[S]=!0,i(O,N,P)))};return Promise.all([r.or._iterate(g,l),Wo(Ko(r,d,l),r.algorithm,g,!r.keysOnly&&r.valueMapper)])}return Wo(Ko(r,d,l),cn(r.algorithm,E),i,!r.keysOnly&&r.valueMapper)}function Wo(r,i,l,d){var E=Nt(d?function(m,g,O){return l(d(m),g,O)}:l);return r.then(function(m){if(m)return m.start(function(){var g=function(){return m.continue()};i&&!i(m,function(O){return g=O},function(O){m.stop(O),g=Ot},function(O){m.fail(O),g=Ot})||E(m.value,m,function(O){return g=O}),g()})})}var Be=Symbol(),os=(Xo.prototype.execute=function(r){var i=(i=this.replacePrefix)===null||i===void 0?void 0:i[0];return i&&typeof r=="string"&&r.startsWith(i)?this.replacePrefix[1]+r.substring(i.length):r},Xo);function Xo(r){Object.assign(this,r)}var Jl=(At.prototype._read=function(r,i){var l=this._ctx;return l.error?l.table._trans(null,Bt.bind(null,l.error)):l.table._trans("readonly",r).then(i)},At.prototype._write=function(r){var i=this._ctx;return i.error?i.table._trans(null,Bt.bind(null,i.error)):i.table._trans("readwrite",r,"locked")},At.prototype._addAlgorithm=function(r){var i=this._ctx;i.algorithm=cn(i.algorithm,r)},At.prototype._iterate=function(r,i){return Qr(this._ctx,r,i,this._ctx.table.core)},At.prototype.clone=function(r){var i=Object.create(this.constructor.prototype),l=Object.create(this._ctx);return r&&h(l,r),i._ctx=l,i},At.prototype.raw=function(){return this._ctx.valueMapper=null,this},At.prototype.each=function(r){var i=this._ctx;return this._read(function(l){return Qr(i,r,l,i.table.core)})},At.prototype.count=function(r){var i=this;return this._read(function(l){var d=i._ctx,E=d.table.core;if(Fn(d,!0))return E.count({trans:l,query:{index:Zr(d,E.schema),range:d.range}}).then(function(g){return Math.min(g,d.limit)});var m=0;return Qr(d,function(){return++m,!1},l,E).then(function(){return m})}).then(r)},At.prototype.sortBy=function(r,i){var l=r.split(".").reverse(),d=l[0],E=l.length-1;function m(N,P){return P?m(N[l[P]],P-1):N[d]}var g=this._ctx.dir==="next"?1:-1;function O(N,P){return N=m(N,E),P=m(P,E),N<P?-g:P<N?g:0}return this.toArray(function(N){return N.sort(O)}).then(i)},At.prototype.toArray=function(r){var i=this;return this._read(function(l){var d=i._ctx;if(d.dir==="next"&&Fn(d,!0)&&0<d.limit){var E=d.valueMapper,m=Zr(d,d.table.core.schema);return d.table.core.query({trans:l,limit:d.limit,values:!0,query:{index:m,range:d.range}}).then(function(O){return O=O.result,E?O.map(E):O})}var g=[];return Qr(d,function(O){return g.push(O)},l,d.table.core).then(function(){return g})},r)},At.prototype.offset=function(r){var i=this._ctx;return r<=0||(i.offset+=r,Fn(i)?ss(i,function(){var l=r;return function(d,E){return l===0||(l===1?--l:E(function(){d.advance(l),l=0}),!1)}}):ss(i,function(){var l=r;return function(){return--l<0}})),this},At.prototype.limit=function(r){return this._ctx.limit=Math.min(this._ctx.limit,r),ss(this._ctx,function(){var i=r;return function(l,d,E){return--i<=0&&d(E),0<=i}},!0),this},At.prototype.until=function(r,i){return is(this._ctx,function(l,d,E){return!r(l.value)||(d(E),i)}),this},At.prototype.first=function(r){return this.limit(1).toArray(function(i){return i[0]}).then(r)},At.prototype.last=function(r){return this.reverse().first(r)},At.prototype.filter=function(r){var i;return is(this._ctx,function(l){return r(l.value)}),(i=this._ctx).isMatch=cn(i.isMatch,r),this},At.prototype.and=function(r){return this.filter(r)},At.prototype.or=function(r){return new this.db.WhereClause(this._ctx.table,r,this)},At.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},At.prototype.desc=function(){return this.reverse()},At.prototype.eachKey=function(r){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(l,d){r(d.key,d)})},At.prototype.eachUniqueKey=function(r){return this._ctx.unique="unique",this.eachKey(r)},At.prototype.eachPrimaryKey=function(r){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(l,d){r(d.primaryKey,d)})},At.prototype.keys=function(r){var i=this._ctx;i.keysOnly=!i.isMatch;var l=[];return this.each(function(d,E){l.push(E.key)}).then(function(){return l}).then(r)},At.prototype.primaryKeys=function(r){var i=this._ctx;if(i.dir==="next"&&Fn(i,!0)&&0<i.limit)return this._read(function(d){var E=Zr(i,i.table.core.schema);return i.table.core.query({trans:d,values:!1,limit:i.limit,query:{index:E,range:i.range}})}).then(function(d){return d.result}).then(r);i.keysOnly=!i.isMatch;var l=[];return this.each(function(d,E){l.push(E.primaryKey)}).then(function(){return l}).then(r)},At.prototype.uniqueKeys=function(r){return this._ctx.unique="unique",this.keys(r)},At.prototype.firstKey=function(r){return this.limit(1).keys(function(i){return i[0]}).then(r)},At.prototype.lastKey=function(r){return this.reverse().firstKey(r)},At.prototype.distinct=function(){var r=this._ctx,r=r.index&&r.table.schema.idxByName[r.index];if(!r||!r.multi)return this;var i={};return is(this._ctx,function(E){var d=E.primaryKey.toString(),E=I(i,d);return i[d]=!0,!E}),this},At.prototype.modify=function(r){var i=this,l=this._ctx;return this._write(function(d){var E,m,g;g=typeof r=="function"?r:(E=a(r),m=E.length,function(M){for(var G=!1,z=0;z<m;++z){var K=E[z],W=r[K],Z=k(M,K);W instanceof os?(V(M,K,W.execute(Z)),G=!0):Z!==W&&(V(M,K,W),G=!0)}return G});function O(M,K){var z=K.failures,K=K.numFailures;x+=M-K;for(var W=0,Z=a(z);W<Z.length;W++){var rt=Z[W];b.push(z[rt])}}var N=l.table.core,P=N.schema.primaryKey,D=P.outbound,S=P.extractKey,U=i.db._options.modifyChunkSize||200,b=[],x=0,B=[];return i.clone().primaryKeys().then(function(M){function G(z){var K=Math.min(U,M.length-z);return N.getMany({trans:d,keys:M.slice(z,z+K),cache:"immutable"}).then(function(W){for(var Z=[],rt=[],tt=D?[]:null,et=[],it=0;it<K;++it){var st=W[it],pt={value:nt(st),primKey:M[z+it]};g.call(pt,pt.value,pt)!==!1&&(pt.value==null?et.push(M[z+it]):D||_t(S(st),S(pt.value))===0?(rt.push(pt.value),D&&tt.push(M[z+it])):(et.push(M[z+it]),Z.push(pt.value)))}var mt=Fn(l)&&l.limit===1/0&&(typeof r!="function"||r===as)&&{index:l.index,range:l.range};return Promise.resolve(0<Z.length&&N.mutate({trans:d,type:"add",values:Z}).then(function(gt){for(var Ct in gt.failures)et.splice(parseInt(Ct),1);O(Z.length,gt)})).then(function(){return(0<rt.length||mt&&typeof r=="object")&&N.mutate({trans:d,type:"put",keys:tt,values:rt,criteria:mt,changeSpec:typeof r!="function"&&r}).then(function(gt){return O(rt.length,gt)})}).then(function(){return(0<et.length||mt&&r===as)&&N.mutate({trans:d,type:"delete",keys:et,criteria:mt}).then(function(gt){return O(et.length,gt)})}).then(function(){return M.length>z+K&&G(z+U)})})}return G(0).then(function(){if(0<b.length)throw new rn("Error modifying one or more objects",b,x,B);return M.length})})})},At.prototype.delete=function(){var r=this._ctx,i=r.range;return Fn(r)&&(r.isPrimKey||i.type===3)?this._write(function(l){var d=r.table.core.schema.primaryKey,E=i;return r.table.core.count({trans:l,query:{index:d,range:E}}).then(function(m){return r.table.core.mutate({trans:l,type:"deleteRange",range:E}).then(function(g){var O=g.failures;if(g.lastResult,g.results,g=g.numFailures,g)throw new rn("Could not delete some values",Object.keys(O).map(function(N){return O[N]}),m-g);return m-g})})}):this.modify(as)},At);function At(){}var as=function(r,i){return i.value=null};function tc(r,i){return r<i?-1:r===i?0:1}function ec(r,i){return i<r?-1:r===i?0:1}function se(r,i,l){return r=r instanceof qo?new r.Collection(r):r,r._ctx.error=new(l||TypeError)(i),r}function _n(r){return new r.Collection(r,function(){return jo("")}).limit(0)}function $r(r,i,l,d){var E,m,g,O,N,P,D,S=l.length;if(!l.every(function(x){return typeof x=="string"}))return se(r,Yo);function U(x){E=x==="next"?function(M){return M.toUpperCase()}:function(M){return M.toLowerCase()},m=x==="next"?function(M){return M.toLowerCase()}:function(M){return M.toUpperCase()},g=x==="next"?tc:ec;var B=l.map(function(M){return{lower:m(M),upper:E(M)}}).sort(function(M,G){return g(M.lower,G.lower)});O=B.map(function(M){return M.upper}),N=B.map(function(M){return M.lower}),D=(P=x)==="next"?"":d}U("next"),r=new r.Collection(r,function(){return Xe(O[0],N[S-1]+d)}),r._ondirectionchange=function(x){U(x)};var b=0;return r._addAlgorithm(function(x,B,M){var G=x.key;if(typeof G!="string")return!1;var z=m(G);if(i(z,N,b))return!0;for(var K=null,W=b;W<S;++W){var Z=function(rt,tt,et,it,st,pt){for(var mt=Math.min(rt.length,it.length),gt=-1,Ct=0;Ct<mt;++Ct){var Ce=tt[Ct];if(Ce!==it[Ct])return st(rt[Ct],et[Ct])<0?rt.substr(0,Ct)+et[Ct]+et.substr(Ct+1):st(rt[Ct],it[Ct])<0?rt.substr(0,Ct)+it[Ct]+et.substr(Ct+1):0<=gt?rt.substr(0,gt)+tt[gt]+et.substr(gt+1):null;st(rt[Ct],Ce)<0&&(gt=Ct)}return mt<it.length&&pt==="next"?rt+et.substr(rt.length):mt<rt.length&&pt==="prev"?rt.substr(0,et.length):gt<0?null:rt.substr(0,gt)+it[gt]+et.substr(gt+1)}(G,z,O[W],N[W],g,P);Z===null&&K===null?b=W+1:(K===null||0<g(K,Z))&&(K=Z)}return B(K!==null?function(){x.continue(K+D)}:M),!1}),r}function Xe(r,i,l,d){return{type:2,lower:r,upper:i,lowerOpen:l,upperOpen:d}}function jo(r){return{type:1,lower:r,upper:r}}var qo=(Object.defineProperty(zt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),zt.prototype.between=function(r,i,l,d){l=l!==!1,d=d===!0;try{return 0<this._cmp(r,i)||this._cmp(r,i)===0&&(l||d)&&(!l||!d)?_n(this):new this.Collection(this,function(){return Xe(r,i,!l,!d)})}catch{return se(this,Ue)}},zt.prototype.equals=function(r){return r==null?se(this,Ue):new this.Collection(this,function(){return jo(r)})},zt.prototype.above=function(r){return r==null?se(this,Ue):new this.Collection(this,function(){return Xe(r,void 0,!0)})},zt.prototype.aboveOrEqual=function(r){return r==null?se(this,Ue):new this.Collection(this,function(){return Xe(r,void 0,!1)})},zt.prototype.below=function(r){return r==null?se(this,Ue):new this.Collection(this,function(){return Xe(void 0,r,!1,!0)})},zt.prototype.belowOrEqual=function(r){return r==null?se(this,Ue):new this.Collection(this,function(){return Xe(void 0,r)})},zt.prototype.startsWith=function(r){return typeof r!="string"?se(this,Yo):this.between(r,r+ln,!0,!0)},zt.prototype.startsWithIgnoreCase=function(r){return r===""?this.startsWith(r):$r(this,function(i,l){return i.indexOf(l[0])===0},[r],ln)},zt.prototype.equalsIgnoreCase=function(r){return $r(this,function(i,l){return i===l[0]},[r],"")},zt.prototype.anyOfIgnoreCase=function(){var r=Kt.apply(Jt,arguments);return r.length===0?_n(this):$r(this,function(i,l){return l.indexOf(i)!==-1},r,"")},zt.prototype.startsWithAnyOfIgnoreCase=function(){var r=Kt.apply(Jt,arguments);return r.length===0?_n(this):$r(this,function(i,l){return l.some(function(d){return i.indexOf(d)===0})},r,ln)},zt.prototype.anyOf=function(){var r=this,i=Kt.apply(Jt,arguments),l=this._cmp;try{i.sort(l)}catch{return se(this,Ue)}if(i.length===0)return _n(this);var d=new this.Collection(this,function(){return Xe(i[0],i[i.length-1])});d._ondirectionchange=function(m){l=m==="next"?r._ascending:r._descending,i.sort(l)};var E=0;return d._addAlgorithm(function(m,g,O){for(var N=m.key;0<l(N,i[E]);)if(++E===i.length)return g(O),!1;return l(N,i[E])===0||(g(function(){m.continue(i[E])}),!1)}),d},zt.prototype.notEqual=function(r){return this.inAnyRange([[-1/0,r],[r,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},zt.prototype.noneOf=function(){var r=Kt.apply(Jt,arguments);if(r.length===0)return new this.Collection(this);try{r.sort(this._ascending)}catch{return se(this,Ue)}var i=r.reduce(function(l,d){return l?l.concat([[l[l.length-1][1],d]]):[[-1/0,d]]},null);return i.push([r[r.length-1],this.db._maxKey]),this.inAnyRange(i,{includeLowers:!1,includeUppers:!1})},zt.prototype.inAnyRange=function(G,i){var l=this,d=this._cmp,E=this._ascending,m=this._descending,g=this._min,O=this._max;if(G.length===0)return _n(this);if(!G.every(function(z){return z[0]!==void 0&&z[1]!==void 0&&E(z[0],z[1])<=0}))return se(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ct.InvalidArgument);var N=!i||i.includeLowers!==!1,P=i&&i.includeUppers===!0,D,S=E;function U(z,K){return S(z[0],K[0])}try{(D=G.reduce(function(z,K){for(var W=0,Z=z.length;W<Z;++W){var rt=z[W];if(d(K[0],rt[1])<0&&0<d(K[1],rt[0])){rt[0]=g(rt[0],K[0]),rt[1]=O(rt[1],K[1]);break}}return W===Z&&z.push(K),z},[])).sort(U)}catch{return se(this,Ue)}var b=0,x=P?function(z){return 0<E(z,D[b][1])}:function(z){return 0<=E(z,D[b][1])},B=N?function(z){return 0<m(z,D[b][0])}:function(z){return 0<=m(z,D[b][0])},M=x,G=new this.Collection(this,function(){return Xe(D[0][0],D[D.length-1][1],!N,!P)});return G._ondirectionchange=function(z){S=z==="next"?(M=x,E):(M=B,m),D.sort(U)},G._addAlgorithm(function(z,K,W){for(var Z,rt=z.key;M(rt);)if(++b===D.length)return K(W),!1;return!x(Z=rt)&&!B(Z)||(l._cmp(rt,D[b][1])===0||l._cmp(rt,D[b][0])===0||K(function(){S===E?z.continue(D[b][0]):z.continue(D[b][1])}),!1)}),G},zt.prototype.startsWithAnyOf=function(){var r=Kt.apply(Jt,arguments);return r.every(function(i){return typeof i=="string"})?r.length===0?_n(this):this.inAnyRange(r.map(function(i){return[i,i+ln]})):se(this,"startsWithAnyOf() only works with strings")},zt);function zt(){}function ve(r){return Nt(function(i){return ur(i),r(i.target.error),!1})}function ur(r){r.stopPropagation&&r.stopPropagation(),r.preventDefault&&r.preventDefault()}var dr="storagemutated",ls="x-storagemutated-1",je=cr(null,dr),nc=(Se.prototype._lock=function(){return y(!ht.global),++this._reculock,this._reculock!==1||ht.global||(ht.lockOwnerFor=this),this},Se.prototype._unlock=function(){if(y(!ht.global),--this._reculock==0)for(ht.global||(ht.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var r=this._blockedFuncs.shift();try{an(r[1],r[0])}catch{}}return this},Se.prototype._locked=function(){return this._reculock&&ht.lockOwnerFor!==this},Se.prototype.create=function(r){var i=this;if(!this.mode)return this;var l=this.db.idbdb,d=this.db._state.dbOpenError;if(y(!this.idbtrans),!r&&!l)switch(d&&d.name){case"DatabaseClosedError":throw new ct.DatabaseClosed(d);case"MissingAPIError":throw new ct.MissingAPI(d.message,d);default:throw new ct.OpenFailed(d)}if(!this.active)throw new ct.TransactionInactive;return y(this._completion._state===null),(r=this.idbtrans=r||(this.db.core||l).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Nt(function(E){ur(E),i._reject(r.error)}),r.onabort=Nt(function(E){ur(E),i.active&&i._reject(new ct.Abort(r.error)),i.active=!1,i.on("abort").fire(E)}),r.oncomplete=Nt(function(){i.active=!1,i._resolve(),"mutatedParts"in r&&je.storagemutated.fire(r.mutatedParts)}),this},Se.prototype._promise=function(r,i,l){var d=this;if(r==="readwrite"&&this.mode!=="readwrite")return Bt(new ct.ReadOnly("Transaction is readonly"));if(!this.active)return Bt(new ct.TransactionInactive);if(this._locked())return new ot(function(m,g){d._blockedFuncs.push([function(){d._promise(r,i,l).then(m,g)},ht])});if(l)return He(function(){var m=new ot(function(g,O){d._lock();var N=i(g,O,d);N&&N.then&&N.then(g,O)});return m.finally(function(){return d._unlock()}),m._lib=!0,m});var E=new ot(function(m,g){var O=i(m,g,d);O&&O.then&&O.then(m,g)});return E._lib=!0,E},Se.prototype._root=function(){return this.parent?this.parent._root():this},Se.prototype.waitFor=function(r){var i,l=this._root(),d=ot.resolve(r);l._waitingFor?l._waitingFor=l._waitingFor.then(function(){return d}):(l._waitingFor=d,l._waitingQueue=[],i=l.idbtrans.objectStore(l.storeNames[0]),function m(){for(++l._spinCount;l._waitingQueue.length;)l._waitingQueue.shift()();l._waitingFor&&(i.get(-1/0).onsuccess=m)}());var E=l._waitingFor;return new ot(function(m,g){d.then(function(O){return l._waitingQueue.push(Nt(m.bind(null,O)))},function(O){return l._waitingQueue.push(Nt(g.bind(null,O)))}).finally(function(){l._waitingFor===E&&(l._waitingFor=null)})})},Se.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new ct.Abort))},Se.prototype.table=function(r){var i=this._memoizedTables||(this._memoizedTables={});if(I(i,r))return i[r];var l=this.schema[r];if(!l)throw new ct.NotFound("Table "+r+" not part of transaction");return l=new this.db.Table(r,l,this),l.core=this.db.core.table(r),i[r]=l},Se);function Se(){}function cs(r,i,l,d,E,m,g){return{name:r,keyPath:i,unique:l,multi:d,auto:E,compound:m,src:(l&&!g?"&":"")+(d?"*":"")+(E?"++":"")+Zo(i)}}function Zo(r){return typeof r=="string"?r:r?"["+[].join.call(r,"+")+"]":""}function hs(r,i,l){return{name:r,primKey:i,indexes:l,mappedClass:null,idxByName:(d=function(E){return[E.name,E]},l.reduce(function(E,m,g){return g=d(m,g),g&&(E[g[0]]=g[1]),E},{}))};var d}var pr=function(r){try{return r.only([[]]),pr=function(){return[[]]},[[]]}catch{return pr=function(){return ln},ln}};function us(r){return r==null?function(){}:typeof r=="string"?(i=r).split(".").length===1?function(l){return l[i]}:function(l){return k(l,i)}:function(l){return k(l,r)};var i}function Qo(r){return[].slice.call(r)}var rc=0;function Er(r){return r==null?":id":typeof r=="string"?r:"[".concat(r.join("+"),"]")}function ic(r,i,N){function d(M){if(M.type===3)return null;if(M.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var b=M.lower,x=M.upper,B=M.lowerOpen,M=M.upperOpen;return b===void 0?x===void 0?null:i.upperBound(x,!!M):x===void 0?i.lowerBound(b,!!B):i.bound(b,x,!!B,!!M)}function E(U){var b,x=U.name;return{name:x,schema:U,mutate:function(B){var M=B.trans,G=B.type,z=B.keys,K=B.values,W=B.range;return new Promise(function(Z,rt){Z=Nt(Z);var tt=M.objectStore(x),et=tt.keyPath==null,it=G==="put"||G==="add";if(!it&&G!=="delete"&&G!=="deleteRange")throw new Error("Invalid operation type: "+G);var st,pt=(z||K||{length:1}).length;if(z&&K&&z.length!==K.length)throw new Error("Given keys array must have same length as given values array.");if(pt===0)return Z({numFailures:0,failures:{},results:[],lastResult:void 0});function mt(te){++Ce,ur(te)}var gt=[],Ct=[],Ce=0;if(G==="deleteRange"){if(W.type===4)return Z({numFailures:Ce,failures:Ct,results:[],lastResult:void 0});W.type===3?gt.push(st=tt.clear()):gt.push(st=tt.delete(d(W)))}else{var et=it?et?[K,z]:[K,null]:[z,null],Tt=et[0],jt=et[1];if(it)for(var qt=0;qt<pt;++qt)gt.push(st=jt&&jt[qt]!==void 0?tt[G](Tt[qt],jt[qt]):tt[G](Tt[qt])),st.onerror=mt;else for(qt=0;qt<pt;++qt)gt.push(st=tt[G](Tt[qt])),st.onerror=mt}function ui(te){te=te.target.result,gt.forEach(function(dn,Ps){return dn.error!=null&&(Ct[Ps]=dn.error)}),Z({numFailures:Ce,failures:Ct,results:G==="delete"?z:gt.map(function(dn){return dn.result}),lastResult:te})}st.onerror=function(te){mt(te),ui(te)},st.onsuccess=ui})},getMany:function(B){var M=B.trans,G=B.keys;return new Promise(function(z,K){z=Nt(z);for(var W,Z=M.objectStore(x),rt=G.length,tt=new Array(rt),et=0,it=0,st=function(gt){gt=gt.target,tt[gt._pos]=gt.result,++it===et&&z(tt)},pt=ve(K),mt=0;mt<rt;++mt)G[mt]!=null&&((W=Z.get(G[mt]))._pos=mt,W.onsuccess=st,W.onerror=pt,++et);et===0&&z(tt)})},get:function(B){var M=B.trans,G=B.key;return new Promise(function(z,K){z=Nt(z);var W=M.objectStore(x).get(G);W.onsuccess=function(Z){return z(Z.target.result)},W.onerror=ve(K)})},query:(b=P,function(B){return new Promise(function(M,G){M=Nt(M);var z,K,W,et=B.trans,Z=B.values,rt=B.limit,st=B.query,tt=rt===1/0?void 0:rt,it=st.index,st=st.range,et=et.objectStore(x),it=it.isPrimaryKey?et:et.index(it.name),st=d(st);if(rt===0)return M({result:[]});b?((tt=Z?it.getAll(st,tt):it.getAllKeys(st,tt)).onsuccess=function(pt){return M({result:pt.target.result})},tt.onerror=ve(G)):(z=0,K=!Z&&"openKeyCursor"in it?it.openKeyCursor(st):it.openCursor(st),W=[],K.onsuccess=function(pt){var mt=K.result;return mt?(W.push(Z?mt.value:mt.primaryKey),++z===rt?M({result:W}):void mt.continue()):M({result:W})},K.onerror=ve(G))})}),openCursor:function(B){var M=B.trans,G=B.values,z=B.query,K=B.reverse,W=B.unique;return new Promise(function(Z,rt){Z=Nt(Z);var it=z.index,tt=z.range,et=M.objectStore(x),et=it.isPrimaryKey?et:et.index(it.name),it=K?W?"prevunique":"prev":W?"nextunique":"next",st=!G&&"openKeyCursor"in et?et.openKeyCursor(d(tt),it):et.openCursor(d(tt),it);st.onerror=ve(rt),st.onsuccess=Nt(function(pt){var mt,gt,Ct,Ce,Tt=st.result;Tt?(Tt.___id=++rc,Tt.done=!1,mt=Tt.continue.bind(Tt),gt=(gt=Tt.continuePrimaryKey)&&gt.bind(Tt),Ct=Tt.advance.bind(Tt),Ce=function(){throw new Error("Cursor not stopped")},Tt.trans=M,Tt.stop=Tt.continue=Tt.continuePrimaryKey=Tt.advance=function(){throw new Error("Cursor not started")},Tt.fail=Nt(rt),Tt.next=function(){var jt=this,qt=1;return this.start(function(){return qt--?jt.continue():jt.stop()}).then(function(){return jt})},Tt.start=function(jt){function qt(){if(st.result)try{jt()}catch(te){Tt.fail(te)}else Tt.done=!0,Tt.start=function(){throw new Error("Cursor behind last entry")},Tt.stop()}var ui=new Promise(function(te,dn){te=Nt(te),st.onerror=ve(dn),Tt.fail=dn,Tt.stop=function(Ps){Tt.stop=Tt.continue=Tt.continuePrimaryKey=Tt.advance=Ce,te(Ps)}});return st.onsuccess=Nt(function(te){st.onsuccess=qt,qt()}),Tt.continue=mt,Tt.continuePrimaryKey=gt,Tt.advance=Ct,qt(),ui},Z(Tt)):Z(null)},rt)})},count:function(B){var M=B.query,G=B.trans,z=M.index,K=M.range;return new Promise(function(W,Z){var rt=G.objectStore(x),tt=z.isPrimaryKey?rt:rt.index(z.name),rt=d(K),tt=rt?tt.count(rt):tt.count();tt.onsuccess=Nt(function(et){return W(et.target.result)}),tt.onerror=ve(Z)})}}}var m,g,O,D=(g=N,O=Qo((m=r).objectStoreNames),{schema:{name:m.name,tables:O.map(function(U){return g.objectStore(U)}).map(function(U){var b=U.keyPath,M=U.autoIncrement,x=c(b),B={},M={name:U.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:b==null,compound:x,keyPath:b,autoIncrement:M,unique:!0,extractKey:us(b)},indexes:Qo(U.indexNames).map(function(G){return U.index(G)}).map(function(W){var z=W.name,K=W.unique,Z=W.multiEntry,W=W.keyPath,Z={name:z,compound:c(W),keyPath:W,unique:K,multiEntry:Z,extractKey:us(W)};return B[Er(W)]=Z}),getIndexByKeyPath:function(G){return B[Er(G)]}};return B[":id"]=M.primaryKey,b!=null&&(B[Er(b)]=M.primaryKey),M})},hasGetAll:0<O.length&&"getAll"in g.objectStore(O[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),N=D.schema,P=D.hasGetAll,D=N.tables.map(E),S={};return D.forEach(function(U){return S[U.name]=U}),{stack:"dbcore",transaction:r.transaction.bind(r),table:function(U){if(!S[U])throw new Error("Table '".concat(U,"' not found"));return S[U]},MIN_KEY:-1/0,MAX_KEY:pr(i),schema:N}}function sc(r,i,l,d){var E=l.IDBKeyRange;return l.indexedDB,{dbcore:(d=ic(i,E,d),r.dbcore.reduce(function(m,g){return g=g.create,n(n({},m),g(m))},d))}}function Jr(r,d){var l=d.db,d=sc(r._middlewares,l,r._deps,d);r.core=d.dbcore,r.tables.forEach(function(E){var m=E.name;r.core.schema.tables.some(function(g){return g.name===m})&&(E.core=r.core.table(m),r[m]instanceof r.Table&&(r[m].core=E.core))})}function ti(r,i,l,d){l.forEach(function(E){var m=d[E];i.forEach(function(g){var O=function N(P,D){return _(P,D)||(P=p(P))&&N(P,D)}(g,E);(!O||"value"in O&&O.value===void 0)&&(g===r.Transaction.prototype||g instanceof r.Transaction?A(g,E,{get:function(){return this.table(E)},set:function(N){T(this,E,{value:N,writable:!0,configurable:!0,enumerable:!0})}}):g[E]=new r.Table(E,m))})})}function ds(r,i){i.forEach(function(l){for(var d in l)l[d]instanceof r.Table&&delete l[d]})}function oc(r,i){return r._cfg.version-i._cfg.version}function ac(r,i,l,d){var E=r._dbSchema;l.objectStoreNames.contains("$meta")&&!E.$meta&&(E.$meta=hs("$meta",Jo("")[0],[]),r._storeNames.push("$meta"));var m=r._createTransaction("readwrite",r._storeNames,E);m.create(l),m._completion.catch(d);var g=m._reject.bind(m),O=ht.transless||ht;He(function(){return ht.trans=m,ht.transless=O,i!==0?(Jr(r,l),P=i,((N=m).storeNames.includes("$meta")?N.table("$meta").get("version").then(function(D){return D??P}):ot.resolve(P)).then(function(D){return U=D,b=m,x=l,B=[],D=(S=r)._versions,M=S._dbSchema=ni(0,S.idbdb,x),(D=D.filter(function(G){return G._cfg.version>=U})).length!==0?(D.forEach(function(G){B.push(function(){var z=M,K=G._cfg.dbschema;ri(S,z,x),ri(S,K,x),M=S._dbSchema=K;var W=ps(z,K);W.add.forEach(function(it){Es(x,it[0],it[1].primKey,it[1].indexes)}),W.change.forEach(function(it){if(it.recreate)throw new ct.Upgrade("Not yet support for changing primary key");var st=x.objectStore(it.name);it.add.forEach(function(pt){return ei(st,pt)}),it.change.forEach(function(pt){st.deleteIndex(pt.name),ei(st,pt)}),it.del.forEach(function(pt){return st.deleteIndex(pt)})});var Z=G._cfg.contentUpgrade;if(Z&&G._cfg.version>U){Jr(S,x),b._memoizedTables={};var rt=H(K);W.del.forEach(function(it){rt[it]=z[it]}),ds(S,[S.Transaction.prototype]),ti(S,[S.Transaction.prototype],a(rt),rt),b.schema=rt;var tt,et=fe(Z);return et&&Rn(),W=ot.follow(function(){var it;(tt=Z(b))&&et&&(it=Ke.bind(null,null),tt.then(it,it))}),tt&&typeof tt.then=="function"?ot.resolve(tt):W.then(function(){return tt})}}),B.push(function(z){var K,W,Z=G._cfg.dbschema;K=Z,W=z,[].slice.call(W.db.objectStoreNames).forEach(function(rt){return K[rt]==null&&W.db.deleteObjectStore(rt)}),ds(S,[S.Transaction.prototype]),ti(S,[S.Transaction.prototype],S._storeNames,S._dbSchema),b.schema=S._dbSchema}),B.push(function(z){S.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(S.idbdb.version/10)===G._cfg.version?(S.idbdb.deleteObjectStore("$meta"),delete S._dbSchema.$meta,S._storeNames=S._storeNames.filter(function(K){return K!=="$meta"})):z.objectStore("$meta").put(G._cfg.version,"version"))})}),function G(){return B.length?ot.resolve(B.shift()(b.idbtrans)).then(G):ot.resolve()}().then(function(){$o(M,x)})):ot.resolve();var S,U,b,x,B,M}).catch(g)):(a(E).forEach(function(D){Es(l,D,E[D].primKey,E[D].indexes)}),Jr(r,l),void ot.follow(function(){return r.on.populate.fire(m)}).catch(g));var N,P})}function lc(r,i){$o(r._dbSchema,i),i.db.version%10!=0||i.objectStoreNames.contains("$meta")||i.db.createObjectStore("$meta").add(Math.ceil(i.db.version/10-1),"version");var l=ni(0,r.idbdb,i);ri(r,r._dbSchema,i);for(var d=0,E=ps(l,r._dbSchema).change;d<E.length;d++){var m=function(g){if(g.change.length||g.recreate)return console.warn("Unable to patch indexes of table ".concat(g.name," because it has changes on the type of index or primary key.")),{value:void 0};var O=i.objectStore(g.name);g.add.forEach(function(N){we&&console.debug("Dexie upgrade patch: Creating missing index ".concat(g.name,".").concat(N.src)),ei(O,N)})}(E[d]);if(typeof m=="object")return m.value}}function ps(r,i){var l,d={del:[],add:[],change:[]};for(l in r)i[l]||d.del.push(l);for(l in i){var E=r[l],m=i[l];if(E){var g={name:l,def:m,recreate:!1,del:[],add:[],change:[]};if(""+(E.primKey.keyPath||"")!=""+(m.primKey.keyPath||"")||E.primKey.auto!==m.primKey.auto)g.recreate=!0,d.change.push(g);else{var O=E.idxByName,N=m.idxByName,P=void 0;for(P in O)N[P]||g.del.push(P);for(P in N){var D=O[P],S=N[P];D?D.src!==S.src&&g.change.push(S):g.add.push(S)}(0<g.del.length||0<g.add.length||0<g.change.length)&&d.change.push(g)}}else d.add.push([l,m])}return d}function Es(r,i,l,d){var E=r.db.createObjectStore(i,l.keyPath?{keyPath:l.keyPath,autoIncrement:l.auto}:{autoIncrement:l.auto});return d.forEach(function(m){return ei(E,m)}),E}function $o(r,i){a(r).forEach(function(l){i.db.objectStoreNames.contains(l)||(we&&console.debug("Dexie: Creating missing table",l),Es(i,l,r[l].primKey,r[l].indexes))})}function ei(r,i){r.createIndex(i.name,i.keyPath,{unique:i.unique,multiEntry:i.multi})}function ni(r,i,l){var d={};return v(i.objectStoreNames,0).forEach(function(E){for(var m=l.objectStore(E),g=cs(Zo(P=m.keyPath),P||"",!0,!1,!!m.autoIncrement,P&&typeof P!="string",!0),O=[],N=0;N<m.indexNames.length;++N){var D=m.index(m.indexNames[N]),P=D.keyPath,D=cs(D.name,P,!!D.unique,!!D.multiEntry,!1,P&&typeof P!="string",!1);O.push(D)}d[E]=hs(E,g,O)}),d}function ri(r,i,l){for(var d=l.db.objectStoreNames,E=0;E<d.length;++E){var m=d[E],g=l.objectStore(m);r._hasGetAll="getAll"in g;for(var O=0;O<g.indexNames.length;++O){var N=g.indexNames[O],P=g.index(N).keyPath,D=typeof P=="string"?P:"["+v(P).join("+")+"]";!i[m]||(P=i[m].idxByName[D])&&(P.name=N,delete i[m].idxByName[D],i[m].idxByName[N]=P)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&o.WorkerGlobalScope&&o instanceof o.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(r._hasGetAll=!1)}function Jo(r){return r.split(",").map(function(i,l){var d=(i=i.trim()).replace(/([&*]|\+\+)/g,""),E=/^\[/.test(d)?d.match(/^\[(.*)\]$/)[1].split("+"):d;return cs(d,E||null,/\&/.test(i),/\*/.test(i),/\+\+/.test(i),c(E),l===0)})}var cc=(ii.prototype._parseStoresSpec=function(r,i){a(r).forEach(function(l){if(r[l]!==null){var d=Jo(r[l]),E=d.shift();if(E.unique=!0,E.multi)throw new ct.Schema("Primary key cannot be multi-valued");d.forEach(function(m){if(m.auto)throw new ct.Schema("Only primary key can be marked as autoIncrement (++)");if(!m.keyPath)throw new ct.Schema("Index must have a name and cannot be an empty string")}),i[l]=hs(l,E,d)}})},ii.prototype.stores=function(l){var i=this.db;this._cfg.storesSource=this._cfg.storesSource?h(this._cfg.storesSource,l):l;var l=i._versions,d={},E={};return l.forEach(function(m){h(d,m._cfg.storesSource),E=m._cfg.dbschema={},m._parseStoresSpec(d,E)}),i._dbSchema=E,ds(i,[i._allTables,i,i.Transaction.prototype]),ti(i,[i._allTables,i,i.Transaction.prototype,this._cfg.tables],a(E),E),i._storeNames=a(E),this},ii.prototype.upgrade=function(r){return this._cfg.contentUpgrade=Xi(this._cfg.contentUpgrade||Ot,r),this},ii);function ii(){}function fs(r,i){var l=r._dbNamesDB;return l||(l=r._dbNamesDB=new Ye(jr,{addons:[],indexedDB:r,IDBKeyRange:i})).version(1).stores({dbnames:"name"}),l.table("dbnames")}function Is(r){return r&&typeof r.databases=="function"}function ms(r){return He(function(){return ht.letThrough=!0,r()})}function Cs(r){return!("from"in r)}var Xt=function(r,i){if(!this){var l=new Xt;return r&&"d"in r&&h(l,r),l}h(this,arguments.length?{d:1,from:r,to:1<arguments.length?i:r}:{d:0})};function fr(r,i,l){var d=_t(i,l);if(!isNaN(d)){if(0<d)throw RangeError();if(Cs(r))return h(r,{from:i,to:l,d:1});var E=r.l,d=r.r;if(_t(l,r.from)<0)return E?fr(E,i,l):r.l={from:i,to:l,d:1,l:null,r:null},ta(r);if(0<_t(i,r.to))return d?fr(d,i,l):r.r={from:i,to:l,d:1,l:null,r:null},ta(r);_t(i,r.from)<0&&(r.from=i,r.l=null,r.d=d?d.d+1:1),0<_t(l,r.to)&&(r.to=l,r.r=null,r.d=r.l?r.l.d+1:1),l=!r.r,E&&!r.l&&Ir(r,E),d&&l&&Ir(r,d)}}function Ir(r,i){Cs(i)||function l(d,N){var m=N.from,g=N.to,O=N.l,N=N.r;fr(d,m,g),O&&l(d,O),N&&l(d,N)}(r,i)}function si(r,i){var l=Ts(i),d=l.next();if(d.done)return!1;for(var E=d.value,m=Ts(r),g=m.next(E.from),O=g.value;!d.done&&!g.done;){if(_t(O.from,E.to)<=0&&0<=_t(O.to,E.from))return!0;_t(E.from,O.from)<0?E=(d=l.next(O.from)).value:O=(g=m.next(E.from)).value}return!1}function Ts(r){var i=Cs(r)?null:{s:0,n:r};return{next:function(l){for(var d=0<arguments.length;i;)switch(i.s){case 0:if(i.s=1,d)for(;i.n.l&&_t(l,i.n.from)<0;)i={up:i,n:i.n.l,s:1};else for(;i.n.l;)i={up:i,n:i.n.l,s:1};case 1:if(i.s=2,!d||_t(l,i.n.to)<=0)return{value:i.n,done:!1};case 2:if(i.n.r){i.s=3,i={up:i,n:i.n.r,s:0};continue}case 3:i=i.up}return{done:!0}}}}function ta(r){var i,l,d=(((i=r.r)===null||i===void 0?void 0:i.d)||0)-(((l=r.l)===null||l===void 0?void 0:l.d)||0),E=1<d?"r":d<-1?"l":"";E&&(i=E=="r"?"l":"r",l=n({},r),d=r[E],r.from=d.from,r.to=d.to,r[E]=d[E],l[E]=d[i],(r[i]=l).d=ea(l)),r.d=ea(r)}function ea(l){var i=l.r,l=l.l;return(i?l?Math.max(i.d,l.d):i.d:l?l.d:0)+1}function oi(r,i){return a(i).forEach(function(l){r[l]?Ir(r[l],i[l]):r[l]=function d(E){var m,g,O={};for(m in E)I(E,m)&&(g=E[m],O[m]=!g||typeof g!="object"||J.has(g.constructor)?g:d(g));return O}(i[l])}),r}function gs(r,i){return r.all||i.all||Object.keys(r).some(function(l){return i[l]&&si(i[l],r[l])})}f(Xt.prototype,((ce={add:function(r){return Ir(this,r),this},addKey:function(r){return fr(this,r,r),this},addKeys:function(r){var i=this;return r.forEach(function(l){return fr(i,l,l)}),this}})[yt]=function(){return Ts(this)},ce));var hn={},ys={},Rs=!1;function ai(r){oi(ys,r),Rs||(Rs=!0,setTimeout(function(){Rs=!1,As(ys,!(ys={}))},0))}function As(r,i){i===void 0&&(i=!1);var l=new Set;if(r.all)for(var d=0,E=Object.values(hn);d<E.length;d++)na(g=E[d],r,l,i);else for(var m in r){var g,O=/^idb\:\/\/(.*)\/(.*)\//.exec(m);O&&(m=O[1],O=O[2],(g=hn["idb://".concat(m,"/").concat(O)])&&na(g,r,l,i))}l.forEach(function(N){return N()})}function na(r,i,l,d){for(var E=[],m=0,g=Object.entries(r.queries.query);m<g.length;m++){for(var O=g[m],N=O[0],P=[],D=0,S=O[1];D<S.length;D++){var U=S[D];gs(i,U.obsSet)?U.subscribers.forEach(function(M){return l.add(M)}):d&&P.push(U)}d&&E.push([N,P])}if(d)for(var b=0,x=E;b<x.length;b++){var B=x[b],N=B[0],P=B[1];r.queries.query[N]=P}}function hc(r){var i=r._state,l=r._deps.indexedDB;if(i.isBeingOpened||r.idbdb)return i.dbReadyPromise.then(function(){return i.dbOpenError?Bt(i.dbOpenError):r});i.isBeingOpened=!0,i.dbOpenError=null,i.openComplete=!1;var d=i.openCanceller,E=Math.round(10*r.verno),m=!1;function g(){if(i.openCanceller!==d)throw new ct.DatabaseClosed("db.open() was cancelled")}function O(){return new ot(function(U,b){if(g(),!l)throw new ct.MissingAPI;var x=r.name,B=i.autoSchema||!E?l.open(x):l.open(x,E);if(!B)throw new ct.MissingAPI;B.onerror=ve(b),B.onblocked=Nt(r._fireOnBlocked),B.onupgradeneeded=Nt(function(M){var G;D=B.transaction,i.autoSchema&&!r._options.allowEmptyDB?(B.onerror=ur,D.abort(),B.result.close(),(G=l.deleteDatabase(x)).onsuccess=G.onerror=Nt(function(){b(new ct.NoSuchDatabase("Database ".concat(x," doesnt exist")))})):(D.onerror=ve(b),M=M.oldVersion>Math.pow(2,62)?0:M.oldVersion,S=M<1,r.idbdb=B.result,m&&lc(r,D),ac(r,M/10,D,b))},b),B.onsuccess=Nt(function(){D=null;var M,G,z,K,W,Z=r.idbdb=B.result,rt=v(Z.objectStoreNames);if(0<rt.length)try{var tt=Z.transaction((K=rt).length===1?K[0]:K,"readonly");if(i.autoSchema)G=Z,z=tt,(M=r).verno=G.version/10,z=M._dbSchema=ni(0,G,z),M._storeNames=v(G.objectStoreNames,0),ti(M,[M._allTables],a(z),z);else if(ri(r,r._dbSchema,tt),((W=ps(ni(0,(W=r).idbdb,tt),W._dbSchema)).add.length||W.change.some(function(et){return et.add.length||et.change.length}))&&!m)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),Z.close(),E=Z.version+1,m=!0,U(O());Jr(r,tt)}catch{}An.push(r),Z.onversionchange=Nt(function(et){i.vcFired=!0,r.on("versionchange").fire(et)}),Z.onclose=Nt(function(et){r.on("close").fire(et)}),S&&(W=r._deps,tt=x,Z=W.indexedDB,W=W.IDBKeyRange,Is(Z)||tt===jr||fs(Z,W).put({name:tt}).catch(Ot)),U()},b)}).catch(function(U){switch(U==null?void 0:U.name){case"UnknownError":if(0<i.PR1398_maxLoop)return i.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),O();break;case"VersionError":if(0<E)return E=0,O()}return ot.reject(U)})}var N,P=i.dbReadyResolve,D=null,S=!1;return ot.race([d,(typeof navigator>"u"?ot.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(U){function b(){return indexedDB.databases().finally(U)}N=setInterval(b,100),b()}).finally(function(){return clearInterval(N)}):Promise.resolve()).then(O)]).then(function(){return g(),i.onReadyBeingFired=[],ot.resolve(ms(function(){return r.on.ready.fire(r.vip)})).then(function U(){if(0<i.onReadyBeingFired.length){var b=i.onReadyBeingFired.reduce(Xi,Ot);return i.onReadyBeingFired=[],ot.resolve(ms(function(){return b(r.vip)})).then(U)}})}).finally(function(){i.openCanceller===d&&(i.onReadyBeingFired=null,i.isBeingOpened=!1)}).catch(function(U){i.dbOpenError=U;try{D&&D.abort()}catch{}return d===i.openCanceller&&r._close(),Bt(U)}).finally(function(){i.openComplete=!0,P()}).then(function(){var U;return S&&(U={},r.tables.forEach(function(b){b.schema.indexes.forEach(function(x){x.name&&(U["idb://".concat(r.name,"/").concat(b.name,"/").concat(x.name)]=new Xt(-1/0,[[[]]]))}),U["idb://".concat(r.name,"/").concat(b.name,"/")]=U["idb://".concat(r.name,"/").concat(b.name,"/:dels")]=new Xt(-1/0,[[[]]])}),je(dr).fire(U),As(U,!0)),r})}function Fs(r){function i(m){return r.next(m)}var l=E(i),d=E(function(m){return r.throw(m)});function E(m){return function(N){var O=m(N),N=O.value;return O.done?N:N&&typeof N.then=="function"?N.then(l,d):c(N)?Promise.all(N).then(l,d):l(N)}}return E(i)()}function li(r,i,l){for(var d=c(r)?r.slice():[r],E=0;E<l;++E)d.push(i);return d}var uc={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(r){return n(n({},r),{table:function(i){var l=r.table(i),d=l.schema,E={},m=[];function g(S,U,b){var x=Er(S),B=E[x]=E[x]||[],M=S==null?0:typeof S=="string"?1:S.length,G=0<U,G=n(n({},b),{name:G?"".concat(x,"(virtual-from:").concat(b.name,")"):b.name,lowLevelIndex:b,isVirtual:G,keyTail:U,keyLength:M,extractKey:us(S),unique:!G&&b.unique});return B.push(G),G.isPrimaryKey||m.push(G),1<M&&g(M===2?S[0]:S.slice(0,M-1),U+1,b),B.sort(function(z,K){return z.keyTail-K.keyTail}),G}i=g(d.primaryKey.keyPath,0,d.primaryKey),E[":id"]=[i];for(var O=0,N=d.indexes;O<N.length;O++){var P=N[O];g(P.keyPath,0,P)}function D(S){var U,b=S.query.index;return b.isVirtual?n(n({},S),{query:{index:b.lowLevelIndex,range:(U=S.query.range,b=b.keyTail,{type:U.type===1?2:U.type,lower:li(U.lower,U.lowerOpen?r.MAX_KEY:r.MIN_KEY,b),lowerOpen:!0,upper:li(U.upper,U.upperOpen?r.MIN_KEY:r.MAX_KEY,b),upperOpen:!0})}}):S}return n(n({},l),{schema:n(n({},d),{primaryKey:i,indexes:m,getIndexByKeyPath:function(S){return(S=E[Er(S)])&&S[0]}}),count:function(S){return l.count(D(S))},query:function(S){return l.query(D(S))},openCursor:function(S){var U=S.query.index,b=U.keyTail,x=U.isVirtual,B=U.keyLength;return x?l.openCursor(D(S)).then(function(G){return G&&M(G)}):l.openCursor(S);function M(G){return Object.create(G,{continue:{value:function(z){z!=null?G.continue(li(z,S.reverse?r.MAX_KEY:r.MIN_KEY,b)):S.unique?G.continue(G.key.slice(0,B).concat(S.reverse?r.MIN_KEY:r.MAX_KEY,b)):G.continue()}},continuePrimaryKey:{value:function(z,K){G.continuePrimaryKey(li(z,r.MAX_KEY,b),K)}},primaryKey:{get:function(){return G.primaryKey}},key:{get:function(){var z=G.key;return B===1?z[0]:z.slice(0,B)}},value:{get:function(){return G.value}}})}}})}})}};function _s(r,i,l,d){return l=l||{},d=d||"",a(r).forEach(function(E){var m,g,O;I(i,E)?(m=r[E],g=i[E],typeof m=="object"&&typeof g=="object"&&m&&g?(O=It(m))!==It(g)?l[d+E]=i[E]:O==="Object"?_s(m,g,l,d+E+"."):m!==g&&(l[d+E]=i[E]):m!==g&&(l[d+E]=i[E])):l[d+E]=void 0}),a(i).forEach(function(E){I(r,E)||(l[d+E]=i[E])}),l}function Os(r,i){return i.type==="delete"?i.keys:i.keys||i.values.map(r.extractKey)}var dc={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(r){return n(n({},r),{table:function(i){var l=r.table(i),d=l.schema.primaryKey;return n(n({},l),{mutate:function(E){var m=ht.trans,g=m.table(i).hook,O=g.deleting,N=g.creating,P=g.updating;switch(E.type){case"add":if(N.fire===Ot)break;return m._promise("readwrite",function(){return D(E)},!0);case"put":if(N.fire===Ot&&P.fire===Ot)break;return m._promise("readwrite",function(){return D(E)},!0);case"delete":if(O.fire===Ot)break;return m._promise("readwrite",function(){return D(E)},!0);case"deleteRange":if(O.fire===Ot)break;return m._promise("readwrite",function(){return function S(U,b,x){return l.query({trans:U,values:!1,query:{index:d,range:b},limit:x}).then(function(B){var M=B.result;return D({type:"delete",keys:M,trans:U}).then(function(G){return 0<G.numFailures?Promise.reject(G.failures[0]):M.length<x?{failures:[],numFailures:0,lastResult:void 0}:S(U,n(n({},b),{lower:M[M.length-1],lowerOpen:!0}),x)})})}(E.trans,E.range,1e4)},!0)}return l.mutate(E);function D(S){var U,b,x,B=ht.trans,M=S.keys||Os(d,S);if(!M)throw new Error("Keys missing");return(S=S.type==="add"||S.type==="put"?n(n({},S),{keys:M}):n({},S)).type!=="delete"&&(S.values=s([],S.values,!0)),S.keys&&(S.keys=s([],S.keys,!0)),U=l,x=M,((b=S).type==="add"?Promise.resolve([]):U.getMany({trans:b.trans,keys:x,cache:"immutable"})).then(function(G){var z=M.map(function(K,W){var Z,rt,tt,et=G[W],it={onerror:null,onsuccess:null};return S.type==="delete"?O.fire.call(it,K,et,B):S.type==="add"||et===void 0?(Z=N.fire.call(it,K,S.values[W],B),K==null&&Z!=null&&(S.keys[W]=K=Z,d.outbound||V(S.values[W],d.keyPath,K))):(Z=_s(et,S.values[W]),(rt=P.fire.call(it,Z,K,et,B))&&(tt=S.values[W],Object.keys(rt).forEach(function(st){I(tt,st)?tt[st]=rt[st]:V(tt,st,rt[st])}))),it});return l.mutate(S).then(function(K){for(var W=K.failures,Z=K.results,rt=K.numFailures,K=K.lastResult,tt=0;tt<M.length;++tt){var et=(Z||M)[tt],it=z[tt];et==null?it.onerror&&it.onerror(W[tt]):it.onsuccess&&it.onsuccess(S.type==="put"&&G[tt]?S.values[tt]:et)}return{failures:W,results:Z,numFailures:rt,lastResult:K}}).catch(function(K){return z.forEach(function(W){return W.onerror&&W.onerror(K)}),Promise.reject(K)})})}}})}})}};function ra(r,i,l){try{if(!i||i.keys.length<r.length)return null;for(var d=[],E=0,m=0;E<i.keys.length&&m<r.length;++E)_t(i.keys[E],r[m])===0&&(d.push(l?nt(i.values[E]):i.values[E]),++m);return d.length===r.length?d:null}catch{return null}}var pc={stack:"dbcore",level:-1,create:function(r){return{table:function(i){var l=r.table(i);return n(n({},l),{getMany:function(d){if(!d.cache)return l.getMany(d);var E=ra(d.keys,d.trans._cache,d.cache==="clone");return E?ot.resolve(E):l.getMany(d).then(function(m){return d.trans._cache={keys:d.keys,values:d.cache==="clone"?nt(m):m},m})},mutate:function(d){return d.type!=="add"&&(d.trans._cache=null),l.mutate(d)}})}}}};function ia(r,i){return r.trans.mode==="readonly"&&!!r.subscr&&!r.trans.explicit&&r.trans.db._options.cache!=="disabled"&&!i.schema.primaryKey.outbound}function sa(r,i){switch(r){case"query":return i.values&&!i.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Ec={stack:"dbcore",level:0,name:"Observability",create:function(r){var i=r.schema.name,l=new Xt(r.MIN_KEY,r.MAX_KEY);return n(n({},r),{transaction:function(d,E,m){if(ht.subscr&&E!=="readonly")throw new ct.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(ht.querier));return r.transaction(d,E,m)},table:function(d){var E=r.table(d),m=E.schema,g=m.primaryKey,S=m.indexes,O=g.extractKey,N=g.outbound,P=g.autoIncrement&&S.filter(function(b){return b.compound&&b.keyPath.includes(g.keyPath)}),D=n(n({},E),{mutate:function(b){function x(st){return st="idb://".concat(i,"/").concat(d,"/").concat(st),K[st]||(K[st]=new Xt)}var B,M,G,z=b.trans,K=b.mutatedParts||(b.mutatedParts={}),W=x(""),Z=x(":dels"),rt=b.type,it=b.type==="deleteRange"?[b.range]:b.type==="delete"?[b.keys]:b.values.length<50?[Os(g,b).filter(function(st){return st}),b.values]:[],tt=it[0],et=it[1],it=b.trans._cache;return c(tt)?(W.addKeys(tt),(it=rt==="delete"||tt.length===et.length?ra(tt,it):null)||Z.addKeys(tt),(it||et)&&(B=x,M=it,G=et,m.indexes.forEach(function(st){var pt=B(st.name||"");function mt(Ct){return Ct!=null?st.extractKey(Ct):null}function gt(Ct){return st.multiEntry&&c(Ct)?Ct.forEach(function(Ce){return pt.addKey(Ce)}):pt.addKey(Ct)}(M||G).forEach(function(Ct,jt){var Tt=M&&mt(M[jt]),jt=G&&mt(G[jt]);_t(Tt,jt)!==0&&(Tt!=null&&gt(Tt),jt!=null&&gt(jt))})}))):tt?(et={from:tt.lower,to:tt.upper},Z.add(et),W.add(et)):(W.add(l),Z.add(l),m.indexes.forEach(function(st){return x(st.name).add(l)})),E.mutate(b).then(function(st){return!tt||b.type!=="add"&&b.type!=="put"||(W.addKeys(st.results),P&&P.forEach(function(pt){var mt=b.values.map(function(Ct){return pt.extractKey(Ct)}),gt=pt.keyPath.findIndex(function(Ct){return Ct===g.keyPath});st.results.forEach(function(Ct){return mt[gt]=Ct}),x(pt.name).addKeys(mt)})),z.mutatedParts=oi(z.mutatedParts||{},K),st})}}),S=function(x){var B=x.query,x=B.index,B=B.range;return[x,new Xt((x=B.lower)!==null&&x!==void 0?x:r.MIN_KEY,(B=B.upper)!==null&&B!==void 0?B:r.MAX_KEY)]},U={get:function(b){return[g,new Xt(b.key)]},getMany:function(b){return[g,new Xt().addKeys(b.keys)]},count:S,query:S,openCursor:S};return a(U).forEach(function(b){D[b]=function(x){var B=ht.subscr,M=!!B,G=ia(ht,E)&&sa(b,x)?x.obsSet={}:B;if(M){var z=function(et){return et="idb://".concat(i,"/").concat(d,"/").concat(et),G[et]||(G[et]=new Xt)},K=z(""),W=z(":dels"),B=U[b](x),M=B[0],B=B[1];if((b==="query"&&M.isPrimaryKey&&!x.values?W:z(M.name||"")).add(B),!M.isPrimaryKey){if(b!=="count"){var Z=b==="query"&&N&&x.values&&E.query(n(n({},x),{values:!1}));return E[b].apply(this,arguments).then(function(et){if(b==="query"){if(N&&x.values)return Z.then(function(mt){return mt=mt.result,K.addKeys(mt),et});var it=x.values?et.result.map(O):et.result;(x.values?K:W).addKeys(it)}else if(b==="openCursor"){var st=et,pt=x.values;return st&&Object.create(st,{key:{get:function(){return W.addKey(st.primaryKey),st.key}},primaryKey:{get:function(){var mt=st.primaryKey;return W.addKey(mt),mt}},value:{get:function(){return pt&&K.addKey(st.primaryKey),st.value}}})}return et})}W.add(l)}}return E[b].apply(this,arguments)}}),D}})}};function oa(r,i,l){if(l.numFailures===0)return i;if(i.type==="deleteRange")return null;var d=i.keys?i.keys.length:"values"in i&&i.values?i.values.length:1;return l.numFailures===d?null:(i=n({},i),c(i.keys)&&(i.keys=i.keys.filter(function(E,m){return!(m in l.failures)})),"values"in i&&c(i.values)&&(i.values=i.values.filter(function(E,m){return!(m in l.failures)})),i)}function ws(r,i){return l=r,((d=i).lower===void 0||(d.lowerOpen?0<_t(l,d.lower):0<=_t(l,d.lower)))&&(r=r,(i=i).upper===void 0||(i.upperOpen?_t(r,i.upper)<0:_t(r,i.upper)<=0));var l,d}function aa(r,i,U,d,E,m){if(!U||U.length===0)return r;var g=i.query.index,O=g.multiEntry,N=i.query.range,P=d.schema.primaryKey.extractKey,D=g.extractKey,S=(g.lowLevelIndex||g).extractKey,U=U.reduce(function(b,x){var B=b,M=x.type==="add"||x.type==="put"?x.values.filter(function(W){return W=D(W),O&&c(W)?W.some(function(Z){return ws(Z,N)}):ws(W,N)}).map(function(W){return W=nt(W),m&&Object.freeze(W),W}):[];switch(x.type){case"add":B=b.concat(i.values?M:M.map(function(Z){return P(Z)}));break;case"put":var G=new Xt().addKeys(x.values.map(function(Z){return P(Z)})),B=b.filter(function(Z){return Z=i.values?P(Z):Z,!si(new Xt(Z),G)}).concat(i.values?M:M.map(function(Z){return P(Z)}));break;case"delete":var z=new Xt().addKeys(x.keys);B=b.filter(function(Z){return Z=i.values?P(Z):Z,!si(new Xt(Z),z)});break;case"deleteRange":var K=x.range;B=b.filter(function(Z){return!ws(P(Z),K)})}return B},r);return U===r?r:(U.sort(function(b,x){return _t(S(b),S(x))||_t(P(b),P(x))}),i.limit&&i.limit<1/0&&(U.length>i.limit?U.length=i.limit:r.length===i.limit&&U.length<i.limit&&(E.dirty=!0)),m?Object.freeze(U):U)}function la(r,i){return _t(r.lower,i.lower)===0&&_t(r.upper,i.upper)===0&&!!r.lowerOpen==!!i.lowerOpen&&!!r.upperOpen==!!i.upperOpen}function fc(r,i){return function(l,d,E,m){if(l===void 0)return d!==void 0?-1:0;if(d===void 0)return 1;if((d=_t(l,d))===0){if(E&&m)return 0;if(E)return 1;if(m)return-1}return d}(r.lower,i.lower,r.lowerOpen,i.lowerOpen)<=0&&0<=function(l,d,E,m){if(l===void 0)return d!==void 0?1:0;if(d===void 0)return-1;if((d=_t(l,d))===0){if(E&&m)return 0;if(E)return-1;if(m)return 1}return d}(r.upper,i.upper,r.upperOpen,i.upperOpen)}function Ic(r,i,l,d){r.subscribers.add(l),d.addEventListener("abort",function(){var E,m;r.subscribers.delete(l),r.subscribers.size===0&&(E=r,m=i,setTimeout(function(){E.subscribers.size===0&&Rt(m,E)},3e3))})}var mc={stack:"dbcore",level:0,name:"Cache",create:function(r){var i=r.schema.name;return n(n({},r),{transaction:function(l,d,E){var m,g,O=r.transaction(l,d,E);return d==="readwrite"&&(g=(m=new AbortController).signal,E=function(N){return function(){if(m.abort(),d==="readwrite"){for(var P=new Set,D=0,S=l;D<S.length;D++){var U=S[D],b=hn["idb://".concat(i,"/").concat(U)];if(b){var x=r.table(U),B=b.optimisticOps.filter(function(pt){return pt.trans===O});if(O._explicit&&N&&O.mutatedParts)for(var M=0,G=Object.values(b.queries.query);M<G.length;M++)for(var z=0,K=(rt=G[M]).slice();z<K.length;z++)gs((tt=K[z]).obsSet,O.mutatedParts)&&(Rt(rt,tt),tt.subscribers.forEach(function(pt){return P.add(pt)}));else if(0<B.length){b.optimisticOps=b.optimisticOps.filter(function(pt){return pt.trans!==O});for(var W=0,Z=Object.values(b.queries.query);W<Z.length;W++)for(var rt,tt,et,it=0,st=(rt=Z[W]).slice();it<st.length;it++)(tt=st[it]).res!=null&&O.mutatedParts&&(N&&!tt.dirty?(et=Object.isFrozen(tt.res),et=aa(tt.res,tt.req,B,x,tt,et),tt.dirty?(Rt(rt,tt),tt.subscribers.forEach(function(pt){return P.add(pt)})):et!==tt.res&&(tt.res=et,tt.promise=ot.resolve({result:et}))):(tt.dirty&&Rt(rt,tt),tt.subscribers.forEach(function(pt){return P.add(pt)})))}}}P.forEach(function(pt){return pt()})}}},O.addEventListener("abort",E(!1),{signal:g}),O.addEventListener("error",E(!1),{signal:g}),O.addEventListener("complete",E(!0),{signal:g})),O},table:function(l){var d=r.table(l),E=d.schema.primaryKey;return n(n({},d),{mutate:function(m){var g=ht.trans;if(E.outbound||g.db._options.cache==="disabled"||g.explicit)return d.mutate(m);var O=hn["idb://".concat(i,"/").concat(l)];return O?(g=d.mutate(m),m.type!=="add"&&m.type!=="put"||!(50<=m.values.length||Os(E,m).some(function(N){return N==null}))?(O.optimisticOps.push(m),m.mutatedParts&&ai(m.mutatedParts),g.then(function(N){0<N.numFailures&&(Rt(O.optimisticOps,m),(N=oa(0,m,N))&&O.optimisticOps.push(N),m.mutatedParts&&ai(m.mutatedParts))}),g.catch(function(){Rt(O.optimisticOps,m),m.mutatedParts&&ai(m.mutatedParts)})):g.then(function(N){var P=oa(0,n(n({},m),{values:m.values.map(function(b,S){var U,b=(U=E.keyPath)!==null&&U!==void 0&&U.includes(".")?nt(b):n({},b);return V(b,E.keyPath,N.results[S]),b})}),N);O.optimisticOps.push(P),queueMicrotask(function(){return m.mutatedParts&&ai(m.mutatedParts)})}),g):d.mutate(m)},query:function(m){if(!ia(ht,d)||!sa("query",m))return d.query(m);var g=((P=ht.trans)===null||P===void 0?void 0:P.db._options.cache)==="immutable",S=ht,O=S.requery,N=S.signal,P=function(x,B,M,G){var z=hn["idb://".concat(x,"/").concat(B)];if(!z)return[];if(!(B=z.queries[M]))return[null,!1,z,null];var K=B[(G.query?G.query.index.name:null)||""];if(!K)return[null,!1,z,null];switch(M){case"query":var W=K.find(function(Z){return Z.req.limit===G.limit&&Z.req.values===G.values&&la(Z.req.query.range,G.query.range)});return W?[W,!0,z,K]:[K.find(function(Z){return("limit"in Z.req?Z.req.limit:1/0)>=G.limit&&(!G.values||Z.req.values)&&fc(Z.req.query.range,G.query.range)}),!1,z,K];case"count":return W=K.find(function(Z){return la(Z.req.query.range,G.query.range)}),[W,!!W,z,K]}}(i,l,"query",m),D=P[0],S=P[1],U=P[2],b=P[3];return D&&S?D.obsSet=m.obsSet:(S=d.query(m).then(function(x){var B=x.result;if(D&&(D.res=B),g){for(var M=0,G=B.length;M<G;++M)Object.freeze(B[M]);Object.freeze(B)}else x.result=nt(B);return x}).catch(function(x){return b&&D&&Rt(b,D),Promise.reject(x)}),D={obsSet:m.obsSet,promise:S,subscribers:new Set,type:"query",req:m,dirty:!1},b?b.push(D):(b=[D],(U=U||(hn["idb://".concat(i,"/").concat(l)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[m.query.index.name||""]=b)),Ic(D,b,O,N),D.promise.then(function(x){return{result:aa(x.result,m,U==null?void 0:U.optimisticOps,d,D,g)}})}})}})}};function ci(r,i){return new Proxy(r,{get:function(l,d,E){return d==="db"?i:Reflect.get(l,d,E)}})}var Ye=(Yt.prototype.version=function(r){if(isNaN(r)||r<.1)throw new ct.Type("Given version is not a positive number");if(r=Math.round(10*r)/10,this.idbdb||this._state.isBeingOpened)throw new ct.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,r);var i=this._versions,l=i.filter(function(d){return d._cfg.version===r})[0];return l||(l=new this.Version(r),i.push(l),i.sort(oc),l.stores({}),this._state.autoSchema=!1,l)},Yt.prototype._whenReady=function(r){var i=this;return this.idbdb&&(this._state.openComplete||ht.letThrough||this._vip)?r():new ot(function(l,d){if(i._state.openComplete)return d(new ct.DatabaseClosed(i._state.dbOpenError));if(!i._state.isBeingOpened){if(!i._state.autoOpen)return void d(new ct.DatabaseClosed);i.open().catch(Ot)}i._state.dbReadyPromise.then(l,d)}).then(r)},Yt.prototype.use=function(r){var i=r.stack,l=r.create,d=r.level,E=r.name;return E&&this.unuse({stack:i,name:E}),r=this._middlewares[i]||(this._middlewares[i]=[]),r.push({stack:i,create:l,level:d??10,name:E}),r.sort(function(m,g){return m.level-g.level}),this},Yt.prototype.unuse=function(r){var i=r.stack,l=r.name,d=r.create;return i&&this._middlewares[i]&&(this._middlewares[i]=this._middlewares[i].filter(function(E){return d?E.create!==d:!!l&&E.name!==l})),this},Yt.prototype.open=function(){var r=this;return an(ze,function(){return hc(r)})},Yt.prototype._close=function(){var r=this._state,i=An.indexOf(this);if(0<=i&&An.splice(i,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}r.isBeingOpened||(r.dbReadyPromise=new ot(function(l){r.dbReadyResolve=l}),r.openCanceller=new ot(function(l,d){r.cancelOpen=d}))},Yt.prototype.close=function(l){var i=(l===void 0?{disableAutoOpen:!0}:l).disableAutoOpen,l=this._state;i?(l.isBeingOpened&&l.cancelOpen(new ct.DatabaseClosed),this._close(),l.autoOpen=!1,l.dbOpenError=new ct.DatabaseClosed):(this._close(),l.autoOpen=this._options.autoOpen||l.isBeingOpened,l.openComplete=!1,l.dbOpenError=null)},Yt.prototype.delete=function(r){var i=this;r===void 0&&(r={disableAutoOpen:!0});var l=0<arguments.length&&typeof arguments[0]!="object",d=this._state;return new ot(function(E,m){function g(){i.close(r);var O=i._deps.indexedDB.deleteDatabase(i.name);O.onsuccess=Nt(function(){var N,P,D;N=i._deps,P=i.name,D=N.indexedDB,N=N.IDBKeyRange,Is(D)||P===jr||fs(D,N).delete(P).catch(Ot),E()}),O.onerror=ve(m),O.onblocked=i._fireOnBlocked}if(l)throw new ct.InvalidArgument("Invalid closeOptions argument to db.delete()");d.isBeingOpened?d.dbReadyPromise.then(g):g()})},Yt.prototype.backendDB=function(){return this.idbdb},Yt.prototype.isOpen=function(){return this.idbdb!==null},Yt.prototype.hasBeenClosed=function(){var r=this._state.dbOpenError;return r&&r.name==="DatabaseClosed"},Yt.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Yt.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Yt.prototype,"tables",{get:function(){var r=this;return a(this._allTables).map(function(i){return r._allTables[i]})},enumerable:!1,configurable:!0}),Yt.prototype.transaction=function(){var r=(function(i,l,d){var E=arguments.length;if(E<2)throw new ct.InvalidArgument("Too few arguments");for(var m=new Array(E-1);--E;)m[E-1]=arguments[E];return d=m.pop(),[i,Q(m),d]}).apply(this,arguments);return this._transaction.apply(this,r)},Yt.prototype._transaction=function(r,i,l){var d=this,E=ht.trans;E&&E.db===this&&r.indexOf("!")===-1||(E=null);var m,g,O=r.indexOf("?")!==-1;r=r.replace("!","").replace("?","");try{if(g=i.map(function(P){if(P=P instanceof d.Table?P.name:P,typeof P!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return P}),r=="r"||r===ns)m=ns;else{if(r!="rw"&&r!=rs)throw new ct.InvalidArgument("Invalid transaction mode: "+r);m=rs}if(E){if(E.mode===ns&&m===rs){if(!O)throw new ct.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");E=null}E&&g.forEach(function(P){if(E&&E.storeNames.indexOf(P)===-1){if(!O)throw new ct.SubTransaction("Table "+P+" not included in parent transaction.");E=null}}),O&&E&&!E.active&&(E=null)}}catch(P){return E?E._promise(null,function(D,S){S(P)}):Bt(P)}var N=(function P(D,S,U,b,x){return ot.resolve().then(function(){var B=ht.transless||ht,M=D._createTransaction(S,U,D._dbSchema,b);if(M.explicit=!0,B={trans:M,transless:B},b)M.idbtrans=b.idbtrans;else try{M.create(),M.idbtrans._explicit=!0,D._state.PR1398_maxLoop=3}catch(K){return K.name===De.InvalidState&&D.isOpen()&&0<--D._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),D.close({disableAutoOpen:!1}),D.open().then(function(){return P(D,S,U,null,x)})):Bt(K)}var G,z=fe(x);return z&&Rn(),B=ot.follow(function(){var K;(G=x.call(M,M))&&(z?(K=Ke.bind(null,null),G.then(K,K)):typeof G.next=="function"&&typeof G.throw=="function"&&(G=Fs(G)))},B),(G&&typeof G.then=="function"?ot.resolve(G).then(function(K){return M.active?K:Bt(new ct.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):B.then(function(){return G})).then(function(K){return b&&M._resolve(),M._completion.then(function(){return K})}).catch(function(K){return M._reject(K),Bt(K)})})}).bind(null,this,m,g,E,l);return E?E._promise(m,N,"lock"):ht.trans?an(ht.transless,function(){return d._whenReady(N)}):this._whenReady(N)},Yt.prototype.table=function(r){if(!I(this._allTables,r))throw new ct.InvalidTable("Table ".concat(r," does not exist"));return this._allTables[r]},Yt);function Yt(r,i){var l=this;this._middlewares={},this.verno=0;var d=Yt.dependencies;this._options=i=n({addons:Yt.addons,autoOpen:!0,indexedDB:d.indexedDB,IDBKeyRange:d.IDBKeyRange,cache:"cloned"},i),this._deps={indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},d=i.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var E,m,g,O,N,P={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Ot,dbReadyPromise:null,cancelOpen:Ot,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:i.autoOpen};P.dbReadyPromise=new ot(function(S){P.dbReadyResolve=S}),P.openCanceller=new ot(function(S,U){P.cancelOpen=U}),this._state=P,this.name=r,this.on=cr(this,"populate","blocked","versionchange","close",{ready:[Xi,Ot]}),this.on.ready.subscribe=Y(this.on.ready.subscribe,function(S){return function(U,b){Yt.vip(function(){var x,B=l._state;B.openComplete?(B.dbOpenError||ot.resolve().then(U),b&&S(U)):B.onReadyBeingFired?(B.onReadyBeingFired.push(U),b&&S(U)):(S(U),x=l,b||S(function M(){x.on.ready.unsubscribe(U),x.on.ready.unsubscribe(M)}))})}}),this.Collection=(E=this,hr(Jl.prototype,function(G,M){this.db=E;var b=ko,x=null;if(M)try{b=M()}catch(z){x=z}var B=G._ctx,M=B.table,G=M.hook.reading.fire;this._ctx={table:M,index:B.index,isPrimKey:!B.index||M.schema.primKey.keyPath&&B.index===M.schema.primKey.name,range:b,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:x,or:B.or,valueMapper:G!==Oe?G:null}})),this.Table=(m=this,hr(Ho.prototype,function(S,U,b){this.db=m,this._tx=b,this.name=S,this.schema=U,this.hook=m._allTables[S]?m._allTables[S].hook:cr(null,{creating:[nr,Ot],reading:[Wi,Oe],updating:[Wl,Ot],deleting:[rr,Ot]})})),this.Transaction=(g=this,hr(nc.prototype,function(S,U,b,x,B){var M=this;this.db=g,this.mode=S,this.storeNames=U,this.schema=b,this.chromeTransactionDurability=x,this.idbtrans=null,this.on=cr(this,"complete","error","abort"),this.parent=B||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new ot(function(G,z){M._resolve=G,M._reject=z}),this._completion.then(function(){M.active=!1,M.on.complete.fire()},function(G){var z=M.active;return M.active=!1,M.on.error.fire(G),M.parent?M.parent._reject(G):z&&M.idbtrans&&M.idbtrans.abort(),Bt(G)})})),this.Version=(O=this,hr(cc.prototype,function(S){this.db=O,this._cfg={version:S,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(N=this,hr(qo.prototype,function(S,U,b){if(this.db=N,this._ctx={table:S,index:U===":id"?null:U,or:b},this._cmp=this._ascending=_t,this._descending=function(x,B){return _t(B,x)},this._max=function(x,B){return 0<_t(x,B)?x:B},this._min=function(x,B){return _t(x,B)<0?x:B},this._IDBKeyRange=N._deps.IDBKeyRange,!this._IDBKeyRange)throw new ct.MissingAPI})),this.on("versionchange",function(S){0<S.newVersion?console.warn("Another connection wants to upgrade database '".concat(l.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(l.name,"'. Closing db now to resume the delete request.")),l.close({disableAutoOpen:!1})}),this.on("blocked",function(S){!S.newVersion||S.newVersion<S.oldVersion?console.warn("Dexie.delete('".concat(l.name,"') was blocked")):console.warn("Upgrade '".concat(l.name,"' blocked by other connection holding version ").concat(S.oldVersion/10))}),this._maxKey=pr(i.IDBKeyRange),this._createTransaction=function(S,U,b,x){return new l.Transaction(S,U,b,l._options.chromeTransactionDurability,x)},this._fireOnBlocked=function(S){l.on("blocked").fire(S),An.filter(function(U){return U.name===l.name&&U!==l&&!U._state.vcFired}).map(function(U){return U.on("versionchange").fire(S)})},this.use(pc),this.use(mc),this.use(Ec),this.use(uc),this.use(dc);var D=new Proxy(this,{get:function(S,U,b){if(U==="_vip")return!0;if(U==="table")return function(B){return ci(l.table(B),D)};var x=Reflect.get(S,U,b);return x instanceof Ho?ci(x,D):U==="tables"?x.map(function(B){return ci(B,D)}):U==="_createTransaction"?function(){return ci(x.apply(this,arguments),D)}:x}});this.vip=D,d.forEach(function(S){return S(l)})}var hi,ce=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Cc=(vs.prototype.subscribe=function(r,i,l){return this._subscribe(r&&typeof r!="function"?r:{next:r,error:i,complete:l})},vs.prototype[ce]=function(){return this},vs);function vs(r){this._subscribe=r}try{hi={indexedDB:o.indexedDB||o.mozIndexedDB||o.webkitIndexedDB||o.msIndexedDB,IDBKeyRange:o.IDBKeyRange||o.webkitIDBKeyRange}}catch{hi={indexedDB:null,IDBKeyRange:null}}function ca(r){var i,l=!1,d=new Cc(function(E){var m=fe(r),g,O=!1,N={},P={},D={get closed(){return O},unsubscribe:function(){O||(O=!0,g&&g.abort(),S&&je.storagemutated.unsubscribe(b))}};E.start&&E.start(D);var S=!1,U=function(){return es(x)},b=function(B){oi(N,B),gs(P,N)&&U()},x=function(){var B,M,G;!O&&hi.indexedDB&&(N={},B={},g&&g.abort(),g=new AbortController,G=function(z){var K=gn();try{m&&Rn();var W=He(r,z);return W=m?W.finally(Ke):W}finally{K&&yn()}}(M={subscr:B,signal:g.signal,requery:U,querier:r,trans:null}),Promise.resolve(G).then(function(z){l=!0,i=z,O||M.signal.aborted||(N={},function(K){for(var W in K)if(I(K,W))return;return 1}(P=B)||S||(je(dr,b),S=!0),es(function(){return!O&&E.next&&E.next(z)}))},function(z){l=!1,["DatabaseClosedError","AbortError"].includes(z==null?void 0:z.name)||O||es(function(){O||E.error&&E.error(z)})}))};return setTimeout(U,0),D});return d.hasValue=function(){return l},d.getValue=function(){return i},d}var un=Ye;function Ss(r){var i=qe;try{qe=!0,je.storagemutated.fire(r),As(r,!0)}finally{qe=i}}f(un,n(n({},Ie),{delete:function(r){return new un(r,{addons:[]}).delete()},exists:function(r){return new un(r,{addons:[]}).open().then(function(i){return i.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(r){try{return i=un.dependencies,l=i.indexedDB,i=i.IDBKeyRange,(Is(l)?Promise.resolve(l.databases()).then(function(d){return d.map(function(E){return E.name}).filter(function(E){return E!==jr})}):fs(l,i).toCollection().primaryKeys()).then(r)}catch{return Bt(new ct.MissingAPI)}var i,l},defineClass:function(){return function(r){h(this,r)}},ignoreTransaction:function(r){return ht.trans?an(ht.transless,r):r()},vip:ms,async:function(r){return function(){try{var i=Fs(r.apply(this,arguments));return i&&typeof i.then=="function"?i:ot.resolve(i)}catch(l){return Bt(l)}}},spawn:function(r,i,l){try{var d=Fs(r.apply(l,i||[]));return d&&typeof d.then=="function"?d:ot.resolve(d)}catch(E){return Bt(E)}},currentTransaction:{get:function(){return ht.trans||null}},waitFor:function(r,i){return i=ot.resolve(typeof r=="function"?un.ignoreTransaction(r):r).timeout(i||6e4),ht.trans?ht.trans.waitFor(i):i},Promise:ot,debug:{get:function(){return we},set:function(r){Lo(r)}},derive:F,extend:h,props:f,override:Y,Events:cr,on:je,liveQuery:ca,extendObservabilitySet:oi,getByKeyPath:k,setByKeyPath:V,delByKeyPath:function(r,i){typeof i=="string"?V(r,i,void 0):"length"in i&&[].map.call(i,function(l){V(r,l,void 0)})},shallowClone:H,deepClone:nt,getObjectDiff:_s,cmp:_t,asap:L,minKey:-1/0,addons:[],connections:An,errnames:De,dependencies:hi,cache:hn,semVer:"4.0.4",version:"4.0.4".split(".").map(function(r){return parseInt(r)}).reduce(function(r,i,l){return r+i/Math.pow(10,2*l)})})),un.maxKey=pr(un.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(je(dr,function(r){qe||(r=new CustomEvent(ls,{detail:r}),qe=!0,dispatchEvent(r),qe=!1)}),addEventListener(ls,function(r){r=r.detail,qe||Ss(r)}));var On,qe=!1,ha=function(){};return typeof BroadcastChannel<"u"&&((ha=function(){(On=new BroadcastChannel(ls)).onmessage=function(r){return r.data&&Ss(r.data)}})(),typeof On.unref=="function"&&On.unref(),je(dr,function(r){qe||On.postMessage(r)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(r){if(!Ye.disableBfCache&&r.persisted){we&&console.debug("Dexie: handling persisted pagehide"),On!=null&&On.close();for(var i=0,l=An;i<l.length;i++)l[i].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(r){!Ye.disableBfCache&&r.persisted&&(we&&console.debug("Dexie: handling persisted pageshow"),ha(),Ss({all:new Xt(-1/0,[[]])}))})),ot.rejectionMapper=function(r,i){return!r||r instanceof le||r instanceof TypeError||r instanceof SyntaxError||!r.name||!xt[r.name]?r:(i=new xt[r.name](i||r.message,r),"stack"in r&&A(i,"stack",{get:function(){return this.inner.stack}}),i)},Lo(we),n(Ye,Object.freeze({__proto__:null,Dexie:Ye,liveQuery:ca,Entity:Go,cmp:_t,PropModSymbol:Be,PropModification:os,replacePrefix:function(r,i){return new os({replacePrefix:[r,i]})},default:Ye,RangeSet:Xt,mergeRanges:Ir,rangesOverlap:si}),{default:Ye}),Ye})})(Hl);var Zu=Hl.exports;const To=zc(Zu),il=Symbol.for("Dexie"),sl=globalThis[il]||(globalThis[il]=To);if(To.semVer!==sl.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${To.semVer} and ${sl.semVer}`);const Qu=document.getElementById("container"),Cn=new wl,$u=Cn.get(Ml),tr=$u.create();tr.scene=new pu(Cn);tr.renderer=new qu(Cn,Qu);tr.camera=new Ur(Cn);Cn.init();tr.camera.controls.setLookAt(5,5,5,0,0,0);const Ju=Cn.get(xl);Ju.create(tr);const Kl=Cn.get(Co);Kl.threshold=10;for(let u=0;u<20;u++){const t=Math.random()*5,e=Math.random()*5,n=Math.random()*5;Kl.create(tr,"🚀",new q(t,e,n))}
