var yc=Object.defineProperty;var Rc=(u,t,e)=>t in u?yc(u,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[t]=e;var Wt=(u,t,e)=>(Rc(u,typeof t!="symbol"?t+"":t,e),e);import{L as Me,B as $t,T as Hn,R as go,E as Ac,M as Mt,V as q,a as Fe,P as Hi,S as yo,b as lt,C as Wn,c as Dr,D as Fc,A as _c,d as Oc,e as wc,f as Sc,Q as Ae,g as vc,h as ol,i as Pc,j as jn,W as to,k as Ro,l as bc,m as kr,n as qn,I as Zn,o as Cn,p as Zt,q as Ao,r as al,s as ll,t as Fo,u as cl,v as hl,w as Qn,x as ua,y as ul,z as tr,F as $n,G as Re,H as Nc,J as pi,K as Gi,N as ne,O as Ur,U as Ns,X as dl,Y as Lc,Z as Mc,_ as pl,$ as xc,a0 as El,a1 as fl,a2 as Il,a3 as ml,a4 as da,a5 as Dc,a6 as pa,a7 as Ei,a8 as Ze,a9 as Uc,aa as Tr,ab as Bc,ac as Yc,ad as kc}from"./unzipit.module-iWfmgAo3.js";import{S as Cl,F as Tl,a as Gc,C as Vc,A as zc}from"./serializer-BO7WT2WR.js";import{S as Hc}from"./stream-serializer-EnUgg3a0.js";import{c as Ea,g as Kc}from"./_commonjsHelpers-Cpj98o6Y.js";var Wc=Object.defineProperty,Xc=(u,t,e)=>t in u?Wc(u,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[t]=e,y=(u,t,e)=>(Xc(u,typeof t!="symbol"?t+"":t,e),e);const gl=0,jc=1,qc=2,fa=2,Ls=1.25,Ia=1,Bi=6*4+4+4,Ki=65535,Zc=Math.pow(2,-24),Ms=Symbol("SKIP_GENERATION");function Qc(u){return u.index?u.index.count:u.attributes.position.count}function er(u){return Qc(u)/3}function $c(u,t=ArrayBuffer){return u>65535?new Uint32Array(new t(4*u)):new Uint16Array(new t(2*u))}function Jc(u,t){if(!u.index){const e=u.attributes.position.count,n=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,i=$c(e,n);u.setIndex(new $n(i,1));for(let o=0;o<e;o++)i[o]=o}}function yl(u){const t=er(u),e=u.drawRange,n=e.start/3,i=(e.start+e.count)/3,o=Math.max(0,n),a=Math.min(t,i)-o;return[{offset:Math.floor(o),count:Math.floor(a)}]}function Rl(u){if(!u.groups||!u.groups.length)return yl(u);const t=[],e=new Set,n=u.drawRange,i=n.start/3,o=(n.start+n.count)/3;for(const l of u.groups){const h=l.start/3,p=(l.start+l.count)/3;e.add(Math.max(i,h)),e.add(Math.min(o,p))}const a=Array.from(e.values()).sort((l,h)=>l-h);for(let l=0;l<a.length-1;l++){const h=a[l],p=a[l+1];t.push({offset:Math.floor(h),count:Math.floor(p-h)})}return t}function th(u){if(u.groups.length===0)return!1;const t=er(u),e=Rl(u).sort((o,a)=>o.offset-a.offset),n=e[e.length-1];n.count=Math.min(t-n.offset,n.count);let i=0;return e.forEach(({count:o})=>i+=o),t!==i}function Dt(u,t,e){return e.min.x=t[u],e.min.y=t[u+1],e.min.z=t[u+2],e.max.x=t[u+3],e.max.y=t[u+4],e.max.z=t[u+5],e}function eh(u){u[0]=u[1]=u[2]=1/0,u[3]=u[4]=u[5]=-1/0}function ma(u){let t=-1,e=-1/0;for(let n=0;n<3;n++){const i=u[n+3]-u[n];i>e&&(e=i,t=n)}return t}function Ca(u,t){t.set(u)}function Ta(u,t,e){let n,i;for(let o=0;o<3;o++){const a=o+3;n=u[o],i=t[o],e[o]=n<i?n:i,n=u[a],i=t[a],e[a]=n>i?n:i}}function fi(u,t,e){for(let n=0;n<3;n++){const i=t[u+2*n],o=t[u+2*n+1],a=i-o,l=i+o;a<e[n]&&(e[n]=a),l>e[n+3]&&(e[n+3]=l)}}function gr(u){const t=u[3]-u[0],e=u[4]-u[1],n=u[5]-u[2];return 2*(t*e+e*n+n*t)}function xs(u,t,e,n,i=null){let o=1/0,a=1/0,l=1/0,h=-1/0,p=-1/0,m=-1/0,I=1/0,f=1/0,T=1/0,A=-1/0,F=-1/0,_=-1/0;const w=i!==null;for(let S=t*6,Y=(t+e)*6;S<Y;S+=6){const R=u[S+0],L=u[S+1],k=R-L,V=R+L;k<o&&(o=k),V>h&&(h=V),w&&R<I&&(I=R),w&&R>A&&(A=R);const H=u[S+2],j=u[S+3],Q=H-j,J=H+j;Q<a&&(a=Q),J>p&&(p=J),w&&H<f&&(f=H),w&&H>F&&(F=H);const $=u[S+4],nt=u[S+5],ut=$-nt,It=$+nt;ut<l&&(l=ut),It>m&&(m=It),w&&$<T&&(T=$),w&&$>_&&(_=$)}n[0]=o,n[1]=a,n[2]=l,n[3]=h,n[4]=p,n[5]=m,w&&(i[0]=I,i[1]=f,i[2]=T,i[3]=A,i[4]=F,i[5]=_)}function nh(u,t,e,n){let i=1/0,o=1/0,a=1/0,l=-1/0,h=-1/0,p=-1/0;for(let m=t*6,I=(t+e)*6;m<I;m+=6){const f=u[m+0];f<i&&(i=f),f>l&&(l=f);const T=u[m+2];T<o&&(o=T),T>h&&(h=T);const A=u[m+4];A<a&&(a=A),A>p&&(p=A)}n[0]=i,n[1]=o,n[2]=a,n[3]=l,n[4]=h,n[5]=p}function rh(u,t){eh(t);const e=u.attributes.position,n=u.index?u.index.array:null,i=er(u),o=new Float32Array(i*6),a=e.normalized,l=e.array,h=e.offset||0;let p=3;e.isInterleavedBufferAttribute&&(p=e.data.stride);const m=["getX","getY","getZ"];for(let I=0;I<i;I++){const f=I*3,T=I*6;let A=f+0,F=f+1,_=f+2;n&&(A=n[A],F=n[F],_=n[_]),a||(A=A*p+h,F=F*p+h,_=_*p+h);for(let w=0;w<3;w++){let S,Y,R;a?(S=e[m[w]](A),Y=e[m[w]](F),R=e[m[w]](_)):(S=l[A+w],Y=l[F+w],R=l[_+w]);let L=S;Y<L&&(L=Y),R<L&&(L=R);let k=S;Y>k&&(k=Y),R>k&&(k=R);const V=(k-L)/2,H=w*2;o[T+H+0]=L+V,o[T+H+1]=V+(Math.abs(L)+V)*Zc,L<t[w]&&(t[w]=L),k>t[w+3]&&(t[w+3]=k)}}return o}const ke=32,ih=(u,t)=>u.candidate-t.candidate,Qe=new Array(ke).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),Ii=new Float32Array(6);function sh(u,t,e,n,i,o){let a=-1,l=0;if(o===gl)a=ma(t),a!==-1&&(l=(t[a]+t[a+3])/2);else if(o===jc)a=ma(u),a!==-1&&(l=oh(e,n,i,a));else if(o===qc){const h=gr(u);let p=Ls*i;const m=n*6,I=(n+i)*6;for(let f=0;f<3;f++){const T=t[f],A=(t[f+3]-T)/ke;if(i<ke/4){const F=[...Qe];F.length=i;let _=0;for(let S=m;S<I;S+=6,_++){const Y=F[_];Y.candidate=e[S+2*f],Y.count=0;const{bounds:R,leftCacheBounds:L,rightCacheBounds:k}=Y;for(let V=0;V<3;V++)k[V]=1/0,k[V+3]=-1/0,L[V]=1/0,L[V+3]=-1/0,R[V]=1/0,R[V+3]=-1/0;fi(S,e,R)}F.sort(ih);let w=i;for(let S=0;S<w;S++){const Y=F[S];for(;S+1<w&&F[S+1].candidate===Y.candidate;)F.splice(S+1,1),w--}for(let S=m;S<I;S+=6){const Y=e[S+2*f];for(let R=0;R<w;R++){const L=F[R];Y>=L.candidate?fi(S,e,L.rightCacheBounds):(fi(S,e,L.leftCacheBounds),L.count++)}}for(let S=0;S<w;S++){const Y=F[S],R=Y.count,L=i-Y.count,k=Y.leftCacheBounds,V=Y.rightCacheBounds;let H=0;R!==0&&(H=gr(k)/h);let j=0;L!==0&&(j=gr(V)/h);const Q=Ia+Ls*(H*R+j*L);Q<p&&(a=f,p=Q,l=Y.candidate)}}else{for(let w=0;w<ke;w++){const S=Qe[w];S.count=0,S.candidate=T+A+w*A;const Y=S.bounds;for(let R=0;R<3;R++)Y[R]=1/0,Y[R+3]=-1/0}for(let w=m;w<I;w+=6){let S=~~((e[w+2*f]-T)/A);S>=ke&&(S=ke-1);const Y=Qe[S];Y.count++,fi(w,e,Y.bounds)}const F=Qe[ke-1];Ca(F.bounds,F.rightCacheBounds);for(let w=ke-2;w>=0;w--){const S=Qe[w],Y=Qe[w+1];Ta(S.bounds,Y.rightCacheBounds,S.rightCacheBounds)}let _=0;for(let w=0;w<ke-1;w++){const S=Qe[w],Y=S.count,R=S.bounds,L=Qe[w+1].rightCacheBounds;Y!==0&&(_===0?Ca(R,Ii):Ta(R,Ii,Ii)),_+=Y;let k=0,V=0;_!==0&&(k=gr(Ii)/h);const H=i-_;H!==0&&(V=gr(L)/h);const j=Ia+Ls*(k*_+V*H);j<p&&(a=f,p=j,l=S.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${o} used.`);return{axis:a,pos:l}}function oh(u,t,e,n){let i=0;for(let o=t,a=t+e;o<a;o++)i+=u[o*6+n*2];return i/e}class mi{constructor(){}}function ah(u,t,e,n,i,o){let a=n,l=n+i-1;const h=o.pos,p=o.axis*2;for(;;){for(;a<=l&&e[a*6+p]<h;)a++;for(;a<=l&&e[l*6+p]>=h;)l--;if(a<l){for(let m=0;m<3;m++){let I=t[a*3+m];t[a*3+m]=t[l*3+m],t[l*3+m]=I}for(let m=0;m<6;m++){let I=e[a*6+m];e[a*6+m]=e[l*6+m],e[l*6+m]=I}a++,l--}else return a}}function lh(u,t,e,n,i,o){let a=n,l=n+i-1;const h=o.pos,p=o.axis*2;for(;;){for(;a<=l&&e[a*6+p]<h;)a++;for(;a<=l&&e[l*6+p]>=h;)l--;if(a<l){let m=u[a];u[a]=u[l],u[l]=m;for(let I=0;I<6;I++){let f=e[a*6+I];e[a*6+I]=e[l*6+I],e[l*6+I]=f}a++,l--}else return a}}function ch(u,t){const e=(u.index?u.index.count:u.attributes.position.count)/3,n=e>2**16,i=n?4:2,o=t?new SharedArrayBuffer(e*i):new ArrayBuffer(e*i),a=n?new Uint32Array(o):new Uint16Array(o);for(let l=0,h=a.length;l<h;l++)a[l]=l;return a}function hh(u,t){const e=u.geometry,n=e.index?e.index.array:null,i=t.maxDepth,o=t.verbose,a=t.maxLeafTris,l=t.strategy,h=t.onProgress,p=er(e),m=u._indirectBuffer;let I=!1;const f=new Float32Array(6),T=new Float32Array(6),A=rh(e,f),F=t.indirect?lh:ah,_=[],w=t.indirect?yl(e):Rl(e);if(w.length===1){const R=w[0],L=new mi;L.boundingData=f,nh(A,R.offset,R.count,T),Y(L,R.offset,R.count,T),_.push(L)}else for(let R of w){const L=new mi;L.boundingData=new Float32Array(6),xs(A,R.offset,R.count,L.boundingData,T),Y(L,R.offset,R.count,T),_.push(L)}return _;function S(R){h&&h(R/p)}function Y(R,L,k,V=null,H=0){if(!I&&H>=i&&(I=!0,o&&(console.warn(`MeshBVH: Max depth of ${i} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),k<=a||H>=i)return S(L+k),R.offset=L,R.count=k,R;const j=sh(R.boundingData,V,A,L,k,l);if(j.axis===-1)return S(L+k),R.offset=L,R.count=k,R;const Q=F(m,n,A,L,k,j);if(Q===L||Q===L+k)S(L+k),R.offset=L,R.count=k;else{R.splitAxis=j.axis;const J=new mi,$=L,nt=Q-L;R.left=J,J.boundingData=new Float32Array(6),xs(A,$,nt,J.boundingData,T),Y(J,$,nt,T,H+1);const ut=new mi,It=Q,yt=k-nt;R.right=ut,ut.boundingData=new Float32Array(6),xs(A,It,yt,ut.boundingData,T),Y(ut,It,yt,T,H+1)}return R}}function uh(u,t){const e=u.geometry;t.indirect&&(u._indirectBuffer=ch(e,t.useSharedArrayBuffer),th(e)&&!t.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),u._indirectBuffer||Jc(e,t);const n=hh(u,t);let i,o,a;const l=[],h=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let I=0;I<n.length;I++){const f=n[I];let T=p(f);const A=new h(Bi*T);i=new Float32Array(A),o=new Uint32Array(A),a=new Uint16Array(A),m(0,f),l.push(A)}u._roots=l;return;function p(I){return I.count?1:1+p(I.left)+p(I.right)}function m(I,f){const T=I/4,A=I/2,F=!!f.count,_=f.boundingData;for(let w=0;w<6;w++)i[T+w]=_[w];if(F){const w=f.offset,S=f.count;return o[T+6]=w,a[A+14]=S,a[A+15]=Ki,I+Bi}else{const w=f.left,S=f.right,Y=f.splitAxis;let R;if(R=m(I+Bi,w),R/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return o[T+6]=R/4,R=m(R,S),o[T+7]=Y,R}}}class Ve{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let n=1/0,i=-1/0;for(let o=0,a=t.length;o<a;o++){const l=t[o][e];n=l<n?l:n,i=l>i?l:i}this.min=n,this.max=i}setFromPoints(t,e){let n=1/0,i=-1/0;for(let o=0,a=e.length;o<a;o++){const l=e[o],h=t.dot(l);n=h<n?h:n,i=h>i?h:i}this.min=n,this.max=i}isSeparated(t){return this.min>t.max||t.min>this.max}}Ve.prototype.setFromBox=function(){const u=new q;return function(t,e){const n=e.min,i=e.max;let o=1/0,a=-1/0;for(let l=0;l<=1;l++)for(let h=0;h<=1;h++)for(let p=0;p<=1;p++){u.x=n.x*l+i.x*(1-l),u.y=n.y*h+i.y*(1-h),u.z=n.z*p+i.z*(1-p);const m=t.dot(u);o=Math.min(m,o),a=Math.max(m,a)}this.min=o,this.max=a}}();const dh=function(){const u=new q,t=new q,e=new q;return function(n,i,o){const a=n.start,l=u,h=i.start,p=t;e.subVectors(a,h),u.subVectors(n.end,n.start),t.subVectors(i.end,i.start);const m=e.dot(p),I=p.dot(l),f=p.dot(p),T=e.dot(l),A=l.dot(l)*f-I*I;let F,_;A!==0?F=(m*I-T*f)/A:F=0,_=(m+F*I)/f,o.x=F,o.y=_}}(),_o=function(){const u=new Fe,t=new q,e=new q;return function(n,i,o,a){dh(n,i,u);let l=u.x,h=u.y;if(l>=0&&l<=1&&h>=0&&h<=1){n.at(l,o),i.at(h,a);return}else if(l>=0&&l<=1){h<0?i.at(0,a):i.at(1,a),n.closestPointToPoint(a,!0,o);return}else if(h>=0&&h<=1){l<0?n.at(0,o):n.at(1,o),i.closestPointToPoint(o,!0,a);return}else{let p;l<0?p=n.start:p=n.end;let m;h<0?m=i.start:m=i.end;const I=t,f=e;if(n.closestPointToPoint(m,!0,t),i.closestPointToPoint(p,!0,e),I.distanceToSquared(m)<=f.distanceToSquared(p)){o.copy(I),a.copy(m);return}else{o.copy(p),a.copy(f);return}}}}(),ph=function(){const u=new q,t=new q,e=new Hi,n=new Me;return function(i,o){const{radius:a,center:l}=i,{a:h,b:p,c:m}=o;if(n.start=h,n.end=p,n.closestPointToPoint(l,!0,u).distanceTo(l)<=a||(n.start=h,n.end=m,n.closestPointToPoint(l,!0,u).distanceTo(l)<=a)||(n.start=p,n.end=m,n.closestPointToPoint(l,!0,u).distanceTo(l)<=a))return!0;const I=o.getPlane(e);if(Math.abs(I.distanceToPoint(l))<=a){const f=I.projectPoint(l,t);if(o.containsPoint(f))return!0}return!1}}(),Eh=1e-15;function Ds(u){return Math.abs(u)<Eh}class _e extends Hn{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new q),this.satBounds=new Array(4).fill().map(()=>new Ve),this.points=[this.a,this.b,this.c],this.sphere=new yo,this.plane=new Hi,this.needsUpdate=!0}intersectsSphere(t){return ph(t,this)}update(){const t=this.a,e=this.b,n=this.c,i=this.points,o=this.satAxes,a=this.satBounds,l=o[0],h=a[0];this.getNormal(l),h.setFromPoints(l,i);const p=o[1],m=a[1];p.subVectors(t,e),m.setFromPoints(p,i);const I=o[2],f=a[2];I.subVectors(e,n),f.setFromPoints(I,i);const T=o[3],A=a[3];T.subVectors(n,t),A.setFromPoints(T,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(l,t),this.needsUpdate=!1}}_e.prototype.closestPointToSegment=function(){const u=new q,t=new q,e=new Me;return function(n,i=null,o=null){const{start:a,end:l}=n,h=this.points;let p,m=1/0;for(let I=0;I<3;I++){const f=(I+1)%3;e.start.copy(h[I]),e.end.copy(h[f]),_o(e,n,u,t),p=u.distanceToSquared(t),p<m&&(m=p,i&&i.copy(u),o&&o.copy(t))}return this.closestPointToPoint(a,u),p=a.distanceToSquared(u),p<m&&(m=p,i&&i.copy(u),o&&o.copy(a)),this.closestPointToPoint(l,u),p=l.distanceToSquared(u),p<m&&(m=p,i&&i.copy(u),o&&o.copy(l)),Math.sqrt(m)}}();_e.prototype.intersectsTriangle=function(){const u=new _e,t=new Array(3),e=new Array(3),n=new Ve,i=new Ve,o=new q,a=new q,l=new q,h=new q,p=new q,m=new Me,I=new Me,f=new Me,T=new q;function A(F,_,w){const S=F.points;let Y=0,R=-1;for(let L=0;L<3;L++){const{start:k,end:V}=m;k.copy(S[L]),V.copy(S[(L+1)%3]),m.delta(a);const H=Ds(_.distanceToPoint(k));if(Ds(_.normal.dot(a))&&H){w.copy(m),Y=2;break}const j=_.intersectLine(m,T);if(!j&&H&&T.copy(k),(j||H)&&!Ds(T.distanceTo(V))){if(Y<=1)(Y===1?w.start:w.end).copy(T),H&&(R=Y);else if(Y>=2){(R===1?w.start:w.end).copy(T),Y=2;break}if(Y++,Y===2&&R===-1)break}}return Y}return function(F,_=null,w=!1){this.needsUpdate&&this.update(),F.isExtendedTriangle?F.needsUpdate&&F.update():(u.copy(F),u.update(),F=u);const S=this.plane,Y=F.plane;if(Math.abs(S.normal.dot(Y.normal))>1-1e-10){const R=this.satBounds,L=this.satAxes;e[0]=F.a,e[1]=F.b,e[2]=F.c;for(let H=0;H<4;H++){const j=R[H],Q=L[H];if(n.setFromPoints(Q,e),j.isSeparated(n))return!1}const k=F.satBounds,V=F.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let H=0;H<4;H++){const j=k[H],Q=V[H];if(n.setFromPoints(Q,t),j.isSeparated(n))return!1}for(let H=0;H<4;H++){const j=L[H];for(let Q=0;Q<4;Q++){const J=V[Q];if(o.crossVectors(j,J),n.setFromPoints(o,t),i.setFromPoints(o,e),n.isSeparated(i))return!1}}return _&&(w||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),_.start.set(0,0,0),_.end.set(0,0,0)),!0}else{const R=A(this,Y,I);if(R===1&&F.containsPoint(I.end))return _&&(_.start.copy(I.end),_.end.copy(I.end)),!0;if(R!==2)return!1;const L=A(F,S,f);if(L===1&&this.containsPoint(f.end))return _&&(_.start.copy(f.end),_.end.copy(f.end)),!0;if(L!==2)return!1;if(I.delta(l),f.delta(h),l.dot(h)<0){let $=f.start;f.start=f.end,f.end=$}const k=I.start.dot(l),V=I.end.dot(l),H=f.start.dot(l),j=f.end.dot(l),Q=V<H,J=k<j;return k!==j&&H!==V&&Q===J?!1:(_&&(p.subVectors(I.start,f.start),p.dot(l)>0?_.start.copy(I.start):_.start.copy(f.start),p.subVectors(I.end,f.end),p.dot(l)<0?_.end.copy(I.end):_.end.copy(f.end)),!0)}}}();_e.prototype.distanceToPoint=function(){const u=new q;return function(t){return this.closestPointToPoint(t,u),t.distanceTo(u)}}();_e.prototype.distanceToTriangle=function(){const u=new q,t=new q,e=["a","b","c"],n=new Me,i=new Me;return function(o,a=null,l=null){const h=a||l?n:null;if(this.intersectsTriangle(o,h))return(a||l)&&(a&&h.getCenter(a),l&&h.getCenter(l)),0;let p=1/0;for(let m=0;m<3;m++){let I;const f=e[m],T=o[f];this.closestPointToPoint(T,u),I=T.distanceToSquared(u),I<p&&(p=I,a&&a.copy(u),l&&l.copy(T));const A=this[f];o.closestPointToPoint(A,u),I=A.distanceToSquared(u),I<p&&(p=I,a&&a.copy(A),l&&l.copy(u))}for(let m=0;m<3;m++){const I=e[m],f=e[(m+1)%3];n.set(this[I],this[f]);for(let T=0;T<3;T++){const A=e[T],F=e[(T+1)%3];i.set(o[A],o[F]),_o(n,i,u,t);const _=u.distanceToSquared(t);_<p&&(p=_,a&&a.copy(u),l&&l.copy(t))}}return Math.sqrt(p)}}();class re{constructor(t,e,n){this.isOrientedBox=!0,this.min=new q,this.max=new q,this.matrix=new Mt,this.invMatrix=new Mt,this.points=new Array(8).fill().map(()=>new q),this.satAxes=new Array(3).fill().map(()=>new q),this.satBounds=new Array(3).fill().map(()=>new Ve),this.alignedSatBounds=new Array(3).fill().map(()=>new Ve),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),n&&this.matrix.copy(n)}set(t,e,n){this.min.copy(t),this.max.copy(e),this.matrix.copy(n),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}}re.prototype.update=function(){return function(){const u=this.matrix,t=this.min,e=this.max,n=this.points;for(let h=0;h<=1;h++)for(let p=0;p<=1;p++)for(let m=0;m<=1;m++){const I=1*h|2*p|4*m,f=n[I];f.x=h?e.x:t.x,f.y=p?e.y:t.y,f.z=m?e.z:t.z,f.applyMatrix4(u)}const i=this.satBounds,o=this.satAxes,a=n[0];for(let h=0;h<3;h++){const p=o[h],m=i[h],I=1<<h,f=n[I];p.subVectors(a,f),m.setFromPoints(p,n)}const l=this.alignedSatBounds;l[0].setFromPointsField(n,"x"),l[1].setFromPointsField(n,"y"),l[2].setFromPointsField(n,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();re.prototype.intersectsBox=function(){const u=new Ve;return function(t){this.needsUpdate&&this.update();const e=t.min,n=t.max,i=this.satBounds,o=this.satAxes,a=this.alignedSatBounds;if(u.min=e.x,u.max=n.x,a[0].isSeparated(u)||(u.min=e.y,u.max=n.y,a[1].isSeparated(u))||(u.min=e.z,u.max=n.z,a[2].isSeparated(u)))return!1;for(let l=0;l<3;l++){const h=o[l],p=i[l];if(u.setFromBox(h,t),p.isSeparated(u))return!1}return!0}}();re.prototype.intersectsTriangle=function(){const u=new _e,t=new Array(3),e=new Ve,n=new Ve,i=new q;return function(o){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(u.copy(o),u.update(),o=u);const a=this.satBounds,l=this.satAxes;t[0]=o.a,t[1]=o.b,t[2]=o.c;for(let I=0;I<3;I++){const f=a[I],T=l[I];if(e.setFromPoints(T,t),f.isSeparated(e))return!1}const h=o.satBounds,p=o.satAxes,m=this.points;for(let I=0;I<3;I++){const f=h[I],T=p[I];if(e.setFromPoints(T,m),f.isSeparated(e))return!1}for(let I=0;I<3;I++){const f=l[I];for(let T=0;T<4;T++){const A=p[T];if(i.crossVectors(f,A),e.setFromPoints(i,t),n.setFromPoints(i,m),e.isSeparated(n))return!1}}return!0}}();re.prototype.closestPointToPoint=function(){return function(u,t){return this.needsUpdate&&this.update(),t.copy(u).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}();re.prototype.distanceToPoint=function(){const u=new q;return function(t){return this.closestPointToPoint(t,u),t.distanceTo(u)}}();re.prototype.distanceToBox=function(){const u=["x","y","z"],t=new Array(12).fill().map(()=>new Me),e=new Array(12).fill().map(()=>new Me),n=new q,i=new q;return function(o,a=0,l=null,h=null){if(this.needsUpdate&&this.update(),this.intersectsBox(o))return(l||h)&&(o.getCenter(i),this.closestPointToPoint(i,n),o.closestPointToPoint(n,i),l&&l.copy(n),h&&h.copy(i)),0;const p=a*a,m=o.min,I=o.max,f=this.points;let T=1/0;for(let F=0;F<8;F++){const _=f[F];i.copy(_).clamp(m,I);const w=_.distanceToSquared(i);if(w<T&&(T=w,l&&l.copy(_),h&&h.copy(i),w<p))return Math.sqrt(w)}let A=0;for(let F=0;F<3;F++)for(let _=0;_<=1;_++)for(let w=0;w<=1;w++){const S=(F+1)%3,Y=(F+2)%3,R=_<<S|w<<Y,L=1<<F|_<<S|w<<Y,k=f[R],V=f[L];t[A].set(k,V);const H=u[F],j=u[S],Q=u[Y],J=e[A],$=J.start,nt=J.end;$[H]=m[H],$[j]=_?m[j]:I[j],$[Q]=w?m[Q]:I[j],nt[H]=I[H],nt[j]=_?m[j]:I[j],nt[Q]=w?m[Q]:I[j],A++}for(let F=0;F<=1;F++)for(let _=0;_<=1;_++)for(let w=0;w<=1;w++){i.x=F?I.x:m.x,i.y=_?I.y:m.y,i.z=w?I.z:m.z,this.closestPointToPoint(i,n);const S=i.distanceToSquared(n);if(S<T&&(T=S,l&&l.copy(n),h&&h.copy(i),S<p))return Math.sqrt(S)}for(let F=0;F<12;F++){const _=t[F];for(let w=0;w<12;w++){const S=e[w];_o(_,S,n,i);const Y=n.distanceToSquared(i);if(Y<T&&(T=Y,l&&l.copy(n),h&&h.copy(i),Y<p))return Math.sqrt(Y)}}return Math.sqrt(T)}}();class Oo{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){const t=this._primitives;return t.length===0?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}}class fh extends Oo{constructor(){super(()=>new _e)}}const ue=new fh;function oe(u,t){return t[u+15]===65535}function ae(u,t){return t[u+6]}function de(u,t){return t[u+14]}function pe(u){return u+8}function Ee(u,t){return t[u+6]}function Al(u,t){return t[u+7]}class Ih{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const t=[];let e=null;this.setBuffer=n=>{e&&t.push(e),e=n,this.float32Array=new Float32Array(n),this.uint16Array=new Uint16Array(n),this.uint32Array=new Uint32Array(n)},this.clearBuffer=()=>{e=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,t.length!==0&&this.setBuffer(t.pop())}}}const bt=new Ih;let en,Kn;const Sn=[],Ci=new Oo(()=>new $t);function mh(u,t,e,n,i,o){en=Ci.getPrimitive(),Kn=Ci.getPrimitive(),Sn.push(en,Kn),bt.setBuffer(u._roots[t]);const a=eo(0,u.geometry,e,n,i,o);bt.clearBuffer(),Ci.releasePrimitive(en),Ci.releasePrimitive(Kn),Sn.pop(),Sn.pop();const l=Sn.length;return l>0&&(Kn=Sn[l-1],en=Sn[l-2]),a}function eo(u,t,e,n,i=null,o=0,a=0){const{float32Array:l,uint16Array:h,uint32Array:p}=bt;let m=u*2;if(oe(m,h)){const I=ae(u,p),f=de(m,h);return Dt(u,l,en),n(I,f,!1,a,o+u,en)}else{let I=function(J){const{uint16Array:$,uint32Array:nt}=bt;let ut=J*2;for(;!oe(ut,$);)J=pe(J),ut=J*2;return ae(J,nt)},f=function(J){const{uint16Array:$,uint32Array:nt}=bt;let ut=J*2;for(;!oe(ut,$);)J=Ee(J,nt),ut=J*2;return ae(J,nt)+de(ut,$)};const T=pe(u),A=Ee(u,p);let F=T,_=A,w,S,Y,R;if(i&&(Y=en,R=Kn,Dt(F,l,Y),Dt(_,l,R),w=i(Y),S=i(R),S<w)){F=A,_=T;const J=w;w=S,S=J,Y=R}Y||(Y=en,Dt(F,l,Y));const L=oe(F*2,h),k=e(Y,L,w,a+1,o+F);let V;if(k===fa){const J=I(F),$=f(F)-J;V=n(J,$,!0,a+1,o+F,Y)}else V=k&&eo(F,t,e,n,i,o,a+1);if(V)return!0;R=Kn,Dt(_,l,R);const H=oe(_*2,h),j=e(R,H,S,a+1,o+_);let Q;if(j===fa){const J=I(_),$=f(_)-J;Q=n(J,$,!0,a+1,o+_,R)}else Q=j&&eo(_,t,e,n,i,o,a+1);return!!Q}}const yr=new q,Us=new q;function Ch(u,t,e={},n=0,i=1/0){const o=n*n,a=i*i;let l=1/0,h=null;if(u.shapecast({boundsTraverseOrder:m=>(yr.copy(t).clamp(m.min,m.max),yr.distanceToSquared(t)),intersectsBounds:(m,I,f)=>f<l&&f<a,intersectsTriangle:(m,I)=>{m.closestPointToPoint(t,yr);const f=t.distanceToSquared(yr);return f<l&&(Us.copy(yr),l=f,h=I),f<o}}),l===1/0)return null;const p=Math.sqrt(l);return e.point?e.point.copy(Us):e.point=Us.clone(),e.distance=p,e.faceIndex=h,e}const vn=new q,Pn=new q,bn=new q,Ti=new Fe,gi=new Fe,yi=new Fe,ga=new q,ya=new q,Ra=new q,Ri=new q;function Th(u,t,e,n,i,o){let a;return o===kc?a=u.intersectTriangle(n,e,t,!0,i):a=u.intersectTriangle(t,e,n,o!==kr,i),a===null?null:{distance:u.origin.distanceTo(i),point:i.clone()}}function gh(u,t,e,n,i,o,a,l,h){vn.fromBufferAttribute(t,o),Pn.fromBufferAttribute(t,a),bn.fromBufferAttribute(t,l);const p=Th(u,vn,Pn,bn,Ri,h);if(p){n&&(Ti.fromBufferAttribute(n,o),gi.fromBufferAttribute(n,a),yi.fromBufferAttribute(n,l),p.uv=Hn.getInterpolation(Ri,vn,Pn,bn,Ti,gi,yi,new Fe)),i&&(Ti.fromBufferAttribute(i,o),gi.fromBufferAttribute(i,a),yi.fromBufferAttribute(i,l),p.uv1=Hn.getInterpolation(Ri,vn,Pn,bn,Ti,gi,yi,new Fe)),e&&(ga.fromBufferAttribute(e,o),ya.fromBufferAttribute(e,a),Ra.fromBufferAttribute(e,l),p.normal=Hn.getInterpolation(Ri,vn,Pn,bn,ga,ya,Ra,new q),p.normal.dot(u.direction)>0&&p.normal.multiplyScalar(-1));const m={a:o,b:a,c:l,normal:new q,materialIndex:0};Hn.getNormal(vn,Pn,bn,m.normal),p.face=m,p.faceIndex=o}return p}function Wi(u,t,e,n,i){const o=n*3;let a=o+0,l=o+1,h=o+2;const p=u.index;u.index&&(a=p.getX(a),l=p.getX(l),h=p.getX(h));const{position:m,normal:I,uv:f,uv1:T}=u.attributes,A=gh(e,m,I,f,T,a,l,h,t);return A?(A.faceIndex=n,i&&i.push(A),A):null}function Gt(u,t,e,n){const i=u.a,o=u.b,a=u.c;let l=t,h=t+1,p=t+2;e&&(l=e.getX(l),h=e.getX(h),p=e.getX(p)),i.x=n.getX(l),i.y=n.getY(l),i.z=n.getZ(l),o.x=n.getX(h),o.y=n.getY(h),o.z=n.getZ(h),a.x=n.getX(p),a.y=n.getY(p),a.z=n.getZ(p)}function yh(u,t,e,n,i,o){const{geometry:a,_indirectBuffer:l}=u;for(let h=n,p=n+i;h<p;h++)Wi(a,t,e,h,o)}function Rh(u,t,e,n,i){const{geometry:o,_indirectBuffer:a}=u;let l=1/0,h=null;for(let p=n,m=n+i;p<m;p++){let I;I=Wi(o,t,e,p),I&&I.distance<l&&(h=I,l=I.distance)}return h}function Ah(u,t,e,n,i,o,a){const{geometry:l}=e,{index:h}=l,p=l.attributes.position;for(let m=u,I=t+u;m<I;m++){let f;if(f=m,Gt(a,f*3,h,p),a.needsUpdate=!0,n(a,f,i,o))return!0}return!1}function Fh(u,t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=u.geometry,n=e.index?e.index.array:null,i=e.attributes.position;let o,a,l,h,p=0;const m=u._roots;for(let f=0,T=m.length;f<T;f++)o=m[f],a=new Uint32Array(o),l=new Uint16Array(o),h=new Float32Array(o),I(0,p),p+=o.byteLength;function I(f,T,A=!1){const F=f*2;if(l[F+15]===Ki){const _=a[f+6],w=l[F+14];let S=1/0,Y=1/0,R=1/0,L=-1/0,k=-1/0,V=-1/0;for(let H=3*_,j=3*(_+w);H<j;H++){let Q=n[H];const J=i.getX(Q),$=i.getY(Q),nt=i.getZ(Q);J<S&&(S=J),J>L&&(L=J),$<Y&&(Y=$),$>k&&(k=$),nt<R&&(R=nt),nt>V&&(V=nt)}return h[f+0]!==S||h[f+1]!==Y||h[f+2]!==R||h[f+3]!==L||h[f+4]!==k||h[f+5]!==V?(h[f+0]=S,h[f+1]=Y,h[f+2]=R,h[f+3]=L,h[f+4]=k,h[f+5]=V,!0):!1}else{const _=f+8,w=a[f+6],S=_+T,Y=w+T;let R=A,L=!1,k=!1;t?R||(L=t.has(S),k=t.has(Y),R=!L&&!k):(L=!0,k=!0);const V=R||L,H=R||k;let j=!1;V&&(j=I(_,T,R));let Q=!1;H&&(Q=I(w,T,R));const J=j||Q;if(J)for(let $=0;$<3;$++){const nt=_+$,ut=w+$,It=h[nt],yt=h[nt+3],kt=h[ut],Rt=h[ut+3];h[f+$]=It<kt?It:kt,h[f+$+3]=yt>Rt?yt:Rt}return J}}}const Aa=new $t;function rn(u,t,e,n){return Dt(u,t,Aa),e.intersectBox(Aa,n)}function _h(u,t,e,n,i,o){const{geometry:a,_indirectBuffer:l}=u;for(let h=n,p=n+i;h<p;h++){let m=l?l[h]:h;Wi(a,t,e,m,o)}}function Oh(u,t,e,n,i){const{geometry:o,_indirectBuffer:a}=u;let l=1/0,h=null;for(let p=n,m=n+i;p<m;p++){let I;I=Wi(o,t,e,a?a[p]:p),I&&I.distance<l&&(h=I,l=I.distance)}return h}function wh(u,t,e,n,i,o,a){const{geometry:l}=e,{index:h}=l,p=l.attributes.position;for(let m=u,I=t+u;m<I;m++){let f;if(f=e.resolveTriangleIndex(m),Gt(a,f*3,h,p),a.needsUpdate=!0,n(a,f,i,o))return!0}return!1}const Fa=new q;function Sh(u,t,e,n,i){bt.setBuffer(u._roots[t]),no(0,u,e,n,i),bt.clearBuffer()}function no(u,t,e,n,i){const{float32Array:o,uint16Array:a,uint32Array:l}=bt,h=u*2;if(oe(h,a)){const p=ae(u,l),m=de(h,a);yh(t,e,n,p,m,i)}else{const p=pe(u);rn(p,o,n,Fa)&&no(p,t,e,n,i);const m=Ee(u,l);rn(m,o,n,Fa)&&no(m,t,e,n,i)}}const _a=new q,vh=["x","y","z"];function Ph(u,t,e,n){bt.setBuffer(u._roots[t]);const i=ro(0,u,e,n);return bt.clearBuffer(),i}function ro(u,t,e,n){const{float32Array:i,uint16Array:o,uint32Array:a}=bt;let l=u*2;if(oe(l,o)){const h=ae(u,a),p=de(l,o);return Rh(t,e,n,h,p)}else{const h=Al(u,a),p=vh[h],m=n.direction[p]>=0;let I,f;m?(I=pe(u),f=Ee(u,a)):(I=Ee(u,a),f=pe(u));const T=rn(I,i,n,_a)?ro(I,t,e,n):null;if(T){const F=T.point[p];if(m?F<=i[f+h]:F>=i[f+h+3])return T}const A=rn(f,i,n,_a)?ro(f,t,e,n):null;return T&&A?T.distance<=A.distance?T:A:T||A||null}}const Ai=new $t,Nn=new _e,Ln=new _e,Rr=new Mt,Oa=new re,Fi=new re;function bh(u,t,e,n){bt.setBuffer(u._roots[t]);const i=io(0,u,e,n);return bt.clearBuffer(),i}function io(u,t,e,n,i=null){const{float32Array:o,uint16Array:a,uint32Array:l}=bt;let h=u*2;if(i===null&&(e.boundingBox||e.computeBoundingBox(),Oa.set(e.boundingBox.min,e.boundingBox.max,n),i=Oa),oe(h,a)){const p=t.geometry,m=p.index,I=p.attributes.position,f=e.index,T=e.attributes.position,A=ae(u,l),F=de(h,a);if(Rr.copy(n).invert(),e.boundsTree)return Dt(u,o,Fi),Fi.matrix.copy(Rr),Fi.needsUpdate=!0,e.boundsTree.shapecast({intersectsBounds:_=>Fi.intersectsBox(_),intersectsTriangle:_=>{_.a.applyMatrix4(n),_.b.applyMatrix4(n),_.c.applyMatrix4(n),_.needsUpdate=!0;for(let w=A*3,S=(F+A)*3;w<S;w+=3)if(Gt(Ln,w,m,I),Ln.needsUpdate=!0,_.intersectsTriangle(Ln))return!0;return!1}});for(let _=A*3,w=(F+A)*3;_<w;_+=3){Gt(Nn,_,m,I),Nn.a.applyMatrix4(Rr),Nn.b.applyMatrix4(Rr),Nn.c.applyMatrix4(Rr),Nn.needsUpdate=!0;for(let S=0,Y=f.count;S<Y;S+=3)if(Gt(Ln,S,f,T),Ln.needsUpdate=!0,Nn.intersectsTriangle(Ln))return!0}}else{const p=u+8,m=l[u+6];return Dt(p,o,Ai),!!(i.intersectsBox(Ai)&&io(p,t,e,n,i)||(Dt(m,o,Ai),i.intersectsBox(Ai)&&io(m,t,e,n,i)))}}const _i=new Mt,Bs=new re,Ar=new re,Nh=new q,Lh=new q,Mh=new q,xh=new q;function Dh(u,t,e,n={},i={},o=0,a=1/0){t.boundingBox||t.computeBoundingBox(),Bs.set(t.boundingBox.min,t.boundingBox.max,e),Bs.needsUpdate=!0;const l=u.geometry,h=l.attributes.position,p=l.index,m=t.attributes.position,I=t.index,f=ue.getPrimitive(),T=ue.getPrimitive();let A=Nh,F=Lh,_=null,w=null;i&&(_=Mh,w=xh);let S=1/0,Y=null,R=null;return _i.copy(e).invert(),Ar.matrix.copy(_i),u.shapecast({boundsTraverseOrder:L=>Bs.distanceToBox(L),intersectsBounds:(L,k,V)=>V<S&&V<a?(k&&(Ar.min.copy(L.min),Ar.max.copy(L.max),Ar.needsUpdate=!0),!0):!1,intersectsRange:(L,k)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:V=>Ar.distanceToBox(V),intersectsBounds:(V,H,j)=>j<S&&j<a,intersectsRange:(V,H)=>{for(let j=V,Q=V+H;j<Q;j++){Gt(T,3*j,I,m),T.a.applyMatrix4(e),T.b.applyMatrix4(e),T.c.applyMatrix4(e),T.needsUpdate=!0;for(let J=L,$=L+k;J<$;J++){Gt(f,3*J,p,h),f.needsUpdate=!0;const nt=f.distanceToTriangle(T,A,_);if(nt<S&&(F.copy(A),w&&w.copy(_),S=nt,Y=J,R=j),nt<o)return!0}}}});{const V=er(t);for(let H=0,j=V;H<j;H++){Gt(T,3*H,I,m),T.a.applyMatrix4(e),T.b.applyMatrix4(e),T.c.applyMatrix4(e),T.needsUpdate=!0;for(let Q=L,J=L+k;Q<J;Q++){Gt(f,3*Q,p,h),f.needsUpdate=!0;const $=f.distanceToTriangle(T,A,_);if($<S&&(F.copy(A),w&&w.copy(_),S=$,Y=Q,R=H),$<o)return!0}}}}}),ue.releasePrimitive(f),ue.releasePrimitive(T),S===1/0?null:(n.point?n.point.copy(F):n.point=F.clone(),n.distance=S,n.faceIndex=Y,i&&(i.point?i.point.copy(w):i.point=w.clone(),i.point.applyMatrix4(_i),F.applyMatrix4(_i),i.distance=F.sub(i.point).length(),i.faceIndex=R),n)}function Uh(u,t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=u.geometry,n=e.index?e.index.array:null,i=e.attributes.position;let o,a,l,h,p=0;const m=u._roots;for(let f=0,T=m.length;f<T;f++)o=m[f],a=new Uint32Array(o),l=new Uint16Array(o),h=new Float32Array(o),I(0,p),p+=o.byteLength;function I(f,T,A=!1){const F=f*2;if(l[F+15]===Ki){const _=a[f+6],w=l[F+14];let S=1/0,Y=1/0,R=1/0,L=-1/0,k=-1/0,V=-1/0;for(let H=_,j=_+w;H<j;H++){const Q=3*u.resolveTriangleIndex(H);for(let J=0;J<3;J++){let $=Q+J;$=n?n[$]:$;const nt=i.getX($),ut=i.getY($),It=i.getZ($);nt<S&&(S=nt),nt>L&&(L=nt),ut<Y&&(Y=ut),ut>k&&(k=ut),It<R&&(R=It),It>V&&(V=It)}}return h[f+0]!==S||h[f+1]!==Y||h[f+2]!==R||h[f+3]!==L||h[f+4]!==k||h[f+5]!==V?(h[f+0]=S,h[f+1]=Y,h[f+2]=R,h[f+3]=L,h[f+4]=k,h[f+5]=V,!0):!1}else{const _=f+8,w=a[f+6],S=_+T,Y=w+T;let R=A,L=!1,k=!1;t?R||(L=t.has(S),k=t.has(Y),R=!L&&!k):(L=!0,k=!0);const V=R||L,H=R||k;let j=!1;V&&(j=I(_,T,R));let Q=!1;H&&(Q=I(w,T,R));const J=j||Q;if(J)for(let $=0;$<3;$++){const nt=_+$,ut=w+$,It=h[nt],yt=h[nt+3],kt=h[ut],Rt=h[ut+3];h[f+$]=It<kt?It:kt,h[f+$+3]=yt>Rt?yt:Rt}return J}}}const wa=new q;function Bh(u,t,e,n,i){bt.setBuffer(u._roots[t]),so(0,u,e,n,i),bt.clearBuffer()}function so(u,t,e,n,i){const{float32Array:o,uint16Array:a,uint32Array:l}=bt,h=u*2;if(oe(h,a)){const p=ae(u,l),m=de(h,a);_h(t,e,n,p,m,i)}else{const p=pe(u);rn(p,o,n,wa)&&so(p,t,e,n,i);const m=Ee(u,l);rn(m,o,n,wa)&&so(m,t,e,n,i)}}const Sa=new q,Yh=["x","y","z"];function kh(u,t,e,n){bt.setBuffer(u._roots[t]);const i=oo(0,u,e,n);return bt.clearBuffer(),i}function oo(u,t,e,n){const{float32Array:i,uint16Array:o,uint32Array:a}=bt;let l=u*2;if(oe(l,o)){const h=ae(u,a),p=de(l,o);return Oh(t,e,n,h,p)}else{const h=Al(u,a),p=Yh[h],m=n.direction[p]>=0;let I,f;m?(I=pe(u),f=Ee(u,a)):(I=Ee(u,a),f=pe(u));const T=rn(I,i,n,Sa)?oo(I,t,e,n):null;if(T){const F=T.point[p];if(m?F<=i[f+h]:F>=i[f+h+3])return T}const A=rn(f,i,n,Sa)?oo(f,t,e,n):null;return T&&A?T.distance<=A.distance?T:A:T||A||null}}const Oi=new $t,Mn=new _e,xn=new _e,Fr=new Mt,va=new re,wi=new re;function Gh(u,t,e,n){bt.setBuffer(u._roots[t]);const i=ao(0,u,e,n);return bt.clearBuffer(),i}function ao(u,t,e,n,i=null){const{float32Array:o,uint16Array:a,uint32Array:l}=bt;let h=u*2;if(i===null&&(e.boundingBox||e.computeBoundingBox(),va.set(e.boundingBox.min,e.boundingBox.max,n),i=va),oe(h,a)){const p=t.geometry,m=p.index,I=p.attributes.position,f=e.index,T=e.attributes.position,A=ae(u,l),F=de(h,a);if(Fr.copy(n).invert(),e.boundsTree)return Dt(u,o,wi),wi.matrix.copy(Fr),wi.needsUpdate=!0,e.boundsTree.shapecast({intersectsBounds:_=>wi.intersectsBox(_),intersectsTriangle:_=>{_.a.applyMatrix4(n),_.b.applyMatrix4(n),_.c.applyMatrix4(n),_.needsUpdate=!0;for(let w=A,S=F+A;w<S;w++)if(Gt(xn,3*t.resolveTriangleIndex(w),m,I),xn.needsUpdate=!0,_.intersectsTriangle(xn))return!0;return!1}});for(let _=A,w=F+A;_<w;_++){const S=t.resolveTriangleIndex(_);Gt(Mn,3*S,m,I),Mn.a.applyMatrix4(Fr),Mn.b.applyMatrix4(Fr),Mn.c.applyMatrix4(Fr),Mn.needsUpdate=!0;for(let Y=0,R=f.count;Y<R;Y+=3)if(Gt(xn,Y,f,T),xn.needsUpdate=!0,Mn.intersectsTriangle(xn))return!0}}else{const p=u+8,m=l[u+6];return Dt(p,o,Oi),!!(i.intersectsBox(Oi)&&ao(p,t,e,n,i)||(Dt(m,o,Oi),i.intersectsBox(Oi)&&ao(m,t,e,n,i)))}}const Si=new Mt,Ys=new re,_r=new re,Vh=new q,zh=new q,Hh=new q,Kh=new q;function Wh(u,t,e,n={},i={},o=0,a=1/0){t.boundingBox||t.computeBoundingBox(),Ys.set(t.boundingBox.min,t.boundingBox.max,e),Ys.needsUpdate=!0;const l=u.geometry,h=l.attributes.position,p=l.index,m=t.attributes.position,I=t.index,f=ue.getPrimitive(),T=ue.getPrimitive();let A=Vh,F=zh,_=null,w=null;i&&(_=Hh,w=Kh);let S=1/0,Y=null,R=null;return Si.copy(e).invert(),_r.matrix.copy(Si),u.shapecast({boundsTraverseOrder:L=>Ys.distanceToBox(L),intersectsBounds:(L,k,V)=>V<S&&V<a?(k&&(_r.min.copy(L.min),_r.max.copy(L.max),_r.needsUpdate=!0),!0):!1,intersectsRange:(L,k)=>{if(t.boundsTree){const V=t.boundsTree;return V.shapecast({boundsTraverseOrder:H=>_r.distanceToBox(H),intersectsBounds:(H,j,Q)=>Q<S&&Q<a,intersectsRange:(H,j)=>{for(let Q=H,J=H+j;Q<J;Q++){const $=V.resolveTriangleIndex(Q);Gt(T,3*$,I,m),T.a.applyMatrix4(e),T.b.applyMatrix4(e),T.c.applyMatrix4(e),T.needsUpdate=!0;for(let nt=L,ut=L+k;nt<ut;nt++){const It=u.resolveTriangleIndex(nt);Gt(f,3*It,p,h),f.needsUpdate=!0;const yt=f.distanceToTriangle(T,A,_);if(yt<S&&(F.copy(A),w&&w.copy(_),S=yt,Y=nt,R=Q),yt<o)return!0}}}})}else{const V=er(t);for(let H=0,j=V;H<j;H++){Gt(T,3*H,I,m),T.a.applyMatrix4(e),T.b.applyMatrix4(e),T.c.applyMatrix4(e),T.needsUpdate=!0;for(let Q=L,J=L+k;Q<J;Q++){const $=u.resolveTriangleIndex(Q);Gt(f,3*$,p,h),f.needsUpdate=!0;const nt=f.distanceToTriangle(T,A,_);if(nt<S&&(F.copy(A),w&&w.copy(_),S=nt,Y=Q,R=H),nt<o)return!0}}}}}),ue.releasePrimitive(f),ue.releasePrimitive(T),S===1/0?null:(n.point?n.point.copy(F):n.point=F.clone(),n.distance=S,n.faceIndex=Y,i&&(i.point?i.point.copy(w):i.point=w.clone(),i.point.applyMatrix4(Si),F.applyMatrix4(Si),i.distance=F.sub(i.point).length(),i.faceIndex=R),n)}function Xh(){return typeof SharedArrayBuffer<"u"}const xr=new bt.constructor,Vi=new bt.constructor,tn=new Oo(()=>new $t),Dn=new $t,Un=new $t,ks=new $t,Gs=new $t;let Vs=!1;function jh(u,t,e,n){if(Vs)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");Vs=!0;const i=u._roots,o=t._roots;let a,l=0,h=0;const p=new Mt().copy(e).invert();for(let m=0,I=i.length;m<I;m++){xr.setBuffer(i[m]),h=0;const f=tn.getPrimitive();Dt(0,xr.float32Array,f),f.applyMatrix4(p);for(let T=0,A=o.length;T<A&&(Vi.setBuffer(o[m]),a=Te(0,0,e,p,n,l,h,0,0,f),Vi.clearBuffer(),h+=o[T].length,!a);T++);if(tn.releasePrimitive(f),xr.clearBuffer(),l+=i[m].length,a)break}return Vs=!1,a}function Te(u,t,e,n,i,o=0,a=0,l=0,h=0,p=null,m=!1){let I,f;m?(I=Vi,f=xr):(I=xr,f=Vi);const T=I.float32Array,A=I.uint32Array,F=I.uint16Array,_=f.float32Array,w=f.uint32Array,S=f.uint16Array,Y=u*2,R=t*2,L=oe(Y,F),k=oe(R,S);let V=!1;if(k&&L)m?V=i(ae(t,w),de(t*2,S),ae(u,A),de(u*2,F),h,a+t,l,o+u):V=i(ae(u,A),de(u*2,F),ae(t,w),de(t*2,S),l,o+u,h,a+t);else if(k){const H=tn.getPrimitive();Dt(t,_,H),H.applyMatrix4(e);const j=pe(u),Q=Ee(u,A);Dt(j,T,Dn),Dt(Q,T,Un);const J=H.intersectsBox(Dn),$=H.intersectsBox(Un);V=J&&Te(t,j,n,e,i,a,o,h,l+1,H,!m)||$&&Te(t,Q,n,e,i,a,o,h,l+1,H,!m),tn.releasePrimitive(H)}else{const H=pe(t),j=Ee(t,w);Dt(H,_,ks),Dt(j,_,Gs);const Q=p.intersectsBox(ks),J=p.intersectsBox(Gs);if(Q&&J)V=Te(u,H,e,n,i,o,a,l,h+1,p,m)||Te(u,j,e,n,i,o,a,l,h+1,p,m);else if(Q)if(L)V=Te(u,H,e,n,i,o,a,l,h+1,p,m);else{const $=tn.getPrimitive();$.copy(ks).applyMatrix4(e);const nt=pe(u),ut=Ee(u,A);Dt(nt,T,Dn),Dt(ut,T,Un);const It=$.intersectsBox(Dn),yt=$.intersectsBox(Un);V=It&&Te(H,nt,n,e,i,a,o,h,l+1,$,!m)||yt&&Te(H,ut,n,e,i,a,o,h,l+1,$,!m),tn.releasePrimitive($)}else if(J)if(L)V=Te(u,j,e,n,i,o,a,l,h+1,p,m);else{const $=tn.getPrimitive();$.copy(Gs).applyMatrix4(e);const nt=pe(u),ut=Ee(u,A);Dt(nt,T,Dn),Dt(ut,T,Un);const It=$.intersectsBox(Dn),yt=$.intersectsBox(Un);V=It&&Te(j,nt,n,e,i,a,o,h,l+1,$,!m)||yt&&Te(j,ut,n,e,i,a,o,h,l+1,$,!m),tn.releasePrimitive($)}}return V}const vi=new re,Pa=new $t;class wo{static serialize(t,e={}){e={cloneBuffers:!0,...e};const n=t.geometry,i=t._roots,o=t._indirectBuffer,a=n.getIndex();let l;return e.cloneBuffers?l={roots:i.map(h=>h.slice()),index:a.array.slice(),indirectBuffer:o?o.slice():null}:l={roots:i,index:a.array,indirectBuffer:o},l}static deserialize(t,e,n={}){n={setIndex:!0,indirect:!!t.indirectBuffer,...n};const{index:i,roots:o,indirectBuffer:a}=t,l=new wo(e,{...n,[Ms]:!0});if(l._roots=o,l._indirectBuffer=a||null,n.setIndex){const h=e.getIndex();if(h===null){const p=new $n(t.index,1,!1);e.setIndex(p)}else h.array!==i&&(h.array.set(i),h.needsUpdate=!0)}return l}get indirect(){return!!this._indirectBuffer}constructor(t,e={}){if(t.isBufferGeometry){if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e=Object.assign({strategy:gl,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[Ms]:!1},e),e.useSharedArrayBuffer&&!Xh())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=t,this._roots=null,this._indirectBuffer=null,e[Ms]||(uh(this,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new $t)));const{_indirectBuffer:n}=this;this.resolveTriangleIndex=e.indirect?i=>n[i]:i=>i}refit(t=null){return(this.indirect?Uh:Fh)(this,t)}traverse(t,e=0){const n=this._roots[e],i=new Uint32Array(n),o=new Uint16Array(n);a(0);function a(l,h=0){const p=l*2,m=o[p+15]===Ki;if(m){const I=i[l+6],f=o[p+14];t(h,m,new Float32Array(n,l*4,6),I,f)}else{const I=l+Bi/4,f=i[l+6],T=i[l+7];t(h,m,new Float32Array(n,l*4,6),T)||(a(I,h+1),a(f,h+1))}}}raycast(t,e=da){const n=this._roots,i=this.geometry,o=[],a=e.isMaterial,l=Array.isArray(e),h=i.groups,p=a?e.side:e,m=this.indirect?Bh:Sh;for(let I=0,f=n.length;I<f;I++){const T=l?e[h[I].materialIndex].side:p,A=o.length;if(m(this,I,T,t,o),l){const F=h[I].materialIndex;for(let _=A,w=o.length;_<w;_++)o[_].face.materialIndex=F}}return o}raycastFirst(t,e=da){const n=this._roots,i=this.geometry,o=e.isMaterial,a=Array.isArray(e);let l=null;const h=i.groups,p=o?e.side:e,m=this.indirect?kh:Ph;for(let I=0,f=n.length;I<f;I++){const T=a?e[h[I].materialIndex].side:p,A=m(this,I,T,t);A!=null&&(l==null||A.distance<l.distance)&&(l=A,a&&(A.face.materialIndex=h[I].materialIndex))}return l}intersectsGeometry(t,e){let n=!1;const i=this._roots,o=this.indirect?Gh:bh;for(let a=0,l=i.length;a<l&&(n=o(this,a,t,e),!n);a++);return n}shapecast(t){const e=ue.getPrimitive(),n=this.indirect?wh:Ah;let{boundsTraverseOrder:i,intersectsBounds:o,intersectsRange:a,intersectsTriangle:l}=t;if(a&&l){const I=a;a=(f,T,A,F,_)=>I(f,T,A,F,_)?!0:n(f,T,this,l,A,F,e)}else a||(l?a=(I,f,T,A)=>n(I,f,this,l,T,A,e):a=(I,f,T)=>T);let h=!1,p=0;const m=this._roots;for(let I=0,f=m.length;I<f;I++){const T=m[I];if(h=mh(this,I,o,a,i,p),h)break;p+=T.byteLength}return ue.releasePrimitive(e),h}bvhcast(t,e,n){let{intersectsRanges:i,intersectsTriangles:o}=n;const a=ue.getPrimitive(),l=this.geometry.index,h=this.geometry.attributes.position,p=this.indirect?A=>{const F=this.resolveTriangleIndex(A);Gt(a,F*3,l,h)}:A=>{Gt(a,A*3,l,h)},m=ue.getPrimitive(),I=t.geometry.index,f=t.geometry.attributes.position,T=t.indirect?A=>{const F=t.resolveTriangleIndex(A);Gt(m,F*3,I,f)}:A=>{Gt(m,A*3,I,f)};if(o){const A=(F,_,w,S,Y,R,L,k)=>{for(let V=w,H=w+S;V<H;V++){T(V),m.a.applyMatrix4(e),m.b.applyMatrix4(e),m.c.applyMatrix4(e),m.needsUpdate=!0;for(let j=F,Q=F+_;j<Q;j++)if(p(j),a.needsUpdate=!0,o(a,m,j,V,Y,R,L,k))return!0}return!1};if(i){const F=i;i=function(_,w,S,Y,R,L,k,V){return F(_,w,S,Y,R,L,k,V)?!0:A(_,w,S,Y,R,L,k,V)}}else i=A}return jh(this,t,e,i)}intersectsBox(t,e){return vi.set(t.min,t.max,e),vi.needsUpdate=!0,this.shapecast({intersectsBounds:n=>vi.intersectsBox(n),intersectsTriangle:n=>vi.intersectsTriangle(n)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e,n={},i={},o=0,a=1/0){return(this.indirect?Wh:Dh)(this,t,e,n,i,o,a)}closestPointToPoint(t,e={},n=0,i=1/0){return Ch(this,t,e,n,i)}getBoundingBox(t){return t.makeEmpty(),this._roots.forEach(e=>{Dt(0,new Float32Array(e),Pa),t.union(Pa)}),t}}function ba(u,t,e){return u===null||(u.point.applyMatrix4(t.matrixWorld),u.distance=u.point.distanceTo(e.ray.origin),u.object=t,u.distance<e.near||u.distance>e.far)?null:u}const zs=new Dc,Na=new Mt,qh=lt.prototype.raycast;function Zh(u,t){if(this.geometry.boundsTree){if(this.material===void 0)return;Na.copy(this.matrixWorld).invert(),zs.copy(u.ray).applyMatrix4(Na);const e=this.geometry.boundsTree;if(u.firstHitOnly===!0){const n=ba(e.raycastFirst(zs,this.material),this,u);n&&t.push(n)}else{const n=e.raycast(zs,this.material);for(let i=0,o=n.length;i<o;i++){const a=ba(n[i],this,u);a&&t.push(a)}}}else qh.call(this,u,t)}function Qh(u){return this.boundsTree=new wo(this,u),this.boundsTree}function $h(){this.boundsTree=null}class at{constructor(){y(this,"trigger",t=>{const e=this.handlers.slice(0);for(const n of e)n(t)}),y(this,"handlers",[])}add(t){this.handlers.push(t)}remove(t){this.handlers=this.handlers.filter(e=>e!==t)}reset(){this.handlers.length=0}}class So{constructor(t){y(this,"isDisposeable",()=>"dispose"in this&&"onDisposed"in this),y(this,"isResizeable",()=>"resize"in this&&"getSize"in this),y(this,"isUpdateable",()=>"onAfterUpdate"in this&&"onBeforeUpdate"in this&&"update"in this),y(this,"isHideable",()=>"visible"in this),y(this,"isConfigurable",()=>"setup"in this&&"config"in this&&"onSetup"in this),this.components=t}}class Jt extends So{}class vo extends So{constructor(t){super(t),y(this,"worlds",new Map),y(this,"onWorldChanged",new at),y(this,"currentWorld",null),this.onWorldChanged.add(({world:e,action:n})=>{n==="removed"&&this.worlds.delete(e.uuid)})}}class Jh extends vo{constructor(){super(...arguments),y(this,"hasCameraControls",()=>"controls"in this)}}class tu extends vo{constructor(){super(...arguments),y(this,"onAfterUpdate",new at),y(this,"onBeforeUpdate",new at),y(this,"onDisposed",new at),y(this,"onResize",new at),y(this,"onClippingPlanesUpdated",new at),y(this,"clippingPlanes",[])}updateClippingPlanes(){this.onClippingPlanesUpdated.trigger()}setPlane(t,e,n){e.isLocal=n;const i=this.clippingPlanes.indexOf(e);t&&i===-1?this.clippingPlanes.push(e):!t&&i>-1&&this.clippingPlanes.splice(i,1),this.three.clippingPlanes=this.clippingPlanes.filter(o=>!o.isLocal)}}const Fl=class lo extends Jt{constructor(t){super(t),y(this,"_disposedComponents",new Set),y(this,"enabled",!0),t.add(lo.uuid,this)}get(){return this._disposedComponents}destroy(t,e=!0,n=!0){t.removeFromParent();const i=t;i.dispose&&i.dispose(),this.disposeGeometryAndMaterials(t,e),n&&i.children&&i.children.length&&this.disposeChildren(i),t.children.length=0}disposeGeometry(t){const e=t;e.boundsTree&&e.disposeBoundsTree(),t.dispose()}disposeGeometryAndMaterials(t,e){const n=t;n.geometry&&this.disposeGeometry(n.geometry),e&&n.material&&lo.disposeMaterial(n),n.material=[],n.geometry=null}disposeChildren(t){for(const e of t.children)this.destroy(e)}static disposeMaterial(t){if(t.material)if(Array.isArray(t.material))for(const e of t.material)e.dispose();else t.material.dispose()}};y(Fl,"uuid","76e9cd8e-ad8f-4753-9ef6-cbc60f7247fe");let Jn=Fl;class eu extends vo{constructor(t){super(t),y(this,"onDisposed",new at)}dispose(){const t=this.components.get(Jn);for(const e of this.three.children){const n=e;n.geometry&&t.destroy(n)}this.three.children=[],this.onDisposed.trigger(),this.onDisposed.reset()}}const Yi=0,nu=1,ru=new q,La=new Me,Hs=new Hi,Ma=new q,Pi=new Hn;class iu{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new xa,this.unassigned=new xa,this.vertices=[]}setFromPoints(t){if(t.length>=4){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.vertices.push(new su(t[e]));this.compute()}return this}setFromObject(t){const e=[];return t.updateMatrixWorld(!0),t.traverse(function(n){const i=n.geometry;if(i!==void 0){const o=i.attributes.position;if(o!==void 0)for(let a=0,l=o.count;a<l;a++){const h=new q;h.fromBufferAttribute(o,a).applyMatrix4(n.matrixWorld),e.push(h)}}}),this.setFromPoints(e)}containsPoint(t){const e=this.faces;for(let n=0,i=e.length;n<i;n++)if(e[n].distanceToPoint(t)>this.tolerance)return!1;return!0}intersectRay(t,e){const n=this.faces;let i=-1/0,o=1/0;for(let a=0,l=n.length;a<l;a++){const h=n[a],p=h.distanceToPoint(t.origin),m=h.normal.dot(t.direction);if(p>0&&m>=0)return null;const I=m!==0?-p/m:0;if(!(I<=0)&&(m>0?o=Math.min(I,o):i=Math.max(I,i),i>o))return null}return i!==-1/0?t.at(i,e):t.at(o,e),e}intersectsRay(t){return this.intersectRay(t,ru)!==null}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(t,e){return t.face=e,e.outside===null?this.assigned.append(t):this.assigned.insertBefore(e.outside,t),e.outside=t,this}removeVertexFromFace(t,e){return t===e.outside&&(t.next!==null&&t.next.face===e?e.outside=t.next:e.outside=null),this.assigned.remove(t),this}removeAllVerticesFromFace(t){if(t.outside!==null){const e=t.outside;let n=t.outside;for(;n.next!==null&&n.next.face===t;)n=n.next;return this.assigned.removeSubList(e,n),e.prev=n.next=null,t.outside=null,e}}deleteFaceVertices(t,e){const n=this.removeAllVerticesFromFace(t);if(n!==void 0)if(e===void 0)this.unassigned.appendChain(n);else{let i=n;do{const o=i.next;e.distanceToPoint(i.point)>this.tolerance?this.addVertexToFace(i,e):this.unassigned.append(i),i=o}while(i!==null)}return this}resolveUnassignedPoints(t){if(this.unassigned.isEmpty()===!1){let e=this.unassigned.first();do{const n=e.next;let i=this.tolerance,o=null;for(let a=0;a<t.length;a++){const l=t[a];if(l.mark===Yi){const h=l.distanceToPoint(e.point);if(h>i&&(i=h,o=l),i>1e3*this.tolerance)break}}o!==null&&this.addVertexToFace(e,o),e=n}while(e!==null)}return this}computeExtremes(){const t=new q,e=new q,n=[],i=[];for(let o=0;o<3;o++)n[o]=i[o]=this.vertices[0];t.copy(this.vertices[0].point),e.copy(this.vertices[0].point);for(let o=0,a=this.vertices.length;o<a;o++){const l=this.vertices[o],h=l.point;for(let p=0;p<3;p++)h.getComponent(p)<t.getComponent(p)&&(t.setComponent(p,h.getComponent(p)),n[p]=l);for(let p=0;p<3;p++)h.getComponent(p)>e.getComponent(p)&&(e.setComponent(p,h.getComponent(p)),i[p]=l)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(t.x),Math.abs(e.x))+Math.max(Math.abs(t.y),Math.abs(e.y))+Math.max(Math.abs(t.z),Math.abs(e.z))),{min:n,max:i}}computeInitialHull(){const t=this.vertices,e=this.computeExtremes(),n=e.min,i=e.max;let o=0,a=0;for(let f=0;f<3;f++){const T=i[f].point.getComponent(f)-n[f].point.getComponent(f);T>o&&(o=T,a=f)}const l=n[a],h=i[a];let p,m;o=0,La.set(l.point,h.point);for(let f=0,T=this.vertices.length;f<T;f++){const A=t[f];if(A!==l&&A!==h){La.closestPointToPoint(A.point,!0,Ma);const F=Ma.distanceToSquared(A.point);F>o&&(o=F,p=A)}}o=-1,Hs.setFromCoplanarPoints(l.point,h.point,p.point);for(let f=0,T=this.vertices.length;f<T;f++){const A=t[f];if(A!==l&&A!==h&&A!==p){const F=Math.abs(Hs.distanceToPoint(A.point));F>o&&(o=F,m=A)}}const I=[];if(Hs.distanceToPoint(m.point)<0){I.push(ye.create(l,h,p),ye.create(m,h,l),ye.create(m,p,h),ye.create(m,l,p));for(let f=0;f<3;f++){const T=(f+1)%3;I[f+1].getEdge(2).setTwin(I[0].getEdge(T)),I[f+1].getEdge(1).setTwin(I[T+1].getEdge(0))}}else{I.push(ye.create(l,p,h),ye.create(m,l,h),ye.create(m,h,p),ye.create(m,p,l));for(let f=0;f<3;f++){const T=(f+1)%3;I[f+1].getEdge(2).setTwin(I[0].getEdge((3-f)%3)),I[f+1].getEdge(0).setTwin(I[T+1].getEdge(1))}}for(let f=0;f<4;f++)this.faces.push(I[f]);for(let f=0,T=t.length;f<T;f++){const A=t[f];if(A!==l&&A!==h&&A!==p&&A!==m){o=this.tolerance;let F=null;for(let _=0;_<4;_++){const w=this.faces[_].distanceToPoint(A.point);w>o&&(o=w,F=this.faces[_])}F!==null&&this.addVertexToFace(A,F)}}return this}reindexFaces(){const t=[];for(let e=0;e<this.faces.length;e++){const n=this.faces[e];n.mark===Yi&&t.push(n)}return this.faces=t,this}nextVertexToAdd(){if(this.assigned.isEmpty()===!1){let t,e=0;const n=this.assigned.first().face;let i=n.outside;do{const o=n.distanceToPoint(i.point);o>e&&(e=o,t=i),i=i.next}while(i!==null&&i.face===n);return t}}computeHorizon(t,e,n,i){this.deleteFaceVertices(n),n.mark=nu;let o;e===null?o=e=n.getEdge(0):o=e.next;do{const a=o.twin,l=a.face;l.mark===Yi&&(l.distanceToPoint(t)>this.tolerance?this.computeHorizon(t,a,l,i):i.push(o)),o=o.next}while(o!==e);return this}addAdjoiningFace(t,e){const n=ye.create(t,e.tail(),e.head());return this.faces.push(n),n.getEdge(-1).setTwin(e.twin),n.getEdge(0)}addNewFaces(t,e){this.newFaces=[];let n=null,i=null;for(let o=0;o<e.length;o++){const a=e[o],l=this.addAdjoiningFace(t,a);n===null?n=l:l.next.setTwin(i),this.newFaces.push(l.face),i=l}return n.next.setTwin(i),this}addVertexToHull(t){const e=[];return this.unassigned.clear(),this.removeVertexFromFace(t,t.face),this.computeHorizon(t.point,null,t.face,e),this.addNewFaces(t,e),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let t;for(this.computeInitialHull();(t=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(t);return this.reindexFaces(),this.cleanup(),this}}class ye{constructor(){this.normal=new q,this.midpoint=new q,this.area=0,this.constant=0,this.outside=null,this.mark=Yi,this.edge=null}static create(t,e,n){const i=new ye,o=new Ks(t,i),a=new Ks(e,i),l=new Ks(n,i);return o.next=l.prev=a,a.next=o.prev=l,l.next=a.prev=o,i.edge=o,i.compute()}getEdge(t){let e=this.edge;for(;t>0;)e=e.next,t--;for(;t<0;)e=e.prev,t++;return e}compute(){const t=this.edge.tail(),e=this.edge.head(),n=this.edge.next.head();return Pi.set(t.point,e.point,n.point),Pi.getNormal(this.normal),Pi.getMidpoint(this.midpoint),this.area=Pi.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(t){return this.normal.dot(t)-this.constant}}class Ks{constructor(t,e){this.vertex=t,this.prev=null,this.next=null,this.twin=null,this.face=e}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const t=this.head(),e=this.tail();return e!==null?e.point.distanceTo(t.point):-1}lengthSquared(){const t=this.head(),e=this.tail();return e!==null?e.point.distanceToSquared(t.point):-1}setTwin(t){return this.twin=t,t.twin=this,this}}class su{constructor(t){this.point=t,this.prev=null,this.next=null,this.face=null}}class xa{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(t,e){return e.prev=t.prev,e.next=t,e.prev===null?this.head=e:e.prev.next=e,t.prev=e,this}insertAfter(t,e){return e.prev=t,e.next=t.next,e.next===null?this.tail=e:e.next.prev=e,t.next=e,this}append(t){return this.head===null?this.head=t:this.tail.next=t,t.prev=this.tail,t.next=null,this.tail=t,this}appendChain(t){for(this.head===null?this.head=t:this.tail.next=t,t.prev=this.tail;t.next!==null;)t=t.next;return this.tail=t,this}remove(t){return t.prev===null?this.head=t.next:t.prev.next=t.next,t.next===null?this.tail=t.prev:t.next.prev=t.prev,this}removeSubList(t,e){return t.prev===null?this.head=e.next:t.prev.next=e.next,e.next===null?this.tail=t.prev:e.next.prev=t.prev,this}isEmpty(){return this.head===null}}const co=[2,2,1],ho=[1,0,0];function Le(u,t){return u*3+t}function ou(u){const t=u.elements;let e=0;for(let n=0;n<9;n++)e+=t[n]*t[n];return Math.sqrt(e)}function au(u){const t=u.elements;let e=0;for(let n=0;n<3;n++){const i=t[Le(co[n],ho[n])];e+=2*i*i}return Math.sqrt(e)}function lu(u,t){let e=0,n=1;const i=u.elements;for(let p=0;p<3;p++){const m=Math.abs(i[Le(co[p],ho[p])]);m>e&&(e=m,n=p)}let o=1,a=0;const l=ho[n],h=co[n];if(Math.abs(i[Le(h,l)])>Number.EPSILON){const p=i[Le(h,h)],m=i[Le(l,l)],I=i[Le(h,l)],f=(p-m)/2/I;let T;f<0?T=-1/(-f+Math.sqrt(1+f*f)):T=1/(f+Math.sqrt(1+f*f)),o=1/Math.sqrt(1+T*T),a=T*o}return t.identity(),t.elements[Le(l,l)]=o,t.elements[Le(h,h)]=o,t.elements[Le(h,l)]=a,t.elements[Le(l,h)]=-a,t}function cu(u,t){let e=0,n=0;const i=10;t.unitary.identity(),t.diagonal.copy(u);const o=t.unitary,a=t.diagonal,l=new Cn,h=new Cn,p=Number.EPSILON*ou(a);for(;n<i&&au(a)>p;)lu(a,l),h.copy(l).transpose(),a.multiply(l),a.premultiply(h),o.multiply(l),++e>2&&(n++,e=0);return t}function hu(u){const t=[];for(let Ut=0;Ut<u.length-2;Ut+=3){const ct=u[Ut],xt=u[Ut+1],Ie=u[Ut+2];t.push(new q(ct,xt,Ie))}const e=new iu;e.setFromPoints(t);const n={unitary:new Cn,diagonal:new Cn},i=e.faces,o=[],a=[];for(let Ut=0,ct=i.length;Ut<ct;Ut++){const xt=i[Ut];let Ie=xt.edge;o.length=0;do o.push(Ie),Ie=Ie.next;while(Ie!==xt.edge);const Ot=o.length-2;for(let Oe=1,Xi=Ot;Oe<=Xi;Oe++){const me=o[0].vertex,ir=o[Oe+0].vertex,sr=o[Oe+1].vertex;a.push(me.point.x,me.point.y,me.point.z),a.push(ir.point.x,ir.point.y,ir.point.z),a.push(sr.point.x,sr.point.y,sr.point.z)}}const l=new q,h=new q,p=new q,m=new q,I=new q,f=new q,T=new q,A=new q;let F=0,_=0,w=0,S=0,Y=0,R=0,L=0;for(let Ut=0,ct=a.length;Ut<ct;Ut+=9){l.fromArray(a,Ut),h.fromArray(a,Ut+3),p.fromArray(a,Ut+6),T.set(0,0,0),T.add(l).add(h).add(p).divideScalar(3),m.subVectors(h,l),I.subVectors(p,l);const xt=f.crossVectors(m,I).length()/2;A.add(f.copy(T).multiplyScalar(xt)),F+=xt,_+=(9*T.x*T.x+l.x*l.x+h.x*h.x+p.x*p.x)*(xt/12),w+=(9*T.x*T.y+l.x*l.y+h.x*h.y+p.x*p.y)*(xt/12),S+=(9*T.x*T.z+l.x*l.z+h.x*h.z+p.x*p.z)*(xt/12),Y+=(9*T.y*T.y+l.y*l.y+h.y*h.y+p.y*p.y)*(xt/12),R+=(9*T.y*T.z+l.y*l.z+h.y*h.z+p.y*p.z)*(xt/12),L+=(9*T.z*T.z+l.z*l.z+h.z*h.z+p.z*p.z)*(xt/12)}A.divideScalar(F),_/=F,w/=F,S/=F,Y/=F,R/=F,L/=F,_-=A.x*A.x,w-=A.x*A.y,S-=A.x*A.z,Y-=A.y*A.y,R-=A.y*A.z,L-=A.z*A.z;const k=new Cn;k.elements[0]=_,k.elements[1]=w,k.elements[2]=S,k.elements[3]=w,k.elements[4]=Y,k.elements[5]=R,k.elements[6]=S,k.elements[7]=R,k.elements[8]=L,cu(k,n);const V=n.unitary,H=new q,j=new q,Q=new q;V.extractBasis(H,j,Q);let J=-1/0,$=-1/0,nt=-1/0,ut=1/0,It=1/0,yt=1/0;for(let Ut=0,ct=t.length;Ut<ct;Ut++){const xt=t[Ut];J=Math.max(H.dot(xt),J),$=Math.max(j.dot(xt),$),nt=Math.max(Q.dot(xt),nt),ut=Math.min(H.dot(xt),ut),It=Math.min(j.dot(xt),It),yt=Math.min(Q.dot(xt),yt)}H.multiplyScalar(.5*(ut+J)),j.multiplyScalar(.5*(It+$)),Q.multiplyScalar(.5*(yt+nt));const kt=new q,Rt=new q,te=new Cn;kt.add(H).add(j).add(Q),Rt.x=J-ut,Rt.y=$-It,Rt.z=nt-yt,Rt.multiplyScalar(.5),te.copy(V);const{x:Kt,y:fe,z:gn}=Rt,le=new Mt;le.makeScale(Kt*2,fe*2,gn*2);const rr=new Mt;rr.makeTranslation(-Kt,-fe,-gn);const sn=new Mt;sn.makeTranslation(kt.x,kt.y,kt.z);const xe=new Mt;xe.setFromMatrix3(te);const De=new Mt;return De.multiply(sn),De.multiply(xe),De.multiply(rr),De.multiply(le),{center:kt,halfSizes:Rt,rotation:te,transformation:De}}function uu(u,t,e){const n=[u[0]-t[0],u[1]-t[1],u[2]-t[2]];return e[0]*n[0]+e[1]*n[1]+e[2]*n[2]>0}class Da{static isTransparent(t){return t.transparent&&t.opacity<1}}const uo=class Ht{static create(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return`${Ht._lut[t&255]+Ht._lut[t>>8&255]+Ht._lut[t>>16&255]+Ht._lut[t>>24&255]}-${Ht._lut[e&255]}${Ht._lut[e>>8&255]}-${Ht._lut[e>>16&15|64]}${Ht._lut[e>>24&255]}-${Ht._lut[n&63|128]}${Ht._lut[n>>8&255]}-${Ht._lut[n>>16&255]}${Ht._lut[n>>24&255]}${Ht._lut[i&255]}${Ht._lut[i>>8&255]}${Ht._lut[i>>16&255]}${Ht._lut[i>>24&255]}`.toLowerCase()}static validate(t){if(!Ht._pattern.test(t))throw new Error(`${t} is not a valid UUID v4.

- If you're the tool creator, you can take one from https://www.uuidgenerator.net/.

- If you're using a platform tool, verify the uuid isn't misspelled or contact the tool creator.`)}};y(uo,"_pattern",/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/),y(uo,"_lut",["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"]);let Po=uo;const _l=class Ol{constructor(){y(this,"onDisposed",new at),y(this,"list",new Map),y(this,"enabled",!1),y(this,"_clock"),y(this,"update",()=>{if(!this.enabled)return;const t=this._clock.getDelta();for(const[e,n]of this.list)n.enabled&&n.isUpdateable()&&n.update(t);requestAnimationFrame(this.update)}),this._clock=new Pc,Ol.setupBVH()}add(t,e){if(this.list.has(t))throw new Error("You're trying to add a component that already exists in the components intance. Use Components.get() instead.");Po.validate(t),this.list.set(t,e)}get(t){const e=t.uuid;if(!this.list.has(e)){const n=new t(this);return this.list.has(e)||this.add(e,n),n}return this.list.get(e)}init(){this.enabled=!0,this._clock.start(),this.update()}dispose(){this.enabled=!1;for(const[t,e]of this.list)e.enabled=!1,e.isDisposeable()&&e.dispose();this._clock.stop(),this.onDisposed.trigger(),this.onDisposed.reset()}static setupBVH(){jn.prototype.computeBoundsTree=Qh,jn.prototype.disposeBoundsTree=$h,lt.prototype.raycast=Zh}};y(_l,"release","1.4.21");let wl=_l;class du{constructor(t){y(this,"_event"),y(this,"_position",new Fe),y(this,"onDisposed",new at),y(this,"updateMouseInfo",e=>{this._event=e}),this.dom=t,this.setupEvents(!0)}get position(){if(this._event){const t=this.dom.getBoundingClientRect();this._position.x=this.getPositionX(t,this._event),this._position.y=this.getPositionY(t,this._event)}return this._position}dispose(){this.setupEvents(!1),this.onDisposed.trigger(),this.onDisposed.reset()}getPositionY(t,e){return-((e.clientY-t.top)/(t.bottom-t.top))*2+1}getPositionX(t,e){return(e.clientX-t.left)/(t.right-t.left)*2-1}setupEvents(t){t?this.dom.addEventListener("mousemove",this.updateMouseInfo):this.dom.removeEventListener("mousemove",this.updateMouseInfo)}}class pu{constructor(t,e){y(this,"enabled",!0),y(this,"components"),y(this,"onDisposed",new at),y(this,"mouse"),y(this,"three",new go),y(this,"world");const n=e.renderer;if(!n)throw new Error("A renderer is needed for the raycaster to work!");this.world=e,this.mouse=new du(n.three.domElement),this.components=t}dispose(){this.mouse.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}castRay(t=Array.from(this.world.meshes)){if(!this.world)throw new Error("A world is needed to cast rays!");const e=this.world.camera.three;return this.three.setFromCamera(this.mouse.position,e),this.intersect(t)}castRayFromVector(t,e,n=Array.from(this.world.meshes)){return this.three.set(t,e),this.intersect(n)}intersect(t=Array.from(this.world.meshes)){const e=this.three.intersectObjects(t),n=this.filterClippingPlanes(e);return n.length>0?n[0]:null}filterClippingPlanes(t){if(!this.world.renderer)throw new Error("Renderer not found!");const e=this.world.renderer.three;if(!e.clippingPlanes)return t;const n=e.clippingPlanes;return t.length<=0||!n||(n==null?void 0:n.length)<=0?t:t.filter(i=>n.every(o=>o.distanceToPoint(i.point)>0))}}const Sl=class vl extends Jt{constructor(t){super(t),y(this,"enabled",!0),y(this,"list",new Map),y(this,"onDisposed",new at),t.add(vl.uuid,this)}get(t){if(this.list.has(t.uuid))return this.list.get(t.uuid);const e=new pu(this.components,t);return this.list.set(t.uuid,e),t.onDisposed.add(()=>{this.delete(t)}),e}delete(t){const e=this.list.get(t.uuid);e&&e.dispose(),this.list.delete(t.uuid)}dispose(){for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger()}};y(Sl,"uuid","d5d8bdf0-db25-4952-b951-b643af207ace");let Ua=Sl;class Eu extends So{constructor(t){super(t),y(this,"meshes",new Set),y(this,"onAfterUpdate",new at),y(this,"onBeforeUpdate",new at),y(this,"enabled",!0),y(this,"uuid",Po.create()),y(this,"onDisposed",new at),y(this,"_scene"),y(this,"_camera"),y(this,"_renderer",null)}get scene(){if(!this._scene)throw new Error("No scene initialized!");return this._scene}set scene(t){this._scene=t,t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"})}get camera(){if(!this._camera)throw new Error("No camera initialized!");return this._camera}set camera(t){this._camera=t,t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"})}get renderer(){return this._renderer}set renderer(t){this._renderer=t,t&&(t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"}))}update(t){this.enabled&&(!this._scene||!this._camera||(this.scene.currentWorld=this,this.camera.currentWorld=this,this.renderer&&(this.renderer.currentWorld=this),this.onBeforeUpdate.trigger(),this.scene.isUpdateable()&&this.scene.update(t),this.camera.isUpdateable()&&this.camera.update(t),this.renderer&&this.renderer.update(t),this.onAfterUpdate.trigger()))}dispose(t=!0){if(this.enabled=!1,this.scene.onWorldChanged.trigger({world:this,action:"removed"}),this.camera.onWorldChanged.trigger({world:this,action:"removed"}),this.renderer&&this.renderer.onWorldChanged.trigger({world:this,action:"removed"}),t){const e=this.components.get(Jn);this.scene.dispose(),this.camera.isDisposeable()&&this.camera.dispose(),this.renderer&&this.renderer.dispose();for(const n of this.meshes)e.destroy(n);this.meshes.clear()}this._scene=null,this._camera=null,this._renderer=null,this.onDisposed.trigger()}}class fu extends eu{constructor(t){super(t),y(this,"isSetup",!1),y(this,"three"),y(this,"onSetup",new at),y(this,"config",{directionalLight:{color:new Wn("white"),intensity:1.5,position:new q(5,10,3)},ambientLight:{color:new Wn("white"),intensity:1}}),this.three=new Dr,this.three.background=new Wn(2107698)}setup(t){this.config={...this.config,...t};const e=new Fc(this.config.directionalLight.color,this.config.directionalLight.intensity);e.position.copy(this.config.directionalLight.position);const n=new _c(this.config.ambientLight.color,this.config.ambientLight.intensity);this.three.add(e,n),this.isSetup=!0,this.onSetup.trigger(this)}}class Iu extends tu{constructor(t,e,n){super(t),y(this,"enabled",!0),y(this,"container"),y(this,"three"),y(this,"_canvas"),y(this,"_parameters"),y(this,"onContainerUpdated",new at),y(this,"resize",a=>{if(this.updateContainer(),!this.container)return;const l=a?a.x:this.container.clientWidth,h=a?a.y:this.container.clientHeight;this.three.setSize(l,h),this.onResize.trigger(new Fe(l,h))}),y(this,"resizeEvent",()=>{this.resize()}),y(this,"onContextLost",a=>{a.preventDefault(),this.components.enabled=!1}),y(this,"onContextBack",()=>{this.three.setRenderTarget(null),this.three.dispose(),this.three=new to({canvas:this._canvas,antialias:!0,alpha:!0,...this._parameters}),this.components.enabled=!0}),this.container=e||null,this._parameters=n,this.three=new to({antialias:!0,alpha:!0,...n}),this.three.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.setupRenderer(),this.setupEvents(!0),this.resize(),this._canvas=this.three.domElement;const i=this.three.getContext(),{canvas:o}=i;o.addEventListener("webglcontextlost",this.onContextLost,!1),o.addEventListener("webglcontextrestored",this.onContextBack,!1)}update(){if(!this.enabled||!this.currentWorld)return;this.onBeforeUpdate.trigger(this);const t=this.currentWorld.scene.three,e=this.currentWorld.camera.three;this.three.render(t,e),this.onAfterUpdate.trigger(this)}dispose(){this.enabled=!1,this.setupEvents(!1),this.three.domElement.remove(),this.three.dispose(),this.onResize.reset(),this.onAfterUpdate.reset(),this.onBeforeUpdate.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}getSize(){return new Fe(this.three.domElement.clientWidth,this.three.domElement.clientHeight)}setupEvents(t){const e=this.three.domElement;t?e.addEventListener("resize",this.resizeEvent):e.removeEventListener("resize",this.resizeEvent)}setupRenderer(){this.three.localClippingEnabled=!0,this.container&&this.container.appendChild(this.three.domElement),this.updateContainer()}updateContainer(){if(!this.container){const t=this.three.domElement.parentElement;t&&(this.container=t,this.onContainerUpdated.trigger(t))}}}/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const Et={LEFT:1,RIGHT:2,MIDDLE:4},X=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),Bn={NONE:0,IN:1,OUT:-1};function En(u){return u.isPerspectiveCamera}function Je(u){return u.isOrthographicCamera}const Yn=Math.PI*2,Ba=Math.PI/2,Pl=1e-5,Or=Math.PI/180;function ge(u,t,e){return Math.max(t,Math.min(e,u))}function vt(u,t=Pl){return Math.abs(u)<t}function wt(u,t,e=Pl){return vt(u-t,e)}function Ya(u,t){return Math.round(u/t)*t}function wr(u){return isFinite(u)?u:u<0?-Number.MAX_VALUE:Number.MAX_VALUE}function Sr(u){return Math.abs(u)<Number.MAX_VALUE?u:u*(1/0)}function bi(u,t,e,n,i=1/0,o){n=Math.max(1e-4,n);const a=2/n,l=a*o,h=1/(1+l+.48*l*l+.235*l*l*l);let p=u-t;const m=t,I=i*n;p=ge(p,-I,I),t=u-p;const f=(e.value+a*p)*o;e.value=(e.value-a*f)*h;let T=t+(p+f)*h;return m-u>0==T>m&&(T=m,e.value=(T-m)/o),T}function ka(u,t,e,n,i=1/0,o,a){n=Math.max(1e-4,n);const l=2/n,h=l*o,p=1/(1+h+.48*h*h+.235*h*h*h);let m=t.x,I=t.y,f=t.z,T=u.x-m,A=u.y-I,F=u.z-f;const _=m,w=I,S=f,Y=i*n,R=Y*Y,L=T*T+A*A+F*F;if(L>R){const It=Math.sqrt(L);T=T/It*Y,A=A/It*Y,F=F/It*Y}m=u.x-T,I=u.y-A,f=u.z-F;const k=(e.x+l*T)*o,V=(e.y+l*A)*o,H=(e.z+l*F)*o;e.x=(e.x-l*k)*p,e.y=(e.y-l*V)*p,e.z=(e.z-l*H)*p,a.x=m+(T+k)*p,a.y=I+(A+V)*p,a.z=f+(F+H)*p;const j=_-u.x,Q=w-u.y,J=S-u.z,$=a.x-_,nt=a.y-w,ut=a.z-S;return j*$+Q*nt+J*ut>0&&(a.x=_,a.y=w,a.z=S,e.x=(a.x-_)/o,e.y=(a.y-w)/o,e.z=(a.z-S)/o),a}function Ws(u,t){t.set(0,0),u.forEach(e=>{t.x+=e.clientX,t.y+=e.clientY}),t.x/=u.length,t.y/=u.length}function Xs(u,t){return Je(u)?(console.warn(`${t} is not supported in OrthographicCamera`),!0):!1}class mu{constructor(){this._listeners={}}addEventListener(t,e){const n=this._listeners;n[t]===void 0&&(n[t]=[]),n[t].indexOf(e)===-1&&n[t].push(e)}hasEventListener(t,e){const n=this._listeners;return n[t]!==void 0&&n[t].indexOf(e)!==-1}removeEventListener(t,e){const n=this._listeners[t];if(n!==void 0){const i=n.indexOf(e);i!==-1&&n.splice(i,1)}}removeAllEventListeners(t){if(!t){this._listeners={};return}Array.isArray(this._listeners[t])&&(this._listeners[t].length=0)}dispatchEvent(t){const e=this._listeners[t.type];if(e!==void 0){t.target=this;const n=e.slice(0);for(let i=0,o=n.length;i<o;i++)n[i].call(this,t)}}}const Cu="2.7.3",Ni=1/8,bl=typeof window<"u",Tu=bl&&/Mac/.test(navigator.platform),gu=!(bl&&"PointerEvent"in window);let dt,Ga,Li,js,ie,ft,Ft,kn,vr,Pe,be,fn,Va,za,he,Pr,Gn,Ha,qs,Ka,Zs,Qs,Mi;class Br extends mu{static install(t){dt=t.THREE,Ga=Object.freeze(new dt.Vector3(0,0,0)),Li=Object.freeze(new dt.Vector3(0,1,0)),js=Object.freeze(new dt.Vector3(0,0,1)),ie=new dt.Vector2,ft=new dt.Vector3,Ft=new dt.Vector3,kn=new dt.Vector3,vr=new dt.Vector3,Pe=new dt.Vector3,be=new dt.Vector3,fn=new dt.Vector3,Va=new dt.Vector3,za=new dt.Vector3,he=new dt.Spherical,Pr=new dt.Spherical,Gn=new dt.Box3,Ha=new dt.Box3,qs=new dt.Sphere,Ka=new dt.Quaternion,Zs=new dt.Quaternion,Qs=new dt.Matrix4,Mi=new dt.Raycaster}static get ACTION(){return X}constructor(t,e){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=X.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=Bn.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new dt.Vector3,this._focalOffsetVelocity=new dt.Vector3,this._zoomVelocity={value:0},this._truckInternal=(R,L,k)=>{let V,H;if(En(this._camera)){const j=ft.copy(this._camera.position).sub(this._target),Q=this._camera.getEffectiveFOV()*Or,J=j.length()*Math.tan(Q*.5);V=this.truckSpeed*R*J/this._elementRect.height,H=this.truckSpeed*L*J/this._elementRect.height}else if(Je(this._camera)){const j=this._camera;V=R*(j.right-j.left)/j.zoom/this._elementRect.width,H=L*(j.top-j.bottom)/j.zoom/this._elementRect.height}else return;this.verticalDragToForward?(k?this.setFocalOffset(this._focalOffsetEnd.x+V,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(V,0,!0),this.forward(-H,!0)):k?this.setFocalOffset(this._focalOffsetEnd.x+V,this._focalOffsetEnd.y+H,this._focalOffsetEnd.z,!0):this.truck(V,H,!0)},this._rotateInternal=(R,L)=>{const k=Yn*this.azimuthRotateSpeed*R/this._elementRect.height,V=Yn*this.polarRotateSpeed*L/this._elementRect.height;this.rotate(k,V,!0)},this._dollyInternal=(R,L,k)=>{const V=Math.pow(.95,-R*this.dollySpeed),H=this._sphericalEnd.radius,j=this._sphericalEnd.radius*V,Q=ge(j,this.minDistance,this.maxDistance),J=Q-j;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(j,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(J,!0),this._dollyToNoClamp(Q,!0)):this._dollyToNoClamp(Q,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?j:Q)-H,this._dollyControlCoord.set(L,k)),this._lastDollyDirection=Math.sign(-R)},this._zoomInternal=(R,L,k)=>{const V=Math.pow(.95,R*this.dollySpeed),H=this._zoom,j=this._zoom*V;this.zoomTo(j,!0),this.dollyToCursor&&(this._changedZoom+=j-H,this._dollyControlCoord.set(L,k))},typeof dt>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=t,this._yAxisUpSpace=new dt.Quaternion().setFromUnitVectors(this._camera.up,Li),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=X.NONE,this._target=new dt.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new dt.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new dt.Spherical().setFromVector3(ft.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new dt.Vector3,new dt.Vector3,new dt.Vector3,new dt.Vector3],this._updateNearPlaneCorners(),this._boundary=new dt.Box3(new dt.Vector3(-1/0,-1/0,-1/0),new dt.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new dt.Vector2,this.mouseButtons={left:X.ROTATE,middle:X.DOLLY,right:X.TRUCK,wheel:En(this._camera)?X.DOLLY:Je(this._camera)?X.ZOOM:X.NONE},this.touches={one:X.TOUCH_ROTATE,two:En(this._camera)?X.TOUCH_DOLLY_TRUCK:Je(this._camera)?X.TOUCH_ZOOM_TRUCK:X.NONE,three:X.TOUCH_TRUCK};const n=new dt.Vector2,i=new dt.Vector2,o=new dt.Vector2,a=R=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const V=this._domElement.getBoundingClientRect(),H=R.clientX/V.width,j=R.clientY/V.height;if(H<this._interactiveArea.left||H>this._interactiveArea.right||j<this._interactiveArea.top||j>this._interactiveArea.bottom)return}const L=R.pointerType!=="mouse"?null:(R.buttons&Et.LEFT)===Et.LEFT?Et.LEFT:(R.buttons&Et.MIDDLE)===Et.MIDDLE?Et.MIDDLE:(R.buttons&Et.RIGHT)===Et.RIGHT?Et.RIGHT:null;if(L!==null){const V=this._findPointerByMouseButton(L);V&&this._disposePointer(V)}if((R.buttons&Et.LEFT)===Et.LEFT&&this._lockedPointer)return;const k={pointerId:R.pointerId,clientX:R.clientX,clientY:R.clientY,deltaX:0,deltaY:0,mouseButton:L};this._activePointers.push(k),this._domElement.ownerDocument.removeEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",m),this._domElement.ownerDocument.addEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",m),this._isDragging=!0,F(R)},l=R=>{if(!this._enabled||!this._domElement||this._lockedPointer)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const V=this._domElement.getBoundingClientRect(),H=R.clientX/V.width,j=R.clientY/V.height;if(H<this._interactiveArea.left||H>this._interactiveArea.right||j<this._interactiveArea.top||j>this._interactiveArea.bottom)return}const L=(R.buttons&Et.LEFT)===Et.LEFT?Et.LEFT:(R.buttons&Et.MIDDLE)===Et.MIDDLE?Et.MIDDLE:(R.buttons&Et.RIGHT)===Et.RIGHT?Et.RIGHT:null;if(L!==null){const V=this._findPointerByMouseButton(L);V&&this._disposePointer(V)}const k={pointerId:1,clientX:R.clientX,clientY:R.clientY,deltaX:0,deltaY:0,mouseButton:(R.buttons&Et.LEFT)===Et.LEFT?Et.LEFT:(R.buttons&Et.MIDDLE)===Et.LEFT?Et.MIDDLE:(R.buttons&Et.RIGHT)===Et.LEFT?Et.RIGHT:null};this._activePointers.push(k),this._domElement.ownerDocument.removeEventListener("mousemove",p),this._domElement.ownerDocument.removeEventListener("mouseup",I),this._domElement.ownerDocument.addEventListener("mousemove",p),this._domElement.ownerDocument.addEventListener("mouseup",I),this._isDragging=!0,F(R)},h=R=>{R.cancelable&&R.preventDefault();const L=R.pointerId,k=this._lockedPointer||this._findPointerById(L);if(k){if(k.clientX=R.clientX,k.clientY=R.clientY,k.deltaX=R.movementX,k.deltaY=R.movementY,this._state=0,R.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(R.buttons&Et.LEFT)===Et.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(R.buttons&Et.MIDDLE)===Et.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(R.buttons&Et.RIGHT)===Et.RIGHT&&(this._state=this._state|this.mouseButtons.right);_()}},p=R=>{const L=this._lockedPointer||this._findPointerById(1);L&&(L.clientX=R.clientX,L.clientY=R.clientY,L.deltaX=R.movementX,L.deltaY=R.movementY,this._state=0,(this._lockedPointer||(R.buttons&Et.LEFT)===Et.LEFT)&&(this._state=this._state|this.mouseButtons.left),(R.buttons&Et.MIDDLE)===Et.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(R.buttons&Et.RIGHT)===Et.RIGHT&&(this._state=this._state|this.mouseButtons.right),_())},m=R=>{const L=this._findPointerById(R.pointerId);if(!(L&&L===this._lockedPointer)){if(L&&this._disposePointer(L),R.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=X.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=X.NONE;w()}},I=()=>{const R=this._findPointerById(1);R&&R===this._lockedPointer||(R&&this._disposePointer(R),this._state=X.NONE,w())};let f=-1;const T=R=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===X.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const j=this._domElement.getBoundingClientRect(),Q=R.clientX/j.width,J=R.clientY/j.height;if(Q<this._interactiveArea.left||Q>this._interactiveArea.right||J<this._interactiveArea.top||J>this._interactiveArea.bottom)return}if(R.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===X.ROTATE||this.mouseButtons.wheel===X.TRUCK){const j=performance.now();f-j<1e3&&this._getClientRect(this._elementRect),f=j}const L=Tu?-1:-3,k=R.deltaMode===1?R.deltaY/L:R.deltaY/(L*10),V=this.dollyToCursor?(R.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,H=this.dollyToCursor?(R.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case X.ROTATE:{this._rotateInternal(R.deltaX,R.deltaY),this._isUserControllingRotate=!0;break}case X.TRUCK:{this._truckInternal(R.deltaX,R.deltaY,!1),this._isUserControllingTruck=!0;break}case X.OFFSET:{this._truckInternal(R.deltaX,R.deltaY,!0),this._isUserControllingOffset=!0;break}case X.DOLLY:{this._dollyInternal(-k,V,H),this._isUserControllingDolly=!0;break}case X.ZOOM:{this._zoomInternal(-k,V,H),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},A=R=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===Br.ACTION.NONE){const L=R instanceof PointerEvent?R.pointerId:0,k=this._findPointerById(L);k&&this._disposePointer(k),this._domElement.ownerDocument.removeEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",m),this._domElement.ownerDocument.removeEventListener("mousemove",p),this._domElement.ownerDocument.removeEventListener("mouseup",I);return}R.preventDefault()}},F=R=>{if(this._enabled){if(Ws(this._activePointers,ie),this._getClientRect(this._elementRect),n.copy(ie),i.copy(ie),this._activePointers.length>=2){const L=ie.x-this._activePointers[1].clientX,k=ie.y-this._activePointers[1].clientY,V=Math.sqrt(L*L+k*k);o.set(0,V);const H=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,j=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;i.set(H,j)}if(this._state=0,!R)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in R&&R.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(R.buttons&Et.LEFT)===Et.LEFT&&(this._state=this._state|this.mouseButtons.left),(R.buttons&Et.MIDDLE)===Et.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(R.buttons&Et.RIGHT)===Et.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&X.ROTATE)===X.ROTATE||(this._state&X.TOUCH_ROTATE)===X.TOUCH_ROTATE||(this._state&X.TOUCH_DOLLY_ROTATE)===X.TOUCH_DOLLY_ROTATE||(this._state&X.TOUCH_ZOOM_ROTATE)===X.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&X.TRUCK)===X.TRUCK||(this._state&X.TOUCH_TRUCK)===X.TOUCH_TRUCK||(this._state&X.TOUCH_DOLLY_TRUCK)===X.TOUCH_DOLLY_TRUCK||(this._state&X.TOUCH_ZOOM_TRUCK)===X.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&X.DOLLY)===X.DOLLY||(this._state&X.TOUCH_DOLLY)===X.TOUCH_DOLLY||(this._state&X.TOUCH_DOLLY_TRUCK)===X.TOUCH_DOLLY_TRUCK||(this._state&X.TOUCH_DOLLY_OFFSET)===X.TOUCH_DOLLY_OFFSET||(this._state&X.TOUCH_DOLLY_ROTATE)===X.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&X.ZOOM)===X.ZOOM||(this._state&X.TOUCH_ZOOM)===X.TOUCH_ZOOM||(this._state&X.TOUCH_ZOOM_TRUCK)===X.TOUCH_ZOOM_TRUCK||(this._state&X.TOUCH_ZOOM_OFFSET)===X.TOUCH_ZOOM_OFFSET||(this._state&X.TOUCH_ZOOM_ROTATE)===X.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&X.OFFSET)===X.OFFSET||(this._state&X.TOUCH_OFFSET)===X.TOUCH_OFFSET||(this._state&X.TOUCH_DOLLY_OFFSET)===X.TOUCH_DOLLY_OFFSET||(this._state&X.TOUCH_ZOOM_OFFSET)===X.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})}},_=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,Ws(this._activePointers,ie);const R=this._domElement&&document.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,L=R?-R.deltaX:i.x-ie.x,k=R?-R.deltaY:i.y-ie.y;if(i.copy(ie),((this._state&X.ROTATE)===X.ROTATE||(this._state&X.TOUCH_ROTATE)===X.TOUCH_ROTATE||(this._state&X.TOUCH_DOLLY_ROTATE)===X.TOUCH_DOLLY_ROTATE||(this._state&X.TOUCH_ZOOM_ROTATE)===X.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(L,k),this._isUserControllingRotate=!0),(this._state&X.DOLLY)===X.DOLLY||(this._state&X.ZOOM)===X.ZOOM){const V=this.dollyToCursor?(n.x-this._elementRect.x)/this._elementRect.width*2-1:0,H=this.dollyToCursor?(n.y-this._elementRect.y)/this._elementRect.height*-2+1:0,j=this.dollyDragInverted?-1:1;(this._state&X.DOLLY)===X.DOLLY?(this._dollyInternal(j*k*Ni,V,H),this._isUserControllingDolly=!0):(this._zoomInternal(j*k*Ni,V,H),this._isUserControllingZoom=!0)}if((this._state&X.TOUCH_DOLLY)===X.TOUCH_DOLLY||(this._state&X.TOUCH_ZOOM)===X.TOUCH_ZOOM||(this._state&X.TOUCH_DOLLY_TRUCK)===X.TOUCH_DOLLY_TRUCK||(this._state&X.TOUCH_ZOOM_TRUCK)===X.TOUCH_ZOOM_TRUCK||(this._state&X.TOUCH_DOLLY_OFFSET)===X.TOUCH_DOLLY_OFFSET||(this._state&X.TOUCH_ZOOM_OFFSET)===X.TOUCH_ZOOM_OFFSET||(this._state&X.TOUCH_DOLLY_ROTATE)===X.TOUCH_DOLLY_ROTATE||(this._state&X.TOUCH_ZOOM_ROTATE)===X.TOUCH_ZOOM_ROTATE){const V=ie.x-this._activePointers[1].clientX,H=ie.y-this._activePointers[1].clientY,j=Math.sqrt(V*V+H*H),Q=o.y-j;o.set(0,j);const J=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,$=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&X.TOUCH_DOLLY)===X.TOUCH_DOLLY||(this._state&X.TOUCH_DOLLY_ROTATE)===X.TOUCH_DOLLY_ROTATE||(this._state&X.TOUCH_DOLLY_TRUCK)===X.TOUCH_DOLLY_TRUCK||(this._state&X.TOUCH_DOLLY_OFFSET)===X.TOUCH_DOLLY_OFFSET?(this._dollyInternal(Q*Ni,J,$),this._isUserControllingDolly=!0):(this._zoomInternal(Q*Ni,J,$),this._isUserControllingZoom=!0)}((this._state&X.TRUCK)===X.TRUCK||(this._state&X.TOUCH_TRUCK)===X.TOUCH_TRUCK||(this._state&X.TOUCH_DOLLY_TRUCK)===X.TOUCH_DOLLY_TRUCK||(this._state&X.TOUCH_ZOOM_TRUCK)===X.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(L,k,!1),this._isUserControllingTruck=!0),((this._state&X.OFFSET)===X.OFFSET||(this._state&X.TOUCH_OFFSET)===X.TOUCH_OFFSET||(this._state&X.TOUCH_DOLLY_OFFSET)===X.TOUCH_DOLLY_OFFSET||(this._state&X.TOUCH_ZOOM_OFFSET)===X.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(L,k,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},w=()=>{Ws(this._activePointers,ie),i.copy(ie),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",p),this._domElement.ownerDocument.removeEventListener("pointerup",m),this._domElement.ownerDocument.removeEventListener("mouseup",I),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",m),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",S),this._domElement.ownerDocument.addEventListener("pointerlockerror",Y),this._domElement.ownerDocument.addEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",m),F())},this.unlockPointer=()=>{this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),document.exitPointerLock(),this.cancel(),this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointerlockchange",S),this._domElement.ownerDocument.removeEventListener("pointerlockerror",Y))};const S=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},Y=()=>{this.unlockPointer()};this._addAllEventListeners=R=>{this._domElement=R,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",a),gu&&this._domElement.addEventListener("mousedown",l),this._domElement.addEventListener("pointercancel",m),this._domElement.addEventListener("wheel",T,{passive:!1}),this._domElement.addEventListener("contextmenu",A)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",a),this._domElement.removeEventListener("mousedown",l),this._domElement.removeEventListener("pointercancel",m),this._domElement.removeEventListener("wheel",T,{passive:!1}),this._domElement.removeEventListener("contextmenu",A),this._domElement.ownerDocument.removeEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",p),this._domElement.ownerDocument.removeEventListener("pointerup",m),this._domElement.ownerDocument.removeEventListener("mouseup",I),this._domElement.ownerDocument.removeEventListener("pointerlockchange",S),this._domElement.ownerDocument.removeEventListener("pointerlockerror",Y))},this.cancel=()=>{this._state!==X.NONE&&(this._state=X.NONE,this._activePointers.length=0,w())},e&&this.connect(e),this.update(0)}get camera(){return this._camera}set camera(t){this._camera=t,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._domElement&&(t?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(t){this._spherical.radius===t&&this._sphericalEnd.radius===t||(this._spherical.radius=t,this._sphericalEnd.radius=t,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(t){this._spherical.theta===t&&this._sphericalEnd.theta===t||(this._spherical.theta=t,this._sphericalEnd.theta=t,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(t){this._spherical.phi===t&&this._sphericalEnd.phi===t||(this._spherical.phi=t,this._sphericalEnd.phi=t,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(t){this._boundaryEnclosesCamera=t,this._needsUpdate=!0}set interactiveArea(t){this._interactiveArea.width=ge(t.width,0,1),this._interactiveArea.height=ge(t.height,0,1),this._interactiveArea.x=ge(t.x,0,1-this._interactiveArea.width),this._interactiveArea.y=ge(t.y,0,1-this._interactiveArea.height)}addEventListener(t,e){super.addEventListener(t,e)}removeEventListener(t,e){super.removeEventListener(t,e)}rotate(t,e,n=!1){return this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+e,n)}rotateAzimuthTo(t,e=!1){return this.rotateTo(t,this._sphericalEnd.phi,e)}rotatePolarTo(t,e=!1){return this.rotateTo(this._sphericalEnd.theta,t,e)}rotateTo(t,e,n=!1){this._isUserControllingRotate=!1;const i=ge(t,this.minAzimuthAngle,this.maxAzimuthAngle),o=ge(e,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=i,this._sphericalEnd.phi=o,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,n||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const a=!n||wt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&wt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(a)}dolly(t,e=!1){return this.dollyTo(this._sphericalEnd.radius-t,e)}dollyTo(t,e=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=Bn.NONE,this._changedDolly=0,this._dollyToNoClamp(ge(t,this.minDistance,this.maxDistance),e)}_dollyToNoClamp(t,e=!1){const n=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const o=this._collisionTest(),a=wt(o,this._spherical.radius);if(!(n>t)&&a)return Promise.resolve();this._sphericalEnd.radius=Math.min(t,o)}else this._sphericalEnd.radius=t;this._needsUpdate=!0,e||(this._spherical.radius=this._sphericalEnd.radius);const i=!e||wt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(i)}dollyInFixed(t,e=!1){this._targetEnd.add(this._getCameraDirection(vr).multiplyScalar(t)),e||this._target.copy(this._targetEnd);const n=!e||wt(this._target.x,this._targetEnd.x,this.restThreshold)&&wt(this._target.y,this._targetEnd.y,this.restThreshold)&&wt(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}zoom(t,e=!1){return this.zoomTo(this._zoomEnd+t,e)}zoomTo(t,e=!1){this._isUserControllingZoom=!1,this._zoomEnd=ge(t,this.minZoom,this.maxZoom),this._needsUpdate=!0,e||(this._zoom=this._zoomEnd);const n=!e||wt(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(n)}pan(t,e,n=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(t,e,n)}truck(t,e,n=!1){this._camera.updateMatrix(),Pe.setFromMatrixColumn(this._camera.matrix,0),be.setFromMatrixColumn(this._camera.matrix,1),Pe.multiplyScalar(t),be.multiplyScalar(-e);const i=ft.copy(Pe).add(be),o=Ft.copy(this._targetEnd).add(i);return this.moveTo(o.x,o.y,o.z,n)}forward(t,e=!1){ft.setFromMatrixColumn(this._camera.matrix,0),ft.crossVectors(this._camera.up,ft),ft.multiplyScalar(t);const n=Ft.copy(this._targetEnd).add(ft);return this.moveTo(n.x,n.y,n.z,e)}elevate(t,e=!1){return ft.copy(this._camera.up).multiplyScalar(t),this.moveTo(this._targetEnd.x+ft.x,this._targetEnd.y+ft.y,this._targetEnd.z+ft.z,e)}moveTo(t,e,n,i=!1){this._isUserControllingTruck=!1;const o=ft.set(t,e,n).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,o,this.boundaryFriction),this._needsUpdate=!0,i||this._target.copy(this._targetEnd);const a=!i||wt(this._target.x,this._targetEnd.x,this.restThreshold)&&wt(this._target.y,this._targetEnd.y,this.restThreshold)&&wt(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(a)}lookInDirectionOf(t,e,n,i=!1){const o=ft.set(t,e,n).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius);return this.setPosition(o.x,o.y,o.z,i)}fitToBox(t,e,{cover:n=!1,paddingLeft:i=0,paddingRight:o=0,paddingBottom:a=0,paddingTop:l=0}={}){const h=[],p=t.isBox3?Gn.copy(t):Gn.setFromObject(t);p.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const m=Ya(this._sphericalEnd.theta,Ba),I=Ya(this._sphericalEnd.phi,Ba);h.push(this.rotateTo(m,I,e));const f=ft.setFromSpherical(this._sphericalEnd).normalize(),T=Ka.setFromUnitVectors(f,js),A=wt(Math.abs(f.y),1);A&&T.multiply(Zs.setFromAxisAngle(Li,m)),T.multiply(this._yAxisUpSpaceInverse);const F=Ha.makeEmpty();Ft.copy(p.min).applyQuaternion(T),F.expandByPoint(Ft),Ft.copy(p.min).setX(p.max.x).applyQuaternion(T),F.expandByPoint(Ft),Ft.copy(p.min).setY(p.max.y).applyQuaternion(T),F.expandByPoint(Ft),Ft.copy(p.max).setZ(p.min.z).applyQuaternion(T),F.expandByPoint(Ft),Ft.copy(p.min).setZ(p.max.z).applyQuaternion(T),F.expandByPoint(Ft),Ft.copy(p.max).setY(p.min.y).applyQuaternion(T),F.expandByPoint(Ft),Ft.copy(p.max).setX(p.min.x).applyQuaternion(T),F.expandByPoint(Ft),Ft.copy(p.max).applyQuaternion(T),F.expandByPoint(Ft),F.min.x-=i,F.min.y-=a,F.max.x+=o,F.max.y+=l,T.setFromUnitVectors(js,f),A&&T.premultiply(Zs.invert()),T.premultiply(this._yAxisUpSpace);const _=F.getSize(ft),w=F.getCenter(Ft).applyQuaternion(T);if(En(this._camera)){const S=this.getDistanceToFitBox(_.x,_.y,_.z,n);h.push(this.moveTo(w.x,w.y,w.z,e)),h.push(this.dollyTo(S,e)),h.push(this.setFocalOffset(0,0,0,e))}else if(Je(this._camera)){const S=this._camera,Y=S.right-S.left,R=S.top-S.bottom,L=n?Math.max(Y/_.x,R/_.y):Math.min(Y/_.x,R/_.y);h.push(this.moveTo(w.x,w.y,w.z,e)),h.push(this.zoomTo(L,e)),h.push(this.setFocalOffset(0,0,0,e))}return Promise.all(h)}fitToSphere(t,e){const n=[],i=t instanceof dt.Sphere?qs.copy(t):Br.createBoundingSphere(t,qs);if(n.push(this.moveTo(i.center.x,i.center.y,i.center.z,e)),En(this._camera)){const o=this.getDistanceToFitSphere(i.radius);n.push(this.dollyTo(o,e))}else if(Je(this._camera)){const o=this._camera.right-this._camera.left,a=this._camera.top-this._camera.bottom,l=2*i.radius,h=Math.min(o/l,a/l);n.push(this.zoomTo(h,e))}return n.push(this.setFocalOffset(0,0,0,e)),Promise.all(n)}setLookAt(t,e,n,i,o,a,l=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Bn.NONE,this._changedDolly=0;const h=Ft.set(i,o,a),p=ft.set(t,e,n);this._targetEnd.copy(h),this._sphericalEnd.setFromVector3(p.sub(h).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,l||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const m=!l||wt(this._target.x,this._targetEnd.x,this.restThreshold)&&wt(this._target.y,this._targetEnd.y,this.restThreshold)&&wt(this._target.z,this._targetEnd.z,this.restThreshold)&&wt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&wt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&wt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(m)}lerpLookAt(t,e,n,i,o,a,l,h,p,m,I,f,T,A=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Bn.NONE,this._changedDolly=0;const F=ft.set(i,o,a),_=Ft.set(t,e,n);he.setFromVector3(_.sub(F).applyQuaternion(this._yAxisUpSpace));const w=kn.set(m,I,f),S=Ft.set(l,h,p);Pr.setFromVector3(S.sub(w).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(F.lerp(w,T));const Y=Pr.theta-he.theta,R=Pr.phi-he.phi,L=Pr.radius-he.radius;this._sphericalEnd.set(he.radius+L*T,he.phi+R*T,he.theta+Y*T),this.normalizeRotations(),this._needsUpdate=!0,A||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const k=!A||wt(this._target.x,this._targetEnd.x,this.restThreshold)&&wt(this._target.y,this._targetEnd.y,this.restThreshold)&&wt(this._target.z,this._targetEnd.z,this.restThreshold)&&wt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&wt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&wt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(k)}setPosition(t,e,n,i=!1){return this.setLookAt(t,e,n,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,i)}setTarget(t,e,n,i=!1){const o=this.getPosition(ft),a=this.setLookAt(o.x,o.y,o.z,t,e,n,i);return this._sphericalEnd.phi=ge(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),a}setFocalOffset(t,e,n,i=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(t,e,n),this._needsUpdate=!0,i||this._focalOffset.copy(this._focalOffsetEnd);const o=!i||wt(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&wt(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&wt(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(o)}setOrbitPoint(t,e,n){this._camera.updateMatrixWorld(),Pe.setFromMatrixColumn(this._camera.matrixWorldInverse,0),be.setFromMatrixColumn(this._camera.matrixWorldInverse,1),fn.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const i=ft.set(t,e,n),o=i.distanceTo(this._camera.position),a=i.sub(this._camera.position);Pe.multiplyScalar(a.x),be.multiplyScalar(a.y),fn.multiplyScalar(a.z),ft.copy(Pe).add(be).add(fn),ft.z=ft.z+o,this.dollyTo(o,!1),this.setFocalOffset(-ft.x,ft.y,-ft.z,!1),this.moveTo(t,e,n,!1)}setBoundary(t){if(!t){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(t),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(t,e,n,i){if(t===null){this._viewport=null;return}this._viewport=this._viewport||new dt.Vector4,typeof t=="number"?this._viewport.set(t,e,n,i):this._viewport.copy(t)}getDistanceToFitBox(t,e,n,i=!1){if(Xs(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const o=t/e,a=this._camera.getEffectiveFOV()*Or,l=this._camera.aspect;return((i?o>l:o<l)?e:t/l)*.5/Math.tan(a*.5)+n*.5}getDistanceToFitSphere(t){if(Xs(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const e=this._camera.getEffectiveFOV()*Or,n=Math.atan(Math.tan(e*.5)*this._camera.aspect)*2,i=1<this._camera.aspect?e:n;return t/Math.sin(i*.5)}getTarget(t,e=!0){return(t&&t.isVector3?t:new dt.Vector3).copy(e?this._targetEnd:this._target)}getPosition(t,e=!0){return(t&&t.isVector3?t:new dt.Vector3).setFromSpherical(e?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(e?this._targetEnd:this._target)}getSpherical(t,e=!0){return(t&&t instanceof dt.Spherical?t:new dt.Spherical).copy(e?this._sphericalEnd:this._spherical)}getFocalOffset(t,e=!0){return(t&&t.isVector3?t:new dt.Vector3).copy(e?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%Yn,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=Yn),this._spherical.theta+=Yn*Math.round((this._sphericalEnd.theta-this._spherical.theta)/Yn)}reset(t=!1){if(!wt(this._camera.up.x,this._cameraUp0.x)||!wt(this._camera.up.y,this._cameraUp0.y)||!wt(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const n=this.getPosition(ft);this.updateCameraUp(),this.setPosition(n.x,n.y,n.z)}const e=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,t),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,t),this.zoomTo(this._zoom0,t)];return Promise.all(e)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,Li),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const t=ft.subVectors(this._target,this._camera.position).normalize(),e=Ft.crossVectors(t,this._camera.up);this._camera.up.crossVectors(e,t).normalize(),this._camera.updateMatrixWorld();const n=this.getPosition(ft);this.updateCameraUp(),this.setPosition(n.x,n.y,n.z)}update(t){const e=this._sphericalEnd.theta-this._spherical.theta,n=this._sphericalEnd.phi-this._spherical.phi,i=this._sphericalEnd.radius-this._spherical.radius,o=Va.subVectors(this._targetEnd,this._target),a=za.subVectors(this._focalOffsetEnd,this._focalOffset),l=this._zoomEnd-this._zoom;if(vt(e))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const m=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=bi(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,m,1/0,t),this._needsUpdate=!0}if(vt(n))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const m=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=bi(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,m,1/0,t),this._needsUpdate=!0}if(vt(i))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const m=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=bi(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,m,this.maxSpeed,t),this._needsUpdate=!0}if(vt(o.x)&&vt(o.y)&&vt(o.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const m=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;ka(this._target,this._targetEnd,this._targetVelocity,m,this.maxSpeed,t,this._target),this._needsUpdate=!0}if(vt(a.x)&&vt(a.y)&&vt(a.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const m=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;ka(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,m,this.maxSpeed,t,this._focalOffset),this._needsUpdate=!0}if(vt(l))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const m=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=bi(this._zoom,this._zoomEnd,this._zoomVelocity,m,1/0,t)}if(this.dollyToCursor){if(En(this._camera)&&this._changedDolly!==0){const m=this._spherical.radius-this._lastDistance,I=this._camera,f=this._getCameraDirection(vr),T=ft.copy(f).cross(I.up).normalize();T.lengthSq()===0&&(T.x=1);const A=Ft.crossVectors(T,f),F=this._sphericalEnd.radius*Math.tan(I.getEffectiveFOV()*Or*.5),_=(this._sphericalEnd.radius-m-this._sphericalEnd.radius)/this._sphericalEnd.radius,w=kn.copy(this._targetEnd).add(T.multiplyScalar(this._dollyControlCoord.x*F*I.aspect)).add(A.multiplyScalar(this._dollyControlCoord.y*F)),S=ft.copy(this._targetEnd).lerp(w,_),Y=this._lastDollyDirection===Bn.IN&&this._spherical.radius<=this.minDistance,R=this._lastDollyDirection===Bn.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(Y||R)){this._sphericalEnd.radius-=m,this._spherical.radius-=m;const k=Ft.copy(f).multiplyScalar(-m);S.add(k)}this._boundary.clampPoint(S,S);const L=Ft.subVectors(S,this._targetEnd);this._targetEnd.copy(S),this._target.add(L),this._changedDolly-=m,vt(this._changedDolly)&&(this._changedDolly=0)}else if(Je(this._camera)&&this._changedZoom!==0){const m=this._zoom-this._lastZoom,I=this._camera,f=ft.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(I.near+I.far)/(I.near-I.far)).unproject(I),T=Ft.set(0,0,-1).applyQuaternion(I.quaternion),A=kn.copy(f).add(T.multiplyScalar(-f.dot(I.up))),F=-(this._zoom-m-this._zoom)/this._zoom,_=this._getCameraDirection(vr),w=this._targetEnd.dot(_),S=ft.copy(this._targetEnd).lerp(A,F),Y=S.dot(_),R=_.multiplyScalar(Y-w);S.sub(R),this._boundary.clampPoint(S,S);const L=Ft.subVectors(S,this._targetEnd);this._targetEnd.copy(S),this._target.add(L),this._changedZoom-=m,vt(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const h=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,h),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!vt(this._focalOffset.x)||!vt(this._focalOffset.y)||!vt(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),Pe.setFromMatrixColumn(this._camera.matrix,0),be.setFromMatrixColumn(this._camera.matrix,1),fn.setFromMatrixColumn(this._camera.matrix,2),Pe.multiplyScalar(this._focalOffset.x),be.multiplyScalar(-this._focalOffset.y),fn.multiplyScalar(this._focalOffset.z),ft.copy(Pe).add(be).add(fn),this._camera.position.add(ft)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),ft.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const p=this._needsUpdate;return p&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):p?(this.dispatchEvent({type:"update"}),vt(e,this.restThreshold)&&vt(n,this.restThreshold)&&vt(i,this.restThreshold)&&vt(o.x,this.restThreshold)&&vt(o.y,this.restThreshold)&&vt(o.z,this.restThreshold)&&vt(a.x,this.restThreshold)&&vt(a.y,this.restThreshold)&&vt(a.z,this.restThreshold)&&vt(l,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!p&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=p,this._needsUpdate=!1,p}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:wr(this.maxDistance),minZoom:this.minZoom,maxZoom:wr(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:wr(this.maxPolarAngle),minAzimuthAngle:wr(this.minAzimuthAngle),maxAzimuthAngle:wr(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:ft.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(t,e=!1){const n=JSON.parse(t);this.enabled=n.enabled,this.minDistance=n.minDistance,this.maxDistance=Sr(n.maxDistance),this.minZoom=n.minZoom,this.maxZoom=Sr(n.maxZoom),this.minPolarAngle=n.minPolarAngle,this.maxPolarAngle=Sr(n.maxPolarAngle),this.minAzimuthAngle=Sr(n.minAzimuthAngle),this.maxAzimuthAngle=Sr(n.maxAzimuthAngle),this.smoothTime=n.smoothTime,this.draggingSmoothTime=n.draggingSmoothTime,this.dollySpeed=n.dollySpeed,this.truckSpeed=n.truckSpeed,this.dollyToCursor=n.dollyToCursor,this.verticalDragToForward=n.verticalDragToForward,this._target0.fromArray(n.target0),this._position0.fromArray(n.position0),this._zoom0=n.zoom0,this._focalOffset0.fromArray(n.focalOffset0),this.moveTo(n.target[0],n.target[1],n.target[2],e),he.setFromVector3(ft.fromArray(n.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(he.theta,he.phi,e),this.dollyTo(he.radius,e),this.zoomTo(n.zoom,e),this.setFocalOffset(n.focalOffset[0],n.focalOffset[1],n.focalOffset[2],e),this._needsUpdate=!0}connect(t){if(this._domElement){console.warn("camera-controls is already connected.");return}t.setAttribute("data-camera-controls-version",Cu),this._addAllEventListeners(t),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(t){return t.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(t){return this._getTargetDirection(t).negate()}_findPointerById(t){return this._activePointers.find(e=>e.pointerId===t)}_findPointerByMouseButton(t){return this._activePointers.find(e=>e.mouseButton===t)}_disposePointer(t){this._activePointers.splice(this._activePointers.indexOf(t),1)}_encloseToBoundary(t,e,n){const i=e.lengthSq();if(i===0)return t;const o=Ft.copy(e).add(t),a=this._boundary.clampPoint(o,kn).sub(o),l=a.lengthSq();if(l===0)return t.add(e);if(l===i)return t;if(n===0)return t.add(e).add(a);{const h=1+n*l/e.dot(a);return t.add(Ft.copy(e).multiplyScalar(h)).add(a.multiplyScalar(1-n))}}_updateNearPlaneCorners(){if(En(this._camera)){const t=this._camera,e=t.near,n=t.getEffectiveFOV()*Or,i=Math.tan(n*.5)*e,o=i*t.aspect;this._nearPlaneCorners[0].set(-o,-i,0),this._nearPlaneCorners[1].set(o,-i,0),this._nearPlaneCorners[2].set(o,i,0),this._nearPlaneCorners[3].set(-o,i,0)}else if(Je(this._camera)){const t=this._camera,e=1/t.zoom,n=t.left*e,i=t.right*e,o=t.top*e,a=t.bottom*e;this._nearPlaneCorners[0].set(n,o,0),this._nearPlaneCorners[1].set(i,o,0),this._nearPlaneCorners[2].set(i,a,0),this._nearPlaneCorners[3].set(n,a,0)}}_collisionTest(){let t=1/0;if(!(this.colliderMeshes.length>=1)||Xs(this._camera,"_collisionTest"))return t;const e=this._getTargetDirection(vr);Qs.lookAt(Ga,e,this._camera.up);for(let n=0;n<4;n++){const i=Ft.copy(this._nearPlaneCorners[n]);i.applyMatrix4(Qs);const o=kn.addVectors(this._target,i);Mi.set(o,e),Mi.far=this._spherical.radius+1;const a=Mi.intersectObjects(this.colliderMeshes);a.length!==0&&a[0].distance<t&&(t=a[0].distance)}return t}_getClientRect(t){if(!this._domElement)return;const e=this._domElement.getBoundingClientRect();return t.x=e.left,t.y=e.top,this._viewport?(t.x+=this._viewport.x,t.y+=e.height-this._viewport.w-this._viewport.y,t.width=this._viewport.z,t.height=this._viewport.w):(t.width=e.width,t.height=e.height),t}_createOnRestPromise(t){return t?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(e=>{const n=()=>{this.removeEventListener("rest",n),e()};this.addEventListener("rest",n)}))}_addAllEventListeners(t){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(t){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(t){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(t,e=new dt.Sphere){const n=e,i=n.center;Gn.makeEmpty(),t.traverseVisible(a=>{a.isMesh&&Gn.expandByObject(a)}),Gn.getCenter(i);let o=0;return t.traverseVisible(a=>{if(!a.isMesh)return;const l=a,h=l.geometry.clone();h.applyMatrix4(l.matrixWorld);const p=h.attributes.position;for(let m=0,I=p.count;m<I;m++)ft.fromBufferAttribute(p,m),o=Math.max(o,i.distanceToSquared(ft))}),n.radius=Math.sqrt(o),n}}class Yr extends Jh{constructor(t){super(t),y(this,"onBeforeUpdate",new at),y(this,"onAfterUpdate",new at),y(this,"onAspectUpdated",new at),y(this,"onDisposed",new at),y(this,"three"),y(this,"_allControls",new Map),y(this,"updateAspect",()=>{var e;if(!(!this.currentWorld||!this.currentWorld.renderer)&&(e=this.currentWorld.renderer)!=null&&e.isResizeable()){const n=this.currentWorld.renderer.getSize();this.three.aspect=n.width/n.height,this.three.updateProjectionMatrix(),this.onAspectUpdated.trigger()}}),this.three=this.setupCamera(),this.setupEvents(!0),this.onWorldChanged.add(({action:e,world:n})=>{if(e==="added"){const i=this.newCameraControls();this._allControls.set(n.uuid,i)}if(e==="removed"){const i=this._allControls.get(n.uuid);i&&(i.dispose(),this._allControls.delete(n.uuid))}})}get controls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");const t=this._allControls.get(this.currentWorld.uuid);if(!t)throw new Error("Controls not found!");return t}get enabled(){return this.currentWorld===null?!1:this.controls.enabled}set enabled(t){this.controls.enabled=t}dispose(){this.setupEvents(!1),this.enabled=!1,this.onAspectUpdated.reset(),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.three.removeFromParent(),this.onDisposed.trigger(),this.onDisposed.reset();for(const[t,e]of this._allControls)e.dispose()}update(t){this.enabled&&(this.onBeforeUpdate.trigger(this),this.controls.update(t),this.onAfterUpdate.trigger(this))}setupCamera(){const t=window.innerWidth/window.innerHeight,e=new Oc(60,t,1,1e3);return e.position.set(50,50,50),e.lookAt(new q(0,0,0)),e}newCameraControls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");if(!this.currentWorld.renderer)throw new Error("This camera needs a renderer to work!");Br.install({THREE:Yr.getSubsetOfThree()});const{domElement:t}=this.currentWorld.renderer.three,e=new Br(this.three,t);return e.smoothTime=.2,e.dollyToCursor=!0,e.infinityDolly=!0,e}setupEvents(t){t?window.addEventListener("resize",this.updateAspect):window.removeEventListener("resize",this.updateAspect)}static getSubsetOfThree(){return{MOUSE:wc,Vector2:Fe,Vector3:q,Vector4:Sc,Quaternion:Ae,Matrix4:Mt,Spherical:vc,Box3:$t,Sphere:yo,Raycaster:go,MathUtils:ol}}}const Nl=class Ll extends Jt{constructor(t){super(t),y(this,"onAfterUpdate",new at),y(this,"onBeforeUpdate",new at),y(this,"onDisposed",new at),y(this,"list",new Map),y(this,"enabled",!0),t.add(Ll.uuid,this)}create(){const t=new Eu(this.components),e=t.uuid;if(this.list.has(e))throw new Error("There is already a world with this name!");return this.list.set(e,t),t}delete(t){this.list.delete(t.uuid),t.dispose()}dispose(){this.enabled=!1;for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger()}update(t){if(this.enabled)for(const[e,n]of this.list)n.update(t)}};y(Nl,"uuid","fdb61dc4-2ec1-4966-b83d-54ea795fad4a");let Ml=Nl;class yu{constructor(t,e,n){y(this,"onDisposed",new at),y(this,"world"),y(this,"components"),y(this,"_grid"),y(this,"_fade",3),y(this,"updateZoom",()=>{this.world.camera instanceof Yr&&(this.material.uniforms.uZoom.value=this.world.camera.three.zoom)}),this.world=e;const{color:i,size1:o,size2:a,distance:l}=n;this.components=t;const h=new Ro(2,2,1,1),p=new bc({side:kr,uniforms:{uSize1:{value:o},uSize2:{value:a},uColor:{value:i},uDistance:{value:l},uFade:{value:this._fade},uZoom:{value:1}},transparent:!0,vertexShader:`
            
            varying vec3 worldPosition;
            
            uniform float uDistance;
            
            void main() {
            
                    vec3 pos = position.xzy * uDistance;
                    pos.xz += cameraPosition.xz;
                    
                    worldPosition = pos;
                    
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
            
            }
            `,fragmentShader:`
            
            varying vec3 worldPosition;
            
            uniform float uZoom;
            uniform float uFade;
            uniform float uSize1;
            uniform float uSize2;
            uniform vec3 uColor;
            uniform float uDistance;
                
                
                
                float getGrid(float size) {
                
                    vec2 r = worldPosition.xz / size;
                    
                    
                    vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
                    float line = min(grid.x, grid.y);
                    
                
                    return 1.0 - min(line, 1.0);
                }
                
            void main() {
            
                    
                    float d = 1.0 - min(distance(cameraPosition.xz, worldPosition.xz) / uDistance, 1.0);
                    
                    float g1 = getGrid(uSize1);
                    float g2 = getGrid(uSize2);
                    
                    // Ortho camera fades the grid away when zooming out
                    float minZoom = step(0.2, uZoom);
                    float zoomFactor = pow(min(uZoom, 1.), 2.) * minZoom;
                    
                    gl_FragColor = vec4(uColor.rgb, mix(g2, g1, g1) * pow(d, uFade));
                    gl_FragColor.a = mix(0.5 * gl_FragColor.a, gl_FragColor.a, g2) * zoomFactor;
                    
                    if ( gl_FragColor.a <= 0.0 ) discard;
                    
            
            }
            
            `,extensions:{derivatives:!0}});this._grid=new lt(h,p),this._grid.frustumCulled=!1,e.scene.three.add(this._grid),this.setupEvents(!0)}get visible(){return this._grid.visible}set visible(t){t?this.world.scene.three.add(this._grid):this._grid.removeFromParent()}get material(){return this._grid.material}get fade(){return this._fade===3}set fade(t){this._fade=t?3:0,this.material.uniforms.uFade.value=this._fade}[Symbol.dispose](){throw new Error("Method not implemented.")}get(){return this._grid}dispose(){this.setupEvents(!1),this.components.get(Jn).destroy(this._grid),this.onDisposed.trigger(),this.onDisposed.reset(),this.world=null,this.components=null}setupEvents(t){if(!(this.world.camera instanceof Yr))return;const e=this.world.camera.controls;t?e.addEventListener("update",this.updateZoom):e.removeEventListener("update",this.updateZoom)}}class xl extends Jt{constructor(){super(...arguments),y(this,"list",new Map),y(this,"onDisposed",new at),y(this,"config",{color:new Wn(12303291),size1:1,size2:10,distance:500}),y(this,"enabled",!0)}create(t){if(this.list.has(t.uuid))throw new Error("This world already has a grid!");const e=new yu(this.components,t,this.config);this.list.set(t.uuid,e),t.onDisposed.add(()=>{this.delete(t)})}delete(t){const e=this.list.get(t.uuid);e&&e.dispose(),this.list.delete(t.uuid)}dispose(){for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger()}}y(xl,"uuid","d1e814d5-b81c-4452-87a2-f039375e0489");const In=new go,Qt=new q,$e=new q,Lt=new Ae,Wa={X:new q(1,0,0),Y:new q(0,1,0),Z:new q(0,0,1)},$s={type:"change"},Xa={type:"mouseDown"},ja={type:"mouseUp",mode:null},qa={type:"objectChange"};class Ru extends Ur{constructor(t,e){super(),e===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),e=document),this.isTransformControls=!0,this.visible=!1,this.domElement=e,this.domElement.style.touchAction="none";const n=new Su;this._gizmo=n,this.add(n);const i=new vu;this._plane=i,this.add(i);const o=this;function a(S,Y){let R=Y;Object.defineProperty(o,S,{get:function(){return R!==void 0?R:Y},set:function(L){R!==L&&(R=L,i[S]=L,n[S]=L,o.dispatchEvent({type:S+"-changed",value:L}),o.dispatchEvent($s))}}),o[S]=Y,i[S]=Y,n[S]=Y}a("camera",t),a("object",void 0),a("enabled",!0),a("axis",null),a("mode","translate"),a("translationSnap",null),a("rotationSnap",null),a("scaleSnap",null),a("space","world"),a("size",1),a("dragging",!1),a("showX",!0),a("showY",!0),a("showZ",!0);const l=new q,h=new q,p=new Ae,m=new Ae,I=new q,f=new Ae,T=new q,A=new q,F=new q,_=0,w=new q;a("worldPosition",l),a("worldPositionStart",h),a("worldQuaternion",p),a("worldQuaternionStart",m),a("cameraPosition",I),a("cameraQuaternion",f),a("pointStart",T),a("pointEnd",A),a("rotationAxis",F),a("rotationAngle",_),a("eye",w),this._offset=new q,this._startNorm=new q,this._endNorm=new q,this._cameraScale=new q,this._parentPosition=new q,this._parentQuaternion=new Ae,this._parentQuaternionInv=new Ae,this._parentScale=new q,this._worldScaleStart=new q,this._worldQuaternionInv=new Ae,this._worldScale=new q,this._positionStart=new q,this._quaternionStart=new Ae,this._scaleStart=new q,this._getPointer=Au.bind(this),this._onPointerDown=_u.bind(this),this._onPointerHover=Fu.bind(this),this._onPointerMove=Ou.bind(this),this._onPointerUp=wu.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(t){if(this.object===void 0||this.dragging===!0)return;In.setFromCamera(t,this.camera);const e=Js(this._gizmo.picker[this.mode],In);e?this.axis=e.object.name:this.axis=null}pointerDown(t){if(!(this.object===void 0||this.dragging===!0||t.button!==0)&&this.axis!==null){In.setFromCamera(t,this.camera);const e=Js(this._plane,In,!0);e&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(e.point).sub(this.worldPositionStart)),this.dragging=!0,Xa.mode=this.mode,this.dispatchEvent(Xa)}}pointerMove(t){const e=this.axis,n=this.mode,i=this.object;let o=this.space;if(n==="scale"?o="local":(e==="E"||e==="XYZE"||e==="XYZ")&&(o="world"),i===void 0||e===null||this.dragging===!1||t.button!==-1)return;In.setFromCamera(t,this.camera);const a=Js(this._plane,In,!0);if(a){if(this.pointEnd.copy(a.point).sub(this.worldPositionStart),n==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),o==="local"&&e!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),e.indexOf("X")===-1&&(this._offset.x=0),e.indexOf("Y")===-1&&(this._offset.y=0),e.indexOf("Z")===-1&&(this._offset.z=0),o==="local"&&e!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(o==="local"&&(i.position.applyQuaternion(Lt.copy(this._quaternionStart).invert()),e.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),o==="world"&&(i.parent&&i.position.add(Qt.setFromMatrixPosition(i.parent.matrixWorld)),e.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(Qt.setFromMatrixPosition(i.parent.matrixWorld))));else if(n==="scale"){if(e.search("XYZ")!==-1){let l=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(l*=-1),$e.set(l,l,l)}else Qt.copy(this.pointStart),$e.copy(this.pointEnd),Qt.applyQuaternion(this._worldQuaternionInv),$e.applyQuaternion(this._worldQuaternionInv),$e.divide(Qt),e.search("X")===-1&&($e.x=1),e.search("Y")===-1&&($e.y=1),e.search("Z")===-1&&($e.z=1);i.scale.copy(this._scaleStart).multiply($e),this.scaleSnap&&(e.search("X")!==-1&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Y")!==-1&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Z")!==-1&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(n==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const l=20/this.worldPosition.distanceTo(Qt.setFromMatrixPosition(this.camera.matrixWorld));let h=!1;e==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Qt.copy(this.rotationAxis).cross(this.eye))*l):(e==="X"||e==="Y"||e==="Z")&&(this.rotationAxis.copy(Wa[e]),Qt.copy(Wa[e]),o==="local"&&Qt.applyQuaternion(this.worldQuaternion),Qt.cross(this.eye),Qt.length()===0?h=!0:this.rotationAngle=this._offset.dot(Qt.normalize())*l),(e==="E"||h)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),o==="local"&&e!=="E"&&e!=="XYZE"?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(Lt.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(Lt.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent($s),this.dispatchEvent(qa)}}pointerUp(t){t.button===0&&(this.dragging&&this.axis!==null&&(ja.mode=this.mode,this.dispatchEvent(ja)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(t){t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()})}attach(t){return this.object=t,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent($s),this.dispatchEvent(qa),this.pointStart.copy(this.pointEnd))}getRaycaster(){return In}getMode(){return this.mode}setMode(t){this.mode=t}setTranslationSnap(t){this.translationSnap=t}setRotationSnap(t){this.rotationSnap=t}setScaleSnap(t){this.scaleSnap=t}setSize(t){this.size=t}setSpace(t){this.space=t}}function Au(u){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:u.button};{const t=this.domElement.getBoundingClientRect();return{x:(u.clientX-t.left)/t.width*2-1,y:-(u.clientY-t.top)/t.height*2+1,button:u.button}}}function Fu(u){if(this.enabled)switch(u.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(u));break}}function _u(u){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(u.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(u)),this.pointerDown(this._getPointer(u)))}function Ou(u){this.enabled&&this.pointerMove(this._getPointer(u))}function wu(u){this.enabled&&(this.domElement.releasePointerCapture(u.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(u)))}function Js(u,t,e){const n=t.intersectObject(u,!0);for(let i=0;i<n.length;i++)if(n[i].object.visible||e)return n[i];return!1}const xi=new Ac,St=new q(0,1,0),Za=new q(0,0,0),Qa=new Mt,Di=new Ae,ki=new Ae,Ne=new q,$a=new Mt,Lr=new q(1,0,0),mn=new q(0,1,0),Mr=new q(0,0,1),Ui=new q,br=new q,Nr=new q;class Su extends Ur{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const t=new qn({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),e=new pl({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=t.clone();n.opacity=.15;const i=e.clone();i.opacity=.5;const o=t.clone();o.color.setHex(16711680);const a=t.clone();a.color.setHex(65280);const l=t.clone();l.color.setHex(255);const h=t.clone();h.color.setHex(16711680),h.opacity=.5;const p=t.clone();p.color.setHex(65280),p.opacity=.5;const m=t.clone();m.color.setHex(255),m.opacity=.5;const I=t.clone();I.opacity=.25;const f=t.clone();f.color.setHex(16776960),f.opacity=.25,t.clone().color.setHex(16776960);const T=t.clone();T.color.setHex(7895160);const A=new ne(0,.04,.1,12);A.translate(0,.05,0);const F=new Zt(.08,.08,.08);F.translate(0,.04,0);const _=new jn;_.setAttribute("position",new pa([0,0,0,1,0,0],3));const w=new ne(.0075,.0075,.5,3);w.translate(0,.25,0);function S(ut,It){const yt=new Tr(ut,.0075,3,64,It*Math.PI*2);return yt.rotateY(Math.PI/2),yt.rotateX(Math.PI/2),yt}function Y(){const ut=new jn;return ut.setAttribute("position",new pa([0,0,0,1,1,1],3)),ut}const R={X:[[new lt(A,o),[.5,0,0],[0,0,-Math.PI/2]],[new lt(A,o),[-.5,0,0],[0,0,Math.PI/2]],[new lt(w,o),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new lt(A,a),[0,.5,0]],[new lt(A,a),[0,-.5,0],[Math.PI,0,0]],[new lt(w,a)]],Z:[[new lt(A,l),[0,0,.5],[Math.PI/2,0,0]],[new lt(A,l),[0,0,-.5],[-Math.PI/2,0,0]],[new lt(w,l),null,[Math.PI/2,0,0]]],XYZ:[[new lt(new Ei(.1,0),I.clone()),[0,0,0]]],XY:[[new lt(new Zt(.15,.15,.01),m.clone()),[.15,.15,0]]],YZ:[[new lt(new Zt(.15,.15,.01),h.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new lt(new Zt(.15,.15,.01),p.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},L={X:[[new lt(new ne(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new lt(new ne(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new lt(new ne(.2,0,.6,4),n),[0,.3,0]],[new lt(new ne(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new lt(new ne(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new lt(new ne(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new lt(new Ei(.2,0),n)]],XY:[[new lt(new Zt(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new lt(new Zt(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new lt(new Zt(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]]},k={START:[[new lt(new Ei(.01,2),i),null,null,null,"helper"]],END:[[new lt(new Ei(.01,2),i),null,null,null,"helper"]],DELTA:[[new Ze(Y(),i),null,null,null,"helper"]],X:[[new Ze(_,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ze(_,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ze(_,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},V={XYZE:[[new lt(S(.5,1),T),null,[0,Math.PI/2,0]]],X:[[new lt(S(.5,.5),o)]],Y:[[new lt(S(.5,.5),a),null,[0,0,-Math.PI/2]]],Z:[[new lt(S(.5,.5),l),null,[0,Math.PI/2,0]]],E:[[new lt(S(.75,1),f),null,[0,Math.PI/2,0]]]},H={AXIS:[[new Ze(_,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},j={XYZE:[[new lt(new Uc(.25,10,8),n)]],X:[[new lt(new Tr(.5,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new lt(new Tr(.5,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new lt(new Tr(.5,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new lt(new Tr(.75,.1,2,24),n)]]},Q={X:[[new lt(F,o),[.5,0,0],[0,0,-Math.PI/2]],[new lt(w,o),[0,0,0],[0,0,-Math.PI/2]],[new lt(F,o),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new lt(F,a),[0,.5,0]],[new lt(w,a)],[new lt(F,a),[0,-.5,0],[0,0,Math.PI]]],Z:[[new lt(F,l),[0,0,.5],[Math.PI/2,0,0]],[new lt(w,l),[0,0,0],[Math.PI/2,0,0]],[new lt(F,l),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new lt(new Zt(.15,.15,.01),m),[.15,.15,0]]],YZ:[[new lt(new Zt(.15,.15,.01),h),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new lt(new Zt(.15,.15,.01),p),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new lt(new Zt(.1,.1,.1),I.clone())]]},J={X:[[new lt(new ne(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new lt(new ne(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new lt(new ne(.2,0,.6,4),n),[0,.3,0]],[new lt(new ne(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new lt(new ne(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new lt(new ne(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new lt(new Zt(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new lt(new Zt(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new lt(new Zt(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new lt(new Zt(.2,.2,.2),n),[0,0,0]]]},$={X:[[new Ze(_,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ze(_,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ze(_,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function nt(ut){const It=new Ur;for(const yt in ut)for(let kt=ut[yt].length;kt--;){const Rt=ut[yt][kt][0].clone(),te=ut[yt][kt][1],Kt=ut[yt][kt][2],fe=ut[yt][kt][3],gn=ut[yt][kt][4];Rt.name=yt,Rt.tag=gn,te&&Rt.position.set(te[0],te[1],te[2]),Kt&&Rt.rotation.set(Kt[0],Kt[1],Kt[2]),fe&&Rt.scale.set(fe[0],fe[1],fe[2]),Rt.updateMatrix();const le=Rt.geometry.clone();le.applyMatrix4(Rt.matrix),Rt.geometry=le,Rt.renderOrder=1/0,Rt.position.set(0,0,0),Rt.rotation.set(0,0,0),Rt.scale.set(1,1,1),It.add(Rt)}return It}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=nt(R)),this.add(this.gizmo.rotate=nt(V)),this.add(this.gizmo.scale=nt(Q)),this.add(this.picker.translate=nt(L)),this.add(this.picker.rotate=nt(j)),this.add(this.picker.scale=nt(J)),this.add(this.helper.translate=nt(k)),this.add(this.helper.rotate=nt(H)),this.add(this.helper.scale=nt($)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(t){const e=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:ki;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(let i=0;i<n.length;i++){const o=n[i];o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition);let a;if(this.camera.isOrthographicCamera?a=(this.camera.top-this.camera.bottom)/this.camera.zoom:a=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(a*this.size/4),o.tag==="helper"){o.visible=!1,o.name==="AXIS"?(o.visible=!!this.axis,this.axis==="X"&&(Lt.setFromEuler(xi.set(0,0,0)),o.quaternion.copy(e).multiply(Lt),Math.abs(St.copy(Lr).applyQuaternion(e).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Y"&&(Lt.setFromEuler(xi.set(0,0,Math.PI/2)),o.quaternion.copy(e).multiply(Lt),Math.abs(St.copy(mn).applyQuaternion(e).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Z"&&(Lt.setFromEuler(xi.set(0,Math.PI/2,0)),o.quaternion.copy(e).multiply(Lt),Math.abs(St.copy(Mr).applyQuaternion(e).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="XYZE"&&(Lt.setFromEuler(xi.set(0,Math.PI/2,0)),St.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(Qa.lookAt(Za,St,mn)),o.quaternion.multiply(Lt),o.visible=this.dragging),this.axis==="E"&&(o.visible=!1)):o.name==="START"?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):o.name==="END"?(o.position.copy(this.worldPosition),o.visible=this.dragging):o.name==="DELTA"?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),Qt.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Qt.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(Qt),o.visible=this.dragging):(o.quaternion.copy(e),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=this.axis.search(o.name)!==-1));continue}o.quaternion.copy(e),this.mode==="translate"||this.mode==="scale"?(o.name==="X"&&Math.abs(St.copy(Lr).applyQuaternion(e).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Y"&&Math.abs(St.copy(mn).applyQuaternion(e).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Z"&&Math.abs(St.copy(Mr).applyQuaternion(e).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XY"&&Math.abs(St.copy(Mr).applyQuaternion(e).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="YZ"&&Math.abs(St.copy(Lr).applyQuaternion(e).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XZ"&&Math.abs(St.copy(mn).applyQuaternion(e).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)):this.mode==="rotate"&&(Di.copy(e),St.copy(this.eye).applyQuaternion(Lt.copy(e).invert()),o.name.search("E")!==-1&&o.quaternion.setFromRotationMatrix(Qa.lookAt(this.eye,Za,mn)),o.name==="X"&&(Lt.setFromAxisAngle(Lr,Math.atan2(-St.y,St.z)),Lt.multiplyQuaternions(Di,Lt),o.quaternion.copy(Lt)),o.name==="Y"&&(Lt.setFromAxisAngle(mn,Math.atan2(St.x,St.z)),Lt.multiplyQuaternions(Di,Lt),o.quaternion.copy(Lt)),o.name==="Z"&&(Lt.setFromAxisAngle(Mr,Math.atan2(St.y,St.x)),Lt.multiplyQuaternions(Di,Lt),o.quaternion.copy(Lt))),o.visible=o.visible&&(o.name.indexOf("X")===-1||this.showX),o.visible=o.visible&&(o.name.indexOf("Y")===-1||this.showY),o.visible=o.visible&&(o.name.indexOf("Z")===-1||this.showZ),o.visible=o.visible&&(o.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis||this.axis.split("").some(function(l){return o.name===l}))&&(o.material.color.setHex(16776960),o.material.opacity=1)}super.updateMatrixWorld(t)}}class vu extends lt{constructor(){super(new Ro(1e5,1e5,2,2),new qn({visible:!1,wireframe:!0,side:kr,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(t){let e=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(e="local"),Ui.copy(Lr).applyQuaternion(e==="local"?this.worldQuaternion:ki),br.copy(mn).applyQuaternion(e==="local"?this.worldQuaternion:ki),Nr.copy(Mr).applyQuaternion(e==="local"?this.worldQuaternion:ki),St.copy(br),this.mode){case"translate":case"scale":switch(this.axis){case"X":St.copy(this.eye).cross(Ui),Ne.copy(Ui).cross(St);break;case"Y":St.copy(this.eye).cross(br),Ne.copy(br).cross(St);break;case"Z":St.copy(this.eye).cross(Nr),Ne.copy(Nr).cross(St);break;case"XY":Ne.copy(Nr);break;case"YZ":Ne.copy(Ui);break;case"XZ":St.copy(Nr),Ne.copy(br);break;case"XYZ":case"E":Ne.set(0,0,0);break}break;case"rotate":default:Ne.set(0,0,0)}Ne.length()===0?this.quaternion.copy(this.cameraQuaternion):($a.lookAt(Qt.set(0,0,0),Ne,St),this.quaternion.setFromRotationMatrix($a)),super.updateMatrixWorld(t)}}class bo{constructor(t,e,n,i,o,a=5,l=!0){if(y(this,"onDraggingStarted",new at),y(this,"onDraggingEnded",new at),y(this,"onDisposed",new at),y(this,"normal"),y(this,"origin"),y(this,"three",new Hi),y(this,"_helper"),y(this,"_visible",!0),y(this,"_enabled",!0),y(this,"components"),y(this,"world"),y(this,"_controlsActive",!1),y(this,"_arrowBoundBox",new lt),y(this,"_planeMesh"),y(this,"_controls"),y(this,"_hiddenMaterial",new qn({visible:!1})),y(this,"update",async()=>{this._enabled&&this.three.setFromNormalAndCoplanarPoint(this.normal,this._helper.position)}),y(this,"changeDrag",h=>{this._visible=!h.value,this.preventCameraMovement(),this.notifyDraggingChanged(h)}),this.components=t,this.world=e,!e.renderer)throw new Error("The given world must have a renderer!");this.normal=i,this.origin=n,e.renderer.setPlane(!0,this.three),this._planeMesh=bo.newPlaneMesh(a,o),this._helper=this.newHelper(),this._controls=this.newTransformControls(),this.three.setFromNormalAndCoplanarPoint(i,n),l&&this.toggleControls(!0)}get enabled(){return this._enabled}set enabled(t){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");this._enabled=t,this.world.renderer.setPlane(t,this.three)}get visible(){return this._visible}set visible(t){this._visible=t,this._controls.visible=t,this._helper.visible=t,this.toggleControls(t)}get meshes(){return[this._planeMesh,this._arrowBoundBox]}get planeMaterial(){return this._planeMesh.material}set planeMaterial(t){this._planeMesh.material=t}get size(){return this._planeMesh.scale.x}set size(t){this._planeMesh.scale.set(t,t,t)}get helper(){return this._helper}async setFromNormalAndCoplanarPoint(t,e){this.reset(),this.normal.equals(t)||(this.normal.copy(t),this._helper.lookAt(t)),this.origin.copy(e),this._helper.position.copy(e),this._helper.updateMatrix(),await this.update()}dispose(){this._enabled=!1,this.onDraggingStarted.reset(),this.onDraggingEnded.reset(),this._helper.removeFromParent(),this.world.renderer&&this.world.renderer.setPlane(!1,this.three),this._arrowBoundBox.removeFromParent(),this._arrowBoundBox.geometry.dispose(),this._planeMesh.geometry.dispose(),this._controls.removeFromParent(),this._controls.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}reset(){const t=new q(1,0,0),e=new q;this.normal.equals(t)||(this.normal.copy(t),this._helper.lookAt(t)),this.origin.copy(e),this._helper.position.copy(e),this._helper.updateMatrix()}toggleControls(t){if(t){if(this._controlsActive)return;this._controls.addEventListener("change",this.update),this._controls.addEventListener("dragging-changed",this.changeDrag)}else this._controls.removeEventListener("change",this.update),this._controls.removeEventListener("dragging-changed",this.changeDrag);this._controlsActive=t}newTransformControls(){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");const t=this.world.camera.three,e=this.world.renderer.three.domElement,n=new Ru(t,e);return this.initializeControls(n),this.world.scene.three.add(n),n}initializeControls(t){t.attach(this._helper),t.showX=!1,t.showY=!1,t.setSpace("local"),this.createArrowBoundingBox(),t.children[0].children[0].add(this._arrowBoundBox)}createArrowBoundingBox(){this._arrowBoundBox.geometry=new ne(.18,.18,1.2),this._arrowBoundBox.material=this._hiddenMaterial,this._arrowBoundBox.rotateX(Math.PI/2),this._arrowBoundBox.updateMatrix(),this._arrowBoundBox.geometry.applyMatrix4(this._arrowBoundBox.matrix)}notifyDraggingChanged(t){t.value?this.onDraggingStarted.trigger():this.onDraggingEnded.trigger()}preventCameraMovement(){this.world.camera.enabled=this._visible}newHelper(){const t=new Ur;return t.lookAt(this.normal),t.position.copy(this.origin),this._planeMesh.position.z+=.01,t.add(this._planeMesh),this.world.scene.three.add(t),t}static newPlaneMesh(t,e){const n=new Ro(1),i=new lt(n,e);return i.scale.set(t,t,t),i}}const Pu=class po extends Jt{constructor(t){super(t),y(this,"onAfterCreate",new at),y(this,"onAfterDelete",new at),y(this,"onBeforeDrag",new at),y(this,"onAfterDrag",new at),y(this,"onBeforeCreate",new at),y(this,"onBeforeCancel",new at),y(this,"onAfterCancel",new at),y(this,"onBeforeDelete",new at),y(this,"onDisposed",new at),y(this,"orthogonalY",!1),y(this,"toleranceOrthogonalY",.7),y(this,"planes",[]),y(this,"PlaneType"),y(this,"_material",new qn({color:16776960,side:kr,transparent:!0,opacity:.2})),y(this,"_size",5),y(this,"_enabled",!1),y(this,"_visible",!1),y(this,"_onStartDragging",()=>{this.onBeforeDrag.trigger()}),y(this,"_onEndDragging",()=>{this.onAfterDrag.trigger()}),this.components.add(po.uuid,this),this.PlaneType=bo}get enabled(){return this._enabled}set enabled(t){this._enabled=t;for(const e of this.planes)e.enabled=t;this.updateMaterialsAndPlanes()}get visible(){return this._visible}set visible(t){this._visible=t;for(const e of this.planes)e.visible=t}get material(){return this._material}set material(t){this._material=t;for(const e of this.planes)e.planeMaterial=t}get size(){return this._size}set size(t){this._size=t;for(const e of this.planes)e.size=t}endCreation(){}cancelCreation(){}dispose(){this._enabled=!1;for(const t of this.planes)t.dispose();this.planes.length=0,this._material.dispose(),this.onBeforeCreate.reset(),this.onBeforeCancel.reset(),this.onBeforeDelete.reset(),this.onBeforeDrag.reset(),this.onAfterCreate.reset(),this.onAfterCancel.reset(),this.onAfterDelete.reset(),this.onAfterDrag.reset(),this.onDisposed.trigger(po.uuid),this.onDisposed.reset()}create(t){if(!this.enabled)return;const e=this.components.get(Ua).get(t).castRay();e&&this.createPlaneFromIntersection(t,e)}createFromNormalAndCoplanarPoint(t,e,n){const i=this.newPlane(t,n,e);return this.updateMaterialsAndPlanes(),i}delete(t,e){this.enabled&&(e||(e=this.pickPlane(t)),e&&this.deletePlane(e))}deleteAll(){for(;this.planes.length>0;){const t=this.planes[0];this.delete(t.world,t)}}deletePlane(t){const e=this.planes.indexOf(t);if(e!==-1){if(this.planes.splice(e,1),!t.world.renderer)throw new Error("Renderer not found for this plane's world!");t.world.renderer.setPlane(!1,t.three),t.dispose(),this.updateMaterialsAndPlanes(),this.onAfterDelete.trigger(t)}}pickPlane(t){const e=this.components.get(Ua).get(t),n=this.getAllPlaneMeshes(),i=e.castRay(n);if(i){const o=i.object;return this.planes.find(a=>a.meshes.includes(o))}}getAllPlaneMeshes(){const t=[];for(const e of this.planes)t.push(...e.meshes);return t}createPlaneFromIntersection(t,e){var n;if(!t.renderer)throw new Error("The given world must have a renderer!");const i=e.point.distanceTo(new q(0,0,0)),o=(n=e.face)==null?void 0:n.normal;if(!i||!o)return;const a=this.getWorldNormal(e,o),l=this.newPlane(t,e.point,a.negate());t.renderer.setPlane(!0,l.three),this.updateMaterialsAndPlanes()}getWorldNormal(t,e){const n=t.object;let i=t.object.matrixWorld.clone();if(n instanceof Zn&&t.instanceId!==void 0){const l=new Mt;n.getMatrixAt(t.instanceId,l),i=l.multiply(i)}const o=new Cn().getNormalMatrix(i),a=e.clone().applyMatrix3(o).normalize();return this.normalizePlaneDirectionY(a),a}normalizePlaneDirectionY(t){this.orthogonalY&&(t.y>this.toleranceOrthogonalY&&(t.x=0,t.y=1,t.z=0),t.y<-this.toleranceOrthogonalY&&(t.x=0,t.y=-1,t.z=0))}newPlane(t,e,n){const i=this.newPlaneInstance(t,e,n);return i.onDraggingStarted.add(this._onStartDragging),i.onDraggingEnded.add(this._onEndDragging),this.planes.push(i),this.onAfterCreate.trigger(i),i}newPlaneInstance(t,e,n){return new this.PlaneType(this.components,t,e,n,this._material)}updateMaterialsAndPlanes(){const t=this.components.get(Ml);for(const[e,n]of t.list){if(!n.renderer)continue;n.renderer.updateClippingPlanes();const{clippingPlanes:i}=n.renderer;for(const o of n.meshes)if(Array.isArray(o.material))for(const a of o.material)a.clippingPlanes=i;else o.material.clippingPlanes=i}}};y(Pu,"uuid","66290bc5-18c4-4cd1-9379-2e17a0617611");const bu=class Eo extends Jt{constructor(t){super(t),y(this,"enabled",!0),y(this,"_originalBackground",new Map),y(this,"onDisposed",new at),y(this,"list",{}),y(this,"_originals",{}),this.components.add(Eo.uuid,this)}set(t,e=Object.keys(this.list)){for(const n of e){const{material:i,meshes:o}=this.list[n];for(const a of o)if(t)this._originals[a.uuid]||(this._originals[a.uuid]={material:a.material}),a instanceof Zn&&a.instanceColor&&(this._originals[a.uuid].instances=a.instanceColor,a.instanceColor=null),a.material=i;else{if(!this._originals[a.uuid])continue;a.material=this._originals[a.uuid].material;const l=this._originals[a.uuid].instances;a instanceof Zn&&l&&(a.instanceColor=l)}}}dispose(){for(const t in this.list){const{material:e}=this.list[t];e.dispose()}this.list={},this._originals={},this.onDisposed.trigger(Eo.uuid),this.onDisposed.reset(),this._originalBackground.clear()}setBackgroundColor(t,e){const n=e.scene.three;n instanceof Dr&&(this._originalBackground.has(e.uuid)||this._originalBackground.set(e.uuid,n.background),this._originalBackground&&(n.background=t))}resetBackgroundColor(t){const e=t.scene.three;if(!(e instanceof Dr))return;const n=this._originalBackground.get(t.uuid);n&&(e.background=n)}addMaterial(t,e){if(this.list[t])throw new Error("This ID already exists!");this.list[t]={material:e,meshes:new Set}}addMeshes(t,e){if(!this.list[t])throw new Error("This ID doesn't exists!");for(const n of e)this.list[t].meshes.add(n)}removeMeshes(t,e){if(!this.list[t])throw new Error("This ID doesn't exists!");for(const n of e)this.list[t].meshes.delete(n)}};y(bu,"uuid","24989d27-fa2f-4797-8b08-35918f74e502");function Nu(u,t,e,n){return new Promise((i,o)=>{function a(){const l=u.clientWaitSync(t,e,0);if(l===u.WAIT_FAILED){o();return}if(l===u.TIMEOUT_EXPIRED){setTimeout(a,n);return}i()}a()})}async function Lu(u,t,e,n,i,o,a){const l=u.fenceSync(u.SYNC_GPU_COMMANDS_COMPLETE,0);u.flush(),await Nu(u,l,0,10),u.deleteSync(l),u.bindBuffer(t,e),u.getBufferSubData(t,n,i,o,a),u.bindBuffer(t,null)}async function Mu(u,t,e,n,i,o,a,l){const h=u.createBuffer();return u.bindBuffer(u.PIXEL_PACK_BUFFER,h),u.bufferData(u.PIXEL_PACK_BUFFER,l.byteLength,u.STREAM_READ),u.readPixels(t,e,n,i,o,a,0),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),await Lu(u,u.PIXEL_PACK_BUFFER,h,0,l),u.deleteBuffer(h),l}class xu{constructor(t,e,n){if(y(this,"onDisposed",new at),y(this,"onViewUpdated",new at),y(this,"enabled",!0),y(this,"needsUpdate",!1),y(this,"renderDebugFrame",!1),y(this,"components"),y(this,"world"),y(this,"renderer"),y(this,"autoUpdate",!0),y(this,"updateInterval",1e3),y(this,"worker"),y(this,"scene",new Dr),y(this,"_width",512),y(this,"_height",512),y(this,"_availableColor",1),y(this,"renderTarget"),y(this,"bufferSize"),y(this,"_buffer"),y(this,"updateVisibility",async a=>{if(!this.enabled||!this.needsUpdate&&!a)return;const l=this.world.camera.three;l.updateMatrix(),this.renderer.setSize(this._width,this._height),this.renderer.setRenderTarget(this.renderTarget),this.renderer.render(this.scene,l);const h=this.renderer.getContext();await Mu(h,0,0,this._width,this._height,h.RGBA,h.UNSIGNED_BYTE,this._buffer),this.renderer.setRenderTarget(null),this.renderDebugFrame&&this.renderer.render(this.scene,l),this.worker.postMessage({buffer:this._buffer}),this.needsUpdate=!1}),!e.renderer)throw new Error("The given world must have a renderer!");this.components=t,this.applySettings(n),this.world=e,this.renderer=new to,this.renderTarget=new Bc(this._width,this._height),this.bufferSize=this._width*this._height*4,this._buffer=new Uint8Array(this.bufferSize),this.renderer.clippingPlanes=e.renderer.clippingPlanes;const i=`
      addEventListener("message", (event) => {
        const { buffer } = event.data;
        const colors = new Map();
        for (let i = 0; i < buffer.length; i += 4) {
          const r = buffer[i];
          const g = buffer[i + 1];
          const b = buffer[i + 2];
          const code = "" + r + "-" + g + "-" + b;
          if(colors.has(code)) {
            colors.set(code, colors.get(code) + 1);
          } else {
            colors.set(code, 1);
          }
        }
        postMessage({ colors });
      });
    `,o=new Blob([i],{type:"application/javascript"});this.worker=new Worker(URL.createObjectURL(o))}dispose(){this.enabled=!1;for(const t of this.scene.children)t.removeFromParent();this.onViewUpdated.reset(),this.worker.terminate(),this.renderer.dispose(),this.renderTarget.dispose(),this._buffer=null,this.onDisposed.reset()}getAvailableColor(){let t=BigInt(this._availableColor.toString());const e=[];do e.unshift(Number(t%256n)),t/=256n;while(t);for(;e.length!==3;)e.unshift(0);const[n,i,o]=e,a=`${n}-${i}-${o}`;return{r:n,g:i,b:o,code:a}}increaseColor(){if(this._availableColor===256*256*256){console.warn("Color can't be increased over 256 x 256 x 256!");return}this._availableColor++}decreaseColor(){if(this._availableColor===1){console.warn("Color can't be decreased under 0!");return}this._availableColor--}applySettings(t){t&&(t.updateInterval!==void 0&&(this.updateInterval=t.updateInterval),t.height!==void 0&&(this._height=t.height),t.width!==void 0&&(this._width=t.width),t.autoUpdate!==void 0&&(this.autoUpdate=t.autoUpdate))}}class Du extends xu{constructor(t,e,n){super(t,e,n),y(this,"threshold",100),y(this,"onViewUpdated",new at),y(this,"colorMeshes",new Map),y(this,"isProcessing",!1),y(this,"_colorCodeMeshMap",new Map),y(this,"_meshIDColorCodeMap",new Map),y(this,"_currentVisibleMeshes",new Set),y(this,"_recentlyHiddenMeshes",new Set),y(this,"_transparentMat",new qn({transparent:!0,opacity:0})),y(this,"handleWorkerMessage",async i=>{if(this.isProcessing)return;const o=i.data.colors;this._recentlyHiddenMeshes=new Set(this._currentVisibleMeshes),this._currentVisibleMeshes.clear();for(const[a,l]of o){if(l<this.threshold)continue;const h=this._colorCodeMeshMap.get(a);h&&(this._currentVisibleMeshes.add(h),this._recentlyHiddenMeshes.delete(h))}this.onViewUpdated.trigger({seen:this._currentVisibleMeshes,unseen:this._recentlyHiddenMeshes})}),this.worker.addEventListener("message",this.handleWorkerMessage),this.autoUpdate&&window.setInterval(async()=>{this.isProcessing||await this.updateVisibility()},this.updateInterval),this.onViewUpdated.add(({seen:i,unseen:o})=>{for(const a of i)a.visible=!0;for(const a of o)a.visible=!1})}dispose(){super.dispose(),this._currentVisibleMeshes.clear(),this._recentlyHiddenMeshes.clear(),this._meshIDColorCodeMap.clear(),this._transparentMat.dispose(),this._colorCodeMeshMap.clear();const t=this.components.get(Jn);for(const e in this.colorMeshes){const n=this.colorMeshes.get(e);n&&t.destroy(n,!0)}this.colorMeshes.clear()}add(t){if(!this.enabled)return;if(this.isProcessing){console.log("Culler processing not finished yet.");return}this.isProcessing=!0;const e=t instanceof Zn,{geometry:n,material:i}=t,{colorMaterial:o,code:a}=this.getAvailableMaterial();let l;if(Array.isArray(i)){let m=!0;const I=[];for(const f of i)Da.isTransparent(f)?I.push(this._transparentMat):(m=!1,I.push(o));if(m){o.dispose(),this.isProcessing=!1;return}l=I}else if(Da.isTransparent(i)){o.dispose(),this.isProcessing=!1;return}else l=o;this._colorCodeMeshMap.set(a,t),this._meshIDColorCodeMap.set(t.uuid,a);const h=e?t.count:1,p=new Zn(n,l,h);e?p.instanceMatrix=t.instanceMatrix:p.setMatrixAt(0,new Mt),t.visible=!1,p.applyMatrix4(t.matrix),p.updateMatrix(),this.scene.add(p),this.colorMeshes.set(t.uuid,p),this.increaseColor(),this.isProcessing=!1}remove(t){if(this.isProcessing){console.log("Culler processing not finished yet.");return}this.isProcessing=!0;const e=this.components.get(Jn);this._currentVisibleMeshes.delete(t),this._recentlyHiddenMeshes.delete(t);const n=this.colorMeshes.get(t.uuid),i=this._meshIDColorCodeMap.get(t.uuid);if(!n||!i){this.isProcessing=!1,console.log(t.visible);return}this._colorCodeMeshMap.delete(i),this._meshIDColorCodeMap.delete(t.uuid),this.colorMeshes.delete(t.uuid),n.geometry=void 0,n.material=[],e.destroy(n,!0),this._recentlyHiddenMeshes.delete(t),this._currentVisibleMeshes.delete(t),this.isProcessing=!1}getAvailableMaterial(){const{r:t,g:e,b:n,code:i}=this.getAvailableColor(),o=Ns.enabled;Ns.enabled=!1;const a=new Wn(`rgb(${t}, ${e}, ${n})`);if(!this.world.renderer)throw new Error("Renderer not found in the world!");const l=this.world.renderer.clippingPlanes,h=new qn({color:a,clippingPlanes:l,side:kr});return Ns.enabled=o,{colorMaterial:h,code:i}}}const Uu=class fo extends Jt{constructor(t){super(t),y(this,"_enabled",!0),y(this,"list",new Map),y(this,"onDisposed",new at),t.add(fo.uuid,this)}get enabled(){return this._enabled}set enabled(t){this._enabled=t;for(const[e,n]of this.list)n.enabled=t}create(t,e){if(this.list.has(t.uuid))return this.list.get(t.uuid);const n=new Du(this.components,t,e);return this.list.set(t.uuid,n),n}delete(t){const e=this.list.get(t.uuid);e&&e.dispose(),this.list.delete(t.uuid)}dispose(){this.enabled=!1,this.onDisposed.trigger(fo.uuid),this.onDisposed.reset();for(const[t,e]of this.list)e.dispose();this.list.clear()}};y(Uu,"uuid","69f2a50d-c266-44fc-b1bd-fa4d34be89e6");const Bu=class Ge extends Jt{constructor(t){super(t),y(this,"enabled",!0),y(this,"onDisposed",new at),y(this,"_absoluteMin"),y(this,"_absoluteMax"),y(this,"_meshes",[]),this.components.add(Ge.uuid,this),this._absoluteMin=Ge.newBound(!0),this._absoluteMax=Ge.newBound(!1)}static getDimensions(t){const{min:e,max:n}=t,i=Math.abs(n.x-e.x),o=Math.abs(n.y-e.y),a=Math.abs(n.z-e.z),l=new q;return l.subVectors(n,e).divideScalar(2).add(e),{width:i,height:o,depth:a,center:l}}static newBound(t){const e=t?1:-1;return new q(e*Number.MAX_VALUE,e*Number.MAX_VALUE,e*Number.MAX_VALUE)}static getBounds(t,e,n){const i=n||this.newBound(!1),o=e||this.newBound(!0);for(const a of t)a.x<o.x&&(o.x=a.x),a.y<o.y&&(o.y=a.y),a.z<o.z&&(o.z=a.z),a.x>i.x&&(i.x=a.x),a.y>i.y&&(i.y=a.y),a.z>i.z&&(i.z=a.z);return new $t(e,n)}dispose(){const t=this.components.get(Jn);for(const e of this._meshes)t.destroy(e);this._meshes=[],this.onDisposed.trigger(Ge.uuid),this.onDisposed.reset()}get(){const t=this._absoluteMin.clone(),e=this._absoluteMax.clone();return new $t(t,e)}getSphere(){const t=this._absoluteMin.clone(),e=this._absoluteMax.clone(),n=Math.abs((e.x-t.x)/2),i=Math.abs((e.y-t.y)/2),o=Math.abs((e.z-t.z)/2),a=new q(t.x+n,t.y+i,t.z+o),l=a.distanceTo(t);return new yo(a,l)}getMesh(){const t=new $t(this._absoluteMin,this._absoluteMax),e=Ge.getDimensions(t),{width:n,height:i,depth:o,center:a}=e,l=new Zt(n,i,o),h=new lt(l);return this._meshes.push(h),h.position.copy(a),h}reset(){this._absoluteMin=Ge.newBound(!0),this._absoluteMax=Ge.newBound(!1)}add(t){for(const e of t.items)this.addMesh(e.mesh)}addMesh(t){if(!t.geometry.index)return;const e=Ge.getFragmentBounds(t);t.updateMatrixWorld();const n=t.matrixWorld,i=new Mt,o=t instanceof Zn,a=o?t.count:1;for(let l=0;l<a;l++){const h=e.min.clone(),p=e.max.clone();o&&(t.getMatrixAt(l,i),h.applyMatrix4(i),p.applyMatrix4(i)),h.applyMatrix4(n),p.applyMatrix4(n),h.x<this._absoluteMin.x&&(this._absoluteMin.x=h.x),h.y<this._absoluteMin.y&&(this._absoluteMin.y=h.y),h.z<this._absoluteMin.z&&(this._absoluteMin.z=h.z),h.x>this._absoluteMax.x&&(this._absoluteMax.x=h.x),h.y>this._absoluteMax.y&&(this._absoluteMax.y=h.y),h.z>this._absoluteMax.z&&(this._absoluteMax.z=h.z),p.x>this._absoluteMax.x&&(this._absoluteMax.x=p.x),p.y>this._absoluteMax.y&&(this._absoluteMax.y=p.y),p.z>this._absoluteMax.z&&(this._absoluteMax.z=p.z),p.x<this._absoluteMin.x&&(this._absoluteMin.x=p.x),p.y<this._absoluteMin.y&&(this._absoluteMin.y=p.y),p.z<this._absoluteMin.z&&(this._absoluteMin.z=p.z)}}static getFragmentBounds(t){const e=t.geometry.attributes.position,n=Number.MAX_VALUE,i=-n,o=new q(n,n,n),a=new q(i,i,i);if(!t.geometry.index)throw new Error("Geometry must be indexed!");const l=Array.from(t.geometry.index.array);for(let h=0;h<l.length;h++){if(h%3===0&&l[h]===0&&l[h+1]===0&&l[h+2]===0){h+=2;continue}const p=l[h],m=e.getX(p),I=e.getY(p),f=e.getZ(p);m<o.x&&(o.x=m),I<o.y&&(o.y=I),f<o.z&&(o.z=f),m>a.x&&(a.x=m),I>a.y&&(a.y=I),f>a.z&&(a.z=f)}return new $t(o,a)}};y(Bu,"uuid","d1444724-dba6-4cdd-a0c7-68ee1450d166");const Dl=new Set([1123145078,574549367,1675464909,2059837836,3798115385,32440307,3125803723,3207858831,2740243338,2624227202,4240577450,3615266464,3724593414,220341763,477187591,1878645084,1300840506,3303107099,1607154358,1878645084,846575682,1351298697,2417041796,3049322572,3331915920,1416205885,776857604,3285139300,3958052878,2827736869,2732653382,673634403,3448662350,4142052618,2924175390,803316827,2556980723,1809719519,2205249479,807026263,3737207727,1660063152,2347385850,3940055652,2705031697,3732776249,2485617015,2611217952,1704287377,2937912522,2770003689,1281925730,1484403080,3448662350,4142052618,3800577675,4006246654,3590301190,1383045692,2775532180,2047409740,370225590,3593883385,2665983363,4124623270,812098782,3649129432,987898635,1105321065,3510044353,1635779807,2603310189,3406155212,1310608509,4261334040,2736907675,3649129432,1136057603,1260505505,4182860854,2713105998,2898889636,59481748,3749851601,3486308946,3150382593,1062206242,3264961684,15328376,1485152156,370225590,1981873012,2859738748,45288368,2614616156,2732653382,775493141,2147822146,2601014836,2629017746,1186437898,2367409068,1213902940,3632507154,3900360178,476780140,1472233963,2804161546,3008276851,738692330,374418227,315944413,3905492369,3570813810,2571569899,178912537,2294589976,1437953363,2133299955,572779678,3092502836,388784114,2624227202,1425443689,3057273783,2347385850,1682466193,2519244187,2839578677,3958567839,2513912981,2830218821,427810014]);class Yu{async export(t,e,n=!1,i=!0){const o={},a=new Set(t.GetIfcEntityList(e)),l=new Set([El,fl,Il,ml,tr]);for(const h of l)a.add(h);for(const h of a){if(Dl.has(h))continue;const p=l.has(h)&&i,m=t.GetLineIDsWithType(e,h);for(const I of m){const f=t.GetLine(0,I,p,n);o[f.expressID]=f}}return o}}const Ul={950732822:"IFCURIREFERENCE",4075327185:"IFCTIME",1209108979:"IFCTEMPERATURERATEOFCHANGEMEASURE",3457685358:"IFCSOUNDPRESSURELEVELMEASURE",4157543285:"IFCSOUNDPOWERLEVELMEASURE",2798247006:"IFCPROPERTYSETDEFINITIONSET",1790229001:"IFCPOSITIVEINTEGER",525895558:"IFCNONNEGATIVELENGTHMEASURE",1774176899:"IFCLINEINDEX",1275358634:"IFCLANGUAGEID",2541165894:"IFCDURATION",3701338814:"IFCDAYINWEEKNUMBER",2195413836:"IFCDATETIME",937566702:"IFCDATE",1683019596:"IFCCARDINALPOINTREFERENCE",2314439260:"IFCBINARY",1500781891:"IFCAREADENSITYMEASURE",3683503648:"IFCARCINDEX",4065007721:"IFCYEARNUMBER",1718600412:"IFCWARPINGMOMENTMEASURE",51269191:"IFCWARPINGCONSTANTMEASURE",2593997549:"IFCVOLUMETRICFLOWRATEMEASURE",3458127941:"IFCVOLUMEMEASURE",3345633955:"IFCVAPORPERMEABILITYMEASURE",1278329552:"IFCTORQUEMEASURE",2591213694:"IFCTIMESTAMP",2726807636:"IFCTIMEMEASURE",743184107:"IFCTHERMODYNAMICTEMPERATUREMEASURE",2016195849:"IFCTHERMALTRANSMITTANCEMEASURE",857959152:"IFCTHERMALRESISTANCEMEASURE",2281867870:"IFCTHERMALEXPANSIONCOEFFICIENTMEASURE",2645777649:"IFCTHERMALCONDUCTIVITYMEASURE",232962298:"IFCTHERMALADMITTANCEMEASURE",296282323:"IFCTEXTTRANSFORMATION",603696268:"IFCTEXTFONTNAME",3490877962:"IFCTEXTDECORATION",1460886941:"IFCTEXTALIGNMENT",2801250643:"IFCTEXT",58845555:"IFCTEMPERATUREGRADIENTMEASURE",361837227:"IFCSPECULARROUGHNESS",2757832317:"IFCSPECULAREXPONENT",3477203348:"IFCSPECIFICHEATCAPACITYMEASURE",993287707:"IFCSOUNDPRESSUREMEASURE",846465480:"IFCSOUNDPOWERMEASURE",3471399674:"IFCSOLIDANGLEMEASURE",408310005:"IFCSHEARMODULUSMEASURE",2190458107:"IFCSECTIONALAREAINTEGRALMEASURE",3467162246:"IFCSECTIONMODULUSMEASURE",2766185779:"IFCSECONDINMINUTE",3211557302:"IFCROTATIONALSTIFFNESSMEASURE",1755127002:"IFCROTATIONALMASSMEASURE",2133746277:"IFCROTATIONALFREQUENCYMEASURE",200335297:"IFCREAL",96294661:"IFCRATIOMEASURE",3972513137:"IFCRADIOACTIVITYMEASURE",3665567075:"IFCPRESSUREMEASURE",2169031380:"IFCPRESENTABLETEXT",1364037233:"IFCPOWERMEASURE",1245737093:"IFCPOSITIVERATIOMEASURE",3054510233:"IFCPOSITIVEPLANEANGLEMEASURE",2815919920:"IFCPOSITIVELENGTHMEASURE",4042175685:"IFCPLANEANGLEMEASURE",2642773653:"IFCPLANARFORCEMEASURE",2260317790:"IFCPARAMETERVALUE",929793134:"IFCPHMEASURE",2395907400:"IFCNUMERICMEASURE",2095195183:"IFCNORMALISEDRATIOMEASURE",765770214:"IFCMONTHINYEARNUMBER",2615040989:"IFCMONETARYMEASURE",3114022597:"IFCMOMENTOFINERTIAMEASURE",1648970520:"IFCMOLECULARWEIGHTMEASURE",3177669450:"IFCMOISTUREDIFFUSIVITYMEASURE",1753493141:"IFCMODULUSOFSUBGRADEREACTIONMEASURE",1052454078:"IFCMODULUSOFROTATIONALSUBGRADEREACTIONMEASURE",2173214787:"IFCMODULUSOFLINEARSUBGRADEREACTIONMEASURE",3341486342:"IFCMODULUSOFELASTICITYMEASURE",102610177:"IFCMINUTEINHOUR",3531705166:"IFCMASSPERLENGTHMEASURE",3124614049:"IFCMASSMEASURE",4017473158:"IFCMASSFLOWRATEMEASURE",1477762836:"IFCMASSDENSITYMEASURE",2486716878:"IFCMAGNETICFLUXMEASURE",286949696:"IFCMAGNETICFLUXDENSITYMEASURE",151039812:"IFCLUMINOUSINTENSITYMEASURE",2755797622:"IFCLUMINOUSINTENSITYDISTRIBUTIONMEASURE",2095003142:"IFCLUMINOUSFLUXMEASURE",503418787:"IFCLOGICAL",3086160713:"IFCLINEARVELOCITYMEASURE",1307019551:"IFCLINEARSTIFFNESSMEASURE",2128979029:"IFCLINEARMOMENTMEASURE",191860431:"IFCLINEARFORCEMEASURE",1243674935:"IFCLENGTHMEASURE",3258342251:"IFCLABEL",2054016361:"IFCKINEMATICVISCOSITYMEASURE",3192672207:"IFCISOTHERMALMOISTURECAPACITYMEASURE",3686016028:"IFCIONCONCENTRATIONMEASURE",3809634241:"IFCINTEGERCOUNTRATEMEASURE",1939436016:"IFCINTEGER",2679005408:"IFCINDUCTANCEMEASURE",3358199106:"IFCILLUMINANCEMEASURE",983778844:"IFCIDENTIFIER",2589826445:"IFCHOURINDAY",1158859006:"IFCHEATINGVALUEMEASURE",3113092358:"IFCHEATFLUXDENSITYMEASURE",3064340077:"IFCGLOBALLYUNIQUEID",3044325142:"IFCFREQUENCYMEASURE",1361398929:"IFCFORCEMEASURE",2590844177:"IFCFONTWEIGHT",2715512545:"IFCFONTVARIANT",1102727119:"IFCFONTSTYLE",2078135608:"IFCENERGYMEASURE",2506197118:"IFCELECTRICVOLTAGEMEASURE",2951915441:"IFCELECTRICRESISTANCEMEASURE",3790457270:"IFCELECTRICCURRENTMEASURE",2093906313:"IFCELECTRICCONDUCTANCEMEASURE",3818826038:"IFCELECTRICCHARGEMEASURE",1827137117:"IFCELECTRICCAPACITANCEMEASURE",69416015:"IFCDYNAMICVISCOSITYMEASURE",524656162:"IFCDOSEEQUIVALENTMEASURE",4134073009:"IFCDIMENSIONCOUNT",1514641115:"IFCDESCRIPTIVEMEASURE",300323983:"IFCDAYLIGHTSAVINGHOUR",86635668:"IFCDAYINMONTHNUMBER",94842927:"IFCCURVATUREMEASURE",1778710042:"IFCCOUNTMEASURE",3238673880:"IFCCONTEXTDEPENDENTMEASURE",3812528620:"IFCCOMPOUNDPLANEANGLEMEASURE",2991860651:"IFCCOMPLEXNUMBER",1867003952:"IFCBOXALIGNMENT",2735952531:"IFCBOOLEAN",2650437152:"IFCAREAMEASURE",632304761:"IFCANGULARVELOCITYMEASURE",360377573:"IFCAMOUNTOFSUBSTANCEMEASURE",4182062534:"IFCACCELERATIONMEASURE",3699917729:"IFCABSORBEDDOSEMEASURE",1971632696:"IFCGEOSLICE",2680139844:"IFCGEOMODEL",24726584:"IFCELECTRICFLOWTREATMENTDEVICE",3693000487:"IFCDISTRIBUTIONBOARD",3460952963:"IFCCONVEYORSEGMENT",3999819293:"IFCCAISSONFOUNDATION",3314249567:"IFCBOREHOLE",4196446775:"IFCBEARING",325726236:"IFCALIGNMENT",3425753595:"IFCTRACKELEMENT",991950508:"IFCSIGNAL",3798194928:"IFCREINFORCEDSOIL",3290496277:"IFCRAIL",1383356374:"IFCPAVEMENT",2182337498:"IFCNAVIGATIONELEMENT",234836483:"IFCMOORINGDEVICE",2078563270:"IFCMOBILETELECOMMUNICATIONSAPPLIANCE",1638804497:"IFCLIQUIDTERMINAL",1154579445:"IFCLINEARPOSITIONINGELEMENT",2696325953:"IFCKERB",2713699986:"IFCGEOTECHNICALASSEMBLY",2142170206:"IFCELECTRICFLOWTREATMENTDEVICETYPE",3376911765:"IFCEARTHWORKSFILL",1077100507:"IFCEARTHWORKSELEMENT",3071239417:"IFCEARTHWORKSCUT",479945903:"IFCDISTRIBUTIONBOARDTYPE",3426335179:"IFCDEEPFOUNDATION",1502416096:"IFCCOURSE",2940368186:"IFCCONVEYORSEGMENTTYPE",3203706013:"IFCCAISSONFOUNDATIONTYPE",3862327254:"IFCBUILTSYSTEM",1876633798:"IFCBUILTELEMENT",963979645:"IFCBRIDGEPART",644574406:"IFCBRIDGE",3649138523:"IFCBEARINGTYPE",1662888072:"IFCALIGNMENTVERTICAL",317615605:"IFCALIGNMENTSEGMENT",1545765605:"IFCALIGNMENTHORIZONTAL",4266260250:"IFCALIGNMENTCANT",3956297820:"IFCVIBRATIONDAMPERTYPE",1530820697:"IFCVIBRATIONDAMPER",840318589:"IFCVEHICLE",1953115116:"IFCTRANSPORTATIONDEVICE",618700268:"IFCTRACKELEMENTTYPE",2281632017:"IFCTENDONCONDUITTYPE",3663046924:"IFCTENDONCONDUIT",42703149:"IFCSINESPIRAL",1894708472:"IFCSIGNALTYPE",3599934289:"IFCSIGNTYPE",33720170:"IFCSIGN",1027922057:"IFCSEVENTHORDERPOLYNOMIALSPIRAL",544395925:"IFCSEGMENTEDREFERENCECURVE",3649235739:"IFCSECONDORDERPOLYNOMIALSPIRAL",550521510:"IFCROADPART",146592293:"IFCROAD",3818125796:"IFCRELADHERESTOELEMENT",4021432810:"IFCREFERENT",1891881377:"IFCRAILWAYPART",3992365140:"IFCRAILWAY",1763565496:"IFCRAILTYPE",1946335990:"IFCPOSITIONINGELEMENT",514975943:"IFCPAVEMENTTYPE",506776471:"IFCNAVIGATIONELEMENTTYPE",710110818:"IFCMOORINGDEVICETYPE",1950438474:"IFCMOBILETELECOMMUNICATIONSAPPLIANCETYPE",976884017:"IFCMARINEPART",525669439:"IFCMARINEFACILITY",1770583370:"IFCLIQUIDTERMINALTYPE",2176059722:"IFCLINEARELEMENT",679976338:"IFCKERBTYPE",3948183225:"IFCIMPACTPROTECTIONDEVICETYPE",2568555532:"IFCIMPACTPROTECTIONDEVICE",2898700619:"IFCGRADIENTCURVE",1594536857:"IFCGEOTECHNICALSTRATUM",4230923436:"IFCGEOTECHNICALELEMENT",4228831410:"IFCFACILITYPARTCOMMON",1310830890:"IFCFACILITYPART",24185140:"IFCFACILITY",4234616927:"IFCDIRECTRIXDERIVEDREFERENCESWEPTAREASOLID",1306400036:"IFCDEEPFOUNDATIONTYPE",4189326743:"IFCCOURSETYPE",2000195564:"IFCCOSINESPIRAL",3497074424:"IFCCLOTHOID",1626504194:"IFCBUILTELEMENTTYPE",3651464721:"IFCVEHICLETYPE",1229763772:"IFCTRIANGULATEDIRREGULARNETWORK",3665877780:"IFCTRANSPORTATIONDEVICETYPE",782932809:"IFCTHIRDORDERPOLYNOMIALSPIRAL",2735484536:"IFCSPIRAL",1356537516:"IFCSECTIONEDSURFACE",1290935644:"IFCSECTIONEDSOLIDHORIZONTAL",1862484736:"IFCSECTIONEDSOLID",1441486842:"IFCRELPOSITIONS",1033248425:"IFCRELASSOCIATESPROFILEDEF",3381221214:"IFCPOLYNOMIALCURVE",2485787929:"IFCOFFSETCURVEBYDISTANCES",590820931:"IFCOFFSETCURVE",3465909080:"IFCINDEXEDPOLYGONALTEXTUREMAP",593015953:"IFCDIRECTRIXCURVESWEPTAREASOLID",4212018352:"IFCCURVESEGMENT",3425423356:"IFCAXIS2PLACEMENTLINEAR",823603102:"IFCSEGMENT",2165702409:"IFCPOINTBYDISTANCEEXPRESSION",182550632:"IFCOPENCROSSPROFILEDEF",388784114:"IFCLINEARPLACEMENT",536804194:"IFCALIGNMENTHORIZONTALSEGMENT",3752311538:"IFCALIGNMENTCANTSEGMENT",1010789467:"IFCTEXTURECOORDINATEINDICESWITHVOIDS",222769930:"IFCTEXTURECOORDINATEINDICES",2691318326:"IFCQUANTITYNUMBER",3633395639:"IFCALIGNMENTVERTICALSEGMENT",2879124712:"IFCALIGNMENTPARAMETERSEGMENT",25142252:"IFCCONTROLLER",3087945054:"IFCALARM",4288193352:"IFCACTUATOR",630975310:"IFCUNITARYCONTROLELEMENT",4086658281:"IFCSENSOR",2295281155:"IFCPROTECTIVEDEVICETRIPPINGUNIT",182646315:"IFCFLOWINSTRUMENT",1426591983:"IFCFIRESUPPRESSIONTERMINAL",819412036:"IFCFILTER",3415622556:"IFCFAN",1003880860:"IFCELECTRICTIMECONTROL",402227799:"IFCELECTRICMOTOR",264262732:"IFCELECTRICGENERATOR",3310460725:"IFCELECTRICFLOWSTORAGEDEVICE",862014818:"IFCELECTRICDISTRIBUTIONBOARD",1904799276:"IFCELECTRICAPPLIANCE",1360408905:"IFCDUCTSILENCER",3518393246:"IFCDUCTSEGMENT",342316401:"IFCDUCTFITTING",562808652:"IFCDISTRIBUTIONCIRCUIT",4074379575:"IFCDAMPER",3640358203:"IFCCOOLINGTOWER",4136498852:"IFCCOOLEDBEAM",2272882330:"IFCCONDENSER",3571504051:"IFCCOMPRESSOR",3221913625:"IFCCOMMUNICATIONSAPPLIANCE",639361253:"IFCCOIL",3902619387:"IFCCHILLER",4217484030:"IFCCABLESEGMENT",1051757585:"IFCCABLEFITTING",3758799889:"IFCCABLECARRIERSEGMENT",635142910:"IFCCABLECARRIERFITTING",2938176219:"IFCBURNER",32344328:"IFCBOILER",2906023776:"IFCBEAMSTANDARDCASE",277319702:"IFCAUDIOVISUALAPPLIANCE",2056796094:"IFCAIRTOAIRHEATRECOVERY",177149247:"IFCAIRTERMINALBOX",1634111441:"IFCAIRTERMINAL",486154966:"IFCWINDOWSTANDARDCASE",4237592921:"IFCWASTETERMINAL",4156078855:"IFCWALLELEMENTEDCASE",4207607924:"IFCVALVE",4292641817:"IFCUNITARYEQUIPMENT",3179687236:"IFCUNITARYCONTROLELEMENTTYPE",3026737570:"IFCTUBEBUNDLE",3825984169:"IFCTRANSFORMER",812556717:"IFCTANK",1162798199:"IFCSWITCHINGDEVICE",385403989:"IFCSTRUCTURALLOADCASE",1404847402:"IFCSTACKTERMINAL",1999602285:"IFCSPACEHEATER",3420628829:"IFCSOLARDEVICE",3027962421:"IFCSLABSTANDARDCASE",3127900445:"IFCSLABELEMENTEDCASE",1329646415:"IFCSHADINGDEVICE",3053780830:"IFCSANITARYTERMINAL",2572171363:"IFCREINFORCINGBARTYPE",1232101972:"IFCRATIONALBSPLINECURVEWITHKNOTS",90941305:"IFCPUMP",655969474:"IFCPROTECTIVEDEVICETRIPPINGUNITTYPE",738039164:"IFCPROTECTIVEDEVICE",1156407060:"IFCPLATESTANDARDCASE",3612865200:"IFCPIPESEGMENT",310824031:"IFCPIPEFITTING",3694346114:"IFCOUTLET",144952367:"IFCOUTERBOUNDARYCURVE",2474470126:"IFCMOTORCONNECTION",1911478936:"IFCMEMBERSTANDARDCASE",1437502449:"IFCMEDICALDEVICE",629592764:"IFCLIGHTFIXTURE",76236018:"IFCLAMP",2176052936:"IFCJUNCTIONBOX",4175244083:"IFCINTERCEPTOR",2068733104:"IFCHUMIDIFIER",3319311131:"IFCHEATEXCHANGER",2188021234:"IFCFLOWMETER",1209101575:"IFCEXTERNALSPATIALELEMENT",484807127:"IFCEVAPORATOR",3747195512:"IFCEVAPORATIVECOOLER",2814081492:"IFCENGINE",2417008758:"IFCELECTRICDISTRIBUTIONBOARDTYPE",3242481149:"IFCDOORSTANDARDCASE",3205830791:"IFCDISTRIBUTIONSYSTEM",400855858:"IFCCOMMUNICATIONSAPPLIANCETYPE",905975707:"IFCCOLUMNSTANDARDCASE",1677625105:"IFCCIVILELEMENT",3296154744:"IFCCHIMNEY",2674252688:"IFCCABLEFITTINGTYPE",2188180465:"IFCBURNERTYPE",1177604601:"IFCBUILDINGSYSTEM",39481116:"IFCBUILDINGELEMENTPARTTYPE",1136057603:"IFCBOUNDARYCURVE",2461110595:"IFCBSPLINECURVEWITHKNOTS",1532957894:"IFCAUDIOVISUALAPPLIANCETYPE",4088093105:"IFCWORKCALENDAR",4009809668:"IFCWINDOWTYPE",926996030:"IFCVOIDINGFEATURE",2391383451:"IFCVIBRATIONISOLATOR",2415094496:"IFCTENDONTYPE",3081323446:"IFCTENDONANCHORTYPE",413509423:"IFCSYSTEMFURNITUREELEMENT",3101698114:"IFCSURFACEFEATURE",3657597509:"IFCSTRUCTURALSURFACEACTION",2757150158:"IFCSTRUCTURALCURVEREACTION",1004757350:"IFCSTRUCTURALCURVEACTION",338393293:"IFCSTAIRTYPE",1072016465:"IFCSOLARDEVICETYPE",4074543187:"IFCSHADINGDEVICETYPE",2157484638:"IFCSEAMCURVE",2781568857:"IFCROOFTYPE",2310774935:"IFCREINFORCINGMESHTYPE",964333572:"IFCREINFORCINGELEMENTTYPE",683857671:"IFCRATIONALBSPLINESURFACEWITHKNOTS",1469900589:"IFCRAMPTYPE",2839578677:"IFCPOLYGONALFACESET",1158309216:"IFCPILETYPE",3079942009:"IFCOPENINGSTANDARDCASE",1114901282:"IFCMEDICALDEVICETYPE",3113134337:"IFCINTERSECTIONCURVE",3946677679:"IFCINTERCEPTORTYPE",2571569899:"IFCINDEXEDPOLYCURVE",3493046030:"IFCGEOGRAPHICELEMENT",1509553395:"IFCFURNITURE",1893162501:"IFCFOOTINGTYPE",2853485674:"IFCEXTERNALSPATIALSTRUCTUREELEMENT",4148101412:"IFCEVENT",132023988:"IFCENGINETYPE",2397081782:"IFCELEMENTASSEMBLYTYPE",2323601079:"IFCDOORTYPE",1213902940:"IFCCYLINDRICALSURFACE",1525564444:"IFCCONSTRUCTIONPRODUCTRESOURCETYPE",4105962743:"IFCCONSTRUCTIONMATERIALRESOURCETYPE",2185764099:"IFCCONSTRUCTIONEQUIPMENTRESOURCETYPE",15328376:"IFCCOMPOSITECURVEONSURFACE",3875453745:"IFCCOMPLEXPROPERTYTEMPLATE",3893394355:"IFCCIVILELEMENTTYPE",2197970202:"IFCCHIMNEYTYPE",167062518:"IFCBSPLINESURFACEWITHKNOTS",2887950389:"IFCBSPLINESURFACE",2603310189:"IFCADVANCEDBREPWITHVOIDS",1635779807:"IFCADVANCEDBREP",2916149573:"IFCTRIANGULATEDFACESET",1935646853:"IFCTOROIDALSURFACE",2387106220:"IFCTESSELLATEDFACESET",3206491090:"IFCTASKTYPE",699246055:"IFCSURFACECURVE",4095615324:"IFCSUBCONTRACTRESOURCETYPE",603775116:"IFCSTRUCTURALSURFACEREACTION",4015995234:"IFCSPHERICALSURFACE",2481509218:"IFCSPATIALZONETYPE",463610769:"IFCSPATIALZONE",710998568:"IFCSPATIALELEMENTTYPE",1412071761:"IFCSPATIALELEMENT",3663146110:"IFCSIMPLEPROPERTYTEMPLATE",3243963512:"IFCREVOLVEDAREASOLIDTAPERED",816062949:"IFCREPARAMETRISEDCOMPOSITECURVESEGMENT",1521410863:"IFCRELSPACEBOUNDARY2NDLEVEL",3523091289:"IFCRELSPACEBOUNDARY1STLEVEL",427948657:"IFCRELINTERFERESELEMENTS",307848117:"IFCRELDEFINESBYTEMPLATE",1462361463:"IFCRELDEFINESBYOBJECT",2565941209:"IFCRELDECLARES",1027710054:"IFCRELASSIGNSTOGROUPBYFACTOR",3521284610:"IFCPROPERTYTEMPLATE",492091185:"IFCPROPERTYSETTEMPLATE",653396225:"IFCPROJECTLIBRARY",569719735:"IFCPROCEDURETYPE",3967405729:"IFCPREDEFINEDPROPERTYSET",1682466193:"IFCPCURVE",428585644:"IFCLABORRESOURCETYPE",2294589976:"IFCINDEXEDPOLYGONALFACEWITHVOIDS",178912537:"IFCINDEXEDPOLYGONALFACE",4095422895:"IFCGEOGRAPHICELEMENTTYPE",2652556860:"IFCFIXEDREFERENCESWEPTAREASOLID",2804161546:"IFCEXTRUDEDAREASOLIDTAPERED",4024345920:"IFCEVENTTYPE",2629017746:"IFCCURVEBOUNDEDSURFACE",1815067380:"IFCCREWRESOURCETYPE",3419103109:"IFCCONTEXT",2574617495:"IFCCONSTRUCTIONRESOURCETYPE",2059837836:"IFCCARTESIANPOINTLIST3D",1675464909:"IFCCARTESIANPOINTLIST2D",574549367:"IFCCARTESIANPOINTLIST",3406155212:"IFCADVANCEDFACE",3698973494:"IFCTYPERESOURCE",3736923433:"IFCTYPEPROCESS",901063453:"IFCTESSELLATEDITEM",1096409881:"IFCSWEPTDISKSOLIDPOLYGONAL",1042787934:"IFCRESOURCETIME",1608871552:"IFCRESOURCECONSTRAINTRELATIONSHIP",2943643501:"IFCRESOURCEAPPROVALRELATIONSHIP",2090586900:"IFCQUANTITYSET",1482703590:"IFCPROPERTYTEMPLATEDEFINITION",3778827333:"IFCPREDEFINEDPROPERTIES",2998442950:"IFCMIRROREDPROFILEDEF",853536259:"IFCMATERIALRELATIONSHIP",3404854881:"IFCMATERIALPROFILESETUSAGETAPERING",3079605661:"IFCMATERIALPROFILESETUSAGE",2852063980:"IFCMATERIALCONSTITUENTSET",3708119e3:"IFCMATERIALCONSTITUENT",1585845231:"IFCLAGTIME",2133299955:"IFCINDEXEDTRIANGLETEXTUREMAP",1437953363:"IFCINDEXEDTEXTUREMAP",3570813810:"IFCINDEXEDCOLOURMAP",1437805879:"IFCEXTERNALREFERENCERELATIONSHIP",297599258:"IFCEXTENDEDPROPERTIES",211053100:"IFCEVENTTIME",2713554722:"IFCCONVERSIONBASEDUNITWITHOFFSET",3285139300:"IFCCOLOURRGBLIST",1236880293:"IFCWORKTIME",1199560280:"IFCTIMEPERIOD",3611470254:"IFCTEXTUREVERTEXLIST",2771591690:"IFCTASKTIMERECURRING",1549132990:"IFCTASKTIME",2043862942:"IFCTABLECOLUMN",2934153892:"IFCSURFACEREINFORCEMENTAREA",609421318:"IFCSTRUCTURALLOADORRESULT",3478079324:"IFCSTRUCTURALLOADCONFIGURATION",1054537805:"IFCSCHEDULINGTIME",2439245199:"IFCRESOURCELEVELRELATIONSHIP",2433181523:"IFCREFERENCE",3915482550:"IFCRECURRENCEPATTERN",986844984:"IFCPROPERTYABSTRACTION",3843373140:"IFCPROJECTEDCRS",677532197:"IFCPRESENTATIONITEM",1507914824:"IFCMATERIALUSAGEDEFINITION",552965576:"IFCMATERIALPROFILEWITHOFFSETS",164193824:"IFCMATERIALPROFILESET",2235152071:"IFCMATERIALPROFILE",1847252529:"IFCMATERIALLAYERWITHOFFSETS",760658860:"IFCMATERIALDEFINITION",3057273783:"IFCMAPCONVERSION",4294318154:"IFCEXTERNALINFORMATION",1466758467:"IFCCOORDINATEREFERENCESYSTEM",1785450214:"IFCCOORDINATEOPERATION",775493141:"IFCCONNECTIONVOLUMEGEOMETRY",979691226:"IFCREINFORCINGBAR",3700593921:"IFCELECTRICDISTRIBUTIONPOINT",1062813311:"IFCDISTRIBUTIONCONTROLELEMENT",1052013943:"IFCDISTRIBUTIONCHAMBERELEMENT",578613899:"IFCCONTROLLERTYPE",2454782716:"IFCCHAMFEREDGEFEATURE",753842376:"IFCBEAM",3001207471:"IFCALARMTYPE",2874132201:"IFCACTUATORTYPE",3304561284:"IFCWINDOW",3512223829:"IFCWALLSTANDARDCASE",2391406946:"IFCWALL",3313531582:"IFCVIBRATIONISOLATORTYPE",2347447852:"IFCTENDONANCHOR",3824725483:"IFCTENDON",2515109513:"IFCSTRUCTURALANALYSISMODEL",4252922144:"IFCSTAIRFLIGHT",331165859:"IFCSTAIR",1529196076:"IFCSLAB",1783015770:"IFCSENSORTYPE",1376911519:"IFCROUNDEDEDGEFEATURE",2016517767:"IFCROOF",2320036040:"IFCREINFORCINGMESH",3027567501:"IFCREINFORCINGELEMENT",3055160366:"IFCRATIONALBEZIERCURVE",3283111854:"IFCRAMPFLIGHT",3024970846:"IFCRAMP",2262370178:"IFCRAILING",3171933400:"IFCPLATE",1687234759:"IFCPILE",1073191201:"IFCMEMBER",900683007:"IFCFOOTING",3508470533:"IFCFLOWTREATMENTDEVICE",2223149337:"IFCFLOWTERMINAL",707683696:"IFCFLOWSTORAGEDEVICE",987401354:"IFCFLOWSEGMENT",3132237377:"IFCFLOWMOVINGDEVICE",4037862832:"IFCFLOWINSTRUMENTTYPE",4278956645:"IFCFLOWFITTING",2058353004:"IFCFLOWCONTROLLER",4222183408:"IFCFIRESUPPRESSIONTERMINALTYPE",1810631287:"IFCFILTERTYPE",346874300:"IFCFANTYPE",1658829314:"IFCENERGYCONVERSIONDEVICE",857184966:"IFCELECTRICALELEMENT",1634875225:"IFCELECTRICALCIRCUIT",712377611:"IFCELECTRICTIMECONTROLTYPE",1217240411:"IFCELECTRICMOTORTYPE",1365060375:"IFCELECTRICHEATERTYPE",1534661035:"IFCELECTRICGENERATORTYPE",3277789161:"IFCELECTRICFLOWSTORAGEDEVICETYPE",663422040:"IFCELECTRICAPPLIANCETYPE",855621170:"IFCEDGEFEATURE",2030761528:"IFCDUCTSILENCERTYPE",3760055223:"IFCDUCTSEGMENTTYPE",869906466:"IFCDUCTFITTINGTYPE",395920057:"IFCDOOR",3041715199:"IFCDISTRIBUTIONPORT",3040386961:"IFCDISTRIBUTIONFLOWELEMENT",1945004755:"IFCDISTRIBUTIONELEMENT",2063403501:"IFCDISTRIBUTIONCONTROLELEMENTTYPE",1599208980:"IFCDISTRIBUTIONCHAMBERELEMENTTYPE",2635815018:"IFCDISCRETEACCESSORYTYPE",1335981549:"IFCDISCRETEACCESSORY",4147604152:"IFCDIAMETERDIMENSION",3961806047:"IFCDAMPERTYPE",3495092785:"IFCCURTAINWALL",1973544240:"IFCCOVERING",2954562838:"IFCCOOLINGTOWERTYPE",335055490:"IFCCOOLEDBEAMTYPE",488727124:"IFCCONSTRUCTIONPRODUCTRESOURCE",1060000209:"IFCCONSTRUCTIONMATERIALRESOURCE",3898045240:"IFCCONSTRUCTIONEQUIPMENTRESOURCE",1163958913:"IFCCONDITIONCRITERION",2188551683:"IFCCONDITION",2816379211:"IFCCONDENSERTYPE",3850581409:"IFCCOMPRESSORTYPE",843113511:"IFCCOLUMN",2301859152:"IFCCOILTYPE",2611217952:"IFCCIRCLE",2951183804:"IFCCHILLERTYPE",1285652485:"IFCCABLESEGMENTTYPE",3293546465:"IFCCABLECARRIERSEGMENTTYPE",395041908:"IFCCABLECARRIERFITTINGTYPE",1909888760:"IFCBUILDINGELEMENTPROXYTYPE",1095909175:"IFCBUILDINGELEMENTPROXY",2979338954:"IFCBUILDINGELEMENTPART",52481810:"IFCBUILDINGELEMENTCOMPONENT",3299480353:"IFCBUILDINGELEMENT",231477066:"IFCBOILERTYPE",1916977116:"IFCBEZIERCURVE",819618141:"IFCBEAMTYPE",1967976161:"IFCBSPLINECURVE",3460190687:"IFCASSET",2470393545:"IFCANGULARDIMENSION",1871374353:"IFCAIRTOAIRHEATRECOVERYTYPE",3352864051:"IFCAIRTERMINALTYPE",1411407467:"IFCAIRTERMINALBOXTYPE",3821786052:"IFCACTIONREQUEST",1213861670:"IFC2DCOMPOSITECURVE",1033361043:"IFCZONE",3342526732:"IFCWORKSCHEDULE",4218914973:"IFCWORKPLAN",1028945134:"IFCWORKCONTROL",1133259667:"IFCWASTETERMINALTYPE",1898987631:"IFCWALLTYPE",2769231204:"IFCVIRTUALELEMENT",728799441:"IFCVALVETYPE",1911125066:"IFCUNITARYEQUIPMENTTYPE",1600972822:"IFCTUBEBUNDLETYPE",3593883385:"IFCTRIMMEDCURVE",1620046519:"IFCTRANSPORTELEMENT",1692211062:"IFCTRANSFORMERTYPE",1637806684:"IFCTIMESERIESSCHEDULE",5716631:"IFCTANKTYPE",2254336722:"IFCSYSTEM",2315554128:"IFCSWITCHINGDEVICETYPE",148013059:"IFCSUBCONTRACTRESOURCE",1975003073:"IFCSTRUCTURALSURFACECONNECTION",2986769608:"IFCSTRUCTURALRESULTGROUP",1235345126:"IFCSTRUCTURALPOINTREACTION",734778138:"IFCSTRUCTURALPOINTCONNECTION",2082059205:"IFCSTRUCTURALPOINTACTION",3987759626:"IFCSTRUCTURALPLANARACTIONVARYING",1621171031:"IFCSTRUCTURALPLANARACTION",1252848954:"IFCSTRUCTURALLOADGROUP",1721250024:"IFCSTRUCTURALLINEARACTIONVARYING",1807405624:"IFCSTRUCTURALLINEARACTION",2445595289:"IFCSTRUCTURALCURVEMEMBERVARYING",214636428:"IFCSTRUCTURALCURVEMEMBER",4243806635:"IFCSTRUCTURALCURVECONNECTION",1179482911:"IFCSTRUCTURALCONNECTION",682877961:"IFCSTRUCTURALACTION",1039846685:"IFCSTAIRFLIGHTTYPE",3112655638:"IFCSTACKTERMINALTYPE",3812236995:"IFCSPACETYPE",652456506:"IFCSPACEPROGRAM",1305183839:"IFCSPACEHEATERTYPE",3856911033:"IFCSPACE",2533589738:"IFCSLABTYPE",4097777520:"IFCSITE",4105383287:"IFCSERVICELIFE",3517283431:"IFCSCHEDULETIMECONTROL",1768891740:"IFCSANITARYTERMINALTYPE",2863920197:"IFCRELASSIGNSTASKS",160246688:"IFCRELAGGREGATES",2324767716:"IFCRAMPFLIGHTTYPE",2893384427:"IFCRAILINGTYPE",3248260540:"IFCRADIUSDIMENSION",2250791053:"IFCPUMPTYPE",1842657554:"IFCPROTECTIVEDEVICETYPE",3651124850:"IFCPROJECTIONELEMENT",3642467123:"IFCPROJECTORDERRECORD",2904328755:"IFCPROJECTORDER",2744685151:"IFCPROCEDURE",3740093272:"IFCPORT",3724593414:"IFCPOLYLINE",4017108033:"IFCPLATETYPE",4231323485:"IFCPIPESEGMENTTYPE",804291784:"IFCPIPEFITTINGTYPE",3327091369:"IFCPERMIT",2382730787:"IFCPERFORMANCEHISTORY",2837617999:"IFCOUTLETTYPE",3425660407:"IFCORDERACTION",3588315303:"IFCOPENINGELEMENT",4143007308:"IFCOCCUPANT",1916936684:"IFCMOVE",977012517:"IFCMOTORCONNECTIONTYPE",3181161470:"IFCMEMBERTYPE",2108223431:"IFCMECHANICALFASTENERTYPE",377706215:"IFCMECHANICALFASTENER",2506943328:"IFCLINEARDIMENSION",1161773419:"IFCLIGHTFIXTURETYPE",1051575348:"IFCLAMPTYPE",3827777499:"IFCLABORRESOURCE",4288270099:"IFCJUNCTIONBOXTYPE",2391368822:"IFCINVENTORY",1806887404:"IFCHUMIDIFIERTYPE",1251058090:"IFCHEATEXCHANGERTYPE",2706460486:"IFCGROUP",3009204131:"IFCGRID",200128114:"IFCGASTERMINALTYPE",814719939:"IFCFURNITURESTANDARD",263784265:"IFCFURNISHINGELEMENT",3009222698:"IFCFLOWTREATMENTDEVICETYPE",2297155007:"IFCFLOWTERMINALTYPE",1339347760:"IFCFLOWSTORAGEDEVICETYPE",1834744321:"IFCFLOWSEGMENTTYPE",1482959167:"IFCFLOWMOVINGDEVICETYPE",3815607619:"IFCFLOWMETERTYPE",3198132628:"IFCFLOWFITTINGTYPE",3907093117:"IFCFLOWCONTROLLERTYPE",1287392070:"IFCFEATUREELEMENTSUBTRACTION",2143335405:"IFCFEATUREELEMENTADDITION",2827207264:"IFCFEATUREELEMENT",2489546625:"IFCFASTENERTYPE",647756555:"IFCFASTENER",3737207727:"IFCFACETEDBREPWITHVOIDS",807026263:"IFCFACETEDBREP",3390157468:"IFCEVAPORATORTYPE",3174744832:"IFCEVAPORATIVECOOLERTYPE",3272907226:"IFCEQUIPMENTSTANDARD",1962604670:"IFCEQUIPMENTELEMENT",2107101300:"IFCENERGYCONVERSIONDEVICETYPE",1704287377:"IFCELLIPSE",2590856083:"IFCELEMENTCOMPONENTTYPE",1623761950:"IFCELEMENTCOMPONENT",4123344466:"IFCELEMENTASSEMBLY",1758889154:"IFCELEMENT",360485395:"IFCELECTRICALBASEPROPERTIES",3849074793:"IFCDISTRIBUTIONFLOWELEMENTTYPE",3256556792:"IFCDISTRIBUTIONELEMENTTYPE",681481545:"IFCDIMENSIONCURVEDIRECTEDCALLOUT",1457835157:"IFCCURTAINWALLTYPE",3295246426:"IFCCREWRESOURCE",1916426348:"IFCCOVERINGTYPE",1419761937:"IFCCOSTSCHEDULE",3895139033:"IFCCOSTITEM",3293443760:"IFCCONTROL",2559216714:"IFCCONSTRUCTIONRESOURCE",2510884976:"IFCCONIC",3732776249:"IFCCOMPOSITECURVE",300633059:"IFCCOLUMNTYPE",2937912522:"IFCCIRCLEHOLLOWPROFILEDEF",3124254112:"IFCBUILDINGSTOREY",1950629157:"IFCBUILDINGELEMENTTYPE",4031249490:"IFCBUILDING",1260505505:"IFCBOUNDEDCURVE",3649129432:"IFCBOOLEANCLIPPINGRESULT",1334484129:"IFCBLOCK",3207858831:"IFCASYMMETRICISHAPEPROFILEDEF",1674181508:"IFCANNOTATION",2296667514:"IFCACTOR",2097647324:"IFCTRANSPORTELEMENTTYPE",3473067441:"IFCTASK",1580310250:"IFCSYSTEMFURNITUREELEMENTTYPE",4124788165:"IFCSURFACEOFREVOLUTION",2809605785:"IFCSURFACEOFLINEAREXTRUSION",2028607225:"IFCSURFACECURVESWEPTAREASOLID",4070609034:"IFCSTRUCTUREDDIMENSIONCALLOUT",2218152070:"IFCSTRUCTURALSURFACEMEMBERVARYING",3979015343:"IFCSTRUCTURALSURFACEMEMBER",3689010777:"IFCSTRUCTURALREACTION",530289379:"IFCSTRUCTURALMEMBER",3136571912:"IFCSTRUCTURALITEM",3544373492:"IFCSTRUCTURALACTIVITY",451544542:"IFCSPHERE",3893378262:"IFCSPATIALSTRUCTUREELEMENTTYPE",2706606064:"IFCSPATIALSTRUCTUREELEMENT",3626867408:"IFCRIGHTCIRCULARCYLINDER",4158566097:"IFCRIGHTCIRCULARCONE",1856042241:"IFCREVOLVEDAREASOLID",2914609552:"IFCRESOURCE",1401173127:"IFCRELVOIDSELEMENT",3451746338:"IFCRELSPACEBOUNDARY",366585022:"IFCRELSERVICESBUILDINGS",4122056220:"IFCRELSEQUENCE",1058617721:"IFCRELSCHEDULESCOSTITEMS",1245217292:"IFCRELREFERENCEDINSPATIALSTRUCTURE",750771296:"IFCRELPROJECTSELEMENT",202636808:"IFCRELOVERRIDESPROPERTIES",2051452291:"IFCRELOCCUPIESSPACES",3268803585:"IFCRELNESTS",4189434867:"IFCRELINTERACTIONREQUIREMENTS",279856033:"IFCRELFLOWCONTROLELEMENTS",3940055652:"IFCRELFILLSELEMENT",781010003:"IFCRELDEFINESBYTYPE",4186316022:"IFCRELDEFINESBYPROPERTIES",693640335:"IFCRELDEFINES",2551354335:"IFCRELDECOMPOSES",2802773753:"IFCRELCOVERSSPACES",886880790:"IFCRELCOVERSBLDGELEMENTS",3242617779:"IFCRELCONTAINEDINSPATIALSTRUCTURE",3678494232:"IFCRELCONNECTSWITHREALIZINGELEMENTS",504942748:"IFCRELCONNECTSWITHECCENTRICITY",1638771189:"IFCRELCONNECTSSTRUCTURALMEMBER",3912681535:"IFCRELCONNECTSSTRUCTURALELEMENT",2127690289:"IFCRELCONNECTSSTRUCTURALACTIVITY",3190031847:"IFCRELCONNECTSPORTS",4201705270:"IFCRELCONNECTSPORTTOELEMENT",3945020480:"IFCRELCONNECTSPATHELEMENTS",1204542856:"IFCRELCONNECTSELEMENTS",826625072:"IFCRELCONNECTS",2851387026:"IFCRELASSOCIATESPROFILEPROPERTIES",2655215786:"IFCRELASSOCIATESMATERIAL",3840914261:"IFCRELASSOCIATESLIBRARY",982818633:"IFCRELASSOCIATESDOCUMENT",2728634034:"IFCRELASSOCIATESCONSTRAINT",919958153:"IFCRELASSOCIATESCLASSIFICATION",4095574036:"IFCRELASSOCIATESAPPROVAL",1327628568:"IFCRELASSOCIATESAPPLIEDVALUE",1865459582:"IFCRELASSOCIATES",205026976:"IFCRELASSIGNSTORESOURCE",3372526763:"IFCRELASSIGNSTOPROJECTORDER",2857406711:"IFCRELASSIGNSTOPRODUCT",4278684876:"IFCRELASSIGNSTOPROCESS",1307041759:"IFCRELASSIGNSTOGROUP",2495723537:"IFCRELASSIGNSTOCONTROL",1683148259:"IFCRELASSIGNSTOACTOR",3939117080:"IFCRELASSIGNS",3454111270:"IFCRECTANGULARTRIMMEDSURFACE",2798486643:"IFCRECTANGULARPYRAMID",2770003689:"IFCRECTANGLEHOLLOWPROFILEDEF",3219374653:"IFCPROXY",1451395588:"IFCPROPERTYSET",4194566429:"IFCPROJECTIONCURVE",103090709:"IFCPROJECT",4208778838:"IFCPRODUCT",2945172077:"IFCPROCESS",220341763:"IFCPLANE",603570806:"IFCPLANARBOX",3566463478:"IFCPERMEABLECOVERINGPROPERTIES",3505215534:"IFCOFFSETCURVE3D",3388369263:"IFCOFFSETCURVE2D",3888040117:"IFCOBJECT",1425443689:"IFCMANIFOLDSOLIDBREP",1281925730:"IFCLINE",572779678:"IFCLSHAPEPROFILEDEF",1484403080:"IFCISHAPEPROFILEDEF",987898635:"IFCGEOMETRICCURVESET",1268542332:"IFCFURNITURETYPE",4238390223:"IFCFURNISHINGELEMENTTYPE",3455213021:"IFCFLUIDFLOWPROPERTIES",315944413:"IFCFILLAREASTYLETILES",4203026998:"IFCFILLAREASTYLETILESYMBOLWITHSTYLE",374418227:"IFCFILLAREASTYLEHATCHING",2047409740:"IFCFACEBASEDSURFACEMODEL",477187591:"IFCEXTRUDEDAREASOLID",80994333:"IFCENERGYPROPERTIES",2835456948:"IFCELLIPSEPROFILEDEF",2777663545:"IFCELEMENTARYSURFACE",339256511:"IFCELEMENTTYPE",1883228015:"IFCELEMENTQUANTITY",1472233963:"IFCEDGELOOP",4006246654:"IFCDRAUGHTINGPREDEFINEDCURVEFONT",445594917:"IFCDRAUGHTINGPREDEFINEDCOLOUR",3073041342:"IFCDRAUGHTINGCALLOUT",526551008:"IFCDOORSTYLE",1714330368:"IFCDOORPANELPROPERTIES",2963535650:"IFCDOORLININGPROPERTIES",32440307:"IFCDIRECTION",4054601972:"IFCDIMENSIONCURVETERMINATOR",606661476:"IFCDIMENSIONCURVE",693772133:"IFCDEFINEDSYMBOL",2827736869:"IFCCURVEBOUNDEDPLANE",2601014836:"IFCCURVE",2147822146:"IFCCSGSOLID",2506170314:"IFCCSGPRIMITIVE3D",194851669:"IFCCRANERAILFSHAPEPROFILEDEF",4133800736:"IFCCRANERAILASHAPEPROFILEDEF",2485617015:"IFCCOMPOSITECURVESEGMENT",2205249479:"IFCCLOSEDSHELL",1383045692:"IFCCIRCLEPROFILEDEF",1416205885:"IFCCARTESIANTRANSFORMATIONOPERATOR3DNONUNIFORM",3331915920:"IFCCARTESIANTRANSFORMATIONOPERATOR3D",3486308946:"IFCCARTESIANTRANSFORMATIONOPERATOR2DNONUNIFORM",3749851601:"IFCCARTESIANTRANSFORMATIONOPERATOR2D",59481748:"IFCCARTESIANTRANSFORMATIONOPERATOR",1123145078:"IFCCARTESIANPOINT",2898889636:"IFCCSHAPEPROFILEDEF",2713105998:"IFCBOXEDHALFSPACE",2581212453:"IFCBOUNDINGBOX",4182860854:"IFCBOUNDEDSURFACE",2736907675:"IFCBOOLEANRESULT",2740243338:"IFCAXIS2PLACEMENT3D",3125803723:"IFCAXIS2PLACEMENT2D",4261334040:"IFCAXIS1PLACEMENT",1302238472:"IFCANNOTATIONSURFACE",2265737646:"IFCANNOTATIONFILLAREAOCCURRENCE",669184980:"IFCANNOTATIONFILLAREA",3288037868:"IFCANNOTATIONCURVEOCCURRENCE",2543172580:"IFCZSHAPEPROFILEDEF",1299126871:"IFCWINDOWSTYLE",512836454:"IFCWINDOWPANELPROPERTIES",336235671:"IFCWINDOWLININGPROPERTIES",2759199220:"IFCVERTEXLOOP",1417489154:"IFCVECTOR",427810014:"IFCUSHAPEPROFILEDEF",2347495698:"IFCTYPEPRODUCT",1628702193:"IFCTYPEOBJECT",1345879162:"IFCTWODIRECTIONREPEATFACTOR",2715220739:"IFCTRAPEZIUMPROFILEDEF",3124975700:"IFCTEXTLITERALWITHEXTENT",4282788508:"IFCTEXTLITERAL",3028897424:"IFCTERMINATORSYMBOL",3071757647:"IFCTSHAPEPROFILEDEF",230924584:"IFCSWEPTSURFACE",1260650574:"IFCSWEPTDISKSOLID",2247615214:"IFCSWEPTAREASOLID",1878645084:"IFCSURFACESTYLERENDERING",2513912981:"IFCSURFACE",2233826070:"IFCSUBEDGE",3653947884:"IFCSTRUCTURALSTEELPROFILEPROPERTIES",3843319758:"IFCSTRUCTURALPROFILEPROPERTIES",1190533807:"IFCSTRUCTURALLOADSINGLEFORCEWARPING",1597423693:"IFCSTRUCTURALLOADSINGLEFORCE",1973038258:"IFCSTRUCTURALLOADSINGLEDISPLACEMENTDISTORTION",2473145415:"IFCSTRUCTURALLOADSINGLEDISPLACEMENT",2668620305:"IFCSTRUCTURALLOADPLANARFORCE",1595516126:"IFCSTRUCTURALLOADLINEARFORCE",390701378:"IFCSPACETHERMALLOADPROPERTIES",1202362311:"IFCSOUNDVALUE",2485662743:"IFCSOUNDPROPERTIES",723233188:"IFCSOLIDMODEL",2609359061:"IFCSLIPPAGECONNECTIONCONDITION",4124623270:"IFCSHELLBASEDSURFACEMODEL",2411513650:"IFCSERVICELIFEFACTOR",1509187699:"IFCSECTIONEDSPINE",2778083089:"IFCROUNDEDRECTANGLEPROFILEDEF",478536968:"IFCRELATIONSHIP",3765753017:"IFCREINFORCEMENTDEFINITIONPROPERTIES",3413951693:"IFCREGULARTIMESERIES",3615266464:"IFCRECTANGLEPROFILEDEF",110355661:"IFCPROPERTYTABLEVALUE",3650150729:"IFCPROPERTYSINGLEVALUE",3357820518:"IFCPROPERTYSETDEFINITION",941946838:"IFCPROPERTYREFERENCEVALUE",2752243245:"IFCPROPERTYLISTVALUE",4166981789:"IFCPROPERTYENUMERATEDVALUE",1680319473:"IFCPROPERTYDEFINITION",871118103:"IFCPROPERTYBOUNDEDVALUE",673634403:"IFCPRODUCTDEFINITIONSHAPE",179317114:"IFCPREDEFINEDPOINTMARKERSYMBOL",433424934:"IFCPREDEFINEDDIMENSIONSYMBOL",2559016684:"IFCPREDEFINEDCURVEFONT",759155922:"IFCPREDEFINEDCOLOUR",2775532180:"IFCPOLYGONALBOUNDEDHALFSPACE",2924175390:"IFCPOLYLOOP",1423911732:"IFCPOINTONSURFACE",4022376103:"IFCPOINTONCURVE",2067069095:"IFCPOINT",1663979128:"IFCPLANAREXTENT",2004835150:"IFCPLACEMENT",597895409:"IFCPIXELTEXTURE",3021840470:"IFCPHYSICALCOMPLEXQUANTITY",2519244187:"IFCPATH",2529465313:"IFCPARAMETERIZEDPROFILEDEF",1029017970:"IFCORIENTEDEDGE",2665983363:"IFCOPENSHELL",2833995503:"IFCONEDIRECTIONREPEATFACTOR",219451334:"IFCOBJECTDEFINITION",1430189142:"IFCMECHANICALCONCRETEMATERIALPROPERTIES",2022407955:"IFCMATERIALDEFINITIONREPRESENTATION",2347385850:"IFCMAPPEDITEM",1008929658:"IFCLOOP",2624227202:"IFCLOCALPLACEMENT",3422422726:"IFCLIGHTSOURCESPOT",1520743889:"IFCLIGHTSOURCEPOSITIONAL",4266656042:"IFCLIGHTSOURCEGONIOMETRIC",2604431987:"IFCLIGHTSOURCEDIRECTIONAL",125510826:"IFCLIGHTSOURCEAMBIENT",1402838566:"IFCLIGHTSOURCE",3741457305:"IFCIRREGULARTIMESERIES",3905492369:"IFCIMAGETEXTURE",2445078500:"IFCHYGROSCOPICMATERIALPROPERTIES",812098782:"IFCHALFSPACESOLID",178086475:"IFCGRIDPLACEMENT",3590301190:"IFCGEOMETRICSET",4142052618:"IFCGEOMETRICREPRESENTATIONSUBCONTEXT",2453401579:"IFCGEOMETRICREPRESENTATIONITEM",3448662350:"IFCGEOMETRICREPRESENTATIONCONTEXT",1446786286:"IFCGENERALPROFILEPROPERTIES",803998398:"IFCGENERALMATERIALPROPERTIES",3857492461:"IFCFUELPROPERTIES",738692330:"IFCFILLAREASTYLE",4219587988:"IFCFAILURECONNECTIONCONDITION",3008276851:"IFCFACESURFACE",803316827:"IFCFACEOUTERBOUND",1809719519:"IFCFACEBOUND",2556980723:"IFCFACE",1860660968:"IFCEXTENDEDMATERIALPROPERTIES",476780140:"IFCEDGECURVE",3900360178:"IFCEDGE",4170525392:"IFCDRAUGHTINGPREDEFINEDTEXTFONT",3732053477:"IFCDOCUMENTREFERENCE",1694125774:"IFCDIMENSIONPAIR",2273265877:"IFCDIMENSIONCALLOUTRELATIONSHIP",3632507154:"IFCDERIVEDPROFILEDEF",3800577675:"IFCCURVESTYLE",2889183280:"IFCCONVERSIONBASEDUNIT",3050246964:"IFCCONTEXTDEPENDENTUNIT",45288368:"IFCCONNECTIONPOINTECCENTRICITY",1981873012:"IFCCONNECTIONCURVEGEOMETRY",370225590:"IFCCONNECTEDFACESET",1485152156:"IFCCOMPOSITEPROFILEDEF",2542286263:"IFCCOMPLEXPROPERTY",776857604:"IFCCOLOURRGB",647927063:"IFCCLASSIFICATIONREFERENCE",3150382593:"IFCCENTERLINEPROFILEDEF",616511568:"IFCBLOBTEXTURE",2705031697:"IFCARBITRARYPROFILEDEFWITHVOIDS",1310608509:"IFCARBITRARYOPENPROFILEDEF",3798115385:"IFCARBITRARYCLOSEDPROFILEDEF",2297822566:"IFCANNOTATIONTEXTOCCURRENCE",3612888222:"IFCANNOTATIONSYMBOLOCCURRENCE",962685235:"IFCANNOTATIONSURFACEOCCURRENCE",2442683028:"IFCANNOTATIONOCCURRENCE",1065908215:"IFCWATERPROPERTIES",891718957:"IFCVIRTUALGRIDINTERSECTION",1907098498:"IFCVERTEXPOINT",3304826586:"IFCVERTEXBASEDTEXTUREMAP",2799835756:"IFCVERTEX",180925521:"IFCUNITASSIGNMENT",1735638870:"IFCTOPOLOGYREPRESENTATION",1377556343:"IFCTOPOLOGICALREPRESENTATIONITEM",581633288:"IFCTIMESERIESVALUE",1718945513:"IFCTIMESERIESREFERENCERELATIONSHIP",3101149627:"IFCTIMESERIES",3317419933:"IFCTHERMALMATERIALPROPERTIES",1210645708:"IFCTEXTUREVERTEX",2552916305:"IFCTEXTUREMAP",1742049831:"IFCTEXTURECOORDINATEGENERATOR",280115917:"IFCTEXTURECOORDINATE",1484833681:"IFCTEXTSTYLEWITHBOXCHARACTERISTICS",1640371178:"IFCTEXTSTYLETEXTMODEL",2636378356:"IFCTEXTSTYLEFORDEFINEDFONT",1983826977:"IFCTEXTSTYLEFONTMODEL",1447204868:"IFCTEXTSTYLE",912023232:"IFCTELECOMADDRESS",531007025:"IFCTABLEROW",985171141:"IFCTABLE",1290481447:"IFCSYMBOLSTYLE",626085974:"IFCSURFACETEXTURE",1351298697:"IFCSURFACESTYLEWITHTEXTURES",846575682:"IFCSURFACESTYLESHADING",1607154358:"IFCSURFACESTYLEREFRACTION",3303107099:"IFCSURFACESTYLELIGHTING",1300840506:"IFCSURFACESTYLE",3049322572:"IFCSTYLEDREPRESENTATION",3958052878:"IFCSTYLEDITEM",2830218821:"IFCSTYLEMODEL",3408363356:"IFCSTRUCTURALLOADTEMPERATURE",2525727697:"IFCSTRUCTURALLOADSTATIC",2162789131:"IFCSTRUCTURALLOAD",2273995522:"IFCSTRUCTURALCONNECTIONCONDITION",3692461612:"IFCSIMPLEPROPERTY",4240577450:"IFCSHAPEREPRESENTATION",3982875396:"IFCSHAPEMODEL",867548509:"IFCSHAPEASPECT",4165799628:"IFCSECTIONREINFORCEMENTPROPERTIES",2042790032:"IFCSECTIONPROPERTIES",448429030:"IFCSIUNIT",2341007311:"IFCROOT",3679540991:"IFCRIBPLATEPROFILEPROPERTIES",1660063152:"IFCREPRESENTATIONMAP",3008791417:"IFCREPRESENTATIONITEM",3377609919:"IFCREPRESENTATIONCONTEXT",1076942058:"IFCREPRESENTATION",1222501353:"IFCRELAXATION",1580146022:"IFCREINFORCEMENTBARPROPERTIES",2692823254:"IFCREFERENCESVALUEDOCUMENT",825690147:"IFCQUANTITYWEIGHT",2405470396:"IFCQUANTITYVOLUME",3252649465:"IFCQUANTITYTIME",931644368:"IFCQUANTITYLENGTH",2093928680:"IFCQUANTITYCOUNT",2044713172:"IFCQUANTITYAREA",3710013099:"IFCPROPERTYENUMERATION",148025276:"IFCPROPERTYDEPENDENCYRELATIONSHIP",3896028662:"IFCPROPERTYCONSTRAINTRELATIONSHIP",2598011224:"IFCPROPERTY",2802850158:"IFCPROFILEPROPERTIES",3958567839:"IFCPROFILEDEF",2267347899:"IFCPRODUCTSOFCOMBUSTIONPROPERTIES",2095639259:"IFCPRODUCTREPRESENTATION",2417041796:"IFCPRESENTATIONSTYLEASSIGNMENT",3119450353:"IFCPRESENTATIONSTYLE",1304840413:"IFCPRESENTATIONLAYERWITHSTYLE",2022622350:"IFCPRESENTATIONLAYERASSIGNMENT",1775413392:"IFCPREDEFINEDTEXTFONT",3213052703:"IFCPREDEFINEDTERMINATORSYMBOL",990879717:"IFCPREDEFINEDSYMBOL",3727388367:"IFCPREDEFINEDITEM",3355820592:"IFCPOSTALADDRESS",2226359599:"IFCPHYSICALSIMPLEQUANTITY",2483315170:"IFCPHYSICALQUANTITY",101040310:"IFCPERSONANDORGANIZATION",2077209135:"IFCPERSON",1207048766:"IFCOWNERHISTORY",1411181986:"IFCORGANIZATIONRELATIONSHIP",4251960020:"IFCORGANIZATION",1227763645:"IFCOPTICALMATERIALPROPERTIES",2251480897:"IFCOBJECTIVE",3701648758:"IFCOBJECTPLACEMENT",1918398963:"IFCNAMEDUNIT",2706619895:"IFCMONETARYUNIT",3368373690:"IFCMETRIC",677618848:"IFCMECHANICALSTEELMATERIALPROPERTIES",4256014907:"IFCMECHANICALMATERIALPROPERTIES",2597039031:"IFCMEASUREWITHUNIT",3265635763:"IFCMATERIALPROPERTIES",2199411900:"IFCMATERIALLIST",1303795690:"IFCMATERIALLAYERSETUSAGE",3303938423:"IFCMATERIALLAYERSET",248100487:"IFCMATERIALLAYER",1847130766:"IFCMATERIALCLASSIFICATIONRELATIONSHIP",1838606355:"IFCMATERIAL",30780891:"IFCLOCALTIME",1566485204:"IFCLIGHTINTENSITYDISTRIBUTION",4162380809:"IFCLIGHTDISTRIBUTIONDATA",3452421091:"IFCLIBRARYREFERENCE",2655187982:"IFCLIBRARYINFORMATION",3020489413:"IFCIRREGULARTIMESERIESVALUE",852622518:"IFCGRIDAXIS",3548104201:"IFCEXTERNALLYDEFINEDTEXTFONT",3207319532:"IFCEXTERNALLYDEFINEDSYMBOL",1040185647:"IFCEXTERNALLYDEFINEDSURFACESTYLE",2242383968:"IFCEXTERNALLYDEFINEDHATCHSTYLE",3200245327:"IFCEXTERNALREFERENCE",1648886627:"IFCENVIRONMENTALIMPACTVALUE",3796139169:"IFCDRAUGHTINGCALLOUTRELATIONSHIP",770865208:"IFCDOCUMENTINFORMATIONRELATIONSHIP",1154170062:"IFCDOCUMENTINFORMATION",1376555844:"IFCDOCUMENTELECTRONICFORMAT",2949456006:"IFCDIMENSIONALEXPONENTS",1045800335:"IFCDERIVEDUNITELEMENT",1765591967:"IFCDERIVEDUNIT",1072939445:"IFCDATEANDTIME",3510044353:"IFCCURVESTYLEFONTPATTERN",2367409068:"IFCCURVESTYLEFONTANDSCALING",1105321065:"IFCCURVESTYLEFONT",539742890:"IFCCURRENCYRELATIONSHIP",602808272:"IFCCOSTVALUE",1065062679:"IFCCOORDINATEDUNIVERSALTIMEOFFSET",347226245:"IFCCONSTRAINTRELATIONSHIP",613356794:"IFCCONSTRAINTCLASSIFICATIONRELATIONSHIP",1658513725:"IFCCONSTRAINTAGGREGATIONRELATIONSHIP",1959218052:"IFCCONSTRAINT",2732653382:"IFCCONNECTIONSURFACEGEOMETRY",4257277454:"IFCCONNECTIONPORTGEOMETRY",2614616156:"IFCCONNECTIONPOINTGEOMETRY",2859738748:"IFCCONNECTIONGEOMETRY",3264961684:"IFCCOLOURSPECIFICATION",3639012971:"IFCCLASSIFICATIONNOTATIONFACET",938368621:"IFCCLASSIFICATIONNOTATION",1098599126:"IFCCLASSIFICATIONITEMRELATIONSHIP",1767535486:"IFCCLASSIFICATIONITEM",747523909:"IFCCLASSIFICATION",622194075:"IFCCALENDARDATE",2069777674:"IFCBOUNDARYNODECONDITIONWARPING",1387855156:"IFCBOUNDARYNODECONDITION",3367102660:"IFCBOUNDARYFACECONDITION",1560379544:"IFCBOUNDARYEDGECONDITION",4037036970:"IFCBOUNDARYCONDITION",3869604511:"IFCAPPROVALRELATIONSHIP",390851274:"IFCAPPROVALPROPERTYRELATIONSHIP",2080292479:"IFCAPPROVALACTORRELATIONSHIP",130549933:"IFCAPPROVAL",1110488051:"IFCAPPLIEDVALUERELATIONSHIP",411424972:"IFCAPPLIEDVALUE",639542469:"IFCAPPLICATION",618182010:"IFCADDRESS",3630933823:"IFCACTORROLE",599546466:"FILE_DESCRIPTION",1390159747:"FILE_NAME",1109904537:"FILE_SCHEMA"};class nn{static async getUnits(t){var e;const{IFCUNITASSIGNMENT:n}=Re,i=await t.getAllPropertiesOfType(n);if(!i)return 1;const o=Object.keys(i),a=i[parseInt(o[0],10)];for(const l of a.Units){if(l.value===void 0||l.value===null)continue;const h=await t.getProperties(l.value);if(!h||!h.UnitType||!h.UnitType.value||h.UnitType.value!=="LENGTHUNIT")continue;let p=1,m=1;return h.Name.value==="METRE"&&(m=1),h.Name.value==="FOOT"&&(m=.3048),((e=h.Prefix)==null?void 0:e.value)==="MILLI"&&(p=.001),m*p}return 1}static async findItemByGuid(t,e){var n;const i=t.getAllPropertiesIDs();for(const o of i){const a=await t.getProperties(o);if(a&&((n=a.GlobalId)==null?void 0:n.value)===e)return a}return null}static async getRelationMap(t,e,n){var i;const o=n??(()=>{}),a={},l=t.getAllPropertiesIDs();for(const h of l){const p=await t.getProperties(h);if(!p)continue;const m=p.type===e,I=Object.keys(p).find(_=>_.startsWith("Relating")),f=Object.keys(p).find(_=>_.startsWith("Related"));if(!(m&&I&&f))continue;const T=await t.getProperties((i=p[I])==null?void 0:i.value),A=p[f];if(!T||!A||!(A&&Array.isArray(A)))continue;const F=A.map(_=>_.value);o(T.expressID,F),a[T.expressID]=F}return a}static async getQsetQuantities(t,e,n){const i=n??(()=>{}),o=await t.getProperties(e);return!o||o.type!==dl?null:(o.Quantities??[{}]).map(a=>(a.value&&i(a.value),a.value)).filter(a=>a!==null)}static async getPsetProps(t,e,n){const i=n??(()=>{}),o=await t.getProperties(e);return!o||o.type!==Gi?null:(o.HasProperties??[{}]).map(a=>(a.value&&i(a.value),a.value)).filter(a=>a!==null)}static async getPsetRel(t,e){var n;if(!await t.getProperties(e))return null;const i=await t.getAllPropertiesOfType(Ao);if(!i)return null;const o=Object.values(i);let a=null;for(const l of o)((n=l.RelatingPropertyDefinition)==null?void 0:n.value)===e&&(a=l.expressID);return a}static async getQsetRel(t,e){return nn.getPsetRel(t,e)}static async getEntityName(t,e){var n;const i=await t.getProperties(e);if(!i)return{key:null,name:null};const o=Object.keys(i).find(l=>l.endsWith("Name"))??null,a=o?(n=i[o])==null?void 0:n.value:null;return{key:o,name:a}}static async getQuantityValue(t,e){const n=await t.getProperties(e);if(!n)return{key:null,value:null};const i=Object.keys(n).find(a=>a.endsWith("Value"))??null;let o;return i===null||n[i]===void 0||n[i]===null?o=null:o=n[i].value,{key:i,value:o}}static isRel(t){return Ul[t].startsWith("IFCREL")}static async attributeExists(t,e,n){const i=await t.getProperties(e);return i?Object.keys(i).includes(n):!1}static async groupEntitiesByType(t,e){var n;const i=new Map;for(const o of e){const a=await t.getProperties(o);if(!a)continue;const l=a.type;i.get(l)||i.set(l,new Set),(n=i.get(l))==null||n.add(o)}return i}}const Bl=class Yl extends Jt{constructor(t){super(t),y(this,"onDisposed",new at),y(this,"onFragmentsLoaded",new at),y(this,"onFragmentsDisposed",new at),y(this,"list",new Map),y(this,"groups",new Map),y(this,"enabled",!0),y(this,"baseCoordinationModel",""),y(this,"_loader",new Cl),this.components.add(Yl.uuid,this)}get meshes(){const t=[];for(const[e,n]of this.list)t.push(n.mesh);return t}dispose(){for(const[t,e]of this.groups)e.dispose(!0);this.baseCoordinationModel="",this.groups.clear(),this.list.clear(),this.onFragmentsLoaded.reset(),this.onFragmentsDisposed.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}disposeGroup(t){const{uuid:e}=t,n=[];for(const i of t.items)n.push(i.id),this.list.delete(i.id);t.dispose(!0),this.groups.delete(t.uuid),this.onFragmentsDisposed.trigger({groupID:e,fragmentIDs:n})}load(t,e=!0){const n=this._loader.import(t);for(const i of n.items)i.group=n,this.list.set(i.id,i);return e&&this.coordinate([n]),this.groups.set(n.uuid,n),this.onFragmentsLoaded.trigger(n),n}export(t){return this._loader.export(t)}coordinate(t=Array.from(this.groups.values())){if(this.baseCoordinationModel.length===0){const n=t.pop();if(!n)return;this.baseCoordinationModel=n.uuid}if(!t.length)return;const e=this.groups.get(this.baseCoordinationModel);if(!e){console.log("No base model found for coordination!");return}for(const n of t)n!==e&&(n.position.set(0,0,0),n.rotation.set(0,0,0),n.scale.set(1,1,1),n.updateMatrix(),n.applyMatrix4(n.coordinationMatrix.clone().invert()),n.applyMatrix4(e.coordinationMatrix))}};y(Bl,"uuid","fef46874-46a3-461b-8c44-2922ab77c806");let Xn=Bl;const ku=class Io extends Jt{constructor(t){super(t),y(this,"onDisposed",new at),y(this,"enabled",!0),y(this,"relationsToProcess",[Ao,al,ll,Fo,cl,hl]),y(this,"indexMap",{}),y(this,"_propertiesManager",null),y(this,"onPropertiesManagerSet",new at),y(this,"onFragmentsDisposed",e=>{delete this.indexMap[e.groupID]}),this.components.add(Io.uuid,this),t.get(Xn).onFragmentsDisposed.add(this.onFragmentsDisposed)}set propertiesManager(t){this._propertiesManager||(this._propertiesManager=t,t&&(t.onElementToPset.add(async({model:e,psetID:n,elementID:i})=>{this.indexMap[e.uuid]&&this.setEntityIndex(e,i).add(n)}),this.onPropertiesManagerSet.trigger(t)))}get propertiesManager(){return this._propertiesManager}async dispose(){this.indexMap={},this.propertiesManager=null,this.onPropertiesManagerSet.reset(),this.components.get(Xn).onFragmentsDisposed.remove(this.onFragmentsDisposed),this.onDisposed.trigger(Io.uuid),this.onDisposed.reset()}async getProperties(t,e){if(!t.hasProperties)return null;const n=t.getLocalProperties();if(n===void 0)return null;const i=this.indexMap[t.uuid];if(!i)return null;const o=i[e],a=parseInt(e,10),l=await t.getProperties(a);if(!l)throw new Error("Properties not found!");const h=this.cloneProperty(l);if(!h)throw new Error("Properties not found!");const p=[h];if(o)for(const m of o){const I=await t.getProperties(m);if(!I)continue;const f=this.cloneProperty(I);f&&(this.getPsetProperties(f,n),this.getNestedPsets(f,n),p.push(f))}return p}getNestedPsets(t,e){if(t.HasPropertySets)for(const n of t.HasPropertySets){const i=n.value;n.value=this.cloneProperty(e[i]),this.getPsetProperties(n.value,e)}}getPsetProperties(t,e){if(t.HasProperties)for(const n of t.HasProperties){const i=n.value,o=this.cloneProperty(e[i]);n.value={...o}}}async process(t){if(!t.hasProperties)throw new Error("FragmentsGroup properties not found");this.indexMap[t.uuid]={};const e=[Gi,dl];for(const n of this.relationsToProcess)await nn.getRelationMap(t,n,async(i,o)=>{const a=await t.getProperties(i);if(a){e.includes(a.type)||this.setEntityIndex(t,i);for(const l of o)this.setEntityIndex(t,l).add(i)}})}setEntityIndex(t,e){return this.indexMap[t.uuid][e]||(this.indexMap[t.uuid][e]=new Set),this.indexMap[t.uuid][e]}cloneProperty(t,e={}){if(!t)return e;for(const n in t){const i=t[n],o=Array.isArray(i),a=typeof i=="object"&&!o&&i!==null;if(o){e[n]=[];const l=e[n];this.clonePropertyArray(i,l)}else if(a){e[n]={};const l=e[n];this.cloneProperty(i,l)}else e[n]=i}return e}clonePropertyArray(t,e){for(const n of t){const i=Array.isArray(n),o=typeof n=="object"&&!i&&n!==null;if(i){const a=[];e.push(a),this.clonePropertyArray(n,a)}else if(o){const a={};e.push(a),this.cloneProperty(n,a)}else e.push(n)}}};y(ku,"uuid","23a889ab-83b3-44a4-8bee-ead83438370b");class Gu{constructor(){y(this,"factor",1),y(this,"complement",1)}apply(t){const e=this.getScaleMatrix().multiply(t);t.copy(e)}setUp(t){var e;this.factor=1;const n=this.getLengthUnits(t);if(!n)return;const i=n==null,o=n.Name===void 0||n.Name===null;i||o||(n.Name.value==="FOOT"?this.factor=.3048:((e=n.Prefix)==null?void 0:e.value)==="MILLI"&&(this.complement=.001))}getLengthUnits(t){try{const e=t.GetLineIDsWithType(0,Yc).get(0),n=t.GetLine(0,e);for(const i of n.Units){if(!i||i.value===null||i.value===void 0)continue;const o=t.GetLine(0,i.value);if(o.UnitType&&o.UnitType.value==="LENGTHUNIT")return o}return null}catch{return console.log("Could not get units"),null}}getScaleMatrix(){const t=this.factor;return new Mt().fromArray([t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1])}}class kl{constructor(){y(this,"itemsByFloor",{}),y(this,"_units",new Gu)}setUp(t){this._units.setUp(t),this.cleanUp();try{const e=t.GetLineIDsWithType(0,Fo),n=new Set,i=t.GetLineIDsWithType(0,tr);for(let p=0;p<i.size();p++)n.add(i.get(p));const o=t.GetLineIDsWithType(0,Lc),a=o.size();for(let p=0;p<a;p++){const m=o.get(p),I=t.GetLine(0,m);if(!I||!I.RelatingObject||!I.RelatedObjects)continue;const f=I.RelatingObject.value,T=I.RelatedObjects;for(const A of T){const F=A.value;n.has(F)&&(this.itemsByFloor[F]=f)}}const l={},h=e.size();for(let p=0;p<h;p++){const m=e.get(p),I=t.GetLine(0,m);if(!I||!I.RelatingStructure||!I.RelatedElements)continue;const f=I.RelatingStructure.value,T=I.RelatedElements;if(n.has(f))for(const A of T){l[f]||(l[f]=[]);const F=A.value;l[f].push(F)}else for(const A of T){const F=A.value;this.itemsByFloor[F]=f}}for(const p in l){const m=this.itemsByFloor[p];if(m!==void 0){const I=l[p];for(const f of I)this.itemsByFloor[f]=m}}for(let p=0;p<a;p++){const m=o.get(p),I=t.GetLine(0,m);if(!I||!I.RelatingObject||!I.RelatedObjects)continue;const f=I.RelatingObject.value,T=I.RelatedObjects;for(const A of T){const F=A.value,_=this.itemsByFloor[f];_!==void 0&&(this.itemsByFloor[F]=_)}}}catch{console.log("Could not get floors.")}}cleanUp(){this.itemsByFloor={}}}class No{constructor(){y(this,"includeProperties",!0),y(this,"optionalCategories",[tr]),y(this,"coordinate",!0),y(this,"wasm",{path:"",absolute:!1,logLevel:Mc.LOG_LEVEL_OFF}),y(this,"excludedCategories",new Set),y(this,"saveLocations",!1),y(this,"webIfc",{COORDINATE_TO_ORIGIN:!0,OPTIMIZE_PROFILES:!0}),y(this,"autoSetWasm",!0),y(this,"customLocateFileHandler",null)}}class Gl{constructor(){y(this,"defLineMat",new pl({color:16777215}))}read(t){const e=t.GetAllAlignments(0),n=t.GetAllCrossSections2D(0),i=t.GetAllCrossSections3D(0),o={IfcAlignment:e,IfcCrossSection2D:n,IfcCrossSection3D:i};return this.get(o)}get(t){if(t.IfcAlignment){const e=new Map;for(const n of t.IfcAlignment){const i=new zc;i.absolute=this.getCurves(n.curve3D,i),i.horizontal=this.getCurves(n.horizontal,i),i.vertical=this.getCurves(n.vertical,i),e.set(e.size,i)}return{alignments:e,coordinationMatrix:new Mt}}}getCurves(t,e){const n=[];let i=0;for(const o of t){const a={};if(o.data)for(const f of o.data){const[T,A]=f.split(": "),F=parseFloat(A);a[T]=F||A}const{points:l}=o,h=new Float32Array(l.length*3);for(let f=0;f<l.length;f++){const{x:T,y:A,z:F}=l[f];h[f*3]=T,h[f*3+1]=A,h[f*3+2]=F||0}const p=new $n(h,3),m=new xc;m.setAttribute("position",p);const I=new Vc(i,a,e,m,this.defLineMat);n.push(I.curve),i++}return n}}class Vl{get(t,e){let n="";const i=t.GetHeaderLine(0,e)||"";if(!i)return n;for(const o of i.arguments)if(o!=null)if(Array.isArray(o))for(const a of o)n+=`${a.value}|`;else n+=`${o.value}|`;return n}}const zl=class mo extends Jt{constructor(t){super(t),y(this,"onIfcLoaded",new at),y(this,"onIfcStartedLoading",new at),y(this,"onSetup",new at),y(this,"onDisposed",new at),y(this,"settings",new No),y(this,"enabled",!0),y(this,"webIfc",new Qn),y(this,"_material",new ua),y(this,"_spatialTree",new kl),y(this,"_metaData",new Vl),y(this,"_fragmentInstances",new Map),y(this,"_civil",new Gl),y(this,"_propertyExporter",new Yu),y(this,"_visitedFragments",new Map),y(this,"_materialT",new ua({transparent:!0,opacity:.5})),this.components.add(mo.uuid,this),this.settings.excludedCategories.add(ul)}dispose(){this.onIfcLoaded.reset(),this.webIfc=null,this.onDisposed.trigger(mo.uuid),this.onDisposed.reset()}async setup(t){this.settings={...this.settings,...t},this.settings.autoSetWasm&&await this.autoSetWasm(),this.onSetup.trigger()}async load(t,e=!0){const n=performance.now();this.onIfcStartedLoading.trigger(),await this.readIfcFile(t);const i=await this.getAllGeometries(),o=await this._propertyExporter.export(this.webIfc,0);i.setLocalProperties(o),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-n} ms!`);const a=this.components.get(Xn);a.groups.set(i.uuid,i);for(const l of i.items)a.list.set(l.id,l),l.mesh.uuid=l.id,l.group=i;return e&&a.coordinate([i]),this.onIfcLoaded.trigger(i),i}async readIfcFile(t){const{path:e,absolute:n,logLevel:i}=this.settings.wasm;return this.webIfc.SetWasmPath(e,n),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModel(t,this.settings.webIfc)}async getAllGeometries(){this._spatialTree.setUp(this.webIfc);const t=this.webIfc.GetIfcEntityList(0),e=new Tl,{FILE_NAME:n,FILE_DESCRIPTION:i}=Re;e.ifcMetadata={name:this._metaData.get(this.webIfc,n),description:this._metaData.get(this.webIfc,i),schema:this.webIfc.GetModelSchema(0)||"IFC2X3",maxExpressID:this.webIfc.GetMaxExpressID(0)};const o=[];for(const l of t){if(!this.webIfc.IsIfcElement(l)&&l!==tr||this.settings.excludedCategories.has(l))continue;const h=this.webIfc.GetLineIDsWithType(0,l),p=h.size();for(let m=0;m<p;m++){const I=h.get(m);o.push(I);const f=this._spatialTree.itemsByFloor[I]||0;e.data.set(I,[[],[f,l]])}}this._spatialTree.cleanUp(),this.webIfc.StreamMeshes(0,o,l=>{this.getMesh(l,e)});for(const l of this._visitedFragments){const{index:h,fragment:p}=l[1];e.keyFragments.set(h,p.id)}for(const l of e.items){const h=this._fragmentInstances.get(l.id);if(!h)throw new Error("Fragment not found!");const p=[];for(const[m,I]of h)p.push(I);l.add(p)}const a=this.webIfc.GetCoordinationMatrix(0);return e.coordinationMatrix.fromArray(a),e.civilData=this._civil.read(this.webIfc),e}cleanUp(){this.webIfc=null,this.webIfc=new Qn,this._visitedFragments.clear(),this._fragmentInstances.clear()}getMesh(t,e){const n=t.geometries.size(),i=t.expressID;for(let o=0;o<n;o++){const a=t.geometries.get(o),{x:l,y:h,z:p,w:m}=a.color,I=m!==1,{geometryExpressID:f}=a,T=`${f}-${I}`;if(!this._visitedFragments.has(T)){const R=this.getGeometry(this.webIfc,f),L=I?this._materialT:this._material,k=new Gc(R,L,1);e.add(k.mesh),e.items.push(k);const V=this._visitedFragments.size;this._visitedFragments.set(T,{index:V,fragment:k})}const A=new Wn().setRGB(l,h,p,"srgb"),F=new Mt;F.fromArray(a.flatTransformation);const _=this._visitedFragments.get(T);if(_===void 0)throw new Error("Error getting geometry data for streaming!");const w=e.data.get(i);if(!w)throw new Error("Data not found!");w[0].push(_.index);const{fragment:S}=_;this._fragmentInstances.has(S.id)||this._fragmentInstances.set(S.id,new Map);const Y=this._fragmentInstances.get(S.id);if(!Y)throw new Error("Instances not found!");if(Y.has(i)){const R=Y.get(i);if(!R)throw new Error("Instance not found!");R.transforms.push(F),R.colors&&R.colors.push(A)}else Y.set(i,{id:i,transforms:[F],colors:[A]})}}getGeometry(t,e){const n=t.GetGeometry(0,e),i=t.GetIndexArray(n.GetIndexData(),n.GetIndexDataSize()),o=t.GetVertexArray(n.GetVertexData(),n.GetVertexDataSize()),a=new Float32Array(o.length/2),l=new Float32Array(o.length/2);for(let I=0;I<o.length;I+=6)a[I/2]=o[I],a[I/2+1]=o[I+1],a[I/2+2]=o[I+2],l[I/2]=o[I+3],l[I/2+1]=o[I+4],l[I/2+2]=o[I+5];const h=new jn,p=new $n(a,3),m=new $n(l,3);return h.setAttribute("position",p),h.setAttribute("normal",m),h.setIndex(Array.from(i)),n.delete(),h}async autoSetWasm(){const t=await fetch(`https://unpkg.com/openbim-components@${wl.release}/package.json`);if(!t.ok){console.warn("Couldn't get openbim-components package.json. Set wasm settings manually.");return}const e=await t.json();if(!("web-ifc"in e.peerDependencies))console.warn("Couldn't get web-ifc from peer dependencies in openbim-components. Set wasm settings manually.");else{const n=e.peerDependencies["web-ifc"];this.settings.wasm.path=`https://unpkg.com/web-ifc@${n}/`,this.settings.wasm.absolute=!0}}};y(zl,"uuid","a659add7-1418-4771-a0d6-7d4d438e4624");let Vu=zl;const zu=class zn extends Jt{constructor(t){super(t),y(this,"onDisposed",new at),y(this,"onRequestFile",new at),y(this,"ifcToExport",null),y(this,"onElementToPset",new at),y(this,"onPropToPset",new at),y(this,"onPsetRemoved",new at),y(this,"onDataChanged",new at),y(this,"wasm",{path:"/",absolute:!1}),y(this,"enabled",!0),y(this,"attributeListeners",{}),y(this,"selectedModel"),y(this,"_changeMap",{}),this.components.add(zn.uuid,this)}get(){return this._changeMap}dispose(){this.selectedModel=void 0,this.attributeListeners={},this._changeMap={},this.onElementToPset.reset(),this.onPropToPset.reset(),this.onPsetRemoved.reset(),this.onDataChanged.reset(),this.onDisposed.trigger(zn.uuid),this.onDisposed.reset()}increaseMaxID(t){return t.ifcMetadata.maxExpressID++,t.ifcMetadata.maxExpressID}static getIFCSchema(t){const e=t.ifcMetadata.schema;if(!e)throw new Error("IFC Schema not found");return e}newGUID(t){const e=zn.getIFCSchema(t);return new Re[e].IfcGloballyUniqueId(Po.create())}async getOwnerHistory(t){const e=await t.getAllPropertiesOfType(Nc);if(!e)throw new Error("No OwnerHistory was found.");const n=Object.keys(e).map(a=>parseInt(a,10)),i=e[n[0]],o=new pi(i.expressID);return{ownerHistory:i,ownerHistoryHandle:o}}registerChange(t,...e){this._changeMap[t.uuid]||(this._changeMap[t.uuid]=new Set);for(const n of e)this._changeMap[t.uuid].add(n),this.onDataChanged.trigger({model:t,expressID:n})}async setData(t,...e){for(const n of e){const i=n.expressID;i&&(await t.setProperties(i,n),this.registerChange(t,i))}}async newPset(t,e,n){const i=zn.getIFCSchema(t),{ownerHistoryHandle:o}=await this.getOwnerHistory(t),a=this.newGUID(t),l=new Re[i].IfcLabel(e),h=n?new Re[i].IfcText(n):null,p=new Re[i].IfcPropertySet(a,o,l,h,[]);p.expressID=this.increaseMaxID(t);const m=this.newGUID(t),I=new Re[i].IfcRelDefinesByProperties(m,o,null,null,[],new pi(p.expressID));return I.expressID=this.increaseMaxID(t),await this.setData(t,p,I),{pset:p,rel:I}}async removePset(t,...e){for(const n of e){const i=await t.getProperties(n);if((i==null?void 0:i.type)!==Gi)continue;const o=await nn.getPsetRel(t,n);if(o&&(await t.setProperties(o,null),this.registerChange(t,o)),i){for(const a of i.HasProperties)await t.setProperties(a.value,null);await t.setProperties(n,null),this.onPsetRemoved.trigger({model:t,psetID:n}),this.registerChange(t,n)}}}async newSingleProperty(t,e,n,i){const o=zn.getIFCSchema(t),a=new Re[o].IfcIdentifier(n),l=new Re[o][e](i),h=new Re[o].IfcPropertySingleValue(a,null,l,null);return h.expressID=this.increaseMaxID(t),await this.setData(t,h),h}newSingleStringProperty(t,e,n,i){return this.newSingleProperty(t,e,n,i)}newSingleNumericProperty(t,e,n,i){return this.newSingleProperty(t,e,n,i)}newSingleBooleanProperty(t,e,n,i){return this.newSingleProperty(t,e,n,i)}async removePsetProp(t,e,n){const i=await t.getProperties(e),o=await t.getProperties(n);!i||!o||i.type===Gi&&o&&(i.HasProperties=i.HasProperties.filter(a=>a.value!==n),await t.setProperties(n,null),this.registerChange(t,e,n))}async addElementToPset(t,e,...n){const i=await nn.getPsetRel(t,e);if(!i)return;const o=await t.getProperties(i);if(o){for(const a of n){const l=new pi(a);o.RelatedObjects.push(l),this.onElementToPset.trigger({model:t,psetID:e,elementID:a})}this.registerChange(t,e)}}async addPropToPset(t,e,...n){const i=await t.getProperties(e);if(i){for(const o of n){if(i.HasProperties.includes(o))continue;const a=new pi(o);i.HasProperties.push(a),this.onPropToPset.trigger({model:t,psetID:e,propID:o})}this.registerChange(t,e)}}async saveToIfc(t,e){const n=this.components.get(Vu),i=n.webIfc,o=await n.readIfcFile(e),a=this._changeMap[t.uuid]??[];for(const h of a){const p=await t.getProperties(h);if(p)try{i.WriteLine(o,p)}catch{}else try{i.DeleteLine(o,h)}catch{}}const l=i.SaveModel(o);return n.webIfc.CloseModel(o),n.cleanUp(),l}async setAttributeListener(t,e,n){this.attributeListeners[t.uuid]||(this.attributeListeners[t.uuid]={});const i=this.attributeListeners[t.uuid][e]?this.attributeListeners[t.uuid][e][n]:null;if(i)return i;const o=await t.getProperties(e);if(!o)throw new Error(`Entity with expressID ${e} doesn't exists.`);const a=o[n];if(Array.isArray(a)||!a)throw new Error(`Attribute ${n} is array or null, and it can't have a listener.`);const l=a.value;if(l===void 0||l==null)throw new Error(`Attribute ${n} has a badly defined handle.`);const h=new at;return Object.defineProperty(o[n],"value",{get(){return this._value},async set(p){this._value=p,h.trigger(p)}}),o[n].value=l,this.attributeListeners[t.uuid][e]||(this.attributeListeners[t.uuid][e]={}),this.attributeListeners[t.uuid][e][n]=h,h}};y(zu,"uuid","58c2d9f0-183c-48d6-a402-dfcf5b9a34df");const Hu=class Hl extends Jt{constructor(t){super(t),y(this,"enabled",!0),y(this,"_groupSystems",{}),y(this,"onDisposed",new at),y(this,"onFragmentsDisposed",e=>{const{groupID:n,fragmentIDs:i}=e;for(const o in this._groupSystems){const a=this._groupSystems[o],l=Object.keys(a);if(l.includes(n))delete a[n],Object.values(a).length===0&&delete this._groupSystems[o];else for(const h of l){const p=a[h];for(const m of i)delete p[m];Object.values(p).length===0&&delete a[h]}}}),t.add(Hl.uuid,this),t.get(Xn).onFragmentsDisposed.add(this.onFragmentsDisposed)}get(){return this._groupSystems}dispose(){this._groupSystems={},this.components.get(Xn).onFragmentsDisposed.remove(this.onFragmentsDisposed),this.onDisposed.trigger(),this.onDisposed.reset()}remove(t){for(const e in this._groupSystems){const n=this._groupSystems[e];for(const i in n){const o=n[i];delete o[t]}}}find(t){const e=this.components.get(Xn);if(!t){const a={};for(const[l,h]of e.list)a[l]=new Set(h.ids);return a}const n=Object.keys(t).length,i={};for(const a in t){const l=t[a];if(!this._groupSystems[a]){console.warn(`Classification ${a} does not exist.`);continue}for(const h of l){const p=this._groupSystems[a][h];if(p)for(const m in p){i[m]||(i[m]=new Map);for(const I of p[m]){const f=i[m].get(I);f===void 0?i[m].set(I,1):i[m].set(I,f+1)}}}}const o={};for(const a in i){const l=i[a];for(const[h,p]of l){if(p===void 0)throw new Error("Malformed fragments map!");p===n&&(o[a]||(o[a]=new Set),o[a].add(h))}}return o}byModel(t,e){this._groupSystems.model||(this._groupSystems.model={});const n=this._groupSystems.model;n[t]||(n[t]={});const i=n[t];for(const[o,a]of e.data){const l=a[0];for(const h of l){const p=e.keyFragments.get(h);p&&(i[p]||(i[p]=new Set),i[p].add(o))}}}async byPredefinedType(t){var e;this._groupSystems.predefinedTypes||(this._groupSystems.predefinedTypes={});const n=this._groupSystems.predefinedTypes,i=t.getAllPropertiesIDs();for(const o of i){const a=await t.getProperties(o);if(!a)continue;const l=String((e=a.PredefinedType)==null?void 0:e.value).toUpperCase();n[l]||(n[l]={});const h=n[l];for(const[p,m]of t.data){const I=m[0];for(const f of I){const T=t.keyFragments.get(f);if(!T)throw new Error("Fragment ID not found!");h[T]||(h[T]=new Set),h[T].add(a.expressID)}}}}byEntity(t){this._groupSystems.entities||(this._groupSystems.entities={});for(const[e,n]of t.data){const i=n[1][1],o=Ul[i];this.saveItem(t,"entities",o,e)}}byStorey(t){for(const[e,n]of t.data){const i=n[1][0].toString();this.saveItem(t,"storeys",i,e)}}async byIfcRel(t,e,n){nn.isRel(e)&&await nn.getRelationMap(t,e,async(i,o)=>{const{name:a}=await nn.getEntityName(t,i);for(const l of o)this.saveItem(t,n,a??"NO REL NAME",l)})}saveItem(t,e,n,i){this._groupSystems[e]||(this._groupSystems[e]={});const o=t.data.get(i);if(o)for(const a of o[0]){const l=t.keyFragments.get(a);if(l){const h=this._groupSystems[e];h[n]||(h[n]={}),h[n][l]||(h[n][l]=new Set),h[n][l].add(i)}}}};y(Hu,"uuid","e25a7f3c-46c4-4a14-9d3d-5115f24ebeb7");class Ku extends No{constructor(){super(...arguments),y(this,"minGeometrySize",10),y(this,"minAssetsSize",1e3)}}class Wu extends No{constructor(){super(...arguments),y(this,"propertiesSize",100)}}class Xu extends Jt{constructor(){super(...arguments),y(this,"onPropertiesStreamed",new at),y(this,"onProgress",new at),y(this,"onIndicesStreamed",new at),y(this,"onDisposed",new at),y(this,"enabled",!0),y(this,"settings",new Wu),y(this,"webIfc",new Qn)}async dispose(){this.onIndicesStreamed.reset(),this.onPropertiesStreamed.reset(),this.webIfc=null,this.onDisposed.reset()}async streamFromBuffer(t){const e=performance.now();await this.readIfcFile(t),await this.streamAllProperties(),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-e} ms!`)}async streamFromCallBack(t){const e=performance.now();await this.streamIfcFile(t),await this.streamAllProperties(),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-e} ms!`)}async readIfcFile(t){const{path:e,absolute:n,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(e,n),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModel(t,this.settings.webIfc)}async streamIfcFile(t){const{path:e,absolute:n,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(e,n),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModelFromCallback(t,this.settings.webIfc)}async streamAllProperties(){const{propertiesSize:t}=this.settings,e=new Set(this.webIfc.GetIfcEntityList(0)),n=[Ao,al,ll,Fo,cl,hl],i=new Map,o=new Set([El,fl,Il,ml,tr]);for(const p of o)e.add(p);let a=.01,l=0;for(const p of e){if(l++,Dl.has(p))continue;const m=o.has(p),I=this.webIfc.GetLineIDsWithType(0,p),f=I.size();let T=0;for(let F=0;F<f-t;F+=t){const _={};for(let w=0;w<t;w++){T++;const S=I.get(F+w);try{const Y=this.webIfc.GetLine(0,S,m);n.includes(p)&&this.getIndices(Y,S,i),_[Y.expressID]=Y}catch{console.log(`Could not get property: ${S}`)}}await this.onPropertiesStreamed.trigger({type:p,data:_})}if(T!==f){const F={};for(let _=T;_<f;_++){const w=I.get(_);try{const S=this.webIfc.GetLine(0,w,m);n.includes(p)&&this.getIndices(S,w,i),F[S.expressID]=S}catch{console.log(`Could not get property: ${w}`)}}await this.onPropertiesStreamed.trigger({type:p,data:F})}const A=l/e.size;A>a&&(a+=.01,a=Math.max(a,A),await this.onProgress.trigger(Math.round(a*100)/100))}const h=[];for(const[p,m]of i)h.push([p,...m]);await this.onIndicesStreamed.trigger(h)}getIndices(t,e,n){const i=t.RelatedObjects||t.RelatedElements;if(!i){console.log(`Related objects not found: ${e}`);return}const o=t.RelatingType||t.RelatingMaterial||t.RelatingStructure||t.RelatingPropertyDefinition||t.RelatingGroup||t.RelatingClassification;if(!o){console.log(`Relating object not found: ${e}`);return}if(!Array.isArray(i)||o.value===void 0)return;const a=o.value;for(const l of i){if(l.value===void 0||l.value===null)continue;const h=l.value;n.has(h)||n.set(h,new Set),n.get(h).add(a)}}cleanUp(){this.webIfc=null,this.webIfc=new Qn}}y(Xu,"uuid","88d2c89c-ce32-47d7-8cb6-d51e4b311a0b");const ju=class Kl extends Jt{constructor(t){super(t),y(this,"onGeometryStreamed",new at),y(this,"onAssetStreamed",new at),y(this,"onProgress",new at),y(this,"onIfcLoaded",new at),y(this,"onDisposed",new at),y(this,"settings",new Ku),y(this,"enabled",!0),y(this,"webIfc",new Qn),y(this,"_spatialTree",new kl),y(this,"_metaData",new Vl),y(this,"_visitedGeometries",new Map),y(this,"_streamSerializer",new Hc),y(this,"_geometries",new Map),y(this,"_geometryCount",0),y(this,"_civil",new Gl),y(this,"_groupSerializer",new Cl),y(this,"_assets",[]),y(this,"_meshesWithHoles",new Set),this.components.add(Kl.uuid,this),this.settings.excludedCategories.add(ul)}dispose(){this.onIfcLoaded.reset(),this.onGeometryStreamed.reset(),this.onAssetStreamed.reset(),this.webIfc=null,this.onDisposed.trigger(),this.onDisposed.reset()}async streamFromBuffer(t){const e=performance.now();await this.readIfcFile(t),await this.streamAllGeometries(),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-e} ms!`)}async streamFromCallBack(t){const e=performance.now();await this.streamIfcFile(t),await this.streamAllGeometries(),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-e} ms!`)}async readIfcFile(t){const{path:e,absolute:n,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(e,n),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModel(t,this.settings.webIfc)}async streamIfcFile(t){const{path:e,absolute:n,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(e,n),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModelFromCallback(t,this.settings.webIfc)}async streamAllGeometries(){const{minGeometrySize:t,minAssetsSize:e}=this.settings;this._spatialTree.setUp(this.webIfc);const n=this.webIfc.GetIfcEntityList(0),i=[[]],o=new Tl,{FILE_NAME:a,FILE_DESCRIPTION:l}=Re;o.ifcMetadata={name:this._metaData.get(this.webIfc,a),description:this._metaData.get(this.webIfc,l),schema:this.webIfc.GetModelSchema(0)||"IFC2X3",maxExpressID:this.webIfc.GetMaxExpressID(0)};let h=0,p=0;for(const w of n){if(!this.webIfc.IsIfcElement(w)&&w!==tr||this.settings.excludedCategories.has(w))continue;const S=this.webIfc.GetLineIDsWithType(0,w),Y=S.size();for(let R=0;R<Y;R++){h>t&&(h=0,p++,i.push([]));const L=S.get(R);i[p].push(L);const k=this._spatialTree.itemsByFloor[L]||0;o.data.set(L,[[],[k,w]]),h++}}this._spatialTree.cleanUp();let m=.01,I=0;for(const w of i){I++,this.webIfc.StreamMeshes(0,w,Y=>{this.getMesh(this.webIfc,Y,o)}),this._geometryCount>t&&await this.streamGeometries(),this._assets.length>e&&await this.streamAssets();const S=I/i.length;S>m&&(m+=.01,m=Math.max(m,S),this.onProgress.trigger(Math.round(m*100)/100))}this._geometryCount&&await this.streamGeometries(),this._assets.length&&await this.streamAssets();const{opaque:f,transparent:T}=o.geometryIDs;for(const[w,{index:S,uuid:Y}]of this._visitedGeometries)o.keyFragments.set(S,Y),(w>1?f:T).set(w,S);const A=o.data.keys();for(const w of A){const[S]=o.data.get(w);S.length||o.data.delete(w)}const F=this.webIfc.GetCoordinationMatrix(0);o.coordinationMatrix.fromArray(F),o.civilData=this._civil.read(this.webIfc);const _=this._groupSerializer.export(o);this.onIfcLoaded.trigger(_),o.dispose(!0)}cleanUp(){this.webIfc=null,this.webIfc=new Qn,this._visitedGeometries.clear(),this._geometries.clear(),this._assets=[],this._meshesWithHoles.clear()}getMesh(t,e,n){const i=e.geometries.size(),o=e.expressID,a={id:o,geometries:[]};e.expressID===664833&&console.log("Heyyy");for(let l=0;l<i;l++){const h=e.geometries.get(l),p=h.geometryExpressID,m=h.color.w===1?1:-1,I=p*m;if(!this._visitedGeometries.has(I)){this._visitedGeometries.has(p)||this.getGeometry(t,p);const R=this._visitedGeometries.size,L=ol.generateUUID();this._visitedGeometries.set(I,{uuid:L,index:R})}const f=this._visitedGeometries.get(I);if(f===void 0)throw new Error("Error getting geometry data for streaming!");const T=n.data.get(o);if(!T)throw new Error("Data not found!");T[0].push(f.index);const{x:A,y:F,z:_,w}=h.color,S=[A,F,_,w],Y=h.flatTransformation;a.geometries.push({color:S,geometryID:p,transformation:Y})}this._assets.push(a)}getGeometry(t,e){const n=t.GetGeometry(0,e),i=t.GetIndexArray(n.GetIndexData(),n.GetIndexDataSize()),o=t.GetVertexArray(n.GetVertexData(),n.GetVertexDataSize()),a=new Float32Array(o.length/2),l=new Float32Array(o.length/2);for(let f=0;f<o.length;f+=6)a[f/2]=o[f],a[f/2+1]=o[f+1],a[f/2+2]=o[f+2],l[f/2]=o[f+3],l[f/2+1]=o[f+4],l[f/2+2]=o[f+5];const h=hu(a),p=new Float32Array(h.transformation.elements),m=[h.center.x,h.center.y,h.center.z];let I=!1;for(let f=0;f<a.length-2;f+=3){const T=a[f],A=a[f+1],F=a[f+2],_=l[f],w=l[f+1],S=l[f+2];if(uu(m,[T,A,F],[_,w,S])){I=!0;break}}this._geometries.set(e,{position:a,normal:l,index:i,boundingBox:p,hasHoles:I}),n.delete(),this._geometryCount++}async streamAssets(){await this.onAssetStreamed.trigger(this._assets),this._assets=null,this._assets=[]}async streamGeometries(){let t=this._streamSerializer.export(this._geometries),e={};for(const[n,{boundingBox:i,hasHoles:o}]of this._geometries)e[n]={boundingBox:i,hasHoles:o};this.onGeometryStreamed.trigger({data:e,buffer:t}),e=null,t=null,this._geometries.clear(),this._geometryCount=0}};y(ju,"uuid","d9999a00-e1f5-4d3f-8cfe-c56e08609764");class qu extends Ur{constructor(t=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=t,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new Fe(.5,.5),this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof Element&&e.element.parentNode!==null&&e.element.parentNode.removeChild(e.element)})})}copy(t,e){return super.copy(t,e),this.element=t.element.cloneNode(!0),this.center=t.center,this}}const Vn=new q,Ja=new Mt,tl=new Mt,el=new q,nl=new q;class Zu{constructor(t={}){const e=this;let n,i,o,a;const l={objects:new WeakMap},h=t.element!==void 0?t.element:document.createElement("div");h.style.overflow="hidden",this.domElement=h,this.getSize=function(){return{width:n,height:i}},this.render=function(T,A){T.matrixWorldAutoUpdate===!0&&T.updateMatrixWorld(),A.parent===null&&A.matrixWorldAutoUpdate===!0&&A.updateMatrixWorld(),Ja.copy(A.matrixWorldInverse),tl.multiplyMatrices(A.projectionMatrix,Ja),p(T,T,A),f(T)},this.setSize=function(T,A){n=T,i=A,o=n/2,a=i/2,h.style.width=T+"px",h.style.height=A+"px"};function p(T,A,F){if(T.isCSS2DObject){Vn.setFromMatrixPosition(T.matrixWorld),Vn.applyMatrix4(tl);const _=T.visible===!0&&Vn.z>=-1&&Vn.z<=1&&T.layers.test(F.layers)===!0;if(T.element.style.display=_===!0?"":"none",_===!0){T.onBeforeRender(e,A,F);const S=T.element;S.style.transform="translate("+-100*T.center.x+"%,"+-100*T.center.y+"%)translate("+(Vn.x*o+o)+"px,"+(-Vn.y*a+a)+"px)",S.parentNode!==h&&h.appendChild(S),T.onAfterRender(e,A,F)}const w={distanceToCameraSquared:m(F,T)};l.objects.set(T,w)}for(let _=0,w=T.children.length;_<w;_++)p(T.children[_],A,F)}function m(T,A){return el.setFromMatrixPosition(T.matrixWorld),nl.setFromMatrixPosition(A.matrixWorld),el.distanceToSquared(nl)}function I(T){const A=[];return T.traverse(function(F){F.isCSS2DObject&&A.push(F)}),A}function f(T){const A=I(T).sort(function(_,w){if(_.renderOrder!==w.renderOrder)return w.renderOrder-_.renderOrder;const S=l.objects.get(_).distanceToCameraSquared,Y=l.objects.get(w).distanceToCameraSquared;return S-Y}),F=A.length;for(let _=0,w=A.length;_<w;_++)A[_].element.style.zIndex=F-_}}}class Qu extends Iu{constructor(e,n,i){super(e,n,i);Wt(this,"three2D",new Zu);this.onAfterUpdate.add(()=>{if(this.onBeforeUpdate.trigger(this),!this.enabled||!this.currentWorld)return;const o=this.currentWorld.scene.three,a=this.currentWorld.camera.three;o instanceof Dr&&this.three2D.render(o,a)}),this.onDisposed.add(()=>{this.three2D.domElement.remove()}),this.onResize.add(({x:o,y:a})=>{this.three2D.setSize(o,a)}),this.onContainerUpdated.add(o=>{o.appendChild(this.three2D.domElement)}),this.setupHtmlRenderer(),this.resize()}setupHtmlRenderer(){this.three2D.domElement.style.position="absolute",this.three2D.domElement.style.top="0px",this.three2D.domElement.style.pointerEvents="none",this.container&&this.container.appendChild(this.three2D.domElement)}}class rl{constructor(t,e,n){Wt(this,"three");Wt(this,"world");Wt(this,"onDisposed",new at);this.world=t;let i;e?i=e:(i=document.createElement("div"),i.className="w-[15px] h-[15px] border-3 border-solid border-red-600"),this.three=new qu(i),(n||t.scene.three).add(this.three),this.visible=!0}set visible(t){this.three.visible=t}get visible(){return this.three.visible}toggleVisibility(){this.visible=!this.visible}dispose(){this.three.removeFromParent(),this.three.element.remove(),this.onDisposed.trigger(),this.onDisposed.reset()}}const zi=class zi extends Jt{constructor(e){super(e);Wt(this,"enabled",!0);Wt(this,"threshold",50);Wt(this,"autoCluster",!0);Wt(this,"list",new Map);Wt(this,"clusterLabels",new Set);Wt(this,"currentKeys",new Set);Wt(this,"_color","white");Wt(this,"_markerKey",0);Wt(this,"_clusterKey",0);Wt(this,"isNavigating",!1);Wt(this,"_setupWorlds",new Set);e.add(zi.uuid,this)}get color(){return this._color}set color(e){this._color=e;for(const[n,i]of this.list)i.label.three.element.style.color=e}create(e,n,i){this.setupEvents(e,!0);const o=document.createElement("span");o.innerHTML=n,o.style.color=this._color;const a=new rl(e,o);a.three.position.copy(i);const l=this._markerKey.toString();return this.list.set(l,{key:l,label:a,merged:!1,static:!1}),this._markerKey++,l}delete(e){const n=this.list.get(e);n&&n.label.dispose(),this.list.delete(e)}clear(e){const n=[...this.list.keys()];for(const i of n){const o=this.list.get(i);e&&o.type!==e||(o.label.dispose(),this.list.delete(i))}this.list.clear(),this._markerKey=0}dispose(){for(const[e,n]of this.list)n.label.dispose();this.list.clear(),this._markerKey=0;for(const e of this.clusterLabels)e.label.dispose();this.clusterLabels.clear(),this._clusterKey=0,this.currentKeys.clear()}setupEvents(e,n){n&&this._setupWorlds.has(e.uuid)||e.camera.hasCameraControls()&&(n?(e.camera.controls.addEventListener("sleep",()=>{this.manageCluster()}),e.camera.controls.addEventListener("rest",()=>{this.isNavigating&&(this.manageCluster(),this.isNavigating=!1)})):(e.camera.controls.removeEventListener("sleep",()=>{this.manageCluster()}),e.camera.controls.removeEventListener("rest",()=>{this.isNavigating&&(this.manageCluster(),this.isNavigating=!1)})))}resetMarkers(){for(const[e,n]of this.list)n.merged=!1;for(const e of this.clusterLabels)e.label.dispose();this.clusterLabels.clear(),this._clusterKey=0}removeMergeMarkers(){for(const[e,n]of this.list)n.merged?n.label.dispose():n.label.world.scene.three.add(n.label.three);for(const e of this.clusterLabels)if(e.markerKeys.length===1){const n=this.list.get(e.markerKeys[0]);n&&(n.label.world.scene.three.add(n.label.three),n.merged=!1),e.label.dispose(),this.clusterLabels.delete(e)}}manageCluster(){if(this.autoCluster){this.resetMarkers();for(const[e,n]of this.list)if(!n.merged&&!n.static){this.currentKeys.clear();for(const[i,o]of this.list)o.static||n.key!==o.key&&!o.merged&&this.distance(n.label,o.label)<this.threshold&&(this.currentKeys.add(o.key),o.merged=!0);if(this.currentKeys.size>0){this.currentKeys.add(n.key),n.merged=!0;const i=Array.from(this.currentKeys),o=this.getAveragePositionFromLabels(i),a=new rl(n.label.world,this.createClusterElement(this._clusterKey.toString())),{element:l}=a.three;l.textContent=i.length.toString(),a.three.position.copy(o),this.clusterLabels.add({key:this._clusterKey.toString(),markerKeys:i,label:a}),this._clusterKey++}}this.removeMergeMarkers()}}getAveragePositionFromLabels(e){const n=e.map(i=>{const o=this.list.get(i);return o?o.label.three.position:new q});return n.reduce((i,o)=>i.add(o),new q).divideScalar(n.length)}createClusterElement(e){const n=document.createElement("div");return n.textContent=e,n.style.color="#000000",n.style.background="#FFFFFF",n.style.fontSize="1.2rem",n.style.fontWeight="500",n.style.pointerEvents="auto",n.style.borderRadius="50%",n.style.padding="5px 11px",n.style.textAlign="center",n.style.cursor="pointer",n.addEventListener("pointerdown",()=>{this.navigateToCluster(e)}),n.addEventListener("pointerover",()=>{n.style.background="#BCF124"}),n.addEventListener("pointerout",()=>{n.style.background="#FFFFFF"}),n}getScreenPosition(e){const n=new q;if(!e.world.renderer)throw new Error("Renderer not found!");const i=e.three.position.clone();i.project(e.world.camera.three);const o=e.world.renderer.getSize();return n.x=i.x*o.x/2+o.x/2,n.y=-(i.y*o.y/2)+o.y/2,n}distance(e,n){const i=this.getScreenPosition(e),o=this.getScreenPosition(n),a=i.x-o.x,l=i.y-o.y,h=Math.sqrt(a*a+l*l)*.5;return h===0?this.threshold+1:h}navigateToCluster(e){const n=[],i=Array.from(this.clusterLabels).find(I=>I.key===e);if(!i)return;const o=i.label.world.camera;if(!o.hasCameraControls()){console.warn("Zoom to clusters only supported with Camera Controls!");return}for(const I of i.markerKeys){const f=this.list.get(I);if(f){const{x:T,y:A,z:F}=f.label.three.position;n.push(T,A,F)}}i.label.dispose(),this.clusterLabels.delete(i);const a=new jn,l=new Float32Array(n),h=new $n(l,3);a.setAttribute("position",h);const p=new lt(a);p.geometry.computeBoundingSphere(),p.geometry.boundingSphere&&o.controls.fitToSphere(p,!0),this.isNavigating=!0,a.dispose(),p.clear(),n.length=0}};Wt(zi,"uuid","4079eb91-79b0-4ede-bcf2-15b837129236");let Co=zi;var Wl={exports:{}};(function(u,t){(function(e,n){u.exports=n()})(Ea,function(){var e=function(r,s){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,d){c.__proto__=d}||function(c,d){for(var E in d)Object.prototype.hasOwnProperty.call(d,E)&&(c[E]=d[E])})(r,s)},n=function(){return(n=Object.assign||function(r){for(var s,c=1,d=arguments.length;c<d;c++)for(var E in s=arguments[c])Object.prototype.hasOwnProperty.call(s,E)&&(r[E]=s[E]);return r}).apply(this,arguments)};function i(r,s,c){if(c||arguments.length===2)for(var d,E=0,C=s.length;E<C;E++)!d&&E in s||((d=d||Array.prototype.slice.call(s,0,E))[E]=s[E]);return r.concat(d||Array.prototype.slice.call(s))}var o=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Ea,a=Object.keys,l=Array.isArray;function h(r,s){return typeof s!="object"||a(s).forEach(function(c){r[c]=s[c]}),r}typeof Promise>"u"||o.Promise||(o.Promise=Promise);var p=Object.getPrototypeOf,m={}.hasOwnProperty;function I(r,s){return m.call(r,s)}function f(r,s){typeof s=="function"&&(s=s(p(r))),(typeof Reflect>"u"?a:Reflect.ownKeys)(s).forEach(function(c){A(r,c,s[c])})}var T=Object.defineProperty;function A(r,s,c,d){T(r,s,h(c&&I(c,"get")&&typeof c.get=="function"?{get:c.get,set:c.set,configurable:!0}:{value:c,configurable:!0,writable:!0},d))}function F(r){return{from:function(s){return r.prototype=Object.create(s.prototype),A(r.prototype,"constructor",r),{extend:f.bind(null,r.prototype)}}}}var _=Object.getOwnPropertyDescriptor,w=[].slice;function S(r,s,c){return w.call(r,s,c)}function Y(r,s){return s(r)}function R(r){if(!r)throw new Error("Assertion Failed")}function L(r){o.setImmediate?setImmediate(r):setTimeout(r,0)}function k(r,s){if(typeof s=="string"&&I(r,s))return r[s];if(!s)return r;if(typeof s!="string"){for(var c=[],d=0,E=s.length;d<E;++d){var C=k(r,s[d]);c.push(C)}return c}var g=s.indexOf(".");if(g!==-1){var O=r[s.substr(0,g)];return O==null?void 0:k(O,s.substr(g+1))}}function V(r,s,c){if(r&&s!==void 0&&!("isFrozen"in Object&&Object.isFrozen(r)))if(typeof s!="string"&&"length"in s){R(typeof c!="string"&&"length"in c);for(var d=0,E=s.length;d<E;++d)V(r,s[d],c[d])}else{var C,g,O=s.indexOf(".");O!==-1?(C=s.substr(0,O),(g=s.substr(O+1))===""?c===void 0?l(r)&&!isNaN(parseInt(C))?r.splice(C,1):delete r[C]:r[C]=c:V(O=!(O=r[C])||!I(r,C)?r[C]={}:O,g,c)):c===void 0?l(r)&&!isNaN(parseInt(s))?r.splice(s,1):delete r[s]:r[s]=c}}function H(r){var s,c={};for(s in r)I(r,s)&&(c[s]=r[s]);return c}var j=[].concat;function Q(r){return j.apply([],r)}var Be="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Q([8,16,32,64].map(function(r){return["Int","Uint","Float"].map(function(s){return s+r+"Array"})}))).filter(function(r){return o[r]}),J=new Set(Be.map(function(r){return o[r]})),$=null;function nt(r){return $=new WeakMap,r=function s(c){if(!c||typeof c!="object")return c;var d=$.get(c);if(d)return d;if(l(c)){d=[],$.set(c,d);for(var E=0,C=c.length;E<C;++E)d.push(s(c[E]))}else if(J.has(c.constructor))d=c;else{var g,O=p(c);for(g in d=O===Object.prototype?{}:Object.create(O),$.set(c,d),c)I(c,g)&&(d[g]=s(c[g]))}return d}(r),$=null,r}var ut={}.toString;function It(r){return ut.call(r).slice(8,-1)}var yt=typeof Symbol<"u"?Symbol.iterator:"@@iterator",kt=typeof yt=="symbol"?function(r){var s;return r!=null&&(s=r[yt])&&s.apply(r)}:function(){return null};function Rt(r,s){return s=r.indexOf(s),0<=s&&r.splice(s,1),0<=s}var te={};function Kt(r){var s,c,d,E;if(arguments.length===1){if(l(r))return r.slice();if(this===te&&typeof r=="string")return[r];if(E=kt(r)){for(c=[];!(d=E.next()).done;)c.push(d.value);return c}if(r==null)return[r];if(typeof(s=r.length)!="number")return[r];for(c=new Array(s);s--;)c[s]=r[s];return c}for(s=arguments.length,c=new Array(s);s--;)c[s]=arguments[s];return c}var fe=typeof Symbol<"u"?function(r){return r[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},ar=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],ce=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(ar),gn={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function le(r,s){this.name=r,this.message=s}function rr(r,s){return r+". Errors: "+Object.keys(s).map(function(c){return s[c].toString()}).filter(function(c,d,E){return E.indexOf(c)===d}).join(`
`)}function sn(r,s,c,d){this.failures=s,this.failedKeys=d,this.successCount=c,this.message=rr(r,s)}function xe(r,s){this.name="BulkError",this.failures=Object.keys(s).map(function(c){return s[c]}),this.failuresByPos=s,this.message=rr(r,this.failures)}F(le).from(Error).extend({toString:function(){return this.name+": "+this.message}}),F(sn).from(le),F(xe).from(le);var De=ce.reduce(function(r,s){return r[s]=s+"Error",r},{}),Ut=le,ct=ce.reduce(function(r,s){var c=s+"Error";function d(E,C){this.name=c,E?typeof E=="string"?(this.message="".concat(E).concat(C?`
 `+C:""),this.inner=C||null):typeof E=="object"&&(this.message="".concat(E.name," ").concat(E.message),this.inner=E):(this.message=gn[s]||c,this.inner=null)}return F(d).from(Ut),r[s]=d,r},{});ct.Syntax=SyntaxError,ct.Type=TypeError,ct.Range=RangeError;var xt=ar.reduce(function(r,s){return r[s+"Error"]=ct[s],r},{}),Ie=ce.reduce(function(r,s){return["Syntax","Type","Range"].indexOf(s)===-1&&(r[s+"Error"]=ct[s]),r},{});function Ot(){}function Oe(r){return r}function Xi(r,s){return r==null||r===Oe?s:function(c){return s(r(c))}}function me(r,s){return function(){r.apply(this,arguments),s.apply(this,arguments)}}function ir(r,s){return r===Ot?s:function(){var c=r.apply(this,arguments);c!==void 0&&(arguments[0]=c);var d=this.onsuccess,E=this.onerror;this.onsuccess=null,this.onerror=null;var C=s.apply(this,arguments);return d&&(this.onsuccess=this.onsuccess?me(d,this.onsuccess):d),E&&(this.onerror=this.onerror?me(E,this.onerror):E),C!==void 0?C:c}}function sr(r,s){return r===Ot?s:function(){r.apply(this,arguments);var c=this.onsuccess,d=this.onerror;this.onsuccess=this.onerror=null,s.apply(this,arguments),c&&(this.onsuccess=this.onsuccess?me(c,this.onsuccess):c),d&&(this.onerror=this.onerror?me(d,this.onerror):d)}}function jl(r,s){return r===Ot?s:function(c){var d=r.apply(this,arguments);h(c,d);var E=this.onsuccess,C=this.onerror;return this.onsuccess=null,this.onerror=null,c=s.apply(this,arguments),E&&(this.onsuccess=this.onsuccess?me(E,this.onsuccess):E),C&&(this.onerror=this.onerror?me(C,this.onerror):C),d===void 0?c===void 0?void 0:c:h(d,c)}}function ql(r,s){return r===Ot?s:function(){return s.apply(this,arguments)!==!1&&r.apply(this,arguments)}}function ji(r,s){return r===Ot?s:function(){var c=r.apply(this,arguments);if(c&&typeof c.then=="function"){for(var d=this,E=arguments.length,C=new Array(E);E--;)C[E]=arguments[E];return c.then(function(){return s.apply(d,C)})}return s.apply(this,arguments)}}Ie.ModifyError=sn,Ie.DexieError=le,Ie.BulkError=xe;var we=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Lo(r){we=r}var or={},Mo=100,Be=typeof Promise>"u"?[]:function(){var r=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[r,p(r),r];var s=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[s,p(s),r]}(),ar=Be[0],ce=Be[1],Be=Be[2],ce=ce&&ce.then,lr=ar&&ar.constructor,qi=!!Be,cr=function(r,s){hr.push([r,s]),Gr&&(queueMicrotask(Ql),Gr=!1)},Zi=!0,Gr=!0,on=[],Vr=[],Qi=Oe,ze={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Ot,pgp:!1,env:{},finalize:Ot},ht=ze,hr=[],an=0,zr=[];function ot(r){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var s=this._PSD=ht;if(typeof r!="function"){if(r!==or)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Ji(this,this._value))}this._state=null,this._value=null,++s.ref,function c(d,E){try{E(function(C){if(d._state===null){if(C===d)throw new TypeError("A promise cannot be resolved with itself.");var g=d._lib&&yn();C&&typeof C.then=="function"?c(d,function(O,N){C instanceof ot?C._then(O,N):C.then(O,N)}):(d._state=!0,d._value=C,Do(d)),g&&Rn()}},Ji.bind(null,d))}catch(C){Ji(d,C)}}(this,r)}var $i={get:function(){var r=ht,s=Xr;function c(d,E){var C=this,g=!r.global&&(r!==ht||s!==Xr),O=g&&!Ke(),N=new ot(function(P,D){ts(C,new xo(Bo(d,r,g,O),Bo(E,r,g,O),P,D,r))});return this._consoleTask&&(N._consoleTask=this._consoleTask),N}return c.prototype=or,c},set:function(r){A(this,"then",r&&r.prototype===or?$i:{get:function(){return r},set:$i.set})}};function xo(r,s,c,d,E){this.onFulfilled=typeof r=="function"?r:null,this.onRejected=typeof s=="function"?s:null,this.resolve=c,this.reject=d,this.psd=E}function Ji(r,s){var c,d;Vr.push(s),r._state===null&&(c=r._lib&&yn(),s=Qi(s),r._state=!1,r._value=s,d=r,on.some(function(E){return E._value===d._value})||on.push(d),Do(r),c&&Rn())}function Do(r){var s=r._listeners;r._listeners=[];for(var c=0,d=s.length;c<d;++c)ts(r,s[c]);var E=r._PSD;--E.ref||E.finalize(),an===0&&(++an,cr(function(){--an==0&&es()},[]))}function ts(r,s){if(r._state!==null){var c=r._state?s.onFulfilled:s.onRejected;if(c===null)return(r._state?s.resolve:s.reject)(r._value);++s.psd.ref,++an,cr(Zl,[c,r,s])}else r._listeners.push(s)}function Zl(r,s,c){try{var d,E=s._value;!s._state&&Vr.length&&(Vr=[]),d=we&&s._consoleTask?s._consoleTask.run(function(){return r(E)}):r(E),s._state||Vr.indexOf(E)!==-1||function(C){for(var g=on.length;g;)if(on[--g]._value===C._value)return on.splice(g,1)}(s),c.resolve(d)}catch(C){c.reject(C)}finally{--an==0&&es(),--c.psd.ref||c.psd.finalize()}}function Ql(){ln(ze,function(){yn()&&Rn()})}function yn(){var r=Zi;return Gr=Zi=!1,r}function Rn(){var r,s,c;do for(;0<hr.length;)for(r=hr,hr=[],c=r.length,s=0;s<c;++s){var d=r[s];d[0].apply(null,d[1])}while(0<hr.length);Gr=Zi=!0}function es(){var r=on;on=[],r.forEach(function(d){d._PSD.onunhandled.call(null,d._value,d)});for(var s=zr.slice(0),c=s.length;c;)s[--c]()}function Hr(r){return new ot(or,!1,r)}function Nt(r,s){var c=ht;return function(){var d=yn(),E=ht;try{return We(c,!0),r.apply(this,arguments)}catch(C){s&&s(C)}finally{We(E,!1),d&&Rn()}}}f(ot.prototype,{then:$i,_then:function(r,s){ts(this,new xo(null,null,r,s,ht))},catch:function(r){if(arguments.length===1)return this.then(null,r);var s=r,c=arguments[1];return typeof s=="function"?this.then(null,function(d){return(d instanceof s?c:Hr)(d)}):this.then(null,function(d){return(d&&d.name===s?c:Hr)(d)})},finally:function(r){return this.then(function(s){return ot.resolve(r()).then(function(){return s})},function(s){return ot.resolve(r()).then(function(){return Hr(s)})})},timeout:function(r,s){var c=this;return r<1/0?new ot(function(d,E){var C=setTimeout(function(){return E(new ct.Timeout(s))},r);c.then(d,E).finally(clearTimeout.bind(null,C))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&A(ot.prototype,Symbol.toStringTag,"Dexie.Promise"),ze.env=Uo(),f(ot,{all:function(){var r=Kt.apply(null,arguments).map(jr);return new ot(function(s,c){r.length===0&&s([]);var d=r.length;r.forEach(function(E,C){return ot.resolve(E).then(function(g){r[C]=g,--d||s(r)},c)})})},resolve:function(r){return r instanceof ot?r:r&&typeof r.then=="function"?new ot(function(s,c){r.then(s,c)}):new ot(or,!0,r)},reject:Hr,race:function(){var r=Kt.apply(null,arguments).map(jr);return new ot(function(s,c){r.map(function(d){return ot.resolve(d).then(s,c)})})},PSD:{get:function(){return ht},set:function(r){return ht=r}},totalEchoes:{get:function(){return Xr}},newPSD:He,usePSD:ln,scheduler:{get:function(){return cr},set:function(r){cr=r}},rejectionMapper:{get:function(){return Qi},set:function(r){Qi=r}},follow:function(r,s){return new ot(function(c,d){return He(function(E,C){var g=ht;g.unhandleds=[],g.onunhandled=C,g.finalize=me(function(){var O,N=this;O=function(){N.unhandleds.length===0?E():C(N.unhandleds[0])},zr.push(function P(){O(),zr.splice(zr.indexOf(P),1)}),++an,cr(function(){--an==0&&es()},[])},g.finalize),r()},s,c,d)})}}),lr&&(lr.allSettled&&A(ot,"allSettled",function(){var r=Kt.apply(null,arguments).map(jr);return new ot(function(s){r.length===0&&s([]);var c=r.length,d=new Array(c);r.forEach(function(E,C){return ot.resolve(E).then(function(g){return d[C]={status:"fulfilled",value:g}},function(g){return d[C]={status:"rejected",reason:g}}).then(function(){return--c||s(d)})})})}),lr.any&&typeof AggregateError<"u"&&A(ot,"any",function(){var r=Kt.apply(null,arguments).map(jr);return new ot(function(s,c){r.length===0&&c(new AggregateError([]));var d=r.length,E=new Array(d);r.forEach(function(C,g){return ot.resolve(C).then(function(O){return s(O)},function(O){E[g]=O,--d||c(new AggregateError(E))})})})}));var Vt={awaits:0,echoes:0,id:0},$l=0,Kr=[],Wr=0,Xr=0,Jl=0;function He(r,s,c,d){var E=ht,C=Object.create(E);return C.parent=E,C.ref=0,C.global=!1,C.id=++Jl,ze.env,C.env=qi?{Promise:ot,PromiseProp:{value:ot,configurable:!0,writable:!0},all:ot.all,race:ot.race,allSettled:ot.allSettled,any:ot.any,resolve:ot.resolve,reject:ot.reject}:{},s&&h(C,s),++E.ref,C.finalize=function(){--this.parent.ref||this.parent.finalize()},d=ln(C,r,c,d),C.ref===0&&C.finalize(),d}function An(){return Vt.id||(Vt.id=++$l),++Vt.awaits,Vt.echoes+=Mo,Vt.id}function Ke(){return!!Vt.awaits&&(--Vt.awaits==0&&(Vt.id=0),Vt.echoes=Vt.awaits*Mo,!0)}function jr(r){return Vt.echoes&&r&&r.constructor===lr?(An(),r.then(function(s){return Ke(),s},function(s){return Ke(),Bt(s)})):r}function tc(){var r=Kr[Kr.length-1];Kr.pop(),We(r,!1)}function We(r,s){var c,d=ht;(s?!Vt.echoes||Wr++&&r===ht:!Wr||--Wr&&r===ht)||queueMicrotask(s?(function(E){++Xr,Vt.echoes&&--Vt.echoes!=0||(Vt.echoes=Vt.awaits=Vt.id=0),Kr.push(ht),We(E,!0)}).bind(null,r):tc),r!==ht&&(ht=r,d===ze&&(ze.env=Uo()),qi&&(c=ze.env.Promise,s=r.env,(d.global||r.global)&&(Object.defineProperty(o,"Promise",s.PromiseProp),c.all=s.all,c.race=s.race,c.resolve=s.resolve,c.reject=s.reject,s.allSettled&&(c.allSettled=s.allSettled),s.any&&(c.any=s.any))))}function Uo(){var r=o.Promise;return qi?{Promise:r,PromiseProp:Object.getOwnPropertyDescriptor(o,"Promise"),all:r.all,race:r.race,allSettled:r.allSettled,any:r.any,resolve:r.resolve,reject:r.reject}:{}}function ln(r,s,c,d,E){var C=ht;try{return We(r,!0),s(c,d,E)}finally{We(C,!1)}}function Bo(r,s,c,d){return typeof r!="function"?r:function(){var E=ht;c&&An(),We(s,!0);try{return r.apply(this,arguments)}finally{We(E,!1),d&&queueMicrotask(Ke)}}}function ns(r){Promise===lr&&Vt.echoes===0?Wr===0?r():enqueueNativeMicroTask(r):setTimeout(r,0)}(""+ce).indexOf("[native code]")===-1&&(An=Ke=Ot);var Bt=ot.reject,cn="￿",Ue="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Yo="String expected.",Fn=[],qr="__dbnames",rs="readonly",is="readwrite";function hn(r,s){return r?s?function(){return r.apply(this,arguments)&&s.apply(this,arguments)}:r:s}var ko={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Zr(r){return typeof r!="string"||/\./.test(r)?function(s){return s}:function(s){return s[r]===void 0&&r in s&&delete(s=nt(s))[r],s}}function Go(){throw ct.Type()}function _t(r,s){try{var c=Vo(r),d=Vo(s);if(c!==d)return c==="Array"?1:d==="Array"?-1:c==="binary"?1:d==="binary"?-1:c==="string"?1:d==="string"?-1:c==="Date"?1:d!=="Date"?NaN:-1;switch(c){case"number":case"Date":case"string":return s<r?1:r<s?-1:0;case"binary":return function(E,C){for(var g=E.length,O=C.length,N=g<O?g:O,P=0;P<N;++P)if(E[P]!==C[P])return E[P]<C[P]?-1:1;return g===O?0:g<O?-1:1}(zo(r),zo(s));case"Array":return function(E,C){for(var g=E.length,O=C.length,N=g<O?g:O,P=0;P<N;++P){var D=_t(E[P],C[P]);if(D!==0)return D}return g===O?0:g<O?-1:1}(r,s)}}catch{}return NaN}function Vo(r){var s=typeof r;return s!="object"?s:ArrayBuffer.isView(r)?"binary":(r=It(r),r==="ArrayBuffer"?"binary":r)}function zo(r){return r instanceof Uint8Array?r:ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r)}var Ho=(Pt.prototype._trans=function(r,s,c){var d=this._tx||ht.trans,E=this.name,C=we&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(r==="readonly"?"read":"write"," ").concat(this.name));function g(P,D,v){if(!v.schema[E])throw new ct.NotFound("Table "+E+" not part of transaction");return s(v.idbtrans,v)}var O=yn();try{var N=d&&d.db._novip===this.db._novip?d===ht.trans?d._promise(r,g,c):He(function(){return d._promise(r,g,c)},{trans:d,transless:ht.transless||ht}):function P(D,v,U,b){if(D.idbdb&&(D._state.openComplete||ht.letThrough||D._vip)){var x=D._createTransaction(v,U,D._dbSchema);try{x.create(),D._state.PR1398_maxLoop=3}catch(B){return B.name===De.InvalidState&&D.isOpen()&&0<--D._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),D.close({disableAutoOpen:!1}),D.open().then(function(){return P(D,v,U,b)})):Bt(B)}return x._promise(v,function(B,M){return He(function(){return ht.trans=x,b(B,M,x)})}).then(function(B){if(v==="readwrite")try{x.idbtrans.commit()}catch{}return v==="readonly"?B:x._completion.then(function(){return B})})}if(D._state.openComplete)return Bt(new ct.DatabaseClosed(D._state.dbOpenError));if(!D._state.isBeingOpened){if(!D._state.autoOpen)return Bt(new ct.DatabaseClosed);D.open().catch(Ot)}return D._state.dbReadyPromise.then(function(){return P(D,v,U,b)})}(this.db,r,[this.name],g);return C&&(N._consoleTask=C,N=N.catch(function(P){return console.trace(P),Bt(P)})),N}finally{O&&Rn()}},Pt.prototype.get=function(r,s){var c=this;return r&&r.constructor===Object?this.where(r).first(s):r==null?Bt(new ct.Type("Invalid argument to Table.get()")):this._trans("readonly",function(d){return c.core.get({trans:d,key:r}).then(function(E){return c.hook.reading.fire(E)})}).then(s)},Pt.prototype.where=function(r){if(typeof r=="string")return new this.db.WhereClause(this,r);if(l(r))return new this.db.WhereClause(this,"[".concat(r.join("+"),"]"));var s=a(r);if(s.length===1)return this.where(s[0]).equals(r[s[0]]);var c=this.schema.indexes.concat(this.schema.primKey).filter(function(N){if(N.compound&&s.every(function(D){return 0<=N.keyPath.indexOf(D)})){for(var P=0;P<s.length;++P)if(s.indexOf(N.keyPath[P])===-1)return!1;return!0}return!1}).sort(function(N,P){return N.keyPath.length-P.keyPath.length})[0];if(c&&this.db._maxKey!==cn){var g=c.keyPath.slice(0,s.length);return this.where(g).equals(g.map(function(P){return r[P]}))}!c&&we&&console.warn("The query ".concat(JSON.stringify(r)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(s.join("+"),"]"));var d=this.schema.idxByName,E=this.db._deps.indexedDB;function C(N,P){return E.cmp(N,P)===0}var O=s.reduce(function(U,P){var D=U[0],v=U[1],U=d[P],b=r[P];return[D||U,D||!U?hn(v,U&&U.multi?function(x){return x=k(x,P),l(x)&&x.some(function(B){return C(b,B)})}:function(x){return C(b,k(x,P))}):v]},[null,null]),g=O[0],O=O[1];return g?this.where(g.name).equals(r[g.keyPath]).filter(O):c?this.filter(O):this.where(s).equals("")},Pt.prototype.filter=function(r){return this.toCollection().and(r)},Pt.prototype.count=function(r){return this.toCollection().count(r)},Pt.prototype.offset=function(r){return this.toCollection().offset(r)},Pt.prototype.limit=function(r){return this.toCollection().limit(r)},Pt.prototype.each=function(r){return this.toCollection().each(r)},Pt.prototype.toArray=function(r){return this.toCollection().toArray(r)},Pt.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Pt.prototype.orderBy=function(r){return new this.db.Collection(new this.db.WhereClause(this,l(r)?"[".concat(r.join("+"),"]"):r))},Pt.prototype.reverse=function(){return this.toCollection().reverse()},Pt.prototype.mapToClass=function(r){var s,c=this.db,d=this.name;function E(){return s!==null&&s.apply(this,arguments)||this}(this.schema.mappedClass=r).prototype instanceof Go&&(function(N,P){if(typeof P!="function"&&P!==null)throw new TypeError("Class extends value "+String(P)+" is not a constructor or null");function D(){this.constructor=N}e(N,P),N.prototype=P===null?Object.create(P):(D.prototype=P.prototype,new D)}(E,s=r),Object.defineProperty(E.prototype,"db",{get:function(){return c},enumerable:!1,configurable:!0}),E.prototype.table=function(){return d},r=E);for(var C=new Set,g=r.prototype;g;g=p(g))Object.getOwnPropertyNames(g).forEach(function(N){return C.add(N)});function O(N){if(!N)return N;var P,D=Object.create(r.prototype);for(P in N)if(!C.has(P))try{D[P]=N[P]}catch{}return D}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=O,this.hook("reading",O),r},Pt.prototype.defineClass=function(){return this.mapToClass(function(r){h(this,r)})},Pt.prototype.add=function(r,s){var c=this,d=this.schema.primKey,E=d.auto,C=d.keyPath,g=r;return C&&E&&(g=Zr(C)(r)),this._trans("readwrite",function(O){return c.core.mutate({trans:O,type:"add",keys:s!=null?[s]:null,values:[g]})}).then(function(O){return O.numFailures?ot.reject(O.failures[0]):O.lastResult}).then(function(O){if(C)try{V(r,C,O)}catch{}return O})},Pt.prototype.update=function(r,s){return typeof r!="object"||l(r)?this.where(":id").equals(r).modify(s):(r=k(r,this.schema.primKey.keyPath),r===void 0?Bt(new ct.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(r).modify(s))},Pt.prototype.put=function(r,s){var c=this,d=this.schema.primKey,E=d.auto,C=d.keyPath,g=r;return C&&E&&(g=Zr(C)(r)),this._trans("readwrite",function(O){return c.core.mutate({trans:O,type:"put",values:[g],keys:s!=null?[s]:null})}).then(function(O){return O.numFailures?ot.reject(O.failures[0]):O.lastResult}).then(function(O){if(C)try{V(r,C,O)}catch{}return O})},Pt.prototype.delete=function(r){var s=this;return this._trans("readwrite",function(c){return s.core.mutate({trans:c,type:"delete",keys:[r]})}).then(function(c){return c.numFailures?ot.reject(c.failures[0]):void 0})},Pt.prototype.clear=function(){var r=this;return this._trans("readwrite",function(s){return r.core.mutate({trans:s,type:"deleteRange",range:ko})}).then(function(s){return s.numFailures?ot.reject(s.failures[0]):void 0})},Pt.prototype.bulkGet=function(r){var s=this;return this._trans("readonly",function(c){return s.core.getMany({keys:r,trans:c}).then(function(d){return d.map(function(E){return s.hook.reading.fire(E)})})})},Pt.prototype.bulkAdd=function(r,s,c){var d=this,E=Array.isArray(s)?s:void 0,C=(c=c||(E?void 0:s))?c.allKeys:void 0;return this._trans("readwrite",function(g){var P=d.schema.primKey,O=P.auto,P=P.keyPath;if(P&&E)throw new ct.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(E&&E.length!==r.length)throw new ct.InvalidArgument("Arguments objects and keys must have the same length");var N=r.length,P=P&&O?r.map(Zr(P)):r;return d.core.mutate({trans:g,type:"add",keys:E,values:P,wantResults:C}).then(function(x){var v=x.numFailures,U=x.results,b=x.lastResult,x=x.failures;if(v===0)return C?U:b;throw new xe("".concat(d.name,".bulkAdd(): ").concat(v," of ").concat(N," operations failed"),x)})})},Pt.prototype.bulkPut=function(r,s,c){var d=this,E=Array.isArray(s)?s:void 0,C=(c=c||(E?void 0:s))?c.allKeys:void 0;return this._trans("readwrite",function(g){var P=d.schema.primKey,O=P.auto,P=P.keyPath;if(P&&E)throw new ct.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(E&&E.length!==r.length)throw new ct.InvalidArgument("Arguments objects and keys must have the same length");var N=r.length,P=P&&O?r.map(Zr(P)):r;return d.core.mutate({trans:g,type:"put",keys:E,values:P,wantResults:C}).then(function(x){var v=x.numFailures,U=x.results,b=x.lastResult,x=x.failures;if(v===0)return C?U:b;throw new xe("".concat(d.name,".bulkPut(): ").concat(v," of ").concat(N," operations failed"),x)})})},Pt.prototype.bulkUpdate=function(r){var s=this,c=this.core,d=r.map(function(g){return g.key}),E=r.map(function(g){return g.changes}),C=[];return this._trans("readwrite",function(g){return c.getMany({trans:g,keys:d,cache:"clone"}).then(function(O){var N=[],P=[];r.forEach(function(v,U){var b=v.key,x=v.changes,B=O[U];if(B){for(var M=0,G=Object.keys(x);M<G.length;M++){var z=G[M],K=x[z];if(z===s.schema.primKey.keyPath){if(_t(K,b)!==0)throw new ct.Constraint("Cannot update primary key in bulkUpdate()")}else V(B,z,K)}C.push(U),N.push(b),P.push(B)}});var D=N.length;return c.mutate({trans:g,type:"put",keys:N,values:P,updates:{keys:d,changeSpecs:E}}).then(function(v){var U=v.numFailures,b=v.failures;if(U===0)return D;for(var x=0,B=Object.keys(b);x<B.length;x++){var M,G=B[x],z=C[Number(G)];z!=null&&(M=b[G],delete b[G],b[z]=M)}throw new xe("".concat(s.name,".bulkUpdate(): ").concat(U," of ").concat(D," operations failed"),b)})})})},Pt.prototype.bulkDelete=function(r){var s=this,c=r.length;return this._trans("readwrite",function(d){return s.core.mutate({trans:d,type:"delete",keys:r})}).then(function(g){var E=g.numFailures,C=g.lastResult,g=g.failures;if(E===0)return C;throw new xe("".concat(s.name,".bulkDelete(): ").concat(E," of ").concat(c," operations failed"),g)})},Pt);function Pt(){}function ur(r){function s(g,O){if(O){for(var N=arguments.length,P=new Array(N-1);--N;)P[N-1]=arguments[N];return c[g].subscribe.apply(null,P),r}if(typeof g=="string")return c[g]}var c={};s.addEventType=C;for(var d=1,E=arguments.length;d<E;++d)C(arguments[d]);return s;function C(g,O,N){if(typeof g!="object"){var P;O=O||ql;var D={subscribers:[],fire:N=N||Ot,subscribe:function(v){D.subscribers.indexOf(v)===-1&&(D.subscribers.push(v),D.fire=O(D.fire,v))},unsubscribe:function(v){D.subscribers=D.subscribers.filter(function(U){return U!==v}),D.fire=D.subscribers.reduce(O,N)}};return c[g]=s[g]=D}a(P=g).forEach(function(v){var U=P[v];if(l(U))C(v,P[v][0],P[v][1]);else{if(U!=="asap")throw new ct.InvalidArgument("Invalid event config");var b=C(v,Oe,function(){for(var x=arguments.length,B=new Array(x);x--;)B[x]=arguments[x];b.subscribers.forEach(function(M){L(function(){M.apply(null,B)})})})}})}}function dr(r,s){return F(s).from({prototype:r}),s}function _n(r,s){return!(r.filter||r.algorithm||r.or)&&(s?r.justLimit:!r.replayFilter)}function ss(r,s){r.filter=hn(r.filter,s)}function os(r,s,c){var d=r.replayFilter;r.replayFilter=d?function(){return hn(d(),s())}:s,r.justLimit=c&&!d}function Qr(r,s){if(r.isPrimKey)return s.primaryKey;var c=s.getIndexByKeyPath(r.index);if(!c)throw new ct.Schema("KeyPath "+r.index+" on object store "+s.name+" is not indexed");return c}function Ko(r,s,c){var d=Qr(r,s.schema);return s.openCursor({trans:c,values:!r.keysOnly,reverse:r.dir==="prev",unique:!!r.unique,query:{index:d,range:r.range}})}function $r(r,s,c,d){var E=r.replayFilter?hn(r.filter,r.replayFilter()):r.filter;if(r.or){var C={},g=function(O,N,P){var D,v;E&&!E(N,P,function(U){return N.stop(U)},function(U){return N.fail(U)})||((v=""+(D=N.primaryKey))=="[object ArrayBuffer]"&&(v=""+new Uint8Array(D)),I(C,v)||(C[v]=!0,s(O,N,P)))};return Promise.all([r.or._iterate(g,c),Wo(Ko(r,d,c),r.algorithm,g,!r.keysOnly&&r.valueMapper)])}return Wo(Ko(r,d,c),hn(r.algorithm,E),s,!r.keysOnly&&r.valueMapper)}function Wo(r,s,c,d){var E=Nt(d?function(C,g,O){return c(d(C),g,O)}:c);return r.then(function(C){if(C)return C.start(function(){var g=function(){return C.continue()};s&&!s(C,function(O){return g=O},function(O){C.stop(O),g=Ot},function(O){C.fail(O),g=Ot})||E(C.value,C,function(O){return g=O}),g()})})}var Be=Symbol(),as=(Xo.prototype.execute=function(r){var s=(s=this.replacePrefix)===null||s===void 0?void 0:s[0];return s&&typeof r=="string"&&r.startsWith(s)?this.replacePrefix[1]+r.substring(s.length):r},Xo);function Xo(r){Object.assign(this,r)}var ec=(At.prototype._read=function(r,s){var c=this._ctx;return c.error?c.table._trans(null,Bt.bind(null,c.error)):c.table._trans("readonly",r).then(s)},At.prototype._write=function(r){var s=this._ctx;return s.error?s.table._trans(null,Bt.bind(null,s.error)):s.table._trans("readwrite",r,"locked")},At.prototype._addAlgorithm=function(r){var s=this._ctx;s.algorithm=hn(s.algorithm,r)},At.prototype._iterate=function(r,s){return $r(this._ctx,r,s,this._ctx.table.core)},At.prototype.clone=function(r){var s=Object.create(this.constructor.prototype),c=Object.create(this._ctx);return r&&h(c,r),s._ctx=c,s},At.prototype.raw=function(){return this._ctx.valueMapper=null,this},At.prototype.each=function(r){var s=this._ctx;return this._read(function(c){return $r(s,r,c,s.table.core)})},At.prototype.count=function(r){var s=this;return this._read(function(c){var d=s._ctx,E=d.table.core;if(_n(d,!0))return E.count({trans:c,query:{index:Qr(d,E.schema),range:d.range}}).then(function(g){return Math.min(g,d.limit)});var C=0;return $r(d,function(){return++C,!1},c,E).then(function(){return C})}).then(r)},At.prototype.sortBy=function(r,s){var c=r.split(".").reverse(),d=c[0],E=c.length-1;function C(N,P){return P?C(N[c[P]],P-1):N[d]}var g=this._ctx.dir==="next"?1:-1;function O(N,P){return N=C(N,E),P=C(P,E),N<P?-g:P<N?g:0}return this.toArray(function(N){return N.sort(O)}).then(s)},At.prototype.toArray=function(r){var s=this;return this._read(function(c){var d=s._ctx;if(d.dir==="next"&&_n(d,!0)&&0<d.limit){var E=d.valueMapper,C=Qr(d,d.table.core.schema);return d.table.core.query({trans:c,limit:d.limit,values:!0,query:{index:C,range:d.range}}).then(function(O){return O=O.result,E?O.map(E):O})}var g=[];return $r(d,function(O){return g.push(O)},c,d.table.core).then(function(){return g})},r)},At.prototype.offset=function(r){var s=this._ctx;return r<=0||(s.offset+=r,_n(s)?os(s,function(){var c=r;return function(d,E){return c===0||(c===1?--c:E(function(){d.advance(c),c=0}),!1)}}):os(s,function(){var c=r;return function(){return--c<0}})),this},At.prototype.limit=function(r){return this._ctx.limit=Math.min(this._ctx.limit,r),os(this._ctx,function(){var s=r;return function(c,d,E){return--s<=0&&d(E),0<=s}},!0),this},At.prototype.until=function(r,s){return ss(this._ctx,function(c,d,E){return!r(c.value)||(d(E),s)}),this},At.prototype.first=function(r){return this.limit(1).toArray(function(s){return s[0]}).then(r)},At.prototype.last=function(r){return this.reverse().first(r)},At.prototype.filter=function(r){var s;return ss(this._ctx,function(c){return r(c.value)}),(s=this._ctx).isMatch=hn(s.isMatch,r),this},At.prototype.and=function(r){return this.filter(r)},At.prototype.or=function(r){return new this.db.WhereClause(this._ctx.table,r,this)},At.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},At.prototype.desc=function(){return this.reverse()},At.prototype.eachKey=function(r){var s=this._ctx;return s.keysOnly=!s.isMatch,this.each(function(c,d){r(d.key,d)})},At.prototype.eachUniqueKey=function(r){return this._ctx.unique="unique",this.eachKey(r)},At.prototype.eachPrimaryKey=function(r){var s=this._ctx;return s.keysOnly=!s.isMatch,this.each(function(c,d){r(d.primaryKey,d)})},At.prototype.keys=function(r){var s=this._ctx;s.keysOnly=!s.isMatch;var c=[];return this.each(function(d,E){c.push(E.key)}).then(function(){return c}).then(r)},At.prototype.primaryKeys=function(r){var s=this._ctx;if(s.dir==="next"&&_n(s,!0)&&0<s.limit)return this._read(function(d){var E=Qr(s,s.table.core.schema);return s.table.core.query({trans:d,values:!1,limit:s.limit,query:{index:E,range:s.range}})}).then(function(d){return d.result}).then(r);s.keysOnly=!s.isMatch;var c=[];return this.each(function(d,E){c.push(E.primaryKey)}).then(function(){return c}).then(r)},At.prototype.uniqueKeys=function(r){return this._ctx.unique="unique",this.keys(r)},At.prototype.firstKey=function(r){return this.limit(1).keys(function(s){return s[0]}).then(r)},At.prototype.lastKey=function(r){return this.reverse().firstKey(r)},At.prototype.distinct=function(){var r=this._ctx,r=r.index&&r.table.schema.idxByName[r.index];if(!r||!r.multi)return this;var s={};return ss(this._ctx,function(E){var d=E.primaryKey.toString(),E=I(s,d);return s[d]=!0,!E}),this},At.prototype.modify=function(r){var s=this,c=this._ctx;return this._write(function(d){var E,C,g;g=typeof r=="function"?r:(E=a(r),C=E.length,function(M){for(var G=!1,z=0;z<C;++z){var K=E[z],W=r[K],Z=k(M,K);W instanceof as?(V(M,K,W.execute(Z)),G=!0):Z!==W&&(V(M,K,W),G=!0)}return G});function O(M,K){var z=K.failures,K=K.numFailures;x+=M-K;for(var W=0,Z=a(z);W<Z.length;W++){var rt=Z[W];b.push(z[rt])}}var N=c.table.core,P=N.schema.primaryKey,D=P.outbound,v=P.extractKey,U=s.db._options.modifyChunkSize||200,b=[],x=0,B=[];return s.clone().primaryKeys().then(function(M){function G(z){var K=Math.min(U,M.length-z);return N.getMany({trans:d,keys:M.slice(z,z+K),cache:"immutable"}).then(function(W){for(var Z=[],rt=[],tt=D?[]:null,et=[],it=0;it<K;++it){var st=W[it],pt={value:nt(st),primKey:M[z+it]};g.call(pt,pt.value,pt)!==!1&&(pt.value==null?et.push(M[z+it]):D||_t(v(st),v(pt.value))===0?(rt.push(pt.value),D&&tt.push(M[z+it])):(et.push(M[z+it]),Z.push(pt.value)))}var mt=_n(c)&&c.limit===1/0&&(typeof r!="function"||r===ls)&&{index:c.index,range:c.range};return Promise.resolve(0<Z.length&&N.mutate({trans:d,type:"add",values:Z}).then(function(gt){for(var Ct in gt.failures)et.splice(parseInt(Ct),1);O(Z.length,gt)})).then(function(){return(0<rt.length||mt&&typeof r=="object")&&N.mutate({trans:d,type:"put",keys:tt,values:rt,criteria:mt,changeSpec:typeof r!="function"&&r}).then(function(gt){return O(rt.length,gt)})}).then(function(){return(0<et.length||mt&&r===ls)&&N.mutate({trans:d,type:"delete",keys:et,criteria:mt}).then(function(gt){return O(et.length,gt)})}).then(function(){return M.length>z+K&&G(z+U)})})}return G(0).then(function(){if(0<b.length)throw new sn("Error modifying one or more objects",b,x,B);return M.length})})})},At.prototype.delete=function(){var r=this._ctx,s=r.range;return _n(r)&&(r.isPrimKey||s.type===3)?this._write(function(c){var d=r.table.core.schema.primaryKey,E=s;return r.table.core.count({trans:c,query:{index:d,range:E}}).then(function(C){return r.table.core.mutate({trans:c,type:"deleteRange",range:E}).then(function(g){var O=g.failures;if(g.lastResult,g.results,g=g.numFailures,g)throw new sn("Could not delete some values",Object.keys(O).map(function(N){return O[N]}),C-g);return C-g})})}):this.modify(ls)},At);function At(){}var ls=function(r,s){return s.value=null};function nc(r,s){return r<s?-1:r===s?0:1}function rc(r,s){return s<r?-1:r===s?0:1}function se(r,s,c){return r=r instanceof qo?new r.Collection(r):r,r._ctx.error=new(c||TypeError)(s),r}function On(r){return new r.Collection(r,function(){return jo("")}).limit(0)}function Jr(r,s,c,d){var E,C,g,O,N,P,D,v=c.length;if(!c.every(function(x){return typeof x=="string"}))return se(r,Yo);function U(x){E=x==="next"?function(M){return M.toUpperCase()}:function(M){return M.toLowerCase()},C=x==="next"?function(M){return M.toLowerCase()}:function(M){return M.toUpperCase()},g=x==="next"?nc:rc;var B=c.map(function(M){return{lower:C(M),upper:E(M)}}).sort(function(M,G){return g(M.lower,G.lower)});O=B.map(function(M){return M.upper}),N=B.map(function(M){return M.lower}),D=(P=x)==="next"?"":d}U("next"),r=new r.Collection(r,function(){return Xe(O[0],N[v-1]+d)}),r._ondirectionchange=function(x){U(x)};var b=0;return r._addAlgorithm(function(x,B,M){var G=x.key;if(typeof G!="string")return!1;var z=C(G);if(s(z,N,b))return!0;for(var K=null,W=b;W<v;++W){var Z=function(rt,tt,et,it,st,pt){for(var mt=Math.min(rt.length,it.length),gt=-1,Ct=0;Ct<mt;++Ct){var Ce=tt[Ct];if(Ce!==it[Ct])return st(rt[Ct],et[Ct])<0?rt.substr(0,Ct)+et[Ct]+et.substr(Ct+1):st(rt[Ct],it[Ct])<0?rt.substr(0,Ct)+it[Ct]+et.substr(Ct+1):0<=gt?rt.substr(0,gt)+tt[gt]+et.substr(gt+1):null;st(rt[Ct],Ce)<0&&(gt=Ct)}return mt<it.length&&pt==="next"?rt+et.substr(rt.length):mt<rt.length&&pt==="prev"?rt.substr(0,et.length):gt<0?null:rt.substr(0,gt)+it[gt]+et.substr(gt+1)}(G,z,O[W],N[W],g,P);Z===null&&K===null?b=W+1:(K===null||0<g(K,Z))&&(K=Z)}return B(K!==null?function(){x.continue(K+D)}:M),!1}),r}function Xe(r,s,c,d){return{type:2,lower:r,upper:s,lowerOpen:c,upperOpen:d}}function jo(r){return{type:1,lower:r,upper:r}}var qo=(Object.defineProperty(zt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),zt.prototype.between=function(r,s,c,d){c=c!==!1,d=d===!0;try{return 0<this._cmp(r,s)||this._cmp(r,s)===0&&(c||d)&&(!c||!d)?On(this):new this.Collection(this,function(){return Xe(r,s,!c,!d)})}catch{return se(this,Ue)}},zt.prototype.equals=function(r){return r==null?se(this,Ue):new this.Collection(this,function(){return jo(r)})},zt.prototype.above=function(r){return r==null?se(this,Ue):new this.Collection(this,function(){return Xe(r,void 0,!0)})},zt.prototype.aboveOrEqual=function(r){return r==null?se(this,Ue):new this.Collection(this,function(){return Xe(r,void 0,!1)})},zt.prototype.below=function(r){return r==null?se(this,Ue):new this.Collection(this,function(){return Xe(void 0,r,!1,!0)})},zt.prototype.belowOrEqual=function(r){return r==null?se(this,Ue):new this.Collection(this,function(){return Xe(void 0,r)})},zt.prototype.startsWith=function(r){return typeof r!="string"?se(this,Yo):this.between(r,r+cn,!0,!0)},zt.prototype.startsWithIgnoreCase=function(r){return r===""?this.startsWith(r):Jr(this,function(s,c){return s.indexOf(c[0])===0},[r],cn)},zt.prototype.equalsIgnoreCase=function(r){return Jr(this,function(s,c){return s===c[0]},[r],"")},zt.prototype.anyOfIgnoreCase=function(){var r=Kt.apply(te,arguments);return r.length===0?On(this):Jr(this,function(s,c){return c.indexOf(s)!==-1},r,"")},zt.prototype.startsWithAnyOfIgnoreCase=function(){var r=Kt.apply(te,arguments);return r.length===0?On(this):Jr(this,function(s,c){return c.some(function(d){return s.indexOf(d)===0})},r,cn)},zt.prototype.anyOf=function(){var r=this,s=Kt.apply(te,arguments),c=this._cmp;try{s.sort(c)}catch{return se(this,Ue)}if(s.length===0)return On(this);var d=new this.Collection(this,function(){return Xe(s[0],s[s.length-1])});d._ondirectionchange=function(C){c=C==="next"?r._ascending:r._descending,s.sort(c)};var E=0;return d._addAlgorithm(function(C,g,O){for(var N=C.key;0<c(N,s[E]);)if(++E===s.length)return g(O),!1;return c(N,s[E])===0||(g(function(){C.continue(s[E])}),!1)}),d},zt.prototype.notEqual=function(r){return this.inAnyRange([[-1/0,r],[r,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},zt.prototype.noneOf=function(){var r=Kt.apply(te,arguments);if(r.length===0)return new this.Collection(this);try{r.sort(this._ascending)}catch{return se(this,Ue)}var s=r.reduce(function(c,d){return c?c.concat([[c[c.length-1][1],d]]):[[-1/0,d]]},null);return s.push([r[r.length-1],this.db._maxKey]),this.inAnyRange(s,{includeLowers:!1,includeUppers:!1})},zt.prototype.inAnyRange=function(G,s){var c=this,d=this._cmp,E=this._ascending,C=this._descending,g=this._min,O=this._max;if(G.length===0)return On(this);if(!G.every(function(z){return z[0]!==void 0&&z[1]!==void 0&&E(z[0],z[1])<=0}))return se(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ct.InvalidArgument);var N=!s||s.includeLowers!==!1,P=s&&s.includeUppers===!0,D,v=E;function U(z,K){return v(z[0],K[0])}try{(D=G.reduce(function(z,K){for(var W=0,Z=z.length;W<Z;++W){var rt=z[W];if(d(K[0],rt[1])<0&&0<d(K[1],rt[0])){rt[0]=g(rt[0],K[0]),rt[1]=O(rt[1],K[1]);break}}return W===Z&&z.push(K),z},[])).sort(U)}catch{return se(this,Ue)}var b=0,x=P?function(z){return 0<E(z,D[b][1])}:function(z){return 0<=E(z,D[b][1])},B=N?function(z){return 0<C(z,D[b][0])}:function(z){return 0<=C(z,D[b][0])},M=x,G=new this.Collection(this,function(){return Xe(D[0][0],D[D.length-1][1],!N,!P)});return G._ondirectionchange=function(z){v=z==="next"?(M=x,E):(M=B,C),D.sort(U)},G._addAlgorithm(function(z,K,W){for(var Z,rt=z.key;M(rt);)if(++b===D.length)return K(W),!1;return!x(Z=rt)&&!B(Z)||(c._cmp(rt,D[b][1])===0||c._cmp(rt,D[b][0])===0||K(function(){v===E?z.continue(D[b][0]):z.continue(D[b][1])}),!1)}),G},zt.prototype.startsWithAnyOf=function(){var r=Kt.apply(te,arguments);return r.every(function(s){return typeof s=="string"})?r.length===0?On(this):this.inAnyRange(r.map(function(s){return[s,s+cn]})):se(this,"startsWithAnyOf() only works with strings")},zt);function zt(){}function Se(r){return Nt(function(s){return pr(s),r(s.target.error),!1})}function pr(r){r.stopPropagation&&r.stopPropagation(),r.preventDefault&&r.preventDefault()}var Er="storagemutated",cs="x-storagemutated-1",je=ur(null,Er),ic=(ve.prototype._lock=function(){return R(!ht.global),++this._reculock,this._reculock!==1||ht.global||(ht.lockOwnerFor=this),this},ve.prototype._unlock=function(){if(R(!ht.global),--this._reculock==0)for(ht.global||(ht.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var r=this._blockedFuncs.shift();try{ln(r[1],r[0])}catch{}}return this},ve.prototype._locked=function(){return this._reculock&&ht.lockOwnerFor!==this},ve.prototype.create=function(r){var s=this;if(!this.mode)return this;var c=this.db.idbdb,d=this.db._state.dbOpenError;if(R(!this.idbtrans),!r&&!c)switch(d&&d.name){case"DatabaseClosedError":throw new ct.DatabaseClosed(d);case"MissingAPIError":throw new ct.MissingAPI(d.message,d);default:throw new ct.OpenFailed(d)}if(!this.active)throw new ct.TransactionInactive;return R(this._completion._state===null),(r=this.idbtrans=r||(this.db.core||c).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Nt(function(E){pr(E),s._reject(r.error)}),r.onabort=Nt(function(E){pr(E),s.active&&s._reject(new ct.Abort(r.error)),s.active=!1,s.on("abort").fire(E)}),r.oncomplete=Nt(function(){s.active=!1,s._resolve(),"mutatedParts"in r&&je.storagemutated.fire(r.mutatedParts)}),this},ve.prototype._promise=function(r,s,c){var d=this;if(r==="readwrite"&&this.mode!=="readwrite")return Bt(new ct.ReadOnly("Transaction is readonly"));if(!this.active)return Bt(new ct.TransactionInactive);if(this._locked())return new ot(function(C,g){d._blockedFuncs.push([function(){d._promise(r,s,c).then(C,g)},ht])});if(c)return He(function(){var C=new ot(function(g,O){d._lock();var N=s(g,O,d);N&&N.then&&N.then(g,O)});return C.finally(function(){return d._unlock()}),C._lib=!0,C});var E=new ot(function(C,g){var O=s(C,g,d);O&&O.then&&O.then(C,g)});return E._lib=!0,E},ve.prototype._root=function(){return this.parent?this.parent._root():this},ve.prototype.waitFor=function(r){var s,c=this._root(),d=ot.resolve(r);c._waitingFor?c._waitingFor=c._waitingFor.then(function(){return d}):(c._waitingFor=d,c._waitingQueue=[],s=c.idbtrans.objectStore(c.storeNames[0]),function C(){for(++c._spinCount;c._waitingQueue.length;)c._waitingQueue.shift()();c._waitingFor&&(s.get(-1/0).onsuccess=C)}());var E=c._waitingFor;return new ot(function(C,g){d.then(function(O){return c._waitingQueue.push(Nt(C.bind(null,O)))},function(O){return c._waitingQueue.push(Nt(g.bind(null,O)))}).finally(function(){c._waitingFor===E&&(c._waitingFor=null)})})},ve.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new ct.Abort))},ve.prototype.table=function(r){var s=this._memoizedTables||(this._memoizedTables={});if(I(s,r))return s[r];var c=this.schema[r];if(!c)throw new ct.NotFound("Table "+r+" not part of transaction");return c=new this.db.Table(r,c,this),c.core=this.db.core.table(r),s[r]=c},ve);function ve(){}function hs(r,s,c,d,E,C,g){return{name:r,keyPath:s,unique:c,multi:d,auto:E,compound:C,src:(c&&!g?"&":"")+(d?"*":"")+(E?"++":"")+Zo(s)}}function Zo(r){return typeof r=="string"?r:r?"["+[].join.call(r,"+")+"]":""}function us(r,s,c){return{name:r,primKey:s,indexes:c,mappedClass:null,idxByName:(d=function(E){return[E.name,E]},c.reduce(function(E,C,g){return g=d(C,g),g&&(E[g[0]]=g[1]),E},{}))};var d}var fr=function(r){try{return r.only([[]]),fr=function(){return[[]]},[[]]}catch{return fr=function(){return cn},cn}};function ds(r){return r==null?function(){}:typeof r=="string"?(s=r).split(".").length===1?function(c){return c[s]}:function(c){return k(c,s)}:function(c){return k(c,r)};var s}function Qo(r){return[].slice.call(r)}var sc=0;function Ir(r){return r==null?":id":typeof r=="string"?r:"[".concat(r.join("+"),"]")}function oc(r,s,N){function d(M){if(M.type===3)return null;if(M.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var b=M.lower,x=M.upper,B=M.lowerOpen,M=M.upperOpen;return b===void 0?x===void 0?null:s.upperBound(x,!!M):x===void 0?s.lowerBound(b,!!B):s.bound(b,x,!!B,!!M)}function E(U){var b,x=U.name;return{name:x,schema:U,mutate:function(B){var M=B.trans,G=B.type,z=B.keys,K=B.values,W=B.range;return new Promise(function(Z,rt){Z=Nt(Z);var tt=M.objectStore(x),et=tt.keyPath==null,it=G==="put"||G==="add";if(!it&&G!=="delete"&&G!=="deleteRange")throw new Error("Invalid operation type: "+G);var st,pt=(z||K||{length:1}).length;if(z&&K&&z.length!==K.length)throw new Error("Given keys array must have same length as given values array.");if(pt===0)return Z({numFailures:0,failures:{},results:[],lastResult:void 0});function mt(ee){++Ce,pr(ee)}var gt=[],Ct=[],Ce=0;if(G==="deleteRange"){if(W.type===4)return Z({numFailures:Ce,failures:Ct,results:[],lastResult:void 0});W.type===3?gt.push(st=tt.clear()):gt.push(st=tt.delete(d(W)))}else{var et=it?et?[K,z]:[K,null]:[z,null],Tt=et[0],jt=et[1];if(it)for(var qt=0;qt<pt;++qt)gt.push(st=jt&&jt[qt]!==void 0?tt[G](Tt[qt],jt[qt]):tt[G](Tt[qt])),st.onerror=mt;else for(qt=0;qt<pt;++qt)gt.push(st=tt[G](Tt[qt])),st.onerror=mt}function di(ee){ee=ee.target.result,gt.forEach(function(pn,bs){return pn.error!=null&&(Ct[bs]=pn.error)}),Z({numFailures:Ce,failures:Ct,results:G==="delete"?z:gt.map(function(pn){return pn.result}),lastResult:ee})}st.onerror=function(ee){mt(ee),di(ee)},st.onsuccess=di})},getMany:function(B){var M=B.trans,G=B.keys;return new Promise(function(z,K){z=Nt(z);for(var W,Z=M.objectStore(x),rt=G.length,tt=new Array(rt),et=0,it=0,st=function(gt){gt=gt.target,tt[gt._pos]=gt.result,++it===et&&z(tt)},pt=Se(K),mt=0;mt<rt;++mt)G[mt]!=null&&((W=Z.get(G[mt]))._pos=mt,W.onsuccess=st,W.onerror=pt,++et);et===0&&z(tt)})},get:function(B){var M=B.trans,G=B.key;return new Promise(function(z,K){z=Nt(z);var W=M.objectStore(x).get(G);W.onsuccess=function(Z){return z(Z.target.result)},W.onerror=Se(K)})},query:(b=P,function(B){return new Promise(function(M,G){M=Nt(M);var z,K,W,et=B.trans,Z=B.values,rt=B.limit,st=B.query,tt=rt===1/0?void 0:rt,it=st.index,st=st.range,et=et.objectStore(x),it=it.isPrimaryKey?et:et.index(it.name),st=d(st);if(rt===0)return M({result:[]});b?((tt=Z?it.getAll(st,tt):it.getAllKeys(st,tt)).onsuccess=function(pt){return M({result:pt.target.result})},tt.onerror=Se(G)):(z=0,K=!Z&&"openKeyCursor"in it?it.openKeyCursor(st):it.openCursor(st),W=[],K.onsuccess=function(pt){var mt=K.result;return mt?(W.push(Z?mt.value:mt.primaryKey),++z===rt?M({result:W}):void mt.continue()):M({result:W})},K.onerror=Se(G))})}),openCursor:function(B){var M=B.trans,G=B.values,z=B.query,K=B.reverse,W=B.unique;return new Promise(function(Z,rt){Z=Nt(Z);var it=z.index,tt=z.range,et=M.objectStore(x),et=it.isPrimaryKey?et:et.index(it.name),it=K?W?"prevunique":"prev":W?"nextunique":"next",st=!G&&"openKeyCursor"in et?et.openKeyCursor(d(tt),it):et.openCursor(d(tt),it);st.onerror=Se(rt),st.onsuccess=Nt(function(pt){var mt,gt,Ct,Ce,Tt=st.result;Tt?(Tt.___id=++sc,Tt.done=!1,mt=Tt.continue.bind(Tt),gt=(gt=Tt.continuePrimaryKey)&&gt.bind(Tt),Ct=Tt.advance.bind(Tt),Ce=function(){throw new Error("Cursor not stopped")},Tt.trans=M,Tt.stop=Tt.continue=Tt.continuePrimaryKey=Tt.advance=function(){throw new Error("Cursor not started")},Tt.fail=Nt(rt),Tt.next=function(){var jt=this,qt=1;return this.start(function(){return qt--?jt.continue():jt.stop()}).then(function(){return jt})},Tt.start=function(jt){function qt(){if(st.result)try{jt()}catch(ee){Tt.fail(ee)}else Tt.done=!0,Tt.start=function(){throw new Error("Cursor behind last entry")},Tt.stop()}var di=new Promise(function(ee,pn){ee=Nt(ee),st.onerror=Se(pn),Tt.fail=pn,Tt.stop=function(bs){Tt.stop=Tt.continue=Tt.continuePrimaryKey=Tt.advance=Ce,ee(bs)}});return st.onsuccess=Nt(function(ee){st.onsuccess=qt,qt()}),Tt.continue=mt,Tt.continuePrimaryKey=gt,Tt.advance=Ct,qt(),di},Z(Tt)):Z(null)},rt)})},count:function(B){var M=B.query,G=B.trans,z=M.index,K=M.range;return new Promise(function(W,Z){var rt=G.objectStore(x),tt=z.isPrimaryKey?rt:rt.index(z.name),rt=d(K),tt=rt?tt.count(rt):tt.count();tt.onsuccess=Nt(function(et){return W(et.target.result)}),tt.onerror=Se(Z)})}}}var C,g,O,D=(g=N,O=Qo((C=r).objectStoreNames),{schema:{name:C.name,tables:O.map(function(U){return g.objectStore(U)}).map(function(U){var b=U.keyPath,M=U.autoIncrement,x=l(b),B={},M={name:U.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:b==null,compound:x,keyPath:b,autoIncrement:M,unique:!0,extractKey:ds(b)},indexes:Qo(U.indexNames).map(function(G){return U.index(G)}).map(function(W){var z=W.name,K=W.unique,Z=W.multiEntry,W=W.keyPath,Z={name:z,compound:l(W),keyPath:W,unique:K,multiEntry:Z,extractKey:ds(W)};return B[Ir(W)]=Z}),getIndexByKeyPath:function(G){return B[Ir(G)]}};return B[":id"]=M.primaryKey,b!=null&&(B[Ir(b)]=M.primaryKey),M})},hasGetAll:0<O.length&&"getAll"in g.objectStore(O[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),N=D.schema,P=D.hasGetAll,D=N.tables.map(E),v={};return D.forEach(function(U){return v[U.name]=U}),{stack:"dbcore",transaction:r.transaction.bind(r),table:function(U){if(!v[U])throw new Error("Table '".concat(U,"' not found"));return v[U]},MIN_KEY:-1/0,MAX_KEY:fr(s),schema:N}}function ac(r,s,c,d){var E=c.IDBKeyRange;return c.indexedDB,{dbcore:(d=oc(s,E,d),r.dbcore.reduce(function(C,g){return g=g.create,n(n({},C),g(C))},d))}}function ti(r,d){var c=d.db,d=ac(r._middlewares,c,r._deps,d);r.core=d.dbcore,r.tables.forEach(function(E){var C=E.name;r.core.schema.tables.some(function(g){return g.name===C})&&(E.core=r.core.table(C),r[C]instanceof r.Table&&(r[C].core=E.core))})}function ei(r,s,c,d){c.forEach(function(E){var C=d[E];s.forEach(function(g){var O=function N(P,D){return _(P,D)||(P=p(P))&&N(P,D)}(g,E);(!O||"value"in O&&O.value===void 0)&&(g===r.Transaction.prototype||g instanceof r.Transaction?A(g,E,{get:function(){return this.table(E)},set:function(N){T(this,E,{value:N,writable:!0,configurable:!0,enumerable:!0})}}):g[E]=new r.Table(E,C))})})}function ps(r,s){s.forEach(function(c){for(var d in c)c[d]instanceof r.Table&&delete c[d]})}function lc(r,s){return r._cfg.version-s._cfg.version}function cc(r,s,c,d){var E=r._dbSchema;c.objectStoreNames.contains("$meta")&&!E.$meta&&(E.$meta=us("$meta",Jo("")[0],[]),r._storeNames.push("$meta"));var C=r._createTransaction("readwrite",r._storeNames,E);C.create(c),C._completion.catch(d);var g=C._reject.bind(C),O=ht.transless||ht;He(function(){return ht.trans=C,ht.transless=O,s!==0?(ti(r,c),P=s,((N=C).storeNames.includes("$meta")?N.table("$meta").get("version").then(function(D){return D??P}):ot.resolve(P)).then(function(D){return U=D,b=C,x=c,B=[],D=(v=r)._versions,M=v._dbSchema=ri(0,v.idbdb,x),(D=D.filter(function(G){return G._cfg.version>=U})).length!==0?(D.forEach(function(G){B.push(function(){var z=M,K=G._cfg.dbschema;ii(v,z,x),ii(v,K,x),M=v._dbSchema=K;var W=Es(z,K);W.add.forEach(function(it){fs(x,it[0],it[1].primKey,it[1].indexes)}),W.change.forEach(function(it){if(it.recreate)throw new ct.Upgrade("Not yet support for changing primary key");var st=x.objectStore(it.name);it.add.forEach(function(pt){return ni(st,pt)}),it.change.forEach(function(pt){st.deleteIndex(pt.name),ni(st,pt)}),it.del.forEach(function(pt){return st.deleteIndex(pt)})});var Z=G._cfg.contentUpgrade;if(Z&&G._cfg.version>U){ti(v,x),b._memoizedTables={};var rt=H(K);W.del.forEach(function(it){rt[it]=z[it]}),ps(v,[v.Transaction.prototype]),ei(v,[v.Transaction.prototype],a(rt),rt),b.schema=rt;var tt,et=fe(Z);return et&&An(),W=ot.follow(function(){var it;(tt=Z(b))&&et&&(it=Ke.bind(null,null),tt.then(it,it))}),tt&&typeof tt.then=="function"?ot.resolve(tt):W.then(function(){return tt})}}),B.push(function(z){var K,W,Z=G._cfg.dbschema;K=Z,W=z,[].slice.call(W.db.objectStoreNames).forEach(function(rt){return K[rt]==null&&W.db.deleteObjectStore(rt)}),ps(v,[v.Transaction.prototype]),ei(v,[v.Transaction.prototype],v._storeNames,v._dbSchema),b.schema=v._dbSchema}),B.push(function(z){v.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(v.idbdb.version/10)===G._cfg.version?(v.idbdb.deleteObjectStore("$meta"),delete v._dbSchema.$meta,v._storeNames=v._storeNames.filter(function(K){return K!=="$meta"})):z.objectStore("$meta").put(G._cfg.version,"version"))})}),function G(){return B.length?ot.resolve(B.shift()(b.idbtrans)).then(G):ot.resolve()}().then(function(){$o(M,x)})):ot.resolve();var v,U,b,x,B,M}).catch(g)):(a(E).forEach(function(D){fs(c,D,E[D].primKey,E[D].indexes)}),ti(r,c),void ot.follow(function(){return r.on.populate.fire(C)}).catch(g));var N,P})}function hc(r,s){$o(r._dbSchema,s),s.db.version%10!=0||s.objectStoreNames.contains("$meta")||s.db.createObjectStore("$meta").add(Math.ceil(s.db.version/10-1),"version");var c=ri(0,r.idbdb,s);ii(r,r._dbSchema,s);for(var d=0,E=Es(c,r._dbSchema).change;d<E.length;d++){var C=function(g){if(g.change.length||g.recreate)return console.warn("Unable to patch indexes of table ".concat(g.name," because it has changes on the type of index or primary key.")),{value:void 0};var O=s.objectStore(g.name);g.add.forEach(function(N){we&&console.debug("Dexie upgrade patch: Creating missing index ".concat(g.name,".").concat(N.src)),ni(O,N)})}(E[d]);if(typeof C=="object")return C.value}}function Es(r,s){var c,d={del:[],add:[],change:[]};for(c in r)s[c]||d.del.push(c);for(c in s){var E=r[c],C=s[c];if(E){var g={name:c,def:C,recreate:!1,del:[],add:[],change:[]};if(""+(E.primKey.keyPath||"")!=""+(C.primKey.keyPath||"")||E.primKey.auto!==C.primKey.auto)g.recreate=!0,d.change.push(g);else{var O=E.idxByName,N=C.idxByName,P=void 0;for(P in O)N[P]||g.del.push(P);for(P in N){var D=O[P],v=N[P];D?D.src!==v.src&&g.change.push(v):g.add.push(v)}(0<g.del.length||0<g.add.length||0<g.change.length)&&d.change.push(g)}}else d.add.push([c,C])}return d}function fs(r,s,c,d){var E=r.db.createObjectStore(s,c.keyPath?{keyPath:c.keyPath,autoIncrement:c.auto}:{autoIncrement:c.auto});return d.forEach(function(C){return ni(E,C)}),E}function $o(r,s){a(r).forEach(function(c){s.db.objectStoreNames.contains(c)||(we&&console.debug("Dexie: Creating missing table",c),fs(s,c,r[c].primKey,r[c].indexes))})}function ni(r,s){r.createIndex(s.name,s.keyPath,{unique:s.unique,multiEntry:s.multi})}function ri(r,s,c){var d={};return S(s.objectStoreNames,0).forEach(function(E){for(var C=c.objectStore(E),g=hs(Zo(P=C.keyPath),P||"",!0,!1,!!C.autoIncrement,P&&typeof P!="string",!0),O=[],N=0;N<C.indexNames.length;++N){var D=C.index(C.indexNames[N]),P=D.keyPath,D=hs(D.name,P,!!D.unique,!!D.multiEntry,!1,P&&typeof P!="string",!1);O.push(D)}d[E]=us(E,g,O)}),d}function ii(r,s,c){for(var d=c.db.objectStoreNames,E=0;E<d.length;++E){var C=d[E],g=c.objectStore(C);r._hasGetAll="getAll"in g;for(var O=0;O<g.indexNames.length;++O){var N=g.indexNames[O],P=g.index(N).keyPath,D=typeof P=="string"?P:"["+S(P).join("+")+"]";!s[C]||(P=s[C].idxByName[D])&&(P.name=N,delete s[C].idxByName[D],s[C].idxByName[N]=P)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&o.WorkerGlobalScope&&o instanceof o.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(r._hasGetAll=!1)}function Jo(r){return r.split(",").map(function(s,c){var d=(s=s.trim()).replace(/([&*]|\+\+)/g,""),E=/^\[/.test(d)?d.match(/^\[(.*)\]$/)[1].split("+"):d;return hs(d,E||null,/\&/.test(s),/\*/.test(s),/\+\+/.test(s),l(E),c===0)})}var uc=(si.prototype._parseStoresSpec=function(r,s){a(r).forEach(function(c){if(r[c]!==null){var d=Jo(r[c]),E=d.shift();if(E.unique=!0,E.multi)throw new ct.Schema("Primary key cannot be multi-valued");d.forEach(function(C){if(C.auto)throw new ct.Schema("Only primary key can be marked as autoIncrement (++)");if(!C.keyPath)throw new ct.Schema("Index must have a name and cannot be an empty string")}),s[c]=us(c,E,d)}})},si.prototype.stores=function(c){var s=this.db;this._cfg.storesSource=this._cfg.storesSource?h(this._cfg.storesSource,c):c;var c=s._versions,d={},E={};return c.forEach(function(C){h(d,C._cfg.storesSource),E=C._cfg.dbschema={},C._parseStoresSpec(d,E)}),s._dbSchema=E,ps(s,[s._allTables,s,s.Transaction.prototype]),ei(s,[s._allTables,s,s.Transaction.prototype,this._cfg.tables],a(E),E),s._storeNames=a(E),this},si.prototype.upgrade=function(r){return this._cfg.contentUpgrade=ji(this._cfg.contentUpgrade||Ot,r),this},si);function si(){}function Is(r,s){var c=r._dbNamesDB;return c||(c=r._dbNamesDB=new Ye(qr,{addons:[],indexedDB:r,IDBKeyRange:s})).version(1).stores({dbnames:"name"}),c.table("dbnames")}function ms(r){return r&&typeof r.databases=="function"}function Cs(r){return He(function(){return ht.letThrough=!0,r()})}function Ts(r){return!("from"in r)}var Xt=function(r,s){if(!this){var c=new Xt;return r&&"d"in r&&h(c,r),c}h(this,arguments.length?{d:1,from:r,to:1<arguments.length?s:r}:{d:0})};function mr(r,s,c){var d=_t(s,c);if(!isNaN(d)){if(0<d)throw RangeError();if(Ts(r))return h(r,{from:s,to:c,d:1});var E=r.l,d=r.r;if(_t(c,r.from)<0)return E?mr(E,s,c):r.l={from:s,to:c,d:1,l:null,r:null},ta(r);if(0<_t(s,r.to))return d?mr(d,s,c):r.r={from:s,to:c,d:1,l:null,r:null},ta(r);_t(s,r.from)<0&&(r.from=s,r.l=null,r.d=d?d.d+1:1),0<_t(c,r.to)&&(r.to=c,r.r=null,r.d=r.l?r.l.d+1:1),c=!r.r,E&&!r.l&&Cr(r,E),d&&c&&Cr(r,d)}}function Cr(r,s){Ts(s)||function c(d,N){var C=N.from,g=N.to,O=N.l,N=N.r;mr(d,C,g),O&&c(d,O),N&&c(d,N)}(r,s)}function oi(r,s){var c=gs(s),d=c.next();if(d.done)return!1;for(var E=d.value,C=gs(r),g=C.next(E.from),O=g.value;!d.done&&!g.done;){if(_t(O.from,E.to)<=0&&0<=_t(O.to,E.from))return!0;_t(E.from,O.from)<0?E=(d=c.next(O.from)).value:O=(g=C.next(E.from)).value}return!1}function gs(r){var s=Ts(r)?null:{s:0,n:r};return{next:function(c){for(var d=0<arguments.length;s;)switch(s.s){case 0:if(s.s=1,d)for(;s.n.l&&_t(c,s.n.from)<0;)s={up:s,n:s.n.l,s:1};else for(;s.n.l;)s={up:s,n:s.n.l,s:1};case 1:if(s.s=2,!d||_t(c,s.n.to)<=0)return{value:s.n,done:!1};case 2:if(s.n.r){s.s=3,s={up:s,n:s.n.r,s:0};continue}case 3:s=s.up}return{done:!0}}}}function ta(r){var s,c,d=(((s=r.r)===null||s===void 0?void 0:s.d)||0)-(((c=r.l)===null||c===void 0?void 0:c.d)||0),E=1<d?"r":d<-1?"l":"";E&&(s=E=="r"?"l":"r",c=n({},r),d=r[E],r.from=d.from,r.to=d.to,r[E]=d[E],c[E]=d[s],(r[s]=c).d=ea(c)),r.d=ea(r)}function ea(c){var s=c.r,c=c.l;return(s?c?Math.max(s.d,c.d):s.d:c?c.d:0)+1}function ai(r,s){return a(s).forEach(function(c){r[c]?Cr(r[c],s[c]):r[c]=function d(E){var C,g,O={};for(C in E)I(E,C)&&(g=E[C],O[C]=!g||typeof g!="object"||J.has(g.constructor)?g:d(g));return O}(s[c])}),r}function ys(r,s){return r.all||s.all||Object.keys(r).some(function(c){return s[c]&&oi(s[c],r[c])})}f(Xt.prototype,((ce={add:function(r){return Cr(this,r),this},addKey:function(r){return mr(this,r,r),this},addKeys:function(r){var s=this;return r.forEach(function(c){return mr(s,c,c)}),this}})[yt]=function(){return gs(this)},ce));var un={},Rs={},As=!1;function li(r){ai(Rs,r),As||(As=!0,setTimeout(function(){As=!1,Fs(Rs,!(Rs={}))},0))}function Fs(r,s){s===void 0&&(s=!1);var c=new Set;if(r.all)for(var d=0,E=Object.values(un);d<E.length;d++)na(g=E[d],r,c,s);else for(var C in r){var g,O=/^idb\:\/\/(.*)\/(.*)\//.exec(C);O&&(C=O[1],O=O[2],(g=un["idb://".concat(C,"/").concat(O)])&&na(g,r,c,s))}c.forEach(function(N){return N()})}function na(r,s,c,d){for(var E=[],C=0,g=Object.entries(r.queries.query);C<g.length;C++){for(var O=g[C],N=O[0],P=[],D=0,v=O[1];D<v.length;D++){var U=v[D];ys(s,U.obsSet)?U.subscribers.forEach(function(M){return c.add(M)}):d&&P.push(U)}d&&E.push([N,P])}if(d)for(var b=0,x=E;b<x.length;b++){var B=x[b],N=B[0],P=B[1];r.queries.query[N]=P}}function dc(r){var s=r._state,c=r._deps.indexedDB;if(s.isBeingOpened||r.idbdb)return s.dbReadyPromise.then(function(){return s.dbOpenError?Bt(s.dbOpenError):r});s.isBeingOpened=!0,s.dbOpenError=null,s.openComplete=!1;var d=s.openCanceller,E=Math.round(10*r.verno),C=!1;function g(){if(s.openCanceller!==d)throw new ct.DatabaseClosed("db.open() was cancelled")}function O(){return new ot(function(U,b){if(g(),!c)throw new ct.MissingAPI;var x=r.name,B=s.autoSchema||!E?c.open(x):c.open(x,E);if(!B)throw new ct.MissingAPI;B.onerror=Se(b),B.onblocked=Nt(r._fireOnBlocked),B.onupgradeneeded=Nt(function(M){var G;D=B.transaction,s.autoSchema&&!r._options.allowEmptyDB?(B.onerror=pr,D.abort(),B.result.close(),(G=c.deleteDatabase(x)).onsuccess=G.onerror=Nt(function(){b(new ct.NoSuchDatabase("Database ".concat(x," doesnt exist")))})):(D.onerror=Se(b),M=M.oldVersion>Math.pow(2,62)?0:M.oldVersion,v=M<1,r.idbdb=B.result,C&&hc(r,D),cc(r,M/10,D,b))},b),B.onsuccess=Nt(function(){D=null;var M,G,z,K,W,Z=r.idbdb=B.result,rt=S(Z.objectStoreNames);if(0<rt.length)try{var tt=Z.transaction((K=rt).length===1?K[0]:K,"readonly");if(s.autoSchema)G=Z,z=tt,(M=r).verno=G.version/10,z=M._dbSchema=ri(0,G,z),M._storeNames=S(G.objectStoreNames,0),ei(M,[M._allTables],a(z),z);else if(ii(r,r._dbSchema,tt),((W=Es(ri(0,(W=r).idbdb,tt),W._dbSchema)).add.length||W.change.some(function(et){return et.add.length||et.change.length}))&&!C)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),Z.close(),E=Z.version+1,C=!0,U(O());ti(r,tt)}catch{}Fn.push(r),Z.onversionchange=Nt(function(et){s.vcFired=!0,r.on("versionchange").fire(et)}),Z.onclose=Nt(function(et){r.on("close").fire(et)}),v&&(W=r._deps,tt=x,Z=W.indexedDB,W=W.IDBKeyRange,ms(Z)||tt===qr||Is(Z,W).put({name:tt}).catch(Ot)),U()},b)}).catch(function(U){switch(U==null?void 0:U.name){case"UnknownError":if(0<s.PR1398_maxLoop)return s.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),O();break;case"VersionError":if(0<E)return E=0,O()}return ot.reject(U)})}var N,P=s.dbReadyResolve,D=null,v=!1;return ot.race([d,(typeof navigator>"u"?ot.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(U){function b(){return indexedDB.databases().finally(U)}N=setInterval(b,100),b()}).finally(function(){return clearInterval(N)}):Promise.resolve()).then(O)]).then(function(){return g(),s.onReadyBeingFired=[],ot.resolve(Cs(function(){return r.on.ready.fire(r.vip)})).then(function U(){if(0<s.onReadyBeingFired.length){var b=s.onReadyBeingFired.reduce(ji,Ot);return s.onReadyBeingFired=[],ot.resolve(Cs(function(){return b(r.vip)})).then(U)}})}).finally(function(){s.openCanceller===d&&(s.onReadyBeingFired=null,s.isBeingOpened=!1)}).catch(function(U){s.dbOpenError=U;try{D&&D.abort()}catch{}return d===s.openCanceller&&r._close(),Bt(U)}).finally(function(){s.openComplete=!0,P()}).then(function(){var U;return v&&(U={},r.tables.forEach(function(b){b.schema.indexes.forEach(function(x){x.name&&(U["idb://".concat(r.name,"/").concat(b.name,"/").concat(x.name)]=new Xt(-1/0,[[[]]]))}),U["idb://".concat(r.name,"/").concat(b.name,"/")]=U["idb://".concat(r.name,"/").concat(b.name,"/:dels")]=new Xt(-1/0,[[[]]])}),je(Er).fire(U),Fs(U,!0)),r})}function _s(r){function s(C){return r.next(C)}var c=E(s),d=E(function(C){return r.throw(C)});function E(C){return function(N){var O=C(N),N=O.value;return O.done?N:N&&typeof N.then=="function"?N.then(c,d):l(N)?Promise.all(N).then(c,d):c(N)}}return E(s)()}function ci(r,s,c){for(var d=l(r)?r.slice():[r],E=0;E<c;++E)d.push(s);return d}var pc={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(r){return n(n({},r),{table:function(s){var c=r.table(s),d=c.schema,E={},C=[];function g(v,U,b){var x=Ir(v),B=E[x]=E[x]||[],M=v==null?0:typeof v=="string"?1:v.length,G=0<U,G=n(n({},b),{name:G?"".concat(x,"(virtual-from:").concat(b.name,")"):b.name,lowLevelIndex:b,isVirtual:G,keyTail:U,keyLength:M,extractKey:ds(v),unique:!G&&b.unique});return B.push(G),G.isPrimaryKey||C.push(G),1<M&&g(M===2?v[0]:v.slice(0,M-1),U+1,b),B.sort(function(z,K){return z.keyTail-K.keyTail}),G}s=g(d.primaryKey.keyPath,0,d.primaryKey),E[":id"]=[s];for(var O=0,N=d.indexes;O<N.length;O++){var P=N[O];g(P.keyPath,0,P)}function D(v){var U,b=v.query.index;return b.isVirtual?n(n({},v),{query:{index:b.lowLevelIndex,range:(U=v.query.range,b=b.keyTail,{type:U.type===1?2:U.type,lower:ci(U.lower,U.lowerOpen?r.MAX_KEY:r.MIN_KEY,b),lowerOpen:!0,upper:ci(U.upper,U.upperOpen?r.MIN_KEY:r.MAX_KEY,b),upperOpen:!0})}}):v}return n(n({},c),{schema:n(n({},d),{primaryKey:s,indexes:C,getIndexByKeyPath:function(v){return(v=E[Ir(v)])&&v[0]}}),count:function(v){return c.count(D(v))},query:function(v){return c.query(D(v))},openCursor:function(v){var U=v.query.index,b=U.keyTail,x=U.isVirtual,B=U.keyLength;return x?c.openCursor(D(v)).then(function(G){return G&&M(G)}):c.openCursor(v);function M(G){return Object.create(G,{continue:{value:function(z){z!=null?G.continue(ci(z,v.reverse?r.MAX_KEY:r.MIN_KEY,b)):v.unique?G.continue(G.key.slice(0,B).concat(v.reverse?r.MIN_KEY:r.MAX_KEY,b)):G.continue()}},continuePrimaryKey:{value:function(z,K){G.continuePrimaryKey(ci(z,r.MAX_KEY,b),K)}},primaryKey:{get:function(){return G.primaryKey}},key:{get:function(){var z=G.key;return B===1?z[0]:z.slice(0,B)}},value:{get:function(){return G.value}}})}}})}})}};function Os(r,s,c,d){return c=c||{},d=d||"",a(r).forEach(function(E){var C,g,O;I(s,E)?(C=r[E],g=s[E],typeof C=="object"&&typeof g=="object"&&C&&g?(O=It(C))!==It(g)?c[d+E]=s[E]:O==="Object"?Os(C,g,c,d+E+"."):C!==g&&(c[d+E]=s[E]):C!==g&&(c[d+E]=s[E])):c[d+E]=void 0}),a(s).forEach(function(E){I(r,E)||(c[d+E]=s[E])}),c}function ws(r,s){return s.type==="delete"?s.keys:s.keys||s.values.map(r.extractKey)}var Ec={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(r){return n(n({},r),{table:function(s){var c=r.table(s),d=c.schema.primaryKey;return n(n({},c),{mutate:function(E){var C=ht.trans,g=C.table(s).hook,O=g.deleting,N=g.creating,P=g.updating;switch(E.type){case"add":if(N.fire===Ot)break;return C._promise("readwrite",function(){return D(E)},!0);case"put":if(N.fire===Ot&&P.fire===Ot)break;return C._promise("readwrite",function(){return D(E)},!0);case"delete":if(O.fire===Ot)break;return C._promise("readwrite",function(){return D(E)},!0);case"deleteRange":if(O.fire===Ot)break;return C._promise("readwrite",function(){return function v(U,b,x){return c.query({trans:U,values:!1,query:{index:d,range:b},limit:x}).then(function(B){var M=B.result;return D({type:"delete",keys:M,trans:U}).then(function(G){return 0<G.numFailures?Promise.reject(G.failures[0]):M.length<x?{failures:[],numFailures:0,lastResult:void 0}:v(U,n(n({},b),{lower:M[M.length-1],lowerOpen:!0}),x)})})}(E.trans,E.range,1e4)},!0)}return c.mutate(E);function D(v){var U,b,x,B=ht.trans,M=v.keys||ws(d,v);if(!M)throw new Error("Keys missing");return(v=v.type==="add"||v.type==="put"?n(n({},v),{keys:M}):n({},v)).type!=="delete"&&(v.values=i([],v.values,!0)),v.keys&&(v.keys=i([],v.keys,!0)),U=c,x=M,((b=v).type==="add"?Promise.resolve([]):U.getMany({trans:b.trans,keys:x,cache:"immutable"})).then(function(G){var z=M.map(function(K,W){var Z,rt,tt,et=G[W],it={onerror:null,onsuccess:null};return v.type==="delete"?O.fire.call(it,K,et,B):v.type==="add"||et===void 0?(Z=N.fire.call(it,K,v.values[W],B),K==null&&Z!=null&&(v.keys[W]=K=Z,d.outbound||V(v.values[W],d.keyPath,K))):(Z=Os(et,v.values[W]),(rt=P.fire.call(it,Z,K,et,B))&&(tt=v.values[W],Object.keys(rt).forEach(function(st){I(tt,st)?tt[st]=rt[st]:V(tt,st,rt[st])}))),it});return c.mutate(v).then(function(K){for(var W=K.failures,Z=K.results,rt=K.numFailures,K=K.lastResult,tt=0;tt<M.length;++tt){var et=(Z||M)[tt],it=z[tt];et==null?it.onerror&&it.onerror(W[tt]):it.onsuccess&&it.onsuccess(v.type==="put"&&G[tt]?v.values[tt]:et)}return{failures:W,results:Z,numFailures:rt,lastResult:K}}).catch(function(K){return z.forEach(function(W){return W.onerror&&W.onerror(K)}),Promise.reject(K)})})}}})}})}};function ra(r,s,c){try{if(!s||s.keys.length<r.length)return null;for(var d=[],E=0,C=0;E<s.keys.length&&C<r.length;++E)_t(s.keys[E],r[C])===0&&(d.push(c?nt(s.values[E]):s.values[E]),++C);return d.length===r.length?d:null}catch{return null}}var fc={stack:"dbcore",level:-1,create:function(r){return{table:function(s){var c=r.table(s);return n(n({},c),{getMany:function(d){if(!d.cache)return c.getMany(d);var E=ra(d.keys,d.trans._cache,d.cache==="clone");return E?ot.resolve(E):c.getMany(d).then(function(C){return d.trans._cache={keys:d.keys,values:d.cache==="clone"?nt(C):C},C})},mutate:function(d){return d.type!=="add"&&(d.trans._cache=null),c.mutate(d)}})}}}};function ia(r,s){return r.trans.mode==="readonly"&&!!r.subscr&&!r.trans.explicit&&r.trans.db._options.cache!=="disabled"&&!s.schema.primaryKey.outbound}function sa(r,s){switch(r){case"query":return s.values&&!s.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Ic={stack:"dbcore",level:0,name:"Observability",create:function(r){var s=r.schema.name,c=new Xt(r.MIN_KEY,r.MAX_KEY);return n(n({},r),{transaction:function(d,E,C){if(ht.subscr&&E!=="readonly")throw new ct.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(ht.querier));return r.transaction(d,E,C)},table:function(d){var E=r.table(d),C=E.schema,g=C.primaryKey,v=C.indexes,O=g.extractKey,N=g.outbound,P=g.autoIncrement&&v.filter(function(b){return b.compound&&b.keyPath.includes(g.keyPath)}),D=n(n({},E),{mutate:function(b){function x(st){return st="idb://".concat(s,"/").concat(d,"/").concat(st),K[st]||(K[st]=new Xt)}var B,M,G,z=b.trans,K=b.mutatedParts||(b.mutatedParts={}),W=x(""),Z=x(":dels"),rt=b.type,it=b.type==="deleteRange"?[b.range]:b.type==="delete"?[b.keys]:b.values.length<50?[ws(g,b).filter(function(st){return st}),b.values]:[],tt=it[0],et=it[1],it=b.trans._cache;return l(tt)?(W.addKeys(tt),(it=rt==="delete"||tt.length===et.length?ra(tt,it):null)||Z.addKeys(tt),(it||et)&&(B=x,M=it,G=et,C.indexes.forEach(function(st){var pt=B(st.name||"");function mt(Ct){return Ct!=null?st.extractKey(Ct):null}function gt(Ct){return st.multiEntry&&l(Ct)?Ct.forEach(function(Ce){return pt.addKey(Ce)}):pt.addKey(Ct)}(M||G).forEach(function(Ct,jt){var Tt=M&&mt(M[jt]),jt=G&&mt(G[jt]);_t(Tt,jt)!==0&&(Tt!=null&&gt(Tt),jt!=null&&gt(jt))})}))):tt?(et={from:tt.lower,to:tt.upper},Z.add(et),W.add(et)):(W.add(c),Z.add(c),C.indexes.forEach(function(st){return x(st.name).add(c)})),E.mutate(b).then(function(st){return!tt||b.type!=="add"&&b.type!=="put"||(W.addKeys(st.results),P&&P.forEach(function(pt){var mt=b.values.map(function(Ct){return pt.extractKey(Ct)}),gt=pt.keyPath.findIndex(function(Ct){return Ct===g.keyPath});st.results.forEach(function(Ct){return mt[gt]=Ct}),x(pt.name).addKeys(mt)})),z.mutatedParts=ai(z.mutatedParts||{},K),st})}}),v=function(x){var B=x.query,x=B.index,B=B.range;return[x,new Xt((x=B.lower)!==null&&x!==void 0?x:r.MIN_KEY,(B=B.upper)!==null&&B!==void 0?B:r.MAX_KEY)]},U={get:function(b){return[g,new Xt(b.key)]},getMany:function(b){return[g,new Xt().addKeys(b.keys)]},count:v,query:v,openCursor:v};return a(U).forEach(function(b){D[b]=function(x){var B=ht.subscr,M=!!B,G=ia(ht,E)&&sa(b,x)?x.obsSet={}:B;if(M){var z=function(et){return et="idb://".concat(s,"/").concat(d,"/").concat(et),G[et]||(G[et]=new Xt)},K=z(""),W=z(":dels"),B=U[b](x),M=B[0],B=B[1];if((b==="query"&&M.isPrimaryKey&&!x.values?W:z(M.name||"")).add(B),!M.isPrimaryKey){if(b!=="count"){var Z=b==="query"&&N&&x.values&&E.query(n(n({},x),{values:!1}));return E[b].apply(this,arguments).then(function(et){if(b==="query"){if(N&&x.values)return Z.then(function(mt){return mt=mt.result,K.addKeys(mt),et});var it=x.values?et.result.map(O):et.result;(x.values?K:W).addKeys(it)}else if(b==="openCursor"){var st=et,pt=x.values;return st&&Object.create(st,{key:{get:function(){return W.addKey(st.primaryKey),st.key}},primaryKey:{get:function(){var mt=st.primaryKey;return W.addKey(mt),mt}},value:{get:function(){return pt&&K.addKey(st.primaryKey),st.value}}})}return et})}W.add(c)}}return E[b].apply(this,arguments)}}),D}})}};function oa(r,s,c){if(c.numFailures===0)return s;if(s.type==="deleteRange")return null;var d=s.keys?s.keys.length:"values"in s&&s.values?s.values.length:1;return c.numFailures===d?null:(s=n({},s),l(s.keys)&&(s.keys=s.keys.filter(function(E,C){return!(C in c.failures)})),"values"in s&&l(s.values)&&(s.values=s.values.filter(function(E,C){return!(C in c.failures)})),s)}function Ss(r,s){return c=r,((d=s).lower===void 0||(d.lowerOpen?0<_t(c,d.lower):0<=_t(c,d.lower)))&&(r=r,(s=s).upper===void 0||(s.upperOpen?_t(r,s.upper)<0:_t(r,s.upper)<=0));var c,d}function aa(r,s,U,d,E,C){if(!U||U.length===0)return r;var g=s.query.index,O=g.multiEntry,N=s.query.range,P=d.schema.primaryKey.extractKey,D=g.extractKey,v=(g.lowLevelIndex||g).extractKey,U=U.reduce(function(b,x){var B=b,M=x.type==="add"||x.type==="put"?x.values.filter(function(W){return W=D(W),O&&l(W)?W.some(function(Z){return Ss(Z,N)}):Ss(W,N)}).map(function(W){return W=nt(W),C&&Object.freeze(W),W}):[];switch(x.type){case"add":B=b.concat(s.values?M:M.map(function(Z){return P(Z)}));break;case"put":var G=new Xt().addKeys(x.values.map(function(Z){return P(Z)})),B=b.filter(function(Z){return Z=s.values?P(Z):Z,!oi(new Xt(Z),G)}).concat(s.values?M:M.map(function(Z){return P(Z)}));break;case"delete":var z=new Xt().addKeys(x.keys);B=b.filter(function(Z){return Z=s.values?P(Z):Z,!oi(new Xt(Z),z)});break;case"deleteRange":var K=x.range;B=b.filter(function(Z){return!Ss(P(Z),K)})}return B},r);return U===r?r:(U.sort(function(b,x){return _t(v(b),v(x))||_t(P(b),P(x))}),s.limit&&s.limit<1/0&&(U.length>s.limit?U.length=s.limit:r.length===s.limit&&U.length<s.limit&&(E.dirty=!0)),C?Object.freeze(U):U)}function la(r,s){return _t(r.lower,s.lower)===0&&_t(r.upper,s.upper)===0&&!!r.lowerOpen==!!s.lowerOpen&&!!r.upperOpen==!!s.upperOpen}function mc(r,s){return function(c,d,E,C){if(c===void 0)return d!==void 0?-1:0;if(d===void 0)return 1;if((d=_t(c,d))===0){if(E&&C)return 0;if(E)return 1;if(C)return-1}return d}(r.lower,s.lower,r.lowerOpen,s.lowerOpen)<=0&&0<=function(c,d,E,C){if(c===void 0)return d!==void 0?1:0;if(d===void 0)return-1;if((d=_t(c,d))===0){if(E&&C)return 0;if(E)return-1;if(C)return 1}return d}(r.upper,s.upper,r.upperOpen,s.upperOpen)}function Cc(r,s,c,d){r.subscribers.add(c),d.addEventListener("abort",function(){var E,C;r.subscribers.delete(c),r.subscribers.size===0&&(E=r,C=s,setTimeout(function(){E.subscribers.size===0&&Rt(C,E)},3e3))})}var Tc={stack:"dbcore",level:0,name:"Cache",create:function(r){var s=r.schema.name;return n(n({},r),{transaction:function(c,d,E){var C,g,O=r.transaction(c,d,E);return d==="readwrite"&&(g=(C=new AbortController).signal,E=function(N){return function(){if(C.abort(),d==="readwrite"){for(var P=new Set,D=0,v=c;D<v.length;D++){var U=v[D],b=un["idb://".concat(s,"/").concat(U)];if(b){var x=r.table(U),B=b.optimisticOps.filter(function(pt){return pt.trans===O});if(O._explicit&&N&&O.mutatedParts)for(var M=0,G=Object.values(b.queries.query);M<G.length;M++)for(var z=0,K=(rt=G[M]).slice();z<K.length;z++)ys((tt=K[z]).obsSet,O.mutatedParts)&&(Rt(rt,tt),tt.subscribers.forEach(function(pt){return P.add(pt)}));else if(0<B.length){b.optimisticOps=b.optimisticOps.filter(function(pt){return pt.trans!==O});for(var W=0,Z=Object.values(b.queries.query);W<Z.length;W++)for(var rt,tt,et,it=0,st=(rt=Z[W]).slice();it<st.length;it++)(tt=st[it]).res!=null&&O.mutatedParts&&(N&&!tt.dirty?(et=Object.isFrozen(tt.res),et=aa(tt.res,tt.req,B,x,tt,et),tt.dirty?(Rt(rt,tt),tt.subscribers.forEach(function(pt){return P.add(pt)})):et!==tt.res&&(tt.res=et,tt.promise=ot.resolve({result:et}))):(tt.dirty&&Rt(rt,tt),tt.subscribers.forEach(function(pt){return P.add(pt)})))}}}P.forEach(function(pt){return pt()})}}},O.addEventListener("abort",E(!1),{signal:g}),O.addEventListener("error",E(!1),{signal:g}),O.addEventListener("complete",E(!0),{signal:g})),O},table:function(c){var d=r.table(c),E=d.schema.primaryKey;return n(n({},d),{mutate:function(C){var g=ht.trans;if(E.outbound||g.db._options.cache==="disabled"||g.explicit)return d.mutate(C);var O=un["idb://".concat(s,"/").concat(c)];return O?(g=d.mutate(C),C.type!=="add"&&C.type!=="put"||!(50<=C.values.length||ws(E,C).some(function(N){return N==null}))?(O.optimisticOps.push(C),C.mutatedParts&&li(C.mutatedParts),g.then(function(N){0<N.numFailures&&(Rt(O.optimisticOps,C),(N=oa(0,C,N))&&O.optimisticOps.push(N),C.mutatedParts&&li(C.mutatedParts))}),g.catch(function(){Rt(O.optimisticOps,C),C.mutatedParts&&li(C.mutatedParts)})):g.then(function(N){var P=oa(0,n(n({},C),{values:C.values.map(function(b,v){var U,b=(U=E.keyPath)!==null&&U!==void 0&&U.includes(".")?nt(b):n({},b);return V(b,E.keyPath,N.results[v]),b})}),N);O.optimisticOps.push(P),queueMicrotask(function(){return C.mutatedParts&&li(C.mutatedParts)})}),g):d.mutate(C)},query:function(C){if(!ia(ht,d)||!sa("query",C))return d.query(C);var g=((P=ht.trans)===null||P===void 0?void 0:P.db._options.cache)==="immutable",v=ht,O=v.requery,N=v.signal,P=function(x,B,M,G){var z=un["idb://".concat(x,"/").concat(B)];if(!z)return[];if(!(B=z.queries[M]))return[null,!1,z,null];var K=B[(G.query?G.query.index.name:null)||""];if(!K)return[null,!1,z,null];switch(M){case"query":var W=K.find(function(Z){return Z.req.limit===G.limit&&Z.req.values===G.values&&la(Z.req.query.range,G.query.range)});return W?[W,!0,z,K]:[K.find(function(Z){return("limit"in Z.req?Z.req.limit:1/0)>=G.limit&&(!G.values||Z.req.values)&&mc(Z.req.query.range,G.query.range)}),!1,z,K];case"count":return W=K.find(function(Z){return la(Z.req.query.range,G.query.range)}),[W,!!W,z,K]}}(s,c,"query",C),D=P[0],v=P[1],U=P[2],b=P[3];return D&&v?D.obsSet=C.obsSet:(v=d.query(C).then(function(x){var B=x.result;if(D&&(D.res=B),g){for(var M=0,G=B.length;M<G;++M)Object.freeze(B[M]);Object.freeze(B)}else x.result=nt(B);return x}).catch(function(x){return b&&D&&Rt(b,D),Promise.reject(x)}),D={obsSet:C.obsSet,promise:v,subscribers:new Set,type:"query",req:C,dirty:!1},b?b.push(D):(b=[D],(U=U||(un["idb://".concat(s,"/").concat(c)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[C.query.index.name||""]=b)),Cc(D,b,O,N),D.promise.then(function(x){return{result:aa(x.result,C,U==null?void 0:U.optimisticOps,d,D,g)}})}})}})}};function hi(r,s){return new Proxy(r,{get:function(c,d,E){return d==="db"?s:Reflect.get(c,d,E)}})}var Ye=(Yt.prototype.version=function(r){if(isNaN(r)||r<.1)throw new ct.Type("Given version is not a positive number");if(r=Math.round(10*r)/10,this.idbdb||this._state.isBeingOpened)throw new ct.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,r);var s=this._versions,c=s.filter(function(d){return d._cfg.version===r})[0];return c||(c=new this.Version(r),s.push(c),s.sort(lc),c.stores({}),this._state.autoSchema=!1,c)},Yt.prototype._whenReady=function(r){var s=this;return this.idbdb&&(this._state.openComplete||ht.letThrough||this._vip)?r():new ot(function(c,d){if(s._state.openComplete)return d(new ct.DatabaseClosed(s._state.dbOpenError));if(!s._state.isBeingOpened){if(!s._state.autoOpen)return void d(new ct.DatabaseClosed);s.open().catch(Ot)}s._state.dbReadyPromise.then(c,d)}).then(r)},Yt.prototype.use=function(r){var s=r.stack,c=r.create,d=r.level,E=r.name;return E&&this.unuse({stack:s,name:E}),r=this._middlewares[s]||(this._middlewares[s]=[]),r.push({stack:s,create:c,level:d??10,name:E}),r.sort(function(C,g){return C.level-g.level}),this},Yt.prototype.unuse=function(r){var s=r.stack,c=r.name,d=r.create;return s&&this._middlewares[s]&&(this._middlewares[s]=this._middlewares[s].filter(function(E){return d?E.create!==d:!!c&&E.name!==c})),this},Yt.prototype.open=function(){var r=this;return ln(ze,function(){return dc(r)})},Yt.prototype._close=function(){var r=this._state,s=Fn.indexOf(this);if(0<=s&&Fn.splice(s,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}r.isBeingOpened||(r.dbReadyPromise=new ot(function(c){r.dbReadyResolve=c}),r.openCanceller=new ot(function(c,d){r.cancelOpen=d}))},Yt.prototype.close=function(c){var s=(c===void 0?{disableAutoOpen:!0}:c).disableAutoOpen,c=this._state;s?(c.isBeingOpened&&c.cancelOpen(new ct.DatabaseClosed),this._close(),c.autoOpen=!1,c.dbOpenError=new ct.DatabaseClosed):(this._close(),c.autoOpen=this._options.autoOpen||c.isBeingOpened,c.openComplete=!1,c.dbOpenError=null)},Yt.prototype.delete=function(r){var s=this;r===void 0&&(r={disableAutoOpen:!0});var c=0<arguments.length&&typeof arguments[0]!="object",d=this._state;return new ot(function(E,C){function g(){s.close(r);var O=s._deps.indexedDB.deleteDatabase(s.name);O.onsuccess=Nt(function(){var N,P,D;N=s._deps,P=s.name,D=N.indexedDB,N=N.IDBKeyRange,ms(D)||P===qr||Is(D,N).delete(P).catch(Ot),E()}),O.onerror=Se(C),O.onblocked=s._fireOnBlocked}if(c)throw new ct.InvalidArgument("Invalid closeOptions argument to db.delete()");d.isBeingOpened?d.dbReadyPromise.then(g):g()})},Yt.prototype.backendDB=function(){return this.idbdb},Yt.prototype.isOpen=function(){return this.idbdb!==null},Yt.prototype.hasBeenClosed=function(){var r=this._state.dbOpenError;return r&&r.name==="DatabaseClosed"},Yt.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Yt.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Yt.prototype,"tables",{get:function(){var r=this;return a(this._allTables).map(function(s){return r._allTables[s]})},enumerable:!1,configurable:!0}),Yt.prototype.transaction=function(){var r=(function(s,c,d){var E=arguments.length;if(E<2)throw new ct.InvalidArgument("Too few arguments");for(var C=new Array(E-1);--E;)C[E-1]=arguments[E];return d=C.pop(),[s,Q(C),d]}).apply(this,arguments);return this._transaction.apply(this,r)},Yt.prototype._transaction=function(r,s,c){var d=this,E=ht.trans;E&&E.db===this&&r.indexOf("!")===-1||(E=null);var C,g,O=r.indexOf("?")!==-1;r=r.replace("!","").replace("?","");try{if(g=s.map(function(P){if(P=P instanceof d.Table?P.name:P,typeof P!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return P}),r=="r"||r===rs)C=rs;else{if(r!="rw"&&r!=is)throw new ct.InvalidArgument("Invalid transaction mode: "+r);C=is}if(E){if(E.mode===rs&&C===is){if(!O)throw new ct.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");E=null}E&&g.forEach(function(P){if(E&&E.storeNames.indexOf(P)===-1){if(!O)throw new ct.SubTransaction("Table "+P+" not included in parent transaction.");E=null}}),O&&E&&!E.active&&(E=null)}}catch(P){return E?E._promise(null,function(D,v){v(P)}):Bt(P)}var N=(function P(D,v,U,b,x){return ot.resolve().then(function(){var B=ht.transless||ht,M=D._createTransaction(v,U,D._dbSchema,b);if(M.explicit=!0,B={trans:M,transless:B},b)M.idbtrans=b.idbtrans;else try{M.create(),M.idbtrans._explicit=!0,D._state.PR1398_maxLoop=3}catch(K){return K.name===De.InvalidState&&D.isOpen()&&0<--D._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),D.close({disableAutoOpen:!1}),D.open().then(function(){return P(D,v,U,null,x)})):Bt(K)}var G,z=fe(x);return z&&An(),B=ot.follow(function(){var K;(G=x.call(M,M))&&(z?(K=Ke.bind(null,null),G.then(K,K)):typeof G.next=="function"&&typeof G.throw=="function"&&(G=_s(G)))},B),(G&&typeof G.then=="function"?ot.resolve(G).then(function(K){return M.active?K:Bt(new ct.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):B.then(function(){return G})).then(function(K){return b&&M._resolve(),M._completion.then(function(){return K})}).catch(function(K){return M._reject(K),Bt(K)})})}).bind(null,this,C,g,E,c);return E?E._promise(C,N,"lock"):ht.trans?ln(ht.transless,function(){return d._whenReady(N)}):this._whenReady(N)},Yt.prototype.table=function(r){if(!I(this._allTables,r))throw new ct.InvalidTable("Table ".concat(r," does not exist"));return this._allTables[r]},Yt);function Yt(r,s){var c=this;this._middlewares={},this.verno=0;var d=Yt.dependencies;this._options=s=n({addons:Yt.addons,autoOpen:!0,indexedDB:d.indexedDB,IDBKeyRange:d.IDBKeyRange,cache:"cloned"},s),this._deps={indexedDB:s.indexedDB,IDBKeyRange:s.IDBKeyRange},d=s.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var E,C,g,O,N,P={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Ot,dbReadyPromise:null,cancelOpen:Ot,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:s.autoOpen};P.dbReadyPromise=new ot(function(v){P.dbReadyResolve=v}),P.openCanceller=new ot(function(v,U){P.cancelOpen=U}),this._state=P,this.name=r,this.on=ur(this,"populate","blocked","versionchange","close",{ready:[ji,Ot]}),this.on.ready.subscribe=Y(this.on.ready.subscribe,function(v){return function(U,b){Yt.vip(function(){var x,B=c._state;B.openComplete?(B.dbOpenError||ot.resolve().then(U),b&&v(U)):B.onReadyBeingFired?(B.onReadyBeingFired.push(U),b&&v(U)):(v(U),x=c,b||v(function M(){x.on.ready.unsubscribe(U),x.on.ready.unsubscribe(M)}))})}}),this.Collection=(E=this,dr(ec.prototype,function(G,M){this.db=E;var b=ko,x=null;if(M)try{b=M()}catch(z){x=z}var B=G._ctx,M=B.table,G=M.hook.reading.fire;this._ctx={table:M,index:B.index,isPrimKey:!B.index||M.schema.primKey.keyPath&&B.index===M.schema.primKey.name,range:b,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:x,or:B.or,valueMapper:G!==Oe?G:null}})),this.Table=(C=this,dr(Ho.prototype,function(v,U,b){this.db=C,this._tx=b,this.name=v,this.schema=U,this.hook=C._allTables[v]?C._allTables[v].hook:ur(null,{creating:[ir,Ot],reading:[Xi,Oe],updating:[jl,Ot],deleting:[sr,Ot]})})),this.Transaction=(g=this,dr(ic.prototype,function(v,U,b,x,B){var M=this;this.db=g,this.mode=v,this.storeNames=U,this.schema=b,this.chromeTransactionDurability=x,this.idbtrans=null,this.on=ur(this,"complete","error","abort"),this.parent=B||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new ot(function(G,z){M._resolve=G,M._reject=z}),this._completion.then(function(){M.active=!1,M.on.complete.fire()},function(G){var z=M.active;return M.active=!1,M.on.error.fire(G),M.parent?M.parent._reject(G):z&&M.idbtrans&&M.idbtrans.abort(),Bt(G)})})),this.Version=(O=this,dr(uc.prototype,function(v){this.db=O,this._cfg={version:v,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(N=this,dr(qo.prototype,function(v,U,b){if(this.db=N,this._ctx={table:v,index:U===":id"?null:U,or:b},this._cmp=this._ascending=_t,this._descending=function(x,B){return _t(B,x)},this._max=function(x,B){return 0<_t(x,B)?x:B},this._min=function(x,B){return _t(x,B)<0?x:B},this._IDBKeyRange=N._deps.IDBKeyRange,!this._IDBKeyRange)throw new ct.MissingAPI})),this.on("versionchange",function(v){0<v.newVersion?console.warn("Another connection wants to upgrade database '".concat(c.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(c.name,"'. Closing db now to resume the delete request.")),c.close({disableAutoOpen:!1})}),this.on("blocked",function(v){!v.newVersion||v.newVersion<v.oldVersion?console.warn("Dexie.delete('".concat(c.name,"') was blocked")):console.warn("Upgrade '".concat(c.name,"' blocked by other connection holding version ").concat(v.oldVersion/10))}),this._maxKey=fr(s.IDBKeyRange),this._createTransaction=function(v,U,b,x){return new c.Transaction(v,U,b,c._options.chromeTransactionDurability,x)},this._fireOnBlocked=function(v){c.on("blocked").fire(v),Fn.filter(function(U){return U.name===c.name&&U!==c&&!U._state.vcFired}).map(function(U){return U.on("versionchange").fire(v)})},this.use(fc),this.use(Tc),this.use(Ic),this.use(pc),this.use(Ec);var D=new Proxy(this,{get:function(v,U,b){if(U==="_vip")return!0;if(U==="table")return function(B){return hi(c.table(B),D)};var x=Reflect.get(v,U,b);return x instanceof Ho?hi(x,D):U==="tables"?x.map(function(B){return hi(B,D)}):U==="_createTransaction"?function(){return hi(x.apply(this,arguments),D)}:x}});this.vip=D,d.forEach(function(v){return v(c)})}var ui,ce=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",gc=(vs.prototype.subscribe=function(r,s,c){return this._subscribe(r&&typeof r!="function"?r:{next:r,error:s,complete:c})},vs.prototype[ce]=function(){return this},vs);function vs(r){this._subscribe=r}try{ui={indexedDB:o.indexedDB||o.mozIndexedDB||o.webkitIndexedDB||o.msIndexedDB,IDBKeyRange:o.IDBKeyRange||o.webkitIDBKeyRange}}catch{ui={indexedDB:null,IDBKeyRange:null}}function ca(r){var s,c=!1,d=new gc(function(E){var C=fe(r),g,O=!1,N={},P={},D={get closed(){return O},unsubscribe:function(){O||(O=!0,g&&g.abort(),v&&je.storagemutated.unsubscribe(b))}};E.start&&E.start(D);var v=!1,U=function(){return ns(x)},b=function(B){ai(N,B),ys(P,N)&&U()},x=function(){var B,M,G;!O&&ui.indexedDB&&(N={},B={},g&&g.abort(),g=new AbortController,G=function(z){var K=yn();try{C&&An();var W=He(r,z);return W=C?W.finally(Ke):W}finally{K&&Rn()}}(M={subscr:B,signal:g.signal,requery:U,querier:r,trans:null}),Promise.resolve(G).then(function(z){c=!0,s=z,O||M.signal.aborted||(N={},function(K){for(var W in K)if(I(K,W))return;return 1}(P=B)||v||(je(Er,b),v=!0),ns(function(){return!O&&E.next&&E.next(z)}))},function(z){c=!1,["DatabaseClosedError","AbortError"].includes(z==null?void 0:z.name)||O||ns(function(){O||E.error&&E.error(z)})}))};return setTimeout(U,0),D});return d.hasValue=function(){return c},d.getValue=function(){return s},d}var dn=Ye;function Ps(r){var s=qe;try{qe=!0,je.storagemutated.fire(r),Fs(r,!0)}finally{qe=s}}f(dn,n(n({},Ie),{delete:function(r){return new dn(r,{addons:[]}).delete()},exists:function(r){return new dn(r,{addons:[]}).open().then(function(s){return s.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(r){try{return s=dn.dependencies,c=s.indexedDB,s=s.IDBKeyRange,(ms(c)?Promise.resolve(c.databases()).then(function(d){return d.map(function(E){return E.name}).filter(function(E){return E!==qr})}):Is(c,s).toCollection().primaryKeys()).then(r)}catch{return Bt(new ct.MissingAPI)}var s,c},defineClass:function(){return function(r){h(this,r)}},ignoreTransaction:function(r){return ht.trans?ln(ht.transless,r):r()},vip:Cs,async:function(r){return function(){try{var s=_s(r.apply(this,arguments));return s&&typeof s.then=="function"?s:ot.resolve(s)}catch(c){return Bt(c)}}},spawn:function(r,s,c){try{var d=_s(r.apply(c,s||[]));return d&&typeof d.then=="function"?d:ot.resolve(d)}catch(E){return Bt(E)}},currentTransaction:{get:function(){return ht.trans||null}},waitFor:function(r,s){return s=ot.resolve(typeof r=="function"?dn.ignoreTransaction(r):r).timeout(s||6e4),ht.trans?ht.trans.waitFor(s):s},Promise:ot,debug:{get:function(){return we},set:function(r){Lo(r)}},derive:F,extend:h,props:f,override:Y,Events:ur,on:je,liveQuery:ca,extendObservabilitySet:ai,getByKeyPath:k,setByKeyPath:V,delByKeyPath:function(r,s){typeof s=="string"?V(r,s,void 0):"length"in s&&[].map.call(s,function(c){V(r,c,void 0)})},shallowClone:H,deepClone:nt,getObjectDiff:Os,cmp:_t,asap:L,minKey:-1/0,addons:[],connections:Fn,errnames:De,dependencies:ui,cache:un,semVer:"4.0.4",version:"4.0.4".split(".").map(function(r){return parseInt(r)}).reduce(function(r,s,c){return r+s/Math.pow(10,2*c)})})),dn.maxKey=fr(dn.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(je(Er,function(r){qe||(r=new CustomEvent(cs,{detail:r}),qe=!0,dispatchEvent(r),qe=!1)}),addEventListener(cs,function(r){r=r.detail,qe||Ps(r)}));var wn,qe=!1,ha=function(){};return typeof BroadcastChannel<"u"&&((ha=function(){(wn=new BroadcastChannel(cs)).onmessage=function(r){return r.data&&Ps(r.data)}})(),typeof wn.unref=="function"&&wn.unref(),je(Er,function(r){qe||wn.postMessage(r)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(r){if(!Ye.disableBfCache&&r.persisted){we&&console.debug("Dexie: handling persisted pagehide"),wn!=null&&wn.close();for(var s=0,c=Fn;s<c.length;s++)c[s].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(r){!Ye.disableBfCache&&r.persisted&&(we&&console.debug("Dexie: handling persisted pageshow"),ha(),Ps({all:new Xt(-1/0,[[]])}))})),ot.rejectionMapper=function(r,s){return!r||r instanceof le||r instanceof TypeError||r instanceof SyntaxError||!r.name||!xt[r.name]?r:(s=new xt[r.name](s||r.message,r),"stack"in r&&A(s,"stack",{get:function(){return this.inner.stack}}),s)},Lo(we),n(Ye,Object.freeze({__proto__:null,Dexie:Ye,liveQuery:ca,Entity:Go,cmp:_t,PropModSymbol:Be,PropModification:as,replacePrefix:function(r,s){return new as({replacePrefix:[r,s]})},default:Ye,RangeSet:Xt,mergeRanges:Cr,rangesOverlap:oi}),{default:Ye}),Ye})})(Wl);var $u=Wl.exports;const To=Kc($u),il=Symbol.for("Dexie"),sl=globalThis[il]||(globalThis[il]=To);if(To.semVer!==sl.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${To.semVer} and ${sl.semVer}`);const Ju=document.getElementById("container"),Tn=new wl,td=Tn.get(Ml),nr=td.create();nr.scene=new fu(Tn);nr.renderer=new Qu(Tn,Ju);nr.camera=new Yr(Tn);Tn.init();nr.camera.controls.setLookAt(5,5,5,0,0,0);const ed=Tn.get(xl);ed.create(nr);const Xl=Tn.get(Co);Xl.threshold=10;for(let u=0;u<20;u++){const t=Math.random()*5,e=Math.random()*5,n=Math.random()*5;Xl.create(nr,"🚀",new q(t,e,n))}
