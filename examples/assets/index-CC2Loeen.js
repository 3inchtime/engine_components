import{t as it,V as U,h as He,w as Is,T as os,S as Pi,x as Pe,a as se,C as Ue,E as vi,D as ho,A as Pa,W as Ys,v as zt,P as Mn,aB as va,z as Ma,aC as st,c as Ee,aD as Da,y as Dn,ap as Oi,Y as hs,J as ba,e as Vs,as as yi,aZ as cr,a_ as Ua,b0 as xa,br as Ba,aw as uo,N as Mi,b as us,Q as ks,s as Gt,X as Yt,Z as hr,_ as Io,$ as xs,a0 as kt,a1 as Ya,d as Gs,a2 as ht,i as ls,a3 as Hs,a4 as Nt,a5 as Va,a6 as Di,a7 as bn,a8 as Un,a9 as xn,aa as Bn,ab as Yn,ac as bi,ad as Vn,ae as Gn,af as zn,ag as kn,ah as Hn,ai as Wn,aj as Xn,ak as Eo,B as Me,al as Ga,am as za,an as Ni,ao as ka,I as jn,aO as Zn,aP as $n,aA as qn,aE as Gi,K as xe,O as Li,j as Ri,aI as Ha,L as fo,aJ as Wa,aK as Xa,aL as ja,aM as Za,aN as $a,av as qa,k as It,aQ as Wt,aR as Qa,aS as Ka,aT as ur,aU as dr,b9 as Ir,ba as Ja,H as Er,aF as Zs,ay as Ft,aG as el,aH as Ts,r as tl,bb as sl,bc as il,bd as nl,be as rl,ax as ol,bj as al}from"./web-ifc-api-Df2dhA4n.js";var ll=Object.defineProperty,cl=(l,e,t)=>e in l?ll(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t,p=(l,e,t)=>(cl(l,typeof e!="symbol"?e+"":e,t),t);const po=0,hl=1,ul=2,fr=2,zi=1.25,pr=1,gi=6*4+4+4,Ui=65535,dl=Math.pow(2,-24),ki=Symbol("SKIP_GENERATION");function Il(l){return l.index?l.index.count:l.attributes.position.count}function Es(l){return Il(l)/3}function El(l,e=ArrayBuffer){return l>65535?new Uint32Array(new e(4*l)):new Uint16Array(new e(2*l))}function fl(l,e){if(!l.index){const t=l.attributes.position.count,s=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,i=El(t,s);l.setIndex(new Gs(i,1));for(let n=0;n<t;n++)i[n]=n}}function Co(l){const e=Es(l),t=l.drawRange,s=t.start/3,i=(t.start+t.count)/3,n=Math.max(0,s),r=Math.min(e,i)-n;return[{offset:Math.floor(n),count:Math.floor(r)}]}function To(l){if(!l.groups||!l.groups.length)return Co(l);const e=[],t=new Set,s=l.drawRange,i=s.start/3,n=(s.start+s.count)/3;for(const o of l.groups){const a=o.start/3,c=(o.start+o.count)/3;t.add(Math.max(i,a)),t.add(Math.min(n,c))}const r=Array.from(t.values()).sort((o,a)=>o-a);for(let o=0;o<r.length-1;o++){const a=r[o],c=r[o+1];e.push({offset:Math.floor(a),count:Math.floor(c-a)})}return e}function pl(l){if(l.groups.length===0)return!1;const e=Es(l),t=To(l).sort((n,r)=>n.offset-r.offset),s=t[t.length-1];s.count=Math.min(e-s.offset,s.count);let i=0;return t.forEach(({count:n})=>i+=n),e!==i}function Oe(l,e,t){return t.min.x=e[l],t.min.y=e[l+1],t.min.z=e[l+2],t.max.x=e[l+3],t.max.y=e[l+4],t.max.z=e[l+5],t}function Cl(l){l[0]=l[1]=l[2]=1/0,l[3]=l[4]=l[5]=-1/0}function Cr(l){let e=-1,t=-1/0;for(let s=0;s<3;s++){const i=l[s+3]-l[s];i>t&&(t=i,e=s)}return e}function Tr(l,e){e.set(l)}function mr(l,e,t){let s,i;for(let n=0;n<3;n++){const r=n+3;s=l[n],i=e[n],t[n]=s<i?s:i,s=l[r],i=e[r],t[r]=s>i?s:i}}function $s(l,e,t){for(let s=0;s<3;s++){const i=e[l+2*s],n=e[l+2*s+1],r=i-n,o=i+n;r<t[s]&&(t[s]=r),o>t[s+3]&&(t[s+3]=o)}}function ms(l){const e=l[3]-l[0],t=l[4]-l[1],s=l[5]-l[2];return 2*(e*t+t*s+s*e)}function Hi(l,e,t,s,i=null){let n=1/0,r=1/0,o=1/0,a=-1/0,c=-1/0,h=-1/0,I=1/0,d=1/0,u=1/0,f=-1/0,E=-1/0,C=-1/0;const T=i!==null;for(let R=e*6,A=(e+t)*6;R<A;R+=6){const m=l[R+0],S=l[R+1],N=m-S,y=m+S;N<n&&(n=N),y>a&&(a=y),T&&m<I&&(I=m),T&&m>f&&(f=m);const P=l[R+2],_=l[R+3],M=P-_,B=P+_;M<r&&(r=M),B>c&&(c=B),T&&P<d&&(d=P),T&&P>E&&(E=P);const O=l[R+4],v=l[R+5],F=O-v,b=O+v;F<o&&(o=F),b>h&&(h=b),T&&O<u&&(u=O),T&&O>C&&(C=O)}s[0]=n,s[1]=r,s[2]=o,s[3]=a,s[4]=c,s[5]=h,T&&(i[0]=I,i[1]=d,i[2]=u,i[3]=f,i[4]=E,i[5]=C)}function Tl(l,e,t,s){let i=1/0,n=1/0,r=1/0,o=-1/0,a=-1/0,c=-1/0;for(let h=e*6,I=(e+t)*6;h<I;h+=6){const d=l[h+0];d<i&&(i=d),d>o&&(o=d);const u=l[h+2];u<n&&(n=u),u>a&&(a=u);const f=l[h+4];f<r&&(r=f),f>c&&(c=f)}s[0]=i,s[1]=n,s[2]=r,s[3]=o,s[4]=a,s[5]=c}function ml(l,e){Cl(e);const t=l.attributes.position,s=l.index?l.index.array:null,i=Es(l),n=new Float32Array(i*6),r=t.normalized,o=t.array,a=t.offset||0;let c=3;t.isInterleavedBufferAttribute&&(c=t.data.stride);const h=["getX","getY","getZ"];for(let I=0;I<i;I++){const d=I*3,u=I*6;let f=d+0,E=d+1,C=d+2;s&&(f=s[f],E=s[E],C=s[C]),r||(f=f*c+a,E=E*c+a,C=C*c+a);for(let T=0;T<3;T++){let R,A,m;r?(R=t[h[T]](f),A=t[h[T]](E),m=t[h[T]](C)):(R=o[f+T],A=o[E+T],m=o[C+T]);let S=R;A<S&&(S=A),m<S&&(S=m);let N=R;A>N&&(N=A),m>N&&(N=m);const y=(N-S)/2,P=T*2;n[u+P+0]=S+y,n[u+P+1]=y+(Math.abs(S)+y)*dl,S<e[T]&&(e[T]=S),N>e[T+3]&&(e[T+3]=N)}}return n}const Et=32,Rl=(l,e)=>l.candidate-e.candidate,St=new Array(Et).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),qs=new Float32Array(6);function gl(l,e,t,s,i,n){let r=-1,o=0;if(n===po)r=Cr(e),r!==-1&&(o=(e[r]+e[r+3])/2);else if(n===hl)r=Cr(l),r!==-1&&(o=Fl(t,s,i,r));else if(n===ul){const a=ms(l);let c=zi*i;const h=s*6,I=(s+i)*6;for(let d=0;d<3;d++){const u=e[d],f=(e[d+3]-u)/Et;if(i<Et/4){const E=[...St];E.length=i;let C=0;for(let R=h;R<I;R+=6,C++){const A=E[C];A.candidate=t[R+2*d],A.count=0;const{bounds:m,leftCacheBounds:S,rightCacheBounds:N}=A;for(let y=0;y<3;y++)N[y]=1/0,N[y+3]=-1/0,S[y]=1/0,S[y+3]=-1/0,m[y]=1/0,m[y+3]=-1/0;$s(R,t,m)}E.sort(Rl);let T=i;for(let R=0;R<T;R++){const A=E[R];for(;R+1<T&&E[R+1].candidate===A.candidate;)E.splice(R+1,1),T--}for(let R=h;R<I;R+=6){const A=t[R+2*d];for(let m=0;m<T;m++){const S=E[m];A>=S.candidate?$s(R,t,S.rightCacheBounds):($s(R,t,S.leftCacheBounds),S.count++)}}for(let R=0;R<T;R++){const A=E[R],m=A.count,S=i-A.count,N=A.leftCacheBounds,y=A.rightCacheBounds;let P=0;m!==0&&(P=ms(N)/a);let _=0;S!==0&&(_=ms(y)/a);const M=pr+zi*(P*m+_*S);M<c&&(r=d,c=M,o=A.candidate)}}else{for(let T=0;T<Et;T++){const R=St[T];R.count=0,R.candidate=u+f+T*f;const A=R.bounds;for(let m=0;m<3;m++)A[m]=1/0,A[m+3]=-1/0}for(let T=h;T<I;T+=6){let R=~~((t[T+2*d]-u)/f);R>=Et&&(R=Et-1);const A=St[R];A.count++,$s(T,t,A.bounds)}const E=St[Et-1];Tr(E.bounds,E.rightCacheBounds);for(let T=Et-2;T>=0;T--){const R=St[T],A=St[T+1];mr(R.bounds,A.rightCacheBounds,R.rightCacheBounds)}let C=0;for(let T=0;T<Et-1;T++){const R=St[T],A=R.count,m=R.bounds,S=St[T+1].rightCacheBounds;A!==0&&(C===0?Tr(m,qs):mr(m,qs,qs)),C+=A;let N=0,y=0;C!==0&&(N=ms(qs)/a);const P=i-C;P!==0&&(y=ms(S)/a);const _=pr+zi*(N*C+y*P);_<c&&(r=d,c=_,o=R.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${n} used.`);return{axis:r,pos:o}}function Fl(l,e,t,s){let i=0;for(let n=e,r=e+t;n<r;n++)i+=l[n*6+s*2];return i/t}class Qs{constructor(){}}function Sl(l,e,t,s,i,n){let r=s,o=s+i-1;const a=n.pos,c=n.axis*2;for(;;){for(;r<=o&&t[r*6+c]<a;)r++;for(;r<=o&&t[o*6+c]>=a;)o--;if(r<o){for(let h=0;h<3;h++){let I=e[r*3+h];e[r*3+h]=e[o*3+h],e[o*3+h]=I}for(let h=0;h<6;h++){let I=t[r*6+h];t[r*6+h]=t[o*6+h],t[o*6+h]=I}r++,o--}else return r}}function Al(l,e,t,s,i,n){let r=s,o=s+i-1;const a=n.pos,c=n.axis*2;for(;;){for(;r<=o&&t[r*6+c]<a;)r++;for(;r<=o&&t[o*6+c]>=a;)o--;if(r<o){let h=l[r];l[r]=l[o],l[o]=h;for(let I=0;I<6;I++){let d=t[r*6+I];t[r*6+I]=t[o*6+I],t[o*6+I]=d}r++,o--}else return r}}function Ol(l,e){const t=(l.index?l.index.count:l.attributes.position.count)/3,s=t>2**16,i=s?4:2,n=e?new SharedArrayBuffer(t*i):new ArrayBuffer(t*i),r=s?new Uint32Array(n):new Uint16Array(n);for(let o=0,a=r.length;o<a;o++)r[o]=o;return r}function yl(l,e){const t=l.geometry,s=t.index?t.index.array:null,i=e.maxDepth,n=e.verbose,r=e.maxLeafTris,o=e.strategy,a=e.onProgress,c=Es(t),h=l._indirectBuffer;let I=!1;const d=new Float32Array(6),u=new Float32Array(6),f=ml(t,d),E=e.indirect?Al:Sl,C=[],T=e.indirect?Co(t):To(t);if(T.length===1){const m=T[0],S=new Qs;S.boundingData=d,Tl(f,m.offset,m.count,u),A(S,m.offset,m.count,u),C.push(S)}else for(let m of T){const S=new Qs;S.boundingData=new Float32Array(6),Hi(f,m.offset,m.count,S.boundingData,u),A(S,m.offset,m.count,u),C.push(S)}return C;function R(m){a&&a(m/c)}function A(m,S,N,y=null,P=0){if(!I&&P>=i&&(I=!0,n&&(console.warn(`MeshBVH: Max depth of ${i} reached when generating BVH. Consider increasing maxDepth.`),console.warn(t))),N<=r||P>=i)return R(S+N),m.offset=S,m.count=N,m;const _=gl(m.boundingData,y,f,S,N,o);if(_.axis===-1)return R(S+N),m.offset=S,m.count=N,m;const M=E(h,s,f,S,N,_);if(M===S||M===S+N)R(S+N),m.offset=S,m.count=N;else{m.splitAxis=_.axis;const B=new Qs,O=S,v=M-S;m.left=B,B.boundingData=new Float32Array(6),Hi(f,O,v,B.boundingData,u),A(B,O,v,u,P+1);const F=new Qs,b=M,Z=N-v;m.right=F,F.boundingData=new Float32Array(6),Hi(f,b,Z,F.boundingData,u),A(F,b,Z,u,P+1)}return m}}function Nl(l,e){const t=l.geometry;e.indirect&&(l._indirectBuffer=Ol(t,e.useSharedArrayBuffer),pl(t)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),l._indirectBuffer||fl(t,e);const s=yl(l,e);let i,n,r;const o=[],a=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let I=0;I<s.length;I++){const d=s[I];let u=c(d);const f=new a(gi*u);i=new Float32Array(f),n=new Uint32Array(f),r=new Uint16Array(f),h(0,d),o.push(f)}l._roots=o;return;function c(I){return I.count?1:1+c(I.left)+c(I.right)}function h(I,d){const u=I/4,f=I/2,E=!!d.count,C=d.boundingData;for(let T=0;T<6;T++)i[u+T]=C[T];if(E){const T=d.offset,R=d.count;return n[u+6]=T,r[f+14]=R,r[f+15]=Ui,I+gi}else{const T=d.left,R=d.right,A=d.splitAxis;let m;if(m=h(I+gi,T),m/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[u+6]=m/4,m=h(m,R),n[u+7]=A,m}}}class Rt{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let s=1/0,i=-1/0;for(let n=0,r=e.length;n<r;n++){const o=e[n][t];s=o<s?o:s,i=o>i?o:i}this.min=s,this.max=i}setFromPoints(e,t){let s=1/0,i=-1/0;for(let n=0,r=t.length;n<r;n++){const o=t[n],a=e.dot(o);s=a<s?a:s,i=a>i?a:i}this.min=s,this.max=i}isSeparated(e){return this.min>e.max||e.min>this.max}}Rt.prototype.setFromBox=function(){const l=new U;return function(e,t){const s=t.min,i=t.max;let n=1/0,r=-1/0;for(let o=0;o<=1;o++)for(let a=0;a<=1;a++)for(let c=0;c<=1;c++){l.x=s.x*o+i.x*(1-o),l.y=s.y*a+i.y*(1-a),l.z=s.z*c+i.z*(1-c);const h=e.dot(l);n=Math.min(h,n),r=Math.max(h,r)}this.min=n,this.max=r}}();const Ll=function(){const l=new U,e=new U,t=new U;return function(s,i,n){const r=s.start,o=l,a=i.start,c=e;t.subVectors(r,a),l.subVectors(s.end,s.start),e.subVectors(i.end,i.start);const h=t.dot(c),I=c.dot(o),d=c.dot(c),u=t.dot(o),f=o.dot(o)*d-I*I;let E,C;f!==0?E=(h*I-u*d)/f:E=0,C=(h+E*I)/d,n.x=E,n.y=C}}(),Qn=function(){const l=new He,e=new U,t=new U;return function(s,i,n,r){Ll(s,i,l);let o=l.x,a=l.y;if(o>=0&&o<=1&&a>=0&&a<=1){s.at(o,n),i.at(a,r);return}else if(o>=0&&o<=1){a<0?i.at(0,r):i.at(1,r),s.closestPointToPoint(r,!0,n);return}else if(a>=0&&a<=1){o<0?s.at(0,n):s.at(1,n),i.closestPointToPoint(n,!0,r);return}else{let c;o<0?c=s.start:c=s.end;let h;a<0?h=i.start:h=i.end;const I=e,d=t;if(s.closestPointToPoint(h,!0,e),i.closestPointToPoint(c,!0,t),I.distanceToSquared(h)<=d.distanceToSquared(c)){n.copy(I),r.copy(h);return}else{n.copy(c),r.copy(d);return}}}}(),_l=function(){const l=new U,e=new U,t=new Is,s=new it;return function(i,n){const{radius:r,center:o}=i,{a,b:c,c:h}=n;if(s.start=a,s.end=c,s.closestPointToPoint(o,!0,l).distanceTo(o)<=r||(s.start=a,s.end=h,s.closestPointToPoint(o,!0,l).distanceTo(o)<=r)||(s.start=c,s.end=h,s.closestPointToPoint(o,!0,l).distanceTo(o)<=r))return!0;const I=n.getPlane(t);if(Math.abs(I.distanceToPoint(o))<=r){const d=I.projectPoint(o,e);if(n.containsPoint(d))return!0}return!1}}(),wl=1e-15;function Wi(l){return Math.abs(l)<wl}class nt extends os{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new U),this.satBounds=new Array(4).fill().map(()=>new Rt),this.points=[this.a,this.b,this.c],this.sphere=new Pi,this.plane=new Is,this.needsUpdate=!0}intersectsSphere(e){return _l(e,this)}update(){const e=this.a,t=this.b,s=this.c,i=this.points,n=this.satAxes,r=this.satBounds,o=n[0],a=r[0];this.getNormal(o),a.setFromPoints(o,i);const c=n[1],h=r[1];c.subVectors(e,t),h.setFromPoints(c,i);const I=n[2],d=r[2];I.subVectors(t,s),d.setFromPoints(I,i);const u=n[3],f=r[3];u.subVectors(s,e),f.setFromPoints(u,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,e),this.needsUpdate=!1}}nt.prototype.closestPointToSegment=function(){const l=new U,e=new U,t=new it;return function(s,i=null,n=null){const{start:r,end:o}=s,a=this.points;let c,h=1/0;for(let I=0;I<3;I++){const d=(I+1)%3;t.start.copy(a[I]),t.end.copy(a[d]),Qn(t,s,l,e),c=l.distanceToSquared(e),c<h&&(h=c,i&&i.copy(l),n&&n.copy(e))}return this.closestPointToPoint(r,l),c=r.distanceToSquared(l),c<h&&(h=c,i&&i.copy(l),n&&n.copy(r)),this.closestPointToPoint(o,l),c=o.distanceToSquared(l),c<h&&(h=c,i&&i.copy(l),n&&n.copy(o)),Math.sqrt(h)}}();nt.prototype.intersectsTriangle=function(){const l=new nt,e=new Array(3),t=new Array(3),s=new Rt,i=new Rt,n=new U,r=new U,o=new U,a=new U,c=new U,h=new it,I=new it,d=new it,u=new U;function f(E,C,T){const R=E.points;let A=0,m=-1;for(let S=0;S<3;S++){const{start:N,end:y}=h;N.copy(R[S]),y.copy(R[(S+1)%3]),h.delta(r);const P=Wi(C.distanceToPoint(N));if(Wi(C.normal.dot(r))&&P){T.copy(h),A=2;break}const _=C.intersectLine(h,u);if(!_&&P&&u.copy(N),(_||P)&&!Wi(u.distanceTo(y))){if(A<=1)(A===1?T.start:T.end).copy(u),P&&(m=A);else if(A>=2){(m===1?T.start:T.end).copy(u),A=2;break}if(A++,A===2&&m===-1)break}}return A}return function(E,C=null,T=!1){this.needsUpdate&&this.update(),E.isExtendedTriangle?E.needsUpdate&&E.update():(l.copy(E),l.update(),E=l);const R=this.plane,A=E.plane;if(Math.abs(R.normal.dot(A.normal))>1-1e-10){const m=this.satBounds,S=this.satAxes;t[0]=E.a,t[1]=E.b,t[2]=E.c;for(let P=0;P<4;P++){const _=m[P],M=S[P];if(s.setFromPoints(M,t),_.isSeparated(s))return!1}const N=E.satBounds,y=E.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let P=0;P<4;P++){const _=N[P],M=y[P];if(s.setFromPoints(M,e),_.isSeparated(s))return!1}for(let P=0;P<4;P++){const _=S[P];for(let M=0;M<4;M++){const B=y[M];if(n.crossVectors(_,B),s.setFromPoints(n,e),i.setFromPoints(n,t),s.isSeparated(i))return!1}}return C&&(T||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),C.start.set(0,0,0),C.end.set(0,0,0)),!0}else{const m=f(this,A,I);if(m===1&&E.containsPoint(I.end))return C&&(C.start.copy(I.end),C.end.copy(I.end)),!0;if(m!==2)return!1;const S=f(E,R,d);if(S===1&&this.containsPoint(d.end))return C&&(C.start.copy(d.end),C.end.copy(d.end)),!0;if(S!==2)return!1;if(I.delta(o),d.delta(a),o.dot(a)<0){let O=d.start;d.start=d.end,d.end=O}const N=I.start.dot(o),y=I.end.dot(o),P=d.start.dot(o),_=d.end.dot(o),M=y<P,B=N<_;return N!==_&&P!==y&&M===B?!1:(C&&(c.subVectors(I.start,d.start),c.dot(o)>0?C.start.copy(I.start):C.start.copy(d.start),c.subVectors(I.end,d.end),c.dot(o)<0?C.end.copy(I.end):C.end.copy(d.end)),!0)}}}();nt.prototype.distanceToPoint=function(){const l=new U;return function(e){return this.closestPointToPoint(e,l),e.distanceTo(l)}}();nt.prototype.distanceToTriangle=function(){const l=new U,e=new U,t=["a","b","c"],s=new it,i=new it;return function(n,r=null,o=null){const a=r||o?s:null;if(this.intersectsTriangle(n,a))return(r||o)&&(r&&a.getCenter(r),o&&a.getCenter(o)),0;let c=1/0;for(let h=0;h<3;h++){let I;const d=t[h],u=n[d];this.closestPointToPoint(u,l),I=u.distanceToSquared(l),I<c&&(c=I,r&&r.copy(l),o&&o.copy(u));const f=this[d];n.closestPointToPoint(f,l),I=f.distanceToSquared(l),I<c&&(c=I,r&&r.copy(f),o&&o.copy(l))}for(let h=0;h<3;h++){const I=t[h],d=t[(h+1)%3];s.set(this[I],this[d]);for(let u=0;u<3;u++){const f=t[u],E=t[(u+1)%3];i.set(n[f],n[E]),Qn(s,i,l,e);const C=l.distanceToSquared(e);C<c&&(c=C,r&&r.copy(l),o&&o.copy(e))}}return Math.sqrt(c)}}();class Ve{constructor(e,t,s){this.isOrientedBox=!0,this.min=new U,this.max=new U,this.matrix=new Ee,this.invMatrix=new Ee,this.points=new Array(8).fill().map(()=>new U),this.satAxes=new Array(3).fill().map(()=>new U),this.satBounds=new Array(3).fill().map(()=>new Rt),this.alignedSatBounds=new Array(3).fill().map(()=>new Rt),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),s&&this.matrix.copy(s)}set(e,t,s){this.min.copy(e),this.max.copy(t),this.matrix.copy(s),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}Ve.prototype.update=function(){return function(){const l=this.matrix,e=this.min,t=this.max,s=this.points;for(let a=0;a<=1;a++)for(let c=0;c<=1;c++)for(let h=0;h<=1;h++){const I=1*a|2*c|4*h,d=s[I];d.x=a?t.x:e.x,d.y=c?t.y:e.y,d.z=h?t.z:e.z,d.applyMatrix4(l)}const i=this.satBounds,n=this.satAxes,r=s[0];for(let a=0;a<3;a++){const c=n[a],h=i[a],I=1<<a,d=s[I];c.subVectors(r,d),h.setFromPoints(c,s)}const o=this.alignedSatBounds;o[0].setFromPointsField(s,"x"),o[1].setFromPointsField(s,"y"),o[2].setFromPointsField(s,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();Ve.prototype.intersectsBox=function(){const l=new Rt;return function(e){this.needsUpdate&&this.update();const t=e.min,s=e.max,i=this.satBounds,n=this.satAxes,r=this.alignedSatBounds;if(l.min=t.x,l.max=s.x,r[0].isSeparated(l)||(l.min=t.y,l.max=s.y,r[1].isSeparated(l))||(l.min=t.z,l.max=s.z,r[2].isSeparated(l)))return!1;for(let o=0;o<3;o++){const a=n[o],c=i[o];if(l.setFromBox(a,e),c.isSeparated(l))return!1}return!0}}();Ve.prototype.intersectsTriangle=function(){const l=new nt,e=new Array(3),t=new Rt,s=new Rt,i=new U;return function(n){this.needsUpdate&&this.update(),n.isExtendedTriangle?n.needsUpdate&&n.update():(l.copy(n),l.update(),n=l);const r=this.satBounds,o=this.satAxes;e[0]=n.a,e[1]=n.b,e[2]=n.c;for(let I=0;I<3;I++){const d=r[I],u=o[I];if(t.setFromPoints(u,e),d.isSeparated(t))return!1}const a=n.satBounds,c=n.satAxes,h=this.points;for(let I=0;I<3;I++){const d=a[I],u=c[I];if(t.setFromPoints(u,h),d.isSeparated(t))return!1}for(let I=0;I<3;I++){const d=o[I];for(let u=0;u<4;u++){const f=c[u];if(i.crossVectors(d,f),t.setFromPoints(i,e),s.setFromPoints(i,h),t.isSeparated(s))return!1}}return!0}}();Ve.prototype.closestPointToPoint=function(){return function(l,e){return this.needsUpdate&&this.update(),e.copy(l).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}}();Ve.prototype.distanceToPoint=function(){const l=new U;return function(e){return this.closestPointToPoint(e,l),e.distanceTo(l)}}();Ve.prototype.distanceToBox=function(){const l=["x","y","z"],e=new Array(12).fill().map(()=>new it),t=new Array(12).fill().map(()=>new it),s=new U,i=new U;return function(n,r=0,o=null,a=null){if(this.needsUpdate&&this.update(),this.intersectsBox(n))return(o||a)&&(n.getCenter(i),this.closestPointToPoint(i,s),n.closestPointToPoint(s,i),o&&o.copy(s),a&&a.copy(i)),0;const c=r*r,h=n.min,I=n.max,d=this.points;let u=1/0;for(let E=0;E<8;E++){const C=d[E];i.copy(C).clamp(h,I);const T=C.distanceToSquared(i);if(T<u&&(u=T,o&&o.copy(C),a&&a.copy(i),T<c))return Math.sqrt(T)}let f=0;for(let E=0;E<3;E++)for(let C=0;C<=1;C++)for(let T=0;T<=1;T++){const R=(E+1)%3,A=(E+2)%3,m=C<<R|T<<A,S=1<<E|C<<R|T<<A,N=d[m],y=d[S];e[f].set(N,y);const P=l[E],_=l[R],M=l[A],B=t[f],O=B.start,v=B.end;O[P]=h[P],O[_]=C?h[_]:I[_],O[M]=T?h[M]:I[_],v[P]=I[P],v[_]=C?h[_]:I[_],v[M]=T?h[M]:I[_],f++}for(let E=0;E<=1;E++)for(let C=0;C<=1;C++)for(let T=0;T<=1;T++){i.x=E?I.x:h.x,i.y=C?I.y:h.y,i.z=T?I.z:h.z,this.closestPointToPoint(i,s);const R=i.distanceToSquared(s);if(R<u&&(u=R,o&&o.copy(s),a&&a.copy(i),R<c))return Math.sqrt(R)}for(let E=0;E<12;E++){const C=e[E];for(let T=0;T<12;T++){const R=t[T];Qn(C,R,s,i);const A=s.distanceToSquared(i);if(A<u&&(u=A,o&&o.copy(s),a&&a.copy(i),A<c))return Math.sqrt(A)}}return Math.sqrt(u)}}();class Kn{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class Pl extends Kn{constructor(){super(()=>new nt)}}const Ze=new Pl;function ze(l,e){return e[l+15]===65535}function ke(l,e){return e[l+6]}function $e(l,e){return e[l+14]}function qe(l){return l+8}function Qe(l,e){return e[l+6]}function mo(l,e){return e[l+7]}class vl{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let t=null;this.setBuffer=s=>{t&&e.push(t),t=s,this.float32Array=new Float32Array(s),this.uint16Array=new Uint16Array(s),this.uint32Array=new Uint32Array(s)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,e.length!==0&&this.setBuffer(e.pop())}}}const ge=new vl;let _t,as;const Xt=[],Ks=new Kn(()=>new Pe);function Ml(l,e,t,s,i,n){_t=Ks.getPrimitive(),as=Ks.getPrimitive(),Xt.push(_t,as),ge.setBuffer(l._roots[e]);const r=hn(0,l.geometry,t,s,i,n);ge.clearBuffer(),Ks.releasePrimitive(_t),Ks.releasePrimitive(as),Xt.pop(),Xt.pop();const o=Xt.length;return o>0&&(as=Xt[o-1],_t=Xt[o-2]),r}function hn(l,e,t,s,i=null,n=0,r=0){const{float32Array:o,uint16Array:a,uint32Array:c}=ge;let h=l*2;if(ze(h,a)){const I=ke(l,c),d=$e(h,a);return Oe(l,o,_t),s(I,d,!1,r,n+l,_t)}else{let I=function(B){const{uint16Array:O,uint32Array:v}=ge;let F=B*2;for(;!ze(F,O);)B=qe(B),F=B*2;return ke(B,v)},d=function(B){const{uint16Array:O,uint32Array:v}=ge;let F=B*2;for(;!ze(F,O);)B=Qe(B,v),F=B*2;return ke(B,v)+$e(F,O)};const u=qe(l),f=Qe(l,c);let E=u,C=f,T,R,A,m;if(i&&(A=_t,m=as,Oe(E,o,A),Oe(C,o,m),T=i(A),R=i(m),R<T)){E=f,C=u;const B=T;T=R,R=B,A=m}A||(A=_t,Oe(E,o,A));const S=ze(E*2,a),N=t(A,S,T,r+1,n+E);let y;if(N===fr){const B=I(E),O=d(E)-B;y=s(B,O,!0,r+1,n+E,A)}else y=N&&hn(E,e,t,s,i,n,r+1);if(y)return!0;m=as,Oe(C,o,m);const P=ze(C*2,a),_=t(m,P,R,r+1,n+C);let M;if(_===fr){const B=I(C),O=d(C)-B;M=s(B,O,!0,r+1,n+C,m)}else M=_&&hn(C,e,t,s,i,n,r+1);return!!M}}const Rs=new U,Xi=new U;function Dl(l,e,t={},s=0,i=1/0){const n=s*s,r=i*i;let o=1/0,a=null;if(l.shapecast({boundsTraverseOrder:h=>(Rs.copy(e).clamp(h.min,h.max),Rs.distanceToSquared(e)),intersectsBounds:(h,I,d)=>d<o&&d<r,intersectsTriangle:(h,I)=>{h.closestPointToPoint(e,Rs);const d=e.distanceToSquared(Rs);return d<o&&(Xi.copy(Rs),o=d,a=I),d<n}}),o===1/0)return null;const c=Math.sqrt(o);return t.point?t.point.copy(Xi):t.point=Xi.clone(),t.distance=c,t.faceIndex=a,t}const jt=new U,Zt=new U,$t=new U,Js=new He,ei=new He,ti=new He,Rr=new U,gr=new U,Fr=new U,si=new U;function bl(l,e,t,s,i,n){let r;return n===al?r=l.intersectTriangle(s,t,e,!0,i):r=l.intersectTriangle(e,t,s,n!==ks,i),r===null?null:{distance:l.origin.distanceTo(i),point:i.clone()}}function Ul(l,e,t,s,i,n,r,o,a){jt.fromBufferAttribute(e,n),Zt.fromBufferAttribute(e,r),$t.fromBufferAttribute(e,o);const c=bl(l,jt,Zt,$t,si,a);if(c){s&&(Js.fromBufferAttribute(s,n),ei.fromBufferAttribute(s,r),ti.fromBufferAttribute(s,o),c.uv=os.getInterpolation(si,jt,Zt,$t,Js,ei,ti,new He)),i&&(Js.fromBufferAttribute(i,n),ei.fromBufferAttribute(i,r),ti.fromBufferAttribute(i,o),c.uv1=os.getInterpolation(si,jt,Zt,$t,Js,ei,ti,new He)),t&&(Rr.fromBufferAttribute(t,n),gr.fromBufferAttribute(t,r),Fr.fromBufferAttribute(t,o),c.normal=os.getInterpolation(si,jt,Zt,$t,Rr,gr,Fr,new U),c.normal.dot(l.direction)>0&&c.normal.multiplyScalar(-1));const h={a:n,b:r,c:o,normal:new U,materialIndex:0};os.getNormal(jt,Zt,$t,h.normal),c.face=h,c.faceIndex=n}return c}function xi(l,e,t,s,i){const n=s*3;let r=n+0,o=n+1,a=n+2;const c=l.index;l.index&&(r=c.getX(r),o=c.getX(o),a=c.getX(a));const{position:h,normal:I,uv:d,uv1:u}=l.attributes,f=Ul(t,h,I,d,u,r,o,a,e);return f?(f.faceIndex=s,i&&i.push(f),f):null}function _e(l,e,t,s){const i=l.a,n=l.b,r=l.c;let o=e,a=e+1,c=e+2;t&&(o=t.getX(o),a=t.getX(a),c=t.getX(c)),i.x=s.getX(o),i.y=s.getY(o),i.z=s.getZ(o),n.x=s.getX(a),n.y=s.getY(a),n.z=s.getZ(a),r.x=s.getX(c),r.y=s.getY(c),r.z=s.getZ(c)}function xl(l,e,t,s,i,n){const{geometry:r,_indirectBuffer:o}=l;for(let a=s,c=s+i;a<c;a++)xi(r,e,t,a,n)}function Bl(l,e,t,s,i){const{geometry:n,_indirectBuffer:r}=l;let o=1/0,a=null;for(let c=s,h=s+i;c<h;c++){let I;I=xi(n,e,t,c),I&&I.distance<o&&(a=I,o=I.distance)}return a}function Yl(l,e,t,s,i,n,r){const{geometry:o}=t,{index:a}=o,c=o.attributes.position;for(let h=l,I=e+l;h<I;h++){let d;if(d=h,_e(r,d*3,a,c),r.needsUpdate=!0,s(r,d,i,n))return!0}return!1}function Vl(l,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=l.geometry,s=t.index?t.index.array:null,i=t.attributes.position;let n,r,o,a,c=0;const h=l._roots;for(let d=0,u=h.length;d<u;d++)n=h[d],r=new Uint32Array(n),o=new Uint16Array(n),a=new Float32Array(n),I(0,c),c+=n.byteLength;function I(d,u,f=!1){const E=d*2;if(o[E+15]===Ui){const C=r[d+6],T=o[E+14];let R=1/0,A=1/0,m=1/0,S=-1/0,N=-1/0,y=-1/0;for(let P=3*C,_=3*(C+T);P<_;P++){let M=s[P];const B=i.getX(M),O=i.getY(M),v=i.getZ(M);B<R&&(R=B),B>S&&(S=B),O<A&&(A=O),O>N&&(N=O),v<m&&(m=v),v>y&&(y=v)}return a[d+0]!==R||a[d+1]!==A||a[d+2]!==m||a[d+3]!==S||a[d+4]!==N||a[d+5]!==y?(a[d+0]=R,a[d+1]=A,a[d+2]=m,a[d+3]=S,a[d+4]=N,a[d+5]=y,!0):!1}else{const C=d+8,T=r[d+6],R=C+u,A=T+u;let m=f,S=!1,N=!1;e?m||(S=e.has(R),N=e.has(A),m=!S&&!N):(S=!0,N=!0);const y=m||S,P=m||N;let _=!1;y&&(_=I(C,u,m));let M=!1;P&&(M=I(T,u,m));const B=_||M;if(B)for(let O=0;O<3;O++){const v=C+O,F=T+O,b=a[v],Z=a[v+3],z=a[F],J=a[F+3];a[d+O]=b<z?b:z,a[d+O+3]=Z>J?Z:J}return B}}}const Sr=new Pe;function vt(l,e,t,s){return Oe(l,e,Sr),t.intersectBox(Sr,s)}function Gl(l,e,t,s,i,n){const{geometry:r,_indirectBuffer:o}=l;for(let a=s,c=s+i;a<c;a++){let h=o?o[a]:a;xi(r,e,t,h,n)}}function zl(l,e,t,s,i){const{geometry:n,_indirectBuffer:r}=l;let o=1/0,a=null;for(let c=s,h=s+i;c<h;c++){let I;I=xi(n,e,t,r?r[c]:c),I&&I.distance<o&&(a=I,o=I.distance)}return a}function kl(l,e,t,s,i,n,r){const{geometry:o}=t,{index:a}=o,c=o.attributes.position;for(let h=l,I=e+l;h<I;h++){let d;if(d=t.resolveTriangleIndex(h),_e(r,d*3,a,c),r.needsUpdate=!0,s(r,d,i,n))return!0}return!1}const Ar=new U;function Hl(l,e,t,s,i){ge.setBuffer(l._roots[e]),un(0,l,t,s,i),ge.clearBuffer()}function un(l,e,t,s,i){const{float32Array:n,uint16Array:r,uint32Array:o}=ge,a=l*2;if(ze(a,r)){const c=ke(l,o),h=$e(a,r);xl(e,t,s,c,h,i)}else{const c=qe(l);vt(c,n,s,Ar)&&un(c,e,t,s,i);const h=Qe(l,o);vt(h,n,s,Ar)&&un(h,e,t,s,i)}}const Or=new U,Wl=["x","y","z"];function Xl(l,e,t,s){ge.setBuffer(l._roots[e]);const i=dn(0,l,t,s);return ge.clearBuffer(),i}function dn(l,e,t,s){const{float32Array:i,uint16Array:n,uint32Array:r}=ge;let o=l*2;if(ze(o,n)){const a=ke(l,r),c=$e(o,n);return Bl(e,t,s,a,c)}else{const a=mo(l,r),c=Wl[a],h=s.direction[c]>=0;let I,d;h?(I=qe(l),d=Qe(l,r)):(I=Qe(l,r),d=qe(l));const u=vt(I,i,s,Or)?dn(I,e,t,s):null;if(u){const E=u.point[c];if(h?E<=i[d+a]:E>=i[d+a+3])return u}const f=vt(d,i,s,Or)?dn(d,e,t,s):null;return u&&f?u.distance<=f.distance?u:f:u||f||null}}const ii=new Pe,qt=new nt,Qt=new nt,gs=new Ee,yr=new Ve,ni=new Ve;function jl(l,e,t,s){ge.setBuffer(l._roots[e]);const i=In(0,l,t,s);return ge.clearBuffer(),i}function In(l,e,t,s,i=null){const{float32Array:n,uint16Array:r,uint32Array:o}=ge;let a=l*2;if(i===null&&(t.boundingBox||t.computeBoundingBox(),yr.set(t.boundingBox.min,t.boundingBox.max,s),i=yr),ze(a,r)){const c=e.geometry,h=c.index,I=c.attributes.position,d=t.index,u=t.attributes.position,f=ke(l,o),E=$e(a,r);if(gs.copy(s).invert(),t.boundsTree)return Oe(l,n,ni),ni.matrix.copy(gs),ni.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:C=>ni.intersectsBox(C),intersectsTriangle:C=>{C.a.applyMatrix4(s),C.b.applyMatrix4(s),C.c.applyMatrix4(s),C.needsUpdate=!0;for(let T=f*3,R=(E+f)*3;T<R;T+=3)if(_e(Qt,T,h,I),Qt.needsUpdate=!0,C.intersectsTriangle(Qt))return!0;return!1}});for(let C=f*3,T=(E+f)*3;C<T;C+=3){_e(qt,C,h,I),qt.a.applyMatrix4(gs),qt.b.applyMatrix4(gs),qt.c.applyMatrix4(gs),qt.needsUpdate=!0;for(let R=0,A=d.count;R<A;R+=3)if(_e(Qt,R,d,u),Qt.needsUpdate=!0,qt.intersectsTriangle(Qt))return!0}}else{const c=l+8,h=o[l+6];return Oe(c,n,ii),!!(i.intersectsBox(ii)&&In(c,e,t,s,i)||(Oe(h,n,ii),i.intersectsBox(ii)&&In(h,e,t,s,i)))}}const ri=new Ee,ji=new Ve,Fs=new Ve,Zl=new U,$l=new U,ql=new U,Ql=new U;function Kl(l,e,t,s={},i={},n=0,r=1/0){e.boundingBox||e.computeBoundingBox(),ji.set(e.boundingBox.min,e.boundingBox.max,t),ji.needsUpdate=!0;const o=l.geometry,a=o.attributes.position,c=o.index,h=e.attributes.position,I=e.index,d=Ze.getPrimitive(),u=Ze.getPrimitive();let f=Zl,E=$l,C=null,T=null;i&&(C=ql,T=Ql);let R=1/0,A=null,m=null;return ri.copy(t).invert(),Fs.matrix.copy(ri),l.shapecast({boundsTraverseOrder:S=>ji.distanceToBox(S),intersectsBounds:(S,N,y)=>y<R&&y<r?(N&&(Fs.min.copy(S.min),Fs.max.copy(S.max),Fs.needsUpdate=!0),!0):!1,intersectsRange:(S,N)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:y=>Fs.distanceToBox(y),intersectsBounds:(y,P,_)=>_<R&&_<r,intersectsRange:(y,P)=>{for(let _=y,M=y+P;_<M;_++){_e(u,3*_,I,h),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let B=S,O=S+N;B<O;B++){_e(d,3*B,c,a),d.needsUpdate=!0;const v=d.distanceToTriangle(u,f,C);if(v<R&&(E.copy(f),T&&T.copy(C),R=v,A=B,m=_),v<n)return!0}}}});{const y=Es(e);for(let P=0,_=y;P<_;P++){_e(u,3*P,I,h),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let M=S,B=S+N;M<B;M++){_e(d,3*M,c,a),d.needsUpdate=!0;const O=d.distanceToTriangle(u,f,C);if(O<R&&(E.copy(f),T&&T.copy(C),R=O,A=M,m=P),O<n)return!0}}}}}),Ze.releasePrimitive(d),Ze.releasePrimitive(u),R===1/0?null:(s.point?s.point.copy(E):s.point=E.clone(),s.distance=R,s.faceIndex=A,i&&(i.point?i.point.copy(T):i.point=T.clone(),i.point.applyMatrix4(ri),E.applyMatrix4(ri),i.distance=E.sub(i.point).length(),i.faceIndex=m),s)}function Jl(l,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=l.geometry,s=t.index?t.index.array:null,i=t.attributes.position;let n,r,o,a,c=0;const h=l._roots;for(let d=0,u=h.length;d<u;d++)n=h[d],r=new Uint32Array(n),o=new Uint16Array(n),a=new Float32Array(n),I(0,c),c+=n.byteLength;function I(d,u,f=!1){const E=d*2;if(o[E+15]===Ui){const C=r[d+6],T=o[E+14];let R=1/0,A=1/0,m=1/0,S=-1/0,N=-1/0,y=-1/0;for(let P=C,_=C+T;P<_;P++){const M=3*l.resolveTriangleIndex(P);for(let B=0;B<3;B++){let O=M+B;O=s?s[O]:O;const v=i.getX(O),F=i.getY(O),b=i.getZ(O);v<R&&(R=v),v>S&&(S=v),F<A&&(A=F),F>N&&(N=F),b<m&&(m=b),b>y&&(y=b)}}return a[d+0]!==R||a[d+1]!==A||a[d+2]!==m||a[d+3]!==S||a[d+4]!==N||a[d+5]!==y?(a[d+0]=R,a[d+1]=A,a[d+2]=m,a[d+3]=S,a[d+4]=N,a[d+5]=y,!0):!1}else{const C=d+8,T=r[d+6],R=C+u,A=T+u;let m=f,S=!1,N=!1;e?m||(S=e.has(R),N=e.has(A),m=!S&&!N):(S=!0,N=!0);const y=m||S,P=m||N;let _=!1;y&&(_=I(C,u,m));let M=!1;P&&(M=I(T,u,m));const B=_||M;if(B)for(let O=0;O<3;O++){const v=C+O,F=T+O,b=a[v],Z=a[v+3],z=a[F],J=a[F+3];a[d+O]=b<z?b:z,a[d+O+3]=Z>J?Z:J}return B}}}const Nr=new U;function ec(l,e,t,s,i){ge.setBuffer(l._roots[e]),En(0,l,t,s,i),ge.clearBuffer()}function En(l,e,t,s,i){const{float32Array:n,uint16Array:r,uint32Array:o}=ge,a=l*2;if(ze(a,r)){const c=ke(l,o),h=$e(a,r);Gl(e,t,s,c,h,i)}else{const c=qe(l);vt(c,n,s,Nr)&&En(c,e,t,s,i);const h=Qe(l,o);vt(h,n,s,Nr)&&En(h,e,t,s,i)}}const Lr=new U,tc=["x","y","z"];function sc(l,e,t,s){ge.setBuffer(l._roots[e]);const i=fn(0,l,t,s);return ge.clearBuffer(),i}function fn(l,e,t,s){const{float32Array:i,uint16Array:n,uint32Array:r}=ge;let o=l*2;if(ze(o,n)){const a=ke(l,r),c=$e(o,n);return zl(e,t,s,a,c)}else{const a=mo(l,r),c=tc[a],h=s.direction[c]>=0;let I,d;h?(I=qe(l),d=Qe(l,r)):(I=Qe(l,r),d=qe(l));const u=vt(I,i,s,Lr)?fn(I,e,t,s):null;if(u){const E=u.point[c];if(h?E<=i[d+a]:E>=i[d+a+3])return u}const f=vt(d,i,s,Lr)?fn(d,e,t,s):null;return u&&f?u.distance<=f.distance?u:f:u||f||null}}const oi=new Pe,Kt=new nt,Jt=new nt,Ss=new Ee,_r=new Ve,ai=new Ve;function ic(l,e,t,s){ge.setBuffer(l._roots[e]);const i=pn(0,l,t,s);return ge.clearBuffer(),i}function pn(l,e,t,s,i=null){const{float32Array:n,uint16Array:r,uint32Array:o}=ge;let a=l*2;if(i===null&&(t.boundingBox||t.computeBoundingBox(),_r.set(t.boundingBox.min,t.boundingBox.max,s),i=_r),ze(a,r)){const c=e.geometry,h=c.index,I=c.attributes.position,d=t.index,u=t.attributes.position,f=ke(l,o),E=$e(a,r);if(Ss.copy(s).invert(),t.boundsTree)return Oe(l,n,ai),ai.matrix.copy(Ss),ai.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:C=>ai.intersectsBox(C),intersectsTriangle:C=>{C.a.applyMatrix4(s),C.b.applyMatrix4(s),C.c.applyMatrix4(s),C.needsUpdate=!0;for(let T=f,R=E+f;T<R;T++)if(_e(Jt,3*e.resolveTriangleIndex(T),h,I),Jt.needsUpdate=!0,C.intersectsTriangle(Jt))return!0;return!1}});for(let C=f,T=E+f;C<T;C++){const R=e.resolveTriangleIndex(C);_e(Kt,3*R,h,I),Kt.a.applyMatrix4(Ss),Kt.b.applyMatrix4(Ss),Kt.c.applyMatrix4(Ss),Kt.needsUpdate=!0;for(let A=0,m=d.count;A<m;A+=3)if(_e(Jt,A,d,u),Jt.needsUpdate=!0,Kt.intersectsTriangle(Jt))return!0}}else{const c=l+8,h=o[l+6];return Oe(c,n,oi),!!(i.intersectsBox(oi)&&pn(c,e,t,s,i)||(Oe(h,n,oi),i.intersectsBox(oi)&&pn(h,e,t,s,i)))}}const li=new Ee,Zi=new Ve,As=new Ve,nc=new U,rc=new U,oc=new U,ac=new U;function lc(l,e,t,s={},i={},n=0,r=1/0){e.boundingBox||e.computeBoundingBox(),Zi.set(e.boundingBox.min,e.boundingBox.max,t),Zi.needsUpdate=!0;const o=l.geometry,a=o.attributes.position,c=o.index,h=e.attributes.position,I=e.index,d=Ze.getPrimitive(),u=Ze.getPrimitive();let f=nc,E=rc,C=null,T=null;i&&(C=oc,T=ac);let R=1/0,A=null,m=null;return li.copy(t).invert(),As.matrix.copy(li),l.shapecast({boundsTraverseOrder:S=>Zi.distanceToBox(S),intersectsBounds:(S,N,y)=>y<R&&y<r?(N&&(As.min.copy(S.min),As.max.copy(S.max),As.needsUpdate=!0),!0):!1,intersectsRange:(S,N)=>{if(e.boundsTree){const y=e.boundsTree;return y.shapecast({boundsTraverseOrder:P=>As.distanceToBox(P),intersectsBounds:(P,_,M)=>M<R&&M<r,intersectsRange:(P,_)=>{for(let M=P,B=P+_;M<B;M++){const O=y.resolveTriangleIndex(M);_e(u,3*O,I,h),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let v=S,F=S+N;v<F;v++){const b=l.resolveTriangleIndex(v);_e(d,3*b,c,a),d.needsUpdate=!0;const Z=d.distanceToTriangle(u,f,C);if(Z<R&&(E.copy(f),T&&T.copy(C),R=Z,A=v,m=M),Z<n)return!0}}}})}else{const y=Es(e);for(let P=0,_=y;P<_;P++){_e(u,3*P,I,h),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let M=S,B=S+N;M<B;M++){const O=l.resolveTriangleIndex(M);_e(d,3*O,c,a),d.needsUpdate=!0;const v=d.distanceToTriangle(u,f,C);if(v<R&&(E.copy(f),T&&T.copy(C),R=v,A=M,m=P),v<n)return!0}}}}}),Ze.releasePrimitive(d),Ze.releasePrimitive(u),R===1/0?null:(s.point?s.point.copy(E):s.point=E.clone(),s.distance=R,s.faceIndex=A,i&&(i.point?i.point.copy(T):i.point=T.clone(),i.point.applyMatrix4(li),E.applyMatrix4(li),i.distance=E.sub(i.point).length(),i.faceIndex=m),s)}function cc(){return typeof SharedArrayBuffer<"u"}const Bs=new ge.constructor,_i=new ge.constructor,Lt=new Kn(()=>new Pe),es=new Pe,ts=new Pe,$i=new Pe,qi=new Pe;let Qi=!1;function hc(l,e,t,s){if(Qi)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");Qi=!0;const i=l._roots,n=e._roots;let r,o=0,a=0;const c=new Ee().copy(t).invert();for(let h=0,I=i.length;h<I;h++){Bs.setBuffer(i[h]),a=0;const d=Lt.getPrimitive();Oe(0,Bs.float32Array,d),d.applyMatrix4(c);for(let u=0,f=n.length;u<f&&(_i.setBuffer(n[h]),r=Je(0,0,t,c,s,o,a,0,0,d),_i.clearBuffer(),a+=n[u].length,!r);u++);if(Lt.releasePrimitive(d),Bs.clearBuffer(),o+=i[h].length,r)break}return Qi=!1,r}function Je(l,e,t,s,i,n=0,r=0,o=0,a=0,c=null,h=!1){let I,d;h?(I=_i,d=Bs):(I=Bs,d=_i);const u=I.float32Array,f=I.uint32Array,E=I.uint16Array,C=d.float32Array,T=d.uint32Array,R=d.uint16Array,A=l*2,m=e*2,S=ze(A,E),N=ze(m,R);let y=!1;if(N&&S)h?y=i(ke(e,T),$e(e*2,R),ke(l,f),$e(l*2,E),a,r+e,o,n+l):y=i(ke(l,f),$e(l*2,E),ke(e,T),$e(e*2,R),o,n+l,a,r+e);else if(N){const P=Lt.getPrimitive();Oe(e,C,P),P.applyMatrix4(t);const _=qe(l),M=Qe(l,f);Oe(_,u,es),Oe(M,u,ts);const B=P.intersectsBox(es),O=P.intersectsBox(ts);y=B&&Je(e,_,s,t,i,r,n,a,o+1,P,!h)||O&&Je(e,M,s,t,i,r,n,a,o+1,P,!h),Lt.releasePrimitive(P)}else{const P=qe(e),_=Qe(e,T);Oe(P,C,$i),Oe(_,C,qi);const M=c.intersectsBox($i),B=c.intersectsBox(qi);if(M&&B)y=Je(l,P,t,s,i,n,r,o,a+1,c,h)||Je(l,_,t,s,i,n,r,o,a+1,c,h);else if(M)if(S)y=Je(l,P,t,s,i,n,r,o,a+1,c,h);else{const O=Lt.getPrimitive();O.copy($i).applyMatrix4(t);const v=qe(l),F=Qe(l,f);Oe(v,u,es),Oe(F,u,ts);const b=O.intersectsBox(es),Z=O.intersectsBox(ts);y=b&&Je(P,v,s,t,i,r,n,a,o+1,O,!h)||Z&&Je(P,F,s,t,i,r,n,a,o+1,O,!h),Lt.releasePrimitive(O)}else if(B)if(S)y=Je(l,_,t,s,i,n,r,o,a+1,c,h);else{const O=Lt.getPrimitive();O.copy(qi).applyMatrix4(t);const v=qe(l),F=Qe(l,f);Oe(v,u,es),Oe(F,u,ts);const b=O.intersectsBox(es),Z=O.intersectsBox(ts);y=b&&Je(_,v,s,t,i,r,n,a,o+1,O,!h)||Z&&Je(_,F,s,t,i,r,n,a,o+1,O,!h),Lt.releasePrimitive(O)}}return y}const ci=new Ve,wr=new Pe;class Jn{static serialize(e,t={}){t={cloneBuffers:!0,...t};const s=e.geometry,i=e._roots,n=e._indirectBuffer,r=s.getIndex();let o;return t.cloneBuffers?o={roots:i.map(a=>a.slice()),index:r.array.slice(),indirectBuffer:n?n.slice():null}:o={roots:i,index:r.array,indirectBuffer:n},o}static deserialize(e,t,s={}){s={setIndex:!0,indirect:!!e.indirectBuffer,...s};const{index:i,roots:n,indirectBuffer:r}=e,o=new Jn(t,{...s,[ki]:!0});if(o._roots=n,o._indirectBuffer=r||null,s.setIndex){const a=t.getIndex();if(a===null){const c=new Gs(e.index,1,!1);t.setIndex(c)}else a.array!==i&&(a.array.set(i),a.needsUpdate=!0)}return o}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({strategy:po,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[ki]:!1},t),t.useSharedArrayBuffer&&!cc())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[ki]||(Nl(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Pe)));const{_indirectBuffer:s}=this;this.resolveTriangleIndex=t.indirect?i=>s[i]:i=>i}refit(e=null){return(this.indirect?Jl:Vl)(this,e)}traverse(e,t=0){const s=this._roots[t],i=new Uint32Array(s),n=new Uint16Array(s);r(0);function r(o,a=0){const c=o*2,h=n[c+15]===Ui;if(h){const I=i[o+6],d=n[c+14];e(a,h,new Float32Array(s,o*4,6),I,d)}else{const I=o+gi/4,d=i[o+6],u=i[o+7];e(a,h,new Float32Array(s,o*4,6),u)||(r(I,a+1),r(d,a+1))}}}raycast(e,t=Ir){const s=this._roots,i=this.geometry,n=[],r=t.isMaterial,o=Array.isArray(t),a=i.groups,c=r?t.side:t,h=this.indirect?ec:Hl;for(let I=0,d=s.length;I<d;I++){const u=o?t[a[I].materialIndex].side:c,f=n.length;if(h(this,I,u,e,n),o){const E=a[I].materialIndex;for(let C=f,T=n.length;C<T;C++)n[C].face.materialIndex=E}}return n}raycastFirst(e,t=Ir){const s=this._roots,i=this.geometry,n=t.isMaterial,r=Array.isArray(t);let o=null;const a=i.groups,c=n?t.side:t,h=this.indirect?sc:Xl;for(let I=0,d=s.length;I<d;I++){const u=r?t[a[I].materialIndex].side:c,f=h(this,I,u,e);f!=null&&(o==null||f.distance<o.distance)&&(o=f,r&&(f.face.materialIndex=a[I].materialIndex))}return o}intersectsGeometry(e,t){let s=!1;const i=this._roots,n=this.indirect?ic:jl;for(let r=0,o=i.length;r<o&&(s=n(this,r,e,t),!s);r++);return s}shapecast(e){const t=Ze.getPrimitive(),s=this.indirect?kl:Yl;let{boundsTraverseOrder:i,intersectsBounds:n,intersectsRange:r,intersectsTriangle:o}=e;if(r&&o){const I=r;r=(d,u,f,E,C)=>I(d,u,f,E,C)?!0:s(d,u,this,o,f,E,t)}else r||(o?r=(I,d,u,f)=>s(I,d,this,o,u,f,t):r=(I,d,u)=>u);let a=!1,c=0;const h=this._roots;for(let I=0,d=h.length;I<d;I++){const u=h[I];if(a=Ml(this,I,n,r,i,c),a)break;c+=u.byteLength}return Ze.releasePrimitive(t),a}bvhcast(e,t,s){let{intersectsRanges:i,intersectsTriangles:n}=s;const r=Ze.getPrimitive(),o=this.geometry.index,a=this.geometry.attributes.position,c=this.indirect?f=>{const E=this.resolveTriangleIndex(f);_e(r,E*3,o,a)}:f=>{_e(r,f*3,o,a)},h=Ze.getPrimitive(),I=e.geometry.index,d=e.geometry.attributes.position,u=e.indirect?f=>{const E=e.resolveTriangleIndex(f);_e(h,E*3,I,d)}:f=>{_e(h,f*3,I,d)};if(n){const f=(E,C,T,R,A,m,S,N)=>{for(let y=T,P=T+R;y<P;y++){u(y),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let _=E,M=E+C;_<M;_++)if(c(_),r.needsUpdate=!0,n(r,h,_,y,A,m,S,N))return!0}return!1};if(i){const E=i;i=function(C,T,R,A,m,S,N,y){return E(C,T,R,A,m,S,N,y)?!0:f(C,T,R,A,m,S,N,y)}}else i=f}return hc(this,e,t,i)}intersectsBox(e,t){return ci.set(e.min,e.max,t),ci.needsUpdate=!0,this.shapecast({intersectsBounds:s=>ci.intersectsBox(s),intersectsTriangle:s=>ci.intersectsTriangle(s)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,s={},i={},n=0,r=1/0){return(this.indirect?lc:Kl)(this,e,t,s,i,n,r)}closestPointToPoint(e,t={},s=0,i=1/0){return Dl(this,e,t,s,i)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{Oe(0,new Float32Array(t),wr),e.union(wr)}),e}}function Pr(l,e,t){return l===null||(l.point.applyMatrix4(e.matrixWorld),l.distance=l.point.distanceTo(t.ray.origin),l.object=e,l.distance<t.near||l.distance>t.far)?null:l}const Ki=new Ja,vr=new Ee,uc=se.prototype.raycast;function dc(l,e){if(this.geometry.boundsTree){if(this.material===void 0)return;vr.copy(this.matrixWorld).invert(),Ki.copy(l.ray).applyMatrix4(vr);const t=this.geometry.boundsTree;if(l.firstHitOnly===!0){const s=Pr(t.raycastFirst(Ki,this.material),this,l);s&&e.push(s)}else{const s=t.raycast(Ki,this.material);for(let i=0,n=s.length;i<n;i++){const r=Pr(s[i],this,l);r&&e.push(r)}}}else uc.call(this,l,e)}function Ic(l){return this.boundsTree=new Jn(this,l),this.boundsTree}function Ec(){this.boundsTree=null}class ${constructor(){p(this,"trigger",e=>{const t=this.handlers.slice(0);for(const s of t)s(e)}),p(this,"handlers",[])}add(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}reset(){this.handlers.length=0}}class wt{constructor(){p(this,"trigger",async e=>{const t=this.handlers.slice(0);for(const s of t)await s(e)}),p(this,"handlers",[])}add(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}reset(){this.handlers.length=0}}class er{constructor(e){p(this,"isDisposeable",()=>"dispose"in this&&"onDisposed"in this),p(this,"isResizeable",()=>"resize"in this&&"getSize"in this),p(this,"isUpdateable",()=>"onAfterUpdate"in this&&"onBeforeUpdate"in this&&"update"in this),p(this,"isHideable",()=>"visible"in this),p(this,"isConfigurable",()=>"setup"in this&&"config"in this&&"onSetup"in this),this.components=e}}class Ae extends er{}class tr extends er{constructor(e){super(e),p(this,"worlds",new Map),p(this,"onWorldChanged",new $),p(this,"currentWorld",null),this.onWorldChanged.add(({world:t,action:s})=>{s==="removed"&&this.worlds.delete(t.uuid)})}}class fc extends tr{constructor(){super(...arguments),p(this,"hasCameraControls",()=>"controls"in this)}}class pc extends tr{constructor(){super(...arguments),p(this,"onAfterUpdate",new $),p(this,"onBeforeUpdate",new $),p(this,"onDisposed",new $),p(this,"onResize",new $),p(this,"onClippingPlanesUpdated",new $),p(this,"clippingPlanes",[])}updateClippingPlanes(){this.onClippingPlanesUpdated.trigger()}setPlane(e,t,s){t.isLocal=s;const i=this.clippingPlanes.indexOf(t);e&&i===-1?this.clippingPlanes.push(t):!e&&i>-1&&this.clippingPlanes.splice(i,1),this.three.clippingPlanes=this.clippingPlanes.filter(n=>!n.isLocal)}}const Ro=class Cn extends Ae{constructor(e){super(e),p(this,"_disposedComponents",new Set),p(this,"enabled",!0),e.add(Cn.uuid,this)}get(){return this._disposedComponents}destroy(e,t=!0,s=!0){e.removeFromParent();const i=e;i.dispose&&i.dispose(),this.disposeGeometryAndMaterials(e,t),s&&i.children&&i.children.length&&this.disposeChildren(i),e.children.length=0}disposeGeometry(e){e.boundsTree&&e.disposeBoundsTree&&e.disposeBoundsTree(),e.dispose()}disposeGeometryAndMaterials(e,t){const s=e;s.geometry&&this.disposeGeometry(s.geometry),t&&s.material&&Cn.disposeMaterial(s),s.material=[],s.geometry=null}disposeChildren(e){for(const t of e.children)this.destroy(t)}static disposeMaterial(e){if(e.material)if(Array.isArray(e.material))for(const t of e.material)t.dispose();else e.material.dispose()}};p(Ro,"uuid","76e9cd8e-ad8f-4753-9ef6-cbc60f7247fe");let ds=Ro;class Cc extends tr{constructor(e){super(e),p(this,"onDisposed",new $),p(this,"directionalLights",new Map),p(this,"ambientLights",new Map)}dispose(){const e=this.components.get(ds);for(const t of this.three.children){const s=t;s.geometry&&e.destroy(s)}this.deleteAllLights(),this.three.children=[],this.onDisposed.trigger(),this.onDisposed.reset()}deleteAllLights(){for(const[,e]of this.directionalLights)e.removeFromParent(),e.target.removeFromParent(),e.dispose();this.directionalLights.clear();for(const[,e]of this.ambientLights)e.removeFromParent(),e.dispose();this.ambientLights.clear()}}class Pt extends Set{constructor(e){super(e),p(this,"onItemAdded",new $),p(this,"onItemDeleted",new $),p(this,"onCleared",new $),p(this,"guard",()=>!0)}clear(){super.clear(),this.onCleared.trigger()}add(...e){for(const t of e)this.has(t)||!this.guard(t)||(super.add(t),this.onItemAdded||(this.onItemAdded=new $),this.onItemAdded.trigger(t));return this}delete(e){const t=super.delete(e);return t&&this.onItemDeleted.trigger(),t}dispose(){this.clear(),this.onItemAdded.reset(),this.onItemDeleted.reset(),this.onCleared.reset()}}class rt extends Map{constructor(e){super(e),p(this,"onItemSet",new $),p(this,"onItemUpdated",new $),p(this,"onItemDeleted",new $),p(this,"onCleared",new $),p(this,"guard",()=>!0)}clear(){super.clear(),this.onCleared.trigger()}set(e,t){const s=this.has(e);if(!(this.guard??(()=>!0))(e,t))return this;const i=super.set(e,t);return s?(this.onItemUpdated||(this.onItemUpdated=new $),this.onItemUpdated.trigger({key:e,value:t})):(this.onItemSet||(this.onItemSet=new $),this.onItemSet.trigger({key:e,value:t})),i}delete(e){const t=super.delete(e);return t&&this.onItemDeleted.trigger(e),t}dispose(){this.clear(),this.onItemSet.reset(),this.onItemDeleted.reset(),this.onCleared.reset()}}const Fi=0,Tc=1,mc=new U,Mr=new it,Ji=new Is,Dr=new U,hi=new os;class Rc{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new br,this.unassigned=new br,this.vertices=[]}setFromPoints(e){if(e.length>=4){this.makeEmpty();for(let t=0,s=e.length;t<s;t++)this.vertices.push(new gc(e[t]));this.compute()}return this}setFromObject(e){const t=[];return e.updateMatrixWorld(!0),e.traverse(function(s){const i=s.geometry;if(i!==void 0){const n=i.attributes.position;if(n!==void 0)for(let r=0,o=n.count;r<o;r++){const a=new U;a.fromBufferAttribute(n,r).applyMatrix4(s.matrixWorld),t.push(a)}}}),this.setFromPoints(t)}containsPoint(e){const t=this.faces;for(let s=0,i=t.length;s<i;s++)if(t[s].distanceToPoint(e)>this.tolerance)return!1;return!0}intersectRay(e,t){const s=this.faces;let i=-1/0,n=1/0;for(let r=0,o=s.length;r<o;r++){const a=s[r],c=a.distanceToPoint(e.origin),h=a.normal.dot(e.direction);if(c>0&&h>=0)return null;const I=h!==0?-c/h:0;if(!(I<=0)&&(h>0?n=Math.min(I,n):i=Math.max(I,i),i>n))return null}return i!==-1/0?e.at(i,t):e.at(n,t),t}intersectsRay(e){return this.intersectRay(e,mc)!==null}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(e,t){return e.face=t,t.outside===null?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this}removeVertexFromFace(e,t){return e===t.outside&&(e.next!==null&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this}removeAllVerticesFromFace(e){if(e.outside!==null){const t=e.outside;let s=e.outside;for(;s.next!==null&&s.next.face===e;)s=s.next;return this.assigned.removeSubList(t,s),t.prev=s.next=null,e.outside=null,t}}deleteFaceVertices(e,t){const s=this.removeAllVerticesFromFace(e);if(s!==void 0)if(t===void 0)this.unassigned.appendChain(s);else{let i=s;do{const n=i.next;t.distanceToPoint(i.point)>this.tolerance?this.addVertexToFace(i,t):this.unassigned.append(i),i=n}while(i!==null)}return this}resolveUnassignedPoints(e){if(this.unassigned.isEmpty()===!1){let t=this.unassigned.first();do{const s=t.next;let i=this.tolerance,n=null;for(let r=0;r<e.length;r++){const o=e[r];if(o.mark===Fi){const a=o.distanceToPoint(t.point);if(a>i&&(i=a,n=o),i>1e3*this.tolerance)break}}n!==null&&this.addVertexToFace(t,n),t=s}while(t!==null)}return this}computeExtremes(){const e=new U,t=new U,s=[],i=[];for(let n=0;n<3;n++)s[n]=i[n]=this.vertices[0];e.copy(this.vertices[0].point),t.copy(this.vertices[0].point);for(let n=0,r=this.vertices.length;n<r;n++){const o=this.vertices[n],a=o.point;for(let c=0;c<3;c++)a.getComponent(c)<e.getComponent(c)&&(e.setComponent(c,a.getComponent(c)),s[c]=o);for(let c=0;c<3;c++)a.getComponent(c)>t.getComponent(c)&&(t.setComponent(c,a.getComponent(c)),i[c]=o)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(e.x),Math.abs(t.x))+Math.max(Math.abs(e.y),Math.abs(t.y))+Math.max(Math.abs(e.z),Math.abs(t.z))),{min:s,max:i}}computeInitialHull(){const e=this.vertices,t=this.computeExtremes(),s=t.min,i=t.max;let n=0,r=0;for(let d=0;d<3;d++){const u=i[d].point.getComponent(d)-s[d].point.getComponent(d);u>n&&(n=u,r=d)}const o=s[r],a=i[r];let c,h;n=0,Mr.set(o.point,a.point);for(let d=0,u=this.vertices.length;d<u;d++){const f=e[d];if(f!==o&&f!==a){Mr.closestPointToPoint(f.point,!0,Dr);const E=Dr.distanceToSquared(f.point);E>n&&(n=E,c=f)}}n=-1,Ji.setFromCoplanarPoints(o.point,a.point,c.point);for(let d=0,u=this.vertices.length;d<u;d++){const f=e[d];if(f!==o&&f!==a&&f!==c){const E=Math.abs(Ji.distanceToPoint(f.point));E>n&&(n=E,h=f)}}const I=[];if(Ji.distanceToPoint(h.point)<0){I.push(tt.create(o,a,c),tt.create(h,a,o),tt.create(h,c,a),tt.create(h,o,c));for(let d=0;d<3;d++){const u=(d+1)%3;I[d+1].getEdge(2).setTwin(I[0].getEdge(u)),I[d+1].getEdge(1).setTwin(I[u+1].getEdge(0))}}else{I.push(tt.create(o,c,a),tt.create(h,o,a),tt.create(h,a,c),tt.create(h,c,o));for(let d=0;d<3;d++){const u=(d+1)%3;I[d+1].getEdge(2).setTwin(I[0].getEdge((3-d)%3)),I[d+1].getEdge(0).setTwin(I[u+1].getEdge(1))}}for(let d=0;d<4;d++)this.faces.push(I[d]);for(let d=0,u=e.length;d<u;d++){const f=e[d];if(f!==o&&f!==a&&f!==c&&f!==h){n=this.tolerance;let E=null;for(let C=0;C<4;C++){const T=this.faces[C].distanceToPoint(f.point);T>n&&(n=T,E=this.faces[C])}E!==null&&this.addVertexToFace(f,E)}}return this}reindexFaces(){const e=[];for(let t=0;t<this.faces.length;t++){const s=this.faces[t];s.mark===Fi&&e.push(s)}return this.faces=e,this}nextVertexToAdd(){if(this.assigned.isEmpty()===!1){let e,t=0;const s=this.assigned.first().face;let i=s.outside;do{const n=s.distanceToPoint(i.point);n>t&&(t=n,e=i),i=i.next}while(i!==null&&i.face===s);return e}}computeHorizon(e,t,s,i){this.deleteFaceVertices(s),s.mark=Tc;let n;t===null?n=t=s.getEdge(0):n=t.next;do{const r=n.twin,o=r.face;o.mark===Fi&&(o.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,r,o,i):i.push(n)),n=n.next}while(n!==t);return this}addAdjoiningFace(e,t){const s=tt.create(e,t.tail(),t.head());return this.faces.push(s),s.getEdge(-1).setTwin(t.twin),s.getEdge(0)}addNewFaces(e,t){this.newFaces=[];let s=null,i=null;for(let n=0;n<t.length;n++){const r=t[n],o=this.addAdjoiningFace(e,r);s===null?s=o:o.next.setTwin(i),this.newFaces.push(o.face),i=o}return s.next.setTwin(i),this}addVertexToHull(e){const t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let e;for(this.computeInitialHull();(e=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}}class tt{constructor(){this.normal=new U,this.midpoint=new U,this.area=0,this.constant=0,this.outside=null,this.mark=Fi,this.edge=null}static create(e,t,s){const i=new tt,n=new en(e,i),r=new en(t,i),o=new en(s,i);return n.next=o.prev=r,r.next=n.prev=o,o.next=r.prev=n,i.edge=n,i.compute()}getEdge(e){let t=this.edge;for(;e>0;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t}compute(){const e=this.edge.tail(),t=this.edge.head(),s=this.edge.next.head();return hi.set(e.point,t.point,s.point),hi.getNormal(this.normal),hi.getMidpoint(this.midpoint),this.area=hi.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(e){return this.normal.dot(e)-this.constant}}class en{constructor(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const e=this.head(),t=this.tail();return t!==null?t.point.distanceTo(e.point):-1}lengthSquared(){const e=this.head(),t=this.tail();return t!==null?t.point.distanceToSquared(e.point):-1}setTwin(e){return this.twin=e,e.twin=this,this}}class gc{constructor(e){this.point=e,this.prev=null,this.next=null,this.face=null}}class br{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(e,t){return t.prev=e.prev,t.next=e,t.prev===null?this.head=t:t.prev.next=t,e.prev=t,this}insertAfter(e,t){return t.prev=e,t.next=e.next,t.next===null?this.tail=t:t.next.prev=t,e.next=t,this}append(e){return this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this}appendChain(e){for(this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail;e.next!==null;)e=e.next;return this.tail=e,this}remove(e){return e.prev===null?this.head=e.next:e.prev.next=e.next,e.next===null?this.tail=e.prev:e.next.prev=e.prev,this}removeSubList(e,t){return e.prev===null?this.head=t.next:e.prev.next=t.next,t.next===null?this.tail=e.prev:t.next.prev=e.prev,this}isEmpty(){return this.head===null}}const Tn=[2,2,1],mn=[1,0,0];function ut(l,e){return l*3+e}function Fc(l){const e=l.elements;let t=0;for(let s=0;s<9;s++)t+=e[s]*e[s];return Math.sqrt(t)}function Sc(l){const e=l.elements;let t=0;for(let s=0;s<3;s++){const i=e[ut(Tn[s],mn[s])];t+=2*i*i}return Math.sqrt(t)}function Ac(l,e){let t=0,s=1;const i=l.elements;for(let c=0;c<3;c++){const h=Math.abs(i[ut(Tn[c],mn[c])]);h>t&&(t=h,s=c)}let n=1,r=0;const o=mn[s],a=Tn[s];if(Math.abs(i[ut(a,o)])>Number.EPSILON){const c=i[ut(a,a)],h=i[ut(o,o)],I=i[ut(a,o)],d=(c-h)/2/I;let u;d<0?u=-1/(-d+Math.sqrt(1+d*d)):u=1/(d+Math.sqrt(1+d*d)),n=1/Math.sqrt(1+u*u),r=u*n}return e.identity(),e.elements[ut(o,o)]=n,e.elements[ut(a,a)]=n,e.elements[ut(a,o)]=r,e.elements[ut(o,a)]=-r,e}function Oc(l,e){let t=0,s=0;const i=10;e.unitary.identity(),e.diagonal.copy(l);const n=e.unitary,r=e.diagonal,o=new Yt,a=new Yt,c=Number.EPSILON*Fc(r);for(;s<i&&Sc(r)>c;)Ac(r,o),a.copy(o).transpose(),r.multiply(o),r.premultiply(a),n.multiply(o),++t>2&&(s++,t=0);return e}function yc(l){const e=[];for(let re=0;re<l.length-2;re+=3){const ue=l[re],he=l[re+1],pe=l[re+2];e.push(new U(ue,he,pe))}const t=new Rc;t.setFromPoints(e);const s={unitary:new Yt,diagonal:new Yt},i=t.faces,n=[],r=[];for(let re=0,ue=i.length;re<ue;re++){const he=i[re];let pe=he.edge;n.length=0;do n.push(pe),pe=pe.next;while(pe!==he.edge);const We=n.length-2;for(let ve=1,g=We;ve<=g;ve++){const H=n[0].vertex,G=n[ve+0].vertex,w=n[ve+1].vertex;r.push(H.point.x,H.point.y,H.point.z),r.push(G.point.x,G.point.y,G.point.z),r.push(w.point.x,w.point.y,w.point.z)}}const o=new U,a=new U,c=new U,h=new U,I=new U,d=new U,u=new U,f=new U;let E=0,C=0,T=0,R=0,A=0,m=0,S=0;for(let re=0,ue=r.length;re<ue;re+=9){o.fromArray(r,re),a.fromArray(r,re+3),c.fromArray(r,re+6),u.set(0,0,0),u.add(o).add(a).add(c).divideScalar(3),h.subVectors(a,o),I.subVectors(c,o);const he=d.crossVectors(h,I).length()/2;f.add(d.copy(u).multiplyScalar(he)),E+=he,C+=(9*u.x*u.x+o.x*o.x+a.x*a.x+c.x*c.x)*(he/12),T+=(9*u.x*u.y+o.x*o.y+a.x*a.y+c.x*c.y)*(he/12),R+=(9*u.x*u.z+o.x*o.z+a.x*a.z+c.x*c.z)*(he/12),A+=(9*u.y*u.y+o.y*o.y+a.y*a.y+c.y*c.y)*(he/12),m+=(9*u.y*u.z+o.y*o.z+a.y*a.z+c.y*c.z)*(he/12),S+=(9*u.z*u.z+o.z*o.z+a.z*a.z+c.z*c.z)*(he/12)}f.divideScalar(E),C/=E,T/=E,R/=E,A/=E,m/=E,S/=E,C-=f.x*f.x,T-=f.x*f.y,R-=f.x*f.z,A-=f.y*f.y,m-=f.y*f.z,S-=f.z*f.z;const N=new Yt;N.elements[0]=C,N.elements[1]=T,N.elements[2]=R,N.elements[3]=T,N.elements[4]=A,N.elements[5]=m,N.elements[6]=R,N.elements[7]=m,N.elements[8]=S,Oc(N,s);const y=s.unitary,P=new U,_=new U,M=new U;y.extractBasis(P,_,M);let B=-1/0,O=-1/0,v=-1/0,F=1/0,b=1/0,Z=1/0;for(let re=0,ue=e.length;re<ue;re++){const he=e[re];B=Math.max(P.dot(he),B),O=Math.max(_.dot(he),O),v=Math.max(M.dot(he),v),F=Math.min(P.dot(he),F),b=Math.min(_.dot(he),b),Z=Math.min(M.dot(he),Z)}P.multiplyScalar(.5*(F+B)),_.multiplyScalar(.5*(b+O)),M.multiplyScalar(.5*(Z+v));const z=new U,J=new U,X=new Yt;z.add(P).add(_).add(M),J.x=B-F,J.y=O-b,J.z=v-Z,J.multiplyScalar(.5),X.copy(y);const{x:ne,y:V,z:Y}=J,ie=new Ee;ie.makeScale(ne*2,V*2,Y*2);const ee=new Ee;ee.makeTranslation(-ne,-V,-Y);const K=new Ee;K.makeTranslation(z.x,z.y,z.z);const Fe=new Ee;Fe.setFromMatrix3(X);const ye=new Ee;return ye.multiply(K),ye.multiply(Fe),ye.multiply(ee),ye.multiply(ie),{center:z,halfSizes:J,rotation:X,transformation:ye}}class Ur{static isTransparent(e){return e.transparent&&e.opacity<1}}const Rn=class we{static create(){const e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,s=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return`${we._lut[e&255]+we._lut[e>>8&255]+we._lut[e>>16&255]+we._lut[e>>24&255]}-${we._lut[t&255]}${we._lut[t>>8&255]}-${we._lut[t>>16&15|64]}${we._lut[t>>24&255]}-${we._lut[s&63|128]}${we._lut[s>>8&255]}-${we._lut[s>>16&255]}${we._lut[s>>24&255]}${we._lut[i&255]}${we._lut[i>>8&255]}${we._lut[i>>16&255]}${we._lut[i>>24&255]}`.toLowerCase()}static validate(e){if(!we._pattern.test(e))throw new Error(`${e} is not a valid UUID v4.

- If you're the tool creator, you can take one from https://www.uuidgenerator.net/.

- If you're using a platform tool, verify the uuid isn't misspelled or contact the tool creator.`)}};p(Rn,"_pattern",/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/),p(Rn,"_lut",["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"]);let gt=Rn;const go=class Fo{constructor(){p(this,"onDisposed",new $),p(this,"list",new Map),p(this,"enabled",!1),p(this,"_clock"),p(this,"onInit",new $),p(this,"update",()=>{if(!this.enabled)return;const e=this._clock.getDelta();for(const[t,s]of this.list)s.enabled&&s.isUpdateable()&&s.update(e);requestAnimationFrame(this.update)}),this._clock=new ba,Fo.setupBVH()}add(e,t){if(this.list.has(e))throw new Error("You're trying to add a component that already exists in the components instance. Use Components.get() instead.");gt.validate(e),this.list.set(e,t)}get(e){const t=e.uuid;if(!this.list.has(t)){const s=new e(this);return this.list.has(t)||this.add(t,s),s}return this.list.get(t)}init(){this.enabled=!0,this._clock.start(),this.update(),this.onInit.trigger()}dispose(){this.enabled=!1;for(const[e,t]of this.list)t.enabled=!1,t.isDisposeable()&&t.dispose();this._clock.stop(),this.onDisposed.trigger(),this.onDisposed.reset()}static setupBVH(){Vs.prototype.computeBoundsTree=Ic,Vs.prototype.disposeBoundsTree=Ec,se.prototype.raycast=dc}};p(go,"release","2.3.17");let So=go;class Nc extends er{constructor(){super(...arguments),p(this,"meshes",new Set),p(this,"onAfterUpdate",new $),p(this,"onBeforeUpdate",new $),p(this,"onDisposed",new $),p(this,"isDisposing",!1),p(this,"enabled",!0),p(this,"uuid",gt.create()),p(this,"name"),p(this,"_scene"),p(this,"_camera"),p(this,"_renderer",null)}get scene(){if(!this._scene)throw new Error("No scene initialized!");return this._scene}set scene(e){this._scene=e,e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"})}get camera(){if(!this._camera)throw new Error("No camera initialized!");return this._camera}set camera(e){this._camera=e,e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"})}get renderer(){return this._renderer}set renderer(e){this._renderer=e,e&&(e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"}))}update(e){this.enabled&&(!this._scene||!this._camera||(this.scene.currentWorld=this,this.camera.currentWorld=this,this.renderer&&(this.renderer.currentWorld=this),this.onBeforeUpdate.trigger(),this.scene.isUpdateable()&&this.scene.update(e),this.camera.isUpdateable()&&this.camera.update(e),this.renderer&&this.renderer.update(e),this.onAfterUpdate.trigger()))}dispose(e=!0){if(this.enabled=!1,this.isDisposing=!0,this.scene.onWorldChanged.trigger({world:this,action:"removed"}),this.camera.onWorldChanged.trigger({world:this,action:"removed"}),this.renderer&&this.renderer.onWorldChanged.trigger({world:this,action:"removed"}),e){const t=this.components.get(ds);this.scene.dispose(),this.camera.isDisposeable()&&this.camera.dispose(),this.renderer&&this.renderer.dispose();for(const s of this.meshes)t.destroy(s);this.meshes.clear()}this._scene=null,this._camera=null,this._renderer=null,this.components.get(wo).list.delete(this.uuid),this.onDisposed.trigger(),this.onDisposed.reset()}}class Ht{constructor(e,t,s,i){p(this,"_component"),p(this,"name"),p(this,"uuid"),this._component=e,this.name=s,this.uuid=i??gt.create(),t.get(Ws).list.set(this.uuid,this)}get controls(){const e={};for(const t in this._config){const s=this._config[t];e[t]=this.copyEntry(s)}return e}copyEntry(e){if(e.type==="Boolean"){const t=e;return{type:t.type,value:t.value}}if(e.type==="Color"){const t=e;return{type:t.type,value:t.value.clone()}}if(e.type==="Text"){const t=e;return{type:t.type,value:t.value}}if(e.type==="Number"){const t=e;return{type:t.type,value:t.value,min:t.min,max:t.max,interpolable:t.interpolable}}if(e.type==="Select"){const t=e;return{type:t.type,value:t.value,multiple:t.multiple,options:new Set(t.options)}}if(e.type==="Vector3"){const t=e;return{type:t.type,value:t.value.clone()}}if(e.type==="TextSet"){const t=e;return{type:t.type,value:new Set(t.value)}}if(e.type==="None"){const t=e;return{type:t.type,value:t.value}}throw new Error("Invalid entry!")}}const Ao=class Oo extends Ae{constructor(e){super(e),p(this,"list",new rt),p(this,"enabled",!0),e.add(Oo.uuid,this)}};p(Ao,"uuid","b8c764e0-6b24-4e77-9a32-35fa728ee5b4");let Ws=Ao;class Lc{constructor(e,t){p(this,"_list"),p(this,"_scene"),this._list=e,this._scene=t}get color(){return this._list.directionalLight.color.value}set color(e){this._list.directionalLight.color.value=e;for(const[,t]of this._scene.directionalLights)t.color.copy(e)}get intensity(){return this._list.directionalLight.intensity.value}set intensity(e){this._list.directionalLight.intensity.value=e;for(const[,t]of this._scene.directionalLights)t.intensity=e}get position(){return this._list.directionalLight.position.value.clone()}set position(e){this._list.directionalLight.position.value=e;for(const[,t]of this._scene.directionalLights)t.position.copy(e)}}class _c{constructor(e,t){p(this,"_list"),p(this,"_scene"),this._list=e,this._scene=t}get color(){return this._list.ambientLight.color.value}set color(e){this._list.ambientLight.color.value=e;for(const[,t]of this._scene.ambientLights)t.color.copy(e)}get intensity(){return this._list.ambientLight.intensity.value}set intensity(e){this._list.ambientLight.intensity.value=e;for(const[,t]of this._scene.ambientLights)t.intensity=e}}class wc extends Ht{constructor(){super(...arguments),p(this,"_config",{backgroundColor:{value:new Ue,type:"Color"},ambientLight:{color:{type:"Color",value:new Ue},intensity:{type:"Number",interpolable:!0,min:0,max:10,value:2}},directionalLight:{color:{type:"Color",value:new Ue},intensity:{type:"Number",interpolable:!0,min:0,max:10,value:2},position:{type:"Vector3",value:new U}}}),p(this,"ambientLight",new _c(this._config,this._component)),p(this,"directionalLight",new Lc(this._config,this._component))}get backgroundColor(){return this._config.backgroundColor.value}set backgroundColor(e){this._config.backgroundColor.value=e,this._component.three.background=e}}class Pc extends Cc{constructor(e){super(e),p(this,"onSetup",new $),p(this,"isSetup",!1),p(this,"three"),p(this,"config",new wc(this,this.components,"Scene")),p(this,"_defaultConfig",{backgroundColor:new Ue(2107698),directionalLight:{color:new Ue("white"),intensity:1.5,position:new U(5,10,3)},ambientLight:{color:new Ue("white"),intensity:1}}),this.three=new vi,this.three.background=new Ue(2107698)}setup(e){const t={...this._defaultConfig,...e};this.config.backgroundColor=t.backgroundColor;const s=t.ambientLight;this.config.ambientLight.color=s.color,this.config.ambientLight.intensity=s.intensity;const i=t.directionalLight;this.config.directionalLight.color=i.color,this.config.directionalLight.intensity=i.intensity,this.config.directionalLight.position=i.position,this.deleteAllLights();const{color:n,intensity:r}=this.config.directionalLight,o=new ho(n,r);o.position.copy(i.position);const{color:a,intensity:c}=this.config.directionalLight,h=new Pa(a,c);this.three.add(o,h),this.directionalLights.set(o.uuid,o),this.ambientLights.set(h.uuid,h),this.isSetup=!0,this.onSetup.trigger()}dispose(){super.dispose(),this.components.get(Ws).list.delete(this.config.uuid)}}class Qu extends pc{constructor(e,t,s){super(e),p(this,"enabled",!0),p(this,"container"),p(this,"three"),p(this,"_canvas"),p(this,"_parameters"),p(this,"_resizeObserver",null),p(this,"onContainerUpdated",new $),p(this,"_resizing",!1),p(this,"resize",r=>{if(this._resizing)return;this._resizing=!0,this.onContainerUpdated.trigger();const o=r?r.x:this.container.clientWidth,a=r?r.y:this.container.clientHeight;this.three.setSize(o,a),this.onResize.trigger(new He(o,a)),this._resizing=!1}),p(this,"resizeEvent",()=>{this.resize()}),p(this,"onContextLost",r=>{r.preventDefault(),this.enabled=!1}),p(this,"onContextBack",()=>{this.three.setRenderTarget(null),this.three.dispose(),this.three=new Ys({canvas:this._canvas,antialias:!0,alpha:!0,...this._parameters}),this.enabled=!0}),this.container=t,this._parameters=s,this.three=new Ys({antialias:!0,alpha:!0,...s}),this.three.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.setupRenderer(),this.setupEvents(!0),this.resize(),this._canvas=this.three.domElement;const i=this.three.getContext(),{canvas:n}=i;n.addEventListener("webglcontextlost",this.onContextLost,!1),n.addEventListener("webglcontextrestored",this.onContextBack,!1)}update(){if(!this.enabled||!this.currentWorld)return;this.onBeforeUpdate.trigger(this);const e=this.currentWorld.scene.three,t=this.currentWorld.camera.three;this.three.render(e,t),this.onAfterUpdate.trigger(this)}dispose(){this.enabled=!1,this.setupEvents(!1),this.three.domElement.remove(),this.three.forceContextLoss(),this.three.dispose(),this.onResize.reset(),this.onAfterUpdate.reset(),this.onBeforeUpdate.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}getSize(){return new He(this.three.domElement.clientWidth,this.three.domElement.clientHeight)}setupEvents(e){const t=this.three.domElement.parentElement;if(!t)throw new Error("This renderer needs to have an HTML container!");this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null),window.removeEventListener("resize",this.resizeEvent),e&&(this._resizeObserver=new ResizeObserver(this.resizeEvent),this._resizeObserver.observe(t),window.addEventListener("resize",this.resizeEvent))}setupRenderer(){this.three.localClippingEnabled=!0,this.container&&this.container.appendChild(this.three.domElement),this.onContainerUpdated.trigger()}}/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const le={LEFT:1,RIGHT:2,MIDDLE:4},k=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),ss={NONE:0,IN:1,OUT:-1};function Dt(l){return l.isPerspectiveCamera}function Ot(l){return l.isOrthographicCamera}const is=Math.PI*2,xr=Math.PI/2,yo=1e-5,Os=Math.PI/180;function et(l,e,t){return Math.max(e,Math.min(t,l))}function me(l,e=yo){return Math.abs(l)<e}function fe(l,e,t=yo){return me(l-e,t)}function Br(l,e){return Math.round(l/e)*e}function ys(l){return isFinite(l)?l:l<0?-Number.MAX_VALUE:Number.MAX_VALUE}function Ns(l){return Math.abs(l)<Number.MAX_VALUE?l:l*(1/0)}function ui(l,e,t,s,i=1/0,n){s=Math.max(1e-4,s);const r=2/s,o=r*n,a=1/(1+o+.48*o*o+.235*o*o*o);let c=l-e;const h=e,I=i*s;c=et(c,-I,I),e=l-c;const d=(t.value+r*c)*n;t.value=(t.value-r*d)*a;let u=e+(c+d)*a;return h-l>0==u>h&&(u=h,t.value=(u-h)/n),u}function Yr(l,e,t,s,i=1/0,n,r){s=Math.max(1e-4,s);const o=2/s,a=o*n,c=1/(1+a+.48*a*a+.235*a*a*a);let h=e.x,I=e.y,d=e.z,u=l.x-h,f=l.y-I,E=l.z-d;const C=h,T=I,R=d,A=i*s,m=A*A,S=u*u+f*f+E*E;if(S>m){const b=Math.sqrt(S);u=u/b*A,f=f/b*A,E=E/b*A}h=l.x-u,I=l.y-f,d=l.z-E;const N=(t.x+o*u)*n,y=(t.y+o*f)*n,P=(t.z+o*E)*n;t.x=(t.x-o*N)*c,t.y=(t.y-o*y)*c,t.z=(t.z-o*P)*c,r.x=h+(u+N)*c,r.y=I+(f+y)*c,r.z=d+(E+P)*c;const _=C-l.x,M=T-l.y,B=R-l.z,O=r.x-C,v=r.y-T,F=r.z-R;return _*O+M*v+B*F>0&&(r.x=C,r.y=T,r.z=R,t.x=(r.x-C)/n,t.y=(r.y-T)/n,t.z=(r.z-R)/n),r}function tn(l,e){e.set(0,0),l.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=l.length,e.y/=l.length}function sn(l,e){return Ot(l)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}class vc{constructor(){this._listeners={}}addEventListener(e,t){const s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(t)===-1&&s[e].push(t)}hasEventListener(e,t){const s=this._listeners;return s[e]!==void 0&&s[e].indexOf(t)!==-1}removeEventListener(e,t){const s=this._listeners[e];if(s!==void 0){const i=s.indexOf(t);i!==-1&&s.splice(i,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const t=this._listeners[e.type];if(t!==void 0){e.target=this;const s=t.slice(0);for(let i=0,n=s.length;i<n;i++)s[i].call(this,e)}}}const Mc="2.7.3",di=1/8,No=typeof window<"u",Dc=No&&/Mac/.test(navigator.platform),bc=!(No&&"PointerEvent"in window);let ae,Vr,Ii,nn,Ge,ce,Ie,ns,Ls,at,lt,bt,Gr,zr,je,_s,rs,kr,rn,Hr,on,an,Ei;class be extends vc{static install(e){ae=e.THREE,Vr=Object.freeze(new ae.Vector3(0,0,0)),Ii=Object.freeze(new ae.Vector3(0,1,0)),nn=Object.freeze(new ae.Vector3(0,0,1)),Ge=new ae.Vector2,ce=new ae.Vector3,Ie=new ae.Vector3,ns=new ae.Vector3,Ls=new ae.Vector3,at=new ae.Vector3,lt=new ae.Vector3,bt=new ae.Vector3,Gr=new ae.Vector3,zr=new ae.Vector3,je=new ae.Spherical,_s=new ae.Spherical,rs=new ae.Box3,kr=new ae.Box3,rn=new ae.Sphere,Hr=new ae.Quaternion,on=new ae.Quaternion,an=new ae.Matrix4,Ei=new ae.Raycaster}static get ACTION(){return k}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=k.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=ss.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new ae.Vector3,this._focalOffsetVelocity=new ae.Vector3,this._zoomVelocity={value:0},this._truckInternal=(m,S,N)=>{let y,P;if(Dt(this._camera)){const _=ce.copy(this._camera.position).sub(this._target),M=this._camera.getEffectiveFOV()*Os,B=_.length()*Math.tan(M*.5);y=this.truckSpeed*m*B/this._elementRect.height,P=this.truckSpeed*S*B/this._elementRect.height}else if(Ot(this._camera)){const _=this._camera;y=m*(_.right-_.left)/_.zoom/this._elementRect.width,P=S*(_.top-_.bottom)/_.zoom/this._elementRect.height}else return;this.verticalDragToForward?(N?this.setFocalOffset(this._focalOffsetEnd.x+y,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(y,0,!0),this.forward(-P,!0)):N?this.setFocalOffset(this._focalOffsetEnd.x+y,this._focalOffsetEnd.y+P,this._focalOffsetEnd.z,!0):this.truck(y,P,!0)},this._rotateInternal=(m,S)=>{const N=is*this.azimuthRotateSpeed*m/this._elementRect.height,y=is*this.polarRotateSpeed*S/this._elementRect.height;this.rotate(N,y,!0)},this._dollyInternal=(m,S,N)=>{const y=Math.pow(.95,-m*this.dollySpeed),P=this._sphericalEnd.radius,_=this._sphericalEnd.radius*y,M=et(_,this.minDistance,this.maxDistance),B=M-_;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(_,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(B,!0),this._dollyToNoClamp(M,!0)):this._dollyToNoClamp(M,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?_:M)-P,this._dollyControlCoord.set(S,N)),this._lastDollyDirection=Math.sign(-m)},this._zoomInternal=(m,S,N)=>{const y=Math.pow(.95,m*this.dollySpeed),P=this._zoom,_=this._zoom*y;this.zoomTo(_,!0),this.dollyToCursor&&(this._changedZoom+=_-P,this._dollyControlCoord.set(S,N))},typeof ae>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new ae.Quaternion().setFromUnitVectors(this._camera.up,Ii),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=k.NONE,this._target=new ae.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new ae.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new ae.Spherical().setFromVector3(ce.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new ae.Vector3,new ae.Vector3,new ae.Vector3,new ae.Vector3],this._updateNearPlaneCorners(),this._boundary=new ae.Box3(new ae.Vector3(-1/0,-1/0,-1/0),new ae.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new ae.Vector2,this.mouseButtons={left:k.ROTATE,middle:k.DOLLY,right:k.TRUCK,wheel:Dt(this._camera)?k.DOLLY:Ot(this._camera)?k.ZOOM:k.NONE},this.touches={one:k.TOUCH_ROTATE,two:Dt(this._camera)?k.TOUCH_DOLLY_TRUCK:Ot(this._camera)?k.TOUCH_ZOOM_TRUCK:k.NONE,three:k.TOUCH_TRUCK};const s=new ae.Vector2,i=new ae.Vector2,n=new ae.Vector2,r=m=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const y=this._domElement.getBoundingClientRect(),P=m.clientX/y.width,_=m.clientY/y.height;if(P<this._interactiveArea.left||P>this._interactiveArea.right||_<this._interactiveArea.top||_>this._interactiveArea.bottom)return}const S=m.pointerType!=="mouse"?null:(m.buttons&le.LEFT)===le.LEFT?le.LEFT:(m.buttons&le.MIDDLE)===le.MIDDLE?le.MIDDLE:(m.buttons&le.RIGHT)===le.RIGHT?le.RIGHT:null;if(S!==null){const y=this._findPointerByMouseButton(S);y&&this._disposePointer(y)}if((m.buttons&le.LEFT)===le.LEFT&&this._lockedPointer)return;const N={pointerId:m.pointerId,clientX:m.clientX,clientY:m.clientY,deltaX:0,deltaY:0,mouseButton:S};this._activePointers.push(N),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",h),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",h),this._isDragging=!0,E(m)},o=m=>{if(!this._enabled||!this._domElement||this._lockedPointer)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const y=this._domElement.getBoundingClientRect(),P=m.clientX/y.width,_=m.clientY/y.height;if(P<this._interactiveArea.left||P>this._interactiveArea.right||_<this._interactiveArea.top||_>this._interactiveArea.bottom)return}const S=(m.buttons&le.LEFT)===le.LEFT?le.LEFT:(m.buttons&le.MIDDLE)===le.MIDDLE?le.MIDDLE:(m.buttons&le.RIGHT)===le.RIGHT?le.RIGHT:null;if(S!==null){const y=this._findPointerByMouseButton(S);y&&this._disposePointer(y)}const N={pointerId:1,clientX:m.clientX,clientY:m.clientY,deltaX:0,deltaY:0,mouseButton:(m.buttons&le.LEFT)===le.LEFT?le.LEFT:(m.buttons&le.MIDDLE)===le.LEFT?le.MIDDLE:(m.buttons&le.RIGHT)===le.LEFT?le.RIGHT:null};this._activePointers.push(N),this._domElement.ownerDocument.removeEventListener("mousemove",c),this._domElement.ownerDocument.removeEventListener("mouseup",I),this._domElement.ownerDocument.addEventListener("mousemove",c),this._domElement.ownerDocument.addEventListener("mouseup",I),this._isDragging=!0,E(m)},a=m=>{m.cancelable&&m.preventDefault();const S=m.pointerId,N=this._lockedPointer||this._findPointerById(S);if(N){if(N.clientX=m.clientX,N.clientY=m.clientY,N.deltaX=m.movementX,N.deltaY=m.movementY,this._state=0,m.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(m.buttons&le.LEFT)===le.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(m.buttons&le.MIDDLE)===le.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(m.buttons&le.RIGHT)===le.RIGHT&&(this._state=this._state|this.mouseButtons.right);C()}},c=m=>{const S=this._lockedPointer||this._findPointerById(1);S&&(S.clientX=m.clientX,S.clientY=m.clientY,S.deltaX=m.movementX,S.deltaY=m.movementY,this._state=0,(this._lockedPointer||(m.buttons&le.LEFT)===le.LEFT)&&(this._state=this._state|this.mouseButtons.left),(m.buttons&le.MIDDLE)===le.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(m.buttons&le.RIGHT)===le.RIGHT&&(this._state=this._state|this.mouseButtons.right),C())},h=m=>{const S=this._findPointerById(m.pointerId);if(!(S&&S===this._lockedPointer)){if(S&&this._disposePointer(S),m.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=k.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=k.NONE;T()}},I=()=>{const m=this._findPointerById(1);m&&m===this._lockedPointer||(m&&this._disposePointer(m),this._state=k.NONE,T())};let d=-1;const u=m=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===k.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const _=this._domElement.getBoundingClientRect(),M=m.clientX/_.width,B=m.clientY/_.height;if(M<this._interactiveArea.left||M>this._interactiveArea.right||B<this._interactiveArea.top||B>this._interactiveArea.bottom)return}if(m.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===k.ROTATE||this.mouseButtons.wheel===k.TRUCK){const _=performance.now();d-_<1e3&&this._getClientRect(this._elementRect),d=_}const S=Dc?-1:-3,N=m.deltaMode===1?m.deltaY/S:m.deltaY/(S*10),y=this.dollyToCursor?(m.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,P=this.dollyToCursor?(m.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case k.ROTATE:{this._rotateInternal(m.deltaX,m.deltaY),this._isUserControllingRotate=!0;break}case k.TRUCK:{this._truckInternal(m.deltaX,m.deltaY,!1),this._isUserControllingTruck=!0;break}case k.OFFSET:{this._truckInternal(m.deltaX,m.deltaY,!0),this._isUserControllingOffset=!0;break}case k.DOLLY:{this._dollyInternal(-N,y,P),this._isUserControllingDolly=!0;break}case k.ZOOM:{this._zoomInternal(-N,y,P),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},f=m=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===be.ACTION.NONE){const S=m instanceof PointerEvent?m.pointerId:0,N=this._findPointerById(S);N&&this._disposePointer(N),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",h),this._domElement.ownerDocument.removeEventListener("mousemove",c),this._domElement.ownerDocument.removeEventListener("mouseup",I);return}m.preventDefault()}},E=m=>{if(this._enabled){if(tn(this._activePointers,Ge),this._getClientRect(this._elementRect),s.copy(Ge),i.copy(Ge),this._activePointers.length>=2){const S=Ge.x-this._activePointers[1].clientX,N=Ge.y-this._activePointers[1].clientY,y=Math.sqrt(S*S+N*N);n.set(0,y);const P=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,_=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;i.set(P,_)}if(this._state=0,!m)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in m&&m.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(m.buttons&le.LEFT)===le.LEFT&&(this._state=this._state|this.mouseButtons.left),(m.buttons&le.MIDDLE)===le.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(m.buttons&le.RIGHT)===le.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&k.ROTATE)===k.ROTATE||(this._state&k.TOUCH_ROTATE)===k.TOUCH_ROTATE||(this._state&k.TOUCH_DOLLY_ROTATE)===k.TOUCH_DOLLY_ROTATE||(this._state&k.TOUCH_ZOOM_ROTATE)===k.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&k.TRUCK)===k.TRUCK||(this._state&k.TOUCH_TRUCK)===k.TOUCH_TRUCK||(this._state&k.TOUCH_DOLLY_TRUCK)===k.TOUCH_DOLLY_TRUCK||(this._state&k.TOUCH_ZOOM_TRUCK)===k.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&k.DOLLY)===k.DOLLY||(this._state&k.TOUCH_DOLLY)===k.TOUCH_DOLLY||(this._state&k.TOUCH_DOLLY_TRUCK)===k.TOUCH_DOLLY_TRUCK||(this._state&k.TOUCH_DOLLY_OFFSET)===k.TOUCH_DOLLY_OFFSET||(this._state&k.TOUCH_DOLLY_ROTATE)===k.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&k.ZOOM)===k.ZOOM||(this._state&k.TOUCH_ZOOM)===k.TOUCH_ZOOM||(this._state&k.TOUCH_ZOOM_TRUCK)===k.TOUCH_ZOOM_TRUCK||(this._state&k.TOUCH_ZOOM_OFFSET)===k.TOUCH_ZOOM_OFFSET||(this._state&k.TOUCH_ZOOM_ROTATE)===k.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&k.OFFSET)===k.OFFSET||(this._state&k.TOUCH_OFFSET)===k.TOUCH_OFFSET||(this._state&k.TOUCH_DOLLY_OFFSET)===k.TOUCH_DOLLY_OFFSET||(this._state&k.TOUCH_ZOOM_OFFSET)===k.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})}},C=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,tn(this._activePointers,Ge);const m=this._domElement&&document.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,S=m?-m.deltaX:i.x-Ge.x,N=m?-m.deltaY:i.y-Ge.y;if(i.copy(Ge),((this._state&k.ROTATE)===k.ROTATE||(this._state&k.TOUCH_ROTATE)===k.TOUCH_ROTATE||(this._state&k.TOUCH_DOLLY_ROTATE)===k.TOUCH_DOLLY_ROTATE||(this._state&k.TOUCH_ZOOM_ROTATE)===k.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(S,N),this._isUserControllingRotate=!0),(this._state&k.DOLLY)===k.DOLLY||(this._state&k.ZOOM)===k.ZOOM){const y=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,P=this.dollyToCursor?(s.y-this._elementRect.y)/this._elementRect.height*-2+1:0,_=this.dollyDragInverted?-1:1;(this._state&k.DOLLY)===k.DOLLY?(this._dollyInternal(_*N*di,y,P),this._isUserControllingDolly=!0):(this._zoomInternal(_*N*di,y,P),this._isUserControllingZoom=!0)}if((this._state&k.TOUCH_DOLLY)===k.TOUCH_DOLLY||(this._state&k.TOUCH_ZOOM)===k.TOUCH_ZOOM||(this._state&k.TOUCH_DOLLY_TRUCK)===k.TOUCH_DOLLY_TRUCK||(this._state&k.TOUCH_ZOOM_TRUCK)===k.TOUCH_ZOOM_TRUCK||(this._state&k.TOUCH_DOLLY_OFFSET)===k.TOUCH_DOLLY_OFFSET||(this._state&k.TOUCH_ZOOM_OFFSET)===k.TOUCH_ZOOM_OFFSET||(this._state&k.TOUCH_DOLLY_ROTATE)===k.TOUCH_DOLLY_ROTATE||(this._state&k.TOUCH_ZOOM_ROTATE)===k.TOUCH_ZOOM_ROTATE){const y=Ge.x-this._activePointers[1].clientX,P=Ge.y-this._activePointers[1].clientY,_=Math.sqrt(y*y+P*P),M=n.y-_;n.set(0,_);const B=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,O=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&k.TOUCH_DOLLY)===k.TOUCH_DOLLY||(this._state&k.TOUCH_DOLLY_ROTATE)===k.TOUCH_DOLLY_ROTATE||(this._state&k.TOUCH_DOLLY_TRUCK)===k.TOUCH_DOLLY_TRUCK||(this._state&k.TOUCH_DOLLY_OFFSET)===k.TOUCH_DOLLY_OFFSET?(this._dollyInternal(M*di,B,O),this._isUserControllingDolly=!0):(this._zoomInternal(M*di,B,O),this._isUserControllingZoom=!0)}((this._state&k.TRUCK)===k.TRUCK||(this._state&k.TOUCH_TRUCK)===k.TOUCH_TRUCK||(this._state&k.TOUCH_DOLLY_TRUCK)===k.TOUCH_DOLLY_TRUCK||(this._state&k.TOUCH_ZOOM_TRUCK)===k.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(S,N,!1),this._isUserControllingTruck=!0),((this._state&k.OFFSET)===k.OFFSET||(this._state&k.TOUCH_OFFSET)===k.TOUCH_OFFSET||(this._state&k.TOUCH_DOLLY_OFFSET)===k.TOUCH_DOLLY_OFFSET||(this._state&k.TOUCH_ZOOM_OFFSET)===k.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(S,N,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},T=()=>{tn(this._activePointers,Ge),i.copy(Ge),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",c),this._domElement.ownerDocument.removeEventListener("pointerup",h),this._domElement.ownerDocument.removeEventListener("mouseup",I),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",h),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",R),this._domElement.ownerDocument.addEventListener("pointerlockerror",A),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",h),E())},this.unlockPointer=()=>{this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),document.exitPointerLock(),this.cancel(),this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointerlockchange",R),this._domElement.ownerDocument.removeEventListener("pointerlockerror",A))};const R=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},A=()=>{this.unlockPointer()};this._addAllEventListeners=m=>{this._domElement=m,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",r),bc&&this._domElement.addEventListener("mousedown",o),this._domElement.addEventListener("pointercancel",h),this._domElement.addEventListener("wheel",u,{passive:!1}),this._domElement.addEventListener("contextmenu",f)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",r),this._domElement.removeEventListener("mousedown",o),this._domElement.removeEventListener("pointercancel",h),this._domElement.removeEventListener("wheel",u,{passive:!1}),this._domElement.removeEventListener("contextmenu",f),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",c),this._domElement.ownerDocument.removeEventListener("pointerup",h),this._domElement.ownerDocument.removeEventListener("mouseup",I),this._domElement.ownerDocument.removeEventListener("pointerlockchange",R),this._domElement.ownerDocument.removeEventListener("pointerlockerror",A))},this.cancel=()=>{this._state!==k.NONE&&(this._state=k.NONE,this._activePointers.length=0,T())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=et(e.width,0,1),this._interactiveArea.height=et(e.height,0,1),this._interactiveArea.x=et(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=et(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,s=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,s)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,s=!1){this._isUserControllingRotate=!1;const i=et(e,this.minAzimuthAngle,this.maxAzimuthAngle),n=et(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=i,this._sphericalEnd.phi=n,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,s||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const r=!s||fe(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&fe(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(r)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=ss.NONE,this._changedDolly=0,this._dollyToNoClamp(et(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const s=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const n=this._collisionTest(),r=fe(n,this._spherical.radius);if(!(s>e)&&r)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,n)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const i=!t||fe(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(i)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(Ls).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const s=!t||fe(this._target.x,this._targetEnd.x,this.restThreshold)&&fe(this._target.y,this._targetEnd.y,this.restThreshold)&&fe(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=et(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const s=!t||fe(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(s)}pan(e,t,s=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,s)}truck(e,t,s=!1){this._camera.updateMatrix(),at.setFromMatrixColumn(this._camera.matrix,0),lt.setFromMatrixColumn(this._camera.matrix,1),at.multiplyScalar(e),lt.multiplyScalar(-t);const i=ce.copy(at).add(lt),n=Ie.copy(this._targetEnd).add(i);return this.moveTo(n.x,n.y,n.z,s)}forward(e,t=!1){ce.setFromMatrixColumn(this._camera.matrix,0),ce.crossVectors(this._camera.up,ce),ce.multiplyScalar(e);const s=Ie.copy(this._targetEnd).add(ce);return this.moveTo(s.x,s.y,s.z,t)}elevate(e,t=!1){return ce.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+ce.x,this._targetEnd.y+ce.y,this._targetEnd.z+ce.z,t)}moveTo(e,t,s,i=!1){this._isUserControllingTruck=!1;const n=ce.set(e,t,s).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,n,this.boundaryFriction),this._needsUpdate=!0,i||this._target.copy(this._targetEnd);const r=!i||fe(this._target.x,this._targetEnd.x,this.restThreshold)&&fe(this._target.y,this._targetEnd.y,this.restThreshold)&&fe(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}lookInDirectionOf(e,t,s,i=!1){const n=ce.set(e,t,s).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius);return this.setPosition(n.x,n.y,n.z,i)}fitToBox(e,t,{cover:s=!1,paddingLeft:i=0,paddingRight:n=0,paddingBottom:r=0,paddingTop:o=0}={}){const a=[],c=e.isBox3?rs.copy(e):rs.setFromObject(e);c.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const h=Br(this._sphericalEnd.theta,xr),I=Br(this._sphericalEnd.phi,xr);a.push(this.rotateTo(h,I,t));const d=ce.setFromSpherical(this._sphericalEnd).normalize(),u=Hr.setFromUnitVectors(d,nn),f=fe(Math.abs(d.y),1);f&&u.multiply(on.setFromAxisAngle(Ii,h)),u.multiply(this._yAxisUpSpaceInverse);const E=kr.makeEmpty();Ie.copy(c.min).applyQuaternion(u),E.expandByPoint(Ie),Ie.copy(c.min).setX(c.max.x).applyQuaternion(u),E.expandByPoint(Ie),Ie.copy(c.min).setY(c.max.y).applyQuaternion(u),E.expandByPoint(Ie),Ie.copy(c.max).setZ(c.min.z).applyQuaternion(u),E.expandByPoint(Ie),Ie.copy(c.min).setZ(c.max.z).applyQuaternion(u),E.expandByPoint(Ie),Ie.copy(c.max).setY(c.min.y).applyQuaternion(u),E.expandByPoint(Ie),Ie.copy(c.max).setX(c.min.x).applyQuaternion(u),E.expandByPoint(Ie),Ie.copy(c.max).applyQuaternion(u),E.expandByPoint(Ie),E.min.x-=i,E.min.y-=r,E.max.x+=n,E.max.y+=o,u.setFromUnitVectors(nn,d),f&&u.premultiply(on.invert()),u.premultiply(this._yAxisUpSpace);const C=E.getSize(ce),T=E.getCenter(Ie).applyQuaternion(u);if(Dt(this._camera)){const R=this.getDistanceToFitBox(C.x,C.y,C.z,s);a.push(this.moveTo(T.x,T.y,T.z,t)),a.push(this.dollyTo(R,t)),a.push(this.setFocalOffset(0,0,0,t))}else if(Ot(this._camera)){const R=this._camera,A=R.right-R.left,m=R.top-R.bottom,S=s?Math.max(A/C.x,m/C.y):Math.min(A/C.x,m/C.y);a.push(this.moveTo(T.x,T.y,T.z,t)),a.push(this.zoomTo(S,t)),a.push(this.setFocalOffset(0,0,0,t))}return Promise.all(a)}fitToSphere(e,t){const s=[],i=e instanceof ae.Sphere?rn.copy(e):be.createBoundingSphere(e,rn);if(s.push(this.moveTo(i.center.x,i.center.y,i.center.z,t)),Dt(this._camera)){const n=this.getDistanceToFitSphere(i.radius);s.push(this.dollyTo(n,t))}else if(Ot(this._camera)){const n=this._camera.right-this._camera.left,r=this._camera.top-this._camera.bottom,o=2*i.radius,a=Math.min(n/o,r/o);s.push(this.zoomTo(a,t))}return s.push(this.setFocalOffset(0,0,0,t)),Promise.all(s)}setLookAt(e,t,s,i,n,r,o=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=ss.NONE,this._changedDolly=0;const a=Ie.set(i,n,r),c=ce.set(e,t,s);this._targetEnd.copy(a),this._sphericalEnd.setFromVector3(c.sub(a).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,o||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const h=!o||fe(this._target.x,this._targetEnd.x,this.restThreshold)&&fe(this._target.y,this._targetEnd.y,this.restThreshold)&&fe(this._target.z,this._targetEnd.z,this.restThreshold)&&fe(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&fe(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&fe(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(h)}lerpLookAt(e,t,s,i,n,r,o,a,c,h,I,d,u,f=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=ss.NONE,this._changedDolly=0;const E=ce.set(i,n,r),C=Ie.set(e,t,s);je.setFromVector3(C.sub(E).applyQuaternion(this._yAxisUpSpace));const T=ns.set(h,I,d),R=Ie.set(o,a,c);_s.setFromVector3(R.sub(T).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(E.lerp(T,u));const A=_s.theta-je.theta,m=_s.phi-je.phi,S=_s.radius-je.radius;this._sphericalEnd.set(je.radius+S*u,je.phi+m*u,je.theta+A*u),this.normalizeRotations(),this._needsUpdate=!0,f||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const N=!f||fe(this._target.x,this._targetEnd.x,this.restThreshold)&&fe(this._target.y,this._targetEnd.y,this.restThreshold)&&fe(this._target.z,this._targetEnd.z,this.restThreshold)&&fe(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&fe(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&fe(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(N)}setPosition(e,t,s,i=!1){return this.setLookAt(e,t,s,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,i)}setTarget(e,t,s,i=!1){const n=this.getPosition(ce),r=this.setLookAt(n.x,n.y,n.z,e,t,s,i);return this._sphericalEnd.phi=et(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),r}setFocalOffset(e,t,s,i=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,s),this._needsUpdate=!0,i||this._focalOffset.copy(this._focalOffsetEnd);const n=!i||fe(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&fe(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&fe(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}setOrbitPoint(e,t,s){this._camera.updateMatrixWorld(),at.setFromMatrixColumn(this._camera.matrixWorldInverse,0),lt.setFromMatrixColumn(this._camera.matrixWorldInverse,1),bt.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const i=ce.set(e,t,s),n=i.distanceTo(this._camera.position),r=i.sub(this._camera.position);at.multiplyScalar(r.x),lt.multiplyScalar(r.y),bt.multiplyScalar(r.z),ce.copy(at).add(lt).add(bt),ce.z=ce.z+n,this.dollyTo(n,!1),this.setFocalOffset(-ce.x,ce.y,-ce.z,!1),this.moveTo(e,t,s,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,s,i){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new ae.Vector4,typeof e=="number"?this._viewport.set(e,t,s,i):this._viewport.copy(e)}getDistanceToFitBox(e,t,s,i=!1){if(sn(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const n=e/t,r=this._camera.getEffectiveFOV()*Os,o=this._camera.aspect;return((i?n>o:n<o)?t:e/o)*.5/Math.tan(r*.5)+s*.5}getDistanceToFitSphere(e){if(sn(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*Os,s=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,i=1<this._camera.aspect?t:s;return e/Math.sin(i*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new ae.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new ae.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e&&e instanceof ae.Spherical?e:new ae.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new ae.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%is,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=is),this._spherical.theta+=is*Math.round((this._sphericalEnd.theta-this._spherical.theta)/is)}reset(e=!1){if(!fe(this._camera.up.x,this._cameraUp0.x)||!fe(this._camera.up.y,this._cameraUp0.y)||!fe(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const s=this.getPosition(ce);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,Ii),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=ce.subVectors(this._target,this._camera.position).normalize(),t=Ie.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const s=this.getPosition(ce);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,s=this._sphericalEnd.phi-this._spherical.phi,i=this._sphericalEnd.radius-this._spherical.radius,n=Gr.subVectors(this._targetEnd,this._target),r=zr.subVectors(this._focalOffsetEnd,this._focalOffset),o=this._zoomEnd-this._zoom;if(me(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const h=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=ui(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,h,1/0,e),this._needsUpdate=!0}if(me(s))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const h=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=ui(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,h,1/0,e),this._needsUpdate=!0}if(me(i))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const h=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=ui(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,h,this.maxSpeed,e),this._needsUpdate=!0}if(me(n.x)&&me(n.y)&&me(n.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const h=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;Yr(this._target,this._targetEnd,this._targetVelocity,h,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(me(r.x)&&me(r.y)&&me(r.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const h=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;Yr(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,h,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(me(o))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const h=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=ui(this._zoom,this._zoomEnd,this._zoomVelocity,h,1/0,e)}if(this.dollyToCursor){if(Dt(this._camera)&&this._changedDolly!==0){const h=this._spherical.radius-this._lastDistance,I=this._camera,d=this._getCameraDirection(Ls),u=ce.copy(d).cross(I.up).normalize();u.lengthSq()===0&&(u.x=1);const f=Ie.crossVectors(u,d),E=this._sphericalEnd.radius*Math.tan(I.getEffectiveFOV()*Os*.5),C=(this._sphericalEnd.radius-h-this._sphericalEnd.radius)/this._sphericalEnd.radius,T=ns.copy(this._targetEnd).add(u.multiplyScalar(this._dollyControlCoord.x*E*I.aspect)).add(f.multiplyScalar(this._dollyControlCoord.y*E)),R=ce.copy(this._targetEnd).lerp(T,C),A=this._lastDollyDirection===ss.IN&&this._spherical.radius<=this.minDistance,m=this._lastDollyDirection===ss.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(A||m)){this._sphericalEnd.radius-=h,this._spherical.radius-=h;const N=Ie.copy(d).multiplyScalar(-h);R.add(N)}this._boundary.clampPoint(R,R);const S=Ie.subVectors(R,this._targetEnd);this._targetEnd.copy(R),this._target.add(S),this._changedDolly-=h,me(this._changedDolly)&&(this._changedDolly=0)}else if(Ot(this._camera)&&this._changedZoom!==0){const h=this._zoom-this._lastZoom,I=this._camera,d=ce.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(I.near+I.far)/(I.near-I.far)).unproject(I),u=Ie.set(0,0,-1).applyQuaternion(I.quaternion),f=ns.copy(d).add(u.multiplyScalar(-d.dot(I.up))),E=-(this._zoom-h-this._zoom)/this._zoom,C=this._getCameraDirection(Ls),T=this._targetEnd.dot(C),R=ce.copy(this._targetEnd).lerp(f,E),A=R.dot(C),m=C.multiplyScalar(A-T);R.sub(m),this._boundary.clampPoint(R,R);const S=Ie.subVectors(R,this._targetEnd);this._targetEnd.copy(R),this._target.add(S),this._changedZoom-=h,me(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const a=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,a),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!me(this._focalOffset.x)||!me(this._focalOffset.y)||!me(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),at.setFromMatrixColumn(this._camera.matrix,0),lt.setFromMatrixColumn(this._camera.matrix,1),bt.setFromMatrixColumn(this._camera.matrix,2),at.multiplyScalar(this._focalOffset.x),lt.multiplyScalar(-this._focalOffset.y),bt.multiplyScalar(this._focalOffset.z),ce.copy(at).add(lt).add(bt),this._camera.position.add(ce)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),ce.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const c=this._needsUpdate;return c&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):c?(this.dispatchEvent({type:"update"}),me(t,this.restThreshold)&&me(s,this.restThreshold)&&me(i,this.restThreshold)&&me(n.x,this.restThreshold)&&me(n.y,this.restThreshold)&&me(n.z,this.restThreshold)&&me(r.x,this.restThreshold)&&me(r.y,this.restThreshold)&&me(r.z,this.restThreshold)&&me(o,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!c&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=c,this._needsUpdate=!1,c}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:ys(this.maxDistance),minZoom:this.minZoom,maxZoom:ys(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:ys(this.maxPolarAngle),minAzimuthAngle:ys(this.minAzimuthAngle),maxAzimuthAngle:ys(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:ce.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const s=JSON.parse(e);this.enabled=s.enabled,this.minDistance=s.minDistance,this.maxDistance=Ns(s.maxDistance),this.minZoom=s.minZoom,this.maxZoom=Ns(s.maxZoom),this.minPolarAngle=s.minPolarAngle,this.maxPolarAngle=Ns(s.maxPolarAngle),this.minAzimuthAngle=Ns(s.minAzimuthAngle),this.maxAzimuthAngle=Ns(s.maxAzimuthAngle),this.smoothTime=s.smoothTime,this.draggingSmoothTime=s.draggingSmoothTime,this.dollySpeed=s.dollySpeed,this.truckSpeed=s.truckSpeed,this.dollyToCursor=s.dollyToCursor,this.verticalDragToForward=s.verticalDragToForward,this._target0.fromArray(s.target0),this._position0.fromArray(s.position0),this._zoom0=s.zoom0,this._focalOffset0.fromArray(s.focalOffset0),this.moveTo(s.target[0],s.target[1],s.target[2],t),je.setFromVector3(ce.fromArray(s.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(je.theta,je.phi,t),this.dollyTo(je.radius,t),this.zoomTo(s.zoom,t),this.setFocalOffset(s.focalOffset[0],s.focalOffset[1],s.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",Mc),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,s){const i=t.lengthSq();if(i===0)return e;const n=Ie.copy(t).add(e),r=this._boundary.clampPoint(n,ns).sub(n),o=r.lengthSq();if(o===0)return e.add(t);if(o===i)return e;if(s===0)return e.add(t).add(r);{const a=1+s*o/t.dot(r);return e.add(Ie.copy(t).multiplyScalar(a)).add(r.multiplyScalar(1-s))}}_updateNearPlaneCorners(){if(Dt(this._camera)){const e=this._camera,t=e.near,s=e.getEffectiveFOV()*Os,i=Math.tan(s*.5)*t,n=i*e.aspect;this._nearPlaneCorners[0].set(-n,-i,0),this._nearPlaneCorners[1].set(n,-i,0),this._nearPlaneCorners[2].set(n,i,0),this._nearPlaneCorners[3].set(-n,i,0)}else if(Ot(this._camera)){const e=this._camera,t=1/e.zoom,s=e.left*t,i=e.right*t,n=e.top*t,r=e.bottom*t;this._nearPlaneCorners[0].set(s,n,0),this._nearPlaneCorners[1].set(i,n,0),this._nearPlaneCorners[2].set(i,r,0),this._nearPlaneCorners[3].set(s,r,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||sn(this._camera,"_collisionTest"))return e;const t=this._getTargetDirection(Ls);an.lookAt(Vr,t,this._camera.up);for(let s=0;s<4;s++){const i=Ie.copy(this._nearPlaneCorners[s]);i.applyMatrix4(an);const n=ns.addVectors(this._target,i);Ei.set(n,t),Ei.far=this._spherical.radius+1;const r=Ei.intersectObjects(this.colliderMeshes);r.length!==0&&r[0].distance<e&&(e=r[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{const s=()=>{this.removeEventListener("rest",s),t()};this.addEventListener("rest",s)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new ae.Sphere){const s=t,i=s.center;rs.makeEmpty(),e.traverseVisible(r=>{r.isMesh&&rs.expandByObject(r)}),rs.getCenter(i);let n=0;return e.traverseVisible(r=>{if(!r.isMesh)return;const o=r,a=o.geometry.clone();a.applyMatrix4(o.matrixWorld);const c=a.attributes.position;for(let h=0,I=c.count;h<I;h++)ce.fromBufferAttribute(c,h),n=Math.max(n,i.distanceToSquared(ce))}),s.radius=Math.sqrt(n),s}}class zs extends fc{constructor(e){super(e),p(this,"onBeforeUpdate",new $),p(this,"onAfterUpdate",new $),p(this,"onAspectUpdated",new $),p(this,"onDisposed",new $),p(this,"three"),p(this,"_allControls",new Map),p(this,"updateAspect",()=>{var t;if(!(!this.currentWorld||!this.currentWorld.renderer)){if(this.three instanceof zt){this.onAspectUpdated.trigger();return}if((t=this.currentWorld.renderer)!=null&&t.isResizeable()){const s=this.currentWorld.renderer.getSize();this.three.aspect=s.width/s.height,this.three.updateProjectionMatrix(),this.onAspectUpdated.trigger()}}}),this.three=this.setupCamera(),this.setupEvents(!0),this.onWorldChanged.add(({action:t,world:s})=>{if(t==="added"){const i=this.newCameraControls();this._allControls.set(s.uuid,i)}if(t==="removed"){const i=this._allControls.get(s.uuid);i&&(i.dispose(),this._allControls.delete(s.uuid))}})}get controls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");const e=this._allControls.get(this.currentWorld.uuid);if(!e)throw new Error("Controls not found!");return e}get enabled(){return this.currentWorld===null?!1:this.controls.enabled}set enabled(e){this.currentWorld!==null&&(this.controls.enabled=e)}dispose(){this.setupEvents(!1),this.onAspectUpdated.reset(),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.three.removeFromParent(),this.onDisposed.trigger(),this.onDisposed.reset();for(const[e,t]of this._allControls)t.dispose()}update(e){this.enabled&&(this.onBeforeUpdate.trigger(this),this.controls.update(e),this.onAfterUpdate.trigger(this))}setupCamera(){const e=window.innerWidth/window.innerHeight,t=new Mn(60,e,1,1e3);return t.position.set(50,50,50),t.lookAt(new U(0,0,0)),t}newCameraControls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");if(!this.currentWorld.renderer)throw new Error("This camera needs a renderer to work!");be.install({THREE:zs.getSubsetOfThree()});const{domElement:e}=this.currentWorld.renderer.three,t=new be(this.three,e);return t.smoothTime=.2,t.dollyToCursor=!0,t.infinityDolly=!0,t.minDistance=6,t}setupEvents(e){e?window.addEventListener("resize",this.updateAspect):window.removeEventListener("resize",this.updateAspect)}static getSubsetOfThree(){return{MOUSE:va,Vector2:He,Vector3:U,Vector4:Ma,Quaternion:st,Matrix4:Ee,Spherical:Da,Box3:Pe,Sphere:Pi,Raycaster:Dn,MathUtils:Oi}}}const Lo=class _o extends Ae{constructor(e){super(e),p(this,"onAfterUpdate",new $),p(this,"onBeforeUpdate",new $),p(this,"onDisposed",new $),p(this,"list",new rt),p(this,"enabled",!0),e.add(_o.uuid,this)}create(){const e=new Nc(this.components),t=e.uuid;if(this.list.has(t))throw new Error("There is already a world with this name!");return this.list.set(t,e),e}delete(e){if(!this.list.has(e.uuid))throw new Error("The provided world is not found in the list!");this.list.delete(e.uuid),e.dispose()}dispose(){this.enabled=!1;for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}update(e){if(this.enabled)for(const[t,s]of this.list)s.update(e)}};p(Lo,"uuid","fdb61dc4-2ec1-4966-b83d-54ea795fad4a");let wo=Lo;function Uc(l,e,t,s){return new Promise((i,n)=>{function r(){const o=l.clientWaitSync(e,t,0);if(o===l.WAIT_FAILED){n();return}if(o===l.TIMEOUT_EXPIRED){setTimeout(r,s);return}i()}r()})}async function xc(l,e,t,s,i,n,r){const o=l.fenceSync(l.SYNC_GPU_COMMANDS_COMPLETE,0);l.flush(),await Uc(l,o,0,10),l.deleteSync(o),l.bindBuffer(e,t),l.getBufferSubData(e,s,i,n,r),l.bindBuffer(e,null)}async function Po(l,e,t,s,i,n,r,o){const a=l.createBuffer();return l.bindBuffer(l.PIXEL_PACK_BUFFER,a),l.bufferData(l.PIXEL_PACK_BUFFER,o.byteLength,l.STREAM_READ),l.readPixels(e,t,s,i,n,r,0),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),await xc(l,l.PIXEL_PACK_BUFFER,a,0,o),l.deleteBuffer(a),o}class Bc extends Ht{constructor(){super(...arguments),p(this,"_config",{enabled:{value:!0,type:"Boolean"},width:{type:"Number",interpolable:!0,value:512,min:32,max:1024},height:{type:"Number",interpolable:!0,value:512,min:32,max:1024},autoUpdate:{value:!0,type:"Boolean"},renderDebugFrame:{value:!1,type:"Boolean"},updateInterval:{type:"Number",interpolable:!0,value:1,min:0,max:1},threshold:{type:"Number",interpolable:!0,value:100,min:1,max:512}}),p(this,"_interval",null)}get enabled(){return this._config.enabled.value}set enabled(e){this._config.enabled.value=e,this._component.enabled=e}get width(){return this._config.width.value}set width(e){this.setWidthHeight(e,this.height)}get height(){return this._config.height.value}set height(e){this.setWidthHeight(this.width,e)}get autoUpdate(){return this._config.autoUpdate.value}set autoUpdate(e){this.setAutoAndInterval(e,this.updateInterval)}get updateInterval(){return this._config.updateInterval.value}set updateInterval(e){this.setAutoAndInterval(this.autoUpdate,e)}get renderDebugFrame(){return this._config.renderDebugFrame.value}set renderDebugFrame(e){this._config.renderDebugFrame.value=e}get threshold(){return this._config.threshold.value}set threshold(e){this._config.threshold.value=e}setWidthHeight(e,t){if(e<=0||t<=0)throw new Error("The width and height of the culler renderer must be more than 0!");this._config.width.value=e,this._config.height.value=t,this.resetRenderTarget()}setAutoAndInterval(e,t){if(t<=0)throw new Error("The updateInterval of the culler renderer must be more than 0!");this._config.autoUpdate.value=e,this._config.updateInterval.value=t,this.resetInterval(e)}resetRenderTarget(){this._component.renderTarget.dispose(),this._component.renderTarget=new yi(this.width,this.height),this._component.bufferSize=this.width*this.height*4,this._component.buffer=new Uint8Array(this._component.bufferSize)}resetInterval(e){this._interval!==null&&window.clearInterval(this._interval),e&&(this._interval=window.setInterval(async()=>{this._component.preventUpdate||await this._component.updateVisibility()},this.updateInterval))}}class Yc{constructor(e,t){if(p(this,"onSetup",new $),p(this,"onDisposed",new $),p(this,"onViewUpdated",new wt),p(this,"enabled",!0),p(this,"needsUpdate",!1),p(this,"components"),p(this,"renderTarget",new yi),p(this,"bufferSize",1),p(this,"buffer",new Uint8Array),p(this,"preventUpdate",!1),p(this,"config"),p(this,"isSetup",!1),p(this,"world"),p(this,"renderer"),p(this,"_defaultConfig",{enabled:!0,height:512,width:512,updateInterval:1e3,autoUpdate:!0,renderDebugFrame:!1,threshold:100}),p(this,"worker"),p(this,"scene",new vi),p(this,"_availableColor",1),p(this,"_isWorkerBusy",!1),p(this,"updateVisibility",async n=>{if(!this.enabled||!this.needsUpdate&&!n||this._isWorkerBusy)return;this._isWorkerBusy=!0;const r=this.world.camera.three;r.updateMatrix();const{width:o,height:a}=this.config;this.renderer.setSize(o,a),this.renderer.setRenderTarget(this.renderTarget),this.renderer.render(this.scene,r);const c=this.renderer.getContext();await Po(c,0,0,o,a,c.RGBA,c.UNSIGNED_BYTE,this.buffer),this.renderer.setRenderTarget(null),this.config.renderDebugFrame&&this.renderer.render(this.scene,r),this.worker.postMessage({buffer:this.buffer}),this.needsUpdate=!1}),!t.renderer)throw new Error("The given world must have a renderer!");this.components=e,this.config=new Bc(this,this.components,"Culler renderer"),this.world=t,this.renderer=new Ys,this.renderer.clippingPlanes=t.renderer.clippingPlanes;const s=`
      addEventListener("message", (event) => {
        const { buffer } = event.data;
        const colors = new Map();
        for (let i = 0; i < buffer.length; i += 4) {
          const r = buffer[i];
          const g = buffer[i + 1];
          const b = buffer[i + 2];
          const code = "" + r + "-" + g + "-" + b;
          if(colors.has(code)) {
            colors.set(code, colors.get(code) + 1);
          } else {
            colors.set(code, 1);
          }
        }
        postMessage({ colors });
      });
    `,i=new Blob([s],{type:"application/javascript"});this.worker=new Worker(URL.createObjectURL(i)),this.setup()}dispose(){this.enabled=!1,this.config.autoUpdate=!1,this.components.get(Ws).list.delete(this.config.uuid);for(const e of this.scene.children)e.removeFromParent();this.onViewUpdated.reset(),this.worker.terminate(),this.renderer.forceContextLoss(),this.renderer.dispose(),this.renderTarget.dispose(),this.buffer=null,this.onDisposed.reset()}setup(e){const t={...this._defaultConfig,...e},{width:s,height:i}=t;this.config.setWidthHeight(s,i);const{updateInterval:n,autoUpdate:r}=t;this.config.setAutoAndInterval(r,n),this.config.threshold=t.threshold,this.isSetup=!0,this.onSetup.trigger()}getAvailableColor(){let e=BigInt(this._availableColor.toString());const t=[];do t.unshift(Number(e%256n)),e/=256n;while(e);for(;t.length!==3;)t.unshift(0);const[s,i,n]=t,r=`${s}-${i}-${n}`;return{r:s,g:i,b:n,code:r}}increaseColor(){if(this._availableColor===256*256*256){console.warn("Color can't be increased over 256 x 256 x 256!");return}this._availableColor++}decreaseColor(){if(this._availableColor===1){console.warn("Color can't be decreased under 0!");return}this._availableColor--}}class Vc extends Yc{constructor(e,t){super(e,t),p(this,"onViewUpdated",new $),p(this,"colorMeshes",new Map),p(this,"_colorCodeMeshMap",new Map),p(this,"_meshIDColorCodeMap",new Map),p(this,"_currentVisibleMeshes",new Set),p(this,"_recentlyHiddenMeshes",new Set),p(this,"_transparentMat",new us({transparent:!0,opacity:0})),p(this,"handleWorkerMessage",async s=>{if(this.preventUpdate)return;const i=s.data.colors;this._recentlyHiddenMeshes=new Set(this._currentVisibleMeshes),this._currentVisibleMeshes.clear();for(const[n,r]of i){if(r<this.config.threshold)continue;const o=this._colorCodeMeshMap.get(n);o&&(this._currentVisibleMeshes.add(o),this._recentlyHiddenMeshes.delete(o))}this.onViewUpdated.trigger({seen:this._currentVisibleMeshes,unseen:this._recentlyHiddenMeshes}),this._isWorkerBusy=!1}),this.worker.addEventListener("message",this.handleWorkerMessage),this.onViewUpdated.add(({seen:s,unseen:i})=>{for(const n of s)n.visible=!0;for(const n of i)n.visible=!1})}get threshold(){return this.config.threshold}set threshold(e){this.config.threshold=e}dispose(){super.dispose(),this._currentVisibleMeshes.clear(),this._recentlyHiddenMeshes.clear(),this._meshIDColorCodeMap.clear(),this._transparentMat.dispose(),this._colorCodeMeshMap.clear();const e=this.components.get(ds);for(const t in this.colorMeshes){const s=this.colorMeshes.get(t);s&&e.destroy(s,!0)}this.colorMeshes.clear()}add(e){if(!this.enabled)return;if(this.preventUpdate){console.log("Culler processing not finished yet.");return}this.preventUpdate=!0;const t=e instanceof Gt,{geometry:s,material:i}=e,{colorMaterial:n,code:r}=this.getAvailableMaterial();let o;if(Array.isArray(i)){let h=!0;const I=[];for(const d of i)Ur.isTransparent(d)?I.push(this._transparentMat):(h=!1,I.push(n));if(h){n.dispose(),this.preventUpdate=!1;return}o=I}else if(Ur.isTransparent(i)){n.dispose(),this.preventUpdate=!1;return}else o=n;this._colorCodeMeshMap.set(r,e),this._meshIDColorCodeMap.set(e.uuid,r);const a=t?e.count:1,c=new Gt(s,o,a);t?c.instanceMatrix=e.instanceMatrix:c.setMatrixAt(0,new Ee),e.visible=!1,e.updateWorldMatrix(!0,!1),c.applyMatrix4(e.matrixWorld),c.updateMatrix(),this.scene.add(c),this.colorMeshes.set(e.uuid,c),this.increaseColor(),this.preventUpdate=!1}remove(e){if(this.preventUpdate){console.log("Culler processing not finished yet.");return}this.preventUpdate=!0;const t=this.components.get(ds);this._currentVisibleMeshes.delete(e),this._recentlyHiddenMeshes.delete(e);const s=this.colorMeshes.get(e.uuid),i=this._meshIDColorCodeMap.get(e.uuid);if(!s||!i){this.preventUpdate=!1;return}this._colorCodeMeshMap.delete(i),this._meshIDColorCodeMap.delete(e.uuid),this.colorMeshes.delete(e.uuid),s.geometry=void 0,s.material=[],t.destroy(s,!0),this._recentlyHiddenMeshes.delete(e),this._currentVisibleMeshes.delete(e),this.preventUpdate=!1}updateInstanced(e){for(const t of e){const s=this.colorMeshes.get(t.uuid);s&&(s.count=t.count)}}getAvailableMaterial(){const{r:e,g:t,b:s,code:i}=this.getAvailableColor(),n=Gi.enabled;Gi.enabled=!1;const r=new Ue(`rgb(${e}, ${t}, ${s})`);if(!this.world.renderer)throw new Error("Renderer not found in the world!");const o=this.world.renderer.clippingPlanes,a=new us({color:r,clippingPlanes:o,side:ks});return Gi.enabled=n,{colorMaterial:a,code:i}}}const vo=class gn extends Ae{constructor(e){super(e),p(this,"onDisposed",new $),p(this,"_enabled",!0),p(this,"list",new Map),e.add(gn.uuid,this)}get enabled(){return this._enabled}set enabled(e){this._enabled=e;for(const[t,s]of this.list)s.enabled=e}create(e){if(this.list.has(e.uuid))return this.list.get(e.uuid);const t=new Vc(this.components,e);return this.list.set(e.uuid,t),t}delete(e){const t=this.list.get(e.uuid);t&&t.dispose(),this.list.delete(e.uuid)}dispose(){this.enabled=!1,this.onDisposed.trigger(gn.uuid),this.onDisposed.reset();for(const[e,t]of this.list)t.dispose();this.list.clear()}updateInstanced(e){for(const[,t]of this.list)t.updateInstanced(e)}};p(vo,"uuid","69f2a50d-c266-44fc-b1bd-fa4d34be89e6");let Gc=vo;class zc{constructor(e,t){if(p(this,"onDisposed",new $),p(this,"onDistanceComputed",new $),p(this,"excludedObjects",new Set),p(this,"enabled",!0),p(this,"renderDebugFrame",!1),p(this,"components"),p(this,"scene",new vi),p(this,"camera",new zt(-1,1,1,-1,0,1)),p(this,"depthMaterial"),p(this,"world"),p(this,"renderer"),p(this,"worker"),p(this,"_width",512),p(this,"_height",512),p(this,"_postQuad"),p(this,"tempRT"),p(this,"resultRT"),p(this,"bufferSize"),p(this,"_buffer"),p(this,"_isWorkerBusy",!1),p(this,"compute",async()=>{if(!this.enabled||this.world.isDisposing||this._isWorkerBusy)return;this._isWorkerBusy=!0,this.world.camera.three.updateMatrix(),this.renderer.setSize(this._width,this._height),this.renderer.setRenderTarget(this.tempRT);const o="visibilityBeforeDistanceCheck";for(const c of this.excludedObjects)c.userData[o]=c.visible,c.visible=!1;this.renderer.render(this.world.scene.three,this.world.camera.three);for(const c of this.excludedObjects)c.userData[o]!==void 0&&(c.visible=c.userData[o]);this.depthMaterial.uniforms.tDiffuse.value=this.tempRT.texture,this.depthMaterial.uniforms.tDepth.value=this.tempRT.depthTexture,this.renderer.setRenderTarget(this.resultRT),this.renderer.render(this.scene,this.camera);const a=this.renderer.getContext();try{await Po(a,0,0,this._width,this._height,a.RGBA,a.UNSIGNED_BYTE,this._buffer)}catch{this.renderer.setRenderTarget(null),this._isWorkerBusy=!1;return}this.renderer.setRenderTarget(null),this.renderDebugFrame&&this.renderer.render(this.scene,this.camera),this.worker.postMessage({buffer:this._buffer})}),p(this,"handleWorkerMessage",o=>{if(!this.enabled||this.world.isDisposing)return;const a=o.data.colors;let c=Number.MAX_VALUE;for(const u of a)u!==0&&u<c&&(c=u);const h=this.world.camera.three||zt,I=(c/255-1)*-1*(h.far-h.near),d=Math.min(I,h.far);this.onDistanceComputed.trigger(d),this._isWorkerBusy=!1}),!t.renderer)throw new Error("The given world must have a renderer!");this.components=e,this.world=t;const s=t.camera.three;this.renderer=new Ys,this.tempRT=new yi(this._width,this._height),this.bufferSize=this._width*this._height*4,this._buffer=new Uint8Array(this.bufferSize),this.tempRT.texture.minFilter=cr,this.tempRT.texture.magFilter=cr,this.tempRT.stencilBuffer=!1,this.tempRT.samples=0,this.tempRT.depthTexture=new Ua(this._width,this._height),this.tempRT.depthTexture.format=xa,this.tempRT.depthTexture.type=Ba,this.resultRT=new yi(this._width,this._height),this.depthMaterial=new uo({vertexShader:`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
    `,fragmentShader:`
#include <packing>

varying vec2 vUv;
uniform sampler2D tDiffuse;
uniform sampler2D tDepth;
uniform float cameraNear;
uniform float cameraFar;


float readDepth( sampler2D depthSampler, vec2 coord ) {
  float fragCoordZ = texture2D( depthSampler, coord ).x;
  float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );
  return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );
}

void main() {
  //vec3 diffuse = texture2D( tDiffuse, vUv ).rgb;
  float depth = readDepth( tDepth, vUv );

  gl_FragColor.rgb = 1.0 - vec3( depth );
  gl_FragColor.a = 1.0;
}
    `,uniforms:{cameraNear:{value:s.near},cameraFar:{value:s.far},tDiffuse:{value:null},tDepth:{value:null}}});const i=new Mi(2,2);this._postQuad=new se(i,this.depthMaterial),this.scene.add(this._postQuad),this.renderer.clippingPlanes=t.renderer.clippingPlanes;const n=`
      addEventListener("message", (event) => {
        const { buffer } = event.data;
        const colors = new Set();
        for (let i = 0; i < buffer.length; i += 4) {
          const r = buffer[i];
          colors.add(r);
        }
        postMessage({ colors });
      });
    `,r=new Blob([n],{type:"application/javascript"});this.worker=new Worker(URL.createObjectURL(r)),this.worker.addEventListener("message",this.handleWorkerMessage)}dispose(){this.enabled=!1,this.onDistanceComputed.reset(),this.worker.terminate(),this.renderer.forceContextLoss(),this.renderer.dispose(),this.tempRT.dispose(),this.resultRT.dispose();const e=[...this.scene.children];this.excludedObjects.clear();for(const t of e)t.removeFromParent();this._postQuad.geometry.dispose(),this._postQuad.removeFromParent(),this._buffer=null,this.onDisposed.reset()}}class Ku extends Pc{constructor(){super(...arguments),p(this,"_distanceRenderer"),p(this,"autoBias",!0),p(this,"_defaultShadowConfig",{cascade:1,resolution:512}),p(this,"_lightsWithShadow",new Map),p(this,"_isComputingShadows",!1),p(this,"_shadowsEnabled",!0),p(this,"_bias",0),p(this,"recomputeShadows",e=>{if(!this._shadowsEnabled)return;if(this.autoBias&&(this.bias=e/-1e5),e*=1.5,!this.currentWorld)throw new Error("A world needs to be assigned to the scene before computing shadows!");if(!this._lightsWithShadow.size)throw new Error("No shadows found!");const t=this.currentWorld.camera.three;if(!(t instanceof Mn)&&!(t instanceof zt))throw new Error("Invalid camera type!");const s=new U;t.getWorldDirection(s);let i=e;const n=new U;n.copy(this.config.directionalLight.position),n.normalize();for(const[r,o]of this._lightsWithShadow){const a=this.directionalLights.get(o);if(!a)throw new Error("Light not found.");const c=new U;c.copy(s);const h=r===this._lightsWithShadow.size-1,I=h?i/2:i*2/3;c.multiplyScalar(I),c.add(t.position);const d=i-I,u=new U;u.copy(n),u.multiplyScalar(d),a.target.position.copy(c),a.position.copy(c),a.position.add(u),a.shadow.camera.right=d,a.shadow.camera.left=-d,a.shadow.camera.top=d,a.shadow.camera.bottom=-d,a.shadow.camera.far=d*2,a.shadow.camera.updateProjectionMatrix(),a.shadow.camera.updateMatrix(),h||(i/=3)}this._isComputingShadows=!1})}get bias(){return this._bias}set bias(e){this._bias=e;for(const[,t]of this._lightsWithShadow){const s=this.directionalLights.get(t);s&&(s.shadow.bias=e)}}get shadowsEnabled(){return this._shadowsEnabled}set shadowsEnabled(e){this._shadowsEnabled=e;for(const[,t]of this.directionalLights)t.castShadow=e}get distanceRenderer(){if(!this._distanceRenderer)throw new Error("You must set up this component before accessing the distance renderer!");return this._distanceRenderer}setup(e){super.setup(e);const t={...this._defaultConfig,...this._defaultShadowConfig,...e};if(t.cascade<=0)throw new Error("Config.shadows.cascade must be a natural number greater than 0!");if(t.cascade>1)throw new Error("Multiple shadows not supported yet!");if(!this.currentWorld)throw new Error("A world needs to be assigned to the scene before setting it up!");for(const[,s]of this.directionalLights)s.target.removeFromParent(),s.removeFromParent(),s.dispose();this.directionalLights.clear(),this._distanceRenderer||(this._distanceRenderer=new zc(this.components,this.currentWorld),this._distanceRenderer.onDistanceComputed.add(this.recomputeShadows)),this._lightsWithShadow.clear();for(let s=0;s<t.cascade;s++){const i=new ho;i.intensity=this.config.directionalLight.intensity,i.color=this.config.directionalLight.color,i.position.copy(this.config.directionalLight.position),i.shadow.mapSize.width=t.resolution,i.shadow.mapSize.height=t.resolution,this.three.add(i,i.target),this.directionalLights.set(i.uuid,i),this._lightsWithShadow.set(s,i.uuid),i.castShadow=!0,i.shadow.bias=this._bias}}dispose(){super.dispose(),this._distanceRenderer&&this._distanceRenderer.dispose(),this._lightsWithShadow.clear()}async updateShadows(){this._isComputingShadows||!this._shadowsEnabled||(this._isComputingShadows=!0,await this.distanceRenderer.compute())}}class kc{constructor(e){p(this,"_event"),p(this,"_position",new He),p(this,"onDisposed",new $),p(this,"updateMouseInfo",t=>{this._event=t}),this.dom=e,this.setupEvents(!0)}get position(){if(this._event){const e=this.dom.getBoundingClientRect();this._position.x=this.getPositionX(e,this._event),this._position.y=this.getPositionY(e,this._event)}return this._position}dispose(){this.setupEvents(!1),this.onDisposed.trigger(),this.onDisposed.reset()}getPositionY(e,t){return-((this.getDataObject(t).clientY-e.top)/(e.bottom-e.top))*2+1}getPositionX(e,t){return(this.getDataObject(t).clientX-e.left)/(e.right-e.left)*2-1}getDataObject(e){return e instanceof MouseEvent?e:e.touches[0]}setupEvents(e){e?(this.dom.addEventListener("pointermove",this.updateMouseInfo),this.dom.addEventListener("touchstart",this.updateMouseInfo)):(this.dom.removeEventListener("pointermove",this.updateMouseInfo),this.dom.removeEventListener("touchstart",this.updateMouseInfo))}}class Hc{constructor(e,t){p(this,"enabled",!0),p(this,"components"),p(this,"onDisposed",new $),p(this,"mouse"),p(this,"three",new Dn),p(this,"world");const s=t.renderer;if(!s)throw new Error("A renderer is needed for the raycaster to work!");this.world=t,this.mouse=new kc(s.three.domElement),this.components=e}dispose(){this.mouse.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}castRay(e=Array.from(this.world.meshes)){if(!this.world)throw new Error("A world is needed to cast rays!");const t=this.world.camera.three;return this.three.setFromCamera(this.mouse.position,t),this.intersect(e)}castRayFromVector(e,t,s=Array.from(this.world.meshes)){return this.three.set(e,t),this.intersect(s)}intersect(e=Array.from(this.world.meshes)){const t=this.three.intersectObjects(e),s=this.filterClippingPlanes(t);return s.length>0?s[0]:null}filterClippingPlanes(e){if(!this.world.renderer)throw new Error("Renderer not found!");const t=this.world.renderer.three;if(!t.clippingPlanes)return e;const s=t.clippingPlanes;return e.length<=0||!s||(s==null?void 0:s.length)<=0?e:e.filter(i=>s.every(n=>n.distanceToPoint(i.point)>0))}}const Mo=class Do extends Ae{constructor(e){super(e),p(this,"enabled",!0),p(this,"list",new Map),p(this,"onDisposed",new $),e.add(Do.uuid,this)}get(e){if(this.list.has(e.uuid))return this.list.get(e.uuid);const t=new Hc(this.components,e);return this.list.set(e.uuid,t),e.onDisposed.add(()=>{this.delete(e)}),t}delete(e){const t=this.list.get(e.uuid);t&&t.dispose(),this.list.delete(e.uuid)}dispose(){for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}};p(Mo,"uuid","d5d8bdf0-db25-4952-b951-b643af207ace");let Fn=Mo;class Wc extends Ht{constructor(){super(...arguments),p(this,"_config",{visible:{value:!0,type:"Boolean"},color:{value:new Ue,type:"Color"},primarySize:{type:"Number",interpolable:!0,value:1,min:0,max:1e3},secondarySize:{type:"Number",interpolable:!0,value:10,min:0,max:1e3},distance:{type:"Number",interpolable:!0,value:500,min:0,max:500}})}get visible(){return this._config.visible.value}set visible(e){this._config.visible.value=e,this._component.visible=e}get color(){return this._config.color.value}set color(e){this._config.color.value=e,this._component.material.uniforms.uColor.value=e,this._component.material.uniformsNeedUpdate=!0}get primarySize(){return this._config.primarySize.value}set primarySize(e){this._config.primarySize.value=e,this._component.material.uniforms.uSize1.value=e,this._component.material.uniformsNeedUpdate=!0}get secondarySize(){return this._config.secondarySize.value}set secondarySize(e){this._config.secondarySize.value=e,this._component.material.uniforms.uSize2.value=e,this._component.material.uniformsNeedUpdate=!0}get distance(){return this._config.distance.value}set distance(e){this._config.distance.value=e,this._component.material.uniforms.uDistance.value=e,this._component.material.uniformsNeedUpdate=!0}}class Xc{constructor(e,t){p(this,"onDisposed",new $),p(this,"onSetup",new $),p(this,"isSetup",!1),p(this,"world"),p(this,"components"),p(this,"config"),p(this,"_defaultConfig",{visible:!0,color:new Ue(12303291),primarySize:1,secondarySize:10,distance:500}),p(this,"three"),p(this,"_fade",3),p(this,"updateZoom",()=>{this.world.camera instanceof zs&&(this.material.uniforms.uZoom.value=this.world.camera.three.zoom)}),this.world=t;const{color:s,primarySize:i,secondarySize:n,distance:r}=this._defaultConfig;this.components=e,this.config=new Wc(this,this.components,"Grid");const o=new Mi(2,2,1,1),a=new uo({side:ks,uniforms:{uSize1:{value:i},uSize2:{value:n},uColor:{value:s},uDistance:{value:r},uFade:{value:this._fade},uZoom:{value:1}},transparent:!0,vertexShader:`
            
            varying vec3 worldPosition;
            
            uniform float uDistance;
            
            void main() {
            
                    vec3 pos = position.xzy * uDistance;
                    pos.xz += cameraPosition.xz;
                    
                    worldPosition = pos;
                    
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
            
            }
            `,fragmentShader:`
            
            varying vec3 worldPosition;
            
            uniform float uZoom;
            uniform float uFade;
            uniform float uSize1;
            uniform float uSize2;
            uniform vec3 uColor;
            uniform float uDistance;
                
                
                
                float getGrid(float size) {
                
                    vec2 r = worldPosition.xz / size;
                    
                    
                    vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
                    float line = min(grid.x, grid.y);
                    
                
                    return 1.0 - min(line, 1.0);
                }
                
            void main() {
            
                    
                    float d = 1.0 - min(distance(cameraPosition.xz, worldPosition.xz) / uDistance, 1.0);
                    
                    float g1 = getGrid(uSize1);
                    float g2 = getGrid(uSize2);
                    
                    // Ortho camera fades the grid away when zooming out
                    float minZoom = step(0.2, uZoom);
                    float zoomFactor = pow(min(uZoom, 1.), 2.) * minZoom;
                    
                    gl_FragColor = vec4(uColor.rgb, mix(g2, g1, g1) * pow(d, uFade));
                    gl_FragColor.a = mix(0.5 * gl_FragColor.a, gl_FragColor.a, g2) * zoomFactor;
                    
                    if ( gl_FragColor.a <= 0.0 ) discard;
                    
            
            }
            
            `,extensions:{derivatives:!0}});this.three=new se(o,a),this.three.frustumCulled=!1,t.scene.three.add(this.three),this.setupEvents(!0)}get visible(){return this.three.visible}set visible(e){e?this.world.scene.three.add(this.three):this.three.removeFromParent()}get material(){return this.three.material}get fade(){return this._fade===3}set fade(e){this._fade=e?3:0,this.material.uniforms.uFade.value=this._fade}setup(e){const t={...this._defaultConfig,...e};this.config.visible=!0,this.config.color=t.color,this.config.primarySize=t.primarySize,this.config.secondarySize=t.secondarySize,this.config.distance=t.distance,this.isSetup=!0,this.onSetup.trigger()}dispose(){this.setupEvents(!1),this.components.get(Ws).list.delete(this.config.uuid),this.components.get(ds).destroy(this.three),this.onDisposed.trigger(),this.onDisposed.reset(),this.world=null,this.components=null}setupEvents(e){if(this.world.isDisposing||!(this.world.camera instanceof zs))return;const t=this.world.camera.controls;e?t.addEventListener("update",this.updateZoom):t.removeEventListener("update",this.updateZoom)}}const bo=class Uo extends Ae{constructor(e){super(e),p(this,"list",new Map),p(this,"onDisposed",new $),p(this,"enabled",!0),e.add(Uo.uuid,this)}create(e){if(this.list.has(e.uuid))throw new Error("This world already has a grid!");const t=new Xc(this.components,e);return this.list.set(e.uuid,t),e.onDisposed.add(()=>{this.delete(e)}),t}delete(e){const t=this.list.get(e.uuid);t&&t.dispose(),this.list.delete(e.uuid)}dispose(){for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}};p(bo,"uuid","d1e814d5-b81c-4452-87a2-f039375e0489");let Ju=bo;const Ut=new Dn,De=new U,At=new U,Se=new st,Wr={X:new U(1,0,0),Y:new U(0,1,0),Z:new U(0,0,1)},ln={type:"change"},Xr={type:"mouseDown"},jr={type:"mouseUp",mode:null},Zr={type:"objectChange"};class jc extends Li{constructor(e,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const s=new Jc;this._gizmo=s,this.add(s);const i=new eh;this._plane=i,this.add(i);const n=this;function r(R,A){let m=A;Object.defineProperty(n,R,{get:function(){return m!==void 0?m:A},set:function(S){m!==S&&(m=S,i[R]=S,s[R]=S,n.dispatchEvent({type:R+"-changed",value:S}),n.dispatchEvent(ln))}}),n[R]=A,i[R]=A,s[R]=A}r("camera",e),r("object",void 0),r("enabled",!0),r("axis",null),r("mode","translate"),r("translationSnap",null),r("rotationSnap",null),r("scaleSnap",null),r("space","world"),r("size",1),r("dragging",!1),r("showX",!0),r("showY",!0),r("showZ",!0);const o=new U,a=new U,c=new st,h=new st,I=new U,d=new st,u=new U,f=new U,E=new U,C=0,T=new U;r("worldPosition",o),r("worldPositionStart",a),r("worldQuaternion",c),r("worldQuaternionStart",h),r("cameraPosition",I),r("cameraQuaternion",d),r("pointStart",u),r("pointEnd",f),r("rotationAxis",E),r("rotationAngle",C),r("eye",T),this._offset=new U,this._startNorm=new U,this._endNorm=new U,this._cameraScale=new U,this._parentPosition=new U,this._parentQuaternion=new st,this._parentQuaternionInv=new st,this._parentScale=new U,this._worldScaleStart=new U,this._worldQuaternionInv=new st,this._worldScale=new U,this._positionStart=new U,this._quaternionStart=new st,this._scaleStart=new U,this._getPointer=Zc.bind(this),this._onPointerDown=qc.bind(this),this._onPointerHover=$c.bind(this),this._onPointerMove=Qc.bind(this),this._onPointerUp=Kc.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;Ut.setFromCamera(e,this.camera);const t=cn(this._gizmo.picker[this.mode],Ut);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e.button!==0)&&this.axis!==null){Ut.setFromCamera(e,this.camera);const t=cn(this._plane,Ut,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,Xr.mode=this.mode,this.dispatchEvent(Xr)}}pointerMove(e){const t=this.axis,s=this.mode,i=this.object;let n=this.space;if(s==="scale"?n="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(n="world"),i===void 0||t===null||this.dragging===!1||e.button!==-1)return;Ut.setFromCamera(e,this.camera);const r=cn(this._plane,Ut,!0);if(r){if(this.pointEnd.copy(r.point).sub(this.worldPositionStart),s==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),n==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),n==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(n==="local"&&(i.position.applyQuaternion(Se.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),n==="world"&&(i.parent&&i.position.add(De.setFromMatrixPosition(i.parent.matrixWorld)),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(De.setFromMatrixPosition(i.parent.matrixWorld))));else if(s==="scale"){if(t.search("XYZ")!==-1){let o=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(o*=-1),At.set(o,o,o)}else De.copy(this.pointStart),At.copy(this.pointEnd),De.applyQuaternion(this._worldQuaternionInv),At.applyQuaternion(this._worldQuaternionInv),At.divide(De),t.search("X")===-1&&(At.x=1),t.search("Y")===-1&&(At.y=1),t.search("Z")===-1&&(At.z=1);i.scale.copy(this._scaleStart).multiply(At),this.scaleSnap&&(t.search("X")!==-1&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(s==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const o=20/this.worldPosition.distanceTo(De.setFromMatrixPosition(this.camera.matrixWorld));let a=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(De.copy(this.rotationAxis).cross(this.eye))*o):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(Wr[t]),De.copy(Wr[t]),n==="local"&&De.applyQuaternion(this.worldQuaternion),De.cross(this.eye),De.length()===0?a=!0:this.rotationAngle=this._offset.dot(De.normalize())*o),(t==="E"||a)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),n==="local"&&t!=="E"&&t!=="XYZE"?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(Se.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(Se.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(ln),this.dispatchEvent(Zr)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(jr.mode=this.mode,this.dispatchEvent(jr)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(ln),this.dispatchEvent(Zr),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Ut}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function Zc(l){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:l.button};{const e=this.domElement.getBoundingClientRect();return{x:(l.clientX-e.left)/e.width*2-1,y:-(l.clientY-e.top)/e.height*2+1,button:l.button}}}function $c(l){if(this.enabled)switch(l.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(l));break}}function qc(l){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(l.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(l)),this.pointerDown(this._getPointer(l)))}function Qc(l){this.enabled&&this.pointerMove(this._getPointer(l))}function Kc(l){this.enabled&&(this.domElement.releasePointerCapture(l.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(l)))}function cn(l,e,t){const s=e.intersectObject(l,!0);for(let i=0;i<s.length;i++)if(s[i].object.visible||t)return s[i];return!1}const fi=new ol,Ce=new U(0,1,0),$r=new U(0,0,0),qr=new Ee,pi=new st,Si=new st,ct=new U,Qr=new Ee,Ds=new U(1,0,0),xt=new U(0,1,0),bs=new U(0,0,1),Ci=new U,ws=new U,Ps=new U;class Jc extends Li{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new us({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new fo({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=e.clone();s.opacity=.15;const i=t.clone();i.opacity=.5;const n=e.clone();n.color.setHex(16711680);const r=e.clone();r.color.setHex(65280);const o=e.clone();o.color.setHex(255);const a=e.clone();a.color.setHex(16711680),a.opacity=.5;const c=e.clone();c.color.setHex(65280),c.opacity=.5;const h=e.clone();h.color.setHex(255),h.opacity=.5;const I=e.clone();I.opacity=.25;const d=e.clone();d.color.setHex(16776960),d.opacity=.25,e.clone().color.setHex(16776960);const u=e.clone();u.color.setHex(7895160);const f=new xe(0,.04,.1,12);f.translate(0,.05,0);const E=new Me(.08,.08,.08);E.translate(0,.04,0);const C=new Vs;C.setAttribute("position",new Er([0,0,0,1,0,0],3));const T=new xe(.0075,.0075,.5,3);T.translate(0,.25,0);function R(F,b){const Z=new Ts(F,.0075,3,64,b*Math.PI*2);return Z.rotateY(Math.PI/2),Z.rotateX(Math.PI/2),Z}function A(){const F=new Vs;return F.setAttribute("position",new Er([0,0,0,1,1,1],3)),F}const m={X:[[new se(f,n),[.5,0,0],[0,0,-Math.PI/2]],[new se(f,n),[-.5,0,0],[0,0,Math.PI/2]],[new se(T,n),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new se(f,r),[0,.5,0]],[new se(f,r),[0,-.5,0],[Math.PI,0,0]],[new se(T,r)]],Z:[[new se(f,o),[0,0,.5],[Math.PI/2,0,0]],[new se(f,o),[0,0,-.5],[-Math.PI/2,0,0]],[new se(T,o),null,[Math.PI/2,0,0]]],XYZ:[[new se(new Zs(.1,0),I.clone()),[0,0,0]]],XY:[[new se(new Me(.15,.15,.01),h.clone()),[.15,.15,0]]],YZ:[[new se(new Me(.15,.15,.01),a.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new se(new Me(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},S={X:[[new se(new xe(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new se(new xe(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new se(new xe(.2,0,.6,4),s),[0,.3,0]],[new se(new xe(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new se(new xe(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new se(new xe(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new se(new Zs(.2,0),s)]],XY:[[new se(new Me(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new se(new Me(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new se(new Me(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},N={START:[[new se(new Zs(.01,2),i),null,null,null,"helper"]],END:[[new se(new Zs(.01,2),i),null,null,null,"helper"]],DELTA:[[new Ft(A(),i),null,null,null,"helper"]],X:[[new Ft(C,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ft(C,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ft(C,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},y={XYZE:[[new se(R(.5,1),u),null,[0,Math.PI/2,0]]],X:[[new se(R(.5,.5),n)]],Y:[[new se(R(.5,.5),r),null,[0,0,-Math.PI/2]]],Z:[[new se(R(.5,.5),o),null,[0,Math.PI/2,0]]],E:[[new se(R(.75,1),d),null,[0,Math.PI/2,0]]]},P={AXIS:[[new Ft(C,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},_={XYZE:[[new se(new el(.25,10,8),s)]],X:[[new se(new Ts(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new se(new Ts(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new se(new Ts(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new se(new Ts(.75,.1,2,24),s)]]},M={X:[[new se(E,n),[.5,0,0],[0,0,-Math.PI/2]],[new se(T,n),[0,0,0],[0,0,-Math.PI/2]],[new se(E,n),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new se(E,r),[0,.5,0]],[new se(T,r)],[new se(E,r),[0,-.5,0],[0,0,Math.PI]]],Z:[[new se(E,o),[0,0,.5],[Math.PI/2,0,0]],[new se(T,o),[0,0,0],[Math.PI/2,0,0]],[new se(E,o),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new se(new Me(.15,.15,.01),h),[.15,.15,0]]],YZ:[[new se(new Me(.15,.15,.01),a),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new se(new Me(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new se(new Me(.1,.1,.1),I.clone())]]},B={X:[[new se(new xe(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new se(new xe(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new se(new xe(.2,0,.6,4),s),[0,.3,0]],[new se(new xe(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new se(new xe(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new se(new xe(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new se(new Me(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new se(new Me(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new se(new Me(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new se(new Me(.2,.2,.2),s),[0,0,0]]]},O={X:[[new Ft(C,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ft(C,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ft(C,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function v(F){const b=new Li;for(const Z in F)for(let z=F[Z].length;z--;){const J=F[Z][z][0].clone(),X=F[Z][z][1],ne=F[Z][z][2],V=F[Z][z][3],Y=F[Z][z][4];J.name=Z,J.tag=Y,X&&J.position.set(X[0],X[1],X[2]),ne&&J.rotation.set(ne[0],ne[1],ne[2]),V&&J.scale.set(V[0],V[1],V[2]),J.updateMatrix();const ie=J.geometry.clone();ie.applyMatrix4(J.matrix),J.geometry=ie,J.renderOrder=1/0,J.position.set(0,0,0),J.rotation.set(0,0,0),J.scale.set(1,1,1),b.add(J)}return b}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=v(m)),this.add(this.gizmo.rotate=v(y)),this.add(this.gizmo.scale=v(M)),this.add(this.picker.translate=v(S)),this.add(this.picker.rotate=v(_)),this.add(this.picker.scale=v(B)),this.add(this.helper.translate=v(N)),this.add(this.helper.rotate=v(P)),this.add(this.helper.scale=v(O)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:Si;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let i=0;i<s.length;i++){const n=s[i];n.visible=!0,n.rotation.set(0,0,0),n.position.copy(this.worldPosition);let r;if(this.camera.isOrthographicCamera?r=(this.camera.top-this.camera.bottom)/this.camera.zoom:r=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),n.scale.set(1,1,1).multiplyScalar(r*this.size/4),n.tag==="helper"){n.visible=!1,n.name==="AXIS"?(n.visible=!!this.axis,this.axis==="X"&&(Se.setFromEuler(fi.set(0,0,0)),n.quaternion.copy(t).multiply(Se),Math.abs(Ce.copy(Ds).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="Y"&&(Se.setFromEuler(fi.set(0,0,Math.PI/2)),n.quaternion.copy(t).multiply(Se),Math.abs(Ce.copy(xt).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="Z"&&(Se.setFromEuler(fi.set(0,Math.PI/2,0)),n.quaternion.copy(t).multiply(Se),Math.abs(Ce.copy(bs).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="XYZE"&&(Se.setFromEuler(fi.set(0,Math.PI/2,0)),Ce.copy(this.rotationAxis),n.quaternion.setFromRotationMatrix(qr.lookAt($r,Ce,xt)),n.quaternion.multiply(Se),n.visible=this.dragging),this.axis==="E"&&(n.visible=!1)):n.name==="START"?(n.position.copy(this.worldPositionStart),n.visible=this.dragging):n.name==="END"?(n.position.copy(this.worldPosition),n.visible=this.dragging):n.name==="DELTA"?(n.position.copy(this.worldPositionStart),n.quaternion.copy(this.worldQuaternionStart),De.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),De.applyQuaternion(this.worldQuaternionStart.clone().invert()),n.scale.copy(De),n.visible=this.dragging):(n.quaternion.copy(t),this.dragging?n.position.copy(this.worldPositionStart):n.position.copy(this.worldPosition),this.axis&&(n.visible=this.axis.search(n.name)!==-1));continue}n.quaternion.copy(t),this.mode==="translate"||this.mode==="scale"?(n.name==="X"&&Math.abs(Ce.copy(Ds).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="Y"&&Math.abs(Ce.copy(xt).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="Z"&&Math.abs(Ce.copy(bs).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="XY"&&Math.abs(Ce.copy(bs).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="YZ"&&Math.abs(Ce.copy(Ds).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="XZ"&&Math.abs(Ce.copy(xt).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1)):this.mode==="rotate"&&(pi.copy(t),Ce.copy(this.eye).applyQuaternion(Se.copy(t).invert()),n.name.search("E")!==-1&&n.quaternion.setFromRotationMatrix(qr.lookAt(this.eye,$r,xt)),n.name==="X"&&(Se.setFromAxisAngle(Ds,Math.atan2(-Ce.y,Ce.z)),Se.multiplyQuaternions(pi,Se),n.quaternion.copy(Se)),n.name==="Y"&&(Se.setFromAxisAngle(xt,Math.atan2(Ce.x,Ce.z)),Se.multiplyQuaternions(pi,Se),n.quaternion.copy(Se)),n.name==="Z"&&(Se.setFromAxisAngle(bs,Math.atan2(Ce.y,Ce.x)),Se.multiplyQuaternions(pi,Se),n.quaternion.copy(Se))),n.visible=n.visible&&(n.name.indexOf("X")===-1||this.showX),n.visible=n.visible&&(n.name.indexOf("Y")===-1||this.showY),n.visible=n.visible&&(n.name.indexOf("Z")===-1||this.showZ),n.visible=n.visible&&(n.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),n.material._color=n.material._color||n.material.color.clone(),n.material._opacity=n.material._opacity||n.material.opacity,n.material.color.copy(n.material._color),n.material.opacity=n.material._opacity,this.enabled&&this.axis&&(n.name===this.axis||this.axis.split("").some(function(o){return n.name===o}))&&(n.material.color.setHex(16776960),n.material.opacity=1)}super.updateMatrixWorld(e)}}class eh extends se{constructor(){super(new Mi(1e5,1e5,2,2),new us({visible:!1,wireframe:!0,side:ks,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),Ci.copy(Ds).applyQuaternion(t==="local"?this.worldQuaternion:Si),ws.copy(xt).applyQuaternion(t==="local"?this.worldQuaternion:Si),Ps.copy(bs).applyQuaternion(t==="local"?this.worldQuaternion:Si),Ce.copy(ws),this.mode){case"translate":case"scale":switch(this.axis){case"X":Ce.copy(this.eye).cross(Ci),ct.copy(Ci).cross(Ce);break;case"Y":Ce.copy(this.eye).cross(ws),ct.copy(ws).cross(Ce);break;case"Z":Ce.copy(this.eye).cross(Ps),ct.copy(Ps).cross(Ce);break;case"XY":ct.copy(Ps);break;case"YZ":ct.copy(Ci);break;case"XZ":Ce.copy(Ps),ct.copy(ws);break;case"XYZ":case"E":ct.set(0,0,0);break}break;case"rotate":default:ct.set(0,0,0)}ct.length()===0?this.quaternion.copy(this.cameraQuaternion):(Qr.lookAt(De.set(0,0,0),ct,Ce),this.quaternion.setFromRotationMatrix(Qr)),super.updateMatrixWorld(e)}}class sr{constructor(e,t,s,i,n,r=5,o=!0){if(p(this,"onDraggingStarted",new $),p(this,"onDraggingEnded",new $),p(this,"onDisposed",new $),p(this,"normal"),p(this,"origin"),p(this,"three",new Is),p(this,"components"),p(this,"world"),p(this,"type","default"),p(this,"_helper"),p(this,"_visible",!0),p(this,"_enabled",!0),p(this,"_controlsActive",!1),p(this,"_arrowBoundBox",new se),p(this,"_planeMesh"),p(this,"_controls"),p(this,"_hiddenMaterial",new us({visible:!1})),p(this,"update",()=>{this._enabled&&this.three.setFromNormalAndCoplanarPoint(this.normal,this._helper.position)}),p(this,"changeDrag",a=>{this._visible=!a.value,this.preventCameraMovement(),this.notifyDraggingChanged(a)}),this.components=e,this.world=t,!t.renderer)throw new Error("The given world must have a renderer!");this.normal=i,this.origin=s,t.renderer.setPlane(!0,this.three),this._planeMesh=sr.newPlaneMesh(r,n),this._helper=this.newHelper(),this._controls=this.newTransformControls(),this.three.setFromNormalAndCoplanarPoint(i,s),o&&this.toggleControls(!0)}get enabled(){return this._enabled}set enabled(e){if(!this.world.isDisposing){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");this._enabled=e,this.world.renderer.setPlane(e,this.three)}}get visible(){return this._visible}set visible(e){this._visible=e,this._controls.visible=e,this._helper.visible=e,this.toggleControls(e)}get meshes(){return[this._planeMesh,this._arrowBoundBox]}get planeMaterial(){return this._planeMesh.material}set planeMaterial(e){this._planeMesh.material=e}get size(){return this._planeMesh.scale.x}set size(e){this._planeMesh.scale.set(e,e,e)}get helper(){return this._helper}setFromNormalAndCoplanarPoint(e,t){this.reset(),this.normal.equals(e)||(this.normal.copy(e),this._helper.lookAt(e)),this.origin.copy(t),this._helper.position.copy(t),this._helper.updateMatrix(),this.update()}dispose(){this._enabled=!1,this.onDraggingStarted.reset(),this.onDraggingEnded.reset(),this._helper.removeFromParent(),this.world.renderer&&this.world.renderer.setPlane(!1,this.three),this._arrowBoundBox.removeFromParent(),this._arrowBoundBox.geometry.dispose(),this._planeMesh.geometry.dispose(),this._controls.removeFromParent(),this._controls.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}reset(){const e=new U(1,0,0),t=new U;this.normal.equals(e)||(this.normal.copy(e),this._helper.lookAt(e)),this.origin.copy(t),this._helper.position.copy(t),this._helper.updateMatrix()}toggleControls(e){if(e){if(this._controlsActive)return;this._controls.addEventListener("change",this.update),this._controls.addEventListener("dragging-changed",this.changeDrag)}else this._controls.removeEventListener("change",this.update),this._controls.removeEventListener("dragging-changed",this.changeDrag);this._controlsActive=e}newTransformControls(){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");const e=this.world.camera.three,t=this.world.renderer.three.domElement,s=new jc(e,t);return this.initializeControls(s),this.world.scene.three.add(s),s}initializeControls(e){e.attach(this._helper),e.showX=!1,e.showY=!1,e.setSpace("local"),this.createArrowBoundingBox(),e.children[0].children[0].add(this._arrowBoundBox)}createArrowBoundingBox(){this._arrowBoundBox.geometry=new xe(.18,.18,1.2),this._arrowBoundBox.material=this._hiddenMaterial,this._arrowBoundBox.rotateX(Math.PI/2),this._arrowBoundBox.updateMatrix(),this._arrowBoundBox.geometry.applyMatrix4(this._arrowBoundBox.matrix)}notifyDraggingChanged(e){e.value?this.onDraggingStarted.trigger():this.onDraggingEnded.trigger()}preventCameraMovement(){this.world.camera.enabled=this._visible}newHelper(){const e=new Li;return e.lookAt(this.normal),e.position.copy(this.origin),this._planeMesh.position.z+=.01,e.add(this._planeMesh),this.world.scene.three.add(e),e}static newPlaneMesh(e,t){const s=new Mi(1),i=new se(s,t);return i.scale.set(e,e,e),i}}class th extends Ht{constructor(){super(...arguments),p(this,"_config",{enabled:{value:!0,type:"Boolean"},visible:{value:!0,type:"Boolean"},color:{value:new Ue,type:"Color"},opacity:{type:"Number",interpolable:!0,value:1,min:0,max:1},size:{type:"Number",interpolable:!0,value:2,min:0,max:100}})}get enabled(){return this._config.enabled.value}set enabled(e){this._config.enabled.value=e,this._component.enabled=e}get visible(){return this._config.visible.value}set visible(e){this._config.visible.value=e,this._component.visible=e}get color(){return this._config.color.value}set color(e){this._config.color.value=e,this._component.material.color.copy(e)}get opacity(){return this._config.opacity.value}set opacity(e){this._config.opacity.value=e,this._component.material.opacity=e}get size(){return this._config.size.value}set size(e){this._config.size.value=e,this._component.size=e}}const xo=class Ai extends Ae{constructor(e){super(e),p(this,"onSetup",new $),p(this,"onBeforeDrag",new $),p(this,"onAfterDrag",new $),p(this,"onBeforeCreate",new $),p(this,"onBeforeCancel",new $),p(this,"onAfterCancel",new $),p(this,"onBeforeDelete",new $),p(this,"onAfterCreate",new $),p(this,"onAfterDelete",new $),p(this,"onDisposed",new $),p(this,"isSetup",!1),p(this,"orthogonalY",!1),p(this,"toleranceOrthogonalY",.7),p(this,"Type",sr),p(this,"list",[]),p(this,"config",new th(this,this.components,"Clipper",Ai.uuid)),p(this,"_defaultConfig",{color:new Ue(12255487),opacity:.2,size:2}),p(this,"_material",new us({color:12255487,side:ks,transparent:!0,opacity:.2})),p(this,"_size",5),p(this,"_enabled",!1),p(this,"_visible",!0),p(this,"_onStartDragging",()=>{this.onBeforeDrag.trigger()}),p(this,"_onEndDragging",()=>{this.onAfterDrag.trigger()}),this.components.add(Ai.uuid,this)}get enabled(){return this._enabled}set enabled(e){this._enabled=e;for(const t of this.list)t.enabled=e;this.updateMaterialsAndPlanes()}get visible(){return this._visible}set visible(e){this._visible=e;for(const t of this.list)t.visible=e}get material(){return this._material}set material(e){this._material=e;for(const t of this.list)t.planeMaterial=e}get size(){return this._size}set size(e){this._size=e;for(const t of this.list)t.size=e}dispose(){this._enabled=!1,this.components.get(Ws).list.delete(this.config.uuid);for(const e of this.list)e.dispose();this.list.length=0,this._material.dispose(),this.onBeforeCreate.reset(),this.onBeforeCancel.reset(),this.onBeforeDelete.reset(),this.onBeforeDrag.reset(),this.onAfterCreate.reset(),this.onAfterCancel.reset(),this.onAfterDelete.reset(),this.onAfterDrag.reset(),this.onDisposed.trigger(Ai.uuid),this.onDisposed.reset()}create(e){const t=this.components.get(Fn).get(e).castRay();return t?this.createPlaneFromIntersection(e,t):null}createFromNormalAndCoplanarPoint(e,t,s){const i=this.newPlane(e,s,t);return this.updateMaterialsAndPlanes(),i}delete(e,t){t||(t=this.pickPlane(e)),t&&this.deletePlane(t)}deleteAll(e){const t=[...this.list];for(const s of t)if(!e||e.has(s.type)){this.delete(s.world,s);const i=this.list.indexOf(s);i!==-1&&this.list.splice(i,1)}}setup(e){const t={...this._defaultConfig,...e};this.config.color=t.color,this.config.opacity=t.opacity,this.config.size=t.size,this.isSetup=!0,this.onSetup.trigger()}deletePlane(e){const t=this.list.indexOf(e);if(t!==-1){if(this.list.splice(t,1),!e.world.renderer)throw new Error("Renderer not found for this plane's world!");e.world.renderer.setPlane(!1,e.three),e.dispose(),this.updateMaterialsAndPlanes(),this.onAfterDelete.trigger(e)}}pickPlane(e){const t=this.components.get(Fn).get(e),s=this.getAllPlaneMeshes(),i=t.castRay(s);if(i){const n=i.object;return this.list.find(r=>r.meshes.includes(n))}}getAllPlaneMeshes(){const e=[];for(const t of this.list)e.push(...t.meshes);return e}createPlaneFromIntersection(e,t){var s;if(!e.renderer)throw new Error("The given world must have a renderer!");const i=t.point.distanceTo(new U(0,0,0)),n=(s=t.face)==null?void 0:s.normal;if(!i||!n)return null;const r=this.getWorldNormal(t,n),o=this.newPlane(e,t.point,r.negate());return o.visible=this._visible,o.size=this._size,e.renderer.setPlane(!0,o.three),this.updateMaterialsAndPlanes(),o}getWorldNormal(e,t){const s=e.object;let i=e.object.matrixWorld.clone();if(s instanceof Gt&&e.instanceId!==void 0){const o=new Ee;s.getMatrixAt(e.instanceId,o),i=o.multiply(i)}const n=new Yt().getNormalMatrix(i),r=t.clone().applyMatrix3(n).normalize();return this.normalizePlaneDirectionY(r),r}normalizePlaneDirectionY(e){this.orthogonalY&&(e.y>this.toleranceOrthogonalY&&(e.x=0,e.y=1,e.z=0),e.y<-this.toleranceOrthogonalY&&(e.x=0,e.y=-1,e.z=0))}newPlane(e,t,s){const i=new this.Type(this.components,e,t,s,this._material);return i.onDraggingStarted.add(this._onStartDragging),i.onDraggingEnded.add(this._onEndDragging),this.list.push(i),this.onAfterCreate.trigger(i),i}updateMaterialsAndPlanes(){const e=this.components.get(wo);for(const[t,s]of e.list){if(!s.renderer)continue;s.renderer.updateClippingPlanes();const{clippingPlanes:i}=s.renderer;for(const n of s.meshes)if(n.material)if(Array.isArray(n.material))for(const r of n.material)r.clippingPlanes=i;else n.material.clippingPlanes=i}}};p(xo,"uuid","66290bc5-18c4-4cd1-9379-2e17a0617611");let sh=xo;class ih{constructor(e){p(this,"enabled",!1),p(this,"id","FirstPerson"),this.camera=e}set(e){if(this.enabled=e,e){if(this.camera.projection.current!=="Perspective"){this.camera.set("Orbit");return}this.setupFirstPersonCamera()}}setupFirstPersonCamera(){const e=this.camera.controls,t=new U;e.distance--,e.getPosition(t),e.minDistance=1,e.maxDistance=1,e.distance=1,e.moveTo(t.x,t.y,t.z),e.truckSpeed=50,e.mouseButtons.wheel=be.ACTION.DOLLY,e.touches.two=be.ACTION.TOUCH_ZOOM_TRUCK}}class nh{constructor(e){p(this,"enabled",!0),p(this,"id","Orbit"),this.camera=e,this.activateOrbitControls()}set(e){this.enabled=e,e&&this.activateOrbitControls()}activateOrbitControls(){const e=this.camera.controls;e.minDistance=1,e.maxDistance=300;const t=new U;e.getPosition(t);const s=t.length();e.distance=s,e.truckSpeed=2;const{rotation:i}=this.camera.three,n=new U(0,0,-1).applyEuler(i),r=t.addScaledVector(n,s);e.moveTo(r.x,r.y,r.z)}}class rh{constructor(e){p(this,"enabled",!1),p(this,"id","Plan"),p(this,"mouseAction1"),p(this,"mouseAction2"),p(this,"mouseInitialized",!1),p(this,"defaultAzimuthSpeed"),p(this,"defaultPolarSpeed"),this.camera=e,this.defaultAzimuthSpeed=e.controls.azimuthRotateSpeed,this.defaultPolarSpeed=e.controls.polarRotateSpeed}set(e){this.enabled=e;const t=this.camera.controls;t.azimuthRotateSpeed=e?0:this.defaultAzimuthSpeed,t.polarRotateSpeed=e?0:this.defaultPolarSpeed,this.mouseInitialized||(this.mouseAction1=t.touches.one,this.mouseAction2=t.touches.two,this.mouseInitialized=!0),e?(t.mouseButtons.left=be.ACTION.TRUCK,t.touches.one=be.ACTION.TOUCH_TRUCK,t.touches.two=be.ACTION.TOUCH_ZOOM):(t.mouseButtons.left=be.ACTION.ROTATE,t.touches.one=this.mouseAction1,t.touches.two=this.mouseAction2)}}class oh{constructor(e){p(this,"onChanged",new $),p(this,"current","Perspective"),p(this,"camera"),p(this,"matchOrthoDistanceEnabled",!1),p(this,"_component"),p(this,"_previousDistance",-1),this._component=e,this.camera=e.three}async set(e){this.current!==e&&(e==="Orthographic"?this.setOrthoCamera():await this.setPerspectiveCamera(),this.onChanged.trigger(this.camera))}async toggle(){const e=this.current==="Perspective"?"Orthographic":"Perspective";await this.set(e)}setOrthoCamera(){if(this._component.mode===null||this._component.mode.id==="FirstPerson")return;this._previousDistance=this._component.controls.distance,this._component.controls.distance=200;const e=this.getPerspectiveDims();if(!e)return;const{width:t,height:s}=e;this.setupOrthoCamera(s,t),this.camera=this._component.threeOrtho,this.current="Orthographic"}getPerspectiveDims(){const e=this._component.currentWorld;if(!e||!e.renderer)return null;const t=new U;this._component.threePersp.getWorldDirection(t);const s=new U;this._component.controls.getTarget(s);const i=s.clone().sub(this._component.threePersp.position).dot(t),n=e.renderer.getSize(),r=n.x/n.y,o=this._component.threePersp,a=i*2*Math.atan(o.fov*(Math.PI/180)/2);return{width:a*r,height:a}}setupOrthoCamera(e,t){this._component.controls.mouseButtons.wheel=be.ACTION.ZOOM,this._component.controls.mouseButtons.middle=be.ACTION.ZOOM;const s=this._component.threePersp,i=this._component.threeOrtho;i.zoom=1,i.left=t/-2,i.right=t/2,i.top=e/2,i.bottom=e/-2,i.updateProjectionMatrix(),i.position.copy(s.position),i.quaternion.copy(s.quaternion),this._component.controls.camera=i}getDistance(){const e=this._component.threePersp,t=this._component.threeOrtho;return(t.top-t.bottom)/t.zoom/(2*Math.atan(e.fov*(Math.PI/180)/2))}async setPerspectiveCamera(){this._component.controls.mouseButtons.wheel=be.ACTION.DOLLY,this._component.controls.mouseButtons.middle=be.ACTION.DOLLY;const e=this._component.threePersp,t=this._component.threeOrtho;e.position.copy(t.position),e.quaternion.copy(t.quaternion),this._component.controls.mouseButtons.wheel=be.ACTION.DOLLY,this.matchOrthoDistanceEnabled?this._component.controls.distance=this.getDistance():this._component.controls.distance=this._previousDistance,await this._component.controls.zoomTo(1),e.updateProjectionMatrix(),this._component.controls.camera=e,this.camera=e,this.current="Perspective"}}class ah extends zs{constructor(e){super(e),p(this,"projection"),p(this,"threeOrtho"),p(this,"threePersp"),p(this,"_userInputButtons",{}),p(this,"_frustumSize",50),p(this,"_navigationModes",new Map),p(this,"_mode",null),p(this,"previousSize",null),this.threePersp=this.three,this.threeOrtho=this.newOrthoCamera(),this.projection=new oh(this),this.onAspectUpdated.add(()=>{this.setOrthoPerspCameraAspect()}),this.projection.onChanged.add(t=>{this.three=t,this.updateAspect()}),this.onWorldChanged.add(({action:t})=>{t==="added"&&(this._navigationModes.clear(),this._navigationModes.set("Orbit",new nh(this)),this._navigationModes.set("FirstPerson",new ih(this)),this._navigationModes.set("Plan",new rh(this)),this._mode=this._navigationModes.get("Orbit"),this.mode.set(!0,{preventTargetAdjustment:!0}),this.currentWorld&&this.currentWorld.renderer&&(this.previousSize=this.currentWorld.renderer.getSize().clone()))})}get mode(){if(!this._mode)throw new Error("Mode not found, camera not initialized");return this._mode}dispose(){super.dispose(),this.threeOrtho.removeFromParent()}set(e){if(this.mode!==null&&this.mode.id!==e){if(this.mode.set(!1),!this._navigationModes.has(e))throw new Error("The specified mode does not exist!");this._mode=this._navigationModes.get(e),this.mode.set(!0)}}async fit(e,t=1.5){if(!this.enabled)return;const s=Number.MAX_VALUE,i=Number.MIN_VALUE,n=new U(s,s,s),r=new U(i,i,i);for(const d of e){const u=new Pe().setFromObject(d);u.min.x<n.x&&(n.x=u.min.x),u.min.y<n.y&&(n.y=u.min.y),u.min.z<n.z&&(n.z=u.min.z),u.max.x>r.x&&(r.x=u.max.x),u.max.y>r.y&&(r.y=u.max.y),u.max.z>r.z&&(r.z=u.max.z)}const o=new Pe(n,r),a=new U;o.getSize(a);const c=new U;o.getCenter(c);const h=Math.max(a.x,a.y,a.z)*t,I=new Pi(c,h);await this.controls.fitToSphere(I,!0)}setUserInput(e){e?this.enableUserInput():this.disableUserInput()}disableUserInput(){this._userInputButtons.left=this.controls.mouseButtons.left,this._userInputButtons.right=this.controls.mouseButtons.right,this._userInputButtons.middle=this.controls.mouseButtons.middle,this._userInputButtons.wheel=this.controls.mouseButtons.wheel,this.controls.mouseButtons.left=0,this.controls.mouseButtons.right=0,this.controls.mouseButtons.middle=0,this.controls.mouseButtons.wheel=0}enableUserInput(){Object.keys(this._userInputButtons).length!==0&&(this.controls.mouseButtons.left=this._userInputButtons.left,this.controls.mouseButtons.right=this._userInputButtons.right,this.controls.mouseButtons.middle=this._userInputButtons.middle,this.controls.mouseButtons.wheel=this._userInputButtons.wheel)}newOrthoCamera(){const e=window.innerWidth/window.innerHeight;return new zt(this._frustumSize*e/-2,this._frustumSize*e/2,this._frustumSize/2,this._frustumSize/-2,.1,1e3)}setOrthoPerspCameraAspect(){if(!this.currentWorld||!this.currentWorld.renderer||!this.previousSize)return;const e=this.currentWorld.renderer.getSize(),t=this.threeOrtho.top,s=this.threeOrtho.right,i=e.y/this.previousSize.y,n=e.x/this.previousSize.x,r=t*i,o=s*n;this.threeOrtho.left=-o,this.threeOrtho.right=o,this.threeOrtho.top=r,this.threeOrtho.bottom=-r,this.threeOrtho.updateProjectionMatrix(),this.previousSize.copy(e)}}const Kr=new Map([[Di,{forRelated:"Decomposes",forRelating:"IsDecomposedBy"}],[bn,{forRelated:"HasAssociations",forRelating:"AssociatedTo"}],[Un,{forRelated:"HasAssociations",forRelating:"ClassificationForObjects"}],[xn,{forRelated:"HasAssignments",forRelating:"IsGroupedBy"}],[Hs,{forRelated:"IsDefinedBy",forRelating:"DefinesOcurrence"}],[Bn,{forRelated:"IsTypedBy",forRelating:"Types"}],[Yn,{forRelated:"IsDefinedBy",forRelating:"Defines"}],[bi,{forRelated:"ContainedInStructure",forRelating:"ContainsElements"}],[Vn,{forRelated:"AssignedToFlowElement",forRelating:"HasControlElements"}],[Gn,{forRelated:"ConnectedFrom",forRelating:"ConnectedTo"}],[zn,{forRelated:"HasAssignments",forRelating:"ReferencedBy"}],[kn,{forRelated:"HasContext",forRelating:"Declares"}],[Hn,{forRelated:"HasAssignments",forRelating:"Controls"}],[Wn,{forRelated:"Nests",forRelating:"IsNestedBy"}],[Xn,{forRelated:"HasAssociations",forRelating:"DocumentRefForObjects"}]]),wi={950732822:"IFCURIREFERENCE",4075327185:"IFCTIME",1209108979:"IFCTEMPERATURERATEOFCHANGEMEASURE",3457685358:"IFCSOUNDPRESSURELEVELMEASURE",4157543285:"IFCSOUNDPOWERLEVELMEASURE",2798247006:"IFCPROPERTYSETDEFINITIONSET",1790229001:"IFCPOSITIVEINTEGER",525895558:"IFCNONNEGATIVELENGTHMEASURE",1774176899:"IFCLINEINDEX",1275358634:"IFCLANGUAGEID",2541165894:"IFCDURATION",3701338814:"IFCDAYINWEEKNUMBER",2195413836:"IFCDATETIME",937566702:"IFCDATE",1683019596:"IFCCARDINALPOINTREFERENCE",2314439260:"IFCBINARY",1500781891:"IFCAREADENSITYMEASURE",3683503648:"IFCARCINDEX",4065007721:"IFCYEARNUMBER",1718600412:"IFCWARPINGMOMENTMEASURE",51269191:"IFCWARPINGCONSTANTMEASURE",2593997549:"IFCVOLUMETRICFLOWRATEMEASURE",3458127941:"IFCVOLUMEMEASURE",3345633955:"IFCVAPORPERMEABILITYMEASURE",1278329552:"IFCTORQUEMEASURE",2591213694:"IFCTIMESTAMP",2726807636:"IFCTIMEMEASURE",743184107:"IFCTHERMODYNAMICTEMPERATUREMEASURE",2016195849:"IFCTHERMALTRANSMITTANCEMEASURE",857959152:"IFCTHERMALRESISTANCEMEASURE",2281867870:"IFCTHERMALEXPANSIONCOEFFICIENTMEASURE",2645777649:"IFCTHERMALCONDUCTIVITYMEASURE",232962298:"IFCTHERMALADMITTANCEMEASURE",296282323:"IFCTEXTTRANSFORMATION",603696268:"IFCTEXTFONTNAME",3490877962:"IFCTEXTDECORATION",1460886941:"IFCTEXTALIGNMENT",2801250643:"IFCTEXT",58845555:"IFCTEMPERATUREGRADIENTMEASURE",361837227:"IFCSPECULARROUGHNESS",2757832317:"IFCSPECULAREXPONENT",3477203348:"IFCSPECIFICHEATCAPACITYMEASURE",993287707:"IFCSOUNDPRESSUREMEASURE",846465480:"IFCSOUNDPOWERMEASURE",3471399674:"IFCSOLIDANGLEMEASURE",408310005:"IFCSHEARMODULUSMEASURE",2190458107:"IFCSECTIONALAREAINTEGRALMEASURE",3467162246:"IFCSECTIONMODULUSMEASURE",2766185779:"IFCSECONDINMINUTE",3211557302:"IFCROTATIONALSTIFFNESSMEASURE",1755127002:"IFCROTATIONALMASSMEASURE",2133746277:"IFCROTATIONALFREQUENCYMEASURE",200335297:"IFCREAL",96294661:"IFCRATIOMEASURE",3972513137:"IFCRADIOACTIVITYMEASURE",3665567075:"IFCPRESSUREMEASURE",2169031380:"IFCPRESENTABLETEXT",1364037233:"IFCPOWERMEASURE",1245737093:"IFCPOSITIVERATIOMEASURE",3054510233:"IFCPOSITIVEPLANEANGLEMEASURE",2815919920:"IFCPOSITIVELENGTHMEASURE",4042175685:"IFCPLANEANGLEMEASURE",2642773653:"IFCPLANARFORCEMEASURE",2260317790:"IFCPARAMETERVALUE",929793134:"IFCPHMEASURE",2395907400:"IFCNUMERICMEASURE",2095195183:"IFCNORMALISEDRATIOMEASURE",765770214:"IFCMONTHINYEARNUMBER",2615040989:"IFCMONETARYMEASURE",3114022597:"IFCMOMENTOFINERTIAMEASURE",1648970520:"IFCMOLECULARWEIGHTMEASURE",3177669450:"IFCMOISTUREDIFFUSIVITYMEASURE",1753493141:"IFCMODULUSOFSUBGRADEREACTIONMEASURE",1052454078:"IFCMODULUSOFROTATIONALSUBGRADEREACTIONMEASURE",2173214787:"IFCMODULUSOFLINEARSUBGRADEREACTIONMEASURE",3341486342:"IFCMODULUSOFELASTICITYMEASURE",102610177:"IFCMINUTEINHOUR",3531705166:"IFCMASSPERLENGTHMEASURE",3124614049:"IFCMASSMEASURE",4017473158:"IFCMASSFLOWRATEMEASURE",1477762836:"IFCMASSDENSITYMEASURE",2486716878:"IFCMAGNETICFLUXMEASURE",286949696:"IFCMAGNETICFLUXDENSITYMEASURE",151039812:"IFCLUMINOUSINTENSITYMEASURE",2755797622:"IFCLUMINOUSINTENSITYDISTRIBUTIONMEASURE",2095003142:"IFCLUMINOUSFLUXMEASURE",503418787:"IFCLOGICAL",3086160713:"IFCLINEARVELOCITYMEASURE",1307019551:"IFCLINEARSTIFFNESSMEASURE",2128979029:"IFCLINEARMOMENTMEASURE",191860431:"IFCLINEARFORCEMEASURE",1243674935:"IFCLENGTHMEASURE",3258342251:"IFCLABEL",2054016361:"IFCKINEMATICVISCOSITYMEASURE",3192672207:"IFCISOTHERMALMOISTURECAPACITYMEASURE",3686016028:"IFCIONCONCENTRATIONMEASURE",3809634241:"IFCINTEGERCOUNTRATEMEASURE",1939436016:"IFCINTEGER",2679005408:"IFCINDUCTANCEMEASURE",3358199106:"IFCILLUMINANCEMEASURE",983778844:"IFCIDENTIFIER",2589826445:"IFCHOURINDAY",1158859006:"IFCHEATINGVALUEMEASURE",3113092358:"IFCHEATFLUXDENSITYMEASURE",3064340077:"IFCGLOBALLYUNIQUEID",3044325142:"IFCFREQUENCYMEASURE",1361398929:"IFCFORCEMEASURE",2590844177:"IFCFONTWEIGHT",2715512545:"IFCFONTVARIANT",1102727119:"IFCFONTSTYLE",2078135608:"IFCENERGYMEASURE",2506197118:"IFCELECTRICVOLTAGEMEASURE",2951915441:"IFCELECTRICRESISTANCEMEASURE",3790457270:"IFCELECTRICCURRENTMEASURE",2093906313:"IFCELECTRICCONDUCTANCEMEASURE",3818826038:"IFCELECTRICCHARGEMEASURE",1827137117:"IFCELECTRICCAPACITANCEMEASURE",69416015:"IFCDYNAMICVISCOSITYMEASURE",524656162:"IFCDOSEEQUIVALENTMEASURE",4134073009:"IFCDIMENSIONCOUNT",1514641115:"IFCDESCRIPTIVEMEASURE",300323983:"IFCDAYLIGHTSAVINGHOUR",86635668:"IFCDAYINMONTHNUMBER",94842927:"IFCCURVATUREMEASURE",1778710042:"IFCCOUNTMEASURE",3238673880:"IFCCONTEXTDEPENDENTMEASURE",3812528620:"IFCCOMPOUNDPLANEANGLEMEASURE",2991860651:"IFCCOMPLEXNUMBER",1867003952:"IFCBOXALIGNMENT",2735952531:"IFCBOOLEAN",2650437152:"IFCAREAMEASURE",632304761:"IFCANGULARVELOCITYMEASURE",360377573:"IFCAMOUNTOFSUBSTANCEMEASURE",4182062534:"IFCACCELERATIONMEASURE",3699917729:"IFCABSORBEDDOSEMEASURE",1971632696:"IFCGEOSLICE",2680139844:"IFCGEOMODEL",24726584:"IFCELECTRICFLOWTREATMENTDEVICE",3693000487:"IFCDISTRIBUTIONBOARD",3460952963:"IFCCONVEYORSEGMENT",3999819293:"IFCCAISSONFOUNDATION",3314249567:"IFCBOREHOLE",4196446775:"IFCBEARING",325726236:"IFCALIGNMENT",3425753595:"IFCTRACKELEMENT",991950508:"IFCSIGNAL",3798194928:"IFCREINFORCEDSOIL",3290496277:"IFCRAIL",1383356374:"IFCPAVEMENT",2182337498:"IFCNAVIGATIONELEMENT",234836483:"IFCMOORINGDEVICE",2078563270:"IFCMOBILETELECOMMUNICATIONSAPPLIANCE",1638804497:"IFCLIQUIDTERMINAL",1154579445:"IFCLINEARPOSITIONINGELEMENT",2696325953:"IFCKERB",2713699986:"IFCGEOTECHNICALASSEMBLY",2142170206:"IFCELECTRICFLOWTREATMENTDEVICETYPE",3376911765:"IFCEARTHWORKSFILL",1077100507:"IFCEARTHWORKSELEMENT",3071239417:"IFCEARTHWORKSCUT",479945903:"IFCDISTRIBUTIONBOARDTYPE",3426335179:"IFCDEEPFOUNDATION",1502416096:"IFCCOURSE",2940368186:"IFCCONVEYORSEGMENTTYPE",3203706013:"IFCCAISSONFOUNDATIONTYPE",3862327254:"IFCBUILTSYSTEM",1876633798:"IFCBUILTELEMENT",963979645:"IFCBRIDGEPART",644574406:"IFCBRIDGE",3649138523:"IFCBEARINGTYPE",1662888072:"IFCALIGNMENTVERTICAL",317615605:"IFCALIGNMENTSEGMENT",1545765605:"IFCALIGNMENTHORIZONTAL",4266260250:"IFCALIGNMENTCANT",3956297820:"IFCVIBRATIONDAMPERTYPE",1530820697:"IFCVIBRATIONDAMPER",840318589:"IFCVEHICLE",1953115116:"IFCTRANSPORTATIONDEVICE",618700268:"IFCTRACKELEMENTTYPE",2281632017:"IFCTENDONCONDUITTYPE",3663046924:"IFCTENDONCONDUIT",42703149:"IFCSINESPIRAL",1894708472:"IFCSIGNALTYPE",3599934289:"IFCSIGNTYPE",33720170:"IFCSIGN",1027922057:"IFCSEVENTHORDERPOLYNOMIALSPIRAL",544395925:"IFCSEGMENTEDREFERENCECURVE",3649235739:"IFCSECONDORDERPOLYNOMIALSPIRAL",550521510:"IFCROADPART",146592293:"IFCROAD",3818125796:"IFCRELADHERESTOELEMENT",4021432810:"IFCREFERENT",1891881377:"IFCRAILWAYPART",3992365140:"IFCRAILWAY",1763565496:"IFCRAILTYPE",1946335990:"IFCPOSITIONINGELEMENT",514975943:"IFCPAVEMENTTYPE",506776471:"IFCNAVIGATIONELEMENTTYPE",710110818:"IFCMOORINGDEVICETYPE",1950438474:"IFCMOBILETELECOMMUNICATIONSAPPLIANCETYPE",976884017:"IFCMARINEPART",525669439:"IFCMARINEFACILITY",1770583370:"IFCLIQUIDTERMINALTYPE",2176059722:"IFCLINEARELEMENT",679976338:"IFCKERBTYPE",3948183225:"IFCIMPACTPROTECTIONDEVICETYPE",2568555532:"IFCIMPACTPROTECTIONDEVICE",2898700619:"IFCGRADIENTCURVE",1594536857:"IFCGEOTECHNICALSTRATUM",4230923436:"IFCGEOTECHNICALELEMENT",4228831410:"IFCFACILITYPARTCOMMON",1310830890:"IFCFACILITYPART",24185140:"IFCFACILITY",4234616927:"IFCDIRECTRIXDERIVEDREFERENCESWEPTAREASOLID",1306400036:"IFCDEEPFOUNDATIONTYPE",4189326743:"IFCCOURSETYPE",2000195564:"IFCCOSINESPIRAL",3497074424:"IFCCLOTHOID",1626504194:"IFCBUILTELEMENTTYPE",3651464721:"IFCVEHICLETYPE",1229763772:"IFCTRIANGULATEDIRREGULARNETWORK",3665877780:"IFCTRANSPORTATIONDEVICETYPE",782932809:"IFCTHIRDORDERPOLYNOMIALSPIRAL",2735484536:"IFCSPIRAL",1356537516:"IFCSECTIONEDSURFACE",1290935644:"IFCSECTIONEDSOLIDHORIZONTAL",1862484736:"IFCSECTIONEDSOLID",1441486842:"IFCRELPOSITIONS",1033248425:"IFCRELASSOCIATESPROFILEDEF",3381221214:"IFCPOLYNOMIALCURVE",2485787929:"IFCOFFSETCURVEBYDISTANCES",590820931:"IFCOFFSETCURVE",3465909080:"IFCINDEXEDPOLYGONALTEXTUREMAP",593015953:"IFCDIRECTRIXCURVESWEPTAREASOLID",4212018352:"IFCCURVESEGMENT",3425423356:"IFCAXIS2PLACEMENTLINEAR",823603102:"IFCSEGMENT",2165702409:"IFCPOINTBYDISTANCEEXPRESSION",182550632:"IFCOPENCROSSPROFILEDEF",388784114:"IFCLINEARPLACEMENT",536804194:"IFCALIGNMENTHORIZONTALSEGMENT",3752311538:"IFCALIGNMENTCANTSEGMENT",1010789467:"IFCTEXTURECOORDINATEINDICESWITHVOIDS",222769930:"IFCTEXTURECOORDINATEINDICES",2691318326:"IFCQUANTITYNUMBER",3633395639:"IFCALIGNMENTVERTICALSEGMENT",2879124712:"IFCALIGNMENTPARAMETERSEGMENT",25142252:"IFCCONTROLLER",3087945054:"IFCALARM",4288193352:"IFCACTUATOR",630975310:"IFCUNITARYCONTROLELEMENT",4086658281:"IFCSENSOR",2295281155:"IFCPROTECTIVEDEVICETRIPPINGUNIT",182646315:"IFCFLOWINSTRUMENT",1426591983:"IFCFIRESUPPRESSIONTERMINAL",819412036:"IFCFILTER",3415622556:"IFCFAN",1003880860:"IFCELECTRICTIMECONTROL",402227799:"IFCELECTRICMOTOR",264262732:"IFCELECTRICGENERATOR",3310460725:"IFCELECTRICFLOWSTORAGEDEVICE",862014818:"IFCELECTRICDISTRIBUTIONBOARD",1904799276:"IFCELECTRICAPPLIANCE",1360408905:"IFCDUCTSILENCER",3518393246:"IFCDUCTSEGMENT",342316401:"IFCDUCTFITTING",562808652:"IFCDISTRIBUTIONCIRCUIT",4074379575:"IFCDAMPER",3640358203:"IFCCOOLINGTOWER",4136498852:"IFCCOOLEDBEAM",2272882330:"IFCCONDENSER",3571504051:"IFCCOMPRESSOR",3221913625:"IFCCOMMUNICATIONSAPPLIANCE",639361253:"IFCCOIL",3902619387:"IFCCHILLER",4217484030:"IFCCABLESEGMENT",1051757585:"IFCCABLEFITTING",3758799889:"IFCCABLECARRIERSEGMENT",635142910:"IFCCABLECARRIERFITTING",2938176219:"IFCBURNER",32344328:"IFCBOILER",2906023776:"IFCBEAMSTANDARDCASE",277319702:"IFCAUDIOVISUALAPPLIANCE",2056796094:"IFCAIRTOAIRHEATRECOVERY",177149247:"IFCAIRTERMINALBOX",1634111441:"IFCAIRTERMINAL",486154966:"IFCWINDOWSTANDARDCASE",4237592921:"IFCWASTETERMINAL",4156078855:"IFCWALLELEMENTEDCASE",4207607924:"IFCVALVE",4292641817:"IFCUNITARYEQUIPMENT",3179687236:"IFCUNITARYCONTROLELEMENTTYPE",3026737570:"IFCTUBEBUNDLE",3825984169:"IFCTRANSFORMER",812556717:"IFCTANK",1162798199:"IFCSWITCHINGDEVICE",385403989:"IFCSTRUCTURALLOADCASE",1404847402:"IFCSTACKTERMINAL",1999602285:"IFCSPACEHEATER",3420628829:"IFCSOLARDEVICE",3027962421:"IFCSLABSTANDARDCASE",3127900445:"IFCSLABELEMENTEDCASE",1329646415:"IFCSHADINGDEVICE",3053780830:"IFCSANITARYTERMINAL",2572171363:"IFCREINFORCINGBARTYPE",1232101972:"IFCRATIONALBSPLINECURVEWITHKNOTS",90941305:"IFCPUMP",655969474:"IFCPROTECTIVEDEVICETRIPPINGUNITTYPE",738039164:"IFCPROTECTIVEDEVICE",1156407060:"IFCPLATESTANDARDCASE",3612865200:"IFCPIPESEGMENT",310824031:"IFCPIPEFITTING",3694346114:"IFCOUTLET",144952367:"IFCOUTERBOUNDARYCURVE",2474470126:"IFCMOTORCONNECTION",1911478936:"IFCMEMBERSTANDARDCASE",1437502449:"IFCMEDICALDEVICE",629592764:"IFCLIGHTFIXTURE",76236018:"IFCLAMP",2176052936:"IFCJUNCTIONBOX",4175244083:"IFCINTERCEPTOR",2068733104:"IFCHUMIDIFIER",3319311131:"IFCHEATEXCHANGER",2188021234:"IFCFLOWMETER",1209101575:"IFCEXTERNALSPATIALELEMENT",484807127:"IFCEVAPORATOR",3747195512:"IFCEVAPORATIVECOOLER",2814081492:"IFCENGINE",2417008758:"IFCELECTRICDISTRIBUTIONBOARDTYPE",3242481149:"IFCDOORSTANDARDCASE",3205830791:"IFCDISTRIBUTIONSYSTEM",400855858:"IFCCOMMUNICATIONSAPPLIANCETYPE",905975707:"IFCCOLUMNSTANDARDCASE",1677625105:"IFCCIVILELEMENT",3296154744:"IFCCHIMNEY",2674252688:"IFCCABLEFITTINGTYPE",2188180465:"IFCBURNERTYPE",1177604601:"IFCBUILDINGSYSTEM",39481116:"IFCBUILDINGELEMENTPARTTYPE",1136057603:"IFCBOUNDARYCURVE",2461110595:"IFCBSPLINECURVEWITHKNOTS",1532957894:"IFCAUDIOVISUALAPPLIANCETYPE",4088093105:"IFCWORKCALENDAR",4009809668:"IFCWINDOWTYPE",926996030:"IFCVOIDINGFEATURE",2391383451:"IFCVIBRATIONISOLATOR",2415094496:"IFCTENDONTYPE",3081323446:"IFCTENDONANCHORTYPE",413509423:"IFCSYSTEMFURNITUREELEMENT",3101698114:"IFCSURFACEFEATURE",3657597509:"IFCSTRUCTURALSURFACEACTION",2757150158:"IFCSTRUCTURALCURVEREACTION",1004757350:"IFCSTRUCTURALCURVEACTION",338393293:"IFCSTAIRTYPE",1072016465:"IFCSOLARDEVICETYPE",4074543187:"IFCSHADINGDEVICETYPE",2157484638:"IFCSEAMCURVE",2781568857:"IFCROOFTYPE",2310774935:"IFCREINFORCINGMESHTYPE",964333572:"IFCREINFORCINGELEMENTTYPE",683857671:"IFCRATIONALBSPLINESURFACEWITHKNOTS",1469900589:"IFCRAMPTYPE",2839578677:"IFCPOLYGONALFACESET",1158309216:"IFCPILETYPE",3079942009:"IFCOPENINGSTANDARDCASE",1114901282:"IFCMEDICALDEVICETYPE",3113134337:"IFCINTERSECTIONCURVE",3946677679:"IFCINTERCEPTORTYPE",2571569899:"IFCINDEXEDPOLYCURVE",3493046030:"IFCGEOGRAPHICELEMENT",1509553395:"IFCFURNITURE",1893162501:"IFCFOOTINGTYPE",2853485674:"IFCEXTERNALSPATIALSTRUCTUREELEMENT",4148101412:"IFCEVENT",132023988:"IFCENGINETYPE",2397081782:"IFCELEMENTASSEMBLYTYPE",2323601079:"IFCDOORTYPE",1213902940:"IFCCYLINDRICALSURFACE",1525564444:"IFCCONSTRUCTIONPRODUCTRESOURCETYPE",4105962743:"IFCCONSTRUCTIONMATERIALRESOURCETYPE",2185764099:"IFCCONSTRUCTIONEQUIPMENTRESOURCETYPE",15328376:"IFCCOMPOSITECURVEONSURFACE",3875453745:"IFCCOMPLEXPROPERTYTEMPLATE",3893394355:"IFCCIVILELEMENTTYPE",2197970202:"IFCCHIMNEYTYPE",167062518:"IFCBSPLINESURFACEWITHKNOTS",2887950389:"IFCBSPLINESURFACE",2603310189:"IFCADVANCEDBREPWITHVOIDS",1635779807:"IFCADVANCEDBREP",2916149573:"IFCTRIANGULATEDFACESET",1935646853:"IFCTOROIDALSURFACE",2387106220:"IFCTESSELLATEDFACESET",3206491090:"IFCTASKTYPE",699246055:"IFCSURFACECURVE",4095615324:"IFCSUBCONTRACTRESOURCETYPE",603775116:"IFCSTRUCTURALSURFACEREACTION",4015995234:"IFCSPHERICALSURFACE",2481509218:"IFCSPATIALZONETYPE",463610769:"IFCSPATIALZONE",710998568:"IFCSPATIALELEMENTTYPE",1412071761:"IFCSPATIALELEMENT",3663146110:"IFCSIMPLEPROPERTYTEMPLATE",3243963512:"IFCREVOLVEDAREASOLIDTAPERED",816062949:"IFCREPARAMETRISEDCOMPOSITECURVESEGMENT",1521410863:"IFCRELSPACEBOUNDARY2NDLEVEL",3523091289:"IFCRELSPACEBOUNDARY1STLEVEL",427948657:"IFCRELINTERFERESELEMENTS",307848117:"IFCRELDEFINESBYTEMPLATE",1462361463:"IFCRELDEFINESBYOBJECT",2565941209:"IFCRELDECLARES",1027710054:"IFCRELASSIGNSTOGROUPBYFACTOR",3521284610:"IFCPROPERTYTEMPLATE",492091185:"IFCPROPERTYSETTEMPLATE",653396225:"IFCPROJECTLIBRARY",569719735:"IFCPROCEDURETYPE",3967405729:"IFCPREDEFINEDPROPERTYSET",1682466193:"IFCPCURVE",428585644:"IFCLABORRESOURCETYPE",2294589976:"IFCINDEXEDPOLYGONALFACEWITHVOIDS",178912537:"IFCINDEXEDPOLYGONALFACE",4095422895:"IFCGEOGRAPHICELEMENTTYPE",2652556860:"IFCFIXEDREFERENCESWEPTAREASOLID",2804161546:"IFCEXTRUDEDAREASOLIDTAPERED",4024345920:"IFCEVENTTYPE",2629017746:"IFCCURVEBOUNDEDSURFACE",1815067380:"IFCCREWRESOURCETYPE",3419103109:"IFCCONTEXT",2574617495:"IFCCONSTRUCTIONRESOURCETYPE",2059837836:"IFCCARTESIANPOINTLIST3D",1675464909:"IFCCARTESIANPOINTLIST2D",574549367:"IFCCARTESIANPOINTLIST",3406155212:"IFCADVANCEDFACE",3698973494:"IFCTYPERESOURCE",3736923433:"IFCTYPEPROCESS",901063453:"IFCTESSELLATEDITEM",1096409881:"IFCSWEPTDISKSOLIDPOLYGONAL",1042787934:"IFCRESOURCETIME",1608871552:"IFCRESOURCECONSTRAINTRELATIONSHIP",2943643501:"IFCRESOURCEAPPROVALRELATIONSHIP",2090586900:"IFCQUANTITYSET",1482703590:"IFCPROPERTYTEMPLATEDEFINITION",3778827333:"IFCPREDEFINEDPROPERTIES",2998442950:"IFCMIRROREDPROFILEDEF",853536259:"IFCMATERIALRELATIONSHIP",3404854881:"IFCMATERIALPROFILESETUSAGETAPERING",3079605661:"IFCMATERIALPROFILESETUSAGE",2852063980:"IFCMATERIALCONSTITUENTSET",3708119e3:"IFCMATERIALCONSTITUENT",1585845231:"IFCLAGTIME",2133299955:"IFCINDEXEDTRIANGLETEXTUREMAP",1437953363:"IFCINDEXEDTEXTUREMAP",3570813810:"IFCINDEXEDCOLOURMAP",1437805879:"IFCEXTERNALREFERENCERELATIONSHIP",297599258:"IFCEXTENDEDPROPERTIES",211053100:"IFCEVENTTIME",2713554722:"IFCCONVERSIONBASEDUNITWITHOFFSET",3285139300:"IFCCOLOURRGBLIST",1236880293:"IFCWORKTIME",1199560280:"IFCTIMEPERIOD",3611470254:"IFCTEXTUREVERTEXLIST",2771591690:"IFCTASKTIMERECURRING",1549132990:"IFCTASKTIME",2043862942:"IFCTABLECOLUMN",2934153892:"IFCSURFACEREINFORCEMENTAREA",609421318:"IFCSTRUCTURALLOADORRESULT",3478079324:"IFCSTRUCTURALLOADCONFIGURATION",1054537805:"IFCSCHEDULINGTIME",2439245199:"IFCRESOURCELEVELRELATIONSHIP",2433181523:"IFCREFERENCE",3915482550:"IFCRECURRENCEPATTERN",986844984:"IFCPROPERTYABSTRACTION",3843373140:"IFCPROJECTEDCRS",677532197:"IFCPRESENTATIONITEM",1507914824:"IFCMATERIALUSAGEDEFINITION",552965576:"IFCMATERIALPROFILEWITHOFFSETS",164193824:"IFCMATERIALPROFILESET",2235152071:"IFCMATERIALPROFILE",1847252529:"IFCMATERIALLAYERWITHOFFSETS",760658860:"IFCMATERIALDEFINITION",3057273783:"IFCMAPCONVERSION",4294318154:"IFCEXTERNALINFORMATION",1466758467:"IFCCOORDINATEREFERENCESYSTEM",1785450214:"IFCCOORDINATEOPERATION",775493141:"IFCCONNECTIONVOLUMEGEOMETRY",979691226:"IFCREINFORCINGBAR",3700593921:"IFCELECTRICDISTRIBUTIONPOINT",1062813311:"IFCDISTRIBUTIONCONTROLELEMENT",1052013943:"IFCDISTRIBUTIONCHAMBERELEMENT",578613899:"IFCCONTROLLERTYPE",2454782716:"IFCCHAMFEREDGEFEATURE",753842376:"IFCBEAM",3001207471:"IFCALARMTYPE",2874132201:"IFCACTUATORTYPE",3304561284:"IFCWINDOW",3512223829:"IFCWALLSTANDARDCASE",2391406946:"IFCWALL",3313531582:"IFCVIBRATIONISOLATORTYPE",2347447852:"IFCTENDONANCHOR",3824725483:"IFCTENDON",2515109513:"IFCSTRUCTURALANALYSISMODEL",4252922144:"IFCSTAIRFLIGHT",331165859:"IFCSTAIR",1529196076:"IFCSLAB",1783015770:"IFCSENSORTYPE",1376911519:"IFCROUNDEDEDGEFEATURE",2016517767:"IFCROOF",2320036040:"IFCREINFORCINGMESH",3027567501:"IFCREINFORCINGELEMENT",3055160366:"IFCRATIONALBEZIERCURVE",3283111854:"IFCRAMPFLIGHT",3024970846:"IFCRAMP",2262370178:"IFCRAILING",3171933400:"IFCPLATE",1687234759:"IFCPILE",1073191201:"IFCMEMBER",900683007:"IFCFOOTING",3508470533:"IFCFLOWTREATMENTDEVICE",2223149337:"IFCFLOWTERMINAL",707683696:"IFCFLOWSTORAGEDEVICE",987401354:"IFCFLOWSEGMENT",3132237377:"IFCFLOWMOVINGDEVICE",4037862832:"IFCFLOWINSTRUMENTTYPE",4278956645:"IFCFLOWFITTING",2058353004:"IFCFLOWCONTROLLER",4222183408:"IFCFIRESUPPRESSIONTERMINALTYPE",1810631287:"IFCFILTERTYPE",346874300:"IFCFANTYPE",1658829314:"IFCENERGYCONVERSIONDEVICE",857184966:"IFCELECTRICALELEMENT",1634875225:"IFCELECTRICALCIRCUIT",712377611:"IFCELECTRICTIMECONTROLTYPE",1217240411:"IFCELECTRICMOTORTYPE",1365060375:"IFCELECTRICHEATERTYPE",1534661035:"IFCELECTRICGENERATORTYPE",3277789161:"IFCELECTRICFLOWSTORAGEDEVICETYPE",663422040:"IFCELECTRICAPPLIANCETYPE",855621170:"IFCEDGEFEATURE",2030761528:"IFCDUCTSILENCERTYPE",3760055223:"IFCDUCTSEGMENTTYPE",869906466:"IFCDUCTFITTINGTYPE",395920057:"IFCDOOR",3041715199:"IFCDISTRIBUTIONPORT",3040386961:"IFCDISTRIBUTIONFLOWELEMENT",1945004755:"IFCDISTRIBUTIONELEMENT",2063403501:"IFCDISTRIBUTIONCONTROLELEMENTTYPE",1599208980:"IFCDISTRIBUTIONCHAMBERELEMENTTYPE",2635815018:"IFCDISCRETEACCESSORYTYPE",1335981549:"IFCDISCRETEACCESSORY",4147604152:"IFCDIAMETERDIMENSION",3961806047:"IFCDAMPERTYPE",3495092785:"IFCCURTAINWALL",1973544240:"IFCCOVERING",2954562838:"IFCCOOLINGTOWERTYPE",335055490:"IFCCOOLEDBEAMTYPE",488727124:"IFCCONSTRUCTIONPRODUCTRESOURCE",1060000209:"IFCCONSTRUCTIONMATERIALRESOURCE",3898045240:"IFCCONSTRUCTIONEQUIPMENTRESOURCE",1163958913:"IFCCONDITIONCRITERION",2188551683:"IFCCONDITION",2816379211:"IFCCONDENSERTYPE",3850581409:"IFCCOMPRESSORTYPE",843113511:"IFCCOLUMN",2301859152:"IFCCOILTYPE",2611217952:"IFCCIRCLE",2951183804:"IFCCHILLERTYPE",1285652485:"IFCCABLESEGMENTTYPE",3293546465:"IFCCABLECARRIERSEGMENTTYPE",395041908:"IFCCABLECARRIERFITTINGTYPE",1909888760:"IFCBUILDINGELEMENTPROXYTYPE",1095909175:"IFCBUILDINGELEMENTPROXY",2979338954:"IFCBUILDINGELEMENTPART",52481810:"IFCBUILDINGELEMENTCOMPONENT",3299480353:"IFCBUILDINGELEMENT",231477066:"IFCBOILERTYPE",1916977116:"IFCBEZIERCURVE",819618141:"IFCBEAMTYPE",1967976161:"IFCBSPLINECURVE",3460190687:"IFCASSET",2470393545:"IFCANGULARDIMENSION",1871374353:"IFCAIRTOAIRHEATRECOVERYTYPE",3352864051:"IFCAIRTERMINALTYPE",1411407467:"IFCAIRTERMINALBOXTYPE",3821786052:"IFCACTIONREQUEST",1213861670:"IFC2DCOMPOSITECURVE",1033361043:"IFCZONE",3342526732:"IFCWORKSCHEDULE",4218914973:"IFCWORKPLAN",1028945134:"IFCWORKCONTROL",1133259667:"IFCWASTETERMINALTYPE",1898987631:"IFCWALLTYPE",2769231204:"IFCVIRTUALELEMENT",728799441:"IFCVALVETYPE",1911125066:"IFCUNITARYEQUIPMENTTYPE",1600972822:"IFCTUBEBUNDLETYPE",3593883385:"IFCTRIMMEDCURVE",1620046519:"IFCTRANSPORTELEMENT",1692211062:"IFCTRANSFORMERTYPE",1637806684:"IFCTIMESERIESSCHEDULE",5716631:"IFCTANKTYPE",2254336722:"IFCSYSTEM",2315554128:"IFCSWITCHINGDEVICETYPE",148013059:"IFCSUBCONTRACTRESOURCE",1975003073:"IFCSTRUCTURALSURFACECONNECTION",2986769608:"IFCSTRUCTURALRESULTGROUP",1235345126:"IFCSTRUCTURALPOINTREACTION",734778138:"IFCSTRUCTURALPOINTCONNECTION",2082059205:"IFCSTRUCTURALPOINTACTION",3987759626:"IFCSTRUCTURALPLANARACTIONVARYING",1621171031:"IFCSTRUCTURALPLANARACTION",1252848954:"IFCSTRUCTURALLOADGROUP",1721250024:"IFCSTRUCTURALLINEARACTIONVARYING",1807405624:"IFCSTRUCTURALLINEARACTION",2445595289:"IFCSTRUCTURALCURVEMEMBERVARYING",214636428:"IFCSTRUCTURALCURVEMEMBER",4243806635:"IFCSTRUCTURALCURVECONNECTION",1179482911:"IFCSTRUCTURALCONNECTION",682877961:"IFCSTRUCTURALACTION",1039846685:"IFCSTAIRFLIGHTTYPE",3112655638:"IFCSTACKTERMINALTYPE",3812236995:"IFCSPACETYPE",652456506:"IFCSPACEPROGRAM",1305183839:"IFCSPACEHEATERTYPE",3856911033:"IFCSPACE",2533589738:"IFCSLABTYPE",4097777520:"IFCSITE",4105383287:"IFCSERVICELIFE",3517283431:"IFCSCHEDULETIMECONTROL",1768891740:"IFCSANITARYTERMINALTYPE",2863920197:"IFCRELASSIGNSTASKS",160246688:"IFCRELAGGREGATES",2324767716:"IFCRAMPFLIGHTTYPE",2893384427:"IFCRAILINGTYPE",3248260540:"IFCRADIUSDIMENSION",2250791053:"IFCPUMPTYPE",1842657554:"IFCPROTECTIVEDEVICETYPE",3651124850:"IFCPROJECTIONELEMENT",3642467123:"IFCPROJECTORDERRECORD",2904328755:"IFCPROJECTORDER",2744685151:"IFCPROCEDURE",3740093272:"IFCPORT",3724593414:"IFCPOLYLINE",4017108033:"IFCPLATETYPE",4231323485:"IFCPIPESEGMENTTYPE",804291784:"IFCPIPEFITTINGTYPE",3327091369:"IFCPERMIT",2382730787:"IFCPERFORMANCEHISTORY",2837617999:"IFCOUTLETTYPE",3425660407:"IFCORDERACTION",3588315303:"IFCOPENINGELEMENT",4143007308:"IFCOCCUPANT",1916936684:"IFCMOVE",977012517:"IFCMOTORCONNECTIONTYPE",3181161470:"IFCMEMBERTYPE",2108223431:"IFCMECHANICALFASTENERTYPE",377706215:"IFCMECHANICALFASTENER",2506943328:"IFCLINEARDIMENSION",1161773419:"IFCLIGHTFIXTURETYPE",1051575348:"IFCLAMPTYPE",3827777499:"IFCLABORRESOURCE",4288270099:"IFCJUNCTIONBOXTYPE",2391368822:"IFCINVENTORY",1806887404:"IFCHUMIDIFIERTYPE",1251058090:"IFCHEATEXCHANGERTYPE",2706460486:"IFCGROUP",3009204131:"IFCGRID",200128114:"IFCGASTERMINALTYPE",814719939:"IFCFURNITURESTANDARD",263784265:"IFCFURNISHINGELEMENT",3009222698:"IFCFLOWTREATMENTDEVICETYPE",2297155007:"IFCFLOWTERMINALTYPE",1339347760:"IFCFLOWSTORAGEDEVICETYPE",1834744321:"IFCFLOWSEGMENTTYPE",1482959167:"IFCFLOWMOVINGDEVICETYPE",3815607619:"IFCFLOWMETERTYPE",3198132628:"IFCFLOWFITTINGTYPE",3907093117:"IFCFLOWCONTROLLERTYPE",1287392070:"IFCFEATUREELEMENTSUBTRACTION",2143335405:"IFCFEATUREELEMENTADDITION",2827207264:"IFCFEATUREELEMENT",2489546625:"IFCFASTENERTYPE",647756555:"IFCFASTENER",3737207727:"IFCFACETEDBREPWITHVOIDS",807026263:"IFCFACETEDBREP",3390157468:"IFCEVAPORATORTYPE",3174744832:"IFCEVAPORATIVECOOLERTYPE",3272907226:"IFCEQUIPMENTSTANDARD",1962604670:"IFCEQUIPMENTELEMENT",2107101300:"IFCENERGYCONVERSIONDEVICETYPE",1704287377:"IFCELLIPSE",2590856083:"IFCELEMENTCOMPONENTTYPE",1623761950:"IFCELEMENTCOMPONENT",4123344466:"IFCELEMENTASSEMBLY",1758889154:"IFCELEMENT",360485395:"IFCELECTRICALBASEPROPERTIES",3849074793:"IFCDISTRIBUTIONFLOWELEMENTTYPE",3256556792:"IFCDISTRIBUTIONELEMENTTYPE",681481545:"IFCDIMENSIONCURVEDIRECTEDCALLOUT",1457835157:"IFCCURTAINWALLTYPE",3295246426:"IFCCREWRESOURCE",1916426348:"IFCCOVERINGTYPE",1419761937:"IFCCOSTSCHEDULE",3895139033:"IFCCOSTITEM",3293443760:"IFCCONTROL",2559216714:"IFCCONSTRUCTIONRESOURCE",2510884976:"IFCCONIC",3732776249:"IFCCOMPOSITECURVE",300633059:"IFCCOLUMNTYPE",2937912522:"IFCCIRCLEHOLLOWPROFILEDEF",3124254112:"IFCBUILDINGSTOREY",1950629157:"IFCBUILDINGELEMENTTYPE",4031249490:"IFCBUILDING",1260505505:"IFCBOUNDEDCURVE",3649129432:"IFCBOOLEANCLIPPINGRESULT",1334484129:"IFCBLOCK",3207858831:"IFCASYMMETRICISHAPEPROFILEDEF",1674181508:"IFCANNOTATION",2296667514:"IFCACTOR",2097647324:"IFCTRANSPORTELEMENTTYPE",3473067441:"IFCTASK",1580310250:"IFCSYSTEMFURNITUREELEMENTTYPE",4124788165:"IFCSURFACEOFREVOLUTION",2809605785:"IFCSURFACEOFLINEAREXTRUSION",2028607225:"IFCSURFACECURVESWEPTAREASOLID",4070609034:"IFCSTRUCTUREDDIMENSIONCALLOUT",2218152070:"IFCSTRUCTURALSURFACEMEMBERVARYING",3979015343:"IFCSTRUCTURALSURFACEMEMBER",3689010777:"IFCSTRUCTURALREACTION",530289379:"IFCSTRUCTURALMEMBER",3136571912:"IFCSTRUCTURALITEM",3544373492:"IFCSTRUCTURALACTIVITY",451544542:"IFCSPHERE",3893378262:"IFCSPATIALSTRUCTUREELEMENTTYPE",2706606064:"IFCSPATIALSTRUCTUREELEMENT",3626867408:"IFCRIGHTCIRCULARCYLINDER",4158566097:"IFCRIGHTCIRCULARCONE",1856042241:"IFCREVOLVEDAREASOLID",2914609552:"IFCRESOURCE",1401173127:"IFCRELVOIDSELEMENT",3451746338:"IFCRELSPACEBOUNDARY",366585022:"IFCRELSERVICESBUILDINGS",4122056220:"IFCRELSEQUENCE",1058617721:"IFCRELSCHEDULESCOSTITEMS",1245217292:"IFCRELREFERENCEDINSPATIALSTRUCTURE",750771296:"IFCRELPROJECTSELEMENT",202636808:"IFCRELOVERRIDESPROPERTIES",2051452291:"IFCRELOCCUPIESSPACES",3268803585:"IFCRELNESTS",4189434867:"IFCRELINTERACTIONREQUIREMENTS",279856033:"IFCRELFLOWCONTROLELEMENTS",3940055652:"IFCRELFILLSELEMENT",781010003:"IFCRELDEFINESBYTYPE",4186316022:"IFCRELDEFINESBYPROPERTIES",693640335:"IFCRELDEFINES",2551354335:"IFCRELDECOMPOSES",2802773753:"IFCRELCOVERSSPACES",886880790:"IFCRELCOVERSBLDGELEMENTS",3242617779:"IFCRELCONTAINEDINSPATIALSTRUCTURE",3678494232:"IFCRELCONNECTSWITHREALIZINGELEMENTS",504942748:"IFCRELCONNECTSWITHECCENTRICITY",1638771189:"IFCRELCONNECTSSTRUCTURALMEMBER",3912681535:"IFCRELCONNECTSSTRUCTURALELEMENT",2127690289:"IFCRELCONNECTSSTRUCTURALACTIVITY",3190031847:"IFCRELCONNECTSPORTS",4201705270:"IFCRELCONNECTSPORTTOELEMENT",3945020480:"IFCRELCONNECTSPATHELEMENTS",1204542856:"IFCRELCONNECTSELEMENTS",826625072:"IFCRELCONNECTS",2851387026:"IFCRELASSOCIATESPROFILEPROPERTIES",2655215786:"IFCRELASSOCIATESMATERIAL",3840914261:"IFCRELASSOCIATESLIBRARY",982818633:"IFCRELASSOCIATESDOCUMENT",2728634034:"IFCRELASSOCIATESCONSTRAINT",919958153:"IFCRELASSOCIATESCLASSIFICATION",4095574036:"IFCRELASSOCIATESAPPROVAL",1327628568:"IFCRELASSOCIATESAPPLIEDVALUE",1865459582:"IFCRELASSOCIATES",205026976:"IFCRELASSIGNSTORESOURCE",3372526763:"IFCRELASSIGNSTOPROJECTORDER",2857406711:"IFCRELASSIGNSTOPRODUCT",4278684876:"IFCRELASSIGNSTOPROCESS",1307041759:"IFCRELASSIGNSTOGROUP",2495723537:"IFCRELASSIGNSTOCONTROL",1683148259:"IFCRELASSIGNSTOACTOR",3939117080:"IFCRELASSIGNS",3454111270:"IFCRECTANGULARTRIMMEDSURFACE",2798486643:"IFCRECTANGULARPYRAMID",2770003689:"IFCRECTANGLEHOLLOWPROFILEDEF",3219374653:"IFCPROXY",1451395588:"IFCPROPERTYSET",4194566429:"IFCPROJECTIONCURVE",103090709:"IFCPROJECT",4208778838:"IFCPRODUCT",2945172077:"IFCPROCESS",220341763:"IFCPLANE",603570806:"IFCPLANARBOX",3566463478:"IFCPERMEABLECOVERINGPROPERTIES",3505215534:"IFCOFFSETCURVE3D",3388369263:"IFCOFFSETCURVE2D",3888040117:"IFCOBJECT",1425443689:"IFCMANIFOLDSOLIDBREP",1281925730:"IFCLINE",572779678:"IFCLSHAPEPROFILEDEF",1484403080:"IFCISHAPEPROFILEDEF",987898635:"IFCGEOMETRICCURVESET",1268542332:"IFCFURNITURETYPE",4238390223:"IFCFURNISHINGELEMENTTYPE",3455213021:"IFCFLUIDFLOWPROPERTIES",315944413:"IFCFILLAREASTYLETILES",4203026998:"IFCFILLAREASTYLETILESYMBOLWITHSTYLE",374418227:"IFCFILLAREASTYLEHATCHING",2047409740:"IFCFACEBASEDSURFACEMODEL",477187591:"IFCEXTRUDEDAREASOLID",80994333:"IFCENERGYPROPERTIES",2835456948:"IFCELLIPSEPROFILEDEF",2777663545:"IFCELEMENTARYSURFACE",339256511:"IFCELEMENTTYPE",1883228015:"IFCELEMENTQUANTITY",1472233963:"IFCEDGELOOP",4006246654:"IFCDRAUGHTINGPREDEFINEDCURVEFONT",445594917:"IFCDRAUGHTINGPREDEFINEDCOLOUR",3073041342:"IFCDRAUGHTINGCALLOUT",526551008:"IFCDOORSTYLE",1714330368:"IFCDOORPANELPROPERTIES",2963535650:"IFCDOORLININGPROPERTIES",32440307:"IFCDIRECTION",4054601972:"IFCDIMENSIONCURVETERMINATOR",606661476:"IFCDIMENSIONCURVE",693772133:"IFCDEFINEDSYMBOL",2827736869:"IFCCURVEBOUNDEDPLANE",2601014836:"IFCCURVE",2147822146:"IFCCSGSOLID",2506170314:"IFCCSGPRIMITIVE3D",194851669:"IFCCRANERAILFSHAPEPROFILEDEF",4133800736:"IFCCRANERAILASHAPEPROFILEDEF",2485617015:"IFCCOMPOSITECURVESEGMENT",2205249479:"IFCCLOSEDSHELL",1383045692:"IFCCIRCLEPROFILEDEF",1416205885:"IFCCARTESIANTRANSFORMATIONOPERATOR3DNONUNIFORM",3331915920:"IFCCARTESIANTRANSFORMATIONOPERATOR3D",3486308946:"IFCCARTESIANTRANSFORMATIONOPERATOR2DNONUNIFORM",3749851601:"IFCCARTESIANTRANSFORMATIONOPERATOR2D",59481748:"IFCCARTESIANTRANSFORMATIONOPERATOR",1123145078:"IFCCARTESIANPOINT",2898889636:"IFCCSHAPEPROFILEDEF",2713105998:"IFCBOXEDHALFSPACE",2581212453:"IFCBOUNDINGBOX",4182860854:"IFCBOUNDEDSURFACE",2736907675:"IFCBOOLEANRESULT",2740243338:"IFCAXIS2PLACEMENT3D",3125803723:"IFCAXIS2PLACEMENT2D",4261334040:"IFCAXIS1PLACEMENT",1302238472:"IFCANNOTATIONSURFACE",2265737646:"IFCANNOTATIONFILLAREAOCCURRENCE",669184980:"IFCANNOTATIONFILLAREA",3288037868:"IFCANNOTATIONCURVEOCCURRENCE",2543172580:"IFCZSHAPEPROFILEDEF",1299126871:"IFCWINDOWSTYLE",512836454:"IFCWINDOWPANELPROPERTIES",336235671:"IFCWINDOWLININGPROPERTIES",2759199220:"IFCVERTEXLOOP",1417489154:"IFCVECTOR",427810014:"IFCUSHAPEPROFILEDEF",2347495698:"IFCTYPEPRODUCT",1628702193:"IFCTYPEOBJECT",1345879162:"IFCTWODIRECTIONREPEATFACTOR",2715220739:"IFCTRAPEZIUMPROFILEDEF",3124975700:"IFCTEXTLITERALWITHEXTENT",4282788508:"IFCTEXTLITERAL",3028897424:"IFCTERMINATORSYMBOL",3071757647:"IFCTSHAPEPROFILEDEF",230924584:"IFCSWEPTSURFACE",1260650574:"IFCSWEPTDISKSOLID",2247615214:"IFCSWEPTAREASOLID",1878645084:"IFCSURFACESTYLERENDERING",2513912981:"IFCSURFACE",2233826070:"IFCSUBEDGE",3653947884:"IFCSTRUCTURALSTEELPROFILEPROPERTIES",3843319758:"IFCSTRUCTURALPROFILEPROPERTIES",1190533807:"IFCSTRUCTURALLOADSINGLEFORCEWARPING",1597423693:"IFCSTRUCTURALLOADSINGLEFORCE",1973038258:"IFCSTRUCTURALLOADSINGLEDISPLACEMENTDISTORTION",2473145415:"IFCSTRUCTURALLOADSINGLEDISPLACEMENT",2668620305:"IFCSTRUCTURALLOADPLANARFORCE",1595516126:"IFCSTRUCTURALLOADLINEARFORCE",390701378:"IFCSPACETHERMALLOADPROPERTIES",1202362311:"IFCSOUNDVALUE",2485662743:"IFCSOUNDPROPERTIES",723233188:"IFCSOLIDMODEL",2609359061:"IFCSLIPPAGECONNECTIONCONDITION",4124623270:"IFCSHELLBASEDSURFACEMODEL",2411513650:"IFCSERVICELIFEFACTOR",1509187699:"IFCSECTIONEDSPINE",2778083089:"IFCROUNDEDRECTANGLEPROFILEDEF",478536968:"IFCRELATIONSHIP",3765753017:"IFCREINFORCEMENTDEFINITIONPROPERTIES",3413951693:"IFCREGULARTIMESERIES",3615266464:"IFCRECTANGLEPROFILEDEF",110355661:"IFCPROPERTYTABLEVALUE",3650150729:"IFCPROPERTYSINGLEVALUE",3357820518:"IFCPROPERTYSETDEFINITION",941946838:"IFCPROPERTYREFERENCEVALUE",2752243245:"IFCPROPERTYLISTVALUE",4166981789:"IFCPROPERTYENUMERATEDVALUE",1680319473:"IFCPROPERTYDEFINITION",871118103:"IFCPROPERTYBOUNDEDVALUE",673634403:"IFCPRODUCTDEFINITIONSHAPE",179317114:"IFCPREDEFINEDPOINTMARKERSYMBOL",433424934:"IFCPREDEFINEDDIMENSIONSYMBOL",2559016684:"IFCPREDEFINEDCURVEFONT",759155922:"IFCPREDEFINEDCOLOUR",2775532180:"IFCPOLYGONALBOUNDEDHALFSPACE",2924175390:"IFCPOLYLOOP",1423911732:"IFCPOINTONSURFACE",4022376103:"IFCPOINTONCURVE",2067069095:"IFCPOINT",1663979128:"IFCPLANAREXTENT",2004835150:"IFCPLACEMENT",597895409:"IFCPIXELTEXTURE",3021840470:"IFCPHYSICALCOMPLEXQUANTITY",2519244187:"IFCPATH",2529465313:"IFCPARAMETERIZEDPROFILEDEF",1029017970:"IFCORIENTEDEDGE",2665983363:"IFCOPENSHELL",2833995503:"IFCONEDIRECTIONREPEATFACTOR",219451334:"IFCOBJECTDEFINITION",1430189142:"IFCMECHANICALCONCRETEMATERIALPROPERTIES",2022407955:"IFCMATERIALDEFINITIONREPRESENTATION",2347385850:"IFCMAPPEDITEM",1008929658:"IFCLOOP",2624227202:"IFCLOCALPLACEMENT",3422422726:"IFCLIGHTSOURCESPOT",1520743889:"IFCLIGHTSOURCEPOSITIONAL",4266656042:"IFCLIGHTSOURCEGONIOMETRIC",2604431987:"IFCLIGHTSOURCEDIRECTIONAL",125510826:"IFCLIGHTSOURCEAMBIENT",1402838566:"IFCLIGHTSOURCE",3741457305:"IFCIRREGULARTIMESERIES",3905492369:"IFCIMAGETEXTURE",2445078500:"IFCHYGROSCOPICMATERIALPROPERTIES",812098782:"IFCHALFSPACESOLID",178086475:"IFCGRIDPLACEMENT",3590301190:"IFCGEOMETRICSET",4142052618:"IFCGEOMETRICREPRESENTATIONSUBCONTEXT",2453401579:"IFCGEOMETRICREPRESENTATIONITEM",3448662350:"IFCGEOMETRICREPRESENTATIONCONTEXT",1446786286:"IFCGENERALPROFILEPROPERTIES",803998398:"IFCGENERALMATERIALPROPERTIES",3857492461:"IFCFUELPROPERTIES",738692330:"IFCFILLAREASTYLE",4219587988:"IFCFAILURECONNECTIONCONDITION",3008276851:"IFCFACESURFACE",803316827:"IFCFACEOUTERBOUND",1809719519:"IFCFACEBOUND",2556980723:"IFCFACE",1860660968:"IFCEXTENDEDMATERIALPROPERTIES",476780140:"IFCEDGECURVE",3900360178:"IFCEDGE",4170525392:"IFCDRAUGHTINGPREDEFINEDTEXTFONT",3732053477:"IFCDOCUMENTREFERENCE",1694125774:"IFCDIMENSIONPAIR",2273265877:"IFCDIMENSIONCALLOUTRELATIONSHIP",3632507154:"IFCDERIVEDPROFILEDEF",3800577675:"IFCCURVESTYLE",2889183280:"IFCCONVERSIONBASEDUNIT",3050246964:"IFCCONTEXTDEPENDENTUNIT",45288368:"IFCCONNECTIONPOINTECCENTRICITY",1981873012:"IFCCONNECTIONCURVEGEOMETRY",370225590:"IFCCONNECTEDFACESET",1485152156:"IFCCOMPOSITEPROFILEDEF",2542286263:"IFCCOMPLEXPROPERTY",776857604:"IFCCOLOURRGB",647927063:"IFCCLASSIFICATIONREFERENCE",3150382593:"IFCCENTERLINEPROFILEDEF",616511568:"IFCBLOBTEXTURE",2705031697:"IFCARBITRARYPROFILEDEFWITHVOIDS",1310608509:"IFCARBITRARYOPENPROFILEDEF",3798115385:"IFCARBITRARYCLOSEDPROFILEDEF",2297822566:"IFCANNOTATIONTEXTOCCURRENCE",3612888222:"IFCANNOTATIONSYMBOLOCCURRENCE",962685235:"IFCANNOTATIONSURFACEOCCURRENCE",2442683028:"IFCANNOTATIONOCCURRENCE",1065908215:"IFCWATERPROPERTIES",891718957:"IFCVIRTUALGRIDINTERSECTION",1907098498:"IFCVERTEXPOINT",3304826586:"IFCVERTEXBASEDTEXTUREMAP",2799835756:"IFCVERTEX",180925521:"IFCUNITASSIGNMENT",1735638870:"IFCTOPOLOGYREPRESENTATION",1377556343:"IFCTOPOLOGICALREPRESENTATIONITEM",581633288:"IFCTIMESERIESVALUE",1718945513:"IFCTIMESERIESREFERENCERELATIONSHIP",3101149627:"IFCTIMESERIES",3317419933:"IFCTHERMALMATERIALPROPERTIES",1210645708:"IFCTEXTUREVERTEX",2552916305:"IFCTEXTUREMAP",1742049831:"IFCTEXTURECOORDINATEGENERATOR",280115917:"IFCTEXTURECOORDINATE",1484833681:"IFCTEXTSTYLEWITHBOXCHARACTERISTICS",1640371178:"IFCTEXTSTYLETEXTMODEL",2636378356:"IFCTEXTSTYLEFORDEFINEDFONT",1983826977:"IFCTEXTSTYLEFONTMODEL",1447204868:"IFCTEXTSTYLE",912023232:"IFCTELECOMADDRESS",531007025:"IFCTABLEROW",985171141:"IFCTABLE",1290481447:"IFCSYMBOLSTYLE",626085974:"IFCSURFACETEXTURE",1351298697:"IFCSURFACESTYLEWITHTEXTURES",846575682:"IFCSURFACESTYLESHADING",1607154358:"IFCSURFACESTYLEREFRACTION",3303107099:"IFCSURFACESTYLELIGHTING",1300840506:"IFCSURFACESTYLE",3049322572:"IFCSTYLEDREPRESENTATION",3958052878:"IFCSTYLEDITEM",2830218821:"IFCSTYLEMODEL",3408363356:"IFCSTRUCTURALLOADTEMPERATURE",2525727697:"IFCSTRUCTURALLOADSTATIC",2162789131:"IFCSTRUCTURALLOAD",2273995522:"IFCSTRUCTURALCONNECTIONCONDITION",3692461612:"IFCSIMPLEPROPERTY",4240577450:"IFCSHAPEREPRESENTATION",3982875396:"IFCSHAPEMODEL",867548509:"IFCSHAPEASPECT",4165799628:"IFCSECTIONREINFORCEMENTPROPERTIES",2042790032:"IFCSECTIONPROPERTIES",448429030:"IFCSIUNIT",2341007311:"IFCROOT",3679540991:"IFCRIBPLATEPROFILEPROPERTIES",1660063152:"IFCREPRESENTATIONMAP",3008791417:"IFCREPRESENTATIONITEM",3377609919:"IFCREPRESENTATIONCONTEXT",1076942058:"IFCREPRESENTATION",1222501353:"IFCRELAXATION",1580146022:"IFCREINFORCEMENTBARPROPERTIES",2692823254:"IFCREFERENCESVALUEDOCUMENT",825690147:"IFCQUANTITYWEIGHT",2405470396:"IFCQUANTITYVOLUME",3252649465:"IFCQUANTITYTIME",931644368:"IFCQUANTITYLENGTH",2093928680:"IFCQUANTITYCOUNT",2044713172:"IFCQUANTITYAREA",3710013099:"IFCPROPERTYENUMERATION",148025276:"IFCPROPERTYDEPENDENCYRELATIONSHIP",3896028662:"IFCPROPERTYCONSTRAINTRELATIONSHIP",2598011224:"IFCPROPERTY",2802850158:"IFCPROFILEPROPERTIES",3958567839:"IFCPROFILEDEF",2267347899:"IFCPRODUCTSOFCOMBUSTIONPROPERTIES",2095639259:"IFCPRODUCTREPRESENTATION",2417041796:"IFCPRESENTATIONSTYLEASSIGNMENT",3119450353:"IFCPRESENTATIONSTYLE",1304840413:"IFCPRESENTATIONLAYERWITHSTYLE",2022622350:"IFCPRESENTATIONLAYERASSIGNMENT",1775413392:"IFCPREDEFINEDTEXTFONT",3213052703:"IFCPREDEFINEDTERMINATORSYMBOL",990879717:"IFCPREDEFINEDSYMBOL",3727388367:"IFCPREDEFINEDITEM",3355820592:"IFCPOSTALADDRESS",2226359599:"IFCPHYSICALSIMPLEQUANTITY",2483315170:"IFCPHYSICALQUANTITY",101040310:"IFCPERSONANDORGANIZATION",2077209135:"IFCPERSON",1207048766:"IFCOWNERHISTORY",1411181986:"IFCORGANIZATIONRELATIONSHIP",4251960020:"IFCORGANIZATION",1227763645:"IFCOPTICALMATERIALPROPERTIES",2251480897:"IFCOBJECTIVE",3701648758:"IFCOBJECTPLACEMENT",1918398963:"IFCNAMEDUNIT",2706619895:"IFCMONETARYUNIT",3368373690:"IFCMETRIC",677618848:"IFCMECHANICALSTEELMATERIALPROPERTIES",4256014907:"IFCMECHANICALMATERIALPROPERTIES",2597039031:"IFCMEASUREWITHUNIT",3265635763:"IFCMATERIALPROPERTIES",2199411900:"IFCMATERIALLIST",1303795690:"IFCMATERIALLAYERSETUSAGE",3303938423:"IFCMATERIALLAYERSET",248100487:"IFCMATERIALLAYER",1847130766:"IFCMATERIALCLASSIFICATIONRELATIONSHIP",1838606355:"IFCMATERIAL",30780891:"IFCLOCALTIME",1566485204:"IFCLIGHTINTENSITYDISTRIBUTION",4162380809:"IFCLIGHTDISTRIBUTIONDATA",3452421091:"IFCLIBRARYREFERENCE",2655187982:"IFCLIBRARYINFORMATION",3020489413:"IFCIRREGULARTIMESERIESVALUE",852622518:"IFCGRIDAXIS",3548104201:"IFCEXTERNALLYDEFINEDTEXTFONT",3207319532:"IFCEXTERNALLYDEFINEDSYMBOL",1040185647:"IFCEXTERNALLYDEFINEDSURFACESTYLE",2242383968:"IFCEXTERNALLYDEFINEDHATCHSTYLE",3200245327:"IFCEXTERNALREFERENCE",1648886627:"IFCENVIRONMENTALIMPACTVALUE",3796139169:"IFCDRAUGHTINGCALLOUTRELATIONSHIP",770865208:"IFCDOCUMENTINFORMATIONRELATIONSHIP",1154170062:"IFCDOCUMENTINFORMATION",1376555844:"IFCDOCUMENTELECTRONICFORMAT",2949456006:"IFCDIMENSIONALEXPONENTS",1045800335:"IFCDERIVEDUNITELEMENT",1765591967:"IFCDERIVEDUNIT",1072939445:"IFCDATEANDTIME",3510044353:"IFCCURVESTYLEFONTPATTERN",2367409068:"IFCCURVESTYLEFONTANDSCALING",1105321065:"IFCCURVESTYLEFONT",539742890:"IFCCURRENCYRELATIONSHIP",602808272:"IFCCOSTVALUE",1065062679:"IFCCOORDINATEDUNIVERSALTIMEOFFSET",347226245:"IFCCONSTRAINTRELATIONSHIP",613356794:"IFCCONSTRAINTCLASSIFICATIONRELATIONSHIP",1658513725:"IFCCONSTRAINTAGGREGATIONRELATIONSHIP",1959218052:"IFCCONSTRAINT",2732653382:"IFCCONNECTIONSURFACEGEOMETRY",4257277454:"IFCCONNECTIONPORTGEOMETRY",2614616156:"IFCCONNECTIONPOINTGEOMETRY",2859738748:"IFCCONNECTIONGEOMETRY",3264961684:"IFCCOLOURSPECIFICATION",3639012971:"IFCCLASSIFICATIONNOTATIONFACET",938368621:"IFCCLASSIFICATIONNOTATION",1098599126:"IFCCLASSIFICATIONITEMRELATIONSHIP",1767535486:"IFCCLASSIFICATIONITEM",747523909:"IFCCLASSIFICATION",622194075:"IFCCALENDARDATE",2069777674:"IFCBOUNDARYNODECONDITIONWARPING",1387855156:"IFCBOUNDARYNODECONDITION",3367102660:"IFCBOUNDARYFACECONDITION",1560379544:"IFCBOUNDARYEDGECONDITION",4037036970:"IFCBOUNDARYCONDITION",3869604511:"IFCAPPROVALRELATIONSHIP",390851274:"IFCAPPROVALPROPERTYRELATIONSHIP",2080292479:"IFCAPPROVALACTORRELATIONSHIP",130549933:"IFCAPPROVAL",1110488051:"IFCAPPLIEDVALUERELATIONSHIP",411424972:"IFCAPPLIEDVALUE",639542469:"IFCAPPLICATION",618182010:"IFCADDRESS",3630933823:"IFCACTORROLE",599546466:"FILE_DESCRIPTION",1390159747:"FILE_NAME",1109904537:"FILE_SCHEMA"};class cs{static async getUnits(e){var t,s,i;const{IFCUNITASSIGNMENT:n}=ht,r=await e.getAllPropertiesOfType(n);if(!r)return 1;const o=Object.keys(r),a=r[parseInt(o[0],10)];for(const c of a.Units){if(c.value===void 0||c.value===null)continue;const h=await e.getProperties(c.value);if(!h||!h.UnitType||!h.UnitType.value||h.UnitType.value!=="LENGTHUNIT")continue;let I=1,d=1;return h.Name.value==="METRE"&&(d=1),h.Name.value==="FOOT"&&(d=.3048),((t=h.Prefix)==null?void 0:t.value)==="MILLI"?I=.001:((s=h.Prefix)==null?void 0:s.value)==="CENTI"?I=.01:((i=h.Prefix)==null?void 0:i.value)==="DECI"&&(I=.1),d*I}return 1}static async findItemByGuid(e,t){var s;const i=e.getAllPropertiesIDs();for(const n of i){const r=await e.getProperties(n);if(r&&((s=r.GlobalId)==null?void 0:s.value)===t)return r}return null}static async getRelationMap(e,t,s){var i;const n=s??(async()=>{}),r={},o=e.getAllPropertiesIDs();for(const a of o){const c=await e.getProperties(a);if(!c)continue;const h=c.type===t,I=Object.keys(c).find(C=>C.startsWith("Relating")),d=Object.keys(c).find(C=>C.startsWith("Related"));if(!(h&&I&&d))continue;const u=await e.getProperties((i=c[I])==null?void 0:i.value),f=c[d];if(!u||!f||!(f&&Array.isArray(f)))continue;const E=f.map(C=>C.value);await n(u.expressID,E),r[u.expressID]=E}return r}static async getQsetQuantities(e,t,s){const i=s??(()=>{}),n=await e.getProperties(t);return!n||n.type!==Ri?null:(n.Quantities??[{}]).map(r=>(r.value&&i(r.value),r.value)).filter(r=>r!==null)}static async getPsetProps(e,t,s){const i=s??(()=>{}),n=await e.getProperties(t);return!n||n.type!==ls?null:(n.HasProperties??[{}]).map(r=>(r.value&&i(r.value),r.value)).filter(r=>r!==null)}static async getPsetRel(e,t){var s;if(!await e.getProperties(t))return null;const i=await e.getAllPropertiesOfType(Hs);if(!i)return null;const n=Object.values(i);let r=null;for(const o of n)((s=o.RelatingPropertyDefinition)==null?void 0:s.value)===t&&(r=o.expressID);return r}static async getQsetRel(e,t){return cs.getPsetRel(e,t)}static async getEntityName(e,t){var s;const i=await e.getProperties(t);if(!i)return{key:null,name:null};const n=Object.keys(i).find(o=>o.endsWith("Name"))??null,r=n?(s=i[n])==null?void 0:s.value:null;return{key:n,name:r}}static async getQuantityValue(e,t){const s=await e.getProperties(t);if(!s)return{key:null,value:null};const i=Object.keys(s).find(r=>r.endsWith("Value"))??null;let n;return i===null||s[i]===void 0||s[i]===null?n=null:n=s[i].value,{key:i,value:n}}static isRel(e){return wi[e].startsWith("IFCREL")}static async attributeExists(e,t,s){const i=await e.getProperties(t);return i?Object.keys(i).includes(s):!1}static async groupEntitiesByType(e,t){var s;const i=new Map;for(const n of t){const r=await e.getProperties(n);if(!r)continue;const o=r.type;i.get(o)||i.set(o,new Set),(s=i.get(o))==null||s.add(n)}return i}}const lh={IFCURIREFERENCE:"IfcUriReference",IFCTIME:"IfcTime",IFCTEMPERATURERATEOFCHANGEMEASURE:"IfcTemperatureRateOfChangeMeasure",IFCSOUNDPRESSURELEVELMEASURE:"IfcSoundPressureLevelMeasure",IFCSOUNDPOWERLEVELMEASURE:"IfcSoundPowerLevelMeasure",IFCPROPERTYSETDEFINITIONSET:"IfcPropertySetDefinitionSet",IFCPOSITIVEINTEGER:"IfcPositiveInteger",IFCNONNEGATIVELENGTHMEASURE:"IfcNonNegativeLengthMeasure",IFCLINEINDEX:"IfcLineIndex",IFCLANGUAGEID:"IfcLanguageId",IFCDURATION:"IfcDuration",IFCDAYINWEEKNUMBER:"IfcDayInWeekNumber",IFCDATETIME:"IfcDateTime",IFCDATE:"IfcDate",IFCCARDINALPOINTREFERENCE:"IfcCardinalPointReference",IFCBINARY:"IfcBinary",IFCAREADENSITYMEASURE:"IfcAreaDensityMeasure",IFCARCINDEX:"IfcArcIndex",IFCYEARNUMBER:"IfcYearNumber",IFCWARPINGMOMENTMEASURE:"IfcWarpingMomentMeasure",IFCWARPINGCONSTANTMEASURE:"IfcWarpingConstantMeasure",IFCVOLUMETRICFLOWRATEMEASURE:"IfcVolumetricFlowRateMeasure",IFCVOLUMEMEASURE:"IfcVolumeMeasure",IFCVAPORPERMEABILITYMEASURE:"IfcVaporPermeabilityMeasure",IFCTORQUEMEASURE:"IfcTorqueMeasure",IFCTIMESTAMP:"IfcTimestamp",IFCTIMEMEASURE:"IfcTimeMeasure",IFCTHERMODYNAMICTEMPERATUREMEASURE:"IfcThermodynamicTemperatureMeasure",IFCTHERMALTRANSMITTANCEMEASURE:"IfcThermalTransmittanceMeasure",IFCTHERMALRESISTANCEMEASURE:"IfcThermalResistanceMeasure",IFCTHERMALEXPANSIONCOEFFICIENTMEASURE:"IfcThermalExpansionCoefficientMeasure",IFCTHERMALCONDUCTIVITYMEASURE:"IfcThermalConductivityMeasure",IFCTHERMALADMITTANCEMEASURE:"IfcThermalAdmittanceMeasure",IFCTEXTTRANSFORMATION:"IfcTextTransformation",IFCTEXTFONTNAME:"IfcTextFontName",IFCTEXTDECORATION:"IfcTextDecoration",IFCTEXTALIGNMENT:"IfcTextAlignment",IFCTEXT:"IfcText",IFCTEMPERATUREGRADIENTMEASURE:"IfcTemperatureGradientMeasure",IFCSPECULARROUGHNESS:"IfcSpecularRoughness",IFCSPECULAREXPONENT:"IfcSpecularExponent",IFCSPECIFICHEATCAPACITYMEASURE:"IfcSpecificHeatCapacityMeasure",IFCSOUNDPRESSUREMEASURE:"IfcSoundPressureMeasure",IFCSOUNDPOWERMEASURE:"IfcSoundPowerMeasure",IFCSOLIDANGLEMEASURE:"IfcSolidAngleMeasure",IFCSHEARMODULUSMEASURE:"IfcShearModulusMeasure",IFCSECTIONALAREAINTEGRALMEASURE:"IfcSectionalAreaIntegralMeasure",IFCSECTIONMODULUSMEASURE:"IfcSectionModulusMeasure",IFCSECONDINMINUTE:"IfcSecondInMinute",IFCROTATIONALSTIFFNESSMEASURE:"IfcRotationalStiffnessMeasure",IFCROTATIONALMASSMEASURE:"IfcRotationalMassMeasure",IFCROTATIONALFREQUENCYMEASURE:"IfcRotationalFrequencyMeasure",IFCREAL:"IfcReal",IFCRATIOMEASURE:"IfcRatioMeasure",IFCRADIOACTIVITYMEASURE:"IfcRadioactivityMeasure",IFCPRESSUREMEASURE:"IfcPressureMeasure",IFCPRESENTABLETEXT:"IfcPresentableText",IFCPOWERMEASURE:"IfcPowerMeasure",IFCPOSITIVERATIOMEASURE:"IfcPositiveRatioMeasure",IFCPOSITIVEPLANEANGLEMEASURE:"IfcPositivePlaneAngleMeasure",IFCPOSITIVELENGTHMEASURE:"IfcPositiveLengthMeasure",IFCPLANEANGLEMEASURE:"IfcPlaneAngleMeasure",IFCPLANARFORCEMEASURE:"IfcPlanarForceMeasure",IFCPARAMETERVALUE:"IfcParameterValue",IFCPHMEASURE:"IfcPhMeasure",IFCNUMERICMEASURE:"IfcNumericMeasure",IFCNORMALISEDRATIOMEASURE:"IfcNormalisedRatioMeasure",IFCMONTHINYEARNUMBER:"IfcMonthInYearNumber",IFCMONETARYMEASURE:"IfcMonetaryMeasure",IFCMOMENTOFINERTIAMEASURE:"IfcMomentOfInertiaMeasure",IFCMOLECULARWEIGHTMEASURE:"IfcMolecularWeightMeasure",IFCMOISTUREDIFFUSIVITYMEASURE:"IfcMoistureDiffusivityMeasure",IFCMODULUSOFSUBGRADEREACTIONMEASURE:"IfcModulusOfSubgradeReactionMeasure",IFCMODULUSOFROTATIONALSUBGRADEREACTIONMEASURE:"IfcModulusOfRotationalSubgradeReactionMeasure",IFCMODULUSOFLINEARSUBGRADEREACTIONMEASURE:"IfcModulusOfLinearSubgradeReactionMeasure",IFCMODULUSOFELASTICITYMEASURE:"IfcModulusOfElasticityMeasure",IFCMINUTEINHOUR:"IfcMinuteInHour",IFCMASSPERLENGTHMEASURE:"IfcMassPerLengthMeasure",IFCMASSMEASURE:"IfcMassMeasure",IFCMASSFLOWRATEMEASURE:"IfcMassFlowRateMeasure",IFCMASSDENSITYMEASURE:"IfcMassDensityMeasure",IFCMAGNETICFLUXMEASURE:"IfcMagneticFluxMeasure",IFCMAGNETICFLUXDENSITYMEASURE:"IfcMagneticFluxDensityMeasure",IFCLUMINOUSINTENSITYMEASURE:"IfcLuminousIntensityMeasure",IFCLUMINOUSINTENSITYDISTRIBUTIONMEASURE:"IfcLuminousIntensityDistributionMeasure",IFCLUMINOUSFLUXMEASURE:"IfcLuminousFluxMeasure",IFCLOGICAL:"IfcLogical",IFCLINEARVELOCITYMEASURE:"IfcLinearVelocityMeasure",IFCLINEARSTIFFNESSMEASURE:"IfcLinearStiffnessMeasure",IFCLINEARMOMENTMEASURE:"IfcLinearMomentMeasure",IFCLINEARFORCEMEASURE:"IfcLinearForceMeasure",IFCLENGTHMEASURE:"IfcLengthMeasure",IFCLABEL:"IfcLabel",IFCKINEMATICVISCOSITYMEASURE:"IfcKinematicViscosityMeasure",IFCISOTHERMALMOISTURECAPACITYMEASURE:"IfcIsothermalMoistureCapacityMeasure",IFCIONCONCENTRATIONMEASURE:"IfcIonConcentrationMeasure",IFCINTEGERCOUNTRATEMEASURE:"IfcIntegerCountRateMeasure",IFCINTEGER:"IfcInteger",IFCINDUCTANCEMEASURE:"IfcInductanceMeasure",IFCILLUMINANCEMEASURE:"IfcIlluminanceMeasure",IFCIDENTIFIER:"IfcIdentifier",IFCHOURINDAY:"IfcHourInDay",IFCHEATINGVALUEMEASURE:"IfcHeatingValueMeasure",IFCHEATFLUXDENSITYMEASURE:"IfcHeatFluxDensityMeasure",IFCGLOBALLYUNIQUEID:"IfcGloballyUniqueId",IFCFREQUENCYMEASURE:"IfcFrequencyMeasure",IFCFORCEMEASURE:"IfcForceMeasure",IFCFONTWEIGHT:"IfcFontWeight",IFCFONTVARIANT:"IfcFontVariant",IFCFONTSTYLE:"IfcFontStyle",IFCENERGYMEASURE:"IfcEnergyMeasure",IFCELECTRICVOLTAGEMEASURE:"IfcElectricVoltageMeasure",IFCELECTRICRESISTANCEMEASURE:"IfcElectricResistanceMeasure",IFCELECTRICCURRENTMEASURE:"IfcElectricCurrentMeasure",IFCELECTRICCONDUCTANCEMEASURE:"IfcElectricConductanceMeasure",IFCELECTRICCHARGEMEASURE:"IfcElectricChargeMeasure",IFCELECTRICCAPACITANCEMEASURE:"IfcElectricCapacitanceMeasure",IFCDYNAMICVISCOSITYMEASURE:"IfcDynamicViscosityMeasure",IFCDOSEEQUIVALENTMEASURE:"IfcDoseEquivalentMeasure",IFCDIMENSIONCOUNT:"IfcDimensionCount",IFCDESCRIPTIVEMEASURE:"IfcDescriptiveMeasure",IFCDAYLIGHTSAVINGHOUR:"IfcDaylightSavingHour",IFCDAYINMONTHNUMBER:"IfcDayInMonthNumber",IFCCURVATUREMEASURE:"IfcCurvatureMeasure",IFCCOUNTMEASURE:"IfcCountMeasure",IFCCONTEXTDEPENDENTMEASURE:"IfcContextDependentMeasure",IFCCOMPOUNDPLANEANGLEMEASURE:"IfcCompoundPlaneAngleMeasure",IFCCOMPLEXNUMBER:"IfcComplexNumber",IFCBOXALIGNMENT:"IfcBoxAlignment",IFCBOOLEAN:"IfcBoolean",IFCAREAMEASURE:"IfcAreaMeasure",IFCANGULARVELOCITYMEASURE:"IfcAngularVelocityMeasure",IFCAMOUNTOFSUBSTANCEMEASURE:"IfcAmountOfSubstanceMeasure",IFCACCELERATIONMEASURE:"IfcAccelerationMeasure",IFCABSORBEDDOSEMEASURE:"IfcAbsorbedDoseMeasure",IFCGEOSLICE:"IfcGeoSlice",IFCGEOMODEL:"IfcGeoModel",IFCELECTRICFLOWTREATMENTDEVICE:"IfcElectricFlowTreatmentDevice",IFCDISTRIBUTIONBOARD:"IfcDistributionBoard",IFCCONVEYORSEGMENT:"IfcConveyorSegment",IFCCAISSONFOUNDATION:"IfcCaissonFoundation",IFCBOREHOLE:"IfcBorehole",IFCBEARING:"IfcBearing",IFCALIGNMENT:"IfcAlignment",IFCTRACKELEMENT:"IfcTrackElement",IFCSIGNAL:"IfcSignal",IFCREINFORCEDSOIL:"IfcReinforcedSoil",IFCRAIL:"IfcRail",IFCPAVEMENT:"IfcPavement",IFCNAVIGATIONELEMENT:"IfcNavigationElement",IFCMOORINGDEVICE:"IfcMooringDevice",IFCMOBILETELECOMMUNICATIONSAPPLIANCE:"IfcMobileTelecommunicationsAppliance",IFCLIQUIDTERMINAL:"IfcLiquidTerminal",IFCLINEARPOSITIONINGELEMENT:"IfcLinearPositioningElement",IFCKERB:"IfcKerb",IFCGEOTECHNICALASSEMBLY:"IfcGeotechnicalAssembly",IFCELECTRICFLOWTREATMENTDEVICETYPE:"IfcElectricFlowTreatmentDeviceType",IFCEARTHWORKSFILL:"IfcEarthworksFill",IFCEARTHWORKSELEMENT:"IfcEarthworksElement",IFCEARTHWORKSCUT:"IfcEarthworksCut",IFCDISTRIBUTIONBOARDTYPE:"IfcDistributionBoardType",IFCDEEPFOUNDATION:"IfcDeepFoundation",IFCCOURSE:"IfcCourse",IFCCONVEYORSEGMENTTYPE:"IfcConveyorSegmentType",IFCCAISSONFOUNDATIONTYPE:"IfcCaissonFoundationType",IFCBUILTSYSTEM:"IfcBuiltSystem",IFCBUILTELEMENT:"IfcBuiltElement",IFCBRIDGEPART:"IfcBridgePart",IFCBRIDGE:"IfcBridge",IFCBEARINGTYPE:"IfcBearingType",IFCALIGNMENTVERTICAL:"IfcAlignmentVertical",IFCALIGNMENTSEGMENT:"IfcAlignmentSegment",IFCALIGNMENTHORIZONTAL:"IfcAlignmentHorizontal",IFCALIGNMENTCANT:"IfcAlignmentCant",IFCVIBRATIONDAMPERTYPE:"IfcVibrationDamperType",IFCVIBRATIONDAMPER:"IfcVibrationDamper",IFCVEHICLE:"IfcVehicle",IFCTRANSPORTATIONDEVICE:"IfcTransportationDevice",IFCTRACKELEMENTTYPE:"IfcTrackElementType",IFCTENDONCONDUITTYPE:"IfcTendonConduitType",IFCTENDONCONDUIT:"IfcTendonConduit",IFCSINESPIRAL:"IfcSineSpiral",IFCSIGNALTYPE:"IfcSignalType",IFCSIGNTYPE:"IfcSignType",IFCSIGN:"IfcSign",IFCSEVENTHORDERPOLYNOMIALSPIRAL:"IfcSeventhOrderPolynomialSpiral",IFCSEGMENTEDREFERENCECURVE:"IfcSegmentedReferenceCurve",IFCSECONDORDERPOLYNOMIALSPIRAL:"IfcSecondOrderPolynomialSpiral",IFCROADPART:"IfcRoadPart",IFCROAD:"IfcRoad",IFCRELADHERESTOELEMENT:"IfcRelAdheresToElement",IFCREFERENT:"IfcReferent",IFCRAILWAYPART:"IfcRailwayPart",IFCRAILWAY:"IfcRailway",IFCRAILTYPE:"IfcRailType",IFCPOSITIONINGELEMENT:"IfcPositioningElement",IFCPAVEMENTTYPE:"IfcPavementType",IFCNAVIGATIONELEMENTTYPE:"IfcNavigationElementType",IFCMOORINGDEVICETYPE:"IfcMooringDeviceType",IFCMOBILETELECOMMUNICATIONSAPPLIANCETYPE:"IfcMobileTelecommunicationsApplianceType",IFCMARINEPART:"IfcMarinePart",IFCMARINEFACILITY:"IfcMarineFacility",IFCLIQUIDTERMINALTYPE:"IfcLiquidTerminalType",IFCLINEARELEMENT:"IfcLinearElement",IFCKERBTYPE:"IfcKerbType",IFCIMPACTPROTECTIONDEVICETYPE:"IfcImpactProtectionDeviceType",IFCIMPACTPROTECTIONDEVICE:"IfcImpactProtectionDevice",IFCGRADIENTCURVE:"IfcGradientCurve",IFCGEOTECHNICALSTRATUM:"IfcGeotechnicalStratum",IFCGEOTECHNICALELEMENT:"IfcGeotechnicalElement",IFCFACILITYPARTCOMMON:"IfcFacilityPartCommon",IFCFACILITYPART:"IfcFacilityPart",IFCFACILITY:"IfcFacility",IFCDIRECTRIXDERIVEDREFERENCESWEPTAREASOLID:"IfcDirectrixDerivedReferenceSweptAreaSolid",IFCDEEPFOUNDATIONTYPE:"IfcDeepFoundationType",IFCCOURSETYPE:"IfcCourseType",IFCCOSINESPIRAL:"IfcCosineSpiral",IFCCLOTHOID:"IfcClothoid",IFCBUILTELEMENTTYPE:"IfcBuiltElementType",IFCVEHICLETYPE:"IfcVehicleType",IFCTRIANGULATEDIRREGULARNETWORK:"IfcTriangulatedIrregularNetwork",IFCTRANSPORTATIONDEVICETYPE:"IfcTransportationDeviceType",IFCTHIRDORDERPOLYNOMIALSPIRAL:"IfcThirdOrderPolynomialSpiral",IFCSPIRAL:"IfcSpiral",IFCSECTIONEDSURFACE:"IfcSectionedSurface",IFCSECTIONEDSOLIDHORIZONTAL:"IfcSectionedSolidHorizontal",IFCSECTIONEDSOLID:"IfcSectionedSolid",IFCRELPOSITIONS:"IfcRelPositions",IFCRELASSOCIATESPROFILEDEF:"IfcRelAssociatesProfileDef",IFCPOLYNOMIALCURVE:"IfcPolynomialCurve",IFCOFFSETCURVEBYDISTANCES:"IfcOffsetCurveByDistances",IFCOFFSETCURVE:"IfcOffsetCurve",IFCINDEXEDPOLYGONALTEXTUREMAP:"IfcIndexedPolygonalTextureMap",IFCDIRECTRIXCURVESWEPTAREASOLID:"IfcDirectrixCurveSweptAreaSolid",IFCCURVESEGMENT:"IfcCurveSegment",IFCAXIS2PLACEMENTLINEAR:"IfcAxis2PlacementLinear",IFCSEGMENT:"IfcSegment",IFCPOINTBYDISTANCEEXPRESSION:"IfcPointByDistanceExpression",IFCOPENCROSSPROFILEDEF:"IfcOpenCrossProfileDef",IFCLINEARPLACEMENT:"IfcLinearPlacement",IFCALIGNMENTHORIZONTALSEGMENT:"IfcAlignmentHorizontalSegment",IFCALIGNMENTCANTSEGMENT:"IfcAlignmentCantSegment",IFCTEXTURECOORDINATEINDICESWITHVOIDS:"IfcTextureCoordinateIndicesWithVoids",IFCTEXTURECOORDINATEINDICES:"IfcTextureCoordinateIndices",IFCQUANTITYNUMBER:"IfcQuantityNumber",IFCALIGNMENTVERTICALSEGMENT:"IfcAlignmentVerticalSegment",IFCALIGNMENTPARAMETERSEGMENT:"IfcAlignmentParameterSegment",IFCCONTROLLER:"IfcController",IFCALARM:"IfcAlarm",IFCACTUATOR:"IfcActuator",IFCUNITARYCONTROLELEMENT:"IfcUnitaryControlElement",IFCSENSOR:"IfcSensor",IFCPROTECTIVEDEVICETRIPPINGUNIT:"IfcProtectiveDeviceTrippingUnit",IFCFLOWINSTRUMENT:"IfcFlowInstrument",IFCFIRESUPPRESSIONTERMINAL:"IfcFireSuppressionTerminal",IFCFILTER:"IfcFilter",IFCFAN:"IfcFan",IFCELECTRICTIMECONTROL:"IfcElectricTimeControl",IFCELECTRICMOTOR:"IfcElectricMotor",IFCELECTRICGENERATOR:"IfcElectricGenerator",IFCELECTRICFLOWSTORAGEDEVICE:"IfcElectricFlowStorageDevice",IFCELECTRICDISTRIBUTIONBOARD:"IfcElectricDistributionBoard",IFCELECTRICAPPLIANCE:"IfcElectricAppliance",IFCDUCTSILENCER:"IfcDuctSilencer",IFCDUCTSEGMENT:"IfcDuctSegment",IFCDUCTFITTING:"IfcDuctFitting",IFCDISTRIBUTIONCIRCUIT:"IfcDistributionCircuit",IFCDAMPER:"IfcDamper",IFCCOOLINGTOWER:"IfcCoolingTower",IFCCOOLEDBEAM:"IfcCooledBeam",IFCCONDENSER:"IfcCondenser",IFCCOMPRESSOR:"IfcCompressor",IFCCOMMUNICATIONSAPPLIANCE:"IfcCommunicationsAppliance",IFCCOIL:"IfcCoil",IFCCHILLER:"IfcChiller",IFCCABLESEGMENT:"IfcCableSegment",IFCCABLEFITTING:"IfcCableFitting",IFCCABLECARRIERSEGMENT:"IfcCableCarrierSegment",IFCCABLECARRIERFITTING:"IfcCableCarrierFitting",IFCBURNER:"IfcBurner",IFCBOILER:"IfcBoiler",IFCBEAMSTANDARDCASE:"IfcBeamStandardCase",IFCAUDIOVISUALAPPLIANCE:"IfcAudioVisualAppliance",IFCAIRTOAIRHEATRECOVERY:"IfcAirToAirHeatRecovery",IFCAIRTERMINALBOX:"IfcAirTerminalBox",IFCAIRTERMINAL:"IfcAirTerminal",IFCWINDOWSTANDARDCASE:"IfcWindowStandardCase",IFCWASTETERMINAL:"IfcWasteTerminal",IFCWALLELEMENTEDCASE:"IfcWallElementedCase",IFCVALVE:"IfcValve",IFCUNITARYEQUIPMENT:"IfcUnitaryEquipment",IFCUNITARYCONTROLELEMENTTYPE:"IfcUnitaryControlElementType",IFCTUBEBUNDLE:"IfcTubeBundle",IFCTRANSFORMER:"IfcTransformer",IFCTANK:"IfcTank",IFCSWITCHINGDEVICE:"IfcSwitchingDevice",IFCSTRUCTURALLOADCASE:"IfcStructuralLoadCase",IFCSTACKTERMINAL:"IfcStackTerminal",IFCSPACEHEATER:"IfcSpaceHeater",IFCSOLARDEVICE:"IfcSolarDevice",IFCSLABSTANDARDCASE:"IfcSlabStandardCase",IFCSLABELEMENTEDCASE:"IfcSlabElementedCase",IFCSHADINGDEVICE:"IfcShadingDevice",IFCSANITARYTERMINAL:"IfcSanitaryTerminal",IFCREINFORCINGBARTYPE:"IfcReinforcingBarType",IFCRATIONALBSPLINECURVEWITHKNOTS:"IfcRationalBSplineCurveWithKnots",IFCPUMP:"IfcPump",IFCPROTECTIVEDEVICETRIPPINGUNITTYPE:"IfcProtectiveDeviceTrippingUnitType",IFCPROTECTIVEDEVICE:"IfcProtectiveDevice",IFCPLATESTANDARDCASE:"IfcPlateStandardCase",IFCPIPESEGMENT:"IfcPipeSegment",IFCPIPEFITTING:"IfcPipeFitting",IFCOUTLET:"IfcOutlet",IFCOUTERBOUNDARYCURVE:"IfcOuterBoundaryCurve",IFCMOTORCONNECTION:"IfcMotorConnection",IFCMEMBERSTANDARDCASE:"IfcMemberStandardCase",IFCMEDICALDEVICE:"IfcMedicalDevice",IFCLIGHTFIXTURE:"IfcLightFixture",IFCLAMP:"IfcLamp",IFCJUNCTIONBOX:"IfcJunctionBox",IFCINTERCEPTOR:"IfcInterceptor",IFCHUMIDIFIER:"IfcHumidifier",IFCHEATEXCHANGER:"IfcHeatExchanger",IFCFLOWMETER:"IfcFlowMeter",IFCEXTERNALSPATIALELEMENT:"IfcExternalSpatialElement",IFCEVAPORATOR:"IfcEvaporator",IFCEVAPORATIVECOOLER:"IfcEvaporativeCooler",IFCENGINE:"IfcEngine",IFCELECTRICDISTRIBUTIONBOARDTYPE:"IfcElectricDistributionBoardType",IFCDOORSTANDARDCASE:"IfcDoorStandardCase",IFCDISTRIBUTIONSYSTEM:"IfcDistributionSystem",IFCCOMMUNICATIONSAPPLIANCETYPE:"IfcCommunicationsApplianceType",IFCCOLUMNSTANDARDCASE:"IfcColumnStandardCase",IFCCIVILELEMENT:"IfcCivilElement",IFCCHIMNEY:"IfcChimney",IFCCABLEFITTINGTYPE:"IfcCableFittingType",IFCBURNERTYPE:"IfcBurnerType",IFCBUILDINGSYSTEM:"IfcBuildingSystem",IFCBUILDINGELEMENTPARTTYPE:"IfcBuildingElementPartType",IFCBOUNDARYCURVE:"IfcBoundaryCurve",IFCBSPLINECURVEWITHKNOTS:"IfcBSplineCurveWithKnots",IFCAUDIOVISUALAPPLIANCETYPE:"IfcAudioVisualApplianceType",IFCWORKCALENDAR:"IfcWorkCalendar",IFCWINDOWTYPE:"IfcWindowType",IFCVOIDINGFEATURE:"IfcVoidingFeature",IFCVIBRATIONISOLATOR:"IfcVibrationIsolator",IFCTENDONTYPE:"IfcTendonType",IFCTENDONANCHORTYPE:"IfcTendonAnchorType",IFCSYSTEMFURNITUREELEMENT:"IfcSystemFurnitureElement",IFCSURFACEFEATURE:"IfcSurfaceFeature",IFCSTRUCTURALSURFACEACTION:"IfcStructuralSurfaceAction",IFCSTRUCTURALCURVEREACTION:"IfcStructuralCurveReaction",IFCSTRUCTURALCURVEACTION:"IfcStructuralCurveAction",IFCSTAIRTYPE:"IfcStairType",IFCSOLARDEVICETYPE:"IfcSolarDeviceType",IFCSHADINGDEVICETYPE:"IfcShadingDeviceType",IFCSEAMCURVE:"IfcSeamCurve",IFCROOFTYPE:"IfcRoofType",IFCREINFORCINGMESHTYPE:"IfcReinforcingMeshType",IFCREINFORCINGELEMENTTYPE:"IfcReinforcingElementType",IFCRATIONALBSPLINESURFACEWITHKNOTS:"IfcRationalBSplineSurfaceWithKnots",IFCRAMPTYPE:"IfcRampType",IFCPOLYGONALFACESET:"IfcPolygonalFaceSet",IFCPILETYPE:"IfcPileType",IFCOPENINGSTANDARDCASE:"IfcOpeningStandardCase",IFCMEDICALDEVICETYPE:"IfcMedicalDeviceType",IFCINTERSECTIONCURVE:"IfcIntersectionCurve",IFCINTERCEPTORTYPE:"IfcInterceptorType",IFCINDEXEDPOLYCURVE:"IfcIndexedPolyCurve",IFCGEOGRAPHICELEMENT:"IfcGeographicElement",IFCFURNITURE:"IfcFurniture",IFCFOOTINGTYPE:"IfcFootingType",IFCEXTERNALSPATIALSTRUCTUREELEMENT:"IfcExternalSpatialStructureElement",IFCEVENT:"IfcEvent",IFCENGINETYPE:"IfcEngineType",IFCELEMENTASSEMBLYTYPE:"IfcElementAssemblyType",IFCDOORTYPE:"IfcDoorType",IFCCYLINDRICALSURFACE:"IfcCylindricalSurface",IFCCONSTRUCTIONPRODUCTRESOURCETYPE:"IfcConstructionProductResourceType",IFCCONSTRUCTIONMATERIALRESOURCETYPE:"IfcConstructionMaterialResourceType",IFCCONSTRUCTIONEQUIPMENTRESOURCETYPE:"IfcConstructionEquipmentResourceType",IFCCOMPOSITECURVEONSURFACE:"IfcCompositeCurveOnSurface",IFCCOMPLEXPROPERTYTEMPLATE:"IfcComplexPropertyTemplate",IFCCIVILELEMENTTYPE:"IfcCivilElementType",IFCCHIMNEYTYPE:"IfcChimneyType",IFCBSPLINESURFACEWITHKNOTS:"IfcBSplineSurfaceWithKnots",IFCBSPLINESURFACE:"IfcBSplineSurface",IFCADVANCEDBREPWITHVOIDS:"IfcAdvancedBrepWithVoids",IFCADVANCEDBREP:"IfcAdvancedBrep",IFCTRIANGULATEDFACESET:"IfcTriangulatedFaceSet",IFCTOROIDALSURFACE:"IfcToroidalSurface",IFCTESSELLATEDFACESET:"IfcTessellatedFaceSet",IFCTASKTYPE:"IfcTaskType",IFCSURFACECURVE:"IfcSurfaceCurve",IFCSUBCONTRACTRESOURCETYPE:"IfcSubContractResourceType",IFCSTRUCTURALSURFACEREACTION:"IfcStructuralSurfaceReaction",IFCSPHERICALSURFACE:"IfcSphericalSurface",IFCSPATIALZONETYPE:"IfcSpatialZoneType",IFCSPATIALZONE:"IfcSpatialZone",IFCSPATIALELEMENTTYPE:"IfcSpatialElementType",IFCSPATIALELEMENT:"IfcSpatialElement",IFCSIMPLEPROPERTYTEMPLATE:"IfcSimplePropertyTemplate",IFCREVOLVEDAREASOLIDTAPERED:"IfcRevolvedAreaSolidTapered",IFCREPARAMETRISEDCOMPOSITECURVESEGMENT:"IfcReparametrisedCompositeCurveSegment",IFCRELSPACEBOUNDARY2NDLEVEL:"IfcRelSpaceBoundary2ndLevel",IFCRELSPACEBOUNDARY1STLEVEL:"IfcRelSpaceBoundary1stLevel",IFCRELINTERFERESELEMENTS:"IfcRelInterferesElements",IFCRELDEFINESBYTEMPLATE:"IfcRelDefinesByTemplate",IFCRELDEFINESBYOBJECT:"IfcRelDefinesByObject",IFCRELDECLARES:"IfcRelDeclares",IFCRELASSIGNSTOGROUPBYFACTOR:"IfcRelAssignsToGroupByFactor",IFCPROPERTYTEMPLATE:"IfcPropertyTemplate",IFCPROPERTYSETTEMPLATE:"IfcPropertySetTemplate",IFCPROJECTLIBRARY:"IfcProjectLibrary",IFCPROCEDURETYPE:"IfcProcedureType",IFCPREDEFINEDPROPERTYSET:"IfcPredefinedPropertySet",IFCPCURVE:"IfcPCurve",IFCLABORRESOURCETYPE:"IfcLaborResourceType",IFCINDEXEDPOLYGONALFACEWITHVOIDS:"IfcIndexedPolygonalFaceWithVoids",IFCINDEXEDPOLYGONALFACE:"IfcIndexedPolygonalFace",IFCGEOGRAPHICELEMENTTYPE:"IfcGeographicElementType",IFCFIXEDREFERENCESWEPTAREASOLID:"IfcFixedReferenceSweptAreaSolid",IFCEXTRUDEDAREASOLIDTAPERED:"IfcExtrudedAreaSolidTapered",IFCEVENTTYPE:"IfcEventType",IFCCURVEBOUNDEDSURFACE:"IfcCurveBoundedSurface",IFCCREWRESOURCETYPE:"IfcCrewResourceType",IFCCONTEXT:"IfcContext",IFCCONSTRUCTIONRESOURCETYPE:"IfcConstructionResourceType",IFCCARTESIANPOINTLIST3D:"IfcCartesianPointList3D",IFCCARTESIANPOINTLIST2D:"IfcCartesianPointList2D",IFCCARTESIANPOINTLIST:"IfcCartesianPointList",IFCADVANCEDFACE:"IfcAdvancedFace",IFCTYPERESOURCE:"IfcTypeResource",IFCTYPEPROCESS:"IfcTypeProcess",IFCTESSELLATEDITEM:"IfcTessellatedItem",IFCSWEPTDISKSOLIDPOLYGONAL:"IfcSweptDiskSolidPolygonal",IFCRESOURCETIME:"IfcResourceTime",IFCRESOURCECONSTRAINTRELATIONSHIP:"IfcResourceConstraintRelationship",IFCRESOURCEAPPROVALRELATIONSHIP:"IfcResourceApprovalRelationship",IFCQUANTITYSET:"IfcQuantitySet",IFCPROPERTYTEMPLATEDEFINITION:"IfcPropertyTemplateDefinition",IFCPREDEFINEDPROPERTIES:"IfcPredefinedProperties",IFCMIRROREDPROFILEDEF:"IfcMirroredProfileDef",IFCMATERIALRELATIONSHIP:"IfcMaterialRelationship",IFCMATERIALPROFILESETUSAGETAPERING:"IfcMaterialProfileSetUsageTapering",IFCMATERIALPROFILESETUSAGE:"IfcMaterialProfileSetUsage",IFCMATERIALCONSTITUENTSET:"IfcMaterialConstituentSet",IFCMATERIALCONSTITUENT:"IfcMaterialConstituent",IFCLAGTIME:"IfcLagTime",IFCINDEXEDTRIANGLETEXTUREMAP:"IfcIndexedTriangleTextureMap",IFCINDEXEDTEXTUREMAP:"IfcIndexedTextureMap",IFCINDEXEDCOLOURMAP:"IfcIndexedColourMap",IFCEXTERNALREFERENCERELATIONSHIP:"IfcExternalReferenceRelationship",IFCEXTENDEDPROPERTIES:"IfcExtendedProperties",IFCEVENTTIME:"IfcEventTime",IFCCONVERSIONBASEDUNITWITHOFFSET:"IfcConversionBasedUnitWithOffset",IFCCOLOURRGBLIST:"IfcColourRgbList",IFCWORKTIME:"IfcWorkTime",IFCTIMEPERIOD:"IfcTimePeriod",IFCTEXTUREVERTEXLIST:"IfcTextureVertexList",IFCTASKTIMERECURRING:"IfcTaskTimeRecurring",IFCTASKTIME:"IfcTaskTime",IFCTABLECOLUMN:"IfcTableColumn",IFCSURFACEREINFORCEMENTAREA:"IfcSurfaceReinforcementArea",IFCSTRUCTURALLOADORRESULT:"IfcStructuralLoadOrResult",IFCSTRUCTURALLOADCONFIGURATION:"IfcStructuralLoadConfiguration",IFCSCHEDULINGTIME:"IfcSchedulingTime",IFCRESOURCELEVELRELATIONSHIP:"IfcResourceLevelRelationship",IFCREFERENCE:"IfcReference",IFCRECURRENCEPATTERN:"IfcRecurrencePattern",IFCPROPERTYABSTRACTION:"IfcPropertyAbstraction",IFCPROJECTEDCRS:"IfcProjectedCrs",IFCPRESENTATIONITEM:"IfcPresentationItem",IFCMATERIALUSAGEDEFINITION:"IfcMaterialUsageDefinition",IFCMATERIALPROFILEWITHOFFSETS:"IfcMaterialProfileWithOffsets",IFCMATERIALPROFILESET:"IfcMaterialProfileSet",IFCMATERIALPROFILE:"IfcMaterialProfile",IFCMATERIALLAYERWITHOFFSETS:"IfcMaterialLayerWithOffsets",IFCMATERIALDEFINITION:"IfcMaterialDefinition",IFCMAPCONVERSION:"IfcMapConversion",IFCEXTERNALINFORMATION:"IfcExternalInformation",IFCCOORDINATEREFERENCESYSTEM:"IfcCoordinateReferenceSystem",IFCCOORDINATEOPERATION:"IfcCoordinateOperation",IFCCONNECTIONVOLUMEGEOMETRY:"IfcConnectionVolumeGeometry",IFCREINFORCINGBAR:"IfcReinforcingBar",IFCELECTRICDISTRIBUTIONPOINT:"IfcElectricDistributionPoint",IFCDISTRIBUTIONCONTROLELEMENT:"IfcDistributionControlElement",IFCDISTRIBUTIONCHAMBERELEMENT:"IfcDistributionChamberElement",IFCCONTROLLERTYPE:"IfcControllerType",IFCCHAMFEREDGEFEATURE:"IfcChamferEdgeFeature",IFCBEAM:"IfcBeam",IFCALARMTYPE:"IfcAlarmType",IFCACTUATORTYPE:"IfcActuatorType",IFCWINDOW:"IfcWindow",IFCWALLSTANDARDCASE:"IfcWallStandardCase",IFCWALL:"IfcWall",IFCVIBRATIONISOLATORTYPE:"IfcVibrationIsolatorType",IFCTENDONANCHOR:"IfcTendonAnchor",IFCTENDON:"IfcTendon",IFCSTRUCTURALANALYSISMODEL:"IfcStructuralAnalysisModel",IFCSTAIRFLIGHT:"IfcStairFlight",IFCSTAIR:"IfcStair",IFCSLAB:"IfcSlab",IFCSENSORTYPE:"IfcSensorType",IFCROUNDEDEDGEFEATURE:"IfcRoundedEdgeFeature",IFCROOF:"IfcRoof",IFCREINFORCINGMESH:"IfcReinforcingMesh",IFCREINFORCINGELEMENT:"IfcReinforcingElement",IFCRATIONALBEZIERCURVE:"IfcRationalBezierCurve",IFCRAMPFLIGHT:"IfcRampFlight",IFCRAMP:"IfcRamp",IFCRAILING:"IfcRailing",IFCPLATE:"IfcPlate",IFCPILE:"IfcPile",IFCMEMBER:"IfcMember",IFCFOOTING:"IfcFooting",IFCFLOWTREATMENTDEVICE:"IfcFlowTreatmentDevice",IFCFLOWTERMINAL:"IfcFlowTerminal",IFCFLOWSTORAGEDEVICE:"IfcFlowStorageDevice",IFCFLOWSEGMENT:"IfcFlowSegment",IFCFLOWMOVINGDEVICE:"IfcFlowMovingDevice",IFCFLOWINSTRUMENTTYPE:"IfcFlowInstrumentType",IFCFLOWFITTING:"IfcFlowFitting",IFCFLOWCONTROLLER:"IfcFlowController",IFCFIRESUPPRESSIONTERMINALTYPE:"IfcFireSuppressionTerminalType",IFCFILTERTYPE:"IfcFilterType",IFCFANTYPE:"IfcFanType",IFCENERGYCONVERSIONDEVICE:"IfcEnergyConversionDevice",IFCELECTRICALELEMENT:"IfcElectricalElement",IFCELECTRICALCIRCUIT:"IfcElectricalCircuit",IFCELECTRICTIMECONTROLTYPE:"IfcElectricTimeControlType",IFCELECTRICMOTORTYPE:"IfcElectricMotorType",IFCELECTRICHEATERTYPE:"IfcElectricHeaterType",IFCELECTRICGENERATORTYPE:"IfcElectricGeneratorType",IFCELECTRICFLOWSTORAGEDEVICETYPE:"IfcElectricFlowStorageDeviceType",IFCELECTRICAPPLIANCETYPE:"IfcElectricApplianceType",IFCEDGEFEATURE:"IfcEdgeFeature",IFCDUCTSILENCERTYPE:"IfcDuctSilencerType",IFCDUCTSEGMENTTYPE:"IfcDuctSegmentType",IFCDUCTFITTINGTYPE:"IfcDuctFittingType",IFCDOOR:"IfcDoor",IFCDISTRIBUTIONPORT:"IfcDistributionPort",IFCDISTRIBUTIONFLOWELEMENT:"IfcDistributionFlowElement",IFCDISTRIBUTIONELEMENT:"IfcDistributionElement",IFCDISTRIBUTIONCONTROLELEMENTTYPE:"IfcDistributionControlElementType",IFCDISTRIBUTIONCHAMBERELEMENTTYPE:"IfcDistributionChamberElementType",IFCDISCRETEACCESSORYTYPE:"IfcDiscreteAccessoryType",IFCDISCRETEACCESSORY:"IfcDiscreteAccessory",IFCDIAMETERDIMENSION:"IfcDiameterDimension",IFCDAMPERTYPE:"IfcDamperType",IFCCURTAINWALL:"IfcCurtainWall",IFCCOVERING:"IfcCovering",IFCCOOLINGTOWERTYPE:"IfcCoolingTowerType",IFCCOOLEDBEAMTYPE:"IfcCooledBeamType",IFCCONSTRUCTIONPRODUCTRESOURCE:"IfcConstructionProductResource",IFCCONSTRUCTIONMATERIALRESOURCE:"IfcConstructionMaterialResource",IFCCONSTRUCTIONEQUIPMENTRESOURCE:"IfcConstructionEquipmentResource",IFCCONDITIONCRITERION:"IfcConditionCriterion",IFCCONDITION:"IfcCondition",IFCCONDENSERTYPE:"IfcCondenserType",IFCCOMPRESSORTYPE:"IfcCompressorType",IFCCOLUMN:"IfcColumn",IFCCOILTYPE:"IfcCoilType",IFCCIRCLE:"IfcCircle",IFCCHILLERTYPE:"IfcChillerType",IFCCABLESEGMENTTYPE:"IfcCableSegmentType",IFCCABLECARRIERSEGMENTTYPE:"IfcCableCarrierSegmentType",IFCCABLECARRIERFITTINGTYPE:"IfcCableCarrierFittingType",IFCBUILDINGELEMENTPROXYTYPE:"IfcBuildingElementProxyType",IFCBUILDINGELEMENTPROXY:"IfcBuildingElementProxy",IFCBUILDINGELEMENTPART:"IfcBuildingElementPart",IFCBUILDINGELEMENTCOMPONENT:"IfcBuildingElementComponent",IFCBUILDINGELEMENT:"IfcBuildingElement",IFCBOILERTYPE:"IfcBoilerType",IFCBEZIERCURVE:"IfcBezierCurve",IFCBEAMTYPE:"IfcBeamType",IFCBSPLINECURVE:"IfcBSplineCurve",IFCASSET:"IfcAsset",IFCANGULARDIMENSION:"IfcAngularDimension",IFCAIRTOAIRHEATRECOVERYTYPE:"IfcAirToAirHeatRecoveryType",IFCAIRTERMINALTYPE:"IfcAirTerminalType",IFCAIRTERMINALBOXTYPE:"IfcAirTerminalBoxType",IFCACTIONREQUEST:"IfcActionRequest",IFC2DCOMPOSITECURVE:"Ifc2DCompositeCurve",IFCZONE:"IfcZone",IFCWORKSCHEDULE:"IfcWorkSchedule",IFCWORKPLAN:"IfcWorkPlan",IFCWORKCONTROL:"IfcWorkControl",IFCWASTETERMINALTYPE:"IfcWasteTerminalType",IFCWALLTYPE:"IfcWallType",IFCVIRTUALELEMENT:"IfcVirtualElement",IFCVALVETYPE:"IfcValveType",IFCUNITARYEQUIPMENTTYPE:"IfcUnitaryEquipmentType",IFCTUBEBUNDLETYPE:"IfcTubeBundleType",IFCTRIMMEDCURVE:"IfcTrimmedCurve",IFCTRANSPORTELEMENT:"IfcTransportElement",IFCTRANSFORMERTYPE:"IfcTransformerType",IFCTIMESERIESSCHEDULE:"IfcTimeSeriesSchedule",IFCTANKTYPE:"IfcTankType",IFCSYSTEM:"IfcSystem",IFCSWITCHINGDEVICETYPE:"IfcSwitchingDeviceType",IFCSUBCONTRACTRESOURCE:"IfcSubContractResource",IFCSTRUCTURALSURFACECONNECTION:"IfcStructuralSurfaceConnection",IFCSTRUCTURALRESULTGROUP:"IfcStructuralResultGroup",IFCSTRUCTURALPOINTREACTION:"IfcStructuralPointReaction",IFCSTRUCTURALPOINTCONNECTION:"IfcStructuralPointConnection",IFCSTRUCTURALPOINTACTION:"IfcStructuralPointAction",IFCSTRUCTURALPLANARACTIONVARYING:"IfcStructuralPlanarActionVarying",IFCSTRUCTURALPLANARACTION:"IfcStructuralPlanarAction",IFCSTRUCTURALLOADGROUP:"IfcStructuralLoadGroup",IFCSTRUCTURALLINEARACTIONVARYING:"IfcStructuralLinearActionVarying",IFCSTRUCTURALLINEARACTION:"IfcStructuralLinearAction",IFCSTRUCTURALCURVEMEMBERVARYING:"IfcStructuralCurveMemberVarying",IFCSTRUCTURALCURVEMEMBER:"IfcStructuralCurveMember",IFCSTRUCTURALCURVECONNECTION:"IfcStructuralCurveConnection",IFCSTRUCTURALCONNECTION:"IfcStructuralConnection",IFCSTRUCTURALACTION:"IfcStructuralAction",IFCSTAIRFLIGHTTYPE:"IfcStairFlightType",IFCSTACKTERMINALTYPE:"IfcStackTerminalType",IFCSPACETYPE:"IfcSpaceType",IFCSPACEPROGRAM:"IfcSpaceProgram",IFCSPACEHEATERTYPE:"IfcSpaceHeaterType",IFCSPACE:"IfcSpace",IFCSLABTYPE:"IfcSlabType",IFCSITE:"IfcSite",IFCSERVICELIFE:"IfcServiceLife",IFCSCHEDULETIMECONTROL:"IfcScheduleTimeControl",IFCSANITARYTERMINALTYPE:"IfcSanitaryTerminalType",IFCRELASSIGNSTASKS:"IfcRelAssignsTasks",IFCRELAGGREGATES:"IfcRelAggregates",IFCRAMPFLIGHTTYPE:"IfcRampFlightType",IFCRAILINGTYPE:"IfcRailingType",IFCRADIUSDIMENSION:"IfcRadiusDimension",IFCPUMPTYPE:"IfcPumpType",IFCPROTECTIVEDEVICETYPE:"IfcProtectiveDeviceType",IFCPROJECTIONELEMENT:"IfcProjectionElement",IFCPROJECTORDERRECORD:"IfcProjectOrderRecord",IFCPROJECTORDER:"IfcProjectOrder",IFCPROCEDURE:"IfcProcedure",IFCPORT:"IfcPort",IFCPOLYLINE:"IfcPolyline",IFCPLATETYPE:"IfcPlateType",IFCPIPESEGMENTTYPE:"IfcPipeSegmentType",IFCPIPEFITTINGTYPE:"IfcPipeFittingType",IFCPERMIT:"IfcPermit",IFCPERFORMANCEHISTORY:"IfcPerformanceHistory",IFCOUTLETTYPE:"IfcOutletType",IFCORDERACTION:"IfcOrderAction",IFCOPENINGELEMENT:"IfcOpeningElement",IFCOCCUPANT:"IfcOccupant",IFCMOVE:"IfcMove",IFCMOTORCONNECTIONTYPE:"IfcMotorConnectionType",IFCMEMBERTYPE:"IfcMemberType",IFCMECHANICALFASTENERTYPE:"IfcMechanicalFastenerType",IFCMECHANICALFASTENER:"IfcMechanicalFastener",IFCLINEARDIMENSION:"IfcLinearDimension",IFCLIGHTFIXTURETYPE:"IfcLightFixtureType",IFCLAMPTYPE:"IfcLampType",IFCLABORRESOURCE:"IfcLaborResource",IFCJUNCTIONBOXTYPE:"IfcJunctionBoxType",IFCINVENTORY:"IfcInventory",IFCHUMIDIFIERTYPE:"IfcHumidifierType",IFCHEATEXCHANGERTYPE:"IfcHeatExchangerType",IFCGROUP:"IfcGroup",IFCGRID:"IfcGrid",IFCGASTERMINALTYPE:"IfcGasTerminalType",IFCFURNITURESTANDARD:"IfcFurnitureStandard",IFCFURNISHINGELEMENT:"IfcFurnishingElement",IFCFLOWTREATMENTDEVICETYPE:"IfcFlowTreatmentDeviceType",IFCFLOWTERMINALTYPE:"IfcFlowTerminalType",IFCFLOWSTORAGEDEVICETYPE:"IfcFlowStorageDeviceType",IFCFLOWSEGMENTTYPE:"IfcFlowSegmentType",IFCFLOWMOVINGDEVICETYPE:"IfcFlowMovingDeviceType",IFCFLOWMETERTYPE:"IfcFlowMeterType",IFCFLOWFITTINGTYPE:"IfcFlowFittingType",IFCFLOWCONTROLLERTYPE:"IfcFlowControllerType",IFCFEATUREELEMENTSUBTRACTION:"IfcFeatureElementSubtraction",IFCFEATUREELEMENTADDITION:"IfcFeatureElementAddition",IFCFEATUREELEMENT:"IfcFeatureElement",IFCFASTENERTYPE:"IfcFastenerType",IFCFASTENER:"IfcFastener",IFCFACETEDBREPWITHVOIDS:"IfcFacetedBrepWithVoids",IFCFACETEDBREP:"IfcFacetedBrep",IFCEVAPORATORTYPE:"IfcEvaporatorType",IFCEVAPORATIVECOOLERTYPE:"IfcEvaporativeCoolerType",IFCEQUIPMENTSTANDARD:"IfcEquipmentStandard",IFCEQUIPMENTELEMENT:"IfcEquipmentElement",IFCENERGYCONVERSIONDEVICETYPE:"IfcEnergyConversionDeviceType",IFCELLIPSE:"IfcEllipse",IFCELEMENTCOMPONENTTYPE:"IfcElementComponentType",IFCELEMENTCOMPONENT:"IfcElementComponent",IFCELEMENTASSEMBLY:"IfcElementAssembly",IFCELEMENT:"IfcElement",IFCELECTRICALBASEPROPERTIES:"IfcElectricalBaseProperties",IFCDISTRIBUTIONFLOWELEMENTTYPE:"IfcDistributionFlowElementType",IFCDISTRIBUTIONELEMENTTYPE:"IfcDistributionElementType",IFCDIMENSIONCURVEDIRECTEDCALLOUT:"IfcDimensionCurveDirectedCallout",IFCCURTAINWALLTYPE:"IfcCurtainWallType",IFCCREWRESOURCE:"IfcCrewResource",IFCCOVERINGTYPE:"IfcCoveringType",IFCCOSTSCHEDULE:"IfcCostSchedule",IFCCOSTITEM:"IfcCostItem",IFCCONTROL:"IfcControl",IFCCONSTRUCTIONRESOURCE:"IfcConstructionResource",IFCCONIC:"IfcConic",IFCCOMPOSITECURVE:"IfcCompositeCurve",IFCCOLUMNTYPE:"IfcColumnType",IFCCIRCLEHOLLOWPROFILEDEF:"IfcCircleHollowProfileDef",IFCBUILDINGSTOREY:"IfcBuildingStorey",IFCBUILDINGELEMENTTYPE:"IfcBuildingElementType",IFCBUILDING:"IfcBuilding",IFCBOUNDEDCURVE:"IfcBoundedCurve",IFCBOOLEANCLIPPINGRESULT:"IfcBooleanClippingResult",IFCBLOCK:"IfcBlock",IFCASYMMETRICISHAPEPROFILEDEF:"IfcAsymmetricIShapeProfileDef",IFCANNOTATION:"IfcAnnotation",IFCACTOR:"IfcActor",IFCTRANSPORTELEMENTTYPE:"IfcTransportElementType",IFCTASK:"IfcTask",IFCSYSTEMFURNITUREELEMENTTYPE:"IfcSystemFurnitureElementType",IFCSURFACEOFREVOLUTION:"IfcSurfaceOfRevolution",IFCSURFACEOFLINEAREXTRUSION:"IfcSurfaceOfLinearExtrusion",IFCSURFACECURVESWEPTAREASOLID:"IfcSurfaceCurveSweptAreaSolid",IFCSTRUCTUREDDIMENSIONCALLOUT:"IfcStructuredDimensionCallout",IFCSTRUCTURALSURFACEMEMBERVARYING:"IfcStructuralSurfaceMemberVarying",IFCSTRUCTURALSURFACEMEMBER:"IfcStructuralSurfaceMember",IFCSTRUCTURALREACTION:"IfcStructuralReaction",IFCSTRUCTURALMEMBER:"IfcStructuralMember",IFCSTRUCTURALITEM:"IfcStructuralItem",IFCSTRUCTURALACTIVITY:"IfcStructuralActivity",IFCSPHERE:"IfcSphere",IFCSPATIALSTRUCTUREELEMENTTYPE:"IfcSpatialStructureElementType",IFCSPATIALSTRUCTUREELEMENT:"IfcSpatialStructureElement",IFCRIGHTCIRCULARCYLINDER:"IfcRightCircularCylinder",IFCRIGHTCIRCULARCONE:"IfcRightCircularCone",IFCREVOLVEDAREASOLID:"IfcRevolvedAreaSolid",IFCRESOURCE:"IfcResource",IFCRELVOIDSELEMENT:"IfcRelVoidsElement",IFCRELSPACEBOUNDARY:"IfcRelSpaceBoundary",IFCRELSERVICESBUILDINGS:"IfcRelServicesBuildings",IFCRELSEQUENCE:"IfcRelSequence",IFCRELSCHEDULESCOSTITEMS:"IfcRelSchedulesCostItems",IFCRELREFERENCEDINSPATIALSTRUCTURE:"IfcRelReferencedInSpatialStructure",IFCRELPROJECTSELEMENT:"IfcRelProjectsElement",IFCRELOVERRIDESPROPERTIES:"IfcRelOverridesProperties",IFCRELOCCUPIESSPACES:"IfcRelOccupiesSpaces",IFCRELNESTS:"IfcRelNests",IFCRELINTERACTIONREQUIREMENTS:"IfcRelInteractionRequirements",IFCRELFLOWCONTROLELEMENTS:"IfcRelFlowControlElements",IFCRELFILLSELEMENT:"IfcRelFillsElement",IFCRELDEFINESBYTYPE:"IfcRelDefinesByType",IFCRELDEFINESBYPROPERTIES:"IfcRelDefinesByProperties",IFCRELDEFINES:"IfcRelDefines",IFCRELDECOMPOSES:"IfcRelDecomposes",IFCRELCOVERSSPACES:"IfcRelCoversSpaces",IFCRELCOVERSBLDGELEMENTS:"IfcRelCoversBldgElements",IFCRELCONTAINEDINSPATIALSTRUCTURE:"IfcRelContainedInSpatialStructure",IFCRELCONNECTSWITHREALIZINGELEMENTS:"IfcRelConnectsWithRealizingElements",IFCRELCONNECTSWITHECCENTRICITY:"IfcRelConnectsWithEccentricity",IFCRELCONNECTSSTRUCTURALMEMBER:"IfcRelConnectsStructuralMember",IFCRELCONNECTSSTRUCTURALELEMENT:"IfcRelConnectsStructuralElement",IFCRELCONNECTSSTRUCTURALACTIVITY:"IfcRelConnectsStructuralActivity",IFCRELCONNECTSPORTS:"IfcRelConnectsPorts",IFCRELCONNECTSPORTTOELEMENT:"IfcRelConnectsPortToElement",IFCRELCONNECTSPATHELEMENTS:"IfcRelConnectsPathElements",IFCRELCONNECTSELEMENTS:"IfcRelConnectsElements",IFCRELCONNECTS:"IfcRelConnects",IFCRELASSOCIATESPROFILEPROPERTIES:"IfcRelAssociatesProfileProperties",IFCRELASSOCIATESMATERIAL:"IfcRelAssociatesMaterial",IFCRELASSOCIATESLIBRARY:"IfcRelAssociatesLibrary",IFCRELASSOCIATESDOCUMENT:"IfcRelAssociatesDocument",IFCRELASSOCIATESCONSTRAINT:"IfcRelAssociatesConstraint",IFCRELASSOCIATESCLASSIFICATION:"IfcRelAssociatesClassification",IFCRELASSOCIATESAPPROVAL:"IfcRelAssociatesApproval",IFCRELASSOCIATESAPPLIEDVALUE:"IfcRelAssociatesAppliedValue",IFCRELASSOCIATES:"IfcRelAssociates",IFCRELASSIGNSTORESOURCE:"IfcRelAssignsToResource",IFCRELASSIGNSTOPROJECTORDER:"IfcRelAssignsToProjectOrder",IFCRELASSIGNSTOPRODUCT:"IfcRelAssignsToProduct",IFCRELASSIGNSTOPROCESS:"IfcRelAssignsToProcess",IFCRELASSIGNSTOGROUP:"IfcRelAssignsToGroup",IFCRELASSIGNSTOCONTROL:"IfcRelAssignsToControl",IFCRELASSIGNSTOACTOR:"IfcRelAssignsToActor",IFCRELASSIGNS:"IfcRelAssigns",IFCRECTANGULARTRIMMEDSURFACE:"IfcRectangularTrimmedSurface",IFCRECTANGULARPYRAMID:"IfcRectangularPyramid",IFCRECTANGLEHOLLOWPROFILEDEF:"IfcRectangleHollowProfileDef",IFCPROXY:"IfcProxy",IFCPROPERTYSET:"IfcPropertySet",IFCPROJECTIONCURVE:"IfcProjectionCurve",IFCPROJECT:"IfcProject",IFCPRODUCT:"IfcProduct",IFCPROCESS:"IfcProcess",IFCPLANE:"IfcPlane",IFCPLANARBOX:"IfcPlanarBox",IFCPERMEABLECOVERINGPROPERTIES:"IfcPermeableCoveringProperties",IFCOFFSETCURVE3D:"IfcOffsetCurve3D",IFCOFFSETCURVE2D:"IfcOffsetCurve2D",IFCOBJECT:"IfcObject",IFCMANIFOLDSOLIDBREP:"IfcManifoldSolidBrep",IFCLINE:"IfcLine",IFCLSHAPEPROFILEDEF:"IfcLShapeProfileDef",IFCISHAPEPROFILEDEF:"IfcIShapeProfileDef",IFCGEOMETRICCURVESET:"IfcGeometricCurveSet",IFCFURNITURETYPE:"IfcFurnitureType",IFCFURNISHINGELEMENTTYPE:"IfcFurnishingElementType",IFCFLUIDFLOWPROPERTIES:"IfcFluidFlowProperties",IFCFILLAREASTYLETILES:"IfcFillAreaStyleTiles",IFCFILLAREASTYLETILESYMBOLWITHSTYLE:"IfcFillAreaStyleTileSymbolWithStyle",IFCFILLAREASTYLEHATCHING:"IfcFillAreaStyleHatching",IFCFACEBASEDSURFACEMODEL:"IfcFaceBasedSurfaceModel",IFCEXTRUDEDAREASOLID:"IfcExtrudedAreaSolid",IFCENERGYPROPERTIES:"IfcEnergyProperties",IFCELLIPSEPROFILEDEF:"IfcEllipseProfileDef",IFCELEMENTARYSURFACE:"IfcElementarySurface",IFCELEMENTTYPE:"IfcElementType",IFCELEMENTQUANTITY:"IfcElementQuantity",IFCEDGELOOP:"IfcEdgeLoop",IFCDRAUGHTINGPREDEFINEDCURVEFONT:"IfcDraughtingPredefinedCurveFont",IFCDRAUGHTINGPREDEFINEDCOLOUR:"IfcDraughtingPredefinedColour",IFCDRAUGHTINGCALLOUT:"IfcDraughtingCallout",IFCDOORSTYLE:"IfcDoorStyle",IFCDOORPANELPROPERTIES:"IfcDoorPanelProperties",IFCDOORLININGPROPERTIES:"IfcDoorLiningProperties",IFCDIRECTION:"IfcDirection",IFCDIMENSIONCURVETERMINATOR:"IfcDimensionCurveTerminator",IFCDIMENSIONCURVE:"IfcDimensionCurve",IFCDEFINEDSYMBOL:"IfcDefinedSymbol",IFCCURVEBOUNDEDPLANE:"IfcCurveBoundedPlane",IFCCURVE:"IfcCurve",IFCCSGSOLID:"IfcCsgSolid",IFCCSGPRIMITIVE3D:"IfcCsgPrimitive3D",IFCCRANERAILFSHAPEPROFILEDEF:"IfcCraneRailFShapeProfileDef",IFCCRANERAILASHAPEPROFILEDEF:"IfcCraneRailAShapeProfileDef",IFCCOMPOSITECURVESEGMENT:"IfcCompositeCurveSegment",IFCCLOSEDSHELL:"IfcClosedShell",IFCCIRCLEPROFILEDEF:"IfcCircleProfileDef",IFCCARTESIANTRANSFORMATIONOPERATOR3DNONUNIFORM:"IfcCartesianTransformationOperator3DNonUniform",IFCCARTESIANTRANSFORMATIONOPERATOR3D:"IfcCartesianTransformationOperator3D",IFCCARTESIANTRANSFORMATIONOPERATOR2DNONUNIFORM:"IfcCartesianTransformationOperator2DNonUniform",IFCCARTESIANTRANSFORMATIONOPERATOR2D:"IfcCartesianTransformationOperator2D",IFCCARTESIANTRANSFORMATIONOPERATOR:"IfcCartesianTransformationOperator",IFCCARTESIANPOINT:"IfcCartesianPoint",IFCCSHAPEPROFILEDEF:"IfcCShapeProfileDef",IFCBOXEDHALFSPACE:"IfcBoxedHalfSpace",IFCBOUNDINGBOX:"IfcBoundingBox",IFCBOUNDEDSURFACE:"IfcBoundedSurface",IFCBOOLEANRESULT:"IfcBooleanResult",IFCAXIS2PLACEMENT3D:"IfcAxis2Placement3D",IFCAXIS2PLACEMENT2D:"IfcAxis2Placement2D",IFCAXIS1PLACEMENT:"IfcAxis1Placement",IFCANNOTATIONSURFACE:"IfcAnnotationSurface",IFCANNOTATIONFILLAREAOCCURRENCE:"IfcAnnotationFillAreaOccurrence",IFCANNOTATIONFILLAREA:"IfcAnnotationFillArea",IFCANNOTATIONCURVEOCCURRENCE:"IfcAnnotationCurveOccurrence",IFCZSHAPEPROFILEDEF:"IfcZShapeProfileDef",IFCWINDOWSTYLE:"IfcWindowStyle",IFCWINDOWPANELPROPERTIES:"IfcWindowPanelProperties",IFCWINDOWLININGPROPERTIES:"IfcWindowLiningProperties",IFCVERTEXLOOP:"IfcVertexLoop",IFCVECTOR:"IfcVector",IFCUSHAPEPROFILEDEF:"IfcUShapeProfileDef",IFCTYPEPRODUCT:"IfcTypeProduct",IFCTYPEOBJECT:"IfcTypeObject",IFCTWODIRECTIONREPEATFACTOR:"IfcTwoDirectionRepeatFactor",IFCTRAPEZIUMPROFILEDEF:"IfcTrapeziumProfileDef",IFCTEXTLITERALWITHEXTENT:"IfcTextLiteralWithExtent",IFCTEXTLITERAL:"IfcTextLiteral",IFCTERMINATORSYMBOL:"IfcTerminatorSymbol",IFCTSHAPEPROFILEDEF:"IfcTShapeProfileDef",IFCSWEPTSURFACE:"IfcSweptSurface",IFCSWEPTDISKSOLID:"IfcSweptDiskSolid",IFCSWEPTAREASOLID:"IfcSweptAreaSolid",IFCSURFACESTYLERENDERING:"IfcSurfaceStyleRendering",IFCSURFACE:"IfcSurface",IFCSUBEDGE:"IfcSubedge",IFCSTRUCTURALSTEELPROFILEPROPERTIES:"IfcStructuralSteelProfileProperties",IFCSTRUCTURALPROFILEPROPERTIES:"IfcStructuralProfileProperties",IFCSTRUCTURALLOADSINGLEFORCEWARPING:"IfcStructuralLoadSingleForceWarping",IFCSTRUCTURALLOADSINGLEFORCE:"IfcStructuralLoadSingleForce",IFCSTRUCTURALLOADSINGLEDISPLACEMENTDISTORTION:"IfcStructuralLoadSingleDisplacementDistortion",IFCSTRUCTURALLOADSINGLEDISPLACEMENT:"IfcStructuralLoadSingleDisplacement",IFCSTRUCTURALLOADPLANARFORCE:"IfcStructuralLoadPlanarForce",IFCSTRUCTURALLOADLINEARFORCE:"IfcStructuralLoadLinearForce",IFCSPACETHERMALLOADPROPERTIES:"IfcSpaceThermalLoadProperties",IFCSOUNDVALUE:"IfcSoundValue",IFCSOUNDPROPERTIES:"IfcSoundProperties",IFCSOLIDMODEL:"IfcSolidModel",IFCSLIPPAGECONNECTIONCONDITION:"IfcSlippageConnectionCondition",IFCSHELLBASEDSURFACEMODEL:"IfcShellBasedSurfaceModel",IFCSERVICELIFEFACTOR:"IfcServiceLifeFactor",IFCSECTIONEDSPINE:"IfcSectionedSpine",IFCROUNDEDRECTANGLEPROFILEDEF:"IfcRoundedRectangleProfileDef",IFCRELATIONSHIP:"IfcRelationship",IFCREINFORCEMENTDEFINITIONPROPERTIES:"IfcReinforcementDefinitionProperties",IFCREGULARTIMESERIES:"IfcRegularTimeSeries",IFCRECTANGLEPROFILEDEF:"IfcRectangleProfileDef",IFCPROPERTYTABLEVALUE:"IfcPropertyTableValue",IFCPROPERTYSINGLEVALUE:"IfcPropertySingleValue",IFCPROPERTYSETDEFINITION:"IfcPropertySetDefinition",IFCPROPERTYREFERENCEVALUE:"IfcPropertyReferenceValue",IFCPROPERTYLISTVALUE:"IfcPropertyListValue",IFCPROPERTYENUMERATEDVALUE:"IfcPropertyEnumeratedValue",IFCPROPERTYDEFINITION:"IfcPropertyDefinition",IFCPROPERTYBOUNDEDVALUE:"IfcPropertyBoundedValue",IFCPRODUCTDEFINITIONSHAPE:"IfcProductDefinitionShape",IFCPREDEFINEDPOINTMARKERSYMBOL:"IfcPredefinedPointMarkerSymbol",IFCPREDEFINEDDIMENSIONSYMBOL:"IfcPredefinedDimensionSymbol",IFCPREDEFINEDCURVEFONT:"IfcPredefinedCurveFont",IFCPREDEFINEDCOLOUR:"IfcPredefinedColour",IFCPOLYGONALBOUNDEDHALFSPACE:"IfcPolygonalBoundedHalfSpace",IFCPOLYLOOP:"IfcPolyLoop",IFCPOINTONSURFACE:"IfcPointOnSurface",IFCPOINTONCURVE:"IfcPointOnCurve",IFCPOINT:"IfcPoint",IFCPLANAREXTENT:"IfcPlanarExtent",IFCPLACEMENT:"IfcPlacement",IFCPIXELTEXTURE:"IfcPixelTexture",IFCPHYSICALCOMPLEXQUANTITY:"IfcPhysicalComplexQuantity",IFCPATH:"IfcPath",IFCPARAMETERIZEDPROFILEDEF:"IfcParameterizedProfileDef",IFCORIENTEDEDGE:"IfcOrientedEdge",IFCOPENSHELL:"IfcOpenShell",IFCONEDIRECTIONREPEATFACTOR:"IfcOneDirectionRepeatFactor",IFCOBJECTDEFINITION:"IfcObjectDefinition",IFCMECHANICALCONCRETEMATERIALPROPERTIES:"IfcMechanicalConcreteMaterialProperties",IFCMATERIALDEFINITIONREPRESENTATION:"IfcMaterialDefinitionRepresentation",IFCMAPPEDITEM:"IfcMappedItem",IFCLOOP:"IfcLoop",IFCLOCALPLACEMENT:"IfcLocalPlacement",IFCLIGHTSOURCESPOT:"IfcLightSourceSpot",IFCLIGHTSOURCEPOSITIONAL:"IfcLightSourcePositional",IFCLIGHTSOURCEGONIOMETRIC:"IfcLightSourceGoniometric",IFCLIGHTSOURCEDIRECTIONAL:"IfcLightSourceDirectional",IFCLIGHTSOURCEAMBIENT:"IfcLightSourceAmbient",IFCLIGHTSOURCE:"IfcLightSource",IFCIRREGULARTIMESERIES:"IfcIrregularTimeSeries",IFCIMAGETEXTURE:"IfcImageTexture",IFCHYGROSCOPICMATERIALPROPERTIES:"IfcHygroscopicMaterialProperties",IFCHALFSPACESOLID:"IfcHalfSpaceSolid",IFCGRIDPLACEMENT:"IfcGridPlacement",IFCGEOMETRICSET:"IfcGeometricSet",IFCGEOMETRICREPRESENTATIONSUBCONTEXT:"IfcGeometricRepresentationSubContext",IFCGEOMETRICREPRESENTATIONITEM:"IfcGeometricRepresentationItem",IFCGEOMETRICREPRESENTATIONCONTEXT:"IfcGeometricRepresentationContext",IFCGENERALPROFILEPROPERTIES:"IfcGeneralProfileProperties",IFCGENERALMATERIALPROPERTIES:"IfcGeneralMaterialProperties",IFCFUELPROPERTIES:"IfcFuelProperties",IFCFILLAREASTYLE:"IfcFillAreaStyle",IFCFAILURECONNECTIONCONDITION:"IfcFailureConnectionCondition",IFCFACESURFACE:"IfcFaceSurface",IFCFACEOUTERBOUND:"IfcFaceOuterBound",IFCFACEBOUND:"IfcFaceBound",IFCFACE:"IfcFace",IFCEXTENDEDMATERIALPROPERTIES:"IfcExtendedMaterialProperties",IFCEDGECURVE:"IfcEdgeCurve",IFCEDGE:"IfcEdge",IFCDRAUGHTINGPREDEFINEDTEXTFONT:"IfcDraughtingPredefinedTextFont",IFCDOCUMENTREFERENCE:"IfcDocumentReference",IFCDIMENSIONPAIR:"IfcDimensionPair",IFCDIMENSIONCALLOUTRELATIONSHIP:"IfcDimensionCalloutRelationship",IFCDERIVEDPROFILEDEF:"IfcDerivedProfileDef",IFCCURVESTYLE:"IfcCurveStyle",IFCCONVERSIONBASEDUNIT:"IfcConversionBasedUnit",IFCCONTEXTDEPENDENTUNIT:"IfcContextDependentUnit",IFCCONNECTIONPOINTECCENTRICITY:"IfcConnectionPointEccentricity",IFCCONNECTIONCURVEGEOMETRY:"IfcConnectionCurveGeometry",IFCCONNECTEDFACESET:"IfcConnectedFaceSet",IFCCOMPOSITEPROFILEDEF:"IfcCompositeProfileDef",IFCCOMPLEXPROPERTY:"IfcComplexProperty",IFCCOLOURRGB:"IfcColourRgb",IFCCLASSIFICATIONREFERENCE:"IfcClassificationReference",IFCCENTERLINEPROFILEDEF:"IfcCenterLineProfileDef",IFCBLOBTEXTURE:"IfcBlobTexture",IFCARBITRARYPROFILEDEFWITHVOIDS:"IfcArbitraryProfileDefWithVoids",IFCARBITRARYOPENPROFILEDEF:"IfcArbitraryOpenProfileDef",IFCARBITRARYCLOSEDPROFILEDEF:"IfcArbitraryClosedProfileDef",IFCANNOTATIONTEXTOCCURRENCE:"IfcAnnotationTextOccurrence",IFCANNOTATIONSYMBOLOCCURRENCE:"IfcAnnotationSymbolOccurrence",IFCANNOTATIONSURFACEOCCURRENCE:"IfcAnnotationSurfaceOccurrence",IFCANNOTATIONOCCURRENCE:"IfcAnnotationOccurrence",IFCWATERPROPERTIES:"IfcWaterProperties",IFCVIRTUALGRIDINTERSECTION:"IfcVirtualGridIntersection",IFCVERTEXPOINT:"IfcVertexPoint",IFCVERTEXBASEDTEXTUREMAP:"IfcVertexBasedTextureMap",IFCVERTEX:"IfcVertex",IFCUNITASSIGNMENT:"IfcUnitAssignment",IFCTOPOLOGYREPRESENTATION:"IfcTopologyRepresentation",IFCTOPOLOGICALREPRESENTATIONITEM:"IfcTopologicalRepresentationItem",IFCTIMESERIESVALUE:"IfcTimeSeriesValue",IFCTIMESERIESREFERENCERELATIONSHIP:"IfcTimeSeriesReferenceRelationship",IFCTIMESERIES:"IfcTimeSeries",IFCTHERMALMATERIALPROPERTIES:"IfcThermalMaterialProperties",IFCTEXTUREVERTEX:"IfcTextureVertex",IFCTEXTUREMAP:"IfcTextureMap",IFCTEXTURECOORDINATEGENERATOR:"IfcTextureCoordinateGenerator",IFCTEXTURECOORDINATE:"IfcTextureCoordinate",IFCTEXTSTYLEWITHBOXCHARACTERISTICS:"IfcTextStyleWithBoxCharacteristics",IFCTEXTSTYLETEXTMODEL:"IfcTextStyleTextModel",IFCTEXTSTYLEFORDEFINEDFONT:"IfcTextStyleForDefinedFont",IFCTEXTSTYLEFONTMODEL:"IfcTextStyleFontModel",IFCTEXTSTYLE:"IfcTextStyle",IFCTELECOMADDRESS:"IfcTelecomAddress",IFCTABLEROW:"IfcTableRow",IFCTABLE:"IfcTable",IFCSYMBOLSTYLE:"IfcSymbolStyle",IFCSURFACETEXTURE:"IfcSurfaceTexture",IFCSURFACESTYLEWITHTEXTURES:"IfcSurfaceStyleWithTextures",IFCSURFACESTYLESHADING:"IfcSurfaceStyleShading",IFCSURFACESTYLEREFRACTION:"IfcSurfaceStyleRefraction",IFCSURFACESTYLELIGHTING:"IfcSurfaceStyleLighting",IFCSURFACESTYLE:"IfcSurfaceStyle",IFCSTYLEDREPRESENTATION:"IfcStyledRepresentation",IFCSTYLEDITEM:"IfcStyledItem",IFCSTYLEMODEL:"IfcStyleModel",IFCSTRUCTURALLOADTEMPERATURE:"IfcStructuralLoadTemperature",IFCSTRUCTURALLOADSTATIC:"IfcStructuralLoadStatic",IFCSTRUCTURALLOAD:"IfcStructuralLoad",IFCSTRUCTURALCONNECTIONCONDITION:"IfcStructuralConnectionCondition",IFCSIMPLEPROPERTY:"IfcSimpleProperty",IFCSHAPEREPRESENTATION:"IfcShapeRepresentation",IFCSHAPEMODEL:"IfcShapeModel",IFCSHAPEASPECT:"IfcShapeAspect",IFCSECTIONREINFORCEMENTPROPERTIES:"IfcSectionReinforcementProperties",IFCSECTIONPROPERTIES:"IfcSectionProperties",IFCSIUNIT:"IfcSIUnit",IFCROOT:"IfcRoot",IFCRIBPLATEPROFILEPROPERTIES:"IfcRibPlateProfileProperties",IFCREPRESENTATIONMAP:"IfcRepresentationMap",IFCREPRESENTATIONITEM:"IfcRepresentationItem",IFCREPRESENTATIONCONTEXT:"IfcRepresentationContext",IFCREPRESENTATION:"IfcRepresentation",IFCRELAXATION:"IfcRelaxation",IFCREINFORCEMENTBARPROPERTIES:"IfcReinforcementBarProperties",IFCREFERENCESVALUEDOCUMENT:"IfcReferencesValueDocument",IFCQUANTITYWEIGHT:"IfcQuantityWeight",IFCQUANTITYVOLUME:"IfcQuantityVolume",IFCQUANTITYTIME:"IfcQuantityTime",IFCQUANTITYLENGTH:"IfcQuantityLength",IFCQUANTITYCOUNT:"IfcQuantityCount",IFCQUANTITYAREA:"IfcQuantityArea",IFCPROPERTYENUMERATION:"IfcPropertyEnumeration",IFCPROPERTYDEPENDENCYRELATIONSHIP:"IfcPropertyDependencyRelationship",IFCPROPERTYCONSTRAINTRELATIONSHIP:"IfcPropertyConstraintRelationship",IFCPROPERTY:"IfcProperty",IFCPROFILEPROPERTIES:"IfcProfileProperties",IFCPROFILEDEF:"IfcProfileDef",IFCPRODUCTSOFCOMBUSTIONPROPERTIES:"IfcProductsOfCombustionProperties",IFCPRODUCTREPRESENTATION:"IfcProductRepresentation",IFCPRESENTATIONSTYLEASSIGNMENT:"IfcPresentationStyleAssignment",IFCPRESENTATIONSTYLE:"IfcPresentationStyle",IFCPRESENTATIONLAYERWITHSTYLE:"IfcPresentationLayerWithStyle",IFCPRESENTATIONLAYERASSIGNMENT:"IfcPresentationLayerAssignment",IFCPREDEFINEDTEXTFONT:"IfcPredefinedTextFont",IFCPREDEFINEDTERMINATORSYMBOL:"IfcPredefinedTerminatorSymbol",IFCPREDEFINEDSYMBOL:"IfcPredefinedSymbol",IFCPREDEFINEDITEM:"IfcPredefinedItem",IFCPOSTALADDRESS:"IfcPostalAddress",IFCPHYSICALSIMPLEQUANTITY:"IfcPhysicalSimpleQuantity",IFCPHYSICALQUANTITY:"IfcPhysicalQuantity",IFCPERSONANDORGANIZATION:"IfcPersonAndOrganization",IFCPERSON:"IfcPerson",IFCOWNERHISTORY:"IfcOwnerHistory",IFCORGANIZATIONRELATIONSHIP:"IfcOrganizationRelationship",IFCORGANIZATION:"IfcOrganization",IFCOPTICALMATERIALPROPERTIES:"IfcOpticalMaterialProperties",IFCOBJECTIVE:"IfcObjective",IFCOBJECTPLACEMENT:"IfcObjectPlacement",IFCNAMEDUNIT:"IfcNamedUnit",IFCMONETARYUNIT:"IfcMonetaryUnit",IFCMETRIC:"IfcMetric",IFCMECHANICALSTEELMATERIALPROPERTIES:"IfcMechanicalSteelMaterialProperties",IFCMECHANICALMATERIALPROPERTIES:"IfcMechanicalMaterialProperties",IFCMEASUREWITHUNIT:"IfcMeasureWithUnit",IFCMATERIALPROPERTIES:"IfcMaterialProperties",IFCMATERIALLIST:"IfcMaterialList",IFCMATERIALLAYERSETUSAGE:"IfcMaterialLayerSetUsage",IFCMATERIALLAYERSET:"IfcMaterialLayerSet",IFCMATERIALLAYER:"IfcMaterialLayer",IFCMATERIALCLASSIFICATIONRELATIONSHIP:"IfcMaterialClassificationRelationship",IFCMATERIAL:"IfcMaterial",IFCLOCALTIME:"IfcLocalTime",IFCLIGHTINTENSITYDISTRIBUTION:"IfcLightIntensityDistribution",IFCLIGHTDISTRIBUTIONDATA:"IfcLightDistributionData",IFCLIBRARYREFERENCE:"IfcLibraryReference",IFCLIBRARYINFORMATION:"IfcLibraryInformation",IFCIRREGULARTIMESERIESVALUE:"IfcIrregularTimeSeriesValue",IFCGRIDAXIS:"IfcGridAxis",IFCEXTERNALLYDEFINEDTEXTFONT:"IfcExternallyDefinedTextFont",IFCEXTERNALLYDEFINEDSYMBOL:"IfcExternallyDefinedSymbol",IFCEXTERNALLYDEFINEDSURFACESTYLE:"IfcExternallyDefinedSurfaceStyle",IFCEXTERNALLYDEFINEDHATCHSTYLE:"IfcExternallyDefinedHatchStyle",IFCEXTERNALREFERENCE:"IfcExternalReference",IFCENVIRONMENTALIMPACTVALUE:"IfcEnvironmentalImpactValue",IFCDRAUGHTINGCALLOUTRELATIONSHIP:"IfcDraughtingCalloutRelationship",IFCDOCUMENTINFORMATIONRELATIONSHIP:"IfcDocumentInformationRelationship",IFCDOCUMENTINFORMATION:"IfcDocumentInformation",IFCDOCUMENTELECTRONICFORMAT:"IfcDocumentElectronicFormat",IFCDIMENSIONALEXPONENTS:"IfcDimensionalExponents",IFCDERIVEDUNITELEMENT:"IfcDerivedUnitElement",IFCDERIVEDUNIT:"IfcDerivedUnit",IFCDATEANDTIME:"IfcDateAndTime",IFCCURVESTYLEFONTPATTERN:"IfcCurveStyleFontPattern",IFCCURVESTYLEFONTANDSCALING:"IfcCurveStyleFontAndScaling",IFCCURVESTYLEFONT:"IfcCurveStyleFont",IFCCURRENCYRELATIONSHIP:"IfcCurrencyRelationship",IFCCOSTVALUE:"IfcCostValue",IFCCOORDINATEDUNIVERSALTIMEOFFSET:"IfcCoordinatedUniversalTimeOffset",IFCCONSTRAINTRELATIONSHIP:"IfcConstraintRelationship",IFCCONSTRAINTCLASSIFICATIONRELATIONSHIP:"IfcConstraintClassificationRelationship",IFCCONSTRAINTAGGREGATIONRELATIONSHIP:"IfcConstraintAggregationRelationship",IFCCONSTRAINT:"IfcConstraint",IFCCONNECTIONSURFACEGEOMETRY:"IfcConnectionSurfaceGeometry",IFCCONNECTIONPORTGEOMETRY:"IfcConnectionPortGeometry",IFCCONNECTIONPOINTGEOMETRY:"IfcConnectionPointGeometry",IFCCONNECTIONGEOMETRY:"IfcConnectionGeometry",IFCCOLOURSPECIFICATION:"IfcColourSpecification",IFCCLASSIFICATIONNOTATIONFACET:"IfcClassificationNotationFacet",IFCCLASSIFICATIONNOTATION:"IfcClassificationNotation",IFCCLASSIFICATIONITEMRELATIONSHIP:"IfcClassificationItemRelationship",IFCCLASSIFICATIONITEM:"IfcClassificationItem",IFCCLASSIFICATION:"IfcClassification",IFCCALENDARDATE:"IfcCalendarDate",IFCBOUNDARYNODECONDITIONWARPING:"IfcBoundaryNodeConditionWarping",IFCBOUNDARYNODECONDITION:"IfcBoundaryNodeCondition",IFCBOUNDARYFACECONDITION:"IfcBoundaryFaceCondition",IFCBOUNDARYEDGECONDITION:"IfcBoundaryEdgeCondition",IFCBOUNDARYCONDITION:"IfcBoundaryCondition",IFCAPPROVALRELATIONSHIP:"IfcApprovalRelationship",IFCAPPROVALPROPERTYRELATIONSHIP:"IfcApprovalPropertyRelationship",IFCAPPROVALACTORRELATIONSHIP:"IfcApprovalActorRelationship",IFCAPPROVAL:"IfcApproval",IFCAPPLIEDVALUERELATIONSHIP:"IfcAppliedValueRelationship",IFCAPPLIEDVALUE:"IfcAppliedValue",IFCAPPLICATION:"IfcApplication",IFCADDRESS:"IfcAddress",IFCACTORROLE:"IfcActorRole"};class ch{constructor(){p(this,"factor",1),p(this,"complement",1)}apply(e){const t=this.getScaleMatrix().multiply(e);e.copy(t)}setUp(e){var t,s,i;this.factor=1;const n=this.getLengthUnits(e);if(!n)return;const r=n==null,o=n.Name===void 0||n.Name===null;r||o||(n.Name.value==="FOOT"&&(this.factor=.3048),((t=n.Prefix)==null?void 0:t.value)==="MILLI"?this.complement=.001:((s=n.Prefix)==null?void 0:s.value)==="CENTI"?this.complement=.01:((i=n.Prefix)==null?void 0:i.value)==="DECI"&&(this.complement=.01))}getLengthUnits(e){try{const t=e.GetLineIDsWithType(0,tl).get(0),s=e.GetLine(0,t);for(const i of s.Units){if(!i||i.value===null||i.value===void 0)continue;const n=e.GetLine(0,i.value);if(n.UnitType&&n.UnitType.value==="LENGTHUNIT")return n}return null}catch{return console.log("Could not get units"),null}}getScaleMatrix(){const e=this.factor;return new Ee().fromArray([e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1])}}class Bo{constructor(){p(this,"itemsByFloor",{}),p(this,"_units",new ch)}setUp(e){this._units.setUp(e),this.cleanUp();try{const t=e.GetLineIDsWithType(0,bi),s=new Set,i=e.GetLineIDsWithType(0,kt);for(let c=0;c<i.size();c++)s.add(i.get(c));const n=e.GetLineIDsWithType(0,Di),r=n.size();for(let c=0;c<r;c++){const h=n.get(c),I=e.GetLine(0,h);if(!I||!I.RelatingObject||!I.RelatedObjects)continue;const d=I.RelatingObject.value,u=I.RelatedObjects;for(const f of u){const E=f.value;s.has(E)&&(this.itemsByFloor[E]=d)}}const o={},a=t.size();for(let c=0;c<a;c++){const h=t.get(c),I=e.GetLine(0,h);if(!I||!I.RelatingStructure||!I.RelatedElements)continue;const d=I.RelatingStructure.value,u=I.RelatedElements;if(s.has(d))for(const f of u){o[d]||(o[d]=[]);const E=f.value;o[d].push(E)}else for(const f of u){const E=f.value;this.itemsByFloor[E]=d}}for(const c in o){const h=this.itemsByFloor[c];if(h!==void 0){const I=o[c];for(const d of I)this.itemsByFloor[d]=h}}for(let c=0;c<r;c++){const h=n.get(c),I=e.GetLine(0,h);if(!I||!I.RelatingObject||!I.RelatedObjects)continue;const d=I.RelatingObject.value,u=I.RelatedObjects;for(const f of u){const E=f.value,C=this.itemsByFloor[d];C!==void 0&&(this.itemsByFloor[E]=C)}}}catch{console.log("Could not get floors.")}}cleanUp(){this.itemsByFloor={}}}class ir{constructor(){p(this,"includeProperties",!0),p(this,"optionalCategories",[kt]),p(this,"wasm",{path:"",absolute:!1,logLevel:Ha.LOG_LEVEL_OFF}),p(this,"excludedCategories",new Set),p(this,"includedCategories",new Set),p(this,"saveLocations",!1),p(this,"webIfc",{COORDINATE_TO_ORIGIN:!0}),p(this,"autoSetWasm",!0),p(this,"customLocateFileHandler",null)}}class Yo{constructor(){p(this,"defLineMat",new fo({color:16777215}))}read(e){const t=e.GetAllAlignments(0),s=e.GetAllCrossSections2D(0),i=e.GetAllCrossSections3D(0),n={IfcAlignment:t,IfcCrossSection2D:s,IfcCrossSection3D:i};return this.get(n)}get(e){if(e.IfcAlignment){const t=new Map;for(const s of e.IfcAlignment){const i=new Wa;i.absolute=this.getCurves(s.curve3D,i),i.horizontal=this.getCurves(s.horizontal,i),i.vertical=this.getCurves(s.vertical,i),t.set(t.size,i)}return{alignments:t,coordinationMatrix:new Ee}}}getCurves(e,t){const s=[];let i=0;for(const n of e){const r={};if(n.data)for(const d of n.data){const[u,f]=d.split(": "),E=parseFloat(f);r[u]=E||f}const{points:o}=n,a=new Float32Array(o.length*3);for(let d=0;d<o.length;d++){const{x:u,y:f,z:E}=o[d];a[d*3]=u,a[d*3+1]=f,a[d*3+2]=E||0}const c=new Gs(a,3),h=new Xa;h.setAttribute("position",c);const I=new ja(i,r,t,h,this.defLineMat);s.push(I.curve),i++}return s}}class Vo{getNameInfo(e){var t;const s={},{arguments:i}=e.GetHeaderLine(0,Za)||{};if(!i)return s;const[n,r,o,a,c,h,I]=i;if(n!=null&&n.value&&(s.name=n.value),r!=null&&r.value&&(s.creationDate=new Date(r.value)),o){s.author={};const[d,u]=o;d!=null&&d.value&&(s.author.name=d.value),u!=null&&u.value&&(s.author.email=u.value)}return a&&(t=a[0])!=null&&t.value&&(s.organization=a[0].value),c!=null&&c.value&&(s.preprocessorVersion=c==null?void 0:c.value),h!=null&&h.value&&(s.originatingSystem=h==null?void 0:h.value),I!=null&&I.value&&(s.authorization=I==null?void 0:I.value),s}getDescriptionInfo(e){var t;const s={},{arguments:i}=e.GetHeaderLine(0,$a)||{};if(!i)return s;const[n,r]=i;if(Array.isArray(n)&&(t=n[0])!=null&&t.value){const o=n[0].value.match(/\[([^\]]+)\]/);o&&o[1]&&(s.viewDefinition=o[1])}return r!=null&&r.value&&(s.implementationLevel=r.value),s}}class Go{static get(e,t){const s=[jn,Zn,$n,qn,kt,sl,il,nl,rl],i=e.data;for(const n of s){const r=t.GetLineIDsWithType(0,n),o=r.size();for(let a=0;a<o;a++){const c=r.get(a);i.has(c)||i.set(c,[[],[0,n]])}}}}const zo=new Set([1123145078,574549367,1675464909,2059837836,3798115385,32440307,3125803723,3207858831,2740243338,2624227202,4240577450,3615266464,3724593414,220341763,477187591,1878645084,1300840506,3303107099,1607154358,1878645084,846575682,1351298697,2417041796,3049322572,3331915920,1416205885,776857604,3285139300,3958052878,2827736869,2732653382,673634403,3448662350,4142052618,2924175390,803316827,2556980723,1809719519,2205249479,807026263,3737207727,1660063152,2347385850,2705031697,3732776249,2485617015,2611217952,1704287377,2937912522,2770003689,1281925730,1484403080,3448662350,4142052618,3800577675,4006246654,3590301190,1383045692,2775532180,2047409740,370225590,3593883385,2665983363,4124623270,812098782,3649129432,987898635,1105321065,3510044353,1635779807,2603310189,3406155212,1310608509,4261334040,2736907675,3649129432,1136057603,1260505505,4182860854,2713105998,2898889636,59481748,3749851601,3486308946,3150382593,1062206242,3264961684,15328376,1485152156,370225590,1981873012,2859738748,45288368,2614616156,2732653382,775493141,2147822146,2601014836,2629017746,1186437898,2367409068,1213902940,3632507154,3900360178,476780140,1472233963,2804161546,3008276851,738692330,374418227,315944413,3905492369,3570813810,2571569899,178912537,2294589976,1437953363,2133299955,572779678,3092502836,388784114,2624227202,1425443689,3057273783,2347385850,1682466193,2519244187,2839578677,3958567839,2513912981,2830218821,427810014]),ko=class Ho extends Ae{constructor(e){super(e),p(this,"enabled",!0),e.add(Ho.uuid,this)}async export(e,t,s=!1,i=!0){const n={},r=new Set(e.GetIfcEntityList(t)),o=new Set([jn,Zn,$n,qn,kt]);for(const a of o)r.add(a);for(const a of r){if(zo.has(a))continue;const c=o.has(a)&&i,h=e.GetLineIDsWithType(t,a);for(const I of h)try{const d=e.GetLine(0,I,c,s);n[d.expressID]=d}catch{console.log(`Could not get property ${I}, with recursive ${c} and indirect ${s}.`)}}return n}};p(ko,"uuid","b32c4332-cd67-436e-ba7f-196646c7a635");let hh=ko;const Wo=class Sn extends Ae{constructor(e){super(e),p(this,"onDisposed",new $),p(this,"onIfcStartedLoading",new $),p(this,"onSetup",new $),p(this,"settings",new ir),p(this,"webIfc",new hs),p(this,"enabled",!0),p(this,"_material",new hr),p(this,"_spatialTree",new Bo),p(this,"_metaData",new Vo),p(this,"_fragmentInstances",new Map),p(this,"_civil",new Yo),p(this,"_visitedFragments",new Map),p(this,"_materialT",new hr({transparent:!0,opacity:.5})),this.components.add(Sn.uuid,this),this.settings.excludedCategories.add(Io)}dispose(){this.webIfc=null,this.onDisposed.trigger(Sn.uuid),this.onDisposed.reset()}async setup(e){this.settings={...this.settings,...e},this.settings.autoSetWasm&&await this.autoSetWasm(),this.onSetup.trigger()}async load(e,t=!0,s=""){const i=performance.now();this.onIfcStartedLoading.trigger(),await this.readIfcFile(e);const n=await this.getAllGeometries();n.name=s;const r=await this.components.get(hh).export(this.webIfc,0);n.setLocalProperties(r);const o=this.components.get(Re);o.groups.set(n.uuid,n);for(const a of n.items)o.list.set(a.id,a),a.mesh.uuid=a.id,a.group=n;o.onFragmentsLoaded.trigger(n),t&&o.coordinate([n]);for(const[a]of n.data){const c=r[a];if(!c||!c.GlobalId)continue;const h=c.GlobalId.value||c.GlobalId;n.globalToExpressIDs.set(h,a)}return Go.get(n,this.webIfc),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-i} ms!`),n}async readIfcFile(e){const{path:t,absolute:s,logLevel:i}=this.settings.wasm;return this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(this.settings.customLocateFileHandler||void 0),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModel(e,this.settings.webIfc)}cleanUp(){try{this.webIfc.Dispose()}catch{console.log("Web-ifc wasn't disposed.")}this.webIfc=null,this.webIfc=new hs,this._visitedFragments.clear(),this._fragmentInstances.clear()}async getAllGeometries(){this._spatialTree.setUp(this.webIfc);const e=this.webIfc.GetIfcEntityList(0),t=new xs;t.ifcMetadata={name:"",description:"",...this._metaData.getNameInfo(this.webIfc),...this._metaData.getDescriptionInfo(this.webIfc),schema:this.webIfc.GetModelSchema(0)||"IFC2X3",maxExpressID:this.webIfc.GetMaxExpressID(0)};const s=[];for(const n of e){if(!this.webIfc.IsIfcElement(n)&&n!==kt)continue;const r=this.settings.includedCategories;if(r.size>0&&!r.has(n)||this.settings.excludedCategories.has(n))continue;const o=this.webIfc.GetLineIDsWithType(0,n),a=o.size();for(let c=0;c<a;c++){const h=o.get(c);s.push(h);const I=this._spatialTree.itemsByFloor[h]||0;t.data.set(h,[[],[I,n]])}}this._spatialTree.cleanUp(),this.webIfc.StreamMeshes(0,s,n=>{this.getMesh(n,t)});for(const n of this._visitedFragments){const{index:r,fragment:o}=n[1];t.keyFragments.set(r,o.id)}for(const n of t.items){const r=this._fragmentInstances.get(n.id);if(!r)throw new Error("Fragment not found!");const o=[];for(const[a,c]of r)o.push(c);n.add(o)}const i=this.webIfc.GetCoordinationMatrix(0);return t.coordinationMatrix.fromArray(i),t.civilData=this._civil.read(this.webIfc),t}getMesh(e,t){const s=e.geometries.size(),i=e.expressID;for(let n=0;n<s;n++){const r=e.geometries.get(n),{x:o,y:a,z:c,w:h}=r.color,I=h!==1,{geometryExpressID:d}=r,u=`${d}-${I}`;if(!this._visitedFragments.has(u)){const m=this.getGeometry(this.webIfc,d),S=I?this._materialT:this._material,N=new Ya(m,S,1);t.add(N.mesh),t.items.push(N);const y=this._visitedFragments.size;this._visitedFragments.set(u,{index:y,fragment:N})}const f=new Ue().setRGB(o,a,c,"srgb"),E=new Ee;E.fromArray(r.flatTransformation);const C=this._visitedFragments.get(u);if(C===void 0)throw new Error("Error getting geometry data for streaming!");const T=t.data.get(i);if(!T)throw new Error("Data not found!");T[0].push(C.index);const{fragment:R}=C;this._fragmentInstances.has(R.id)||this._fragmentInstances.set(R.id,new Map);const A=this._fragmentInstances.get(R.id);if(!A)throw new Error("Instances not found!");if(A.has(i)){const m=A.get(i);if(!m)throw new Error("Instance not found!");m.transforms.push(E),m.colors&&m.colors.push(f)}else A.set(i,{id:i,transforms:[E],colors:[f]})}}getGeometry(e,t){const s=e.GetGeometry(0,t),i=e.GetIndexArray(s.GetIndexData(),s.GetIndexDataSize()),n=e.GetVertexArray(s.GetVertexData(),s.GetVertexDataSize()),r=new Float32Array(n.length/2),o=new Float32Array(n.length/2);for(let I=0;I<n.length;I+=6)r[I/2]=n[I],r[I/2+1]=n[I+1],r[I/2+2]=n[I+2],o[I/2]=n[I+3],o[I/2+1]=n[I+4],o[I/2+2]=n[I+5];const a=new Vs,c=new Gs(r,3),h=new Gs(o,3);return a.setAttribute("position",c),a.setAttribute("normal",h),a.setIndex(Array.from(i)),s.delete(),a}async autoSetWasm(){const e=await fetch(`https://unpkg.com/@thatopen/components@${So.release}/package.json`);if(!e.ok){console.warn("Couldn't get openbim-components package.json. Set wasm settings manually.");return}const t=await e.json();if(!("web-ifc"in t.peerDependencies))console.warn("Couldn't get web-ifc from peer dependencies in openbim-components. Set wasm settings manually.");else{const s=t.peerDependencies["web-ifc"];this.settings.wasm.path=`https://unpkg.com/web-ifc@${s}/`,this.settings.wasm.absolute=!0}}};p(Wo,"uuid","a659add7-1418-4771-a0d6-7d4d438e4624");let uh=Wo;const dh={IfcRelAssignsToControl:{related:5,relating:7},IfcRelAssignsToGroup:{related:5,relating:7},IfcRelAssignsToProduct:{related:5,relating:7},IfcRelAssociatesClassification:{related:5,relating:6},IfcRelAssociatesMaterial:{related:5,relating:6},IfcRelAssociatesDocument:{related:5,relating:6},IfcRelContainedInSpatialStructure:{related:5,relating:6},IfcRelFlowControlElements:{related:5,relating:6},IfcRelConnectsElements:{related:7,relating:6},IfcRelDeclares:{related:6,relating:5},IfcRelAggregates:{related:6,relating:5},IfcRelNests:{related:6,relating:5},IfcRelDefinesByProperties:{related:5,relating:6},IfcRelDefinesByType:{related:5,relating:6},IfcRelDefinesByTemplate:{related:5,relating:6}},Ih={[Hn]:"IfcRelAssignsToControl",[xn]:"IfcRelAssignsToGroup",[zn]:"IfcRelAssignsToProduct",[Un]:"IfcRelAssociatesClassification",[bn]:"IfcRelAssociatesMaterial",[Xn]:"IfcRelAssociatesDocument",[bi]:"IfcRelContainedInSpatialStructure",[Gn]:"IfcRelConnectsElements",[Vn]:"IfcRelFlowControlElements",[kn]:"IfcRelDeclares",[Di]:"IfcRelAggregates",[Wn]:"IfcRelNests",[Hs]:"IfcRelDefinesByProperties",[Bn]:"IfcRelDefinesByType",[Yn]:"IfcRelDefinesByTemplate"},Xo=class Bt extends Ae{constructor(e){super(e),p(this,"onDisposed",new $),p(this,"onRequestFile",new $),p(this,"ifcToExport",null),p(this,"onElementToPset",new $),p(this,"onPropToPset",new $),p(this,"onPsetRemoved",new $),p(this,"onDataChanged",new $),p(this,"wasm",{path:"/",absolute:!1}),p(this,"enabled",!0),p(this,"attributeListeners",{}),p(this,"selectedModel"),p(this,"changeMap",{}),this.components.add(Bt.uuid,this)}dispose(){this.selectedModel=void 0,this.attributeListeners={},this.changeMap={},this.onElementToPset.reset(),this.onPropToPset.reset(),this.onPsetRemoved.reset(),this.onDataChanged.reset(),this.onDisposed.trigger(Bt.uuid),this.onDisposed.reset()}static getIFCSchema(e){const t=e.ifcMetadata.schema;if(!t)throw new Error("IFC Schema not found");return t.startsWith("IFC2X3")?"IFC2X3":t.startsWith("IFC4")&&t.replace("IFC4","")===""?"IFC4":t.startsWith("IFC4X3")?"IFC4X3":t}async setData(e,...t){for(const s of t){const{expressID:i}=s;(!i||i===-1)&&(s.expressID=this.getNewExpressID(e)),await e.setProperties(s.expressID,s),this.registerChange(e,s.expressID)}}async newPset(e,t,s){const i=Bt.getIFCSchema(e),{handle:n}=await this.getOwnerHistory(e),r=this.newGUID(e),o=new ht[i].IfcLabel(t),a=s?new ht[i].IfcText(s):null,c=new ht[i].IfcPropertySet(r,n,o,a,[]);return c.expressID=this.getNewExpressID(e),await this.setData(e,c),{pset:c}}async removePset(e,...t){for(const s of t){const i=await e.getProperties(s);if((i==null?void 0:i.type)!==ls)continue;const n=await cs.getPsetRel(e,s);if(n&&(await e.setProperties(n,null),this.registerChange(e,n)),i){for(const r of i.HasProperties)await e.setProperties(r.value,null);await e.setProperties(s,null),this.onPsetRemoved.trigger({model:e,psetID:s}),this.registerChange(e,s)}}}newSingleStringProperty(e,t,s,i){return this.newSingleProperty(e,t,s,i)}newSingleNumericProperty(e,t,s,i){return this.newSingleProperty(e,t,s,i)}newSingleBooleanProperty(e,t,s,i){return this.newSingleProperty(e,t,s,i)}async removePsetProp(e,t,s){const i=await e.getProperties(t),n=await e.getProperties(s);!i||!n||i.type===ls&&n&&(i.HasProperties=i.HasProperties.filter(r=>r.value!==s),await e.setProperties(s,null),this.registerChange(e,t,s))}addElementToPset(e,t,...s){this.components.get(Ke).addEntitiesRelation(e,t,{type:Hs,inv:"DefinesOcurrence"},...s)}async addPropToPset(e,t,...s){const i=await e.getProperties(t);if(i){for(const n of s){if(i.HasProperties.includes(n))continue;const r=new Nt(n);i.HasProperties.push(r),this.onPropToPset.trigger({model:e,psetID:t,propID:n})}this.registerChange(e,t)}}async createIfcRel(e,t,s,i){const n=Ih[t];if(!n)throw new Error(`IfcPropertiesManager: ${n} is unsoported.`);const r=Bt.getIFCSchema(e),o=dh[n],a=ht[r][n];if(!(o&&a))throw new Error(`IfcPropertiesManager: ${n} is unsoported.`);const c=[new ht[r].IfcGloballyUniqueId(gt.create())],{related:h,relating:I}=o,d=[...new Set(i)].map(E=>new Nt(E)),u=(E,C)=>{for(let T=E;T<C-1;T++)c.push(null)};h<I?(u(1,h),c.push(d),u(h,I),c.push(new Nt(s))):(u(1,I),u(I,h),c.push(new Nt(s)),c.push(d));const f=new a(...c);return await this.setData(e,f),f}async saveToIfc(e,t){const s=this.components.get(uh),i=s.webIfc,n=await s.readIfcFile(t);await this.components.get(Ke).applyRelationChanges();const r=this.changeMap[e.uuid]??[];for(const a of r){const c=await e.getProperties(a);c?i.WriteLine(n,c):i.GetLine(n,a)&&i.DeleteLine(n,a)}const o=i.SaveModel(n);return s.webIfc.CloseModel(n),s.cleanUp(),o}async getEntityRef(e,t){const s=await e.getAllPropertiesOfType(t);if(!s)return null;const i=[];for(const n in s){const r=new Nt(Number(n));i.push(r)}return i}async setAttributeListener(e,t,s){this.attributeListeners[e.uuid]||(this.attributeListeners[e.uuid]={});const i=this.attributeListeners[e.uuid][t]?this.attributeListeners[e.uuid][t][s]:null;if(i)return i;const n=await e.getProperties(t);if(!n)throw new Error(`Entity with expressID ${t} doesn't exists.`);const r=n[s];if(Array.isArray(r)||!r)throw new Error(`Attribute ${s} is array or null, and it can't have a listener.`);const o=r.value;if(o===void 0||o==null)throw new Error(`Attribute ${s} has a badly defined handle.`);const a=new $;return Object.defineProperty(n[s],"value",{get(){return this._value},async set(c){this._value=c,a.trigger(c)}}),n[s].value=o,this.attributeListeners[e.uuid][t]||(this.attributeListeners[e.uuid][t]={}),this.attributeListeners[e.uuid][t][s]=a,a}getNewExpressID(e){return e.ifcMetadata.maxExpressID++,e.ifcMetadata.maxExpressID}newGUID(e){const t=Bt.getIFCSchema(e);return new ht[t].IfcGloballyUniqueId(gt.create())}async getOwnerHistory(e){const t=await e.getAllPropertiesOfType(Va);if(!t)throw new Error("No OwnerHistory was found.");const s=Object.keys(t).map(r=>parseInt(r,10)),i=t[s[0]],n=new Nt(i.expressID);return{entity:i,handle:n}}registerChange(e,...t){this.changeMap[e.uuid]||(this.changeMap[e.uuid]=new Set);for(const s of t)this.changeMap[e.uuid].add(s),this.onDataChanged.trigger({model:e,expressID:s})}async newSingleProperty(e,t,s,i){const n=Bt.getIFCSchema(e),r=new ht[n].IfcIdentifier(s),o=new ht[n][t](i),a=new ht[n].IfcPropertySingleValue(r,null,o,null);return a.expressID=this.getNewExpressID(e),await this.setData(e,a),a}};p(Xo,"uuid","58c2d9f0-183c-48d6-a402-dfcf5b9a34df");let Eh=Xo;const jo=class An extends Ae{constructor(e){super(e),p(this,"onDisposed",new $),p(this,"onRelationsIndexed",new $),p(this,"relationMaps",{}),p(this,"enabled",!0),p(this,"_relToAttributesMap",Kr),p(this,"_inverseAttributes",["IsDecomposedBy","Decomposes","AssociatedTo","HasAssociations","ClassificationForObjects","IsGroupedBy","HasAssignments","IsDefinedBy","DefinesOcurrence","IsTypedBy","Types","Defines","ContainedInStructure","ContainsElements","HasControlElements","AssignedToFlowElement","ConnectedTo","ConnectedFrom","ReferencedBy","Declares","HasContext","Controls","IsNestedBy","Nests","DocumentRefForObjects"]),p(this,"_ifcRels",[Di,bn,Un,xn,Hs,Bn,Yn,bi,Vn,Gn,zn,kn,Hn,Wn,Xn]),p(this,"onFragmentsDisposed",t=>{delete this.relationMaps[t.groupID]}),p(this,"_changeMap",{}),p(this,"onEntitiesRelated",new $),this.components.add(An.uuid,this),e.get(Re).onFragmentsDisposed.add(this.onFragmentsDisposed)}indexRelations(e,t,s,i){const n=Object.keys(t).find(h=>h.startsWith("Relating")),r=Object.keys(t).find(h=>h.startsWith("Related"));if(!(n&&r))return;const o=t[n].value,a=t[r].map(h=>h.value),c=this.getEntityRelations(e,o,i);for(const h of a)c.push(h);for(const h of a)this.getEntityRelations(e,h,s).push(o)}getAttributeIndex(e){const t=this._inverseAttributes.indexOf(e);if(t===-1)throw new Error(`IfcRelationsIndexer: ${e} is not a valid IFC Inverse Attribute name or its not supported yet by this component.`);return t}setRelationMap(e,t){this.relationMaps[e.uuid]=t,this.onRelationsIndexed.trigger({modelID:e.uuid,relationsMap:t})}async process(e,t){if(!e.hasProperties)throw new Error("FragmentsGroup properties not found");let s=this.relationMaps[e.uuid];s||(s=new Map,this.relationMaps[e.uuid]=s);const i=e.getLocalProperties();if(!i)return s;const n=(t==null?void 0:t.relationsToProcess)??this._ifcRels;for(const[r,o]of Object.entries(i)){if(!n.includes(o.type))continue;const a=this._relToAttributesMap.get(o.type);if(!a)continue;const{forRelated:c,forRelating:h}=a;this.indexRelations(s,o,c,h)}return this.setRelationMap(e,s),s}async processFromWebIfc(e,t){const s=new Map;for(const i of this._ifcRels){const n=this._relToAttributesMap.get(i);if(!n)continue;const{forRelated:r,forRelating:o}=n,a=e.GetLineIDsWithType(t,i);for(let c=0;c<a.size();c++){const h=await e.properties.getItemProperties(t,a.get(c));this.indexRelations(s,h,r,o)}}return this.onRelationsIndexed.trigger({modelID:t.toString(),relationsMap:s}),s}getEntityRelations(e,t,s){const i=this.getAttributeIndex(s);let n;if(e instanceof xs?n=this.relationMaps[e.uuid]:typeof e=="string"?n=this.relationMaps[e]:n=e,!n&&(e instanceof xs||typeof e=="string")){n=new Map;const a=e instanceof xs?e.uuid:e;this.relationMaps[a]=n}let r=n.get(t);r||(r=new Map,n.set(t,r));let o=r.get(i);return o||(o=[],r.set(i,o)),o}serializeRelations(e){const t={};for(const[s,i]of e.entries()){t[s]||(t[s]={});for(const[n,r]of i.entries())t[s][n]=r}return JSON.stringify(t)}serializeModelRelations(e){const t=this.relationMaps[e.uuid];return t?this.serializeRelations(t):null}serializeAllRelations(){const e={};for(const t in this.relationMaps){const s=this.relationMaps[t],i={};for(const[n,r]of s.entries()){i[n]||(i[n]={});for(const[o,a]of r.entries())i[n][o]=a}e[t]=i}return JSON.stringify(e)}getRelationsMapFromJSON(e){const t=JSON.parse(e),s=new Map;for(const i in t){const n=t[i],r=new Map;for(const o in n)r.set(Number(o),n[o]);s.set(Number(i),r)}return s}dispose(){this.relationMaps={},this.components.get(Re).onFragmentsDisposed.remove(this.onFragmentsDisposed),this.onDisposed.trigger(An.uuid),this.onDisposed.reset()}getEntitiesWithRelation(e,t,s){const i=this.relationMaps[e.uuid];if(!i)throw new Error("IfcRelationsIndexer: the model relations are not indexed!");const n=new Set;for(const[r,o]of i){const a=this.getAttributeIndex(t),c=o.get(a);c&&c.includes(s)&&n.add(r)}return n}addEntityRelations(e,t,s,...i){const n=this.getEntityRelations(e,t,s);if(n)n.push(...i);else{const r=this.getAttributeIndex(s),o=this.relationMaps[e.uuid].get(t);o==null||o.set(r,i)}}async applyRelationChanges(){const e=this.components.get(Re),t=this.components.get(Eh);for(const s in this._changeMap){const i=e.groups.get(s);if(!i)continue;const n=this._changeMap[s];for(const[r,o]of n)for(const[a,c]of o){const{related:h,relID:I}=c;if(I){const d=await i.getProperties(I);if(!d)continue;const u=Object.keys(d),f=u.find(C=>C.startsWith("Related")),E=u.find(C=>C.startsWith("Relating"));if(!(f&&E))continue;d[f]=[...h].map(C=>new Nt(C)),d[E]=new Nt(a),await t.setData(i,d)}else{const d=await t.createIfcRel(i,r,a,[...h]);if(!d)continue;c.relID=d.expressID}}}}addEntitiesRelation(e,t,s,...i){const{type:n,inv:r}=s;let o=this.relationMaps[e.uuid];if(o||(o=new Map,this.relationMaps[e.uuid]=o),!this._ifcRels.includes(n))return;const a=Kr.get(n);if(!a)return;const{forRelated:c,forRelating:h}=a;if(!(c===r||h===r))return;let I=this._changeMap[e.uuid];I||(I=new rt,this._changeMap[e.uuid]=I);const d=h===r?[t]:i,u=c===r?[t]:i;let f=I.get(n);f||(f=new rt,f.onItemSet.add(()=>this.onEntitiesRelated.trigger({invAttribute:r,relType:n,relatingIDs:d,relatedIDs:u})),f.onItemUpdated.add(()=>this.onEntitiesRelated.trigger({invAttribute:r,relType:n,relatingIDs:d,relatedIDs:u})),I.set(n,f));for(const E of d){let C=f.get(E);C||(C={related:new Pt},f.set(E,C)),C.related.add(...u)}for(const E of d)this.getEntityRelations(e,E,h).push(...u);for(const E of u)this.getEntityRelations(e,E,c).push(...d)}getEntityChildren(e,t,s=new Set){if(s.add(t),this.relationMaps[e.uuid]===void 0)throw new Error("The provided model has no indices. You have to generate them first.");const i=this.getEntityRelations(e,t,"IsDecomposedBy");if(i)for(const r of i)this.getEntityChildren(e,r,s);const n=this.getEntityRelations(e,t,"ContainsElements");if(n)for(const r of n)this.getEntityChildren(e,r,s);return s}};p(jo,"uuid","23a889ab-83b3-44a4-8bee-ead83438370b");let Ke=jo;const Zo=class $o extends Ae{constructor(e){super(e),p(this,"onDisposed",new $),p(this,"onFragmentsLoaded",new $),p(this,"onFragmentsDisposed",new $),p(this,"list",new rt),p(this,"groups",new rt),p(this,"baseCoordinationModel",""),p(this,"baseCoordinationMatrix",new Ee),p(this,"enabled",!0),p(this,"_loader",new Eo),this.components.add($o.uuid,this)}get meshes(){const e=[];for(const[t,s]of this.list)e.push(s.mesh);return e}dispose(){for(const[e,t]of this.groups)t.dispose(!0);this.baseCoordinationModel="",this.groups.clear(),this.list.clear(),this.onFragmentsLoaded.reset(),this.onFragmentsDisposed.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}disposeGroup(e){const{uuid:t}=e,s=[];for(const i of e.items)s.push(i.id),this.list.delete(i.id);e.dispose(!0),this.groups.delete(e.uuid),this.groups.size===0&&(this.baseCoordinationModel="",this.baseCoordinationMatrix=new Ee),this.onFragmentsDisposed.trigger({groupID:t,fragmentIDs:s})}load(e,t){const s={coordinate:!0,...t},{coordinate:i,name:n,properties:r,relationsMap:o}=s,a=this._loader.import(e);t&&(a.isStreamed=t.isStreamed||!1),n&&(a.name=n);for(const c of a.items)c.group=a,this.list.set(c.id,c);return i&&this.coordinate([a]),this.groups.set(a.uuid,a),r&&a.setLocalProperties(r),o&&this.components.get(Ke).setRelationMap(a,o),this.onFragmentsLoaded.trigger(a),a}export(e){return this._loader.export(e)}getModelIdMap(e){const t={};for(const s in e){const i=this.list.get(s);if(!(i&&i.group))continue;const n=i.group;n.uuid in t||(t[n.uuid]=new Set);const r=e[s];for(const o of r)t[n.uuid].add(o)}return t}modelIdToFragmentIdMap(e){let t={};for(const s in e){const i=this.groups.get(s);if(!i)continue;const n=e[s],r=i.getFragmentMap(n);t={...t,...r}}return t}guidToFragmentIdMap(e){const t={};for(const[s,i]of this.groups){s in t||(t[s]=new Set);for(const n of e){const r=i.globalToExpressIDs.get(n);r&&t[s].add(r)}}return this.modelIdToFragmentIdMap(t)}fragmentIdMapToGuids(e){const t=[],s=this.getModelIdMap(e);for(const i in s){const n=this.groups.get(i);if(!n)continue;const r=s[i];for(const o of r)for(const[a,c]of n.globalToExpressIDs.entries())if(c===o){t.push(a);break}}return t}coordinate(e=Array.from(this.groups.values())){if(this.baseCoordinationModel.length===0){const t=e.pop();if(!t)return;this.baseCoordinationModel=t.uuid,this.baseCoordinationMatrix=t.coordinationMatrix.clone()}if(e.length)for(const t of e)t.coordinationMatrix.equals(this.baseCoordinationMatrix)||(t.position.set(0,0,0),t.rotation.set(0,0,0),t.scale.set(1,1,1),t.updateMatrix(),this.applyBaseCoordinateSystem(t,t.coordinationMatrix))}applyBaseCoordinateSystem(e,t){t&&e.applyMatrix4(t.clone().invert()),e.applyMatrix4(this.baseCoordinationMatrix)}clone(e,t){const s=e.cloneGroup(t);this.groups.set(s.uuid,s);for(const i of s.items)this.list.set(i.id,i);return s}};p(Zo,"uuid","fef46874-46a3-461b-8c44-2922ab77c806");let Re=Zo;var Ti=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function fh(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}function mi(l){throw new Error('Could not dynamically require "'+l+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var qo={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(l,e){(function(t){l.exports=t()})(function(){return function t(s,i,n){function r(c,h){if(!i[c]){if(!s[c]){var I=typeof mi=="function"&&mi;if(!h&&I)return I(c,!0);if(o)return o(c,!0);var d=new Error("Cannot find module '"+c+"'");throw d.code="MODULE_NOT_FOUND",d}var u=i[c]={exports:{}};s[c][0].call(u.exports,function(f){var E=s[c][1][f];return r(E||f)},u,u.exports,t,s,i,n)}return i[c].exports}for(var o=typeof mi=="function"&&mi,a=0;a<n.length;a++)r(n[a]);return r}({1:[function(t,s,i){var n=t("./utils"),r=t("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(a){for(var c,h,I,d,u,f,E,C=[],T=0,R=a.length,A=R,m=n.getTypeOf(a)!=="string";T<a.length;)A=R-T,I=m?(c=a[T++],h=T<R?a[T++]:0,T<R?a[T++]:0):(c=a.charCodeAt(T++),h=T<R?a.charCodeAt(T++):0,T<R?a.charCodeAt(T++):0),d=c>>2,u=(3&c)<<4|h>>4,f=1<A?(15&h)<<2|I>>6:64,E=2<A?63&I:64,C.push(o.charAt(d)+o.charAt(u)+o.charAt(f)+o.charAt(E));return C.join("")},i.decode=function(a){var c,h,I,d,u,f,E=0,C=0,T="data:";if(a.substr(0,T.length)===T)throw new Error("Invalid base64 input, it looks like a data url.");var R,A=3*(a=a.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(a.charAt(a.length-1)===o.charAt(64)&&A--,a.charAt(a.length-2)===o.charAt(64)&&A--,A%1!=0)throw new Error("Invalid base64 input, bad content length.");for(R=r.uint8array?new Uint8Array(0|A):new Array(0|A);E<a.length;)c=o.indexOf(a.charAt(E++))<<2|(d=o.indexOf(a.charAt(E++)))>>4,h=(15&d)<<4|(u=o.indexOf(a.charAt(E++)))>>2,I=(3&u)<<6|(f=o.indexOf(a.charAt(E++))),R[C++]=c,u!==64&&(R[C++]=h),f!==64&&(R[C++]=I);return R}},{"./support":30,"./utils":32}],2:[function(t,s,i){var n=t("./external"),r=t("./stream/DataWorker"),o=t("./stream/Crc32Probe"),a=t("./stream/DataLengthProbe");function c(h,I,d,u,f){this.compressedSize=h,this.uncompressedSize=I,this.crc32=d,this.compression=u,this.compressedContent=f}c.prototype={getContentWorker:function(){var h=new r(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),I=this;return h.on("end",function(){if(this.streamInfo.data_length!==I.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),h},getCompressedWorker:function(){return new r(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(h,I,d){return h.pipe(new o).pipe(new a("uncompressedSize")).pipe(I.compressWorker(d)).pipe(new a("compressedSize")).withStreamInfo("compression",I)},s.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,s,i){var n=t("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},i.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,s,i){var n=t("./utils"),r=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var h=0;h<8;h++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();s.exports=function(o,a){return o!==void 0&&o.length?n.getTypeOf(o)!=="string"?function(c,h,I,d){var u=r,f=d+I;c^=-1;for(var E=d;E<f;E++)c=c>>>8^u[255&(c^h[E])];return-1^c}(0|a,o,o.length,0):function(c,h,I,d){var u=r,f=d+I;c^=-1;for(var E=d;E<f;E++)c=c>>>8^u[255&(c^h.charCodeAt(E))];return-1^c}(0|a,o,o.length,0):0}},{"./utils":32}],5:[function(t,s,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(t,s,i){var n=null;n=typeof Promise<"u"?Promise:t("lie"),s.exports={Promise:n}},{lie:37}],7:[function(t,s,i){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",r=t("pako"),o=t("./utils"),a=t("./stream/GenericWorker"),c=n?"uint8array":"array";function h(I,d){a.call(this,"FlateWorker/"+I),this._pako=null,this._pakoAction=I,this._pakoOptions=d,this.meta={}}i.magic="\b\0",o.inherits(h,a),h.prototype.processChunk=function(I){this.meta=I.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(c,I.data),!1)},h.prototype.flush=function(){a.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var I=this;this._pako.onData=function(d){I.push({data:d,meta:I.meta})}},i.compressWorker=function(I){return new h("Deflate",I)},i.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,s,i){function n(u,f){var E,C="";for(E=0;E<f;E++)C+=String.fromCharCode(255&u),u>>>=8;return C}function r(u,f,E,C,T,R){var A,m,S=u.file,N=u.compression,y=R!==c.utf8encode,P=o.transformTo("string",R(S.name)),_=o.transformTo("string",c.utf8encode(S.name)),M=S.comment,B=o.transformTo("string",R(M)),O=o.transformTo("string",c.utf8encode(M)),v=_.length!==S.name.length,F=O.length!==M.length,b="",Z="",z="",J=S.dir,X=S.date,ne={crc32:0,compressedSize:0,uncompressedSize:0};f&&!E||(ne.crc32=u.crc32,ne.compressedSize=u.compressedSize,ne.uncompressedSize=u.uncompressedSize);var V=0;f&&(V|=8),y||!v&&!F||(V|=2048);var Y=0,ie=0;J&&(Y|=16),T==="UNIX"?(ie=798,Y|=function(K,Fe){var ye=K;return K||(ye=Fe?16893:33204),(65535&ye)<<16}(S.unixPermissions,J)):(ie=20,Y|=function(K){return 63&(K||0)}(S.dosPermissions)),A=X.getUTCHours(),A<<=6,A|=X.getUTCMinutes(),A<<=5,A|=X.getUTCSeconds()/2,m=X.getUTCFullYear()-1980,m<<=4,m|=X.getUTCMonth()+1,m<<=5,m|=X.getUTCDate(),v&&(Z=n(1,1)+n(h(P),4)+_,b+="up"+n(Z.length,2)+Z),F&&(z=n(1,1)+n(h(B),4)+O,b+="uc"+n(z.length,2)+z);var ee="";return ee+=`
\0`,ee+=n(V,2),ee+=N.magic,ee+=n(A,2),ee+=n(m,2),ee+=n(ne.crc32,4),ee+=n(ne.compressedSize,4),ee+=n(ne.uncompressedSize,4),ee+=n(P.length,2),ee+=n(b.length,2),{fileRecord:I.LOCAL_FILE_HEADER+ee+P+b,dirRecord:I.CENTRAL_FILE_HEADER+n(ie,2)+ee+n(B.length,2)+"\0\0\0\0"+n(Y,4)+n(C,4)+P+b+B}}var o=t("../utils"),a=t("../stream/GenericWorker"),c=t("../utf8"),h=t("../crc32"),I=t("../signature");function d(u,f,E,C){a.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=f,this.zipPlatform=E,this.encodeFileName=C,this.streamFiles=u,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(d,a),d.prototype.push=function(u){var f=u.meta.percent||0,E=this.entriesCount,C=this._sources.length;this.accumulate?this.contentBuffer.push(u):(this.bytesWritten+=u.data.length,a.prototype.push.call(this,{data:u.data,meta:{currentFile:this.currentFile,percent:E?(f+100*(E-C-1))/E:100}}))},d.prototype.openedSource=function(u){this.currentSourceOffset=this.bytesWritten,this.currentFile=u.file.name;var f=this.streamFiles&&!u.file.dir;if(f){var E=r(u,f,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:E.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(u){this.accumulate=!1;var f=this.streamFiles&&!u.file.dir,E=r(u,f,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(E.dirRecord),f)this.push({data:function(C){return I.DATA_DESCRIPTOR+n(C.crc32,4)+n(C.compressedSize,4)+n(C.uncompressedSize,4)}(u),meta:{percent:100}});else for(this.push({data:E.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var u=this.bytesWritten,f=0;f<this.dirRecords.length;f++)this.push({data:this.dirRecords[f],meta:{percent:100}});var E=this.bytesWritten-u,C=function(T,R,A,m,S){var N=o.transformTo("string",S(m));return I.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(T,2)+n(T,2)+n(R,4)+n(A,4)+n(N.length,2)+N}(this.dirRecords.length,E,u,this.zipComment,this.encodeFileName);this.push({data:C,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(u){this._sources.push(u);var f=this;return u.on("data",function(E){f.processChunk(E)}),u.on("end",function(){f.closedSource(f.previous.streamInfo),f._sources.length?f.prepareNextSource():f.end()}),u.on("error",function(E){f.error(E)}),this},d.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(u){var f=this._sources;if(!a.prototype.error.call(this,u))return!1;for(var E=0;E<f.length;E++)try{f[E].error(u)}catch{}return!0},d.prototype.lock=function(){a.prototype.lock.call(this);for(var u=this._sources,f=0;f<u.length;f++)u[f].lock()},s.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,s,i){var n=t("../compressions"),r=t("./ZipFileWorker");i.generateWorker=function(o,a,c){var h=new r(a.streamFiles,c,a.platform,a.encodeFileName),I=0;try{o.forEach(function(d,u){I++;var f=function(R,A){var m=R||A,S=n[m];if(!S)throw new Error(m+" is not a valid compression method !");return S}(u.options.compression,a.compression),E=u.options.compressionOptions||a.compressionOptions||{},C=u.dir,T=u.date;u._compressWorker(f,E).withStreamInfo("file",{name:d,dir:C,date:T,comment:u.comment||"",unixPermissions:u.unixPermissions,dosPermissions:u.dosPermissions}).pipe(h)}),h.entriesCount=I}catch(d){h.error(d)}return h}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,s,i){function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var r=new n;for(var o in this)typeof this[o]!="function"&&(r[o]=this[o]);return r}}(n.prototype=t("./object")).loadAsync=t("./load"),n.support=t("./support"),n.defaults=t("./defaults"),n.version="3.10.1",n.loadAsync=function(r,o){return new n().loadAsync(r,o)},n.external=t("./external"),s.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,s,i){var n=t("./utils"),r=t("./external"),o=t("./utf8"),a=t("./zipEntries"),c=t("./stream/Crc32Probe"),h=t("./nodejsUtils");function I(d){return new r.Promise(function(u,f){var E=d.decompressed.getContentWorker().pipe(new c);E.on("error",function(C){f(C)}).on("end",function(){E.streamInfo.crc32!==d.decompressed.crc32?f(new Error("Corrupted zip : CRC32 mismatch")):u()}).resume()})}s.exports=function(d,u){var f=this;return u=n.extend(u||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),h.isNode&&h.isStream(d)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",d,!0,u.optimizedBinaryString,u.base64).then(function(E){var C=new a(u);return C.load(E),C}).then(function(E){var C=[r.Promise.resolve(E)],T=E.files;if(u.checkCRC32)for(var R=0;R<T.length;R++)C.push(I(T[R]));return r.Promise.all(C)}).then(function(E){for(var C=E.shift(),T=C.files,R=0;R<T.length;R++){var A=T[R],m=A.fileNameStr,S=n.resolve(A.fileNameStr);f.file(S,A.decompressed,{binary:!0,optimizedBinaryString:!0,date:A.date,dir:A.dir,comment:A.fileCommentStr.length?A.fileCommentStr:null,unixPermissions:A.unixPermissions,dosPermissions:A.dosPermissions,createFolders:u.createFolders}),A.dir||(f.file(S).unsafeOriginalName=m)}return C.zipComment.length&&(f.comment=C.zipComment),f})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,s,i){var n=t("../utils"),r=t("../stream/GenericWorker");function o(a,c){r.call(this,"Nodejs stream input adapter for "+a),this._upstreamEnded=!1,this._bindStream(c)}n.inherits(o,r),o.prototype._bindStream=function(a){var c=this;(this._stream=a).pause(),a.on("data",function(h){c.push({data:h,meta:{percent:0}})}).on("error",function(h){c.isPaused?this.generatedError=h:c.error(h)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},o.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},s.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,s,i){var n=t("readable-stream").Readable;function r(o,a,c){n.call(this,a),this._helper=o;var h=this;o.on("data",function(I,d){h.push(I)||h._helper.pause(),c&&c(d)}).on("error",function(I){h.emit("error",I)}).on("end",function(){h.push(null)})}t("../utils").inherits(r,n),r.prototype._read=function(){this._helper.resume()},s.exports=r},{"../utils":32,"readable-stream":16}],14:[function(t,s,i){s.exports={isNode:typeof Buffer<"u",newBufferFrom:function(n,r){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(n,r);if(typeof n=="number")throw new Error('The "data" argument must not be a number');return new Buffer(n,r)},allocBuffer:function(n){if(Buffer.alloc)return Buffer.alloc(n);var r=new Buffer(n);return r.fill(0),r},isBuffer:function(n){return Buffer.isBuffer(n)},isStream:function(n){return n&&typeof n.on=="function"&&typeof n.pause=="function"&&typeof n.resume=="function"}}},{}],15:[function(t,s,i){function n(S,N,y){var P,_=o.getTypeOf(N),M=o.extend(y||{},h);M.date=M.date||new Date,M.compression!==null&&(M.compression=M.compression.toUpperCase()),typeof M.unixPermissions=="string"&&(M.unixPermissions=parseInt(M.unixPermissions,8)),M.unixPermissions&&16384&M.unixPermissions&&(M.dir=!0),M.dosPermissions&&16&M.dosPermissions&&(M.dir=!0),M.dir&&(S=T(S)),M.createFolders&&(P=C(S))&&R.call(this,P,!0);var B=_==="string"&&M.binary===!1&&M.base64===!1;y&&y.binary!==void 0||(M.binary=!B),(N instanceof I&&N.uncompressedSize===0||M.dir||!N||N.length===0)&&(M.base64=!1,M.binary=!0,N="",M.compression="STORE",_="string");var O=null;O=N instanceof I||N instanceof a?N:f.isNode&&f.isStream(N)?new E(S,N):o.prepareContent(S,N,M.binary,M.optimizedBinaryString,M.base64);var v=new d(S,O,M);this.files[S]=v}var r=t("./utf8"),o=t("./utils"),a=t("./stream/GenericWorker"),c=t("./stream/StreamHelper"),h=t("./defaults"),I=t("./compressedObject"),d=t("./zipObject"),u=t("./generate"),f=t("./nodejsUtils"),E=t("./nodejs/NodejsStreamInputAdapter"),C=function(S){S.slice(-1)==="/"&&(S=S.substring(0,S.length-1));var N=S.lastIndexOf("/");return 0<N?S.substring(0,N):""},T=function(S){return S.slice(-1)!=="/"&&(S+="/"),S},R=function(S,N){return N=N!==void 0?N:h.createFolders,S=T(S),this.files[S]||n.call(this,S,null,{dir:!0,createFolders:N}),this.files[S]};function A(S){return Object.prototype.toString.call(S)==="[object RegExp]"}var m={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(S){var N,y,P;for(N in this.files)P=this.files[N],(y=N.slice(this.root.length,N.length))&&N.slice(0,this.root.length)===this.root&&S(y,P)},filter:function(S){var N=[];return this.forEach(function(y,P){S(y,P)&&N.push(P)}),N},file:function(S,N,y){if(arguments.length!==1)return S=this.root+S,n.call(this,S,N,y),this;if(A(S)){var P=S;return this.filter(function(M,B){return!B.dir&&P.test(M)})}var _=this.files[this.root+S];return _&&!_.dir?_:null},folder:function(S){if(!S)return this;if(A(S))return this.filter(function(_,M){return M.dir&&S.test(_)});var N=this.root+S,y=R.call(this,N),P=this.clone();return P.root=y.name,P},remove:function(S){S=this.root+S;var N=this.files[S];if(N||(S.slice(-1)!=="/"&&(S+="/"),N=this.files[S]),N&&!N.dir)delete this.files[S];else for(var y=this.filter(function(_,M){return M.name.slice(0,S.length)===S}),P=0;P<y.length;P++)delete this.files[y[P].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(S){var N,y={};try{if((y=o.extend(S||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=y.type.toLowerCase(),y.compression=y.compression.toUpperCase(),y.type==="binarystring"&&(y.type="string"),!y.type)throw new Error("No output type specified.");o.checkSupport(y.type),y.platform!=="darwin"&&y.platform!=="freebsd"&&y.platform!=="linux"&&y.platform!=="sunos"||(y.platform="UNIX"),y.platform==="win32"&&(y.platform="DOS");var P=y.comment||this.comment||"";N=u.generateWorker(this,y,P)}catch(_){(N=new a("error")).error(_)}return new c(N,y.type||"string",y.mimeType)},generateAsync:function(S,N){return this.generateInternalStream(S).accumulate(N)},generateNodeStream:function(S,N){return(S=S||{}).type||(S.type="nodebuffer"),this.generateInternalStream(S).toNodejsStream(N)}};s.exports=m},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,s,i){s.exports=t("stream")},{stream:void 0}],17:[function(t,s,i){var n=t("./DataReader");function r(o){n.call(this,o);for(var a=0;a<this.data.length;a++)o[a]=255&o[a]}t("../utils").inherits(r,n),r.prototype.byteAt=function(o){return this.data[this.zero+o]},r.prototype.lastIndexOfSignature=function(o){for(var a=o.charCodeAt(0),c=o.charCodeAt(1),h=o.charCodeAt(2),I=o.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===a&&this.data[d+1]===c&&this.data[d+2]===h&&this.data[d+3]===I)return d-this.zero;return-1},r.prototype.readAndCheckSignature=function(o){var a=o.charCodeAt(0),c=o.charCodeAt(1),h=o.charCodeAt(2),I=o.charCodeAt(3),d=this.readData(4);return a===d[0]&&c===d[1]&&h===d[2]&&I===d[3]},r.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var a=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},s.exports=r},{"../utils":32,"./DataReader":18}],18:[function(t,s,i){var n=t("../utils");function r(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var a,c=0;for(this.checkOffset(o),a=this.index+o-1;a>=this.index;a--)c=(c<<8)+this.byteAt(a);return this.index+=o,c},readString:function(o){return n.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},s.exports=r},{"../utils":32}],19:[function(t,s,i){var n=t("./Uint8ArrayReader");function r(o){n.call(this,o)}t("../utils").inherits(r,n),r.prototype.readData=function(o){this.checkOffset(o);var a=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},s.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,s,i){var n=t("./DataReader");function r(o){n.call(this,o)}t("../utils").inherits(r,n),r.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},r.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},r.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},r.prototype.readData=function(o){this.checkOffset(o);var a=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},s.exports=r},{"../utils":32,"./DataReader":18}],21:[function(t,s,i){var n=t("./ArrayReader");function r(o){n.call(this,o)}t("../utils").inherits(r,n),r.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var a=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},s.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(t,s,i){var n=t("../utils"),r=t("../support"),o=t("./ArrayReader"),a=t("./StringReader"),c=t("./NodeBufferReader"),h=t("./Uint8ArrayReader");s.exports=function(I){var d=n.getTypeOf(I);return n.checkSupport(d),d!=="string"||r.uint8array?d==="nodebuffer"?new c(I):r.uint8array?new h(n.transformTo("uint8array",I)):new o(n.transformTo("array",I)):new a(I)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,s,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,s,i){var n=t("./GenericWorker"),r=t("../utils");function o(a){n.call(this,"ConvertWorker to "+a),this.destType=a}r.inherits(o,n),o.prototype.processChunk=function(a){this.push({data:r.transformTo(this.destType,a.data),meta:a.meta})},s.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(t,s,i){var n=t("./GenericWorker"),r=t("../crc32");function o(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(o,n),o.prototype.processChunk=function(a){this.streamInfo.crc32=r(a.data,this.streamInfo.crc32||0),this.push(a)},s.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,s,i){var n=t("../utils"),r=t("./GenericWorker");function o(a){r.call(this,"DataLengthProbe for "+a),this.propName=a,this.withStreamInfo(a,0)}n.inherits(o,r),o.prototype.processChunk=function(a){if(a){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+a.data.length}r.prototype.processChunk.call(this,a)},s.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(t,s,i){var n=t("../utils"),r=t("./GenericWorker");function o(a){r.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,a.then(function(h){c.dataIsReady=!0,c.data=h,c.max=h&&h.length||0,c.type=n.getTypeOf(h),c.isPaused||c._tickAndRepeat()},function(h){c.error(h)})}n.inherits(o,r),o.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var a=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":a=this.data.substring(this.index,c);break;case"uint8array":a=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":a=this.data.slice(this.index,c)}return this.index=c,this.push({data:a,meta:{percent:this.max?this.index/this.max*100:0}})},s.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(t,s,i){function n(r){this.name=r||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(r){this.emit("data",r)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(r){this.emit("error",r)}return!0},error:function(r){return!this.isFinished&&(this.isPaused?this.generatedError=r:(this.isFinished=!0,this.emit("error",r),this.previous&&this.previous.error(r),this.cleanUp()),!0)},on:function(r,o){return this._listeners[r].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(r,o){if(this._listeners[r])for(var a=0;a<this._listeners[r].length;a++)this._listeners[r][a].call(this,o)},pipe:function(r){return r.registerPrevious(this)},registerPrevious:function(r){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=r.streamInfo,this.mergeStreamInfo(),this.previous=r;var o=this;return r.on("data",function(a){o.processChunk(a)}),r.on("end",function(){o.end()}),r.on("error",function(a){o.error(a)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var r=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),r=!0),this.previous&&this.previous.resume(),!r},flush:function(){},processChunk:function(r){this.push(r)},withStreamInfo:function(r,o){return this.extraStreamInfo[r]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var r in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,r)&&(this.streamInfo[r]=this.extraStreamInfo[r])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var r="Worker "+this.name;return this.previous?this.previous+" -> "+r:r}},s.exports=n},{}],29:[function(t,s,i){var n=t("../utils"),r=t("./ConvertWorker"),o=t("./GenericWorker"),a=t("../base64"),c=t("../support"),h=t("../external"),I=null;if(c.nodestream)try{I=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(f,E){return new h.Promise(function(C,T){var R=[],A=f._internalType,m=f._outputType,S=f._mimeType;f.on("data",function(N,y){R.push(N),E&&E(y)}).on("error",function(N){R=[],T(N)}).on("end",function(){try{var N=function(y,P,_){switch(y){case"blob":return n.newBlob(n.transformTo("arraybuffer",P),_);case"base64":return a.encode(P);default:return n.transformTo(y,P)}}(m,function(y,P){var _,M=0,B=null,O=0;for(_=0;_<P.length;_++)O+=P[_].length;switch(y){case"string":return P.join("");case"array":return Array.prototype.concat.apply([],P);case"uint8array":for(B=new Uint8Array(O),_=0;_<P.length;_++)B.set(P[_],M),M+=P[_].length;return B;case"nodebuffer":return Buffer.concat(P);default:throw new Error("concat : unsupported type '"+y+"'")}}(A,R),S);C(N)}catch(y){T(y)}R=[]}).resume()})}function u(f,E,C){var T=E;switch(E){case"blob":case"arraybuffer":T="uint8array";break;case"base64":T="string"}try{this._internalType=T,this._outputType=E,this._mimeType=C,n.checkSupport(T),this._worker=f.pipe(new r(T)),f.lock()}catch(R){this._worker=new o("error"),this._worker.error(R)}}u.prototype={accumulate:function(f){return d(this,f)},on:function(f,E){var C=this;return f==="data"?this._worker.on(f,function(T){E.call(C,T.data,T.meta)}):this._worker.on(f,function(){n.delay(E,arguments,C)}),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(f){if(n.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new I(this,{objectMode:this._outputType!=="nodebuffer"},f)}},s.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,s,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var n=new ArrayBuffer(0);try{i.blob=new Blob([n],{type:"application/zip"}).size===0}catch{try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(n),i.blob=r.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!t("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(t,s,i){for(var n=t("./utils"),r=t("./support"),o=t("./nodejsUtils"),a=t("./stream/GenericWorker"),c=new Array(256),h=0;h<256;h++)c[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;c[254]=c[254]=1;function I(){a.call(this,"utf-8 decode"),this.leftOver=null}function d(){a.call(this,"utf-8 encode")}i.utf8encode=function(u){return r.nodebuffer?o.newBufferFrom(u,"utf-8"):function(f){var E,C,T,R,A,m=f.length,S=0;for(R=0;R<m;R++)(64512&(C=f.charCodeAt(R)))==55296&&R+1<m&&(64512&(T=f.charCodeAt(R+1)))==56320&&(C=65536+(C-55296<<10)+(T-56320),R++),S+=C<128?1:C<2048?2:C<65536?3:4;for(E=r.uint8array?new Uint8Array(S):new Array(S),R=A=0;A<S;R++)(64512&(C=f.charCodeAt(R)))==55296&&R+1<m&&(64512&(T=f.charCodeAt(R+1)))==56320&&(C=65536+(C-55296<<10)+(T-56320),R++),C<128?E[A++]=C:(C<2048?E[A++]=192|C>>>6:(C<65536?E[A++]=224|C>>>12:(E[A++]=240|C>>>18,E[A++]=128|C>>>12&63),E[A++]=128|C>>>6&63),E[A++]=128|63&C);return E}(u)},i.utf8decode=function(u){return r.nodebuffer?n.transformTo("nodebuffer",u).toString("utf-8"):function(f){var E,C,T,R,A=f.length,m=new Array(2*A);for(E=C=0;E<A;)if((T=f[E++])<128)m[C++]=T;else if(4<(R=c[T]))m[C++]=65533,E+=R-1;else{for(T&=R===2?31:R===3?15:7;1<R&&E<A;)T=T<<6|63&f[E++],R--;1<R?m[C++]=65533:T<65536?m[C++]=T:(T-=65536,m[C++]=55296|T>>10&1023,m[C++]=56320|1023&T)}return m.length!==C&&(m.subarray?m=m.subarray(0,C):m.length=C),n.applyFromCharCode(m)}(u=n.transformTo(r.uint8array?"uint8array":"array",u))},n.inherits(I,a),I.prototype.processChunk=function(u){var f=n.transformTo(r.uint8array?"uint8array":"array",u.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var E=f;(f=new Uint8Array(E.length+this.leftOver.length)).set(this.leftOver,0),f.set(E,this.leftOver.length)}else f=this.leftOver.concat(f);this.leftOver=null}var C=function(R,A){var m;for((A=A||R.length)>R.length&&(A=R.length),m=A-1;0<=m&&(192&R[m])==128;)m--;return m<0||m===0?A:m+c[R[m]]>A?m:A}(f),T=f;C!==f.length&&(r.uint8array?(T=f.subarray(0,C),this.leftOver=f.subarray(C,f.length)):(T=f.slice(0,C),this.leftOver=f.slice(C,f.length))),this.push({data:i.utf8decode(T),meta:u.meta})},I.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=I,n.inherits(d,a),d.prototype.processChunk=function(u){this.push({data:i.utf8encode(u.data),meta:u.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,s,i){var n=t("./support"),r=t("./base64"),o=t("./nodejsUtils"),a=t("./external");function c(E){return E}function h(E,C){for(var T=0;T<E.length;++T)C[T]=255&E.charCodeAt(T);return C}t("setimmediate"),i.newBlob=function(E,C){i.checkSupport("blob");try{return new Blob([E],{type:C})}catch{try{var T=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return T.append(E),T.getBlob(C)}catch{throw new Error("Bug : can't construct the Blob.")}}};var I={stringifyByChunk:function(E,C,T){var R=[],A=0,m=E.length;if(m<=T)return String.fromCharCode.apply(null,E);for(;A<m;)C==="array"||C==="nodebuffer"?R.push(String.fromCharCode.apply(null,E.slice(A,Math.min(A+T,m)))):R.push(String.fromCharCode.apply(null,E.subarray(A,Math.min(A+T,m)))),A+=T;return R.join("")},stringifyByChar:function(E){for(var C="",T=0;T<E.length;T++)C+=String.fromCharCode(E[T]);return C},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function d(E){var C=65536,T=i.getTypeOf(E),R=!0;if(T==="uint8array"?R=I.applyCanBeUsed.uint8array:T==="nodebuffer"&&(R=I.applyCanBeUsed.nodebuffer),R)for(;1<C;)try{return I.stringifyByChunk(E,T,C)}catch{C=Math.floor(C/2)}return I.stringifyByChar(E)}function u(E,C){for(var T=0;T<E.length;T++)C[T]=E[T];return C}i.applyFromCharCode=d;var f={};f.string={string:c,array:function(E){return h(E,new Array(E.length))},arraybuffer:function(E){return f.string.uint8array(E).buffer},uint8array:function(E){return h(E,new Uint8Array(E.length))},nodebuffer:function(E){return h(E,o.allocBuffer(E.length))}},f.array={string:d,array:c,arraybuffer:function(E){return new Uint8Array(E).buffer},uint8array:function(E){return new Uint8Array(E)},nodebuffer:function(E){return o.newBufferFrom(E)}},f.arraybuffer={string:function(E){return d(new Uint8Array(E))},array:function(E){return u(new Uint8Array(E),new Array(E.byteLength))},arraybuffer:c,uint8array:function(E){return new Uint8Array(E)},nodebuffer:function(E){return o.newBufferFrom(new Uint8Array(E))}},f.uint8array={string:d,array:function(E){return u(E,new Array(E.length))},arraybuffer:function(E){return E.buffer},uint8array:c,nodebuffer:function(E){return o.newBufferFrom(E)}},f.nodebuffer={string:d,array:function(E){return u(E,new Array(E.length))},arraybuffer:function(E){return f.nodebuffer.uint8array(E).buffer},uint8array:function(E){return u(E,new Uint8Array(E.length))},nodebuffer:c},i.transformTo=function(E,C){if(C=C||"",!E)return C;i.checkSupport(E);var T=i.getTypeOf(C);return f[T][E](C)},i.resolve=function(E){for(var C=E.split("/"),T=[],R=0;R<C.length;R++){var A=C[R];A==="."||A===""&&R!==0&&R!==C.length-1||(A===".."?T.pop():T.push(A))}return T.join("/")},i.getTypeOf=function(E){return typeof E=="string"?"string":Object.prototype.toString.call(E)==="[object Array]"?"array":n.nodebuffer&&o.isBuffer(E)?"nodebuffer":n.uint8array&&E instanceof Uint8Array?"uint8array":n.arraybuffer&&E instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(E){if(!n[E.toLowerCase()])throw new Error(E+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(E){var C,T,R="";for(T=0;T<(E||"").length;T++)R+="\\x"+((C=E.charCodeAt(T))<16?"0":"")+C.toString(16).toUpperCase();return R},i.delay=function(E,C,T){setImmediate(function(){E.apply(T||null,C||[])})},i.inherits=function(E,C){function T(){}T.prototype=C.prototype,E.prototype=new T},i.extend=function(){var E,C,T={};for(E=0;E<arguments.length;E++)for(C in arguments[E])Object.prototype.hasOwnProperty.call(arguments[E],C)&&T[C]===void 0&&(T[C]=arguments[E][C]);return T},i.prepareContent=function(E,C,T,R,A){return a.Promise.resolve(C).then(function(m){return n.blob&&(m instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(m))!==-1)&&typeof FileReader<"u"?new a.Promise(function(S,N){var y=new FileReader;y.onload=function(P){S(P.target.result)},y.onerror=function(P){N(P.target.error)},y.readAsArrayBuffer(m)}):m}).then(function(m){var S=i.getTypeOf(m);return S?(S==="arraybuffer"?m=i.transformTo("uint8array",m):S==="string"&&(A?m=r.decode(m):T&&R!==!0&&(m=function(N){return h(N,n.uint8array?new Uint8Array(N.length):new Array(N.length))}(m))),m):a.Promise.reject(new Error("Can't read the data of '"+E+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,s,i){var n=t("./reader/readerFor"),r=t("./utils"),o=t("./signature"),a=t("./zipEntry"),c=t("./support");function h(I){this.files=[],this.loadOptions=I}h.prototype={checkSignature:function(I){if(!this.reader.readAndCheckSignature(I)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(d)+", expected "+r.pretty(I)+")")}},isSignature:function(I,d){var u=this.reader.index;this.reader.setIndex(I);var f=this.reader.readString(4)===d;return this.reader.setIndex(u),f},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var I=this.reader.readData(this.zipCommentLength),d=c.uint8array?"uint8array":"array",u=r.transformTo(d,I);this.zipComment=this.loadOptions.decodeFileName(u)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var I,d,u,f=this.zip64EndOfCentralSize-44;0<f;)I=this.reader.readInt(2),d=this.reader.readInt(4),u=this.reader.readData(d),this.zip64ExtensibleData[I]={id:I,length:d,value:u}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var I,d;for(I=0;I<this.files.length;I++)d=this.files[I],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var I;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(I=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(I);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var I=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(I<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(I);var d=I;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(I=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(I),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var u=this.centralDirOffset+this.centralDirSize;this.zip64&&(u+=20,u+=12+this.zip64EndOfCentralSize);var f=d-u;if(0<f)this.isSignature(d,o.CENTRAL_FILE_HEADER)||(this.reader.zero=f);else if(f<0)throw new Error("Corrupted zip: missing "+Math.abs(f)+" bytes.")},prepareReader:function(I){this.reader=n(I)},load:function(I){this.prepareReader(I),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},s.exports=h},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,s,i){var n=t("./reader/readerFor"),r=t("./utils"),o=t("./compressedObject"),a=t("./crc32"),c=t("./utf8"),h=t("./compressions"),I=t("./support");function d(u,f){this.options=u,this.loadOptions=f}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(u){var f,E;if(u.skip(22),this.fileNameLength=u.readInt(2),E=u.readInt(2),this.fileName=u.readData(this.fileNameLength),u.skip(E),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((f=function(C){for(var T in h)if(Object.prototype.hasOwnProperty.call(h,T)&&h[T].magic===C)return h[T];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,f,u.readData(this.compressedSize))},readCentralPart:function(u){this.versionMadeBy=u.readInt(2),u.skip(2),this.bitFlag=u.readInt(2),this.compressionMethod=u.readString(2),this.date=u.readDate(),this.crc32=u.readInt(4),this.compressedSize=u.readInt(4),this.uncompressedSize=u.readInt(4);var f=u.readInt(2);if(this.extraFieldsLength=u.readInt(2),this.fileCommentLength=u.readInt(2),this.diskNumberStart=u.readInt(2),this.internalFileAttributes=u.readInt(2),this.externalFileAttributes=u.readInt(4),this.localHeaderOffset=u.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");u.skip(f),this.readExtraFields(u),this.parseZIP64ExtraField(u),this.fileComment=u.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var u=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),u==0&&(this.dosPermissions=63&this.externalFileAttributes),u==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var u=n(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=u.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=u.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=u.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=u.readInt(4))}},readExtraFields:function(u){var f,E,C,T=u.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});u.index+4<T;)f=u.readInt(2),E=u.readInt(2),C=u.readData(E),this.extraFields[f]={id:f,length:E,value:C};u.setIndex(T)},handleUTF8:function(){var u=I.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var f=this.findExtraFieldUnicodePath();if(f!==null)this.fileNameStr=f;else{var E=r.transformTo(u,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(E)}var C=this.findExtraFieldUnicodeComment();if(C!==null)this.fileCommentStr=C;else{var T=r.transformTo(u,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(T)}}},findExtraFieldUnicodePath:function(){var u=this.extraFields[28789];if(u){var f=n(u.value);return f.readInt(1)!==1||a(this.fileName)!==f.readInt(4)?null:c.utf8decode(f.readData(u.length-5))}return null},findExtraFieldUnicodeComment:function(){var u=this.extraFields[25461];if(u){var f=n(u.value);return f.readInt(1)!==1||a(this.fileComment)!==f.readInt(4)?null:c.utf8decode(f.readData(u.length-5))}return null}},s.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,s,i){function n(f,E,C){this.name=f,this.dir=C.dir,this.date=C.date,this.comment=C.comment,this.unixPermissions=C.unixPermissions,this.dosPermissions=C.dosPermissions,this._data=E,this._dataBinary=C.binary,this.options={compression:C.compression,compressionOptions:C.compressionOptions}}var r=t("./stream/StreamHelper"),o=t("./stream/DataWorker"),a=t("./utf8"),c=t("./compressedObject"),h=t("./stream/GenericWorker");n.prototype={internalStream:function(f){var E=null,C="string";try{if(!f)throw new Error("No output type specified.");var T=(C=f.toLowerCase())==="string"||C==="text";C!=="binarystring"&&C!=="text"||(C="string"),E=this._decompressWorker();var R=!this._dataBinary;R&&!T&&(E=E.pipe(new a.Utf8EncodeWorker)),!R&&T&&(E=E.pipe(new a.Utf8DecodeWorker))}catch(A){(E=new h("error")).error(A)}return new r(E,C,"")},async:function(f,E){return this.internalStream(f).accumulate(E)},nodeStream:function(f,E){return this.internalStream(f||"nodebuffer").toNodejsStream(E)},_compressWorker:function(f,E){if(this._data instanceof c&&this._data.compression.magic===f.magic)return this._data.getCompressedWorker();var C=this._decompressWorker();return this._dataBinary||(C=C.pipe(new a.Utf8EncodeWorker)),c.createWorkerFrom(C,f,E)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof h?this._data:new o(this._data)}};for(var I=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<I.length;u++)n.prototype[I[u]]=d;s.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,s,i){(function(n){var r,o,a=n.MutationObserver||n.WebKitMutationObserver;if(a){var c=0,h=new a(f),I=n.document.createTextNode("");h.observe(I,{characterData:!0}),r=function(){I.data=c=++c%2}}else if(n.setImmediate||n.MessageChannel===void 0)r="document"in n&&"onreadystatechange"in n.document.createElement("script")?function(){var E=n.document.createElement("script");E.onreadystatechange=function(){f(),E.onreadystatechange=null,E.parentNode.removeChild(E),E=null},n.document.documentElement.appendChild(E)}:function(){setTimeout(f,0)};else{var d=new n.MessageChannel;d.port1.onmessage=f,r=function(){d.port2.postMessage(0)}}var u=[];function f(){var E,C;o=!0;for(var T=u.length;T;){for(C=u,u=[],E=-1;++E<T;)C[E]();T=u.length}o=!1}s.exports=function(E){u.push(E)!==1||o||r()}}).call(this,typeof Ti<"u"?Ti:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,s,i){var n=t("immediate");function r(){}var o={},a=["REJECTED"],c=["FULFILLED"],h=["PENDING"];function I(T){if(typeof T!="function")throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,T!==r&&E(this,T)}function d(T,R,A){this.promise=T,typeof R=="function"&&(this.onFulfilled=R,this.callFulfilled=this.otherCallFulfilled),typeof A=="function"&&(this.onRejected=A,this.callRejected=this.otherCallRejected)}function u(T,R,A){n(function(){var m;try{m=R(A)}catch(S){return o.reject(T,S)}m===T?o.reject(T,new TypeError("Cannot resolve promise with itself")):o.resolve(T,m)})}function f(T){var R=T&&T.then;if(T&&(typeof T=="object"||typeof T=="function")&&typeof R=="function")return function(){R.apply(T,arguments)}}function E(T,R){var A=!1;function m(y){A||(A=!0,o.reject(T,y))}function S(y){A||(A=!0,o.resolve(T,y))}var N=C(function(){R(S,m)});N.status==="error"&&m(N.value)}function C(T,R){var A={};try{A.value=T(R),A.status="success"}catch(m){A.status="error",A.value=m}return A}(s.exports=I).prototype.finally=function(T){if(typeof T!="function")return this;var R=this.constructor;return this.then(function(A){return R.resolve(T()).then(function(){return A})},function(A){return R.resolve(T()).then(function(){throw A})})},I.prototype.catch=function(T){return this.then(null,T)},I.prototype.then=function(T,R){if(typeof T!="function"&&this.state===c||typeof R!="function"&&this.state===a)return this;var A=new this.constructor(r);return this.state!==h?u(A,this.state===c?T:R,this.outcome):this.queue.push(new d(A,T,R)),A},d.prototype.callFulfilled=function(T){o.resolve(this.promise,T)},d.prototype.otherCallFulfilled=function(T){u(this.promise,this.onFulfilled,T)},d.prototype.callRejected=function(T){o.reject(this.promise,T)},d.prototype.otherCallRejected=function(T){u(this.promise,this.onRejected,T)},o.resolve=function(T,R){var A=C(f,R);if(A.status==="error")return o.reject(T,A.value);var m=A.value;if(m)E(T,m);else{T.state=c,T.outcome=R;for(var S=-1,N=T.queue.length;++S<N;)T.queue[S].callFulfilled(R)}return T},o.reject=function(T,R){T.state=a,T.outcome=R;for(var A=-1,m=T.queue.length;++A<m;)T.queue[A].callRejected(R);return T},I.resolve=function(T){return T instanceof this?T:o.resolve(new this(r),T)},I.reject=function(T){var R=new this(r);return o.reject(R,T)},I.all=function(T){var R=this;if(Object.prototype.toString.call(T)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=T.length,m=!1;if(!A)return this.resolve([]);for(var S=new Array(A),N=0,y=-1,P=new this(r);++y<A;)_(T[y],y);return P;function _(M,B){R.resolve(M).then(function(O){S[B]=O,++N!==A||m||(m=!0,o.resolve(P,S))},function(O){m||(m=!0,o.reject(P,O))})}},I.race=function(T){var R=this;if(Object.prototype.toString.call(T)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=T.length,m=!1;if(!A)return this.resolve([]);for(var S=-1,N=new this(r);++S<A;)y=T[S],R.resolve(y).then(function(P){m||(m=!0,o.resolve(N,P))},function(P){m||(m=!0,o.reject(N,P))});var y;return N}},{immediate:36}],38:[function(t,s,i){var n={};(0,t("./lib/utils/common").assign)(n,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),s.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,s,i){var n=t("./zlib/deflate"),r=t("./utils/common"),o=t("./utils/strings"),a=t("./zlib/messages"),c=t("./zlib/zstream"),h=Object.prototype.toString,I=0,d=-1,u=0,f=8;function E(T){if(!(this instanceof E))return new E(T);this.options=r.assign({level:d,method:f,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},T||{});var R=this.options;R.raw&&0<R.windowBits?R.windowBits=-R.windowBits:R.gzip&&0<R.windowBits&&R.windowBits<16&&(R.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var A=n.deflateInit2(this.strm,R.level,R.method,R.windowBits,R.memLevel,R.strategy);if(A!==I)throw new Error(a[A]);if(R.header&&n.deflateSetHeader(this.strm,R.header),R.dictionary){var m;if(m=typeof R.dictionary=="string"?o.string2buf(R.dictionary):h.call(R.dictionary)==="[object ArrayBuffer]"?new Uint8Array(R.dictionary):R.dictionary,(A=n.deflateSetDictionary(this.strm,m))!==I)throw new Error(a[A]);this._dict_set=!0}}function C(T,R){var A=new E(R);if(A.push(T,!0),A.err)throw A.msg||a[A.err];return A.result}E.prototype.push=function(T,R){var A,m,S=this.strm,N=this.options.chunkSize;if(this.ended)return!1;m=R===~~R?R:R===!0?4:0,typeof T=="string"?S.input=o.string2buf(T):h.call(T)==="[object ArrayBuffer]"?S.input=new Uint8Array(T):S.input=T,S.next_in=0,S.avail_in=S.input.length;do{if(S.avail_out===0&&(S.output=new r.Buf8(N),S.next_out=0,S.avail_out=N),(A=n.deflate(S,m))!==1&&A!==I)return this.onEnd(A),!(this.ended=!0);S.avail_out!==0&&(S.avail_in!==0||m!==4&&m!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(r.shrinkBuf(S.output,S.next_out))):this.onData(r.shrinkBuf(S.output,S.next_out)))}while((0<S.avail_in||S.avail_out===0)&&A!==1);return m===4?(A=n.deflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===I):m!==2||(this.onEnd(I),!(S.avail_out=0))},E.prototype.onData=function(T){this.chunks.push(T)},E.prototype.onEnd=function(T){T===I&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=T,this.msg=this.strm.msg},i.Deflate=E,i.deflate=C,i.deflateRaw=function(T,R){return(R=R||{}).raw=!0,C(T,R)},i.gzip=function(T,R){return(R=R||{}).gzip=!0,C(T,R)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,s,i){var n=t("./zlib/inflate"),r=t("./utils/common"),o=t("./utils/strings"),a=t("./zlib/constants"),c=t("./zlib/messages"),h=t("./zlib/zstream"),I=t("./zlib/gzheader"),d=Object.prototype.toString;function u(E){if(!(this instanceof u))return new u(E);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},E||{});var C=this.options;C.raw&&0<=C.windowBits&&C.windowBits<16&&(C.windowBits=-C.windowBits,C.windowBits===0&&(C.windowBits=-15)),!(0<=C.windowBits&&C.windowBits<16)||E&&E.windowBits||(C.windowBits+=32),15<C.windowBits&&C.windowBits<48&&!(15&C.windowBits)&&(C.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var T=n.inflateInit2(this.strm,C.windowBits);if(T!==a.Z_OK)throw new Error(c[T]);this.header=new I,n.inflateGetHeader(this.strm,this.header)}function f(E,C){var T=new u(C);if(T.push(E,!0),T.err)throw T.msg||c[T.err];return T.result}u.prototype.push=function(E,C){var T,R,A,m,S,N,y=this.strm,P=this.options.chunkSize,_=this.options.dictionary,M=!1;if(this.ended)return!1;R=C===~~C?C:C===!0?a.Z_FINISH:a.Z_NO_FLUSH,typeof E=="string"?y.input=o.binstring2buf(E):d.call(E)==="[object ArrayBuffer]"?y.input=new Uint8Array(E):y.input=E,y.next_in=0,y.avail_in=y.input.length;do{if(y.avail_out===0&&(y.output=new r.Buf8(P),y.next_out=0,y.avail_out=P),(T=n.inflate(y,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&_&&(N=typeof _=="string"?o.string2buf(_):d.call(_)==="[object ArrayBuffer]"?new Uint8Array(_):_,T=n.inflateSetDictionary(this.strm,N)),T===a.Z_BUF_ERROR&&M===!0&&(T=a.Z_OK,M=!1),T!==a.Z_STREAM_END&&T!==a.Z_OK)return this.onEnd(T),!(this.ended=!0);y.next_out&&(y.avail_out!==0&&T!==a.Z_STREAM_END&&(y.avail_in!==0||R!==a.Z_FINISH&&R!==a.Z_SYNC_FLUSH)||(this.options.to==="string"?(A=o.utf8border(y.output,y.next_out),m=y.next_out-A,S=o.buf2string(y.output,A),y.next_out=m,y.avail_out=P-m,m&&r.arraySet(y.output,y.output,A,m,0),this.onData(S)):this.onData(r.shrinkBuf(y.output,y.next_out)))),y.avail_in===0&&y.avail_out===0&&(M=!0)}while((0<y.avail_in||y.avail_out===0)&&T!==a.Z_STREAM_END);return T===a.Z_STREAM_END&&(R=a.Z_FINISH),R===a.Z_FINISH?(T=n.inflateEnd(this.strm),this.onEnd(T),this.ended=!0,T===a.Z_OK):R!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),!(y.avail_out=0))},u.prototype.onData=function(E){this.chunks.push(E)},u.prototype.onEnd=function(E){E===a.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=E,this.msg=this.strm.msg},i.Inflate=u,i.inflate=f,i.inflateRaw=function(E,C){return(C=C||{}).raw=!0,f(E,C)},i.ungzip=f},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,s,i){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(a){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var h=c.shift();if(h){if(typeof h!="object")throw new TypeError(h+"must be non-object");for(var I in h)h.hasOwnProperty(I)&&(a[I]=h[I])}}return a},i.shrinkBuf=function(a,c){return a.length===c?a:a.subarray?a.subarray(0,c):(a.length=c,a)};var r={arraySet:function(a,c,h,I,d){if(c.subarray&&a.subarray)a.set(c.subarray(h,h+I),d);else for(var u=0;u<I;u++)a[d+u]=c[h+u]},flattenChunks:function(a){var c,h,I,d,u,f;for(c=I=0,h=a.length;c<h;c++)I+=a[c].length;for(f=new Uint8Array(I),c=d=0,h=a.length;c<h;c++)u=a[c],f.set(u,d),d+=u.length;return f}},o={arraySet:function(a,c,h,I,d){for(var u=0;u<I;u++)a[d+u]=c[h+u]},flattenChunks:function(a){return[].concat.apply([],a)}};i.setTyped=function(a){a?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,r)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,o))},i.setTyped(n)},{}],42:[function(t,s,i){var n=t("./common"),r=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var a=new n.Buf8(256),c=0;c<256;c++)a[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function h(I,d){if(d<65537&&(I.subarray&&o||!I.subarray&&r))return String.fromCharCode.apply(null,n.shrinkBuf(I,d));for(var u="",f=0;f<d;f++)u+=String.fromCharCode(I[f]);return u}a[254]=a[254]=1,i.string2buf=function(I){var d,u,f,E,C,T=I.length,R=0;for(E=0;E<T;E++)(64512&(u=I.charCodeAt(E)))==55296&&E+1<T&&(64512&(f=I.charCodeAt(E+1)))==56320&&(u=65536+(u-55296<<10)+(f-56320),E++),R+=u<128?1:u<2048?2:u<65536?3:4;for(d=new n.Buf8(R),E=C=0;C<R;E++)(64512&(u=I.charCodeAt(E)))==55296&&E+1<T&&(64512&(f=I.charCodeAt(E+1)))==56320&&(u=65536+(u-55296<<10)+(f-56320),E++),u<128?d[C++]=u:(u<2048?d[C++]=192|u>>>6:(u<65536?d[C++]=224|u>>>12:(d[C++]=240|u>>>18,d[C++]=128|u>>>12&63),d[C++]=128|u>>>6&63),d[C++]=128|63&u);return d},i.buf2binstring=function(I){return h(I,I.length)},i.binstring2buf=function(I){for(var d=new n.Buf8(I.length),u=0,f=d.length;u<f;u++)d[u]=I.charCodeAt(u);return d},i.buf2string=function(I,d){var u,f,E,C,T=d||I.length,R=new Array(2*T);for(u=f=0;u<T;)if((E=I[u++])<128)R[f++]=E;else if(4<(C=a[E]))R[f++]=65533,u+=C-1;else{for(E&=C===2?31:C===3?15:7;1<C&&u<T;)E=E<<6|63&I[u++],C--;1<C?R[f++]=65533:E<65536?R[f++]=E:(E-=65536,R[f++]=55296|E>>10&1023,R[f++]=56320|1023&E)}return h(R,f)},i.utf8border=function(I,d){var u;for((d=d||I.length)>I.length&&(d=I.length),u=d-1;0<=u&&(192&I[u])==128;)u--;return u<0||u===0?d:u+a[I[u]]>d?u:d}},{"./common":41}],43:[function(t,s,i){s.exports=function(n,r,o,a){for(var c=65535&n|0,h=n>>>16&65535|0,I=0;o!==0;){for(o-=I=2e3<o?2e3:o;h=h+(c=c+r[a++]|0)|0,--I;);c%=65521,h%=65521}return c|h<<16|0}},{}],44:[function(t,s,i){s.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,s,i){var n=function(){for(var r,o=[],a=0;a<256;a++){r=a;for(var c=0;c<8;c++)r=1&r?3988292384^r>>>1:r>>>1;o[a]=r}return o}();s.exports=function(r,o,a,c){var h=n,I=c+a;r^=-1;for(var d=c;d<I;d++)r=r>>>8^h[255&(r^o[d])];return-1^r}},{}],46:[function(t,s,i){var n,r=t("../utils/common"),o=t("./trees"),a=t("./adler32"),c=t("./crc32"),h=t("./messages"),I=0,d=4,u=0,f=-2,E=-1,C=4,T=2,R=8,A=9,m=286,S=30,N=19,y=2*m+1,P=15,_=3,M=258,B=M+_+1,O=42,v=113,F=1,b=2,Z=3,z=4;function J(g,H){return g.msg=h[H],H}function X(g){return(g<<1)-(4<g?9:0)}function ne(g){for(var H=g.length;0<=--H;)g[H]=0}function V(g){var H=g.state,G=H.pending;G>g.avail_out&&(G=g.avail_out),G!==0&&(r.arraySet(g.output,H.pending_buf,H.pending_out,G,g.next_out),g.next_out+=G,H.pending_out+=G,g.total_out+=G,g.avail_out-=G,H.pending-=G,H.pending===0&&(H.pending_out=0))}function Y(g,H){o._tr_flush_block(g,0<=g.block_start?g.block_start:-1,g.strstart-g.block_start,H),g.block_start=g.strstart,V(g.strm)}function ie(g,H){g.pending_buf[g.pending++]=H}function ee(g,H){g.pending_buf[g.pending++]=H>>>8&255,g.pending_buf[g.pending++]=255&H}function K(g,H){var G,w,L=g.max_chain_length,D=g.strstart,W=g.prev_length,j=g.nice_match,x=g.strstart>g.w_size-B?g.strstart-(g.w_size-B):0,q=g.window,te=g.w_mask,Q=g.prev,oe=g.strstart+M,Te=q[D+W-1],de=q[D+W];g.prev_length>=g.good_match&&(L>>=2),j>g.lookahead&&(j=g.lookahead);do if(q[(G=H)+W]===de&&q[G+W-1]===Te&&q[G]===q[D]&&q[++G]===q[D+1]){D+=2,G++;do;while(q[++D]===q[++G]&&q[++D]===q[++G]&&q[++D]===q[++G]&&q[++D]===q[++G]&&q[++D]===q[++G]&&q[++D]===q[++G]&&q[++D]===q[++G]&&q[++D]===q[++G]&&D<oe);if(w=M-(oe-D),D=oe-M,W<w){if(g.match_start=H,j<=(W=w))break;Te=q[D+W-1],de=q[D+W]}}while((H=Q[H&te])>x&&--L!=0);return W<=g.lookahead?W:g.lookahead}function Fe(g){var H,G,w,L,D,W,j,x,q,te,Q=g.w_size;do{if(L=g.window_size-g.lookahead-g.strstart,g.strstart>=Q+(Q-B)){for(r.arraySet(g.window,g.window,Q,Q,0),g.match_start-=Q,g.strstart-=Q,g.block_start-=Q,H=G=g.hash_size;w=g.head[--H],g.head[H]=Q<=w?w-Q:0,--G;);for(H=G=Q;w=g.prev[--H],g.prev[H]=Q<=w?w-Q:0,--G;);L+=Q}if(g.strm.avail_in===0)break;if(W=g.strm,j=g.window,x=g.strstart+g.lookahead,q=L,te=void 0,te=W.avail_in,q<te&&(te=q),G=te===0?0:(W.avail_in-=te,r.arraySet(j,W.input,W.next_in,te,x),W.state.wrap===1?W.adler=a(W.adler,j,te,x):W.state.wrap===2&&(W.adler=c(W.adler,j,te,x)),W.next_in+=te,W.total_in+=te,te),g.lookahead+=G,g.lookahead+g.insert>=_)for(D=g.strstart-g.insert,g.ins_h=g.window[D],g.ins_h=(g.ins_h<<g.hash_shift^g.window[D+1])&g.hash_mask;g.insert&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[D+_-1])&g.hash_mask,g.prev[D&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=D,D++,g.insert--,!(g.lookahead+g.insert<_)););}while(g.lookahead<B&&g.strm.avail_in!==0)}function ye(g,H){for(var G,w;;){if(g.lookahead<B){if(Fe(g),g.lookahead<B&&H===I)return F;if(g.lookahead===0)break}if(G=0,g.lookahead>=_&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+_-1])&g.hash_mask,G=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart),G!==0&&g.strstart-G<=g.w_size-B&&(g.match_length=K(g,G)),g.match_length>=_)if(w=o._tr_tally(g,g.strstart-g.match_start,g.match_length-_),g.lookahead-=g.match_length,g.match_length<=g.max_lazy_match&&g.lookahead>=_){for(g.match_length--;g.strstart++,g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+_-1])&g.hash_mask,G=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart,--g.match_length!=0;);g.strstart++}else g.strstart+=g.match_length,g.match_length=0,g.ins_h=g.window[g.strstart],g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+1])&g.hash_mask;else w=o._tr_tally(g,0,g.window[g.strstart]),g.lookahead--,g.strstart++;if(w&&(Y(g,!1),g.strm.avail_out===0))return F}return g.insert=g.strstart<_-1?g.strstart:_-1,H===d?(Y(g,!0),g.strm.avail_out===0?Z:z):g.last_lit&&(Y(g,!1),g.strm.avail_out===0)?F:b}function re(g,H){for(var G,w,L;;){if(g.lookahead<B){if(Fe(g),g.lookahead<B&&H===I)return F;if(g.lookahead===0)break}if(G=0,g.lookahead>=_&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+_-1])&g.hash_mask,G=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart),g.prev_length=g.match_length,g.prev_match=g.match_start,g.match_length=_-1,G!==0&&g.prev_length<g.max_lazy_match&&g.strstart-G<=g.w_size-B&&(g.match_length=K(g,G),g.match_length<=5&&(g.strategy===1||g.match_length===_&&4096<g.strstart-g.match_start)&&(g.match_length=_-1)),g.prev_length>=_&&g.match_length<=g.prev_length){for(L=g.strstart+g.lookahead-_,w=o._tr_tally(g,g.strstart-1-g.prev_match,g.prev_length-_),g.lookahead-=g.prev_length-1,g.prev_length-=2;++g.strstart<=L&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+_-1])&g.hash_mask,G=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart),--g.prev_length!=0;);if(g.match_available=0,g.match_length=_-1,g.strstart++,w&&(Y(g,!1),g.strm.avail_out===0))return F}else if(g.match_available){if((w=o._tr_tally(g,0,g.window[g.strstart-1]))&&Y(g,!1),g.strstart++,g.lookahead--,g.strm.avail_out===0)return F}else g.match_available=1,g.strstart++,g.lookahead--}return g.match_available&&(w=o._tr_tally(g,0,g.window[g.strstart-1]),g.match_available=0),g.insert=g.strstart<_-1?g.strstart:_-1,H===d?(Y(g,!0),g.strm.avail_out===0?Z:z):g.last_lit&&(Y(g,!1),g.strm.avail_out===0)?F:b}function ue(g,H,G,w,L){this.good_length=g,this.max_lazy=H,this.nice_length=G,this.max_chain=w,this.func=L}function he(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=R,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*y),this.dyn_dtree=new r.Buf16(2*(2*S+1)),this.bl_tree=new r.Buf16(2*(2*N+1)),ne(this.dyn_ltree),ne(this.dyn_dtree),ne(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(P+1),this.heap=new r.Buf16(2*m+1),ne(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*m+1),ne(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function pe(g){var H;return g&&g.state?(g.total_in=g.total_out=0,g.data_type=T,(H=g.state).pending=0,H.pending_out=0,H.wrap<0&&(H.wrap=-H.wrap),H.status=H.wrap?O:v,g.adler=H.wrap===2?0:1,H.last_flush=I,o._tr_init(H),u):J(g,f)}function We(g){var H=pe(g);return H===u&&function(G){G.window_size=2*G.w_size,ne(G.head),G.max_lazy_match=n[G.level].max_lazy,G.good_match=n[G.level].good_length,G.nice_match=n[G.level].nice_length,G.max_chain_length=n[G.level].max_chain,G.strstart=0,G.block_start=0,G.lookahead=0,G.insert=0,G.match_length=G.prev_length=_-1,G.match_available=0,G.ins_h=0}(g.state),H}function ve(g,H,G,w,L,D){if(!g)return f;var W=1;if(H===E&&(H=6),w<0?(W=0,w=-w):15<w&&(W=2,w-=16),L<1||A<L||G!==R||w<8||15<w||H<0||9<H||D<0||C<D)return J(g,f);w===8&&(w=9);var j=new he;return(g.state=j).strm=g,j.wrap=W,j.gzhead=null,j.w_bits=w,j.w_size=1<<j.w_bits,j.w_mask=j.w_size-1,j.hash_bits=L+7,j.hash_size=1<<j.hash_bits,j.hash_mask=j.hash_size-1,j.hash_shift=~~((j.hash_bits+_-1)/_),j.window=new r.Buf8(2*j.w_size),j.head=new r.Buf16(j.hash_size),j.prev=new r.Buf16(j.w_size),j.lit_bufsize=1<<L+6,j.pending_buf_size=4*j.lit_bufsize,j.pending_buf=new r.Buf8(j.pending_buf_size),j.d_buf=1*j.lit_bufsize,j.l_buf=3*j.lit_bufsize,j.level=H,j.strategy=D,j.method=G,We(g)}n=[new ue(0,0,0,0,function(g,H){var G=65535;for(G>g.pending_buf_size-5&&(G=g.pending_buf_size-5);;){if(g.lookahead<=1){if(Fe(g),g.lookahead===0&&H===I)return F;if(g.lookahead===0)break}g.strstart+=g.lookahead,g.lookahead=0;var w=g.block_start+G;if((g.strstart===0||g.strstart>=w)&&(g.lookahead=g.strstart-w,g.strstart=w,Y(g,!1),g.strm.avail_out===0)||g.strstart-g.block_start>=g.w_size-B&&(Y(g,!1),g.strm.avail_out===0))return F}return g.insert=0,H===d?(Y(g,!0),g.strm.avail_out===0?Z:z):(g.strstart>g.block_start&&(Y(g,!1),g.strm.avail_out),F)}),new ue(4,4,8,4,ye),new ue(4,5,16,8,ye),new ue(4,6,32,32,ye),new ue(4,4,16,16,re),new ue(8,16,32,32,re),new ue(8,16,128,128,re),new ue(8,32,128,256,re),new ue(32,128,258,1024,re),new ue(32,258,258,4096,re)],i.deflateInit=function(g,H){return ve(g,H,R,15,8,0)},i.deflateInit2=ve,i.deflateReset=We,i.deflateResetKeep=pe,i.deflateSetHeader=function(g,H){return g&&g.state?g.state.wrap!==2?f:(g.state.gzhead=H,u):f},i.deflate=function(g,H){var G,w,L,D;if(!g||!g.state||5<H||H<0)return g?J(g,f):f;if(w=g.state,!g.output||!g.input&&g.avail_in!==0||w.status===666&&H!==d)return J(g,g.avail_out===0?-5:f);if(w.strm=g,G=w.last_flush,w.last_flush=H,w.status===O)if(w.wrap===2)g.adler=0,ie(w,31),ie(w,139),ie(w,8),w.gzhead?(ie(w,(w.gzhead.text?1:0)+(w.gzhead.hcrc?2:0)+(w.gzhead.extra?4:0)+(w.gzhead.name?8:0)+(w.gzhead.comment?16:0)),ie(w,255&w.gzhead.time),ie(w,w.gzhead.time>>8&255),ie(w,w.gzhead.time>>16&255),ie(w,w.gzhead.time>>24&255),ie(w,w.level===9?2:2<=w.strategy||w.level<2?4:0),ie(w,255&w.gzhead.os),w.gzhead.extra&&w.gzhead.extra.length&&(ie(w,255&w.gzhead.extra.length),ie(w,w.gzhead.extra.length>>8&255)),w.gzhead.hcrc&&(g.adler=c(g.adler,w.pending_buf,w.pending,0)),w.gzindex=0,w.status=69):(ie(w,0),ie(w,0),ie(w,0),ie(w,0),ie(w,0),ie(w,w.level===9?2:2<=w.strategy||w.level<2?4:0),ie(w,3),w.status=v);else{var W=R+(w.w_bits-8<<4)<<8;W|=(2<=w.strategy||w.level<2?0:w.level<6?1:w.level===6?2:3)<<6,w.strstart!==0&&(W|=32),W+=31-W%31,w.status=v,ee(w,W),w.strstart!==0&&(ee(w,g.adler>>>16),ee(w,65535&g.adler)),g.adler=1}if(w.status===69)if(w.gzhead.extra){for(L=w.pending;w.gzindex<(65535&w.gzhead.extra.length)&&(w.pending!==w.pending_buf_size||(w.gzhead.hcrc&&w.pending>L&&(g.adler=c(g.adler,w.pending_buf,w.pending-L,L)),V(g),L=w.pending,w.pending!==w.pending_buf_size));)ie(w,255&w.gzhead.extra[w.gzindex]),w.gzindex++;w.gzhead.hcrc&&w.pending>L&&(g.adler=c(g.adler,w.pending_buf,w.pending-L,L)),w.gzindex===w.gzhead.extra.length&&(w.gzindex=0,w.status=73)}else w.status=73;if(w.status===73)if(w.gzhead.name){L=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>L&&(g.adler=c(g.adler,w.pending_buf,w.pending-L,L)),V(g),L=w.pending,w.pending===w.pending_buf_size)){D=1;break}D=w.gzindex<w.gzhead.name.length?255&w.gzhead.name.charCodeAt(w.gzindex++):0,ie(w,D)}while(D!==0);w.gzhead.hcrc&&w.pending>L&&(g.adler=c(g.adler,w.pending_buf,w.pending-L,L)),D===0&&(w.gzindex=0,w.status=91)}else w.status=91;if(w.status===91)if(w.gzhead.comment){L=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>L&&(g.adler=c(g.adler,w.pending_buf,w.pending-L,L)),V(g),L=w.pending,w.pending===w.pending_buf_size)){D=1;break}D=w.gzindex<w.gzhead.comment.length?255&w.gzhead.comment.charCodeAt(w.gzindex++):0,ie(w,D)}while(D!==0);w.gzhead.hcrc&&w.pending>L&&(g.adler=c(g.adler,w.pending_buf,w.pending-L,L)),D===0&&(w.status=103)}else w.status=103;if(w.status===103&&(w.gzhead.hcrc?(w.pending+2>w.pending_buf_size&&V(g),w.pending+2<=w.pending_buf_size&&(ie(w,255&g.adler),ie(w,g.adler>>8&255),g.adler=0,w.status=v)):w.status=v),w.pending!==0){if(V(g),g.avail_out===0)return w.last_flush=-1,u}else if(g.avail_in===0&&X(H)<=X(G)&&H!==d)return J(g,-5);if(w.status===666&&g.avail_in!==0)return J(g,-5);if(g.avail_in!==0||w.lookahead!==0||H!==I&&w.status!==666){var j=w.strategy===2?function(x,q){for(var te;;){if(x.lookahead===0&&(Fe(x),x.lookahead===0)){if(q===I)return F;break}if(x.match_length=0,te=o._tr_tally(x,0,x.window[x.strstart]),x.lookahead--,x.strstart++,te&&(Y(x,!1),x.strm.avail_out===0))return F}return x.insert=0,q===d?(Y(x,!0),x.strm.avail_out===0?Z:z):x.last_lit&&(Y(x,!1),x.strm.avail_out===0)?F:b}(w,H):w.strategy===3?function(x,q){for(var te,Q,oe,Te,de=x.window;;){if(x.lookahead<=M){if(Fe(x),x.lookahead<=M&&q===I)return F;if(x.lookahead===0)break}if(x.match_length=0,x.lookahead>=_&&0<x.strstart&&(Q=de[oe=x.strstart-1])===de[++oe]&&Q===de[++oe]&&Q===de[++oe]){Te=x.strstart+M;do;while(Q===de[++oe]&&Q===de[++oe]&&Q===de[++oe]&&Q===de[++oe]&&Q===de[++oe]&&Q===de[++oe]&&Q===de[++oe]&&Q===de[++oe]&&oe<Te);x.match_length=M-(Te-oe),x.match_length>x.lookahead&&(x.match_length=x.lookahead)}if(x.match_length>=_?(te=o._tr_tally(x,1,x.match_length-_),x.lookahead-=x.match_length,x.strstart+=x.match_length,x.match_length=0):(te=o._tr_tally(x,0,x.window[x.strstart]),x.lookahead--,x.strstart++),te&&(Y(x,!1),x.strm.avail_out===0))return F}return x.insert=0,q===d?(Y(x,!0),x.strm.avail_out===0?Z:z):x.last_lit&&(Y(x,!1),x.strm.avail_out===0)?F:b}(w,H):n[w.level].func(w,H);if(j!==Z&&j!==z||(w.status=666),j===F||j===Z)return g.avail_out===0&&(w.last_flush=-1),u;if(j===b&&(H===1?o._tr_align(w):H!==5&&(o._tr_stored_block(w,0,0,!1),H===3&&(ne(w.head),w.lookahead===0&&(w.strstart=0,w.block_start=0,w.insert=0))),V(g),g.avail_out===0))return w.last_flush=-1,u}return H!==d?u:w.wrap<=0?1:(w.wrap===2?(ie(w,255&g.adler),ie(w,g.adler>>8&255),ie(w,g.adler>>16&255),ie(w,g.adler>>24&255),ie(w,255&g.total_in),ie(w,g.total_in>>8&255),ie(w,g.total_in>>16&255),ie(w,g.total_in>>24&255)):(ee(w,g.adler>>>16),ee(w,65535&g.adler)),V(g),0<w.wrap&&(w.wrap=-w.wrap),w.pending!==0?u:1)},i.deflateEnd=function(g){var H;return g&&g.state?(H=g.state.status)!==O&&H!==69&&H!==73&&H!==91&&H!==103&&H!==v&&H!==666?J(g,f):(g.state=null,H===v?J(g,-3):u):f},i.deflateSetDictionary=function(g,H){var G,w,L,D,W,j,x,q,te=H.length;if(!g||!g.state||(D=(G=g.state).wrap)===2||D===1&&G.status!==O||G.lookahead)return f;for(D===1&&(g.adler=a(g.adler,H,te,0)),G.wrap=0,te>=G.w_size&&(D===0&&(ne(G.head),G.strstart=0,G.block_start=0,G.insert=0),q=new r.Buf8(G.w_size),r.arraySet(q,H,te-G.w_size,G.w_size,0),H=q,te=G.w_size),W=g.avail_in,j=g.next_in,x=g.input,g.avail_in=te,g.next_in=0,g.input=H,Fe(G);G.lookahead>=_;){for(w=G.strstart,L=G.lookahead-(_-1);G.ins_h=(G.ins_h<<G.hash_shift^G.window[w+_-1])&G.hash_mask,G.prev[w&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=w,w++,--L;);G.strstart=w,G.lookahead=_-1,Fe(G)}return G.strstart+=G.lookahead,G.block_start=G.strstart,G.insert=G.lookahead,G.lookahead=0,G.match_length=G.prev_length=_-1,G.match_available=0,g.next_in=j,g.input=x,g.avail_in=W,G.wrap=D,u},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,s,i){s.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,s,i){s.exports=function(n,r){var o,a,c,h,I,d,u,f,E,C,T,R,A,m,S,N,y,P,_,M,B,O,v,F,b;o=n.state,a=n.next_in,F=n.input,c=a+(n.avail_in-5),h=n.next_out,b=n.output,I=h-(r-n.avail_out),d=h+(n.avail_out-257),u=o.dmax,f=o.wsize,E=o.whave,C=o.wnext,T=o.window,R=o.hold,A=o.bits,m=o.lencode,S=o.distcode,N=(1<<o.lenbits)-1,y=(1<<o.distbits)-1;e:do{A<15&&(R+=F[a++]<<A,A+=8,R+=F[a++]<<A,A+=8),P=m[R&N];t:for(;;){if(R>>>=_=P>>>24,A-=_,(_=P>>>16&255)===0)b[h++]=65535&P;else{if(!(16&_)){if(!(64&_)){P=m[(65535&P)+(R&(1<<_)-1)];continue t}if(32&_){o.mode=12;break e}n.msg="invalid literal/length code",o.mode=30;break e}M=65535&P,(_&=15)&&(A<_&&(R+=F[a++]<<A,A+=8),M+=R&(1<<_)-1,R>>>=_,A-=_),A<15&&(R+=F[a++]<<A,A+=8,R+=F[a++]<<A,A+=8),P=S[R&y];s:for(;;){if(R>>>=_=P>>>24,A-=_,!(16&(_=P>>>16&255))){if(!(64&_)){P=S[(65535&P)+(R&(1<<_)-1)];continue s}n.msg="invalid distance code",o.mode=30;break e}if(B=65535&P,A<(_&=15)&&(R+=F[a++]<<A,(A+=8)<_&&(R+=F[a++]<<A,A+=8)),u<(B+=R&(1<<_)-1)){n.msg="invalid distance too far back",o.mode=30;break e}if(R>>>=_,A-=_,(_=h-I)<B){if(E<(_=B-_)&&o.sane){n.msg="invalid distance too far back",o.mode=30;break e}if(v=T,(O=0)===C){if(O+=f-_,_<M){for(M-=_;b[h++]=T[O++],--_;);O=h-B,v=b}}else if(C<_){if(O+=f+C-_,(_-=C)<M){for(M-=_;b[h++]=T[O++],--_;);if(O=0,C<M){for(M-=_=C;b[h++]=T[O++],--_;);O=h-B,v=b}}}else if(O+=C-_,_<M){for(M-=_;b[h++]=T[O++],--_;);O=h-B,v=b}for(;2<M;)b[h++]=v[O++],b[h++]=v[O++],b[h++]=v[O++],M-=3;M&&(b[h++]=v[O++],1<M&&(b[h++]=v[O++]))}else{for(O=h-B;b[h++]=b[O++],b[h++]=b[O++],b[h++]=b[O++],2<(M-=3););M&&(b[h++]=b[O++],1<M&&(b[h++]=b[O++]))}break}}break}}while(a<c&&h<d);a-=M=A>>3,R&=(1<<(A-=M<<3))-1,n.next_in=a,n.next_out=h,n.avail_in=a<c?c-a+5:5-(a-c),n.avail_out=h<d?d-h+257:257-(h-d),o.hold=R,o.bits=A}},{}],49:[function(t,s,i){var n=t("../utils/common"),r=t("./adler32"),o=t("./crc32"),a=t("./inffast"),c=t("./inftrees"),h=1,I=2,d=0,u=-2,f=1,E=852,C=592;function T(O){return(O>>>24&255)+(O>>>8&65280)+((65280&O)<<8)+((255&O)<<24)}function R(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function A(O){var v;return O&&O.state?(v=O.state,O.total_in=O.total_out=v.total=0,O.msg="",v.wrap&&(O.adler=1&v.wrap),v.mode=f,v.last=0,v.havedict=0,v.dmax=32768,v.head=null,v.hold=0,v.bits=0,v.lencode=v.lendyn=new n.Buf32(E),v.distcode=v.distdyn=new n.Buf32(C),v.sane=1,v.back=-1,d):u}function m(O){var v;return O&&O.state?((v=O.state).wsize=0,v.whave=0,v.wnext=0,A(O)):u}function S(O,v){var F,b;return O&&O.state?(b=O.state,v<0?(F=0,v=-v):(F=1+(v>>4),v<48&&(v&=15)),v&&(v<8||15<v)?u:(b.window!==null&&b.wbits!==v&&(b.window=null),b.wrap=F,b.wbits=v,m(O))):u}function N(O,v){var F,b;return O?(b=new R,(O.state=b).window=null,(F=S(O,v))!==d&&(O.state=null),F):u}var y,P,_=!0;function M(O){if(_){var v;for(y=new n.Buf32(512),P=new n.Buf32(32),v=0;v<144;)O.lens[v++]=8;for(;v<256;)O.lens[v++]=9;for(;v<280;)O.lens[v++]=7;for(;v<288;)O.lens[v++]=8;for(c(h,O.lens,0,288,y,0,O.work,{bits:9}),v=0;v<32;)O.lens[v++]=5;c(I,O.lens,0,32,P,0,O.work,{bits:5}),_=!1}O.lencode=y,O.lenbits=9,O.distcode=P,O.distbits=5}function B(O,v,F,b){var Z,z=O.state;return z.window===null&&(z.wsize=1<<z.wbits,z.wnext=0,z.whave=0,z.window=new n.Buf8(z.wsize)),b>=z.wsize?(n.arraySet(z.window,v,F-z.wsize,z.wsize,0),z.wnext=0,z.whave=z.wsize):(b<(Z=z.wsize-z.wnext)&&(Z=b),n.arraySet(z.window,v,F-b,Z,z.wnext),(b-=Z)?(n.arraySet(z.window,v,F-b,b,0),z.wnext=b,z.whave=z.wsize):(z.wnext+=Z,z.wnext===z.wsize&&(z.wnext=0),z.whave<z.wsize&&(z.whave+=Z))),0}i.inflateReset=m,i.inflateReset2=S,i.inflateResetKeep=A,i.inflateInit=function(O){return N(O,15)},i.inflateInit2=N,i.inflate=function(O,v){var F,b,Z,z,J,X,ne,V,Y,ie,ee,K,Fe,ye,re,ue,he,pe,We,ve,g,H,G,w,L=0,D=new n.Buf8(4),W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!O||!O.state||!O.output||!O.input&&O.avail_in!==0)return u;(F=O.state).mode===12&&(F.mode=13),J=O.next_out,Z=O.output,ne=O.avail_out,z=O.next_in,b=O.input,X=O.avail_in,V=F.hold,Y=F.bits,ie=X,ee=ne,H=d;e:for(;;)switch(F.mode){case f:if(F.wrap===0){F.mode=13;break}for(;Y<16;){if(X===0)break e;X--,V+=b[z++]<<Y,Y+=8}if(2&F.wrap&&V===35615){D[F.check=0]=255&V,D[1]=V>>>8&255,F.check=o(F.check,D,2,0),Y=V=0,F.mode=2;break}if(F.flags=0,F.head&&(F.head.done=!1),!(1&F.wrap)||(((255&V)<<8)+(V>>8))%31){O.msg="incorrect header check",F.mode=30;break}if((15&V)!=8){O.msg="unknown compression method",F.mode=30;break}if(Y-=4,g=8+(15&(V>>>=4)),F.wbits===0)F.wbits=g;else if(g>F.wbits){O.msg="invalid window size",F.mode=30;break}F.dmax=1<<g,O.adler=F.check=1,F.mode=512&V?10:12,Y=V=0;break;case 2:for(;Y<16;){if(X===0)break e;X--,V+=b[z++]<<Y,Y+=8}if(F.flags=V,(255&F.flags)!=8){O.msg="unknown compression method",F.mode=30;break}if(57344&F.flags){O.msg="unknown header flags set",F.mode=30;break}F.head&&(F.head.text=V>>8&1),512&F.flags&&(D[0]=255&V,D[1]=V>>>8&255,F.check=o(F.check,D,2,0)),Y=V=0,F.mode=3;case 3:for(;Y<32;){if(X===0)break e;X--,V+=b[z++]<<Y,Y+=8}F.head&&(F.head.time=V),512&F.flags&&(D[0]=255&V,D[1]=V>>>8&255,D[2]=V>>>16&255,D[3]=V>>>24&255,F.check=o(F.check,D,4,0)),Y=V=0,F.mode=4;case 4:for(;Y<16;){if(X===0)break e;X--,V+=b[z++]<<Y,Y+=8}F.head&&(F.head.xflags=255&V,F.head.os=V>>8),512&F.flags&&(D[0]=255&V,D[1]=V>>>8&255,F.check=o(F.check,D,2,0)),Y=V=0,F.mode=5;case 5:if(1024&F.flags){for(;Y<16;){if(X===0)break e;X--,V+=b[z++]<<Y,Y+=8}F.length=V,F.head&&(F.head.extra_len=V),512&F.flags&&(D[0]=255&V,D[1]=V>>>8&255,F.check=o(F.check,D,2,0)),Y=V=0}else F.head&&(F.head.extra=null);F.mode=6;case 6:if(1024&F.flags&&(X<(K=F.length)&&(K=X),K&&(F.head&&(g=F.head.extra_len-F.length,F.head.extra||(F.head.extra=new Array(F.head.extra_len)),n.arraySet(F.head.extra,b,z,K,g)),512&F.flags&&(F.check=o(F.check,b,K,z)),X-=K,z+=K,F.length-=K),F.length))break e;F.length=0,F.mode=7;case 7:if(2048&F.flags){if(X===0)break e;for(K=0;g=b[z+K++],F.head&&g&&F.length<65536&&(F.head.name+=String.fromCharCode(g)),g&&K<X;);if(512&F.flags&&(F.check=o(F.check,b,K,z)),X-=K,z+=K,g)break e}else F.head&&(F.head.name=null);F.length=0,F.mode=8;case 8:if(4096&F.flags){if(X===0)break e;for(K=0;g=b[z+K++],F.head&&g&&F.length<65536&&(F.head.comment+=String.fromCharCode(g)),g&&K<X;);if(512&F.flags&&(F.check=o(F.check,b,K,z)),X-=K,z+=K,g)break e}else F.head&&(F.head.comment=null);F.mode=9;case 9:if(512&F.flags){for(;Y<16;){if(X===0)break e;X--,V+=b[z++]<<Y,Y+=8}if(V!==(65535&F.check)){O.msg="header crc mismatch",F.mode=30;break}Y=V=0}F.head&&(F.head.hcrc=F.flags>>9&1,F.head.done=!0),O.adler=F.check=0,F.mode=12;break;case 10:for(;Y<32;){if(X===0)break e;X--,V+=b[z++]<<Y,Y+=8}O.adler=F.check=T(V),Y=V=0,F.mode=11;case 11:if(F.havedict===0)return O.next_out=J,O.avail_out=ne,O.next_in=z,O.avail_in=X,F.hold=V,F.bits=Y,2;O.adler=F.check=1,F.mode=12;case 12:if(v===5||v===6)break e;case 13:if(F.last){V>>>=7&Y,Y-=7&Y,F.mode=27;break}for(;Y<3;){if(X===0)break e;X--,V+=b[z++]<<Y,Y+=8}switch(F.last=1&V,Y-=1,3&(V>>>=1)){case 0:F.mode=14;break;case 1:if(M(F),F.mode=20,v!==6)break;V>>>=2,Y-=2;break e;case 2:F.mode=17;break;case 3:O.msg="invalid block type",F.mode=30}V>>>=2,Y-=2;break;case 14:for(V>>>=7&Y,Y-=7&Y;Y<32;){if(X===0)break e;X--,V+=b[z++]<<Y,Y+=8}if((65535&V)!=(V>>>16^65535)){O.msg="invalid stored block lengths",F.mode=30;break}if(F.length=65535&V,Y=V=0,F.mode=15,v===6)break e;case 15:F.mode=16;case 16:if(K=F.length){if(X<K&&(K=X),ne<K&&(K=ne),K===0)break e;n.arraySet(Z,b,z,K,J),X-=K,z+=K,ne-=K,J+=K,F.length-=K;break}F.mode=12;break;case 17:for(;Y<14;){if(X===0)break e;X--,V+=b[z++]<<Y,Y+=8}if(F.nlen=257+(31&V),V>>>=5,Y-=5,F.ndist=1+(31&V),V>>>=5,Y-=5,F.ncode=4+(15&V),V>>>=4,Y-=4,286<F.nlen||30<F.ndist){O.msg="too many length or distance symbols",F.mode=30;break}F.have=0,F.mode=18;case 18:for(;F.have<F.ncode;){for(;Y<3;){if(X===0)break e;X--,V+=b[z++]<<Y,Y+=8}F.lens[W[F.have++]]=7&V,V>>>=3,Y-=3}for(;F.have<19;)F.lens[W[F.have++]]=0;if(F.lencode=F.lendyn,F.lenbits=7,G={bits:F.lenbits},H=c(0,F.lens,0,19,F.lencode,0,F.work,G),F.lenbits=G.bits,H){O.msg="invalid code lengths set",F.mode=30;break}F.have=0,F.mode=19;case 19:for(;F.have<F.nlen+F.ndist;){for(;ue=(L=F.lencode[V&(1<<F.lenbits)-1])>>>16&255,he=65535&L,!((re=L>>>24)<=Y);){if(X===0)break e;X--,V+=b[z++]<<Y,Y+=8}if(he<16)V>>>=re,Y-=re,F.lens[F.have++]=he;else{if(he===16){for(w=re+2;Y<w;){if(X===0)break e;X--,V+=b[z++]<<Y,Y+=8}if(V>>>=re,Y-=re,F.have===0){O.msg="invalid bit length repeat",F.mode=30;break}g=F.lens[F.have-1],K=3+(3&V),V>>>=2,Y-=2}else if(he===17){for(w=re+3;Y<w;){if(X===0)break e;X--,V+=b[z++]<<Y,Y+=8}Y-=re,g=0,K=3+(7&(V>>>=re)),V>>>=3,Y-=3}else{for(w=re+7;Y<w;){if(X===0)break e;X--,V+=b[z++]<<Y,Y+=8}Y-=re,g=0,K=11+(127&(V>>>=re)),V>>>=7,Y-=7}if(F.have+K>F.nlen+F.ndist){O.msg="invalid bit length repeat",F.mode=30;break}for(;K--;)F.lens[F.have++]=g}}if(F.mode===30)break;if(F.lens[256]===0){O.msg="invalid code -- missing end-of-block",F.mode=30;break}if(F.lenbits=9,G={bits:F.lenbits},H=c(h,F.lens,0,F.nlen,F.lencode,0,F.work,G),F.lenbits=G.bits,H){O.msg="invalid literal/lengths set",F.mode=30;break}if(F.distbits=6,F.distcode=F.distdyn,G={bits:F.distbits},H=c(I,F.lens,F.nlen,F.ndist,F.distcode,0,F.work,G),F.distbits=G.bits,H){O.msg="invalid distances set",F.mode=30;break}if(F.mode=20,v===6)break e;case 20:F.mode=21;case 21:if(6<=X&&258<=ne){O.next_out=J,O.avail_out=ne,O.next_in=z,O.avail_in=X,F.hold=V,F.bits=Y,a(O,ee),J=O.next_out,Z=O.output,ne=O.avail_out,z=O.next_in,b=O.input,X=O.avail_in,V=F.hold,Y=F.bits,F.mode===12&&(F.back=-1);break}for(F.back=0;ue=(L=F.lencode[V&(1<<F.lenbits)-1])>>>16&255,he=65535&L,!((re=L>>>24)<=Y);){if(X===0)break e;X--,V+=b[z++]<<Y,Y+=8}if(ue&&!(240&ue)){for(pe=re,We=ue,ve=he;ue=(L=F.lencode[ve+((V&(1<<pe+We)-1)>>pe)])>>>16&255,he=65535&L,!(pe+(re=L>>>24)<=Y);){if(X===0)break e;X--,V+=b[z++]<<Y,Y+=8}V>>>=pe,Y-=pe,F.back+=pe}if(V>>>=re,Y-=re,F.back+=re,F.length=he,ue===0){F.mode=26;break}if(32&ue){F.back=-1,F.mode=12;break}if(64&ue){O.msg="invalid literal/length code",F.mode=30;break}F.extra=15&ue,F.mode=22;case 22:if(F.extra){for(w=F.extra;Y<w;){if(X===0)break e;X--,V+=b[z++]<<Y,Y+=8}F.length+=V&(1<<F.extra)-1,V>>>=F.extra,Y-=F.extra,F.back+=F.extra}F.was=F.length,F.mode=23;case 23:for(;ue=(L=F.distcode[V&(1<<F.distbits)-1])>>>16&255,he=65535&L,!((re=L>>>24)<=Y);){if(X===0)break e;X--,V+=b[z++]<<Y,Y+=8}if(!(240&ue)){for(pe=re,We=ue,ve=he;ue=(L=F.distcode[ve+((V&(1<<pe+We)-1)>>pe)])>>>16&255,he=65535&L,!(pe+(re=L>>>24)<=Y);){if(X===0)break e;X--,V+=b[z++]<<Y,Y+=8}V>>>=pe,Y-=pe,F.back+=pe}if(V>>>=re,Y-=re,F.back+=re,64&ue){O.msg="invalid distance code",F.mode=30;break}F.offset=he,F.extra=15&ue,F.mode=24;case 24:if(F.extra){for(w=F.extra;Y<w;){if(X===0)break e;X--,V+=b[z++]<<Y,Y+=8}F.offset+=V&(1<<F.extra)-1,V>>>=F.extra,Y-=F.extra,F.back+=F.extra}if(F.offset>F.dmax){O.msg="invalid distance too far back",F.mode=30;break}F.mode=25;case 25:if(ne===0)break e;if(K=ee-ne,F.offset>K){if((K=F.offset-K)>F.whave&&F.sane){O.msg="invalid distance too far back",F.mode=30;break}Fe=K>F.wnext?(K-=F.wnext,F.wsize-K):F.wnext-K,K>F.length&&(K=F.length),ye=F.window}else ye=Z,Fe=J-F.offset,K=F.length;for(ne<K&&(K=ne),ne-=K,F.length-=K;Z[J++]=ye[Fe++],--K;);F.length===0&&(F.mode=21);break;case 26:if(ne===0)break e;Z[J++]=F.length,ne--,F.mode=21;break;case 27:if(F.wrap){for(;Y<32;){if(X===0)break e;X--,V|=b[z++]<<Y,Y+=8}if(ee-=ne,O.total_out+=ee,F.total+=ee,ee&&(O.adler=F.check=F.flags?o(F.check,Z,ee,J-ee):r(F.check,Z,ee,J-ee)),ee=ne,(F.flags?V:T(V))!==F.check){O.msg="incorrect data check",F.mode=30;break}Y=V=0}F.mode=28;case 28:if(F.wrap&&F.flags){for(;Y<32;){if(X===0)break e;X--,V+=b[z++]<<Y,Y+=8}if(V!==(4294967295&F.total)){O.msg="incorrect length check",F.mode=30;break}Y=V=0}F.mode=29;case 29:H=1;break e;case 30:H=-3;break e;case 31:return-4;case 32:default:return u}return O.next_out=J,O.avail_out=ne,O.next_in=z,O.avail_in=X,F.hold=V,F.bits=Y,(F.wsize||ee!==O.avail_out&&F.mode<30&&(F.mode<27||v!==4))&&B(O,O.output,O.next_out,ee-O.avail_out)?(F.mode=31,-4):(ie-=O.avail_in,ee-=O.avail_out,O.total_in+=ie,O.total_out+=ee,F.total+=ee,F.wrap&&ee&&(O.adler=F.check=F.flags?o(F.check,Z,ee,O.next_out-ee):r(F.check,Z,ee,O.next_out-ee)),O.data_type=F.bits+(F.last?64:0)+(F.mode===12?128:0)+(F.mode===20||F.mode===15?256:0),(ie==0&&ee===0||v===4)&&H===d&&(H=-5),H)},i.inflateEnd=function(O){if(!O||!O.state)return u;var v=O.state;return v.window&&(v.window=null),O.state=null,d},i.inflateGetHeader=function(O,v){var F;return O&&O.state&&2&(F=O.state).wrap?((F.head=v).done=!1,d):u},i.inflateSetDictionary=function(O,v){var F,b=v.length;return O&&O.state?(F=O.state).wrap!==0&&F.mode!==11?u:F.mode===11&&r(1,v,b,0)!==F.check?-3:B(O,v,b,b)?(F.mode=31,-4):(F.havedict=1,d):u},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,s,i){var n=t("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];s.exports=function(h,I,d,u,f,E,C,T){var R,A,m,S,N,y,P,_,M,B=T.bits,O=0,v=0,F=0,b=0,Z=0,z=0,J=0,X=0,ne=0,V=0,Y=null,ie=0,ee=new n.Buf16(16),K=new n.Buf16(16),Fe=null,ye=0;for(O=0;O<=15;O++)ee[O]=0;for(v=0;v<u;v++)ee[I[d+v]]++;for(Z=B,b=15;1<=b&&ee[b]===0;b--);if(b<Z&&(Z=b),b===0)return f[E++]=20971520,f[E++]=20971520,T.bits=1,0;for(F=1;F<b&&ee[F]===0;F++);for(Z<F&&(Z=F),O=X=1;O<=15;O++)if(X<<=1,(X-=ee[O])<0)return-1;if(0<X&&(h===0||b!==1))return-1;for(K[1]=0,O=1;O<15;O++)K[O+1]=K[O]+ee[O];for(v=0;v<u;v++)I[d+v]!==0&&(C[K[I[d+v]]++]=v);if(y=h===0?(Y=Fe=C,19):h===1?(Y=r,ie-=257,Fe=o,ye-=257,256):(Y=a,Fe=c,-1),O=F,N=E,J=v=V=0,m=-1,S=(ne=1<<(z=Z))-1,h===1&&852<ne||h===2&&592<ne)return 1;for(;;){for(P=O-J,M=C[v]<y?(_=0,C[v]):C[v]>y?(_=Fe[ye+C[v]],Y[ie+C[v]]):(_=96,0),R=1<<O-J,F=A=1<<z;f[N+(V>>J)+(A-=R)]=P<<24|_<<16|M|0,A!==0;);for(R=1<<O-1;V&R;)R>>=1;if(R!==0?(V&=R-1,V+=R):V=0,v++,--ee[O]==0){if(O===b)break;O=I[d+C[v]]}if(Z<O&&(V&S)!==m){for(J===0&&(J=Z),N+=F,X=1<<(z=O-J);z+J<b&&!((X-=ee[z+J])<=0);)z++,X<<=1;if(ne+=1<<z,h===1&&852<ne||h===2&&592<ne)return 1;f[m=V&S]=Z<<24|z<<16|N-E|0}}return V!==0&&(f[N+V]=O-J<<24|64<<16|0),T.bits=Z,0}},{"../utils/common":41}],51:[function(t,s,i){s.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,s,i){var n=t("../utils/common"),r=0,o=1;function a(L){for(var D=L.length;0<=--D;)L[D]=0}var c=0,h=29,I=256,d=I+1+h,u=30,f=19,E=2*d+1,C=15,T=16,R=7,A=256,m=16,S=17,N=18,y=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],P=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],M=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],B=new Array(2*(d+2));a(B);var O=new Array(2*u);a(O);var v=new Array(512);a(v);var F=new Array(256);a(F);var b=new Array(h);a(b);var Z,z,J,X=new Array(u);function ne(L,D,W,j,x){this.static_tree=L,this.extra_bits=D,this.extra_base=W,this.elems=j,this.max_length=x,this.has_stree=L&&L.length}function V(L,D){this.dyn_tree=L,this.max_code=0,this.stat_desc=D}function Y(L){return L<256?v[L]:v[256+(L>>>7)]}function ie(L,D){L.pending_buf[L.pending++]=255&D,L.pending_buf[L.pending++]=D>>>8&255}function ee(L,D,W){L.bi_valid>T-W?(L.bi_buf|=D<<L.bi_valid&65535,ie(L,L.bi_buf),L.bi_buf=D>>T-L.bi_valid,L.bi_valid+=W-T):(L.bi_buf|=D<<L.bi_valid&65535,L.bi_valid+=W)}function K(L,D,W){ee(L,W[2*D],W[2*D+1])}function Fe(L,D){for(var W=0;W|=1&L,L>>>=1,W<<=1,0<--D;);return W>>>1}function ye(L,D,W){var j,x,q=new Array(C+1),te=0;for(j=1;j<=C;j++)q[j]=te=te+W[j-1]<<1;for(x=0;x<=D;x++){var Q=L[2*x+1];Q!==0&&(L[2*x]=Fe(q[Q]++,Q))}}function re(L){var D;for(D=0;D<d;D++)L.dyn_ltree[2*D]=0;for(D=0;D<u;D++)L.dyn_dtree[2*D]=0;for(D=0;D<f;D++)L.bl_tree[2*D]=0;L.dyn_ltree[2*A]=1,L.opt_len=L.static_len=0,L.last_lit=L.matches=0}function ue(L){8<L.bi_valid?ie(L,L.bi_buf):0<L.bi_valid&&(L.pending_buf[L.pending++]=L.bi_buf),L.bi_buf=0,L.bi_valid=0}function he(L,D,W,j){var x=2*D,q=2*W;return L[x]<L[q]||L[x]===L[q]&&j[D]<=j[W]}function pe(L,D,W){for(var j=L.heap[W],x=W<<1;x<=L.heap_len&&(x<L.heap_len&&he(D,L.heap[x+1],L.heap[x],L.depth)&&x++,!he(D,j,L.heap[x],L.depth));)L.heap[W]=L.heap[x],W=x,x<<=1;L.heap[W]=j}function We(L,D,W){var j,x,q,te,Q=0;if(L.last_lit!==0)for(;j=L.pending_buf[L.d_buf+2*Q]<<8|L.pending_buf[L.d_buf+2*Q+1],x=L.pending_buf[L.l_buf+Q],Q++,j===0?K(L,x,D):(K(L,(q=F[x])+I+1,D),(te=y[q])!==0&&ee(L,x-=b[q],te),K(L,q=Y(--j),W),(te=P[q])!==0&&ee(L,j-=X[q],te)),Q<L.last_lit;);K(L,A,D)}function ve(L,D){var W,j,x,q=D.dyn_tree,te=D.stat_desc.static_tree,Q=D.stat_desc.has_stree,oe=D.stat_desc.elems,Te=-1;for(L.heap_len=0,L.heap_max=E,W=0;W<oe;W++)q[2*W]!==0?(L.heap[++L.heap_len]=Te=W,L.depth[W]=0):q[2*W+1]=0;for(;L.heap_len<2;)q[2*(x=L.heap[++L.heap_len]=Te<2?++Te:0)]=1,L.depth[x]=0,L.opt_len--,Q&&(L.static_len-=te[2*x+1]);for(D.max_code=Te,W=L.heap_len>>1;1<=W;W--)pe(L,q,W);for(x=oe;W=L.heap[1],L.heap[1]=L.heap[L.heap_len--],pe(L,q,1),j=L.heap[1],L.heap[--L.heap_max]=W,L.heap[--L.heap_max]=j,q[2*x]=q[2*W]+q[2*j],L.depth[x]=(L.depth[W]>=L.depth[j]?L.depth[W]:L.depth[j])+1,q[2*W+1]=q[2*j+1]=x,L.heap[1]=x++,pe(L,q,1),2<=L.heap_len;);L.heap[--L.heap_max]=L.heap[1],function(de,Xe){var fs,ot,ps,Ne,Xs,Vi,dt=Xe.dyn_tree,ar=Xe.max_code,La=Xe.stat_desc.static_tree,_a=Xe.stat_desc.has_stree,wa=Xe.stat_desc.extra_bits,lr=Xe.stat_desc.extra_base,Cs=Xe.stat_desc.max_length,js=0;for(Ne=0;Ne<=C;Ne++)de.bl_count[Ne]=0;for(dt[2*de.heap[de.heap_max]+1]=0,fs=de.heap_max+1;fs<E;fs++)Cs<(Ne=dt[2*dt[2*(ot=de.heap[fs])+1]+1]+1)&&(Ne=Cs,js++),dt[2*ot+1]=Ne,ar<ot||(de.bl_count[Ne]++,Xs=0,lr<=ot&&(Xs=wa[ot-lr]),Vi=dt[2*ot],de.opt_len+=Vi*(Ne+Xs),_a&&(de.static_len+=Vi*(La[2*ot+1]+Xs)));if(js!==0){do{for(Ne=Cs-1;de.bl_count[Ne]===0;)Ne--;de.bl_count[Ne]--,de.bl_count[Ne+1]+=2,de.bl_count[Cs]--,js-=2}while(0<js);for(Ne=Cs;Ne!==0;Ne--)for(ot=de.bl_count[Ne];ot!==0;)ar<(ps=de.heap[--fs])||(dt[2*ps+1]!==Ne&&(de.opt_len+=(Ne-dt[2*ps+1])*dt[2*ps],dt[2*ps+1]=Ne),ot--)}}(L,D),ye(q,Te,L.bl_count)}function g(L,D,W){var j,x,q=-1,te=D[1],Q=0,oe=7,Te=4;for(te===0&&(oe=138,Te=3),D[2*(W+1)+1]=65535,j=0;j<=W;j++)x=te,te=D[2*(j+1)+1],++Q<oe&&x===te||(Q<Te?L.bl_tree[2*x]+=Q:x!==0?(x!==q&&L.bl_tree[2*x]++,L.bl_tree[2*m]++):Q<=10?L.bl_tree[2*S]++:L.bl_tree[2*N]++,q=x,Te=(Q=0)===te?(oe=138,3):x===te?(oe=6,3):(oe=7,4))}function H(L,D,W){var j,x,q=-1,te=D[1],Q=0,oe=7,Te=4;for(te===0&&(oe=138,Te=3),j=0;j<=W;j++)if(x=te,te=D[2*(j+1)+1],!(++Q<oe&&x===te)){if(Q<Te)for(;K(L,x,L.bl_tree),--Q!=0;);else x!==0?(x!==q&&(K(L,x,L.bl_tree),Q--),K(L,m,L.bl_tree),ee(L,Q-3,2)):Q<=10?(K(L,S,L.bl_tree),ee(L,Q-3,3)):(K(L,N,L.bl_tree),ee(L,Q-11,7));q=x,Te=(Q=0)===te?(oe=138,3):x===te?(oe=6,3):(oe=7,4)}}a(X);var G=!1;function w(L,D,W,j){ee(L,(c<<1)+(j?1:0),3),function(x,q,te,Q){ue(x),ie(x,te),ie(x,~te),n.arraySet(x.pending_buf,x.window,q,te,x.pending),x.pending+=te}(L,D,W)}i._tr_init=function(L){G||(function(){var D,W,j,x,q,te=new Array(C+1);for(x=j=0;x<h-1;x++)for(b[x]=j,D=0;D<1<<y[x];D++)F[j++]=x;for(F[j-1]=x,x=q=0;x<16;x++)for(X[x]=q,D=0;D<1<<P[x];D++)v[q++]=x;for(q>>=7;x<u;x++)for(X[x]=q<<7,D=0;D<1<<P[x]-7;D++)v[256+q++]=x;for(W=0;W<=C;W++)te[W]=0;for(D=0;D<=143;)B[2*D+1]=8,D++,te[8]++;for(;D<=255;)B[2*D+1]=9,D++,te[9]++;for(;D<=279;)B[2*D+1]=7,D++,te[7]++;for(;D<=287;)B[2*D+1]=8,D++,te[8]++;for(ye(B,d+1,te),D=0;D<u;D++)O[2*D+1]=5,O[2*D]=Fe(D,5);Z=new ne(B,y,I+1,d,C),z=new ne(O,P,0,u,C),J=new ne(new Array(0),_,0,f,R)}(),G=!0),L.l_desc=new V(L.dyn_ltree,Z),L.d_desc=new V(L.dyn_dtree,z),L.bl_desc=new V(L.bl_tree,J),L.bi_buf=0,L.bi_valid=0,re(L)},i._tr_stored_block=w,i._tr_flush_block=function(L,D,W,j){var x,q,te=0;0<L.level?(L.strm.data_type===2&&(L.strm.data_type=function(Q){var oe,Te=4093624447;for(oe=0;oe<=31;oe++,Te>>>=1)if(1&Te&&Q.dyn_ltree[2*oe]!==0)return r;if(Q.dyn_ltree[18]!==0||Q.dyn_ltree[20]!==0||Q.dyn_ltree[26]!==0)return o;for(oe=32;oe<I;oe++)if(Q.dyn_ltree[2*oe]!==0)return o;return r}(L)),ve(L,L.l_desc),ve(L,L.d_desc),te=function(Q){var oe;for(g(Q,Q.dyn_ltree,Q.l_desc.max_code),g(Q,Q.dyn_dtree,Q.d_desc.max_code),ve(Q,Q.bl_desc),oe=f-1;3<=oe&&Q.bl_tree[2*M[oe]+1]===0;oe--);return Q.opt_len+=3*(oe+1)+5+5+4,oe}(L),x=L.opt_len+3+7>>>3,(q=L.static_len+3+7>>>3)<=x&&(x=q)):x=q=W+5,W+4<=x&&D!==-1?w(L,D,W,j):L.strategy===4||q===x?(ee(L,2+(j?1:0),3),We(L,B,O)):(ee(L,4+(j?1:0),3),function(Q,oe,Te,de){var Xe;for(ee(Q,oe-257,5),ee(Q,Te-1,5),ee(Q,de-4,4),Xe=0;Xe<de;Xe++)ee(Q,Q.bl_tree[2*M[Xe]+1],3);H(Q,Q.dyn_ltree,oe-1),H(Q,Q.dyn_dtree,Te-1)}(L,L.l_desc.max_code+1,L.d_desc.max_code+1,te+1),We(L,L.dyn_ltree,L.dyn_dtree)),re(L),j&&ue(L)},i._tr_tally=function(L,D,W){return L.pending_buf[L.d_buf+2*L.last_lit]=D>>>8&255,L.pending_buf[L.d_buf+2*L.last_lit+1]=255&D,L.pending_buf[L.l_buf+L.last_lit]=255&W,L.last_lit++,D===0?L.dyn_ltree[2*W]++:(L.matches++,D--,L.dyn_ltree[2*(F[W]+I+1)]++,L.dyn_dtree[2*Y(D)]++),L.last_lit===L.lit_bufsize-1},i._tr_align=function(L){ee(L,2,3),K(L,A,B),function(D){D.bi_valid===16?(ie(D,D.bi_buf),D.bi_buf=0,D.bi_valid=0):8<=D.bi_valid&&(D.pending_buf[D.pending++]=255&D.bi_buf,D.bi_buf>>=8,D.bi_valid-=8)}(L)}},{"../utils/common":41}],53:[function(t,s,i){s.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,s,i){(function(n){(function(r,o){if(!r.setImmediate){var a,c,h,I,d=1,u={},f=!1,E=r.document,C=Object.getPrototypeOf&&Object.getPrototypeOf(r);C=C&&C.setTimeout?C:r,a={}.toString.call(r.process)==="[object process]"?function(m){process.nextTick(function(){R(m)})}:function(){if(r.postMessage&&!r.importScripts){var m=!0,S=r.onmessage;return r.onmessage=function(){m=!1},r.postMessage("","*"),r.onmessage=S,m}}()?(I="setImmediate$"+Math.random()+"$",r.addEventListener?r.addEventListener("message",A,!1):r.attachEvent("onmessage",A),function(m){r.postMessage(I+m,"*")}):r.MessageChannel?((h=new MessageChannel).port1.onmessage=function(m){R(m.data)},function(m){h.port2.postMessage(m)}):E&&"onreadystatechange"in E.createElement("script")?(c=E.documentElement,function(m){var S=E.createElement("script");S.onreadystatechange=function(){R(m),S.onreadystatechange=null,c.removeChild(S),S=null},c.appendChild(S)}):function(m){setTimeout(R,0,m)},C.setImmediate=function(m){typeof m!="function"&&(m=new Function(""+m));for(var S=new Array(arguments.length-1),N=0;N<S.length;N++)S[N]=arguments[N+1];var y={callback:m,args:S};return u[d]=y,a(d),d++},C.clearImmediate=T}function T(m){delete u[m]}function R(m){if(f)setTimeout(R,0,m);else{var S=u[m];if(S){f=!0;try{(function(N){var y=N.callback,P=N.args;switch(P.length){case 0:y();break;case 1:y(P[0]);break;case 2:y(P[0],P[1]);break;case 3:y(P[0],P[1],P[2]);break;default:y.apply(o,P)}})(S)}finally{T(m),f=!1}}}}function A(m){m.source===r&&typeof m.data=="string"&&m.data.indexOf(I)===0&&R(+m.data.slice(I.length))}})(typeof self>"u"?n===void 0?this:n:self)}).call(this,typeof Ti<"u"?Ti:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(qo);var ph=qo.exports;const Jr=fh(ph);var nr={},Bi={};(function(l){const e=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",t=e+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",s="["+e+"]["+t+"]*",i=new RegExp("^"+s+"$"),n=function(o,a){const c=[];let h=a.exec(o);for(;h;){const I=[];I.startIndex=a.lastIndex-h[0].length;const d=h.length;for(let u=0;u<d;u++)I.push(h[u]);c.push(I),h=a.exec(o)}return c},r=function(o){const a=i.exec(o);return!(a===null||typeof a>"u")};l.isExist=function(o){return typeof o<"u"},l.isEmptyObject=function(o){return Object.keys(o).length===0},l.merge=function(o,a,c){if(a){const h=Object.keys(a),I=h.length;for(let d=0;d<I;d++)c==="strict"?o[h[d]]=[a[h[d]]]:o[h[d]]=a[h[d]]}},l.getValue=function(o){return l.isExist(o)?o:""},l.isName=r,l.getAllMatches=n,l.nameRegexp=s})(Bi);const rr=Bi,Ch={allowBooleanAttributes:!1,unpairedTags:[]};nr.validate=function(l,e){e=Object.assign({},Ch,e);const t=[];let s=!1,i=!1;l[0]==="\uFEFF"&&(l=l.substr(1));for(let n=0;n<l.length;n++)if(l[n]==="<"&&l[n+1]==="?"){if(n+=2,n=to(l,n),n.err)return n}else if(l[n]==="<"){let r=n;if(n++,l[n]==="!"){n=so(l,n);continue}else{let o=!1;l[n]==="/"&&(o=!0,n++);let a="";for(;n<l.length&&l[n]!==">"&&l[n]!==" "&&l[n]!=="	"&&l[n]!==`
`&&l[n]!=="\r";n++)a+=l[n];if(a=a.trim(),a[a.length-1]==="/"&&(a=a.substring(0,a.length-1),n--),!Oh(a)){let I;return a.trim().length===0?I="Invalid space after '<'.":I="Tag '"+a+"' is an invalid name.",Le("InvalidTag",I,Be(l,n))}const c=Rh(l,n);if(c===!1)return Le("InvalidAttr","Attributes for '"+a+"' have open quote.",Be(l,n));let h=c.value;if(n=c.index,h[h.length-1]==="/"){const I=n-h.length;h=h.substring(0,h.length-1);const d=io(h,e);if(d===!0)s=!0;else return Le(d.err.code,d.err.msg,Be(l,I+d.err.line))}else if(o)if(c.tagClosed){if(h.trim().length>0)return Le("InvalidTag","Closing tag '"+a+"' can't have attributes or invalid starting.",Be(l,r));if(t.length===0)return Le("InvalidTag","Closing tag '"+a+"' has not been opened.",Be(l,r));{const I=t.pop();if(a!==I.tagName){let d=Be(l,I.tagStartPos);return Le("InvalidTag","Expected closing tag '"+I.tagName+"' (opened in line "+d.line+", col "+d.col+") instead of closing tag '"+a+"'.",Be(l,r))}t.length==0&&(i=!0)}}else return Le("InvalidTag","Closing tag '"+a+"' doesn't have proper closing.",Be(l,n));else{const I=io(h,e);if(I!==!0)return Le(I.err.code,I.err.msg,Be(l,n-h.length+I.err.line));if(i===!0)return Le("InvalidXml","Multiple possible root nodes found.",Be(l,n));e.unpairedTags.indexOf(a)!==-1||t.push({tagName:a,tagStartPos:r}),s=!0}for(n++;n<l.length;n++)if(l[n]==="<")if(l[n+1]==="!"){n++,n=so(l,n);continue}else if(l[n+1]==="?"){if(n=to(l,++n),n.err)return n}else break;else if(l[n]==="&"){const I=Sh(l,n);if(I==-1)return Le("InvalidChar","char '&' is not expected.",Be(l,n));n=I}else if(i===!0&&!eo(l[n]))return Le("InvalidXml","Extra text at the end",Be(l,n));l[n]==="<"&&n--}}else{if(eo(l[n]))continue;return Le("InvalidChar","char '"+l[n]+"' is not expected.",Be(l,n))}if(s){if(t.length==1)return Le("InvalidTag","Unclosed tag '"+t[0].tagName+"'.",Be(l,t[0].tagStartPos));if(t.length>0)return Le("InvalidXml","Invalid '"+JSON.stringify(t.map(n=>n.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return Le("InvalidXml","Start tag expected.",1);return!0};function eo(l){return l===" "||l==="	"||l===`
`||l==="\r"}function to(l,e){const t=e;for(;e<l.length;e++)if(l[e]=="?"||l[e]==" "){const s=l.substr(t,e-t);if(e>5&&s==="xml")return Le("InvalidXml","XML declaration allowed only at the start of the document.",Be(l,e));if(l[e]=="?"&&l[e+1]==">"){e++;break}else continue}return e}function so(l,e){if(l.length>e+5&&l[e+1]==="-"&&l[e+2]==="-"){for(e+=3;e<l.length;e++)if(l[e]==="-"&&l[e+1]==="-"&&l[e+2]===">"){e+=2;break}}else if(l.length>e+8&&l[e+1]==="D"&&l[e+2]==="O"&&l[e+3]==="C"&&l[e+4]==="T"&&l[e+5]==="Y"&&l[e+6]==="P"&&l[e+7]==="E"){let t=1;for(e+=8;e<l.length;e++)if(l[e]==="<")t++;else if(l[e]===">"&&(t--,t===0))break}else if(l.length>e+9&&l[e+1]==="["&&l[e+2]==="C"&&l[e+3]==="D"&&l[e+4]==="A"&&l[e+5]==="T"&&l[e+6]==="A"&&l[e+7]==="["){for(e+=8;e<l.length;e++)if(l[e]==="]"&&l[e+1]==="]"&&l[e+2]===">"){e+=2;break}}return e}const Th='"',mh="'";function Rh(l,e){let t="",s="",i=!1;for(;e<l.length;e++){if(l[e]===Th||l[e]===mh)s===""?s=l[e]:s!==l[e]||(s="");else if(l[e]===">"&&s===""){i=!0;break}t+=l[e]}return s!==""?!1:{value:t,index:e,tagClosed:i}}const gh=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function io(l,e){const t=rr.getAllMatches(l,gh),s={};for(let i=0;i<t.length;i++){if(t[i][1].length===0)return Le("InvalidAttr","Attribute '"+t[i][2]+"' has no space in starting.",vs(t[i]));if(t[i][3]!==void 0&&t[i][4]===void 0)return Le("InvalidAttr","Attribute '"+t[i][2]+"' is without value.",vs(t[i]));if(t[i][3]===void 0&&!e.allowBooleanAttributes)return Le("InvalidAttr","boolean attribute '"+t[i][2]+"' is not allowed.",vs(t[i]));const n=t[i][2];if(!Ah(n))return Le("InvalidAttr","Attribute '"+n+"' is an invalid name.",vs(t[i]));if(!s.hasOwnProperty(n))s[n]=1;else return Le("InvalidAttr","Attribute '"+n+"' is repeated.",vs(t[i]))}return!0}function Fh(l,e){let t=/\d/;for(l[e]==="x"&&(e++,t=/[\da-fA-F]/);e<l.length;e++){if(l[e]===";")return e;if(!l[e].match(t))break}return-1}function Sh(l,e){if(e++,l[e]===";")return-1;if(l[e]==="#")return e++,Fh(l,e);let t=0;for(;e<l.length;e++,t++)if(!(l[e].match(/\w/)&&t<20)){if(l[e]===";")break;return-1}return e}function Le(l,e,t){return{err:{code:l,msg:e,line:t.line||t,col:t.col}}}function Ah(l){return rr.isName(l)}function Oh(l){return rr.isName(l)}function Be(l,e){const t=l.substring(0,e).split(/\r?\n/);return{line:t.length,col:t[t.length-1].length+1}}function vs(l){return l.startIndex+l[1].length}var or={};const Qo={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(l,e){return e},attributeValueProcessor:function(l,e){return e},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(l,e,t){return l}},yh=function(l){return Object.assign({},Qo,l)};or.buildOptions=yh;or.defaultOptions=Qo;class Nh{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}var Lh=Nh;const _h=Bi;function wh(l,e){const t={};if(l[e+3]==="O"&&l[e+4]==="C"&&l[e+5]==="T"&&l[e+6]==="Y"&&l[e+7]==="P"&&l[e+8]==="E"){e=e+9;let s=1,i=!1,n=!1,r="";for(;e<l.length;e++)if(l[e]==="<"&&!n){if(i&&Mh(l,e))e+=7,[entityName,val,e]=Ph(l,e+1),val.indexOf("&")===-1&&(t[xh(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(i&&Dh(l,e))e+=8;else if(i&&bh(l,e))e+=8;else if(i&&Uh(l,e))e+=9;else if(vh)n=!0;else throw new Error("Invalid DOCTYPE");s++,r=""}else if(l[e]===">"){if(n?l[e-1]==="-"&&l[e-2]==="-"&&(n=!1,s--):s--,s===0)break}else l[e]==="["?i=!0:r+=l[e];if(s!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:t,i:e}}function Ph(l,e){let t="";for(;e<l.length&&l[e]!=="'"&&l[e]!=='"';e++)t+=l[e];if(t=t.trim(),t.indexOf(" ")!==-1)throw new Error("External entites are not supported");const s=l[e++];let i="";for(;e<l.length&&l[e]!==s;e++)i+=l[e];return[t,i,e]}function vh(l,e){return l[e+1]==="!"&&l[e+2]==="-"&&l[e+3]==="-"}function Mh(l,e){return l[e+1]==="!"&&l[e+2]==="E"&&l[e+3]==="N"&&l[e+4]==="T"&&l[e+5]==="I"&&l[e+6]==="T"&&l[e+7]==="Y"}function Dh(l,e){return l[e+1]==="!"&&l[e+2]==="E"&&l[e+3]==="L"&&l[e+4]==="E"&&l[e+5]==="M"&&l[e+6]==="E"&&l[e+7]==="N"&&l[e+8]==="T"}function bh(l,e){return l[e+1]==="!"&&l[e+2]==="A"&&l[e+3]==="T"&&l[e+4]==="T"&&l[e+5]==="L"&&l[e+6]==="I"&&l[e+7]==="S"&&l[e+8]==="T"}function Uh(l,e){return l[e+1]==="!"&&l[e+2]==="N"&&l[e+3]==="O"&&l[e+4]==="T"&&l[e+5]==="A"&&l[e+6]==="T"&&l[e+7]==="I"&&l[e+8]==="O"&&l[e+9]==="N"}function xh(l){if(_h.isName(l))return l;throw new Error(`Invalid entity name ${l}`)}var Bh=wh;const Yh=/^[-+]?0x[a-fA-F0-9]+$/,Vh=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt);!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const Gh={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function zh(l,e={}){if(e=Object.assign({},Gh,e),!l||typeof l!="string")return l;let t=l.trim();if(e.skipLike!==void 0&&e.skipLike.test(t))return l;if(e.hex&&Yh.test(t))return Number.parseInt(t,16);{const s=Vh.exec(t);if(s){const i=s[1],n=s[2];let r=kh(s[3]);const o=s[4]||s[6];if(!e.leadingZeros&&n.length>0&&i&&t[2]!=="."||!e.leadingZeros&&n.length>0&&!i&&t[1]!==".")return l;{const a=Number(t),c=""+a;return c.search(/[eE]/)!==-1||o?e.eNotation?a:l:t.indexOf(".")!==-1?c==="0"&&r===""||c===r||i&&c==="-"+r?a:l:n?r===c||i+r===c?a:l:t===c||t===i+c?a:l}}else return l}}function kh(l){return l&&l.indexOf(".")!==-1&&(l=l.replace(/0+$/,""),l==="."?l="0":l[0]==="."?l="0"+l:l[l.length-1]==="."&&(l=l.substr(0,l.length-1))),l}var Hh=zh;const Ko=Bi,Ms=Lh,Wh=Bh,Xh=Hh;let jh=class{constructor(l){this.options=l,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(e,t)=>String.fromCharCode(Number.parseInt(t,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(e,t)=>String.fromCharCode(Number.parseInt(t,16))}},this.addExternalEntities=Zh,this.parseXml=Jh,this.parseTextData=$h,this.resolveNameSpace=qh,this.buildAttributesMap=Kh,this.isItStopNode=iu,this.replaceEntitiesValue=tu,this.readStopNodeData=ru,this.saveTextToParentTag=su,this.addChild=eu}};function Zh(l){const e=Object.keys(l);for(let t=0;t<e.length;t++){const s=e[t];this.lastEntities[s]={regex:new RegExp("&"+s+";","g"),val:l[s]}}}function $h(l,e,t,s,i,n,r){if(l!==void 0&&(this.options.trimValues&&!s&&(l=l.trim()),l.length>0)){r||(l=this.replaceEntitiesValue(l));const o=this.options.tagValueProcessor(e,l,t,i,n);return o==null?l:typeof o!=typeof l||o!==l?o:this.options.trimValues?yn(l,this.options.parseTagValue,this.options.numberParseOptions):l.trim()===l?yn(l,this.options.parseTagValue,this.options.numberParseOptions):l}}function qh(l){if(this.options.removeNSPrefix){const e=l.split(":"),t=l.charAt(0)==="/"?"/":"";if(e[0]==="xmlns")return"";e.length===2&&(l=t+e[1])}return l}const Qh=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function Kh(l,e,t){if(!this.options.ignoreAttributes&&typeof l=="string"){const s=Ko.getAllMatches(l,Qh),i=s.length,n={};for(let r=0;r<i;r++){const o=this.resolveNameSpace(s[r][1]);let a=s[r][4],c=this.options.attributeNamePrefix+o;if(o.length)if(this.options.transformAttributeName&&(c=this.options.transformAttributeName(c)),c==="__proto__"&&(c="#__proto__"),a!==void 0){this.options.trimValues&&(a=a.trim()),a=this.replaceEntitiesValue(a);const h=this.options.attributeValueProcessor(o,a,e);h==null?n[c]=a:typeof h!=typeof a||h!==a?n[c]=h:n[c]=yn(a,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(n[c]=!0)}if(!Object.keys(n).length)return;if(this.options.attributesGroupName){const r={};return r[this.options.attributesGroupName]=n,r}return n}}const Jh=function(l){l=l.replace(/\r\n?/g,`
`);const e=new Ms("!xml");let t=e,s="",i="";for(let n=0;n<l.length;n++)if(l[n]==="<")if(l[n+1]==="/"){const r=Vt(l,">",n,"Closing Tag is not closed.");let o=l.substring(n+2,r).trim();if(this.options.removeNSPrefix){const h=o.indexOf(":");h!==-1&&(o=o.substr(h+1))}this.options.transformTagName&&(o=this.options.transformTagName(o)),t&&(s=this.saveTextToParentTag(s,t,i));const a=i.substring(i.lastIndexOf(".")+1);if(o&&this.options.unpairedTags.indexOf(o)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${o}>`);let c=0;a&&this.options.unpairedTags.indexOf(a)!==-1?(c=i.lastIndexOf(".",i.lastIndexOf(".")-1),this.tagsNodeStack.pop()):c=i.lastIndexOf("."),i=i.substring(0,c),t=this.tagsNodeStack.pop(),s="",n=r}else if(l[n+1]==="?"){let r=On(l,n,!1,"?>");if(!r)throw new Error("Pi Tag is not closed.");if(s=this.saveTextToParentTag(s,t,i),!(this.options.ignoreDeclaration&&r.tagName==="?xml"||this.options.ignorePiTags)){const o=new Ms(r.tagName);o.add(this.options.textNodeName,""),r.tagName!==r.tagExp&&r.attrExpPresent&&(o[":@"]=this.buildAttributesMap(r.tagExp,i,r.tagName)),this.addChild(t,o,i)}n=r.closeIndex+1}else if(l.substr(n+1,3)==="!--"){const r=Vt(l,"-->",n+4,"Comment is not closed.");if(this.options.commentPropName){const o=l.substring(n+4,r-2);s=this.saveTextToParentTag(s,t,i),t.add(this.options.commentPropName,[{[this.options.textNodeName]:o}])}n=r}else if(l.substr(n+1,2)==="!D"){const r=Wh(l,n);this.docTypeEntities=r.entities,n=r.i}else if(l.substr(n+1,2)==="!["){const r=Vt(l,"]]>",n,"CDATA is not closed.")-2,o=l.substring(n+9,r);s=this.saveTextToParentTag(s,t,i);let a=this.parseTextData(o,t.tagname,i,!0,!1,!0,!0);a==null&&(a=""),this.options.cdataPropName?t.add(this.options.cdataPropName,[{[this.options.textNodeName]:o}]):t.add(this.options.textNodeName,a),n=r+2}else{let r=On(l,n,this.options.removeNSPrefix),o=r.tagName;const a=r.rawTagName;let c=r.tagExp,h=r.attrExpPresent,I=r.closeIndex;this.options.transformTagName&&(o=this.options.transformTagName(o)),t&&s&&t.tagname!=="!xml"&&(s=this.saveTextToParentTag(s,t,i,!1));const d=t;if(d&&this.options.unpairedTags.indexOf(d.tagname)!==-1&&(t=this.tagsNodeStack.pop(),i=i.substring(0,i.lastIndexOf("."))),o!==e.tagname&&(i+=i?"."+o:o),this.isItStopNode(this.options.stopNodes,i,o)){let u="";if(c.length>0&&c.lastIndexOf("/")===c.length-1)o[o.length-1]==="/"?(o=o.substr(0,o.length-1),i=i.substr(0,i.length-1),c=o):c=c.substr(0,c.length-1),n=r.closeIndex;else if(this.options.unpairedTags.indexOf(o)!==-1)n=r.closeIndex;else{const E=this.readStopNodeData(l,a,I+1);if(!E)throw new Error(`Unexpected end of ${a}`);n=E.i,u=E.tagContent}const f=new Ms(o);o!==c&&h&&(f[":@"]=this.buildAttributesMap(c,i,o)),u&&(u=this.parseTextData(u,o,i,!0,h,!0,!0)),i=i.substr(0,i.lastIndexOf(".")),f.add(this.options.textNodeName,u),this.addChild(t,f,i)}else{if(c.length>0&&c.lastIndexOf("/")===c.length-1){o[o.length-1]==="/"?(o=o.substr(0,o.length-1),i=i.substr(0,i.length-1),c=o):c=c.substr(0,c.length-1),this.options.transformTagName&&(o=this.options.transformTagName(o));const u=new Ms(o);o!==c&&h&&(u[":@"]=this.buildAttributesMap(c,i,o)),this.addChild(t,u,i),i=i.substr(0,i.lastIndexOf("."))}else{const u=new Ms(o);this.tagsNodeStack.push(t),o!==c&&h&&(u[":@"]=this.buildAttributesMap(c,i,o)),this.addChild(t,u,i),t=u}s="",n=I}}else s+=l[n];return e.child};function eu(l,e,t){const s=this.options.updateTag(e.tagname,t,e[":@"]);s===!1||(typeof s=="string"&&(e.tagname=s),l.addChild(e))}const tu=function(l){if(this.options.processEntities){for(let e in this.docTypeEntities){const t=this.docTypeEntities[e];l=l.replace(t.regx,t.val)}for(let e in this.lastEntities){const t=this.lastEntities[e];l=l.replace(t.regex,t.val)}if(this.options.htmlEntities)for(let e in this.htmlEntities){const t=this.htmlEntities[e];l=l.replace(t.regex,t.val)}l=l.replace(this.ampEntity.regex,this.ampEntity.val)}return l};function su(l,e,t,s){return l&&(s===void 0&&(s=Object.keys(e.child).length===0),l=this.parseTextData(l,e.tagname,t,!1,e[":@"]?Object.keys(e[":@"]).length!==0:!1,s),l!==void 0&&l!==""&&e.add(this.options.textNodeName,l),l=""),l}function iu(l,e,t){const s="*."+t;for(const i in l){const n=l[i];if(s===n||e===n)return!0}return!1}function nu(l,e,t=">"){let s,i="";for(let n=e;n<l.length;n++){let r=l[n];if(s)r===s&&(s="");else if(r==='"'||r==="'")s=r;else if(r===t[0])if(t[1]){if(l[n+1]===t[1])return{data:i,index:n}}else return{data:i,index:n};else r==="	"&&(r=" ");i+=r}}function Vt(l,e,t,s){const i=l.indexOf(e,t);if(i===-1)throw new Error(s);return i+e.length-1}function On(l,e,t,s=">"){const i=nu(l,e+1,s);if(!i)return;let n=i.data;const r=i.index,o=n.search(/\s/);let a=n,c=!0;o!==-1&&(a=n.substring(0,o),n=n.substring(o+1).trimStart());const h=a;if(t){const I=a.indexOf(":");I!==-1&&(a=a.substr(I+1),c=a!==i.data.substr(I+1))}return{tagName:a,tagExp:n,closeIndex:r,attrExpPresent:c,rawTagName:h}}function ru(l,e,t){const s=t;let i=1;for(;t<l.length;t++)if(l[t]==="<")if(l[t+1]==="/"){const n=Vt(l,">",t,`${e} is not closed`);if(l.substring(t+2,n).trim()===e&&(i--,i===0))return{tagContent:l.substring(s,t),i:n};t=n}else if(l[t+1]==="?")t=Vt(l,"?>",t+1,"StopNode is not closed.");else if(l.substr(t+1,3)==="!--")t=Vt(l,"-->",t+3,"StopNode is not closed.");else if(l.substr(t+1,2)==="![")t=Vt(l,"]]>",t,"StopNode is not closed.")-2;else{const n=On(l,t,">");n&&((n&&n.tagName)===e&&n.tagExp[n.tagExp.length-1]!=="/"&&i++,t=n.closeIndex)}}function yn(l,e,t){if(e&&typeof l=="string"){const s=l.trim();return s==="true"?!0:s==="false"?!1:Xh(l,t)}else return Ko.isExist(l)?l:""}var ou=jh,Jo={};function au(l,e){return ea(l,e)}function ea(l,e,t){let s;const i={};for(let n=0;n<l.length;n++){const r=l[n],o=lu(r);let a="";if(t===void 0?a=o:a=t+"."+o,o===e.textNodeName)s===void 0?s=r[o]:s+=""+r[o];else{if(o===void 0)continue;if(r[o]){let c=ea(r[o],e,a);const h=hu(c,e);r[":@"]?cu(c,r[":@"],a,e):Object.keys(c).length===1&&c[e.textNodeName]!==void 0&&!e.alwaysCreateTextNode?c=c[e.textNodeName]:Object.keys(c).length===0&&(e.alwaysCreateTextNode?c[e.textNodeName]="":c=""),i[o]!==void 0&&i.hasOwnProperty(o)?(Array.isArray(i[o])||(i[o]=[i[o]]),i[o].push(c)):e.isArray(o,a,h)?i[o]=[c]:i[o]=c}}}return typeof s=="string"?s.length>0&&(i[e.textNodeName]=s):s!==void 0&&(i[e.textNodeName]=s),i}function lu(l){const e=Object.keys(l);for(let t=0;t<e.length;t++){const s=e[t];if(s!==":@")return s}}function cu(l,e,t,s){if(e){const i=Object.keys(e),n=i.length;for(let r=0;r<n;r++){const o=i[r];s.isArray(o,t+"."+o,!0,!0)?l[o]=[e[o]]:l[o]=e[o]}}}function hu(l,e){const{textNodeName:t}=e,s=Object.keys(l).length;return!!(s===0||s===1&&(l[t]||typeof l[t]=="boolean"||l[t]===0))}Jo.prettify=au;const{buildOptions:uu}=or,du=ou,{prettify:Iu}=Jo,Eu=nr;let fu=class{constructor(l){this.externalEntities={},this.options=uu(l)}parse(l,e){if(typeof l!="string")if(l.toString)l=l.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(e){e===!0&&(e={});const i=Eu.validate(l,e);if(i!==!0)throw Error(`${i.err.msg}:${i.err.line}:${i.err.col}`)}const t=new du(this.options);t.addExternalEntities(this.externalEntities);const s=t.parseXml(l);return this.options.preserveOrder||s===void 0?s:Iu(s,this.options)}addEntity(l,e){if(e.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(l.indexOf("&")!==-1||l.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(e==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[l]=e}};var pu=fu;const Cu=`
`;function Tu(l,e){let t="";return e.format&&e.indentBy.length>0&&(t=Cu),ta(l,e,"",t)}function ta(l,e,t,s){let i="",n=!1;for(let r=0;r<l.length;r++){const o=l[r],a=mu(o);if(a===void 0)continue;let c="";if(t.length===0?c=a:c=`${t}.${a}`,a===e.textNodeName){let f=o[a];Ru(c,e)||(f=e.tagValueProcessor(a,f),f=sa(f,e)),n&&(i+=s),i+=f,n=!1;continue}else if(a===e.cdataPropName){n&&(i+=s),i+=`<![CDATA[${o[a][0][e.textNodeName]}]]>`,n=!1;continue}else if(a===e.commentPropName){i+=s+`<!--${o[a][0][e.textNodeName]}-->`,n=!0;continue}else if(a[0]==="?"){const f=no(o[":@"],e),E=a==="?xml"?"":s;let C=o[a][0][e.textNodeName];C=C.length!==0?" "+C:"",i+=E+`<${a}${C}${f}?>`,n=!0;continue}let h=s;h!==""&&(h+=e.indentBy);const I=no(o[":@"],e),d=s+`<${a}${I}`,u=ta(o[a],e,c,h);e.unpairedTags.indexOf(a)!==-1?e.suppressUnpairedNode?i+=d+">":i+=d+"/>":(!u||u.length===0)&&e.suppressEmptyNode?i+=d+"/>":u&&u.endsWith(">")?i+=d+`>${u}${s}</${a}>`:(i+=d+">",u&&s!==""&&(u.includes("/>")||u.includes("</"))?i+=s+e.indentBy+u+s:i+=u,i+=`</${a}>`),n=!0}return i}function mu(l){const e=Object.keys(l);for(let t=0;t<e.length;t++){const s=e[t];if(l.hasOwnProperty(s)&&s!==":@")return s}}function no(l,e){let t="";if(l&&!e.ignoreAttributes)for(let s in l){if(!l.hasOwnProperty(s))continue;let i=e.attributeValueProcessor(s,l[s]);i=sa(i,e),i===!0&&e.suppressBooleanAttributes?t+=` ${s.substr(e.attributeNamePrefix.length)}`:t+=` ${s.substr(e.attributeNamePrefix.length)}="${i}"`}return t}function Ru(l,e){l=l.substr(0,l.length-e.textNodeName.length-1);let t=l.substr(l.lastIndexOf(".")+1);for(let s in e.stopNodes)if(e.stopNodes[s]===l||e.stopNodes[s]==="*."+t)return!0;return!1}function sa(l,e){if(l&&l.length>0&&e.processEntities)for(let t=0;t<e.entities.length;t++){const s=e.entities[t];l=l.replace(s.regex,s.val)}return l}var gu=Tu;const Fu=gu,Su={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(l,e){return e},attributeValueProcessor:function(l,e){return e},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function Mt(l){this.options=Object.assign({},Su,l),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=yu),this.processTextOrObjNode=Au,this.options.format?(this.indentate=Ou,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}Mt.prototype.build=function(l){return this.options.preserveOrder?Fu(l,this.options):(Array.isArray(l)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(l={[this.options.arrayNodeName]:l}),this.j2x(l,0).val)};Mt.prototype.j2x=function(l,e){let t="",s="";for(let i in l)if(Object.prototype.hasOwnProperty.call(l,i))if(typeof l[i]>"u")this.isAttribute(i)&&(s+="");else if(l[i]===null)this.isAttribute(i)?s+="":i[0]==="?"?s+=this.indentate(e)+"<"+i+"?"+this.tagEndChar:s+=this.indentate(e)+"<"+i+"/"+this.tagEndChar;else if(l[i]instanceof Date)s+=this.buildTextValNode(l[i],i,"",e);else if(typeof l[i]!="object"){const n=this.isAttribute(i);if(n)t+=this.buildAttrPairStr(n,""+l[i]);else if(i===this.options.textNodeName){let r=this.options.tagValueProcessor(i,""+l[i]);s+=this.replaceEntitiesValue(r)}else s+=this.buildTextValNode(l[i],i,"",e)}else if(Array.isArray(l[i])){const n=l[i].length;let r="",o="";for(let a=0;a<n;a++){const c=l[i][a];if(!(typeof c>"u"))if(c===null)i[0]==="?"?s+=this.indentate(e)+"<"+i+"?"+this.tagEndChar:s+=this.indentate(e)+"<"+i+"/"+this.tagEndChar;else if(typeof c=="object")if(this.options.oneListGroup){const h=this.j2x(c,e+1);r+=h.val,this.options.attributesGroupName&&c.hasOwnProperty(this.options.attributesGroupName)&&(o+=h.attrStr)}else r+=this.processTextOrObjNode(c,i,e);else if(this.options.oneListGroup){let h=this.options.tagValueProcessor(i,c);h=this.replaceEntitiesValue(h),r+=h}else r+=this.buildTextValNode(c,i,"",e)}this.options.oneListGroup&&(r=this.buildObjectNode(r,i,o,e)),s+=r}else if(this.options.attributesGroupName&&i===this.options.attributesGroupName){const n=Object.keys(l[i]),r=n.length;for(let o=0;o<r;o++)t+=this.buildAttrPairStr(n[o],""+l[i][n[o]])}else s+=this.processTextOrObjNode(l[i],i,e);return{attrStr:t,val:s}};Mt.prototype.buildAttrPairStr=function(l,e){return e=this.options.attributeValueProcessor(l,""+e),e=this.replaceEntitiesValue(e),this.options.suppressBooleanAttributes&&e==="true"?" "+l:" "+l+'="'+e+'"'};function Au(l,e,t){const s=this.j2x(l,t+1);return l[this.options.textNodeName]!==void 0&&Object.keys(l).length===1?this.buildTextValNode(l[this.options.textNodeName],e,s.attrStr,t):this.buildObjectNode(s.val,e,s.attrStr,t)}Mt.prototype.buildObjectNode=function(l,e,t,s){if(l==="")return e[0]==="?"?this.indentate(s)+"<"+e+t+"?"+this.tagEndChar:this.indentate(s)+"<"+e+t+this.closeTag(e)+this.tagEndChar;{let i="</"+e+this.tagEndChar,n="";return e[0]==="?"&&(n="?",i=""),(t||t==="")&&l.indexOf("<")===-1?this.indentate(s)+"<"+e+t+n+">"+l+i:this.options.commentPropName!==!1&&e===this.options.commentPropName&&n.length===0?this.indentate(s)+`<!--${l}-->`+this.newLine:this.indentate(s)+"<"+e+t+n+this.tagEndChar+l+this.indentate(s)+i}};Mt.prototype.closeTag=function(l){let e="";return this.options.unpairedTags.indexOf(l)!==-1?this.options.suppressUnpairedNode||(e="/"):this.options.suppressEmptyNode?e="/":e=`></${l}`,e};Mt.prototype.buildTextValNode=function(l,e,t,s){if(this.options.cdataPropName!==!1&&e===this.options.cdataPropName)return this.indentate(s)+`<![CDATA[${l}]]>`+this.newLine;if(this.options.commentPropName!==!1&&e===this.options.commentPropName)return this.indentate(s)+`<!--${l}-->`+this.newLine;if(e[0]==="?")return this.indentate(s)+"<"+e+t+"?"+this.tagEndChar;{let i=this.options.tagValueProcessor(e,l);return i=this.replaceEntitiesValue(i),i===""?this.indentate(s)+"<"+e+t+this.closeTag(e)+this.tagEndChar:this.indentate(s)+"<"+e+t+">"+i+"</"+e+this.tagEndChar}};Mt.prototype.replaceEntitiesValue=function(l){if(l&&l.length>0&&this.options.processEntities)for(let e=0;e<this.options.entities.length;e++){const t=this.options.entities[e];l=l.replace(t.regex,t.val)}return l};function Ou(l){return this.options.indentBy.repeat(l)}function yu(l){return l.startsWith(this.options.attributeNamePrefix)&&l!==this.options.textNodeName?l.substr(this.attrPrefixLen):!1}var Nu=Mt;const Lu=nr,_u=pu,wu=Nu;var ia={XMLParser:_u,XMLValidator:Lu,XMLBuilder:wu};class Nn{constructor(e,t){p(this,"date",new Date),p(this,"author"),p(this,"guid",gt.create()),p(this,"viewpoint"),p(this,"modifiedAuthor"),p(this,"modifiedDate"),p(this,"topic"),p(this,"_components"),p(this,"_comment",""),this._components=e,this._comment=t;const s=this._components.get(Ye);this.author=s.config.author}set comment(e){var t;const s=this._components.get(Ye);this._comment=e,this.modifiedDate=new Date,this.modifiedAuthor=s.config.author,(t=this.topic)==null||t.comments.set(this.guid,this)}get comment(){return this._comment}serialize(){let e=null;this.viewpoint&&(e=`<Viewpoint Guid="${this.viewpoint.guid}"/>`);let t=null;this.modifiedDate&&(t=`<ModifiedDate>${this.modifiedDate.toISOString()}</ModifiedDate>`);let s=null;return this.modifiedAuthor&&(s=`<ModifiedAuthor>${this.modifiedAuthor}</ModifiedAuthor>`),`
      <Comment Guid="${this.guid}">
        <Date>${this.date.toISOString()}</Date>
        <Author>${this.author}</Author>
        <Comment>${this.comment}</Comment>
        ${e??""}
        ${s??""}
        ${t??""}
      </Comment>
    `}}const na=class yt{constructor(e){p(this,"guid",gt.create()),p(this,"title",yt.default.title),p(this,"creationDate",new Date),p(this,"creationAuthor",""),p(this,"viewpoints",new Pt),p(this,"relatedTopics",new Pt),p(this,"comments",new rt),p(this,"customData",{}),p(this,"description"),p(this,"serverAssignedId"),p(this,"dueDate"),p(this,"modifiedAuthor"),p(this,"modifiedDate"),p(this,"index"),p(this,"_type",yt.default.type),p(this,"_status",yt.default.status),p(this,"_priority",yt.default.priority),p(this,"_stage",yt.default.stage),p(this,"_assignedTo",yt.default.assignedTo),p(this,"_labels",yt.default.labels),p(this,"_components"),this._components=e;const t=e.get(Ye);this.creationAuthor=t.config.author,this.relatedTopics.guard=s=>s!==this.guid}set type(e){const t=this._components.get(Ye),{strict:s,types:i}=t.config;(!s||i.has(e))&&(this._type=e)}get type(){return this._type}set status(e){const t=this._components.get(Ye),{strict:s,statuses:i}=t.config;(!s||i.has(e))&&(this._status=e)}get status(){return this._status}set priority(e){const t=this._components.get(Ye);if(e){const{strict:s,priorities:i}=t.config;if(!(!s||i.has(e)))return;this._priority=e}else this._priority=e}get priority(){return this._priority}set stage(e){const t=this._components.get(Ye);if(e){const{strict:s,stages:i}=t.config;if(!(!s||i.has(e)))return;this._stage=e}else this._stage=e}get stage(){return this._stage}set assignedTo(e){const t=this._components.get(Ye);if(e){const{strict:s,users:i}=t.config;if(!(!s||i.has(e)))return;this._assignedTo=e}else this._assignedTo=e}get assignedTo(){return this._assignedTo}set labels(e){const t=this._components.get(Ye),{strict:s,labels:i}=t.config;if(s){const n=new Set;for(const r of e)(!s||i.has(r))&&n.add(r);this._labels=n}else this._labels=e}get labels(){return this._labels}get _managerVersion(){return this._components.get(Ye).config.version}set(e){const t=e,s=this;for(const i in e){if(i==="guid")continue;const n=t[i];i in this&&(s[i]=n)}return this._components.get(Ye).list.set(this.guid,this),this}createComment(e,t){const s=new Nn(this._components,e);return s.viewpoint=t,s.topic=this,this.comments.set(s.guid,s),s}createLabelTags(e=this._managerVersion){let t="Labels";e==="2.1"&&(t="Labels"),e==="3"&&(t="Label");let s=[...this.labels].map(i=>`<${t}>${i}</${t}>`).join(`
`);for(const i in this.customData){const n=this.customData[i];typeof n=="string"&&(s+=`
<${t}>${n}</${t}>`)}return e==="2.1"?s:e==="3"?s.length!==0?`<Labels>
${s}
</Labels>`:"<Labels/>":s}createCommentTags(e=this._managerVersion){const t=[...this.comments.values()].map(s=>s.serialize()).join(`
`);return e==="2.1"?t:e==="3"?t.length!==0?`<Comments>
${t}
</Comments>`:"<Comments/>":t}createViewpointTags(e=this._managerVersion){let t="Viewpoints";e==="2.1"&&(t="Viewpoints"),e==="3"&&(t="ViewPoint");const s=this._components.get(pt),i=[...this.viewpoints].map(n=>s.list.get(n)).filter(n=>n).map(n=>`<${t} Guid="${n.guid}">
          <Viewpoint>${n.guid}.bcfv</Viewpoint>
          <Snapshot>${n.guid}.jpeg</Snapshot>
        </${t}>
      `).join(`
`);return e==="2.1"?i:e==="3"?i.length!==0?`<Viewpoints>
${i}
</Viewpoints>`:"<Viewpoints />":i}createRelatedTopicTags(e=this._managerVersion){const t=[...this.relatedTopics].map(s=>`<RelatedTopic Guid="${s}"></RelatedTopic>
      `).join(`
`);return e==="2.1"?t:e==="3"?t.length!==0?`<RelatedTopics>
${t}
</RelatedTopics>`:"<RelatedTopics />":t}serialize(){const e=this._managerVersion;let t=null;this.serverAssignedId&&(t=`ServerAssignedId="${this.serverAssignedId}"`);let s=null;this.priority&&(s=`<Priority>${this.priority}</Priority>`);let i=null;this.index&&e==="2.1"&&(i=`<Index>${this.index}</Index>`);let n=null;this.modifiedDate&&(n=`<ModifiedDate>${this.modifiedDate.toISOString()}</ModifiedDate>`);let r=null;this.modifiedAuthor&&(r=`<ModifiedAuthor>${this.modifiedAuthor}</ModifiedAuthor>`);let o=null;this.dueDate&&(o=`<DueDate>${this.dueDate.toISOString()}</DueDate>`);let a=null;this.assignedTo&&(a=`<AssignedTo>${this.assignedTo}</AssignedTo>`);let c=null;this.description&&(c=`<Description>${this.description}</Description>`);let h=null;this.stage&&(h=`<Stage>${this.stage}</Stage>`);const I=this.createCommentTags(e),d=this.createViewpointTags(e),u=this.createLabelTags(e),f=this.createRelatedTopicTags(e);return`
      <?xml version="1.0" encoding="UTF-8"?>
      <Markup>
        <Topic Guid="${this.guid}" TopicType="${this.type}" TopicStatus="${this.status}" ${t??""}>
          <Title>${this.title}</Title>
          <CreationDate>${this.creationDate.toISOString()}</CreationDate>
          <CreationAuthor>${this.creationAuthor}</CreationAuthor>
          ${s??""}
          ${i??""}
          ${n??""}
          ${r??""}
          ${o??""}
          ${a??""}
          ${c??""}
          ${h??""}
          ${u}
          ${f}
          ${e==="3"?I:""}
          ${e==="3"?d:""}
        </Topic>
        ${e==="2.1"?I:""}
        ${e==="2.1"?d:""}
      </Markup>
    `}};p(na,"default",{title:"BCF Topic",type:"Issue",status:"Active",labels:new Set});let ro=na;const Pu=(l,e)=>{if(e.trim()==="")return;const t=Ye.xmlParser.parse(e).Extensions;if(!t)return;const{Priorities:s,TopicStatuses:i,TopicTypes:n,Users:r}=t;if(s&&s.Priority){const o=Array.isArray(s.Priority)?s.Priority:[s.Priority];for(const a of o)l.config.priorities.add(a)}if(i&&i.TopicStatus){const o=Array.isArray(i.TopicStatus)?i.TopicStatus:[i.TopicStatus];for(const a of o)l.config.statuses.add(a)}if(n&&n.TopicType){const o=Array.isArray(n.TopicType)?n.TopicType:[n.TopicType];for(const a of o)l.config.types.add(a)}if(r&&r.User){const o=Array.isArray(r.User)?r.User:[r.User];for(const a of o)l.config.users.add(a)}};class vu extends Ht{constructor(){super(...arguments),p(this,"_config",{version:{type:"Select",options:new Set(["2.1","3"]),multiple:!1,value:""},author:{type:"Text",value:""},types:{type:"TextSet",value:new Set},statuses:{type:"TextSet",value:new Set},priorities:{type:"TextSet",value:new Set},labels:{type:"TextSet",value:new Set},stages:{type:"TextSet",value:new Set},users:{type:"TextSet",value:new Set},includeSelectionTag:{type:"Boolean",value:!1},updateExtensionsOnImport:{type:"Boolean",value:!1},strict:{type:"Boolean",value:!1},includeAllExtensionsOnExport:{type:"Boolean",value:!1},fallbackVersionOnImport:{type:"Select",multiple:!1,options:new Set(["2.1","3"]),value:""},ignoreIncompleteTopicsOnImport:{type:"Boolean",value:!1}})}get version(){return this._config.version.value}set version(e){this._config.version.value=e}get author(){return this._config.author.value}set author(e){this._config.author.value=e}get types(){return this._config.types.value}set types(e){this._config.types.value=e}get statuses(){return this._config.statuses.value}set statuses(e){this._config.statuses.value=e}get priorities(){return this._config.priorities.value}set priorities(e){this._config.priorities.value=e}get labels(){return this._config.labels.value}set labels(e){this._config.labels.value=e}get stages(){return this._config.stages.value}set stages(e){this._config.stages.value=e}get users(){return this._config.users.value}set users(e){this._config.users.value=e}get includeSelectionTag(){return this._config.includeSelectionTag.value}set includeSelectionTag(e){this._config.includeSelectionTag.value=e}get updateExtensionsOnImport(){return this._config.updateExtensionsOnImport.value}set updateExtensionsOnImport(e){this._config.updateExtensionsOnImport.value=e}get strict(){return this._config.strict.value}set strict(e){this._config.strict.value=e}get includeAllExtensionsOnExport(){return this._config.includeAllExtensionsOnExport.value}set includeAllExtensionsOnExport(e){this._config.includeAllExtensionsOnExport.value=e}get fallbackVersionOnImport(){return this._config.fallbackVersionOnImport.value}set fallbackVersionOnImport(e){this._config.fallbackVersionOnImport.value=e}get ignoreIncompleteTopicsOnImport(){return this._config.ignoreIncompleteTopicsOnImport.value}set ignoreIncompleteTopicsOnImport(e){this._config.ignoreIncompleteTopicsOnImport.value=e}}const Ln=class Us extends Ae{constructor(){super(...arguments),p(this,"enabled",!1),p(this,"_defaultConfig",{author:"jhon.doe@example.com",version:"2.1",types:new Set(["Clash","Failure","Fault","Inquiry","Issue","Remark","Request"]),statuses:new Set(["Active","In Progress","Done","In Review","Closed"]),priorities:new Set(["On hold","Minor","Normal","Major","Critical"]),labels:new Set,stages:new Set,users:new Set,includeSelectionTag:!1,updateExtensionsOnImport:!0,strict:!1,includeAllExtensionsOnExport:!0,fallbackVersionOnImport:"2.1",ignoreIncompleteTopicsOnImport:!1}),p(this,"config",new vu(this,this.components,"BCF Topics",Us.uuid)),p(this,"list",new rt),p(this,"onSetup",new $),p(this,"isSetup",!1),p(this,"onBCFImported",new $),p(this,"onDisposed",new $)}setup(e){if(this.isSetup)return;const t={...this._defaultConfig,...e};this.config.version=t.version,this.config.author=t.author,this.config.types=t.types,this.config.statuses=t.statuses,this.config.priorities=t.priorities,this.config.labels=t.labels,this.config.stages=t.stages,this.config.users=t.users,this.config.includeSelectionTag=t.includeSelectionTag,this.config.updateExtensionsOnImport=t.updateExtensionsOnImport,this.config.strict=t.strict,this.config.includeAllExtensionsOnExport=t.includeAllExtensionsOnExport,this.config.fallbackVersionOnImport=t.fallbackVersionOnImport||"",this.config.ignoreIncompleteTopicsOnImport=t.ignoreIncompleteTopicsOnImport,this.isSetup=!0,this.enabled=!0,this.onSetup.trigger()}create(e){const t=new ro(this.components);return e&&(t.guid=e.guid??t.guid,t.set(e)),this.list.set(t.guid,t),t}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get usedTypes(){const e=[...this.list].map(([t,s])=>s.type);return new Set(e)}get usedStatuses(){const e=[...this.list].map(([t,s])=>s.status);return new Set(e)}get usedPriorities(){const e=[...this.list].map(([t,s])=>s.priority).filter(t=>t);return new Set(e)}get usedStages(){const e=[...this.list].map(([t,s])=>s.stage).filter(t=>t);return new Set(e)}get usedUsers(){const e=[];for(const[t,s]of this.list){e.push(s.creationAuthor),s.assignedTo&&e.push(s.assignedTo),s.modifiedAuthor&&e.push(s.modifiedAuthor);for(const[i,n]of s.comments)e.push(n.author),n.modifiedAuthor&&e.push(n.modifiedAuthor)}return new Set(e)}get usedLabels(){const e=[];for(const[t,s]of this.list)e.push(...s.labels);return new Set(e)}updateExtensions(){for(const[e,t]of this.list){for(const s of t.labels)this.config.labels.add(s);this.config.types.add(t.type),t.priority&&this.config.priorities.add(t.priority),t.stage&&this.config.stages.add(t.stage),this.config.statuses.add(t.status),this.config.users.add(t.creationAuthor),t.assignedTo&&this.config.users.add(t.assignedTo),t.modifiedAuthor&&this.config.users.add(t.modifiedAuthor);for(const[s,i]of t.comments)this.config.users.add(i.author),i.modifiedAuthor&&this.config.users.add(i.modifiedAuthor)}}updateViewpointReferences(){const e=this.components.get(pt);for(const[t,s]of this.list)for(const i of s.viewpoints)e.list.has(i)||s.viewpoints.delete(i)}async export(e=this.list.values()){const t=new Jr;t.file("bcf.version",`<?xml version="1.0" encoding="UTF-8"?>
    <Version VersionId="${this.config.version}" xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/buildingSMART/BCF-XML/release_3_0/Schemas/version.xsd"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    </Version>`),t.file("bcf.extensions",this.serializeExtensions());const s=await(await fetch("https://thatopen.github.io/engine_components/resources/favicon.ico")).arrayBuffer(),i=this.components.get(pt);for(const n of e){const r=t.folder(n.guid);r.file("markup.bcf",n.serialize());for(const o of n.viewpoints){const a=i.list.get(o);a&&(r.file(`${o}.jpeg`,s,{binary:!0}),r.file(`${o}.bcfv`,await a.serialize()))}}return await t.generateAsync({type:"blob"})}serializeExtensions(){const e=[...this.config.types].map(o=>`<TopicType>${o}</TopicType>`).join(`
`),t=[...this.config.statuses].map(o=>`<TopicStatus>${o}</TopicStatus>`).join(`
`),s=[...this.config.priorities].map(o=>`<Priority>${o}</Priority>`).join(`
`),i=[...this.config.labels].map(o=>`<TopicLabel>${o}</TopicLabel>`).join(`
`),n=[...this.config.stages].map(o=>`<Stage>${o}</Stage>`).join(`
`),r=[...this.config.users].map(o=>`<User>${o}</User>`).join(`
`);return`
      <?xml version="1.0" encoding="UTF-8"?>
      <Extensions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="your-schema-location.xsd">
        ${e.length!==0?`<TopicTypes>
${e}
</TopicTypes>`:""}
        ${t.length!==0?`<TopicStatuses>
${t}
</TopicStatuses>`:""}
        ${s.length!==0?`<Priorities>
${s}
</Priorities>`:""}
        ${i.length!==0?`<TopicLabels>
${i}
</TopicLabels>`:""}
        ${n.length!==0?`<Stages>
${n}
</Stages>`:""}
        ${r.length!==0?`<Users>
${r}
</Users>`:""}
      </Extensions>
    `}processMarkupComment(e){const{Guid:t,Date:s,Author:i,Comment:n,Viewpoint:r}=e;if(!(t&&s&&i&&(Nn||r)))return null;const o=this.components.get(pt),a=new Nn(this.components,n??"");return a.guid=t,a.date=new Date(s),a.author=i,a.viewpoint=r!=null&&r.Guid?o.list.get(r.Guid):void 0,a.modifiedAuthor=e.ModifiedAuthor,a.modifiedDate=e.ModifiedDate?new Date(e.ModifiedDate):void 0,a}getMarkupComments(e,t){var s;let i;if(t==="2.1"&&(i=e.Comment),t==="3"&&(i=(s=e.Topic.Comments)==null?void 0:s.Comment),!i)return[];i=Array.isArray(i)?i:[i];const n=i.map(r=>this.processMarkupComment(r)).filter(r=>r);return Array.isArray(n)?n:[n]}getMarkupLabels(e,t){var s;let i;return t==="2.1"&&(i=e.Topic.Labels),t==="3"&&(i=(s=e.Topic.Labels)==null?void 0:s.Label),i?Array.isArray(i)?i:[i]:[]}getMarkupViewpoints(e,t){var s;let i;return t==="2.1"&&(i=e.Viewpoints),t==="3"&&(i=(s=e.Topic.Viewpoints)==null?void 0:s.ViewPoint),i?(i=Array.isArray(i)?i:[i],i):[]}getMarkupRelatedTopics(e,t){var s;let i;return t==="2.1"&&(i=e.Topic.RelatedTopic),t==="3"&&(i=(s=e.Topic.RelatedTopics)==null?void 0:s.RelatedTopic),i?(Array.isArray(i)?i:[i]).map(n=>n.Guid):[]}async load(e,t){var s;const{fallbackVersionOnImport:i,ignoreIncompleteTopicsOnImport:n,updateExtensionsOnImport:r}=this.config,o=new Jr;await o.loadAsync(e);const a=Object.values(o.files);let c=i;const h=a.find(R=>R.name.endsWith(".version"));if(h){const R=await h.async("string"),A=Us.xmlParser.parse(R).Version.VersionId;c=String(A)}if(!(c&&(c==="2.1"||c==="3")))throw new Error(`BCFTopics: ${c} is not supported.`);const I=a.find(R=>R.name.endsWith(".extensions"));if(r&&I){const R=await I.async("string");Pu(this,R)}const d=[],u=this.components.get(pt),f=a.filter(R=>R.name.endsWith(".bcfv"));for(const R of f){const A=await R.async("string"),m=Us.xmlParser.parse(A).VisualizationInfo;if(!m){console.warn("Missing VisualizationInfo in Viewpoint");continue}const S={},{Guid:N,ClippingPlanes:y,Components:P,OrthogonalCamera:_,PerspectiveCamera:M}=m;if(N&&(S.guid=N),P){const{Selection:O,Visibility:v}=P;if(O&&O.Component){const b=Array.isArray(O.Component)?O.Component:[O.Component];S.selectionComponents=b.map(Z=>Z.IfcGuid).filter(Z=>Z)}if(v&&"DefaultVisibility"in v&&(S.defaultVisibility=v.DefaultVisibility),v&&v.Exceptions&&"Component"in v.Exceptions){const{Component:b}=v.Exceptions,Z=Array.isArray(b)?b:[b];S.exceptionComponents=Z.map(z=>z.IfcGuid).filter(z=>z)}let F;c==="2.1"&&(F=P.ViewSetupHints),c==="3"&&(F=(s=P.Visibility)==null?void 0:s.ViewSetupHints),F&&("OpeningsVisible"in F&&(S.openingsVisible=F.OpeningsVisible),"SpacesVisible"in F&&(S.spacesVisible=F.SpacesVisible),"SpaceBoundariesVisible"in F&&(S.spaceBoundariesVisible=F.SpaceBoundariesVisible))}if(_||M){const O=m.PerspectiveCamera??m.OrthogonalCamera,{CameraViewPoint:v,CameraDirection:F}=O,b=new U(Number(v.X),Number(v.Z),Number(-v.Y)),Z=new U(Number(F.X),Number(F.Z),Number(-F.Y)),z={position:{x:b.x,y:b.y,z:b.z},direction:{x:Z.x,y:Z.y,z:Z.z},aspectRatio:"AspectRatio"in O?O.AspectRatio:1};"ViewToWorldScale"in O&&(S.camera={...z,viewToWorldScale:O.ViewToWorldScale}),"FieldOfView"in O&&(S.camera={...z,fov:O.FieldOfView})}const B=new Fa(this.components,t,{data:S,setCamera:!1});if(P){const{Coloring:O}=P;if(O&&O.Color){const v=Array.isArray(O.Color)?O.Color:[O.Color];for(const F of v){const{Color:b,Component:Z}=F,z=(Array.isArray(Z)?Z:[Z]).map(J=>J.IfcGuid);B.componentColors.set(b,z)}}}if(d.push(B),y){const O=this.components.get(sh),v=Array.isArray(y.ClippingPlane)?y.ClippingPlane:[y.ClippingPlane];for(const F of v){const{Location:b,Direction:Z}=F;if(!(b&&Z))continue;const z=new U(b.X,b.Z,-b.Y),J=new U(Z.X,-Z.Z,Z.Y),X=O.createFromNormalAndCoplanarPoint(t,J,z);X.visible=!1,X.enabled=!1,B.clippingPlanes.add(X)}}}const E={},C=[],T=a.filter(R=>R.name.endsWith(".bcf"));for(const R of T){const A=await R.async("string"),m=Us.xmlParser.parse(A).Markup,S=m.Topic,{Guid:N,TopicType:y,TopicStatus:P,Title:_,CreationDate:M,CreationAuthor:B}=S;if(n&&!(N&&y&&P&&_&&M&&B))continue;const O=new ro(this.components);O.guid=N??O.guid;const v=this.getMarkupRelatedTopics(m,c);E[O.guid]=new Set(v),O.type=y??O.type,O.status=P??O.status,O.title=_??O.title,O.creationDate=M?new Date(M):O.creationDate,O.creationAuthor=B??O.creationAuthor,O.serverAssignedId=S.ServerAssignedId,O.priority=S.Priority,O.index=S.Index,O.modifiedDate=S.ModifiedDate?new Date(S.ModifiedDate):void 0,O.modifiedAuthor=S.ModifiedAuthor,O.dueDate=S.DueDate?new Date(S.DueDate):void 0,O.assignedTo=S.AssignedTo,O.description=S.Description,O.stage=S.Stage;const F=this.getMarkupLabels(m,c);for(const z of F)O.labels.add(z);const b=this.getMarkupComments(m,c);for(const z of b)O.comments.set(z.guid,z);const Z=this.getMarkupViewpoints(m,c);for(const z of Z){if(!(z&&z.Guid))continue;const J=u.list.get(z.Guid);J&&O.viewpoints.add(J.guid)}this.list.set(O.guid,O),C.push(O)}for(const R in E){const A=this.list.get(R);if(!A)continue;const m=E[R];for(const S of m)A.relatedTopics.add(S)}return this.onBCFImported.trigger(C),{viewpoints:d,topics:C}}};p(Ln,"uuid","de977976-e4f6-4e4f-a01a-204727839802"),p(Ln,"xmlParser",new ia.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));let Ye=Ln;const ra=class ft extends Ae{constructor(e){super(e),p(this,"enabled",!0),p(this,"onDisposed",new $),p(this,"_absoluteMin"),p(this,"_absoluteMax"),p(this,"_meshes",[]),this.components.add(ft.uuid,this),this._absoluteMin=ft.newBound(!0),this._absoluteMax=ft.newBound(!1)}static getDimensions(e){const{min:t,max:s}=e,i=Math.abs(s.x-t.x),n=Math.abs(s.y-t.y),r=Math.abs(s.z-t.z),o=new U;return o.subVectors(s,t).divideScalar(2).add(t),{width:i,height:n,depth:r,center:o}}static newBound(e){const t=e?1:-1;return new U(t*Number.MAX_VALUE,t*Number.MAX_VALUE,t*Number.MAX_VALUE)}static getBounds(e,t,s){const i=s||this.newBound(!1),n=t||this.newBound(!0);for(const r of e)r.x<n.x&&(n.x=r.x),r.y<n.y&&(n.y=r.y),r.z<n.z&&(n.z=r.z),r.x>i.x&&(i.x=r.x),r.y>i.y&&(i.y=r.y),r.z>i.z&&(i.z=r.z);return new Pe(t,s)}dispose(){const e=this.components.get(ds);for(const t of this._meshes)e.destroy(t);this._meshes=[],this.onDisposed.trigger(ft.uuid),this.onDisposed.reset()}get(){const e=this._absoluteMin.clone(),t=this._absoluteMax.clone();return new Pe(e,t)}getSphere(){const e=this._absoluteMin.clone(),t=this._absoluteMax.clone(),s=Math.abs((t.x-e.x)/2),i=Math.abs((t.y-e.y)/2),n=Math.abs((t.z-e.z)/2),r=new U(e.x+s,e.y+i,e.z+n),o=r.distanceTo(e);return new Pi(r,o)}getMesh(){const e=new Pe(this._absoluteMin,this._absoluteMax),t=ft.getDimensions(e),{width:s,height:i,depth:n,center:r}=t,o=new Me(s,i,n),a=new se(o);return this._meshes.push(a),a.position.copy(r),a}reset(){this._absoluteMin=ft.newBound(!0),this._absoluteMax=ft.newBound(!1)}add(e){for(const t of e.items)this.addMesh(t.mesh)}addMesh(e,t){if(!e.geometry.index)return;const s=ft.getFragmentBounds(e);e.updateMatrixWorld();const i=e.matrixWorld,n=new Ee,r=e instanceof Gt,o=new Set;if(e instanceof Ga){t||(t=e.fragment.ids);for(const a of t){const c=e.fragment.getInstancesIDs(a);if(c)for(const h of c)o.add(h)}}else o.add(0);for(const a of o){const c=s.min.clone(),h=s.max.clone();r&&(e.getMatrixAt(a,n),c.applyMatrix4(n),h.applyMatrix4(n)),c.applyMatrix4(i),h.applyMatrix4(i),c.x<this._absoluteMin.x&&(this._absoluteMin.x=c.x),c.y<this._absoluteMin.y&&(this._absoluteMin.y=c.y),c.z<this._absoluteMin.z&&(this._absoluteMin.z=c.z),c.x>this._absoluteMax.x&&(this._absoluteMax.x=c.x),c.y>this._absoluteMax.y&&(this._absoluteMax.y=c.y),c.z>this._absoluteMax.z&&(this._absoluteMax.z=c.z),h.x>this._absoluteMax.x&&(this._absoluteMax.x=h.x),h.y>this._absoluteMax.y&&(this._absoluteMax.y=h.y),h.z>this._absoluteMax.z&&(this._absoluteMax.z=h.z),h.x<this._absoluteMin.x&&(this._absoluteMin.x=h.x),h.y<this._absoluteMin.y&&(this._absoluteMin.y=h.y),h.z<this._absoluteMin.z&&(this._absoluteMin.z=h.z)}}addFragmentIdMap(e){const t=this.components.get(Re);for(const s in e){const i=t.list.get(s);if(!i)continue;const n=e[s];this.addMesh(i.mesh,n)}}static getFragmentBounds(e){const t=e.geometry.attributes.position,s=Number.MAX_VALUE,i=-s,n=new U(s,s,s),r=new U(i,i,i);if(!e.geometry.index)throw new Error("Geometry must be indexed!");const o=Array.from(e.geometry.index.array);for(let a=0;a<o.length;a++){if(a%3===0&&o[a]===0&&o[a+1]===0&&o[a+2]===0){a+=2;continue}const c=o[a],h=t.getX(c),I=t.getY(c),d=t.getZ(c);h<n.x&&(n.x=h),I<n.y&&(n.y=I),d<n.z&&(n.z=d),h>r.x&&(r.x=h),I>r.y&&(r.y=I),d>r.z&&(r.z=d)}return new Pe(n,r)}};p(ra,"uuid","d1444724-dba6-4cdd-a0c7-68ee1450d166");let Mu=ra;const oa=class aa{constructor(e){p(this,"onProgress",new $),p(this,"inclusive",!1),p(this,"rules",[]),p(this,"ids",{}),p(this,"needsUpdate",new Map),p(this,"components"),this.components=e}static import(e,t){const s=aa.importers.get(t.type);return s?s(e,t):(console.warn("Invalid query data:.",t),null)}static importRules(e){const t=[];for(const s of e){const i={};for(const n in s){const r=s[n];r.regexp?i[n]=new RegExp(r.value):i[n]=r}t.push(i)}return t}static importIds(e){const t={};for(const s in e.ids)t[s]=new Set(e.ids[s]);return t}clear(e){if(e===void 0){this.ids={},this.needsUpdate.clear();return}delete this.ids[e],this.needsUpdate.delete(e)}addID(e,t){this.ids[e]||(this.ids[e]=new Set),this.ids[e].add(t)}getData(){const e={};for(const s in this.ids)e[s]=Array.from(this.ids[s]);const t=this.exportRules();return{name:this.name,inclusive:this.inclusive,type:"IfcFinderQuery",ids:e,rules:t}}exportRules(){const e=[];for(const t of this.rules){const s={};for(const i in t){const n=t[i];n instanceof RegExp?s[i]={regexp:!0,value:n.source}:s[i]=n}e.push(s)}return e}findInFile(e,t){return new Promise(s=>{const i=new FileReader,n=new TextDecoder("utf-8"),r=1e4*1024,o=1e3;let a=0;const c=/;/,h=()=>{if(a>=t.size){s();return}const I=Math.min(a+r+o,t.size),d=t.slice(a,I);i.readAsArrayBuffer(d)};i.onload=()=>{if(!(i.result instanceof ArrayBuffer))return;const I=new Uint8Array(i.result),d=n.decode(I).split(c);d.shift(),this.findInLines(e,d),this.onProgress.trigger(a/t.size),a+=r,h()},h()})}getIdFromLine(e){const t=e.slice(e.indexOf("#")+1,e.indexOf("="));return parseInt(t,10)}testRules(e){let t=null,s=null,i=null,n=!1;for(const r of this.rules){if(r.type==="category"){if(t===null&&(t=this.getCategoryFromLine(e),t===null)){if(this.inclusive)continue;break}if(!r.value.test(t)){if(this.inclusive)continue;n=!1;break}n=!0;continue}if(s===null&&(s=this.getAttributesFromLine(e),s===null)){if(this.inclusive)continue;n=!1;break}if(t===null&&(t=this.getCategoryFromLine(e),t===null)){if(this.inclusive)continue;n=!1;break}if(i===null&&(i=Object.keys(new za[t]),i=i.slice(2),i===null)){if(this.inclusive)continue;n=!1;break}if(r.type==="property"){const{name:o,value:a}=r;if(!a.test(e)){if(this.inclusive)continue;n=!1;break}let c=!1;for(let h=0;h<s.length;h++){const I=s[h],d=i[h];if(a.test(I)&&o.test(d)){c=!0;break}}if(c)n=!0;else if(!this.inclusive){n=!1;break}}if(r.type==="operator"){const{name:o,value:a,operator:c}=r;let h=!1;for(let I=0;I<s.length;I++){const d=i[I],u=s[I].replace(/IFCLENGTHMEASURE\(|IFCVOLUMEMEASURE\(|\)/g,"");if(o.test(d)){if(c==="="&&parseFloat(u)===a){h=!0;break}else if(c==="<"&&parseFloat(u)<a){h=!0;break}else if(c===">"&&parseFloat(u)>a){h=!0;break}else if(c===">="&&parseFloat(u)>=a){h=!0;break}else if(c==="<="&&parseFloat(u)<=a){h=!0;break}}}if(h)n=!0;else if(!this.inclusive){n=!1;break}}}return n}getCategoryFromLine(e){const t=e.indexOf("=")+1,s=e.indexOf("("),i=e.slice(t,s).trim();return lh[i]||null}getAttributesFromLine(e){const t=/\((.*)\)/,s=e.match(t);if(!(s&&s[1]))return null;const i=/,(?![^()]*\))/g;return s[1].split(i).map(n=>n.trim())}};p(oa,"importers",new Map);let Ct=oa;class oo{constructor(e){p(this,"list",new Map),p(this,"id",Oi.generateUUID()),p(this,"mode","intersect"),p(this,"_components"),this._components=e}get queries(){return new Set(this.list.values())}get items(){const e=[];for(const t of this.queries)e.push(t.items);return this.mode==="combine"?Ni.combine(e):Ni.intersect(e)}add(e){if(this.list.has(e.name))throw new Error(`This group already has a query with the name ${e.name}.`);this.list.set(e.name,e)}clear(e){for(const t of this.queries)t.clear(e)}import(e){this.mode=e.mode,this.id=e.id;for(const t in e.queries){const s=Ct.import(this._components,e.queries[t]);s&&this.list.set(t,s)}}export(){const e={};for(const[t,s]of this.list)e[t]=s.export();return{mode:this.mode,id:this.id,queries:e}}async update(e,t){for(const s of this.queries){const i=s.needsUpdate.get(e);(i===void 0||i)&&await s.update(e,t)}}}const la=class ca extends Ct{constructor(e,t){super(e),p(this,"name"),this.name=t.name,this.rules=t.rules,this.inclusive=t.inclusive}get items(){const e=this.components.get(Re),t=[];for(const s in this.ids){const i=this.ids[s],n=e.groups.get(s);if(!n){console.warn(`Model ${s} not found!`);continue}const r=n.getFragmentMap(i);t.push(r)}return Ni.combine(t)}export(){const e=this.getData();return e.type=ca.type,e}async update(e,t){this.ids[e]=new Set,await this.findInFile(e,t),this.needsUpdate.set(e,!1)}findInLines(e,t){for(const s of t)if(this.testRules(s)){const i=this.getIdFromLine(s);this.addID(e,i)}}};p(la,"type","IfcBasicQuery");let ao=la;Ct.importers.set(ao.type,(l,e)=>{const t=new ao(l,{name:e.name,rules:Ct.importRules(e.rules),inclusive:e.inclusive});return t.ids=Ct.importIds(e),t});const ha=class ua extends Ct{constructor(e,t){super(e),p(this,"name"),p(this,"psets",[]),this.name=t.name,this.rules=t.rules,this.inclusive=t.inclusive}get items(){const e=this.components.get(Ke),t=this.components.get(Re),s=[];for(const i in this.ids){const n=t.groups.get(i);if(!n){console.log(`Model not found: ${i}.`);continue}const r=this.ids[i];for(const o of r){const a=e.getEntityRelations(i,o,"DefinesOcurrence");if(a){const c=n.getFragmentMap(a);s.push(c)}}}return Ni.combine(s)}export(){const e=this.getData();return e.type=ua.type,e}async update(e,t){await this.findInFile(e,t);const s=new Set;for(const i of this.psets){const n=this.getAttributesFromLine(i);if(n===null)continue;const r=n[4].replace("(","[").replace(")","]").replace(/#/g,""),o=JSON.parse(r);for(const a of o){const c=this.ids[e];if(c&&c.has(a)){const h=this.getIdFromLine(i);s.add(h);break}}}this.ids[e]=s,this.psets=[],this.needsUpdate.set(e,!1)}findInLines(e,t){for(const s of t){const i=this.getCategoryFromLine(s);if(i==="IfcPropertySet"){this.psets.push(s);continue}if(i==="IfcPropertySingleValue"&&this.testRules(s)){const n=this.getIdFromLine(s);this.addID(e,n)}}}};p(ha,"type","IfcPropertyQuery");let lo=ha;Ct.importers.set(lo.type,(l,e)=>{const t=new lo(l,{name:e.name,inclusive:e.inclusive,rules:Ct.importRules(e.rules)});return t.ids=Ct.importIds(e),t});const da=class Ia extends Ae{constructor(e){super(e),p(this,"enabled",!0),p(this,"list",new Map),e.add(Ia.uuid,this)}get queries(){const e=new Set;for(const[,t]of this.list)for(const s of t.queries)e.add(s);return e}import(e){for(const t in e){const s=new oo(this.components);s.import(e[t]),this.list.set(t,s)}}export(){const e={};for(const[t,s]of this.list)e[t]=s.export();return e}create(){const e=new oo(this.components);return this.list.set(e.id,e),e}delete(e){this.list.delete(e)}clear(){this.list.clear()}};p(da,"uuid","0da7ad77-f734-42ca-942f-a074adfd1e3a");let ed=da;const Ea=class fa extends Ae{constructor(e){super(e),p(this,"enabled",!0),p(this,"list",{}),p(this,"onDisposed",new $),p(this,"onFragmentsDisposed",t=>{const{groupID:s,fragmentIDs:i}=t;for(const n in this.list){const r=this.list[n],o=Object.keys(r);if(o.includes(s))delete r[s],Object.values(r).length===0&&delete this.list[n];else for(const a of o){const c=r[a];for(const h of i)delete c.map[h];Object.values(c).length===0&&delete r[a]}}}),e.add(fa.uuid,this),e.get(Re).onFragmentsDisposed.add(this.onFragmentsDisposed)}dispose(){this.list={},this.components.get(Re).onFragmentsDisposed.remove(this.onFragmentsDisposed),this.onDisposed.trigger(),this.onDisposed.reset()}remove(e){for(const t in this.list){const s=this.list[t];for(const i in s){const n=s[i];delete n.map[e]}}}find(e){const t=this.components.get(Re);if(!e){const r={};for(const[o,a]of t.list)r[o]=new Set(a.ids);return r}const s=Object.keys(e).length,i={};for(const r in e){const o=e[r];if(!this.list[r]){console.warn(`Classification ${r} does not exist.`);continue}for(const a of o){const c=this.list[r][a];if(c)for(const h in c.map){i[h]||(i[h]=new Map);for(const I of c.map[h]){const d=i[h].get(I);d===void 0?i[h].set(I,1):i[h].set(I,d+1)}}}}const n={};for(const r in i){const o=i[r];for(const[a,c]of o){if(c===void 0)throw new Error("Malformed fragments map!");c===s&&(n[r]||(n[r]=new Set),n[r].add(a))}}return n}byModel(e,t){this.list.models||(this.list.models={});const s=this.list.models;s[e]||(s[e]={map:{},id:null,name:e});const i=s[e];for(const[n,r]of t.data){const o=r[0];for(const a of o){const c=t.keyFragments.get(a);c&&(i.map[c]||(i.map[c]=new Set),i.map[c].add(n))}}}async byPredefinedType(e){var t;this.list.predefinedTypes||(this.list.predefinedTypes={});const s=this.list.predefinedTypes,i=e.getAllPropertiesIDs();for(const n of i){const r=await e.getProperties(n);if(!r)continue;const o=String((t=r.PredefinedType)==null?void 0:t.value).toUpperCase();s[o]||(s[o]={map:{},id:null,name:o});const a=s[o];for(const[c,h]of e.data){const I=h[0];for(const d of I){const u=e.keyFragments.get(d);if(!u)throw new Error("Fragment ID not found!");a.map[u]||(a.map[u]=new Set),a.map[u].add(r.expressID)}}}}byEntity(e){this.list.entities||(this.list.entities={});for(const[t,s]of e.data){const i=s[1][1],n=wi[i];this.saveItem(e,"entities",n,t)}}async byIfcRel(e,t,s){cs.isRel(t)&&await cs.getRelationMap(e,t,async(i,n)=>{const{name:r}=await cs.getEntityName(e,i);for(const o of n)this.saveItem(e,s,r??"NO REL NAME",o)})}async bySpatialStructure(e,t={}){var s,i;const n=this.components.get(Ke),r=n.relationMaps[e.uuid];if(!r)throw new Error(`Classifier: model relations of ${e.name||e.uuid} have to exists to group by spatial structure.`);const o=t.systemName??"spatialStructures",a=t.useProperties===void 0||t.useProperties;for(const[c]of r){if(t.isolate){const u=e.data.get(c);if(!u)continue;const f=u[1][1];if(f===void 0||!t.isolate.has(f))continue}const h=n.getEntityRelations(e,c,"Decomposes");if(h)for(const u of h){let f=u.toString();if(a){const E=await e.getProperties(u);if(!E)continue;f=(s=E.Name)==null?void 0:s.value}this.saveItem(e,o,f,c,u)}const I=n.getEntityRelations(e,c,"ContainsElements");if(!I)continue;let d=c.toString();if(a){const u=await e.getProperties(c);if(!u)continue;d=(i=u.Name)==null?void 0:i.value}for(const u of I){this.saveItem(e,o,d,u,c);const f=n.getEntityRelations(e,Number(u),"IsDecomposedBy");if(f)for(const E of f)this.saveItem(e,o,d,E,c)}}}setColor(e,t,s=!1){const i=this.components.get(Re);for(const n in e){const r=i.list.get(n);if(!r)continue;const o=e[n];r.setColor(t,o,s)}}resetColor(e){const t=this.components.get(Re);for(const s in e){const i=t.list.get(s);if(!i)continue;const n=e[s];i.resetColor(n)}}saveItem(e,t,s,i,n=null){this.list[t]||(this.list[t]={});const r=e.data.get(i);if(r)for(const o of r[0]){const a=e.keyFragments.get(o);if(a){const c=this.list[t];c[s]||(c[s]={map:{},id:n,name:s}),c[s].map[a]||(c[s].map[a]=new Set),c[s].map[a].add(i)}}}};p(Ea,"uuid","e25a7f3c-46c4-4a14-9d3d-5115f24ebeb7");let _n=Ea;const pa=class Ca extends Ae{constructor(e){super(e),p(this,"onDisposed",new $),p(this,"enabled",!0),p(this,"height",10),p(this,"groupName","spatialStructures"),p(this,"list",new Set),e.add(Ca.uuid,this)}dispose(){this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}set(e){if(!this.enabled)return;const t=this.components.get(_n),s=this.components.get(Re),i=e?1:-1;let n=0;const r=t.list[this.groupName],o=new Ee;for(const a in r){o.elements[13]=n*i*this.height;for(const c in r[a].map){const h=s.list.get(c),I=a+c,d=this.list.has(I);if(!h||e&&d||!e&&!d)continue;e?this.list.add(I):this.list.delete(I);const u=r[a].map[c];h.applyTransform(u,o),h.mesh.computeBoundingSphere(),h.mesh.computeBoundingBox()}n++}}};p(pa,"uuid","d260618b-ce88-4c7d-826c-6debb91de3e2");let td=pa;const Ta=class ma extends Ae{constructor(e){super(e),p(this,"enabled",!0),this.components.add(ma.uuid,this)}set(e,t){const s=this.components.get(Re);if(!t){for(const[i,n]of s.list)n&&(n.setVisibility(e),this.updateCulledVisibility(n));return}for(const i in t){const n=t[i],r=s.list.get(i);r&&(r.setVisibility(e,n),this.updateCulledVisibility(r))}}isolate(e){this.set(!1),this.set(!0,e)}updateCulledVisibility(e){const t=this.components.get(Gc);for(const[s,i]of t.list){const n=i.colorMeshes.get(e.id);n&&(n.count=e.mesh.count)}}};p(Ta,"uuid","dd9ccf2d-8a21-4821-b7f6-2949add16a29");let Du=Ta;class bu extends ir{constructor(){super(...arguments),p(this,"minGeometrySize",10),p(this,"minAssetsSize",1e3),p(this,"maxTriangles",null)}}const Ra=class ga extends Ae{constructor(e){super(e),p(this,"onGeometryStreamed",new wt),p(this,"onAssetStreamed",new wt),p(this,"onProgress",new wt),p(this,"onIfcLoaded",new wt),p(this,"onDisposed",new $),p(this,"settings",new bu),p(this,"enabled",!0),p(this,"webIfc",new hs),p(this,"_nextAvailableID",0),p(this,"_splittedGeometries",new Map),p(this,"_spatialTree",new Bo),p(this,"_metaData",new Vo),p(this,"_visitedGeometries",new Map),p(this,"_streamSerializer",new ka),p(this,"_geometries",new Map),p(this,"_geometryCount",0),p(this,"_civil",new Yo),p(this,"_groupSerializer",new Eo),p(this,"_assets",[]),p(this,"_meshesWithHoles",new Set),this.components.add(ga.uuid,this),this.settings.excludedCategories.add(Io)}dispose(){this.onIfcLoaded.reset(),this.onGeometryStreamed.reset(),this.onAssetStreamed.reset(),this.webIfc=null,this.onDisposed.trigger(),this.onDisposed.reset()}async streamFromBuffer(e){await this.readIfcFile(e),await this.streamAllGeometries(),this.cleanUp()}async streamFromCallBack(e){await this.streamIfcFile(e),await this.streamAllGeometries(),this.cleanUp()}async readIfcFile(e){const{path:t,absolute:s,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModel(e,this.settings.webIfc),this._nextAvailableID=this.webIfc.GetMaxExpressID(0)}async streamIfcFile(e){const{path:t,absolute:s,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModelFromCallback(e,this.settings.webIfc)}async streamAllGeometries(){const{minGeometrySize:e,minAssetsSize:t}=this.settings;this._spatialTree.setUp(this.webIfc);const s=this.webIfc.GetIfcEntityList(0),i=[[]],n=new xs;n.ifcMetadata={name:"",description:"",...this._metaData.getNameInfo(this.webIfc),...this._metaData.getDescriptionInfo(this.webIfc),schema:this.webIfc.GetModelSchema(0)||"IFC2X3",maxExpressID:this.webIfc.GetMaxExpressID(0)};let r=0,o=0;for(const f of s){if(!this.webIfc.IsIfcElement(f)&&f!==kt||this.settings.excludedCategories.has(f))continue;const E=this.webIfc.GetLineIDsWithType(0,f),C=E.size();for(let T=0;T<C;T++){r>e&&(r=0,o++,i.push([]));const R=E.get(T);i[o].push(R);const A=this.webIfc.GetLine(0,R);if(A.GlobalId){const S=(A==null?void 0:A.GlobalId.value)||(A==null?void 0:A.GlobalId);n.globalToExpressIDs.set(S,R)}const m=this._spatialTree.itemsByFloor[R]||0;n.data.set(R,[[],[m,f]]),r++}}this._spatialTree.cleanUp();let a=.01,c=0;for(const f of i){c++,this.webIfc.StreamMeshes(0,f,C=>{this.getMesh(this.webIfc,C,n)}),this._geometryCount>this.settings.minGeometrySize&&await this.streamGeometries(),this._assets.length>t&&await this.streamAssets();const E=c/i.length;E>a&&(a+=.01,a=Math.max(a,E),await this.onProgress.trigger(Math.round(a*100)/100))}this._geometryCount&&await this.streamGeometries(),this._assets.length&&await this.streamAssets();const{opaque:h,transparent:I}=n.geometryIDs;for(const[f,{index:E,uuid:C}]of this._visitedGeometries)n.keyFragments.set(E,C),(f>1?h:I).set(f,E);Go.get(n,this.webIfc);const d=this.webIfc.GetCoordinationMatrix(0);n.coordinationMatrix.fromArray(d),n.civilData=this._civil.read(this.webIfc);const u=this._groupSerializer.export(n);await this.onIfcLoaded.trigger(u),n.dispose(!0)}cleanUp(){try{this.webIfc.Dispose()}catch{}this.webIfc=null,this.webIfc=new hs,this._visitedGeometries.clear(),this._geometries.clear(),this._assets=[],this._meshesWithHoles.clear()}getMesh(e,t,s){const i=t.geometries.size(),n=t.expressID,r={id:n,geometries:[]};for(let o=0;o<i;o++){const a=t.geometries.get(o),c=a.geometryExpressID,h=a.color.w===1?1:-1,I=c*h;this._visitedGeometries.has(I)||this.getGeometry(e,c,I),this.registerGeometryData(s,n,a,r,c,I);const d=this._splittedGeometries.get(c);if(d)for(const u of d)this.registerGeometryData(s,n,a,r,u,u)}this._assets.push(r)}getGeometry(e,t,s){const i=e.GetGeometry(0,t),n=e.GetIndexArray(i.GetIndexData(),i.GetIndexDataSize()),r=e.GetVertexArray(i.GetVertexData(),i.GetVertexDataSize()),o=new Float32Array(r.length/2),a=new Float32Array(r.length/2);for(let I=0;I<r.length;I+=6)o[I/2]=r[I],o[I/2+1]=r[I+1],o[I/2+2]=r[I+2],a[I/2]=r[I+3],a[I/2+1]=r[I+4],a[I/2+2]=r[I+5];if(n.length===0){const I=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1]);this._geometries.set(t,{position:o,normal:a,index:n,boundingBox:I,hasHoles:!1});const d=this._visitedGeometries.size,u=Oi.generateUUID();this._visitedGeometries.set(s,{uuid:u,index:d}),this._geometryCount++,i.delete();return}const c=(this.settings.maxTriangles||n.length/3)*3;let h=!0;for(let I=0;I<n.length;I+=c){const d=n.length-I,u=Math.min(d,c),f=I+u,E=[],C=[],T=[];let R=0;for(let O=I;O<f;O++){E.push(R++);const v=n[O];C.push(o[v*3]),C.push(o[v*3+1]),C.push(o[v*3+2]),T.push(a[v*3]),T.push(a[v*3+1]),T.push(a[v*3+2])}const A=new Uint32Array(E),m=new Float32Array(C),S=new Float32Array(T),N=yc(m),y=new Float32Array(N.transformation.elements),P=!1,_=h?t:this._nextAvailableID++;this._geometries.set(_,{position:m,normal:S,index:A,boundingBox:y,hasHoles:P}),h||(this._splittedGeometries.has(t)||this._splittedGeometries.set(t,new Set),this._splittedGeometries.get(t).add(_));const M=this._visitedGeometries.size,B=Oi.generateUUID();this._visitedGeometries.set(s,{uuid:B,index:M}),this._geometryCount++,h=!1}i.delete()}async streamAssets(){await this.onAssetStreamed.trigger(this._assets),this._assets=null,this._assets=[]}async streamGeometries(){let e=this._streamSerializer.export(this._geometries),t={};for(const[s,{boundingBox:i,hasHoles:n}]of this._geometries)t[s]={boundingBox:i,hasHoles:n};await this.onGeometryStreamed.trigger({data:t,buffer:e}),t=null,e=null,this._geometries.clear(),this._geometryCount=0}registerGeometryData(e,t,s,i,n,r){const o=this._visitedGeometries.get(r);if(o===void 0)throw new Error("Error getting geometry data for streaming!");const a=e.data.get(t);if(!a)throw new Error("Data not found!");a[0].push(o.index);const{x:c,y:h,z:I,w:d}=s.color,u=[c,h,I,d],f=s.flatTransformation;i.geometries.push({color:u,geometryID:n,transformation:f})}};p(Ra,"uuid","d9999a00-e1f5-4d3f-8cfe-c56e08609764");let sd=Ra;class Uu extends ir{constructor(){super(...arguments),p(this,"propertiesSize",100)}}class xu extends Ae{constructor(){super(...arguments),p(this,"onPropertiesStreamed",new wt),p(this,"onProgress",new wt),p(this,"onIndicesStreamed",new wt),p(this,"onDisposed",new $),p(this,"enabled",!0),p(this,"settings",new Uu),p(this,"webIfc",new hs)}async dispose(){this.onIndicesStreamed.reset(),this.onPropertiesStreamed.reset(),this.webIfc=null,this.onDisposed.reset()}async streamFromBuffer(e){await this.readIfcFile(e),await this.streamAllProperties(),this.cleanUp()}async streamFromCallBack(e){await this.streamIfcFile(e),await this.streamAllProperties(),this.cleanUp()}async readIfcFile(e){const{path:t,absolute:s,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModel(e,this.settings.webIfc)}async streamIfcFile(e){const{path:t,absolute:s,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModelFromCallback(e,this.settings.webIfc)}async streamAllProperties(){const{propertiesSize:e}=this.settings,t=new Set(this.webIfc.GetIfcEntityList(0)),s=new Set([jn,Zn,$n,qn,kt]);for(const o of s)t.add(o);let i=.01,n=0;for(const o of t){if(n++,zo.has(o))continue;const a=s.has(o),c=this.webIfc.GetLineIDsWithType(0,o),h=c.size();let I=0;for(let d=0;d<h-e;d+=e){const u={};for(let f=0;f<e;f++){I++;const E=c.get(d+f);try{const C=this.webIfc.GetLine(0,E,a);u[C.expressID]=C}catch{console.log(`Could not get property: ${E}`)}}await this.onPropertiesStreamed.trigger({type:o,data:u})}if(I!==h){const d={};for(let u=I;u<h;u++){const f=c.get(u);try{const E=this.webIfc.GetLine(0,f,a);d[E.expressID]=E}catch{console.log(`Could not get property: ${f}`)}}await this.onPropertiesStreamed.trigger({type:o,data:d})}n/t.size>i&&(i=Math.round(i*100)/100,await this.onProgress.trigger(i),i+=.01)}await this.onProgress.trigger(1);const r=await this.components.get(Ke).processFromWebIfc(this.webIfc,0);await this.onIndicesStreamed.trigger(r)}cleanUp(){this.webIfc.Dispose(),this.webIfc=null,this.webIfc=new hs}}p(xu,"uuid","88d2c89c-ce32-47d7-8cb6-d51e4b311a0b");class Fa{constructor(e,t,s){p(this,"title"),p(this,"guid",gt.create()),p(this,"clippingPlanes",new Pt),p(this,"camera",{aspectRatio:1,fov:60,direction:{x:0,y:0,z:0},position:{x:0,y:0,z:0}}),p(this,"exceptionComponents",new Pt),p(this,"selectionComponents",new Pt),p(this,"componentColors",new rt),p(this,"spacesVisible",!1),p(this,"spaceBoundariesVisible",!1),p(this,"openingsVisible",!1),p(this,"defaultVisibility",!0),p(this,"_components"),p(this,"world");const i={setCamera:!0,...s},{data:n,setCamera:r}=i;this._components=e,this.world=t,n&&(this.guid=n.guid??this.guid,this.set(n)),r&&this.updateCamera()}get _selectionModelIdMap(){const e=this._components.get(Re),t={};for(const[s,i]of e.groups){s in t||(t[s]=new Set);for(const n of this.selectionComponents){const r=i.globalToExpressIDs.get(n);r&&t[s].add(r)}}return t}get _exceptionModelIdMap(){const e=this._components.get(Re),t={};for(const[s,i]of e.groups){s in t||(t[s]=new Set);for(const n of this.exceptionComponents){const r=i.globalToExpressIDs.get(n);r&&t[s].add(r)}}return t}get selection(){return this._components.get(Re).modelIdToFragmentIdMap(this._selectionModelIdMap)}get exception(){return this._components.get(Re).modelIdToFragmentIdMap(this._exceptionModelIdMap)}get projection(){return"fov"in this.camera?"Perspective":"Orthographic"}get position(){const e=this._components.get(Re),{position:t}=this.camera,{x:s,y:i,z:n}=t,r=new U(s,i,n);return e.applyBaseCoordinateSystem(r,new Ee),r}get direction(){const{direction:e}=this.camera,{x:t,y:s,z:i}=e;return new U(t,s,i)}get _managerVersion(){return this._components.get(Ye).config.version}get topics(){return[...this._components.get(Ye).list.values()].filter(e=>e.viewpoints.has(this.guid))}addComponentsFromMap(e){const t=this._components.get(Re).fragmentIdMapToGuids(e);this.selectionComponents.add(...t),this._components.get(pt).list.set(this.guid,this)}set(e){const t=e,s=this;for(const i in e){if(i==="guid")continue;const n=t[i];if(i==="selectionComponents"){this.selectionComponents.clear(),this.selectionComponents.add(...n);continue}if(i==="exceptionComponents"){this.exceptionComponents.clear(),this.exceptionComponents.add(...n);continue}i in this&&(s[i]=n)}return this._components.get(pt).list.set(this.guid,this),this}async go(e=!0){const{camera:t}=this.world;if(!t.hasCameraControls())throw new Error("Viewpoint: the world's camera need controls to set the viewpoint.");t instanceof ah&&t.projection.set(this.projection);const s=new U(this.camera.position.x,this.camera.position.y,this.camera.position.z),i=new U(this.camera.direction.x,this.camera.direction.y,this.camera.direction.z);if(s.equals(new U)&&i.equals(new U))return;const n=this.position,r=this.direction;let o={x:n.x+r.x*80,y:n.y+r.y*80,z:n.z+r.z*80};const a=this.selection;if(Object.keys(a).length===0){const c=this._components.get(Fn).get(this.world).castRayFromVector(n,this.direction);c&&(o=c.point)}else{const c=this._components.get(Mu);c.reset(),c.addFragmentIdMap(a),o=c.getSphere().center,c.reset()}await t.controls.setLookAt(n.x,n.y,n.z,o.x,o.y,o.z,e)}updateCamera(){const{camera:e,renderer:t}=this.world;if(!t)throw new Error("Viewpoint: the world needs to have a renderer!");if(!e.hasCameraControls())throw new Error("Viewpoint: world's camera need camera controls!");const s=new U;e.controls.getPosition(s);const i=e.three,n=new U(0,0,-1).applyEuler(i.rotation),{width:r,height:o}=t.getSize();let a=r/o;Number.isNaN(a)&&(a=1);const c=this._components.get(Re);s.applyMatrix4(c.baseCoordinationMatrix.clone().invert());const h={aspectRatio:a,position:{x:s.x,y:s.y,z:s.z},direction:{x:n.x,y:n.y,z:n.z}};i instanceof Mn?this.camera={...h,fov:i.fov}:i instanceof zt&&(this.camera={...h,viewToWorldScale:i.top-i.bottom}),this._components.get(pt).list.set(this.guid,this)}applyVisibility(){const e=this._components.get(Du);e.set(this.defaultVisibility),e.set(!this.defaultVisibility,this.exception),e.set(!0,this.selection)}applyColors(){const e=this._components.get(pt),t=this._components.get(Re),s=this._components.get(_n);for(const[i,n]of this.componentColors){const r=t.guidToFragmentIdMap(n);s.setColor(r,i,e.config.overwriteColors)}}resetColors(){const e=this._components.get(Re),t=this._components.get(_n);for(const[s,i]of this.componentColors){const n=e.guidToFragmentIdMap(i);t.resetColor(n)}}async createComponentTags(e){var t,s;const i=this._components.get(Re),n=this._components.get(Ye);let r="";if(n.config.includeSelectionTag){const o=e==="selection"?this._selectionModelIdMap:this._exceptionModelIdMap;for(const a in o){const c=i.groups.get(a);if(!c)continue;const h=o[a];for(const I of h){const d=await c.getProperties(I);if(!d)continue;const u=(t=d.GlobalId)==null?void 0:t.value;if(!u)continue;const f=(s=d.Tag)==null?void 0:s.value;let E=null;f&&(E=`AuthoringToolId="${f}"`),r+=`
<Component IfcGuid="${u}" ${E??""} />`}}}else r=[...this.selectionComponents].map(o=>`<Component IfcGuid="${o}" />`).join(`
`);return r}createColorTags(){let e="";for(const[t,s]of this.componentColors.entries()){const i=`#${t.getHexString()}`,n=s.map(r=>`
<Component IfcGuid="${r}" />`).join(`
`);e+=`<Color Color="${i}">
${n}
</Color>`}return e.length!==0?`<Coloring>
${e}
</Coloring>`:"<Coloring />"}async serialize(e=this._managerVersion){const t=this._components.get(Re),s=this.position;s.applyMatrix4(t.baseCoordinationMatrix.clone().invert());const i=this.direction;i.normalize();const n=new Ee().makeRotationX(Math.PI/2),r=i.clone().applyMatrix4(n);r.normalize();const o=`<CameraViewPoint>
      <X>${s.x}</X>
      <Y>${-s.z}</Y>
      <Z>${s.y}</Z>
    </CameraViewPoint>`,a=`<CameraDirection>
      <X>${i.x}</X>
      <Y>${-i.z}</Y>
      <Z>${i.y}</Z>
    </CameraDirection>`,c=`<CameraUpVector>
      <X>${r.x}</X>
      <Y>${-r.z}</Y>
      <Z>${r.y}</Z>
    </CameraUpVector>`,h=`<AspectRatio>${this.camera.aspectRatio}</AspectRatio>`;let I="";"viewToWorld"in this.camera?I=`<OrthogonalCamera>
        ${o}
        ${a}
        ${c}
        ${h}
        <ViewToWorldScale>${this.camera.viewToWorld}</ViewToWorldScale>
      </OrthogonalCamera>`:"fov"in this.camera&&(I=`<PerspectiveCamera>
        ${o}
        ${a}
        ${c}
        ${h}
        <FieldOfView>${this.camera.fov}</FieldOfView>
      </PerspectiveCamera>`);const d=`<ViewSetupHints SpacesVisible="${this.spacesVisible??!1}" SpaceBoundariesVisible="${this.spaceBoundariesVisible??!1}" OpeningsVisible="${this.openingsVisible??!1}" />`,u=(await this.createComponentTags("selection")).trim(),f=(await this.createComponentTags("exception")).trim(),E=this.createColorTags();return`<?xml version="1.0" encoding="UTF-8"?>
    <VisualizationInfo Guid="${this.guid}">
      <Components>
        ${e==="2.1"?d:""}
        ${u.length!==0?`<Selection>${u}</Selection>`:""}
        <Visibility DefaultVisibility="${this.defaultVisibility}">
          ${e==="3"?d:""}
          ${f.length!==0?`<Exceptions>${f}</Exceptions>`:""}
        </Visibility>
        ${E}
      </Components>
      ${I}
    </VisualizationInfo>`}}class Bu extends Ht{constructor(){super(...arguments),p(this,"_config",{overwriteColors:{value:!1,type:"Boolean"}})}get overwriteColors(){return this._config.overwriteColors.value}set overwriteColors(e){this._config.overwriteColors.value=e}}const Sa=class wn extends Ae{constructor(e){super(e),p(this,"enabled",!0),p(this,"list",new rt),p(this,"isSetup",!1),p(this,"onSetup",new $),p(this,"config",new Bu(this,this.components,"Viewpoints",wn.uuid)),p(this,"onDisposed",new $),e.add(wn.uuid,this)}create(e,t){const s=new Fa(this.components,e,{data:t});return t||this.list.set(s.guid,s),s}setup(){}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}};p(Sa,"uuid","ee867824-a796-408d-8aa0-4e5962a83c66");let pt=Sa;class Yu extends Ht{constructor(){super(...arguments),p(this,"_config",{visible:{value:!0,type:"Boolean"},lockRotation:{value:!0,type:"Boolean"},zoom:{type:"Number",interpolable:!0,value:.05,min:.001,max:5},frontOffset:{type:"Number",interpolable:!0,value:0,min:0,max:100},sizeX:{type:"Number",interpolable:!0,value:320,min:20,max:5e3},sizeY:{type:"Number",interpolable:!0,value:160,min:20,max:5e3},backgroundColor:{value:new Ue,type:"Color"}})}get visible(){return this._config.visible.value}set visible(e){this._config.visible.value=e;const t=this._component.renderer.domElement.style;t.display=e?"block":"none"}get lockRotation(){return this._config.lockRotation.value}set lockRotation(e){this._config.lockRotation.value=e,this._component.lockRotation=e}get zoom(){return this._config.zoom.value}set zoom(e){this._config.zoom.value=e,this._component.zoom=e}get frontOffset(){return this._config.frontOffset.value}set frontOffset(e){this._config.frontOffset.value=e,this._component.frontOffset=e}get sizeX(){return this._config.sizeX.value}set sizeX(e){this._config.sizeX.value=e;const{sizeX:t,sizeY:s}=this._config,i=new He(t.value,s.value);this._component.resize(i)}get sizeY(){return this._config.sizeY.value}set sizeY(e){this._config.sizeY.value=e;const{sizeX:t,sizeY:s}=this._config,i=new He(t.value,s.value);this._component.resize(i)}get backgroundColor(){return this._config.backgroundColor.value}set backgroundColor(e){this._config.backgroundColor.value=e,this._component.backgroundColor=e}}class Vu{constructor(e,t){if(p(this,"onDisposed",new $),p(this,"onAfterUpdate",new $),p(this,"onBeforeUpdate",new $),p(this,"onResize",new $),p(this,"onSetup",new $),p(this,"frontOffset",0),p(this,"overrideMaterial",new qa),p(this,"backgroundColor",new Ue(395274)),p(this,"renderer"),p(this,"enabled",!0),p(this,"world"),p(this,"config"),p(this,"isSetup",!1),p(this,"_defaultConfig",{visible:!0,lockRotation:!1,zoom:.05,frontOffset:0,sizeX:320,sizeY:160,backgroundColor:new Ue(395274)}),p(this,"_lockRotation",!0),p(this,"_size",new He(320,160)),p(this,"_camera"),p(this,"_plane"),p(this,"_tempVector1",new U),p(this,"_tempVector2",new U),p(this,"_tempTarget",new U),p(this,"down",new U(0,-1,0)),p(this,"updatePlanes",()=>{if(!this.world.renderer)throw new Error("The given world must have a renderer!");const n=[],r=this.world.renderer.three;for(const o of r.clippingPlanes)n.push(o);n.push(this._plane),this.renderer.clippingPlanes=n}),this.world=e,!this.world.renderer)throw new Error("The given world must have a renderer!");this.renderer=new Ys,this.renderer.setSize(this._size.x,this._size.y);const s=1,i=this._size.x/this._size.y;this._camera=new zt(s*i/-2,s*i/2,s/2,s/-2),this.world.renderer.onClippingPlanesUpdated.add(this.updatePlanes),this._camera.position.set(0,200,0),this._camera.zoom=.1,this._camera.rotation.x=-Math.PI/2,this._plane=new Is(this.down,200),this.updatePlanes(),this.config=new Yu(this,t,"MiniMap")}get lockRotation(){return this._lockRotation}set lockRotation(e){this._lockRotation=e,e&&(this._camera.rotation.z=0)}get zoom(){return this._camera.zoom}set zoom(e){this._camera.zoom=e,this._camera.updateProjectionMatrix()}dispose(){this.enabled=!1,this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.onResize.reset(),this.overrideMaterial.dispose(),this.renderer.forceContextLoss(),this.renderer.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get(){return this._camera}update(){if(!this.enabled)return;this.onBeforeUpdate.trigger();const e=this.world.scene.three,t=this.world.camera;if(!t.hasCameraControls())throw new Error("The given world must use camera controls!");if(!(e instanceof vi))throw new Error("The given world must have a THREE.Scene as a root!");const s=t.controls;if(s.getPosition(this._tempVector1),this._camera.position.x=this._tempVector1.x,this._camera.position.z=this._tempVector1.z,this.frontOffset!==0&&(s.getTarget(this._tempVector2),this._tempVector2.sub(this._tempVector1),this._tempVector2.normalize().multiplyScalar(this.frontOffset),this._camera.position.x+=this._tempVector2.x,this._camera.position.z+=this._tempVector2.z),!this._lockRotation){s.getTarget(this._tempTarget);const n=Math.atan2(this._tempTarget.x-this._tempVector1.x,this._tempTarget.z-this._tempVector1.z);this._camera.rotation.z=n+Math.PI}this._plane.set(this.down,this._tempVector1.y);const i=e.background;e.background=this.backgroundColor,this.renderer.render(e,this._camera),e.background=i,this.onAfterUpdate.trigger()}getSize(){return this._size}resize(e=this._size){this._size.copy(e),this.renderer.setSize(e.x,e.y);const t=e.x/e.y,s=1;this._camera.left=s*t/-2,this._camera.right=s*t/2,this._camera.top=s/2,this._camera.bottom=-s/2,this._camera.updateProjectionMatrix(),this.onResize.trigger(e)}setup(e){const t={...this._defaultConfig,...e};this.config.visible=!0,this.config.lockRotation=t.lockRotation,this.config.zoom=t.zoom,this.config.frontOffset=t.frontOffset,this.config.sizeX=t.sizeX,this.config.sizeY=t.sizeY,this.config.backgroundColor=t.backgroundColor,this.isSetup=!0,this.onSetup.trigger()}}const Aa=class Oa extends Ae{constructor(e){super(e),p(this,"onAfterUpdate",new $),p(this,"onBeforeUpdate",new $),p(this,"onDisposed",new $),p(this,"onSetup",new $),p(this,"enabled",!0),p(this,"list",new Map),this.components.add(Oa.uuid,this)}create(e){if(this.list.has(e.uuid))throw new Error("This world already has a minimap!");const t=new Vu(e,this.components);return this.list.set(e.uuid,t),t}delete(e){const t=this.list.get(e);t&&t.dispose(),this.list.delete(e)}dispose(){for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}update(){for(const[e,t]of this.list)t.update()}};p(Aa,"uuid","39ad6aad-84c8-4adf-a1e0-7f25313a9e7f");let id=Aa;const ya=class Na extends Ae{constructor(e){super(e),p(this,"enabled",!0),e.add(Na.uuid,this)}static distanceFromPointToLine(e,t,s,i=!1){const n=new it,r=new U;return n.set(t,s),n.closestPointToPoint(e,i,r),r.distanceTo(e)}getFace(e,t,s){if(!e.geometry.index)throw new Error("Geometry must be indexed!");const i=new Map,n=e.geometry.index.array,{plane:r}=this.getFaceData(t,s,e),o=[];for(let I=0;I<n.length/3;I++){const{plane:d,edges:u}=this.getFaceData(I,s,e);if(d.equals(r)){o.push({index:I,edges:u});for(const{id:f,points:E,distance:C}of u)i.set(f,{points:E,distance:C})}}let a=0;const c=new Map,h=new Map;for(const{index:I,edges:d}of o){const u=new Map;for(const{id:m}of d)if(c.has(m)){const S=c.get(m);u.set(m,S)}const f=d.map(m=>m.id);if(!u.size){const m=a++;for(const{id:S}of d)c.set(S,m);h.set(m,{edges:new Set(f),indices:new Set([I])});continue}let E=null;const C=new Set,T=new Set(f);for(const[m,S]of u){E===null?E=S:S!==E&&C.add(S),c.delete(m);const{edges:N}=h.get(S);N.delete(m),T.delete(m)}if(E===null)throw new Error("Error computing face!");const R=h.get(E),{indices:A}=R;A.add(I);for(const m of T){c.set(m,E);const{edges:S}=R;S.add(m)}for(const m of C){const S=h.get(m),{edges:N,indices:y}=S,P=h.get(E),{edges:_,indices:M}=P;for(const B of N)_.add(B),c.set(B,E);for(const B of y)M.add(B);h.delete(m)}}for(const[I,{indices:d,edges:u}]of h)if(d.has(t)){const f=[];for(const E of u){const C=i.get(E);f.push(C)}return{edges:f,indices:d}}return null}getVerticesAndNormal(e,t,s){if(!e.geometry.index)throw new Error("Geometry must be indexed!");const i=e.geometry.index.array,n=e.geometry.attributes.position.array,r=e.geometry.attributes.normal.array,o=i[t*3]*3,a=i[t*3+1]*3,c=i[t*3+2]*3,h=new U(n[o],n[o+1],n[o+2]),I=new U(n[a],n[a+1],n[a+2]),d=new U(n[c],n[c+1],n[c+2]),u=new U(r[o],r[o+1],r[o+2]),f=new U(r[a],r[a+1],r[a+2]),E=new U(r[c],r[c+1],r[c+2]),C=(u.x+f.x+E.x)/3,T=(u.y+f.y+E.y)/3,R=(u.z+f.z+E.z)/3,A=new U(C,T,R);if(s!==void 0&&e instanceof Gt){const m=new Ee;e.getMatrixAt(s,m);const S=new Ee;S.extractRotation(m),A.applyMatrix4(S),h.applyMatrix4(m),I.applyMatrix4(m),d.applyMatrix4(m)}return{p1:h,p2:I,p3:d,faceNormal:A}}round(e){e.x=Math.trunc(e.x*1e3)/1e3,e.y=Math.trunc(e.y*1e3)/1e3,e.z=Math.trunc(e.z*1e3)/1e3}getVolumeFromFragments(e){const t=this.components.get(Re),s=new Ee,i=[];for(const r in e){const o=t.list.get(r);if(!o)continue;const a=e[r];let c=0;for(const d of a){const u=o.getInstancesIDs(d);u&&(c+=u.size)}const h=new Gt(o.mesh.geometry,void 0,c);let I=0;for(const d of a){const u=o.getInstancesIDs(d);if(u)for(const f of u)o.mesh.getMatrixAt(f,s),h.setMatrixAt(I++,s)}i.push(h)}const n=this.getVolumeFromMeshes(i);for(const r of i)r.geometry=null,r.material=[],r.dispose();return n}getVolumeFromMeshes(e){let t=0;for(const s of e)t+=this.getVolumeOfMesh(s);return t}getFaceData(e,t,s){const i=this.getVerticesAndNormal(s,e,t),{p1:n,p2:r,p3:o,faceNormal:a}=i;this.round(n),this.round(r),this.round(o),this.round(a);const c=[{id:`${n.x}|${n.y}|${n.z}`,value:n},{id:`${r.x}|${r.y}|${r.z}`,value:r},{id:`${o.x}|${o.y}|${o.z}`,value:o}];c.sort((R,A)=>R.id<A.id?-1:R.id>A.id?1:0);const[{id:h,value:I},{id:d,value:u},{id:f,value:E}]=c,C=[{id:`${h}|${d}`,distance:I.distanceTo(u),points:[I,u]},{id:`${d}|${f}`,distance:u.distanceTo(E),points:[u,E]},{id:`${h}|${f}`,distance:I.distanceTo(E),points:[I,E]}],T=new Is;return T.setFromNormalAndCoplanarPoint(a,n),T.constant=Math.round(T.constant*10)/10,{plane:T,edges:C}}getVolumeOfMesh(e){let t=0;const s=new U,i=new U,n=new U,{index:r}=e.geometry,o=e.geometry.attributes.position.array;if(!r)return console.warn("Geometry must be indexed to compute its volume!"),0;const a=[];if(e instanceof Gt)for(let h=0;h<e.count;h++){const I=new Ee;e.getMatrixAt(h,I),a.push(I)}else a.push(new Ee().identity());const{matrixWorld:c}=e;for(let h=0;h<r.array.length-2;h+=3)for(const I of a){const d=I.multiply(c),u=r.array[h]*3,f=r.array[h+1]*3,E=r.array[h+2]*3;s.set(o[u],o[u+1],o[u+2]).applyMatrix4(d),i.set(o[f],o[f+1],o[f+2]).applyMatrix4(d),n.set(o[E],o[E+1],o[E+2]).applyMatrix4(d),t+=this.getSignedVolumeOfTriangle(s,i,n)}return Math.abs(t)}getSignedVolumeOfTriangle(e,t,s){const i=s.x*t.y*e.z,n=t.x*s.y*e.z,r=s.x*e.y*t.z,o=e.x*s.y*t.z,a=t.x*e.y*s.z,c=e.x*t.y*s.z;return 1/6*(-i+n+r-o-a+c)}};p(ya,"uuid","267ca032-672f-4cb0-afa9-d24e904f39d6");let nd=ya;class Yi{constructor(e){p(this,"cardinality","required"),p(this,"instructions"),p(this,"evalRequirement",(t,s,i,n)=>{const r={parameter:i,currentValue:t,requiredValue:s.parameter,pass:!1};n&&this.addCheckResult(r,n);let o=!1;if(s.type==="simple"&&(o=t===s.parameter),s.type==="enumeration"&&(o=s.parameter.includes(t)),s.type==="pattern"&&(o=new RegExp(s.parameter).test(String(t))),s.type==="length"){const{min:a,length:c,max:h}=s.parameter;c!==void 0&&(o=String(t).length===c),a!==void 0&&(o=String(t).length>=a),h!==void 0&&(o=String(t).length<=h)}if(s.type==="bounds"&&typeof t=="number"){const{min:a,minInclusive:c,max:h,maxInclusive:I}=s.parameter;let d=!0,u=!0;a!==void 0&&(d=c?t<=a:t<a),h!==void 0&&(u=I?t>=h:t>h),o=d&&u}return this.cardinality==="prohibited"&&(o=!o),this.cardinality==="optional"&&(o=!0),r.pass=o,r.pass}),p(this,"testResult",[]),this.components=e}addCheckResult(e,t){const s=t.findIndex(({parameter:i})=>i===e.parameter);s!==-1?t[s]=e:t.push(e)}saveResult(e,t){const{GlobalId:s}=e;if(!s)return;const{value:i}=s,n={expressID:i,pass:t,checks:[],cardinality:this.cardinality};this.testResult.push(n)}}const Tt=(l,e)=>{let t="";return e?(e.type==="simple"&&(t=`<ids:simpleValue>${e.parameter}</ids:simpleValue>`),e.type==="enumeration"&&(t=`<xs:restriction base="xs:string">
    ${e.parameter.map(s=>`<xs:enumeration value="${s}" />`).join(`\r
`)}
    </xs:restriction>`),e.type==="pattern"&&(t=`<xs:restriction base="xs:string">
      <xs:pattern value="${e.parameter}" />
    </xs:restriction>`),`<ids:${l[0].toLowerCase()+l.slice(1)}>
    ${t}
  </ids:${l[0].toLowerCase()+l.slice(1)}>`):t};class Gu extends Yi{constructor(e,t){super(e),p(this,"facetType","Attribute"),p(this,"name"),p(this,"value"),this.name=t}serialize(e){const t=Tt("Name",this.name),s=Tt("Value",this.value);let i="";return e==="requirement"&&(i+=`cardinality="${this.cardinality}"`,i+=this.instructions?`instructions="${this.instructions}"`:""),`<ids:attribute ${i}>
  ${t}
  ${s}
</ids:attribute>`}async getEntities(){return[]}async test(e){var t;this.testResult=[];for(const i in e){const n=Number(i),r=e[n],o=[],a={guid:(t=r.GlobalId)==null?void 0:t.value,expressID:n,pass:!1,checks:o,cardinality:this.cardinality};this.testResult.push(a);const c=Object.keys(r).filter(I=>{const d=this.evalRequirement(I,this.name,"Name"),u=r[I];return d&&u===null?this.cardinality==="optional"||this.cardinality==="prohibited":d&&(u==null?void 0:u.type)===3&&u.value===2||d&&Array.isArray(u)&&u.length===0||d&&(u==null?void 0:u.type)===1&&u.value.trim()===""?!1:d}),h=c.length>0;if(o.push({parameter:"Name",currentValue:h?c[0]:null,requiredValue:this.name.parameter,pass:this.cardinality==="prohibited"?!h:h}),this.value)if(c[0]){const I=r[c[0]];(I==null?void 0:I.type)===5?o.push({parameter:"Value",currentValue:null,requiredValue:this.value.parameter,pass:this.cardinality==="prohibited"}):this.evalRequirement(I?I.value:null,this.value,"Value",o)}else o.push({parameter:"Value",currentValue:null,requiredValue:this.value.parameter,pass:this.cardinality==="prohibited"});a.pass=o.every(({pass:I})=>I)}const s=[...this.testResult];return this.testResult=[],s}}class zu extends Yi{constructor(e,t){super(e),p(this,"facetType","Classification"),p(this,"system"),p(this,"value"),p(this,"uri"),this.system=t}serialize(e){const t=Tt("System",this.system),s=Tt("Value",this.value);let i="";return e==="requirement"&&(i+=`cardinality="${this.cardinality}"`,i+=this.uri?`uri=${this.uri}`:"",i+=this.instructions?`instructions="${this.instructions}"`:""),`<ids:classification ${i}>
  ${t}
  ${s}
</ids:classification>`}async getEntities(e,t={}){var s;const i=[],n=await e.getAllPropertiesOfType(It),r=await e.getAllPropertiesOfType(Wt),o={...n,...r},a=[];for(const h in o){const I=Number(h),d=await e.getProperties(I);if(!d)continue;const u=(s=d.ReferencedSource)==null?void 0:s.value;if(!u)continue;const f=await e.getProperties(u);!f||!this.evalSystem(f)||!this.evalValue(d)||!this.evalURI(d)||a.push(I)}const c=this.components.get(Ke);for(const h of a){const I=c.getEntitiesWithRelation(e,"HasAssociations",h);for(const d of I){if(d in t)continue;const u=await e.getProperties(d);u&&(t[d]=u,i.push(d))}}return i}async test(e,t){var s;this.testResult=[];for(const n in e){const r=Number(n),o=e[r],a=[],c={guid:(s=o.GlobalId)==null?void 0:s.value,expressID:r,pass:!1,checks:a,cardinality:this.cardinality};this.testResult.push(c);let h=!0;const I=await this.getSystems(t,r),d=I.map(u=>this.getSystemName(u)).filter(u=>u);for(const u of I){if(!this.evalSystem(u,a))continue;if(h=!1,!(this.value&&this.system))break;if(u.type!==It)continue;const f=!this.value||this.evalValue(u,a),E=!this.uri||this.evalURI(u,a);if(f&&E)break}h&&this.addCheckResult({parameter:"System",currentValue:d,requiredValue:this.system,pass:this.cardinality==="optional"},a),c.pass=a.every(({pass:u})=>u)}const i=[...this.testResult];return this.testResult=[],i}async processReferencedSource(e,t){var s;const i=(s=t.ReferencedSource)==null?void 0:s.value;if(!i)return null;const n=await e.getProperties(i);return n?(n.type===It&&(n.ReferencedSource=await this.processReferencedSource(e,n)),n):null}async getSystems(e,t){var s;const i=[],n=this.components.get(Ke),r=n.getEntityRelations(e,t,"HasAssociations");if(r)for(const I of r){const d=await e.getProperties(I);d&&(d.type===Wt&&i.push(d),d.type===It&&(d.ReferencedSource=await this.processReferencedSource(e,d),d.ReferencedSource&&i.push(d)))}const o=i.map(I=>{var d,u,f;return I.type===Wt?(d=I.Name)==null?void 0:d.value:I.type===It?(f=(u=I.ReferencedSource)==null?void 0:u.Name)==null?void 0:f.value:null}).filter(I=>I),a=n.getEntityRelations(e,t,"IsTypedBy");if(!(a&&a[0]))return i;const c=a[0],h=n.getEntityRelations(e,c,"HasAssociations");if(h)for(const I of h){const d=await e.getProperties(I);if(d){if(d.type===Wt){if(o.includes((s=d.Name)==null?void 0:s.value))continue;i.push(d)}d.type===It&&(d.ReferencedSource=await this.processReferencedSource(e,d),d.ReferencedSource&&i.push(d))}}return i}getSystemName(e){var t,s,i,n;if(e.type===Wt)return(t=e.Name)==null?void 0:t.value;if(e.type===It){if(((s=e.ReferencedSource)==null?void 0:s.type)===It)return this.getSystemName(e.ReferencedSource);if(((i=e.ReferencedSource)==null?void 0:i.type)===Wt)return(n=e.ReferencedSource.Name)==null?void 0:n.value}return null}getAllReferenceIdentifications(e){if(e.type!==It)return null;const t=[];if(e.Identification&&t.push(e.Identification.value),e.ReferencedSource){const s=this.getAllReferenceIdentifications(e.ReferencedSource);s&&t.push(...s)}return t}evalSystem(e,t){const s=this.getSystemName(e);return this.evalRequirement(s,this.system,"System",t)}evalValue(e,t){if(!this.value)return!0;const s=this.getAllReferenceIdentifications(e);if(!s)return!1;const i=s.find(n=>this.value?this.evalRequirement(n,this.value,"Value"):!1);return t&&this.addCheckResult({parameter:"Value",currentValue:i??null,requiredValue:this.value,pass:!!i},t),!!i}evalURI(e,t){var s;return this.uri?this.evalRequirement((s=e.Location)==null?void 0:s.value,{type:"simple",parameter:this.uri},"URI",t):!0}}class ku extends Yi{constructor(e,t){super(e),p(this,"facetType","Entity"),p(this,"name"),p(this,"predefinedType"),this.name=t}serialize(e){const t=Tt("Name",this.name),s=Tt("Name",this.predefinedType);let i="";return e==="requirement"&&(i+=`cardinality="${this.cardinality}"`,i+=this.instructions?`instructions="${this.instructions}"`:""),`<ids:entity ${i}>
  ${t}
  ${s}
</ids:entity>`}async getEntities(e,t={}){const s=Object.entries(wi),i=[];for(const[o]of s)await this.evalName({type:o})&&i.push(Number(o));let n={};for(const o of i){const a=await e.getAllPropertiesOfType(o);a&&(n={...n,...a})}if(!this.predefinedType){for(const o in n)o in t||(t[o]=n[o]);return Object.keys(n).map(Number)}const r=[];for(const o in n){const a=Number(o);if(a in t)continue;const c=n[a];await this.evalPredefinedType(e,c)&&(t[a]=c,r.push(a))}return r}async test(e,t){var s;this.testResult=[];for(const i in e){const n=Number(i),r=e[n],o=[],a={guid:(s=r.GlobalId)==null?void 0:s.value,expressID:n,pass:!1,checks:o,cardinality:this.cardinality};this.testResult.push(a),await this.evalName(r,o),await this.evalPredefinedType(t,r,o),a.pass=o.every(({pass:c})=>c)}return this.testResult}async evalName(e,t){const s=wi[e.type];return this.evalRequirement(s,this.name,"Name",t)}async evalPredefinedType(e,t,s){var i,n,r,o;if(!this.predefinedType)return null;const a=this.components.get(Ke),c=typeof this.predefinedType.parameter=="string"&&this.predefinedType.parameter==="USERDEFINED";let h=(i=t.PredefinedType)==null?void 0:i.value;if(h==="USERDEFINED"&&!c){const I=Object.keys(t).find(d=>/^((?!Predefined).)*Type$/.test(d));h=I?(n=t[I])==null?void 0:n.value:"USERDEFINED"}if(!h){const I=a.getEntityRelations(e,t.expressID,"IsTypedBy");if(I&&I[0]){const d=await e.getProperties(I[0]);if(d&&(h=(r=d.PredefinedType)==null?void 0:r.value,h==="USERDEFINED"&&!c)){const u=Object.keys(d).find(f=>/^((?!Predefined).)*Type$/.test(f));h=u?(o=d[u])==null?void 0:o.value:"USERDEFINED"}}}return this.evalRequirement(h,this.predefinedType,"PredefinedType",s)}}class Hu extends Yi{constructor(e,t,s){super(e),p(this,"facetType","Property"),p(this,"propertySet"),p(this,"baseName"),p(this,"value"),p(this,"dataType"),p(this,"uri"),p(this,"_unsupportedTypes",[Qa,Ka]),this.propertySet=t,this.baseName=s}serialize(e){const t=Tt("PropertySet",this.propertySet),s=Tt("BaseName",this.baseName),i=Tt("Value",this.value),n=this.dataType?`dataType=${this.dataType}`:"";let r="";return e==="requirement"&&(r+=`cardinality="${this.cardinality}"`,r+=this.uri?`uri=${this.uri}`:"",r+=this.instructions?`instructions="${this.instructions}"`:""),`<ids:property ${n} ${r}>
  ${t}
  ${s}
  ${i}
</ids:property>`}async getEntities(e,t={}){var s,i;let n={};const r=await e.getAllPropertiesOfType(ls);n={...n,...r};const o=await e.getAllPropertiesOfType(Ri);if(n={...n,...o},Object.keys(n).length===0)return[];const a=[];for(const h in n){const I=Number(h),d=await e.getProperties(I);if(!d||((s=d.Name)==null?void 0:s.value)!==this.propertySet.parameter)continue;let u;if(d.type===ls&&(u="HasProperties"),d.type===Ri&&(u="Quantities"),!!u)for(const f of d[u]){const E=await e.getProperties(f.value);if(!(!E||((i=E.Name)==null?void 0:i.value)!==this.baseName.parameter)){if(this.value){const C=Object.keys(E).find(T=>T.endsWith("Value"));if(!C||E[C].value!==this.value.parameter)continue}a.push(I)}}}const c=this.components.get(Ke);for(const h of a){const I=c.getEntitiesWithRelation(e,"IsDefinedBy",h);for(const d of I){if(d in t)continue;const u=await e.getProperties(d);u&&(t[d]=u)}}return[]}async test(e,t){var s;this.testResult=[];for(const n in e){const r=Number(n),o=e[r],a=[],c={guid:(s=o.GlobalId)==null?void 0:s.value,expressID:r,pass:!1,checks:a,cardinality:this.cardinality};this.testResult.push(c);const h=(await this.getPsets(t,r)).filter(I=>{var d;return this.evalRequirement(((d=I.Name)==null?void 0:d.value)??null,this.propertySet,"PropertySet")?(a.push({currentValue:I.Name.value,parameter:"PropertySet",pass:!0,requiredValue:this.propertySet.parameter}),!0):!1});if(h.length===0){a.push({currentValue:null,parameter:"PropertySet",pass:!1,requiredValue:this.propertySet.parameter});continue}for(const I of h){const d=this.getItemsAttrName(I.type);if(!d){a.push({currentValue:null,parameter:"BaseName",pass:!1,requiredValue:this.baseName.parameter});continue}const u=I[d].filter(f=>{var E;return this._unsupportedTypes.includes(f.type)||!this.evalRequirement(((E=f.Name)==null?void 0:E.value)??null,this.baseName,"BaseName")?!1:(a.push({currentValue:f.Name.value,parameter:"BaseName",pass:!0,requiredValue:this.baseName.parameter}),!0)});if(u.length===0){a.push({currentValue:null,parameter:"BaseName",pass:!1,requiredValue:this.baseName.parameter});continue}for(const f of u)this.evalValue(f,a),this.evalDataType(f,a),this.evalURI()}c.pass=a.every(({pass:I})=>I)}const i=[...this.testResult];return this.testResult=[],i}getItemsAttrName(e){let t;return e===ls&&(t="HasProperties"),e===Ri&&(t="Quantities"),t}getValueKey(e){return Object.keys(e).find(t=>t.endsWith("Value")||t.endsWith("Values"))}async getPsetProps(e,t,s){const i=structuredClone(t),n=[],r=i[s];if(!r)return n;for(const{value:o}of r){const a=await e.getProperties(o);a&&n.push(a)}return i[s]=n,i}async getTypePsets(e,t){const s=[],i=this.components.get(Ke).getEntityRelations(e,t,"IsTypedBy");if(!(i&&i[0]))return s;const n=await e.getProperties(i[0]);if(!(n&&"HasPropertySets"in n&&Array.isArray(n.HasPropertySets)))return s;for(const{value:r}of n.HasPropertySets){const o=await e.getProperties(r);if(!(o&&"HasProperties"in o&&Array.isArray(o.HasProperties)))continue;const a=await this.getPsetProps(e,o,"HasProperties");s.push(a)}return s}async getPsets(e,t){const s=await this.getTypePsets(e,t),i=this.components.get(Ke).getEntityRelations(e,t,"IsDefinedBy");if(!i)return s;for(const n of i){const r=await e.getProperties(n);if(!r)continue;const o=this.getItemsAttrName(r.type);if(!o)continue;const a=await this.getPsetProps(e,r,o);s.push(a)}return s}evalValue(e,t){const s=this.getValueKey(e),i=e[s];if(this.value){if(!i)return t==null||t.push({parameter:"Value",currentValue:null,pass:!1,requiredValue:this.value.parameter}),!1;const n=structuredClone(this.value);if(i.name==="IFCLABEL"&&n.type==="simple"&&(n.parameter=String(n.parameter)),(e.type===ur||e.type===dr)&&Array.isArray(i)){const r=i.map(a=>a.value),o=i.find(a=>n?this.evalRequirement(a.value,n,"Value"):!1);return t==null||t.push({currentValue:r,pass:!!o,parameter:"Value",requiredValue:n.parameter}),!!o}return this.evalRequirement(i.value,n,"Value",t)}return s?i.type===3&&i.value===2?(t==null||t.push({parameter:"Value",currentValue:null,pass:!1,requiredValue:null}),!1):i.type===1&&i.value.trim()===""?(t==null||t.push({parameter:"Value",currentValue:"",pass:!1,requiredValue:null}),!1):!0:!0}evalDataType(e,t){if(!this.dataType)return!0;const s=this.getValueKey(e),i=e[s];if(!i)return t==null||t.push({parameter:"DataType",currentValue:null,pass:!1,requiredValue:this.dataType}),!1;if((e.type===ur||e.type===dr)&&Array.isArray(i)&&i[0]){const n=i[0].name;return this.evalRequirement(n,{type:"simple",parameter:this.dataType},"DataType",t)}return this.evalRequirement(i.name,{type:"simple",parameter:this.dataType},"DataType",t)}evalURI(){return!0}}class Wu{constructor(e,t,s){p(this,"name"),p(this,"ifcVersion",new Set),p(this,"identifier",gt.create()),p(this,"description"),p(this,"instructions"),p(this,"requirementsDescription"),p(this,"applicability",new Pt),p(this,"requirements",new Pt),p(this,"components"),this.components=e,this.name=t;for(const i of s)this.ifcVersion.add(i)}set(e){const t=e,s=this;for(const i in e){if(i==="identifier")continue;const n=t[i];i in this&&(s[i]=n)}return this.components.get($u).list.set(this.identifier,this),this}async test(e){let t=[];if(this.requirements.size===0)return t;const s={};for(const i of this.applicability)await i.getEntities(e,s);return t=await[...this.requirements][0].test(s,e),t}serialize(){const e=`name="${this.name}"`,t=this.identifier?`identifier="${this.identifier}"`:"",s=this.description?`description="${this.description}"`:"",i=this.instructions?`instructions="${this.instructions}"`:"";return`<ids:specification ifcVersion="${[...this.ifcVersion].join(" ")}" ${e} ${t} ${s} ${i}>
      <ids:applicability minOccurs="1" maxOccurs="unbounded">
        ${[...this.applicability].map(n=>n.serialize("applicability"))}
      </ids:applicability>
      <ids:requirements>
        ${[...this.requirements].map(n=>n.serialize("requirement"))}
      </ids:requirements>
    </ids:specification>`}}const mt=l=>{if(!l)return;const e={};if("simpleValue"in l&&(e.type="simple",e.parameter=l.simpleValue),"restriction"in l){const t=l.restriction;if("pattern"in t&&(e.type="pattern",e.parameter=t.pattern.value),"enumeration"in t){e.type="enumeration";const s=t.enumeration.map(({value:i})=>i);e.parameter=s}}if(e.parameter!==void 0)return e},co=(l,e)=>{const t=[];for(const s of e){const i=s.name,n=mt(i);if(!n)continue;const r=new ku(l,n);s.cardinality&&(r.cardinality=s.cardinality),r.predefinedType=mt(s.predefinedType),r.instructions=s.instructions,t.push(r)}return t},Xu=(l,e)=>{const t=[];for(const s of e){const i=s.name,n=mt(i);if(!n)continue;const r=new Gu(l,n);s.cardinality&&(r.cardinality=s.cardinality),r.value=mt(s.value),r.instructions=s.instructions,t.push(r)}return t},ju=(l,e)=>{const t=[];for(const s of e){const i=s.system,n=mt(i);if(!n)continue;const r=new zu(l,n);s.cardinality&&(r.cardinality=s.cardinality);const o=mt(s.value);(o==null?void 0:o.type)==="simple"&&(o.parameter=String(o.parameter)),(o==null?void 0:o.type)==="enumeration"&&Array.isArray(o.parameter)&&(o.parameter=o.parameter.map(String)),r.value=o,r.uri=s.uri,r.instructions=s.instructions,t.push(r)}return t},Zu=(l,e)=>{const t=[];for(const s of e){const i=s.propertySet,n=s.baseName,r=mt(i),o=mt(n);if(!(o&&r))continue;const a=new Hu(l,r,o);s.cardinality&&(a.cardinality=s.cardinality);const c=mt(s.value);(c==null?void 0:c.type)==="enumeration"&&Array.isArray(c.parameter)&&(c.parameter=c.parameter.map(String)),a.value=c,a.dataType=s.dataType,a.uri=s.uri,a.instructions=s.instructions,t.push(a)}return t},Pn=class vn extends Ae{constructor(e){super(e),p(this,"enabled",!0),p(this,"list",new rt),e.add(vn.uuid,this)}getFragmentIdMap(e,t){const s=t.filter(o=>o.pass).map(o=>o.expressID),i=e.getFragmentMap(s),n=t.filter(o=>!o.pass).map(o=>o.expressID),r=e.getFragmentMap(n);return{pass:i,fail:r}}create(e,t,s){const i=new Wu(this.components,e,t);return s&&(i.identifier=s),this.list.set(i.identifier,i),i}load(e){const t=[],s=vn.xmlParser.parse(e).ids,{specifications:i}=s;if(i&&i.specification){const n=Array.isArray(i.specification)?i.specification:[i.specification];for(const r of n){const{name:o,ifcVersion:a,description:c,instructions:h,identifier:I}=r;if(!(o&&a))continue;const d=[],u=[],{applicability:f,requirements:E}=r;if(f){const{maxOccurs:T,...R}=f,A=Array.isArray(R)?R:[R];for(const m of A)for(const S in m){const N=Array.isArray(m[S])?m[S]:[m[S]];if(S==="entity"){const y=co(this.components,N);d.push(...y)}}}let C;if(E){const{maxOccurs:T,...R}=E;C=E.description;const A=Array.isArray(R)?R:[R];for(const m of A)for(const S in m){const N=Array.isArray(m[S])?m[S]:[m[S]];if(S==="entity"){const y=co(this.components,N);u.push(...y)}if(S==="attribute"){const y=Xu(this.components,N);u.push(...y)}if(S==="classification"){const y=ju(this.components,N);u.push(...y)}if(S==="property"){const y=Zu(this.components,N);u.push(...y)}}}if(d.length>0&&u.length>0){const T=this.create(o,a.split(/\s+/),I);T.description=c,T.instructions=h,T.requirementsDescription=C,T.applicability.add(...d),T.requirements.add(...u),t.push(T)}}}return t}export(e,t=this.list.values()){const s=t??this.list;return`<ids:ids xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://standards.buildingsmart.org/IDS http://standards.buildingsmart.org/IDS/1.0/ids.xsd" xmlns:ids="http://standards.buildingsmart.org/IDS">
  <!-- Made with That Open Engine ${So.release} (https://github.com/thatopen/engine_components) -->
  <ids:info>
    <ids:title>${e.title}</ids:title>
    ${e.copyright?`<ids:copyright>${e.copyright}</ids:copyright>`:""}
    ${e.version?`<ids:version>${e.version}</ids:version>`:""}
    ${e.description?`<ids:description>${e.description}</ids:description>`:""}
    ${e.author?`<ids:author>${e.author}</ids:author>`:""}
    ${e.date?`<ids:date>${e.date.toISOString().split("T")[0]}</ids:date>`:""}
    ${e.purpose?`<ids:purpose>${e.purpose}</ids:purpose>`:""}
    ${e.milestone?`<ids:milestone>${e.milestone}</ids:milestone>`:""}
  </ids:info>
  <ids:specifications>
    ${[...s].map(i=>i.serialize()).join(`
`)}
  </ids:specifications>
</ids:ids>`}};p(Pn,"uuid","9f0b9f78-9b2e-481a-b766-2fbfd01f342c"),p(Pn,"xmlParser",new ia.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));let $u=Pn;export{nd as $,lo as A,_n as B,So as C,Du as D,Ke as G,td as H,Eh as L,Ye as M,hh as N,sh as O,ah as P,Nc as Q,ro as R,Gc as S,wo as T,sd as W,id as X,Re as a,uh as b,Fn as c,wi as d,Pc as e,xu as f,ao as g,Mu as h,pt as i,Ku as j,ed as k,Qu as m,gt as o,zs as x,Ju as y};
