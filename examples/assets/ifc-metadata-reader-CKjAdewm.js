var L=Object.defineProperty;var A=(d,t,e)=>t in d?L(d,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[t]=e;var l=(d,t,e)=>(A(d,typeof t!="symbol"?t+"":t,e),e);import{am as R,a as y,K as S,a0 as I,a8 as C,a9 as G,d as F,b as D,aa as T}from"./unzipit.module-aSGGZIxN.js";import{C as O,A as E}from"./serializer-BuFxedjR.js";const z=new Set([1123145078,574549367,1675464909,2059837836,3798115385,32440307,3125803723,3207858831,2740243338,2624227202,4240577450,3615266464,3724593414,220341763,477187591,1878645084,1300840506,3303107099,1607154358,1878645084,846575682,1351298697,2417041796,3049322572,3331915920,1416205885,776857604,3285139300,3958052878,2827736869,2732653382,673634403,3448662350,4142052618,2924175390,803316827,2556980723,1809719519,2205249479,807026263,3737207727,1660063152,2347385850,3940055652,2705031697,3732776249,2485617015,2611217952,1704287377,2937912522,2770003689,1281925730,1484403080,3448662350,4142052618,3800577675,4006246654,3590301190,1383045692,2775532180,2047409740,370225590,3593883385,2665983363,4124623270,812098782,3649129432,987898635,1105321065,3510044353,1635779807,2603310189,3406155212,1310608509,4261334040,2736907675,3649129432,1136057603,1260505505,4182860854,2713105998,2898889636,59481748,3749851601,3486308946,3150382593,1062206242,3264961684,15328376,1485152156,370225590,1981873012,2859738748,45288368,2614616156,2732653382,775493141,2147822146,2601014836,2629017746,1186437898,2367409068,1213902940,3632507154,3900360178,476780140,1472233963,2804161546,3008276851,738692330,374418227,315944413,3905492369,3570813810,2571569899,178912537,2294589976,1437953363,2133299955,572779678,3092502836,388784114,2624227202,1425443689,3057273783,2347385850,1682466193,2519244187,2839578677,3958567839,2513912981,2830218821,427810014]);class U{constructor(){l(this,"factor",1);l(this,"complement",1)}apply(t){const s=this.getScaleMatrix().multiply(t);t.copy(s)}setUp(t){var o;this.factor=1;const e=this.getLengthUnits(t);if(!e)return;const s=e==null,n=e.Name===void 0||e.Name===null;s||n||(e.Name.value==="FOOT"?this.factor=.3048:((o=e.Prefix)==null?void 0:o.value)==="MILLI"&&(this.complement=.001))}getLengthUnits(t){try{const s=t.GetLineIDsWithType(0,R).get(0),n=t.GetLine(0,s);for(const o of n.Units){if(!o||o.value===null||o.value===void 0)continue;const f=t.GetLine(0,o.value);if(f.UnitType&&f.UnitType.value==="LENGTHUNIT")return f}return null}catch{return console.log("Could not get units"),null}}getScaleMatrix(){const t=this.factor;return new y().fromArray([t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1])}}class j{constructor(){l(this,"itemsByFloor",{});l(this,"_units",new U)}setUp(t){this._units.setUp(t),this.cleanUp();try{const e=t.GetLineIDsWithType(0,S),s=new Set,n=t.GetLineIDsWithType(0,I);for(let a=0;a<n.size();a++)s.add(n.get(a));const o=t.GetLineIDsWithType(0,C),f=o.size();for(let a=0;a<f;a++){const g=o.get(a),i=t.GetLine(0,g);if(!i||!i.RelatingObject||!i.RelatedObjects)continue;const r=i.RelatingObject.value,m=i.RelatedObjects;for(const c of m){const u=c.value;s.has(u)&&(this.itemsByFloor[u]=r)}}const h={},p=e.size();for(let a=0;a<p;a++){const g=e.get(a),i=t.GetLine(0,g);if(!i||!i.RelatingStructure||!i.RelatedElements)continue;const r=i.RelatingStructure.value,m=i.RelatedElements;if(s.has(r))for(const c of m){h[r]||(h[r]=[]);const u=c.value;h[r].push(u)}else for(const c of m){const u=c.value;this.itemsByFloor[u]=r}}for(const a in h){const g=this.itemsByFloor[a];if(g!==void 0){const i=h[a];for(const r of i)this.itemsByFloor[r]=g}}for(let a=0;a<f;a++){const g=o.get(a),i=t.GetLine(0,g);if(!i||!i.RelatingObject||!i.RelatedObjects)continue;const r=i.RelatingObject.value,m=i.RelatedObjects;for(const c of m){const u=c.value,v=this.itemsByFloor[r];v!==void 0&&(this.itemsByFloor[u]=v)}}}catch{console.log("Could not get floors.")}}cleanUp(){this.itemsByFloor={}}}class x{constructor(){l(this,"includeProperties",!0);l(this,"optionalCategories",[I]);l(this,"coordinate",!0);l(this,"wasm",{path:"",absolute:!1,logLevel:G.LOG_LEVEL_OFF});l(this,"excludedCategories",new Set);l(this,"saveLocations",!1);l(this,"webIfc",{COORDINATE_TO_ORIGIN:!0,OPTIMIZE_PROFILES:!0});l(this,"autoSetWasm",!0);l(this,"customLocateFileHandler",null)}}class P{constructor(){l(this,"defLineMat",new F({color:16777215}))}read(t){const e=t.GetAllAlignments(0),s=t.GetAllCrossSections2D(0),n=t.GetAllCrossSections3D(0),o={IfcAlignment:e,IfcCrossSection2D:s,IfcCrossSection3D:n};return this.get(o)}get(t){if(t.IfcAlignment){const e=new Map;for(const s of t.IfcAlignment){const n=new E;n.absolute=this.getCurves(s.curve3D,n),n.horizontal=this.getCurves(s.horizontal,n),n.vertical=this.getCurves(s.vertical,n),e.set(e.size,n)}return{alignments:e,coordinationMatrix:new y}}}getCurves(t,e){const s=[];let n=0;for(const o of t){const f={};if(o.data)for(const r of o.data){const[m,c]=r.split(": "),u=parseFloat(c);f[m]=u||c}const{points:h}=o,p=new Float32Array(h.length*3);for(let r=0;r<h.length;r++){const{x:m,y:c,z:u}=h[r];p[r*3]=m,p[r*3+1]=c,p[r*3+2]=u||0}const a=new D(p,3),g=new T;g.setAttribute("position",a);const i=new O(n,f,e,g,this.defLineMat);s.push(i.curve),n++}return s}}class _{get(t,e){let s="";const n=t.GetHeaderLine(0,e)||"";if(!n)return s;for(const o of n.arguments)if(o!=null)if(Array.isArray(o))for(const f of o)s+=`${f.value}|`;else s+=`${o.value}|`;return s}}export{P as C,z as G,x as I,j as S,_ as a};
