var F=Object.defineProperty;var A=(i,a,e)=>a in i?F(i,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[a]=e;var l=(i,a,e)=>(A(i,typeof a!="symbol"?a+"":a,e),e);import{M as B,V as C,I as P,a as L,C as j}from"./web-ifc-api-BFxa4VQ4.js";import{S as H}from"./stats.min-GTpOrGrX.js";import{i as I,U as T,H as U}from"./import-wrapper-prod-BtIvq9o4.js";import{P as W}from"./index-BneKMXsD.js";import{D as K}from"./types-BHr6GdIp.js";import{M as N}from"./mark-Fi_tU5tP.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./index-Czb5ZY1a.js";const g=class g extends I{constructor(e){super(e);l(this,"label");l(this,"world");l(this,"onVolumeFound",new T);l(this,"_enabled",!1);l(this,"onDisposed",new T);l(this,"create",()=>{if(!this.enabled)return;if(!this.world)throw new Error("World is needed for Volume Measurement!");const t=this.components.get(U).get(this.world).castRay();if(!t||!t.object)return;const{object:s}=t;if(s instanceof B){const d=this.getVolumeOfMesh(s);this.onVolumeFound.trigger(d)}});l(this,"onMouseMove",()=>{});l(this,"onKeydown",e=>{});this.components.add(g.uuid,this),this.label=this.newLabel(),this.label.three.removeFromParent()}set enabled(e){this._enabled=e,this.setupEvents(e),e||this.cancelCreation()}get enabled(){return this._enabled}async dispose(){this.setupEvents(!1),this.label.dispose(),this.onDisposed.trigger(),this.onDisposed.reset(),this.components=null}delete(){}async deleteAll(){}endCreation(){}cancelCreation(){}get(){}getVolumeFromMeshes(e){if(!this.world)throw new Error("World is needed for Volume Measurement!");let n=0;for(const c of e)n+=this.getVolumeOfMesh(c);const t=this.world.scene.three,s=this.label.three;t.add(s);const d=this.components.get(void 0);for(const c of e)c.geometry.computeBoundingSphere(),d.addMesh(c);const m=d.getSphere();d.reset(),s.position.copy(m.center);const r=Math.trunc(n*100)/100;return s.element.textContent=r.toString(),n}newLabel(){if(!this.world)throw new Error("World is needed for Volume Measurement!");const e=document.createElement("div");return e.className=K,new N(this.world,e)}setupEvents(e){if(!this.world)throw new Error("The volume measurement needs a world to work!");if(!this.world.renderer)throw new Error("The world of the volume measurement needs a renderer!");const t=this.world.renderer.three.domElement.parentElement;e?(t.addEventListener("click",this.create),t.addEventListener("mousemove",this.onMouseMove),window.addEventListener("keydown",this.onKeydown)):(t.removeEventListener("click",this.create),t.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("keydown",this.onKeydown))}getVolumeOfMesh(e){let n=0;const t=new C,s=new C,d=new C,{index:m}=e.geometry,r=e.geometry.attributes.position.array;if(!m)return console.warn("Geometry must be indexed to compute its volume!"),0;const c=[];if(e instanceof P)for(let u=0;u<e.count;u++){const p=new L;e.getMatrixAt(u,p),c.push(p)}else c.push(new L().identity());const{matrixWorld:b}=e;for(let u=0;u<m.array.length-2;u+=3)for(const p of c){const v=p.multiply(b),M=m.array[u]*3,x=m.array[u+1]*3,E=m.array[u+2]*3;t.set(r[M],r[M+1],r[M+2]).applyMatrix4(v),s.set(r[x],r[x+1],r[x+2]).applyMatrix4(v),d.set(r[E],r[E+1],r[E+2]).applyMatrix4(v),n+=this.getSignedVolumeOfTriangle(t,s,d)}return Math.abs(n)}getSignedVolumeOfTriangle(e,n,t){const s=t.x*n.y*e.z,d=n.x*t.y*e.z,m=t.x*e.y*n.z,r=e.x*t.y*n.z,c=n.x*e.y*t.z,b=e.x*n.y*t.z;return 1/6*(-s+d+m-r-c+b)}};l(g,"uuid","811da532-7af3-4635-b592-1c06ae494af5");let V=g;const k=document.getElementById("container"),o=new(void 0),D=new(void 0)(o);D.setup();o.scene=D;const h=new W(o,k);o.renderer=h;const O=new(void 0)(o);o.camera=O;o.raycaster=new(void 0)(o);o.init();h.postproduction.enabled=!0;O.controls.setLookAt(10,10,10,0,0,0);const R=new(void 0)(o,new j(6710886)),_=h.postproduction.customEffects;_.excludedMeshes.push(R.get());const f=new V(o),S=new(void 0)(o),G=await fetch("../../../resources/small.frag"),q=await G.arrayBuffer(),J=new Uint8Array(q);S.load(J);const y=new(void 0)(o);y.setup();y.updateHighlight();y.events.select.onHighlight.add(i=>{const a=Object.keys(i),e=[];for(const t of a){const s=S.list[t].fragments;s.select&&e.push(s.select.mesh)}const n=f.getVolumeFromMeshes(e);console.log(n)});y.events.select.onClear.add(()=>{f.label.get().removeFromParent()});k.ondblclick=()=>f.create();k.oncontextmenu=()=>f.endCreation();window.onkeydown=i=>{i.code==="Delete"||i.code};const z=new(void 0)(o,{name:"Main Toolbar",position:"bottom"});z.addChild(f.uiElement.get("main"));o.ui.addToolbar(z);const w=new H;w.showPanel(2);document.body.append(w.dom);w.dom.style.left="0px";h.onBeforeUpdate.add(()=>w.begin());h.onAfterUpdate.add(()=>w.end());
