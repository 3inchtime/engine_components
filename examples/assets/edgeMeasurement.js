var S=Object.defineProperty;var D=(d,c,e)=>c in d?S(d,c,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[c]=e;var o=(d,c,e)=>(D(d,typeof c!="symbol"?c+"":c,e),e);import{L as K,V as v,M as z,I,C as U}from"./web-ifc-api-CmZKgq4q.js";import{S as B}from"./stats.min-GTpOrGrX.js";import{J as O,U as V,H as j,_ as C}from"./import-wrapper-prod-Cl9qVCJR.js";import{P as F}from"./index-CINZ6ccg.js";import{S as H}from"./index-DTvJrBln.js";import{L as w}from"./index-1nXh293I.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./renderer-with-2d-RJhD6QVJ.js";import"./types-BHr6GdIp.js";import"./mark-B0joXqB1.js";const b=class b extends O{constructor(e){super(e);o(this,"preview");o(this,"tolerance",.3);o(this,"world");o(this,"onDisposed",new V);o(this,"_enabled",!1);o(this,"_lineMaterial",new K({color:"#DC2626",linewidth:2,depthTest:!1,transparent:!0}));o(this,"create",async()=>{if(!this.preview||!this.enabled||!this.preview.visible)return;const e=this.components.get(w),s=this.preview.startPoint.clone(),t=this.preview.endPoint.clone();e.createOnPoints(s,t)});o(this,"onMouseMove",()=>{if(!this.preview)return;if(!this.world)throw new Error("The edge measurement needs a world to work!");if(!this.enabled){this.preview.visible=!1;return}const t=this.components.get(j).get(this.world).castRay();if(!t||!t.object){this.preview.visible=!1;return}const{object:i,faceIndex:a,point:r}=t;if(a===void 0){this.preview.visible=!1;return}i instanceof z||i instanceof I?this.updateSelection(i,r,a,t.instanceId):this.preview.visible=!1});o(this,"onKeydown",e=>{});this.components.add(b.uuid,this)}set enabled(e){if(this._enabled=e,this.setupEvents(e),e){if(!this.world)throw new Error("The edge measurement needs a world to work!");if(!this.preview){const s=document.createElement("div");s.className="w-2 h-2 bg-red-600 rounded-full",this.preview=new H(this.components,this.world,{start:new v,end:new v,lineMaterial:this._lineMaterial,endpointElement:s}),this.preview.visible=!1}}else this.cancelCreation()}get enabled(){return this._enabled}dispose(){this.preview&&this.preview.dispose(),this._lineMaterial.dispose(),this.setupEvents(!1),this.onDisposed.trigger(),this.onDisposed.reset(),this.components=null}delete(){if(!this.enabled)return;const e=this.components.get(w),s=e.enabled;e.enabled=!0,e.delete(),e.enabled=s}async deleteAll(){await this.components.get(w).deleteAll()}endCreation(){}cancelCreation(){}get(){const s=this.components.get(w).list,t=[];for(const i of s){const a=i.startPoint,r=i.endPoint,l=[a.x,a.y,a.z,r.x,r.y,r.z];t.push(l)}return t}set(e){const s=this.components.get(w);for(const t of e){const[i,a,r,l,u,m]=t,g=new v(i,a,r),y=new v(l,u,m);s.createOnPoints(g,y)}}setupEvents(e){if(!this.world)throw new Error("The edge measurement needs a world to work!");if(!this.world.renderer)throw new Error("The world of the edge measurement needs a renderer!");const t=this.world.renderer.three.domElement.parentElement;e?(t.addEventListener("click",this.create),t.addEventListener("mousemove",this.onMouseMove),window.addEventListener("keydown",this.onKeydown)):(t.removeEventListener("click",this.create),t.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("keydown",this.onKeydown))}updateSelection(e,s,t,i){if(!this.preview||!e.geometry.index)return;const r=this.components.get(C).getFace(e,t,i);if(!r)return;const{edges:l}=r;let u=Number.MAX_VALUE,m=[];for(const P of l){const[A,_]=P.points,E=C.distanceFromPointToLine(s,A,_,!0);E<this.tolerance&&E<u&&(u=E,m=P.points)}if(!m.length){this.preview.visible=!1;return}const[g,y]=m;this.preview.startPoint=g,this.preview.endPoint=y,this.preview.visible=!0}};o(b,"uuid","e7be5749-89df-4514-8d25-83aa38ce12d8");let M=b;const N=document.getElementById("container"),n=new(void 0),k=new(void 0)(n);k.setup();n.scene=k;const p=new F(n,N);n.renderer=p;const x=new(void 0)(n);n.camera=x;n.raycaster=new(void 0)(n);n.init();p.postproduction.enabled=!0;n.scene.get();x.controls.setLookAt(10,10,10,0,0,0);const R=new(void 0)(n,new U(6710886)),J=p.postproduction.customEffects;J.excludedMeshes.push(R.get());const h=new M(n),X=new(void 0)(n),q=await fetch("../../../resources/small.frag"),G=await q.arrayBuffer(),Q=new Uint8Array(G);X.load(Q);let L;window.addEventListener("keydown",d=>{d.code==="KeyO"?h.delete():d.code==="KeyS"?(L=h.get(),h.deleteAll()):d.code==="KeyL"&&L&&h.set(L)});const T=new(void 0)(n,{name:"Main Toolbar",position:"bottom"});T.addChild(h.uiElement.get("main"));n.ui.addToolbar(T);const f=new B;f.showPanel(2);document.body.append(f.dom);f.dom.style.left="0px";p.onBeforeUpdate.add(()=>f.begin());p.onAfterUpdate.add(()=>f.end());
