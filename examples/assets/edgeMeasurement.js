var S=Object.defineProperty;var D=(d,c,e)=>c in d?S(d,c,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[c]=e;var o=(d,c,e)=>(D(d,typeof c!="symbol"?c+"":c,e),e);import{L as K,V as v,M as _,I as z,C as I}from"./web-ifc-api-BFxa4VQ4.js";import{S as U}from"./stats.min-GTpOrGrX.js";import{i as B,U as O,H as V,a as P}from"./import-wrapper-prod-BtIvq9o4.js";import{P as j}from"./index-BneKMXsD.js";import{S as F}from"./index-BqI3RFZr.js";import{L as m}from"./index-BC5vTgiV.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./index-Czb5ZY1a.js";import"./types-BHr6GdIp.js";import"./mark-Fi_tU5tP.js";const b=class b extends B{constructor(e){super(e);o(this,"preview");o(this,"tolerance",.3);o(this,"world");o(this,"onDisposed",new O);o(this,"_enabled",!1);o(this,"_lineMaterial",new K({color:"#DC2626",linewidth:2,depthTest:!1,transparent:!0}));o(this,"create",async()=>{if(!this.preview||!this.enabled||!this.preview.visible)return;const e=this.components.get(m),s=this.preview.startPoint.clone(),t=this.preview.endPoint.clone();e.createOnPoints(s,t)});o(this,"onMouseMove",()=>{if(!this.preview)return;if(!this.world)throw new Error("The edge measurement needs a world to work!");if(!this.enabled){this.preview.visible=!1;return}const t=this.components.get(V).get(this.world).castRay();if(!t||!t.object){this.preview.visible=!1;return}const{object:r,faceIndex:i,point:a}=t;if(i===void 0){this.preview.visible=!1;return}r instanceof _||r instanceof z?this.updateSelection(r,a,i,t.instanceId):this.preview.visible=!1});o(this,"onKeydown",e=>{});this.components.add(b.uuid,this)}set enabled(e){if(this._enabled=e,this.setupEvents(e),e){if(!this.world)throw new Error("The edge measurement needs a world to work!");if(!this.preview){const s=document.createElement("div");s.className="w-2 h-2 bg-red-600 rounded-full",this.preview=new F(this.components,this.world,{start:new v,end:new v,lineMaterial:this._lineMaterial,endpointElement:s}),this.preview.visible=!1}}else this.cancelCreation()}get enabled(){return this._enabled}dispose(){this.preview&&this.preview.dispose(),this._lineMaterial.dispose(),this.setupEvents(!1),this.onDisposed.trigger(),this.onDisposed.reset(),this.components=null}delete(){if(!this.enabled)return;const e=this.components.get(m),s=e.enabled;e.enabled=!0,e.delete(),e.enabled=s}async deleteAll(){await this.components.get(m).deleteAll()}endCreation(){}cancelCreation(){}get(){const s=this.components.get(m).list,t=[];for(const r of s){const i=r.startPoint,a=r.endPoint,l=[i.x,i.y,i.z,a.x,a.y,a.z];t.push(l)}return t}set(e){const s=this.components.get(m);for(const t of e){const[r,i,a,l,w,g]=t,y=new v(r,i,a),u=new v(l,w,g);s.createOnPoints(y,u)}}setupEvents(e){if(!this.world)throw new Error("The edge measurement needs a world to work!");if(!this.world.renderer)throw new Error("The world of the edge measurement needs a renderer!");const t=this.world.renderer.three.domElement.parentElement;e?(t.addEventListener("click",this.create),t.addEventListener("mousemove",this.onMouseMove),window.addEventListener("keydown",this.onKeydown)):(t.removeEventListener("click",this.create),t.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("keydown",this.onKeydown))}updateSelection(e,s,t,r){if(!this.preview||!e.geometry.index)return;const i=P.getFace(e,t,r);if(!i)return;const{edges:a}=i;let l=Number.MAX_VALUE,w=[];for(const u of a){const[T,A]=u.points,E=P.distanceFromPointToLine(s,T,A,!0);E<this.tolerance&&E<l&&(l=E,w=u.points)}if(!w.length){this.preview.visible=!1;return}const[g,y]=w;this.preview.startPoint=g,this.preview.endPoint=y,this.preview.visible=!0}};o(b,"uuid","e7be5749-89df-4514-8d25-83aa38ce12d8");let M=b;const H=document.getElementById("container"),n=new(void 0),C=new(void 0)(n);C.setup();n.scene=C;const p=new j(n,H);n.renderer=p;const k=new(void 0)(n);n.camera=k;n.raycaster=new(void 0)(n);n.init();p.postproduction.enabled=!0;n.scene.get();k.controls.setLookAt(10,10,10,0,0,0);const N=new(void 0)(n,new I(6710886)),R=p.postproduction.customEffects;R.excludedMeshes.push(N.get());const h=new M(n),X=new(void 0)(n),q=await fetch("../../../resources/small.frag"),G=await q.arrayBuffer(),J=new Uint8Array(G);X.load(J);let L;window.addEventListener("keydown",d=>{d.code==="KeyO"?h.delete():d.code==="KeyS"?(L=h.get(),h.deleteAll()):d.code==="KeyL"&&L&&h.set(L)});const x=new(void 0)(n,{name:"Main Toolbar",position:"bottom"});x.addChild(h.uiElement.get("main"));n.ui.addToolbar(x);const f=new U;f.showPanel(2);document.body.append(f.dom);f.dom.style.left="0px";p.onBeforeUpdate.add(()=>f.begin());p.onAfterUpdate.add(()=>f.end());
