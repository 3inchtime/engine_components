var E=Object.defineProperty;var G=(t,o,e)=>o in t?E(t,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[o]=e;var i=(t,o,e)=>(G(t,typeof o!="symbol"?o+"":o,e),e);import{al as B,az as R,aA as v,aB as O,aC as T,ao as D}from"./web-ifc-api-BFxa4VQ4.js";import{S as z}from"./stats.min-GTpOrGrX.js";import{k as W,C as $,b as j}from"./index-CA2cPfXk.js";import{a as M,E as N,C as J}from"./index-2WRq2SpB.js";import{W as q,S as Y,a as H,b as K}from"./index-BSY2u5SV.js";import{G as Q}from"./index-5vXSe8tN.js";import{I as A}from"./index-CY9ZflN6.js";import{A as C}from"./async-event-D8tC9awa.js";import{P as V}from"./streaming-settings-BBmEUEWT.js";import{G as X}from"./ifc-geometry-types-C3SKrzrZ.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./ifc-fragment-settings-DrbKNZeA.js";class U extends M{constructor(){super(...arguments);i(this,"onPropertiesStreamed",new C);i(this,"onProgress",new C);i(this,"onIndicesStreamed",new C);i(this,"onDisposed",new N);i(this,"enabled",!0);i(this,"settings",new V);i(this,"webIfc",new B)}async dispose(){this.onIndicesStreamed.reset(),this.onPropertiesStreamed.reset(),this.webIfc=null,this.onDisposed.reset()}async streamFromBuffer(e){const s=performance.now();await this.readIfcFile(e),await this.streamAllProperties(),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-s} ms!`)}async streamFromCallBack(e){const s=performance.now();await this.streamIfcFile(e),await this.streamAllProperties(),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-s} ms!`)}async readIfcFile(e){const{path:s,absolute:r,logLevel:n}=this.settings.wasm;this.webIfc.SetWasmPath(s,r),await this.webIfc.Init(),n&&this.webIfc.SetLogLevel(n),this.webIfc.OpenModel(e,this.settings.webIfc)}async streamIfcFile(e){const{path:s,absolute:r,logLevel:n}=this.settings.wasm;this.webIfc.SetWasmPath(s,r),await this.webIfc.Init(),n&&this.webIfc.SetLogLevel(n),this.webIfc.OpenModelFromCallback(e,this.settings.webIfc)}async streamAllProperties(){const{propertiesSize:e}=this.settings,s=new Set(this.webIfc.GetIfcEntityList(0)),r=new Set([R,v,O,T,D]);for(const c of r)s.add(c);let n=.01,F=0;for(const c of s){if(F++,X.has(c))continue;const L=r.has(c),y=this.webIfc.GetLineIDsWithType(0,c),u=y.size();let S=0;for(let p=0;p<u-e;p+=e){const m={};for(let f=0;f<e;f++){S++;const d=y.get(p+f);try{const P=this.webIfc.GetLine(0,d,L);m[P.expressID]=P}catch{console.log(`Could not get property: ${d}`)}}await this.onPropertiesStreamed.trigger({type:c,data:m})}if(S!==u){const p={};for(let m=S;m<u;m++){const f=y.get(m);try{const d=this.webIfc.GetLine(0,f,L);p[d.expressID]=d}catch{console.log(`Could not get property: ${f}`)}}await this.onPropertiesStreamed.trigger({type:c,data:p})}const x=F/s.size;x>n&&(n+=.01,n=Math.max(n,x),await this.onProgress.trigger(Math.round(n*100)/100))}const k=await this.components.get(A).processFromWebIfc(this.webIfc,0);await this.onIndicesStreamed.trigger(k)}cleanUp(){this.webIfc=null,this.webIfc=new B}}i(U,"uuid","88d2c89c-ce32-47d7-8cb6-d51e4b311a0b");const Z=document.getElementById("container"),a=new J,_=a.get(q),l=_.create();l.scene=new Y(a);l.renderer=new H(a,Z);l.camera=new K(a);a.init();l.camera.controls.setLookAt(12,6,8,0,0,-10);const ee=a.get(Q);ee.create(l);function te(t,o){const e=new File([o],t),s=document.createElement("a"),r=URL.createObjectURL(e);s.href=r,s.download=e.name,s.click(),URL.revokeObjectURL(r)}async function se(t){for(const{name:o,bits:e}of t)te(o,e),await new Promise(s=>{setTimeout(s,100)})}const h=new U(a);h.settings.wasm={path:"https://unpkg.com/web-ifc@0.0.53/",absolute:!0};const w={types:{},ids:{},indexesFile:"small.ifc-processed-properties-indexes"};let b=0;const g=[];h.onPropertiesStreamed.add(async t=>{w.types[t.type]||(w.types[t.type]=[]),w.types[t.type].push(b);for(const s in t.data)w.ids[s]=b;const o=`small.ifc-processed-properties-${b}`,e=new Blob([JSON.stringify(t.data)]);g.push({bits:e,name:o}),b++});h.onProgress.add(async t=>{console.log(t)});h.onIndicesStreamed.add(async t=>{g.push({name:"small.ifc-processed-properties.json",bits:new Blob([JSON.stringify(w)])});const e=a.get(A).serializeRelations(t);g.push({name:"small.ifc-processed-properties-indexes",bits:new Blob([e])}),await se(g)});async function oe(){const o=await(await fetch("../../../../../resources/small.ifc")).arrayBuffer(),e=new Uint8Array(o);await h.streamFromBuffer(e)}W.registerComponents();const ne=$.create(()=>j`
    <bim-panel active label="IFC Properties Tiler Tutorial" 
      style="position: fixed; top: 5px; right: 5px">
      
      <bim-panel-section style="padding-top: 12px;">
      
        <bim-button label="Load IFC"
          @click="${()=>{oe()}}">
        </bim-button>  
      
      </bim-panel-section>
      
    </bim-panel>
  `);document.body.append(ne);const I=new z;I.showPanel(2);document.body.append(I.dom);I.dom.style.left="0px";l.renderer.onBeforeUpdate.add(()=>I.begin());l.renderer.onAfterUpdate.add(()=>I.end());
