var x=Object.defineProperty;var v=(n,t,e)=>t in n?x(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var o=(n,t,e)=>(v(n,typeof t!="symbol"?t+"":t,e),e);import{V as p,p as w,y as B,o as I,B as M,b as S,M as z}from"./web-ifc-api-BiYij3qq.js";import{S as y}from"./stats.min-GTpOrGrX.js";import{p as A,a as T,m as D}from"./index-DyM33b1I.js";import{d as u,E as j,c as F,a as N,W as U,S as k,b as E}from"./index-DsPLPeA6.js";import{G as L}from"./index-GK9dObYT.js";import"./_commonjsHelpers-Cpj98o6Y.js";class W{constructor(t){o(this,"enabled",!1);o(this,"id","FirstPerson");this.camera=t}set(t){if(this.enabled=t,t){if(this.camera.projection.current!=="Perspective"){this.camera.set("Orbit");return}this.setupFirstPersonCamera()}}setupFirstPersonCamera(){const t=this.camera.controls,e=new p;t.distance--,t.getPosition(e),t.minDistance=1,t.maxDistance=1,t.distance=1,t.moveTo(e.x,e.y,e.z),t.truckSpeed=50,t.mouseButtons.wheel=u.ACTION.DOLLY,t.touches.two=u.ACTION.TOUCH_ZOOM_TRUCK}}class R{constructor(t){o(this,"enabled",!0);o(this,"id","Orbit");this.camera=t,this.activateOrbitControls()}set(t){this.enabled=t,t&&this.activateOrbitControls()}activateOrbitControls(){const t=this.camera.controls;t.minDistance=1,t.maxDistance=300;const e=new p;t.getPosition(e);const s=e.length();t.distance=s,t.truckSpeed=2;const{rotation:r}=this.camera.three,d=new p(0,0,-1).applyEuler(r),a=e.addScaledVector(d,s);t.moveTo(a.x,a.y,a.z)}}class q{constructor(t){o(this,"enabled",!1);o(this,"id","Plan");o(this,"mouseAction1");o(this,"mouseAction2");o(this,"mouseInitialized",!1);o(this,"defaultAzimuthSpeed");o(this,"defaultPolarSpeed");this.camera=t,this.defaultAzimuthSpeed=t.controls.azimuthRotateSpeed,this.defaultPolarSpeed=t.controls.polarRotateSpeed}set(t){this.enabled=t;const e=this.camera.controls;e.azimuthRotateSpeed=t?0:this.defaultAzimuthSpeed,e.polarRotateSpeed=t?0:this.defaultPolarSpeed,this.mouseInitialized||(this.mouseAction1=e.touches.one,this.mouseAction2=e.touches.two,this.mouseInitialized=!0),t?(e.mouseButtons.left=u.ACTION.TRUCK,e.touches.one=u.ACTION.TOUCH_TRUCK,e.touches.two=u.ACTION.TOUCH_ZOOM):(e.mouseButtons.left=u.ACTION.ROTATE,e.touches.one=this.mouseAction1,e.touches.two=this.mouseAction2)}}class V{constructor(t){o(this,"onChanged",new j);o(this,"current","Perspective");o(this,"camera");o(this,"_component");o(this,"_previousDistance",-1);o(this,"matchOrthoDistanceEnabled",!1);this._component=t,this.camera=t.three}async set(t){this.current!==t&&(t==="Orthographic"?this.setOrthoCamera():await this.setPerspectiveCamera(),this.onChanged.trigger(this.camera))}async toggle(){const e=this.current==="Perspective"?"Orthographic":"Perspective";await this.set(e)}setOrthoCamera(){if(this._component.mode===null||this._component.mode.id==="FirstPerson")return;this._previousDistance=this._component.controls.distance,this._component.controls.distance=200;const t=this.getPerspectiveDims();if(!t)return;const{width:e,height:s}=t;this.setupOrthoCamera(s,e),this.camera=this._component.threeOrtho,this.current="Orthographic"}getPerspectiveDims(){const t=this._component.currentWorld;if(!t||!t.renderer)return null;const e=new p;this._component.threePersp.getWorldDirection(e);const s=new p;this._component.controls.getTarget(s);const d=s.clone().sub(this._component.threePersp.position).dot(e),a=t.renderer.getSize(),h=a.x/a.y,l=this._component.threePersp,m=d*2*Math.atan(l.fov*(Math.PI/180)/2);return{width:m*h,height:m}}setupOrthoCamera(t,e){this._component.controls.mouseButtons.wheel=u.ACTION.ZOOM,this._component.controls.mouseButtons.middle=u.ACTION.ZOOM;const s=this._component.threePersp,r=this._component.threeOrtho;r.zoom=1,r.left=e/-2,r.right=e/2,r.top=t/2,r.bottom=t/-2,r.updateProjectionMatrix(),r.position.copy(s.position),r.quaternion.copy(s.quaternion),this._component.controls.camera=r}getDistance(){const t=this._component.threePersp,e=this._component.threeOrtho;return(e.top-e.bottom)/e.zoom/(2*Math.atan(t.fov*(Math.PI/180)/2))}async setPerspectiveCamera(){this._component.controls.mouseButtons.wheel=u.ACTION.DOLLY,this._component.controls.mouseButtons.middle=u.ACTION.DOLLY;const t=this._component.threePersp,e=this._component.threeOrtho;t.position.copy(e.position),t.quaternion.copy(e.quaternion),this._component.controls.mouseButtons.wheel=u.ACTION.DOLLY,this.matchOrthoDistanceEnabled?this._component.controls.distance=this.getDistance():this._component.controls.distance=this._previousDistance,await this._component.controls.zoomTo(1),t.updateProjectionMatrix(),this._component.controls.camera=t,this.camera=t,this.current="Perspective"}}class G extends F{constructor(e){super(e);o(this,"_mode",null);o(this,"projection");o(this,"threeOrtho");o(this,"threePersp");o(this,"_userInputButtons",{});o(this,"_frustumSize",50);o(this,"_navigationModes",new Map);this.threePersp=this.three,this.threeOrtho=this.newOrthoCamera(),this.projection=new V(this),this.onAspectUpdated.add(()=>{this.setOrthoCameraAspect()}),this.projection.onChanged.add(s=>{this.three=s}),this.onWorldChanged.add(()=>{this._navigationModes.clear(),this._navigationModes.set("Orbit",new R(this)),this._navigationModes.set("FirstPerson",new W(this)),this._navigationModes.set("Plan",new q(this)),this._mode=this._navigationModes.get("Orbit"),this.mode.set(!0,{preventTargetAdjustment:!0})})}get mode(){if(!this._mode)throw new Error("Mode not found, camera not initialized");return this._mode}dispose(){super.dispose(),this.threeOrtho.removeFromParent()}set(e){if(this.mode!==null&&this.mode.id!==e){if(this.mode.set(!1),!this._navigationModes.has(e))throw new Error("The specified mode does not exist!");this._mode=this._navigationModes.get(e),this.mode.set(!0)}}async fit(e,s=1.5){if(!this.enabled)return;const r=Number.MAX_VALUE,d=Number.MIN_VALUE,a=new p(r,r,r),h=new p(d,d,d);for(const C of e){const c=new w().setFromObject(C);c.min.x<a.x&&(a.x=c.min.x),c.min.y<a.y&&(a.y=c.min.y),c.min.z<a.z&&(a.z=c.min.z),c.max.x>h.x&&(h.x=c.max.x),c.max.y>h.y&&(h.y=c.max.y),c.max.z>h.z&&(h.z=c.max.z)}const l=new w(a,h),m=new p;l.getSize(m);const b=new p;l.getCenter(b);const _=Math.max(m.x,m.y,m.z)*s,P=new B(b,_);await this.controls.fitToSphere(P,!0)}setUserInput(e){e?this.enableUserInput():this.disableUserInput()}disableUserInput(){this._userInputButtons.left=this.controls.mouseButtons.left,this._userInputButtons.right=this.controls.mouseButtons.right,this._userInputButtons.middle=this.controls.mouseButtons.middle,this._userInputButtons.wheel=this.controls.mouseButtons.wheel,this.controls.mouseButtons.left=0,this.controls.mouseButtons.right=0,this.controls.mouseButtons.middle=0,this.controls.mouseButtons.wheel=0}enableUserInput(){Object.keys(this._userInputButtons).length!==0&&(this.controls.mouseButtons.left=this._userInputButtons.left,this.controls.mouseButtons.right=this._userInputButtons.right,this.controls.mouseButtons.middle=this._userInputButtons.middle,this.controls.mouseButtons.wheel=this._userInputButtons.wheel)}newOrthoCamera(){const e=window.innerWidth/window.innerHeight;return new I(this._frustumSize*e/-2,this._frustumSize*e/2,this._frustumSize/2,this._frustumSize/-2,.1,1e3)}setOrthoCameraAspect(){if(!this.currentWorld||!this.currentWorld.renderer)return;const e=new p;this.threePersp.getWorldDirection(e);const s=new p;this.controls.getTarget(s);const d=s.clone().sub(this.threePersp.position).dot(e),a=this.currentWorld.renderer.getSize(),h=a.x/a.y,l=this.threePersp,m=d*2*Math.atan(l.fov*(Math.PI/180)/2),b=m*h;this.threeOrtho.zoom=1,this.threeOrtho.left=b/-2,this.threeOrtho.right=b/2,this.threeOrtho.top=m/2,this.threeOrtho.bottom=m/-2,this.threeOrtho.updateProjectionMatrix()}}const H=document.getElementById("container"),f=new N,Y=f.get(U),i=Y.create();i.scene=new k(f);i.renderer=new E(f,H);i.camera=new G(f);f.init();i.scene.setup();i.camera.controls.setLookAt(3,3,3,0,0,0);const Z=new M,$=new S({color:"#6528D7"}),g=new z(Z,$);g.position.set(0,.5,0);i.scene.three.add(g);i.meshes.add(g);const K=f.get(L),X=K.create(i);i.camera.projection.onChanged.add(()=>{const n=i.camera.projection.current;X.fade=n==="Perspective"});A.init();const J=T.create(()=>D`
    <bim-panel active label="Orthoperspective Camera Tutorial" 
      style="position: fixed; top: 5px; right: 5px">
      <bim-panel-section style="padding-top: 10px;">
         
          <bim-dropdown required label="Navigation mode" 
            @change="${({target:n})=>{const t=n.value[0],{current:e}=i.camera.projection;if(e==="Orthographic"&&t==="FirstPerson"){alert("First person is not compatible with ortho!"),n.value[0]=i.camera.mode.id;return}i.camera.set(t)}}">

          <bim-option checked label="Orbit"></bim-option>
          <bim-option label="FirstPerson"></bim-option>
          <bim-option label="Plan"></bim-option>
        </bim-dropdown>
         
      
        <bim-dropdown required label="Camera projection" 
            @change="${({target:n})=>{const t=n.value[0],e=t==="Orthographic",s=i.camera.mode.id==="FirstPerson";if(e&&s){alert("First person is not compatible with ortho!"),n.value[0]=i.camera.projection.current;return}i.camera.projection.set(t)}}">
          <bim-option checked label="Perspective"></bim-option>
          <bim-option label="Orthographic"></bim-option>
        </bim-dropdown>

        <bim-checkbox 
          label="Allow user input" checked 
          @change="${({target:n})=>{i.camera.setUserInput(n.checked)}}">  
        </bim-checkbox>  
        
        <bim-button 
          label="Fit cube" 
          @click="${()=>{i.camera.fit([g])}}">  
        </bim-button>  

      </bim-panel-section>
    </bim-panel>
    `);document.body.append(J);const O=new y;O.showPanel(2);document.body.append(O.dom);O.dom.style.left="0px";i.renderer.onBeforeUpdate.add(()=>O.begin());i.renderer.onAfterUpdate.add(()=>O.end());
