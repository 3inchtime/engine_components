var u=Object.defineProperty;var g=(o,r,e)=>r in o?u(o,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[r]=e;var t=(o,r,e)=>(g(o,typeof r!="symbol"?r+"":r,e),e);import{a3 as l,f as c}from"./web-ifc-api-Glg4rFxW.js";import{E as i,B as f,U as m,a as w}from"./index-BjtWM7Op.js";import{B as v,D as b}from"./simple-camera-FtEnIFQL.js";class _ extends v{constructor(){super(...arguments);t(this,"onAfterUpdate",new i);t(this,"onBeforeUpdate",new i);t(this,"onDisposed",new i);t(this,"onResize",new i);t(this,"onClippingPlanesUpdated",new i);t(this,"clippingPlanes",[])}updateClippingPlanes(){this.onClippingPlanesUpdated.trigger()}setPlane(e,s,n){s.isLocal=n;const h=this.clippingPlanes.indexOf(s);e&&h===-1?this.clippingPlanes.push(s):!e&&h>-1&&this.clippingPlanes.splice(h,1),this.three.clippingPlanes=this.clippingPlanes.filter(a=>!a.isLocal)}}class E extends f{constructor(e){super(e);t(this,"meshes",new Set);t(this,"onAfterUpdate",new i);t(this,"onBeforeUpdate",new i);t(this,"enabled",!0);t(this,"uuid",m.create());t(this,"onDisposed",new i);t(this,"_scene");t(this,"_camera");t(this,"_renderer",null)}get scene(){if(!this._scene)throw new Error("No scene initialized!");return this._scene}set scene(e){this._scene=e,e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"})}get camera(){if(!this._camera)throw new Error("No camera initialized!");return this._camera}set camera(e){this._camera=e,e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"})}get renderer(){return this._renderer}set renderer(e){this._renderer=e,e&&(e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"}))}update(e){this.enabled&&(!this._scene||!this._camera||(this.scene.currentWorld=this,this.camera.currentWorld=this,this.renderer&&(this.renderer.currentWorld=this),this.onBeforeUpdate.trigger(),this.scene.isUpdateable()&&this.scene.update(e),this.camera.isUpdateable()&&this.camera.update(e),this.renderer&&this.renderer.update(e),this.onAfterUpdate.trigger()))}dispose(e=!0){if(this.enabled=!1,this.scene.onWorldChanged.trigger({world:this,action:"removed"}),this.camera.onWorldChanged.trigger({world:this,action:"removed"}),this.renderer&&this.renderer.onWorldChanged.trigger({world:this,action:"removed"}),e){const s=this.components.get(b);this.scene.dispose(),this.camera.isDisposeable()&&this.camera.dispose(),this.renderer&&this.renderer.dispose();for(const n of this.meshes)s.destroy(n);this.meshes.clear()}this._scene=null,this._camera=null,this._renderer=null,this.onDisposed.trigger()}}class x extends _{constructor(e,s,n){super(e);t(this,"enabled",!0);t(this,"container");t(this,"three");t(this,"_canvas");t(this,"_parameters");t(this,"_resizeObserver",null);t(this,"onContainerUpdated",new i);t(this,"resize",e=>{this.onContainerUpdated.trigger();const s=e?e.x:this.container.clientWidth,n=e?e.y:this.container.clientHeight;this.three.setSize(s,n),this.onResize.trigger(new c(s,n))});t(this,"resizeEvent",()=>{this.resize()});t(this,"onContextLost",e=>{e.preventDefault(),this.enabled=!1});t(this,"onContextBack",()=>{this.three.setRenderTarget(null),this.three.dispose(),this.three=new l({canvas:this._canvas,antialias:!0,alpha:!0,...this._parameters}),this.enabled=!0});this.container=s,this._parameters=n,this.three=new l({antialias:!0,alpha:!0,...n}),this.three.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.setupRenderer(),this.setupEvents(!0),this.resize(),this._canvas=this.three.domElement;const h=this.three.getContext(),{canvas:a}=h;a.addEventListener("webglcontextlost",this.onContextLost,!1),a.addEventListener("webglcontextrestored",this.onContextBack,!1)}update(){if(!this.enabled||!this.currentWorld)return;this.onBeforeUpdate.trigger(this);const e=this.currentWorld.scene.three,s=this.currentWorld.camera.three;this.three.render(e,s),this.onAfterUpdate.trigger(this)}dispose(){this.enabled=!1,this.setupEvents(!1),this.three.domElement.remove(),this.three.dispose(),this.onResize.reset(),this.onAfterUpdate.reset(),this.onBeforeUpdate.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}getSize(){return new c(this.three.domElement.clientWidth,this.three.domElement.clientHeight)}setupEvents(e){const s=this.three.domElement.parentElement;if(!s)throw new Error("This renderer needs to have an HTML container!");this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null),window.removeEventListener("resize",this.resizeEvent),e&&(this._resizeObserver=new ResizeObserver(this.resizeEvent),this._resizeObserver.observe(s),this._resizeObserver.observe(document.body),window.addEventListener("resize",this.resizeEvent))}setupRenderer(){this.three.localClippingEnabled=!0,this.container&&this.container.appendChild(this.three.domElement),this.onContainerUpdated.trigger()}}const d=class d extends w{constructor(e){super(e);t(this,"onAfterUpdate",new i);t(this,"onBeforeUpdate",new i);t(this,"onDisposed",new i);t(this,"list",new Map);t(this,"enabled",!0);e.add(d.uuid,this)}create(){const e=new E(this.components),s=e.uuid;if(this.list.has(s))throw new Error("There is already a world with this name!");return this.list.set(s,e),e}delete(e){this.list.delete(e.uuid),e.dispose()}dispose(){this.enabled=!1;for(const[e,s]of this.list)s.dispose();this.list.clear(),this.onDisposed.trigger()}update(e){if(this.enabled)for(const[s,n]of this.list)n.update(e)}};t(d,"uuid","fdb61dc4-2ec1-4966-b83d-54ea795fad4a");let p=d;export{x as S,p as W};
