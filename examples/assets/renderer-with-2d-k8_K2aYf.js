var z=Object.defineProperty;var _=(l,n,r)=>n in l?z(l,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[n]=r;var S=(l,n,r)=>(_(l,typeof n!="symbol"?n+"":n,r),r);import{V as x,a as M,O as R,f as A,n as q}from"./web-ifc-api-BC8YMRiS.js";import{i as T}from"./index-BmA4XTIx.js";class U extends R{constructor(n=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=n,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new A(.5,.5),this.addEventListener("removed",function(){this.traverse(function(r){r.element instanceof Element&&r.element.parentNode!==null&&r.element.parentNode.removeChild(r.element)})})}copy(n,r){return super.copy(n,r),this.element=n.element.cloneNode(!0),this.center=n.center,this}}const c=new x,D=new M,v=new M,g=new x,w=new x;class F{constructor(n={}){const r=this;let u,m,d,a;const f={objects:new WeakMap},h=n.element!==void 0?n.element:document.createElement("div");h.style.overflow="hidden",this.domElement=h,this.getSize=function(){return{width:u,height:m}},this.render=function(e,t){e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),t.parent===null&&t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),D.copy(t.matrixWorldInverse),v.multiplyMatrices(t.projectionMatrix,D),y(e,e,t),E(e)},this.setSize=function(e,t){u=e,m=t,d=u/2,a=m/2,h.style.width=e+"px",h.style.height=t+"px"};function y(e,t,s){if(e.isCSS2DObject){c.setFromMatrixPosition(e.matrixWorld),c.applyMatrix4(v);const i=e.visible===!0&&c.z>=-1&&c.z<=1&&e.layers.test(s.layers)===!0;if(e.element.style.display=i===!0?"":"none",i===!0){e.onBeforeRender(r,t,s);const p=e.element;p.style.transform="translate("+-100*e.center.x+"%,"+-100*e.center.y+"%)translate("+(c.x*d+d)+"px,"+(-c.y*a+a)+"px)",p.parentNode!==h&&h.appendChild(p),e.onAfterRender(r,t,s)}const o={distanceToCameraSquared:W(s,e)};f.objects.set(e,o)}for(let i=0,o=e.children.length;i<o;i++)y(e.children[i],t,s)}function W(e,t){return g.setFromMatrixPosition(e.matrixWorld),w.setFromMatrixPosition(t.matrixWorld),g.distanceToSquared(w)}function C(e){const t=[];return e.traverse(function(s){s.isCSS2DObject&&t.push(s)}),t}function E(e){const t=C(e).sort(function(i,o){if(i.renderOrder!==o.renderOrder)return o.renderOrder-i.renderOrder;const p=f.objects.get(i).distanceToCameraSquared,O=f.objects.get(o).distanceToCameraSquared;return p-O}),s=t.length;for(let i=0,o=t.length;i<o;i++)t[i].element.style.zIndex=s-i}}}class B extends T{constructor(r,u,m){super(r,u,m);S(this,"three2D",new F);this.onAfterUpdate.add(()=>{if(this.onBeforeUpdate.trigger(this),!this.enabled||!this.currentWorld)return;const d=this.currentWorld.scene.three,a=this.currentWorld.camera.three;d instanceof q&&this.three2D.render(d,a)}),this.onDisposed.add(()=>{this.three2D.domElement.remove()}),this.onResize.add(({x:d,y:a})=>{this.three2D.setSize(d,a)}),this.setupHtmlRenderer(),this.resize()}setupHtmlRenderer(){this.three2D.domElement.style.position="absolute",this.three2D.domElement.style.top="0px",this.three2D.domElement.style.pointerEvents="none",this.container&&this.container.appendChild(this.three2D.domElement)}}export{U as C,B as R};
